
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Pine Script v5 Documentation</title>
        <style>
            /* Reset and base styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            /* Body styling */
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                line-height: 1.6;
                color: #000000;
                max-width: 1200px;
                margin: 0 auto;
                padding: 40px;
                background: #F8F9FD;
            }

            /* Typography */
            h1, h2, h3, h4, h5, h6 {
                margin: 2rem 0 1rem;
                line-height: 1.3;
                color: #1a1a1a;
            }

            h1 {
                font-size: 2.5rem;
                border-bottom: 2px solid #eaecef;
                padding-bottom: 0.5rem;
            }

            h2 {
                font-size: 2rem;
            }

            p {
                margin-bottom: 1.5rem;
            }

            /* Code blocks */
            pre, code {
                background: #f6f8fa;
                border-radius: 6px;
                font-family: 'Monaco', 'Consolas', monospace;
                padding: 0.2em 0.4em;
            }

            pre {
                padding: 1rem;
                overflow-x: auto;
                margin: 1rem 0;
            }

            /* Image styling */
            .image-container {
                background: #ffffff;
                border: 1px solid #e1e4e8;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                text-align: center;
                text-align: center;
                width: 100%;
                display: block;
            }

            .image-container img {
                max-width: 100%;
                height: auto;
                display: block;
                margin: 0 auto;
            }

            /* Ensure images without containers are also properly styled */
            img:not(.image-container img) {
                max-width: 100%;
                height: auto;
                display: block;
                margin: 20px auto;
            }

            img {
                max-width: 800px;
                width: 100%;
                height: auto;
                display: block;
                margin: 0 auto;
            }

            /* TOC styling */
            /* Updated TOC styling */
            #toc-container {
                position: sticky;
                top: 20px;
                border: 1px solid #e1e4e8;
                padding: 20px;
                margin-bottom: 30px;
                border-radius: 8px;
                background-color: #ffffff;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
                max-height: 90vh;
                overflow-y: auto;
            }

            #toc-container.collapsed {
                max-height: 60px;
                overflow: hidden;
                cursor: pointer;
            }

            #toc-container.collapsed #toc-list,
            #toc-container.collapsed #searchInput {
                display: none;
            }

            #toc-container.collapsed h1 {
                margin: 0;
                padding: 0;
                border: none;
            }

            #toc-container.collapsed::after {
                content: "Click to expand";
                display: block;
                color: #666;
                font-size: 0.8rem;
                margin-top: 5px;
            }

            #toc-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            #toc-header h1 {
                margin: 0;
                flex: 1;
            }

            #toc-collapse-btn {
                background: none;
                border: none;
                cursor: pointer;
                padding: 5px;
                color: #666;
                font-size: 1.2rem;
                transition: transform 0.3s ease;
            }

            #toc-collapse-btn:hover {
                color: #0366d6;
            }

            #toc-collapse-btn.collapsed {
                transform: rotate(180deg);
            }

            #toc-container h1 {
                font-size: 1.5rem;
                margin-top: 0;
                border-bottom: 2px solid #eaecef;
                padding-bottom: 10px;
            }

            #searchInput {
                width: 100%;
                padding: 10px;
                margin: 15px 0;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }

            #searchInput:focus {
                outline: none;
                border-color: #0366d6;
                box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
            }

            /* TOC list styling */
            #toc-list {
                list-style: none;
                padding: 0;
            }

            #toc-list li {
                margin: 8px 0;
            }

            #toc-list a {
                color: #0366d6;
                text-decoration: none;
                transition: color 0.2s ease;
            }

            #toc-list a:hover {
                color: #035fc7;
                text-decoration: underline;
            }

            /* Dropdown styling */
            details > summary {
                cursor: pointer;
                font-weight: 600;
                padding: 10px;
                background-color: #f6f8fa;
                border: 1px solid #e1e4e8;
                border-radius: 6px;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                transition: background-color 0.2s ease;
            }

            details > summary:hover {
                background-color: #f0f2f4;
            }

            details > summary .toggle-icon {
                margin-left: 10px;
                transition: transform 0.2s;
            }

            details[open] > summary .toggle-icon {
                transform: rotate(90deg);
            }

            details > ul {
                margin-left: 20px;
                padding: 10px;
            }

            /* Back to top button */
            #back-to-top {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background-color: #0366d6;
                color: white;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: none;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                border: none;
                transition: background-color 0.2s ease, transform 0.2s ease;
                font-size: 24px;
                z-index: 1000;
            }

            #back-to-top:hover {
                background-color: #035fc7;
                transform: translateY(-2px);
            }

            /* Main content section */
            .content {
                background: #ffffff;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin: 20px 0;
            }

            /* Extracted Monaco Editor Theme styles */
            

            /* Pine Colorizer styles */
            .pine-colorizer {
                --bg-color: #ffffff;
                --border-color: #e0e3eb;
                --border-separator: #f0f3fa;
                --scroll-color: #9598a1;
                --text-color: #131722;
                --tooltip-color: #ffffff;
                --tooltip-bg: #2a2e39;
                --copy-hover: #f0f3fa;
                --copy-active: #e1e3eb;
                font-family: Menlo, "Ubuntu Mono", Consolas, "source-code-pro", monospace;
                position: relative;
                font-size: 13px;
                line-height: 18px;
                padding: 12px 12px 12px;
                border-radius: 8px;
                color: var(--text-color);
                border: 1px solid var(--border-color);
                background-color: var(--bg-color);
                white-space: pre;
                margin: 1.5rem 0;
                overflow-x: auto;
            }

            .pine-colorizer__header {
                all: unset;
                white-space: pre;
                height: 40px;
                border-bottom: 1px solid var(--border-separator);
                display: flex
            ;
                align-items: center;
                justify-content: space-between;
                gap: 6px;
                margin-bottom: 6px;
            }

            .pine-colorizer__title {
                all: unset;
                font-family: -apple-system, BlinkMacSystemFont, Trebuchet MS, Roboto, Ubuntu, sans-serif;
                font-size: 14px;
                line-height: 18px;
                font-style: normal;
                font-weight: 600;
                display: flex
            ;
                align-items: center;
                justify-content: center;
                gap: 6px;
                color: var(--text-color) !important;
                text-decoration: unset !important;
                transition: all .3s ease-in-out;
                cursor: pointer;
            }

            /* Additional Pine Colorizer styles */
                .pine-colorizer code {
                display: block;
                font-family: Menlo, "Ubuntu Mono", Consolas, "source-code-pro", monospace;
            }

            .pine-colorizer span {
                font-family: inherit;
            }

            .pine-colorizer__copy-btn {
                all: unset;
                padding: 5px;
                cursor: pointer;
                position: relative;
                border-radius: 6px;
            }

            .pine-colorizer__copy-btn:hover {
                background-color: var(--copy-hover);
            }

            .pine-colorizer__copy-btn:active {
                background-color: var(--copy-active);
            }

            .pine-colorizer__tooltip {
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                margin-bottom: 5px;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                background-color: var(--tooltip-bg);
                color: var(--tooltip-color);
                white-space: nowrap;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.2s;
            }

            .pine-colorizer__copy-btn:hover .pine-colorizer__tooltip {
                opacity: 1;
            }

            /* Monaco Editor Theme styles */
            .monaco-editor-tv-pine-light {
                display: block;
                overflow-x: auto;
            }

            /* Add smooth scrolling for code blocks */
            .pine-colorizer::-webkit-scrollbar {
                height: 8px;
                width: 8px;
            }

            .pine-colorizer::-webkit-scrollbar-thumb {
                background-color: var(--scroll-color);
                border-radius: 4px;
            }

            .pine-colorizer::-webkit-scrollbar-track {
                background-color: var(--border-separator);
                border-radius: 4px;
            }
        </style>
    </head>
    <body>
        <div id="toc-container">
            <div id="toc-header">
                <h1>Table of Contents</h1>
                <button id="toc-collapse-btn" title="Toggle TOC">▼</button>
            </div>
            <input type="text" id="searchInput" placeholder="Search..." onkeyup="filterTOC()">
            <ul id="toc-list">
                
            <li>
                <details>
                    <summary>Introduction <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#introduction-welcome-to-pine-script™-v5">Welcome to Pine Script™ v5</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>Pine Script™ Primer <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#pine-script™-primer-first-steps">First steps</a></li><li><a href="#pine-script™-primer-first-indicator">First indicator</a></li><li><a href="#pine-script™-primer-next-steps">Next steps</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>Language <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#language-execution-model">Execution model</a></li><li><a href="#language-time-series">Time series</a></li><li><a href="#language-script-structure">Script structure</a></li><li><a href="#language-identifiers">Identifiers</a></li><li><a href="#language-operators">Operators</a></li><li><a href="#language-variable-declarations">Variable declarations</a></li><li><a href="#language-conditional-structures">Conditional structures</a></li><li><a href="#language-loops">Loops</a></li><li><a href="#language-type-system">Type system</a></li><li><a href="#language-built-ins">Built-ins</a></li><li><a href="#language-user-defined-functions">User-defined functions</a></li><li><a href="#language-objects">Objects</a></li><li><a href="#language-enums">Enums</a></li><li><a href="#language-methods">Methods</a></li><li><a href="#language-arrays">Arrays</a></li><li><a href="#language-matrices">Matrices</a></li><li><a href="#language-maps">Maps</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>Concepts <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#concepts-alerts">Alerts</a></li><li><a href="#concepts-backgrounds">Backgrounds</a></li><li><a href="#concepts-bar-coloring">Bar coloring</a></li><li><a href="#concepts-bar-plotting">Bar plotting</a></li><li><a href="#concepts-bar-states">Bar states</a></li><li><a href="#concepts-chart-information">Chart information</a></li><li><a href="#concepts-colors">Colors</a></li><li><a href="#concepts-fills">Fills</a></li><li><a href="#concepts-inputs">Inputs</a></li><li><a href="#concepts-levels">Levels</a></li><li><a href="#concepts-libraries">Libraries</a></li><li><a href="#concepts-lines-and-boxes">Lines and boxes</a></li><li><a href="#concepts-non-standard-charts-data">Non-standard charts data</a></li><li><a href="#concepts-other-timeframes-and-data">Other timeframes and data</a></li><li><a href="#concepts-plots">Plots</a></li><li><a href="#concepts-repainting">Repainting</a></li><li><a href="#concepts-sessions">Sessions</a></li><li><a href="#concepts-strategies">Strategies</a></li><li><a href="#concepts-tables">Tables</a></li><li><a href="#concepts-text-and-shapes">Text and shapes</a></li><li><a href="#concepts-time">Time</a></li><li><a href="#concepts-timeframes">Timeframes</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>Writing Scripts <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#writing-scripts-style-guide">Style guide</a></li><li><a href="#writing-scripts-debugging">Debugging</a></li><li><a href="#writing-scripts-profiling-and-optimization">Profiling and optimization</a></li><li><a href="#writing-scripts-publishing-scripts">Publishing scripts</a></li><li><a href="#writing-scripts-limitations">Limitations</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>FAQ <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#faq-alerts">Alerts</a></li><li><a href="#faq-data-structures">Data structures</a></li><li><a href="#faq-functions">Functions</a></li><li><a href="#faq-indicators">Indicators</a></li><li><a href="#faq-other-data-and-timeframes">Other data and timeframes</a></li><li><a href="#faq-programming">Programming</a></li>
                    </ul>
                </details>
            </li>
        
            <li>
                <details>
                    <summary>Error Messages <span class="toggle-icon">▶</span></summary>
                    <ul>
        <li><a href="#error-messages-error-messages">Error messages</a></li>
                    </ul>
                </details>
            </li>
        
            </ul>
        </div>
        <div class="content">
        <h1>Introduction</h1>
<main class="content" data-astro-cid-ju3wuhkz=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Introduction</span> </div> </div> <div data-astro-cid-xgirumru="" data-toc-hidden="" id="slot-container"> <h1 class="md-heading" id="introduction-welcome-to-pine-script™-v5"><a href="#welcome-to-pine-script-v5">Welcome to Pine Script™ v5<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>Pine Script™ is <a href="https://www.tradingview.com/">TradingView</a>’s programming
language. It allows traders to create their own trading tools and run them on
our servers. We designed Pine Script™ as a lightweight, yet powerful, language
for developing indicators and strategies that you can then backtest. Most of
TradingView’s built-in indicators are written in Pine Script™, and our thriving
community of Pine Script™ programmers has published more than 100,000
<a href="https://www.tradingview.com/scripts/">Community Scripts</a>.</p>
<h1 class="md-heading" id="requirements"><a href="#requirements">Requirements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>It’s our explicit goal to keep Pine Script™ accessible and easy to understand
for the broadest possible audience. Pine Script™ is cloud-based and therefore
different from client-side programming languages. While we likely won’t develop
Pine Script™ into a full-fledged language, we do constantly improve it and are
always happy to consider requests for new features.</p>
<p>Because each script uses computational resources in the cloud, we must impose
limits in order to share these resources fairly among our users. We strive to
set as few limits as possible, but will of course have to implement as many as
needed for the platform to run smoothly. Limitations apply to the amount of data
requested from additional symbols, execution time, memory usage and script size.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/primer/first-steps"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  First steps <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><h1>Pine Script™ Primer</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/primer/first-steps">Pine Script™ primer</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">First steps</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="pine-script™-primer-first-steps"><a href="#first-steps">First steps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Welcome to the Pine Script™ <a href="/pine-script-docs/v5/welcome/">v5 User
Manual</a>,
which will accompany you in your journey to learn to program your own
trading tools in Pine Script™. Welcome also to the very active community
of Pine Script™ programmers on TradingView.</p>
<p>In this page, we present a step-by-step approach that you can follow to
gradually become more familiar with indicators and strategies (also
called <em>scripts</em>) written in the Pine Script™ programming language on
<a href="https://www.tradingview.com/">TradingView</a>. We will get you started on
your journey to:</p>
<ol>
<li><strong>Use</strong> some of the tens of thousands of existing scripts on the
platform.</li>
<li><strong>Read</strong> the Pine Script™ code of existing scripts.</li>
<li><strong>Write</strong> Pine Script™ scripts.</li>
</ol>
<p>If you are already familiar with the use of Pine scripts on TradingView
and are now ready to learn how to write your own, then jump to the
<a href="/pine-script-docs/v5/primer/first-steps/#writing-scripts">Writing scripts</a> section of this page.</p>
<p>If you are new to our platform, then please read on!</p>
<h2 class="md-heading" id="using-scripts"><a href="#using-scripts">Using scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>If you are interested in using technical indicators or strategies on
TradingView, you can first start exploring the thousands of indicators
already available on our platform. You can access existing indicators on
the platform in two different ways:</p>
<ul>
<li>By using the chart’s “Indicators, Metrics &amp; Strategies” button, or</li>
<li>By browsing TradingView’s <a href="https://www.tradingview.com/scripts/">Community
Scripts</a>, the largest
repository of trading scripts in the world, with more than 100,000
scripts, most of which are free and open-source, which means you can
see their Pine Script™ code.</li>
</ul>
<p>If you can find the tools you need already written for you, it can be a
good way to get started and gradually become proficient as a script
user, until you are ready to start your programming journey in Pine
Script™.</p>
<h3 class="md-heading" id="loading-scripts-from-the-chart"><a href="#loading-scripts-from-the-chart">Loading scripts from the chart<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To explore and load scripts from your chart, use the “Indicators, Metrics &amp;
Strategies” button:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="690" loading="lazy" src="images/eeba21b107cf07ec401ea229911742f4.webp" width="1370"/></div></p>
<p>The dialog box presents different categories of scripts in its left
pane:</p>
<ul>
<li><strong>Favorites</strong> lists the scripts you have “favorited” by clicking
on the star that appears to the left of its name when you mouse over
it.</li>
<li><strong>Personal</strong> displays the scipts you have written and saved in the
Pine Editor. They are saved in TradingView’s cloud.</li>
<li><strong>Technicals</strong> groups most TradingView built-ins organized in four
categories: indicators, strategies, profiles, and patterns. Most are written in Pine Script™ and available for free.</li>
<li><strong>Financials</strong> contains all built-in indicators that display financial metrics. The contents of that tab and the subcategories they are grouped into depend on the symbol currently open on the chart.</li>
<li><strong>Community</strong> is where you can search from the 100,000+ published scripts written by TradingView users. The scripts can be sorted by one of the three different filters — Editor’s Picks only shows open-source scripts hand-picked my our script moderatots, Top shows the most popular scripts of all time, and Trending displays the most-popular scripts that were published recently.</li>
<li><strong>Invite-only</strong> contains the list of the invite-only scripts you have been granted access to by their authors.</li>
</ul>
<p>Here, the section containing the TradingView built-ins is selected:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="902" loading="lazy" src="images/b47596167c3f4160846edd30f4ca82ee.webp" width="1360"/></div></p>
<p>When you click on one of the indicators or strategies (the ones marked with a symbol with two arrows), it loads on your chart.</p>
<h3 class="md-heading" id="browsing-community-scripts"><a href="#browsing-community-scripts">Browsing Community Scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>From <a href="https://www.tradingview.com/">TradingView’s homepage</a>, you can
bring up the Community Scripts stream from the “Community” menu. Here,
we are pointing to the “Editors’ Picks” section, but there are many
other categories you can choose from:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1194" loading="lazy" src="images/0aef3644f3b4fca00784a620a33ab21f.webp" width="2044"/></div></p>
<p>You can also search for scripts using the homepage’s “Search” field,
and filter scripts using different criteria. The Help Center has a page
explaining the <a href="https://www.tradingview.com/support/solutions/43000558522">different types of
scripts</a> that
are available.</p>
<p>The scripts stream shows script <em>widgets</em>, i.e., placeholders showing a
miniature view of each publication’s chart and description, and its
author. By clicking on it you will open the <em>script’s page</em>, where you
can see the script on a chart, read the author’s description, like the
script, leave comments or read the script’s source code if it was
published open-source.</p>
<p>Once you find an interesting script in the Community Scripts, follow the
instructions in the Help Center to <a href="https://www.tradingview.com/support/solutions/43000555216">load it on your
chart</a>.</p>
<h3 class="md-heading" id="changing-script-settings"><a href="#changing-script-settings">Changing script settings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Once a script is loaded on the chart, you can double-click on its name or hover over the name and press the “Settings” button to bring up its “Settings/Inputs” tab:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1286" loading="lazy" src="images/a47bcef5f1e441106be46f139773918c.webp" width="1720"/></div></p>
<p>The “Inputs” tab allows you to change the settings which the script’s
author has decided to make editable. You can configure some of the
script’s visuals using the “Style” tab of the same dialog box, and
which timeframes the script should appear on using the “Visibility”
tab.</p>
<p>Other settings are available to all scripts from the buttons that appear
to the right of its name when you mouse over it, and from the “More”
menu (the three dots):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1284" loading="lazy" src="images/5a5604e1909e6235640823e052f6cff3.webp" width="1420"/></div></p>
<h2 class="md-heading" id="reading-scripts"><a href="#reading-scripts">Reading scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Reading code written by <strong>good</strong> programmers is the best way to develop
your understanding of the language. This is as true for Pine Script™ as
it is for all other programming languages. Finding good open-source Pine
Script™ code is relatively easy. These are reliable sources of code
written by good programmers on TradingView:</p>
<ul>
<li>The TradingView built-in indicators</li>
<li>Scripts selected as <a href="https://www.tradingview.com/scripts/editors-picks/">Editors’
Picks</a></li>
<li>Scripts by the <a href="https://www.tradingview.com/u/PineCoders/#following-people">authors the PineCoders account
follows</a></li>
<li>Many scripts by authors with high reputation and open-source
publications.</li>
</ul>
<p>Reading code from <a href="https://www.tradingview.com/scripts/">Community
Scripts</a> is easy; if you don’t
see a grey or red “lock” icon in the upper-right corner of the
script’s widget, this indicates the script is open-source. By opening
its script page, you will be able to see its source.</p>
<p>To see the code of TradingView built-ins, load the indicator on your
chart, then hover over its name and select the “Source code” curly
braces icon (if you don’t see it, it’s because the indicator’s source
is unavailable). When you click on the icon, the Pine Editor will open
and from there, you can see the script’s code. If you want to play with
it, you will need to press the “create a working copy” button. You
will then be able to modify and save the code. Because you will have
created a different version of the script, you will need to use the
Editor’s “Add to Chart” button to add that new copy to the chart.</p>
<p>This shows the Pine Editor having just opened after we selected the “View source” button from the indicator on our chart. We are about to create a working copy of its source because it is read-only for now, as indicated by the orange warning text:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1294" loading="lazy" src="images/4eb97ea9d981fc0dfe8d405d56e36149.webp" width="1614"/></div></p>
<p>You can also open TradingView built-in indicators from the Pine Editor
(accessible from the “Pine Editor” tab at the bottom of the chart) by
using the “Open” -&gt; “Built-in script…” menu selection.</p>
<h2 class="md-heading" id="writing-scripts"><a href="#writing-scripts">Writing scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We have built Pine Script™ to empower both budding and seasoned traders
to create their own trading tools. We have designed it so it is
relatively easy to learn for first-time programmers — although
learning a first programming language, like trading, is rarely <strong>very</strong>
easy for anyone — yet powerful enough for knowledgeable programmers to
build tools of moderate complexity.</p>
<p>Pine Script™ allows you to write three types of scripts:</p>
<ul>
<li><strong>Indicators</strong> like RSI, MACD, etc.</li>
<li><strong>Strategies</strong> which include logic to issue trading orders and can
be backtested and forward-tested.</li>
<li><strong>Libraries</strong> which are used by more advanced programmers to package
oft-used functions that can be reused by other scripts.</li>
</ul>
<p>The next step we recommend is to write your
<a href="/pine-script-docs/v5/primer/first-indicator/">first indicator</a>.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/primer/first-indicator"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  First indicator <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/primer/first-steps">Pine Script™ primer</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">First indicator</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="pine-script™-primer-first-indicator"><a href="#first-indicator">First indicator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="the-pine-editor"><a href="#the-pine-editor">The Pine Editor<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The Pine Editor is where you will be working on your scripts. While you
can use any text editor you want to write your Pine scripts, using our
Editor has many advantages:</p>
<ul>
<li>It highlights your code following Pine Script™ syntax.</li>
<li>It pops up syntax reminders when you hover over language constructs.</li>
<li>It provides quick access to the Pine Script™ v5 Reference Manual popup when you <code dir="auto">ctrl</code> / <code dir="auto">cmd</code> + <code dir="auto">click</code> on built-in Pine Script™ constructs, and opens the library publication page when doing the same with construsts imported from libraries.</li>
<li>It provides an auto-complete feature that you can activate with <code dir="auto">ctrl</code> + <code dir="auto">space</code> or <code dir="auto">cmd</code> + <code dir="auto">I</code>, depending on your OS.</li>
<li>It makes the write/compile/run cycle fast because saving a new version of a script loaded on the chart also executes it immediately.</li>
</ul>
<p>To open the Editor, click on the “Pine Editor” tab at the bottom of your TradingView chart. This will open up the Editor’s pane.</p>
<h2 class="md-heading" id="first-version"><a href="#first-version">First version<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We will now create our first working Pine script, an implementation of
the
<a href="https://www.tradingview.com/support/solutions/43000502344-macd-moving-average-convergence-divergence/">MACD</a>
indicator in Pine Script™:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MACD #1")
fast = 12
slow = 26
fastMA = ta.ema(close, fast)
slowMA = ta.ema(close, slow)
macd = fastMA - slowMA
signal = ta.ema(macd, 9)
plot(macd, color = color.blue)
plot(signal, color = color.orange)</code></div>
<ul>
<li>Start by bringing up the “Open” dropdown menu at the top right of the Editor and choose “New indicator”.</li>
<li>Copy the example script above. The button on the top-right of the code widget allows you to do it with a single click.</li>
<li>Select all the code already in the editor and replace it with the example script.</li>
<li>Click “Save” and choose a name for your script. Your script is now saved in TradingView’s cloud, but under your account’s name. Nobody but you can use it.</li>
<li>Click “Add to Chart” in the Editor’s menu bar. The MACD indicator appears in a separate <em>pane</em> under your chart.</li>
</ul>
<p>Your first Pine script is running on your chart, which should look like this:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1360" loading="lazy" src="images/63cc8277fa8c739de0140d5d2a08a0ac.webp" width="1602"/></div></p>
<p>Let’s look at our script’s code, line by line:</p>
<p>Line 1: <code dir="auto">//@version=5</code></p>
<p class="spacer-wrapper"><spacer/> This is a
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation </a> telling the compiler the script will use version 5 of
Pine Script™.</p>
<p>Line 2: <code dir="auto">indicator("MACD #1")</code></p>
<p class="spacer-wrapper"><spacer/>  Defines the name of the script that will appear on the chart as
“MACD”.</p>
<p>Line 3: <code dir="auto">fast = 12</code></p>
<p class="spacer-wrapper"><spacer/> Defines a <code dir="auto">fast</code> integer variable which will be the length of the
fast EMA.</p>
<p>Line 4: <code dir="auto">slow = 26</code></p>
<p class="spacer-wrapper"><spacer/> Defines a <code dir="auto">slow</code> integer variable which will be the length of the
slow EMA.</p>
<p>Line 5: <code dir="auto">fastMA = ta.ema(close, fast)</code></p>
<p class="spacer-wrapper"><spacer/> Defines the variable <code dir="auto">fastMA</code>, containing the result of the EMA
calculation (Exponential Moving Average) with a length equal to
<code dir="auto">fast</code> (12), on the <code dir="auto">close</code> series, i.e., the closing price of bars.</p>
<p>Line 6: <code dir="auto">slowMA = ta.ema(close, slow)</code></p>
<p class="spacer-wrapper"><spacer/> Defines the variable <code dir="auto">slowMA</code>, containing the result of the EMA
calculation with a length equal to <code dir="auto">slow</code> (26), from <code dir="auto">close</code>.</p>
<p>Line 7: <code dir="auto">macd = fastMA - slowMA</code></p>
<p class="spacer-wrapper"><spacer/> Defines the variable <code dir="auto">macd</code> as the difference between the two EMAs.</p>
<p>Line 8: <code dir="auto">signal = ta.ema(macd, 9)</code></p>
<p class="spacer-wrapper"><spacer/> Defines the variable <code dir="auto">signal</code> as a smoothed value of <code dir="auto">macd</code> using
the EMA algorithm (Exponential Moving Average) with a length of 9.</p>
<p>Line 9: <code dir="auto">plot(macd, color = color.blue)</code></p>
<p class="spacer-wrapper"><spacer/> Calls the <code dir="auto">plot</code> function to output the variable <code dir="auto">macd</code> using a blue
line.</p>
<p>Line 10: <code dir="auto">plot(signal, color = color.orange)</code></p>
<p class="spacer-wrapper"><spacer/> Calls the <code dir="auto">plot</code> function to output the variable <code dir="auto">signal</code> using an
orange line.</p>
<h2 class="md-heading" id="second-version"><a href="#second-version">Second version<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The first version of our script calculated MACD “manually”, but
because Pine Script™ is designed to write indicators and strategies,
built-in Pine Script™ functions exist for many common indicators,
including one for MACD:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dmacd">ta.macd()</a>.</p>
<p>This is the second version of our script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MACD #2")
fastInput = input(12, "Fast length")
slowInput = input(26, "Slow length")
[macdLine, signalLine, histLine] = ta.macd(close, fastInput, slowInput, 9)
plot(macdLine, color = color.blue)
plot(signalLine, color = color.orange)</code></div>
<p>Note that we have:</p>
<ul>
<li>Added inputs so we can change the lengths for the MAs</li>
<li>We now use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dmacd">ta.macd()</a>
built-in to calculate our MACD, which saves us three line and makes
our code easier to read.</li>
</ul>
<p>Let’s repeat the same process as before to copy that code in a new
indicator:</p>
<ul>
<li>Start by bringing up the “Open” dropdown menu at the top right of
the Editor and choose “New indicator”.</li>
<li>Then copy the example script above.</li>
<li>Select all the code already in the editor and replace it with the
second version of our script.</li>
<li>Click “Save” and choose a name for your script different than the
previous one.</li>
<li>Click “Add to Chart” in the Editor’s menu bar. The “MACD #2”
indicator appears in a separate <em>pane</em> under the “MACD #1”
indicator.</li>
</ul>
<p>Your second Pine script is running on your chart. If you double-click on
the indicator’s name on your chart, you will bring up the script’s
“Settings/Inputs” tab, where you can now change the slow and fast
lengths:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1360" loading="lazy" src="images/801b7418e0f0b2d1c2a2229c4e57a8cd.webp" width="1602"/></div></p>
<p>Let’s look at the lines that have changed in the second version of our
script:</p>
<p>Line 2: <code dir="auto">indicator("MACD #2")</code></p>
<p class="spacer-wrapper"><spacer/> We have changed <code dir="auto">#1</code> to <code dir="auto">#2</code> so the second version of our indicator
displays a different name on the chart.</p>
<p>Line 3: <code dir="auto">fastInput = input(12, "Fast length")</code></p>
<p class="spacer-wrapper"><spacer/> Instead of assigning a constant value to a variable, we have used
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input">input()</a>
function so we can change the value in our script’s
“Settings/Inputs” tab. <code dir="auto">12</code> will be the default value and the
field’s label will be <code dir="auto">"Fast length"</code>. If the value is changed in
the “Inputs” tab, the <code dir="auto">fastInput</code> variable’s content will contain
the new value and the script will re-execute on the chart with that
new value. Note that, as our Pine Script™
<a href="/pine-script-docs/v5/writing/style-guide/">Style Guide </a>
recommends, we add <code dir="auto">Input</code> to the end of the variable’s name to
remind us, later in the script, that its value comes from a user
input.</p>
<p>Line 4: <code dir="auto">slowInput = input(26, "Slow length")</code></p>
<p class="spacer-wrapper"><spacer/> We do the same for the slow length, taking care to use a different
variable name, default value and text string for the field’s label.</p>
<p>Line 5: <code dir="auto">[macdLine, signalLine, histLine] = ta.macd(close, fastInput, slowInput, 9)</code></p>
<p class="spacer-wrapper"><spacer/> This is where we call the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dmacd">ta.macd()</a>
built-in to perform all the first version’s calculations in one
line only. The function requires four parameters (the values after
the function name, enclosed in parentheses). It returns three values
into the three variables instead of only one, like the functions we
used until now, which is why we need to enclose the list of three
variables receiving the function’s result in square brackets, to
the left of the <code dir="auto">=</code> sign. Note that two of the values we pass to the
function are the “input” variables containing the fast and slow
lengths: <code dir="auto">fastInput</code> and <code dir="auto">slowInput</code>.</p>
<p>Line 6 and 7:</p>
<p class="spacer-wrapper"><spacer/> The variable names we are plotting there have changed, but the lines
are doing the same thing as in our first version.</p>
<p>Our second version performs the same calculations as our first, but we
can change the two lengths used to calculate it. Our code is also
simpler and shorter by three lines. We have improved our script.</p>
<h2 class="md-heading" id="next"><a href="#next">Next<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We now recommend you go to our
<a href="/pine-script-docs/v5/primer/next-steps/">Next Steps </a> page.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/primer/first-steps"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> First steps  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/primer/next-steps"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Next steps <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/primer/first-steps">Pine Script™ primer</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Next steps</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="pine-script™-primer-next-steps"><a href="#next-steps">Next steps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>After your <a href="/pine-script-docs/v5/primer/first-steps/">first steps</a>
and your <a href="/pine-script-docs/v5/primer/first-indicator/">first indicator</a>, let us explore a bit more of the Pine Script™ landscape by
sharing some pointers to guide you in your journey to learn Pine
Script™.</p>
<h2 class="md-heading" id="indicators-vs-strategies"><a href="#indicators-vs-strategies">“indicators” vs “strategies”<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ <a href="/pine-script-docs/v5/concepts/strategies/">strategies</a>
are used to backtest on historical data and forward test on open
markets. In addition to indicator calculations, they contain
<code dir="auto">strategy.*()</code> calls to send trade orders to Pine Script™‘s broker
emulator, which can then simulate their execution. Strategies display
backtest results in the “Strategy Tester” tab at the bottom of the
chart, next to the “Pine Editor” tab.</p>
<p>Pine Script™ indicators also contain calculations, but cannot be used in
backtesting. Because they do not require the broker emulator, they use
less resources and will run faster. It is thus advantageous to use
indicators whenever you can.</p>
<p>Both indicators and strategies can run in either overlay mode (over the
chart’s bars) or pane mode (in a separate section below or above the
chart). Both can also plot information in their respective space, and
both can generate <a href="/pine-script-docs/v5/concepts/alerts/">alert events</a>.</p>
<h2 class="md-heading" id="how-scripts-are-executed"><a href="#how-scripts-are-executed">How scripts are executed<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A Pine script is <strong>not</strong> like programs in many programming languages
that execute once and then stop. In the Pine Script™ <em>runtime</em>
environment, a script runs in the equivalent of an invisible loop where
it is executed once on each bar of whatever chart you are on, from left
to right. Chart bars that have already closed when the script executes
on them are called <em>historical bars</em>. When execution reaches the
chart’s last bar and the market is open, it is on the <em>realtime bar</em>.
The script then executes once every time a price or volume change is
detected, and one last time for that realtime bar when it closes. That
realtime bar then becomes an <em>elapsed realtime bar</em>. Note that when the
script executes in realtime, it does not recalculate on all the chart’s
historical bars on every price/volume update. It has already calculated
once on those bars, so it does not need to recalculate them on every
chart tick. See the
<a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>
page for more information.</p>
<p>When a script executes on a historical bar, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
built-in variable holds the value of that bar’s close. When a script
executes on the realtime bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
returns the <strong>current</strong> price of the symbol until the bar closes.</p>
<p>Contrary to indicators, strategies normally execute only once on
realtime bars, when they close. They can also be configured to execute
on each price/volume update if that is what you need. See the page on
<a href="/pine-script-docs/v5/concepts/strategies/">Strategies</a> for more
information, and to understand how strategies calculate differently than
indicators.</p>
<h2 class="md-heading" id="time-series"><a href="#time-series">Time series<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The main data structure used in Pine Script™ is called a
<a href="/pine-script-docs/v5/language/time-series/">time series</a>. Time
series contain one value for each bar the script executes on, so they
continuously expand as the script executes on more bars. Past values of
the time series can be referenced using the history-referencing
operator:
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>.
<code dir="auto">close[1]</code>, for example, refers to the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
on the bar preceding the one where the script is executing.</p>
<p>While this indexing mechanism may remind many programmers of arrays, a
time series is different and thinking in terms of arrays will be
detrimental to understanding this key Pine Script™ concept. A good
comprehension of both the
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and
<a href="/pine-script-docs/v5/language/time-series/">time series</a> is
essential in understanding how Pine scripts work. If you have never
worked with data organized in time series before, you will need practice
to put them to work for you. Once you familiarize yourself with these
key concepts, you will discover that by combining the use of time series
with our built-in functions specifically designed to handle them
efficiently, much can be accomplished in very few lines of code.</p>
<h2 class="md-heading" id="publishing-scripts"><a href="#publishing-scripts">Publishing scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView is home to a large community of Pine Script™ programmers and
millions of traders from all around the world. Once you become
proficient enough in Pine Script™, you can choose to share your scripts
with other traders. Before doing so, please take the time to learn Pine
Script™ well-enough to supply traders with an original and reliable
tool. All publicly published scripts are analyzed by our team of
moderators and must comply with our <a href="https://www.tradingview.com/support/solutions/43000590599">Script Publishing
Rules</a>, which
require them to be original and well-documented.</p>
<p>If want to use Pine scripts for your own use, simply write them in the
Pine Editor and add them to your chart from there; you don’t have to
publish them to use them. If you want to share your scripts with just a
few friends, you can publish them privately and send your friends the
browser’s link to your private publication. See the page on
<a href="/pine-script-docs/v5/writing/publishing/">Publishing</a> for more
information.</p>
<h2 class="md-heading" id="getting-around-the-pine-script-documentation"><a href="#getting-around-the-pine-script-documentation">Getting around the Pine Script™ documentation<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>While reading code from published scripts is no doubt useful, spending
time in our documentation will be necessary to attain any degree of
proficiency in Pine Script™. Our two main sources of documentation on
Pine Script™ are:</p>
<ul>
<li>This Pine Script™ <a href="/pine-script-docs/v5/welcome/">v5 User
Manual</a></li>
<li>Our Pine Script™ <a href="https://www.tradingview.com/pine-script-reference/v5/">v5 Reference
Manual</a></li>
</ul>
<p>The Pine Script™ <a href="/pine-script-docs/v5/welcome/">v5 User Manual</a>, which is located on its separate page and in English only.</p>
<p>The Pine Script™ <a href="https://www.tradingview.com/pine-script-reference/v5/">v5 Reference
Manual</a> documents
what each language construct does. It is an essential tool
for all Pine Script™ programmers; your life will be miserable if you try
to write scripts of any reasonable complexity without consulting it. It
exists in two formats: a separate page linked above, and the popup
version, which can be accessed from the Pine Editor, by either
<code dir="auto">ctrl</code> / <code dir="auto">cmd</code> + <code dir="auto">clicking</code> on a keyword, or by using the Editor’s “More/Reference Manual…” menu. The Reference Manual is translated in other
languages.</p>
<p>There are five different versions of Pine Script™. Ensure the
documentation you use corresponds to the Pine Script™ version you are
coding with.</p>
<h2 class="md-heading" id="where-to-go-from-here"><a href="#where-to-go-from-here">Where to go from here?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This Pine Script™ <a href="/pine-script-docs/v5/welcome/">v5 User Manual</a> contains numerous examples of code used to illustrate the concepts we discuss. By going through it, you will be able to both learn the
foundations of Pine Script™ and study the example scripts. Reading about
key concepts and trying them out right away with real code is a
productive way to learn any programming language. As you hopefully have
already done in the
<a href="/pine-script-docs/v5/primer/first-indicator/">First indicator</a>
page, copy this documentation’s examples in the Editor and play with
them. Explore! You won’t break anything.</p>
<p>This is how the Pine Script™ <a href="/pine-script-docs/v5/welcome/">v5 User Manual</a> you are reading is organized:</p>
<ul>
<li>The <a href="/pine-script-docs/v5/language/">Language</a> section
explains the main components of the Pine Script™ language and how
scripts execute.</li>
<li>The <a href="/pine-script-docs/v5/concepts/">Concepts</a> section
is more task-oriented. It explains how to do things in Pine Script™.</li>
<li>The <a href="/pine-script-docs/v5/writing/">Writing</a> section
explores tools and tricks that will help you write and publish
scripts.</li>
<li>The <a href="/pine-script-docs/v5/faq/">FAQ</a> section answers
common questions from Pine Script™ programmers.</li>
<li>The <a href="/pine-script-docs/v5/error-messages/">Error messages</a> page documents causes and fixes for the most common
runtime and compiler errors.</li>
<li>The <a href="/pine-script-docs/v5/release-notes/">Release Notes</a>
page is where you can follow the frequent updates to Pine Script™.</li>
<li>The <a href="/pine-script-docs/v5/migration-guides/">Migration guides</a> section explains how to port between different versions
of Pine Script™.</li>
<li>The
<a href="/pine-script-docs/v5/where-can-i-get-more-information/">Where can I get more information</a> page lists other useful Pine Script™-related content,
including where to ask questions when you are stuck on code.</li>
</ul>
<p>We wish you a successful journey with Pine Script™… and trading!</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/primer/first-indicator"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> First indicator  </h4> </a> <span data-astro-cid-xgirumru=""></span> </div> </main><h1>Language</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Execution model</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-execution-model"><a href="#execution-model">Execution model<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>The execution model of the Pine Script™ runtime is intimately linked to
Pine Script™‘s <a href="/pine-script-docs/v5/language/time-series/">time series</a> and <a href="/pine-script-docs/v5/language/type-system/">type system</a>. Understanding all three is key to making the most of the
power of Pine Script™.</p>
<p>The execution model determines how your script is executed on charts,
and thus how the code you write in scripts works. Your code would do
nothing were it not for Pine Script™‘s runtime, which kicks in after
your code has compiled and it is executed on your chart because one of
the
<a href="/pine-script-docs/v5/language/execution-model/#events-triggering-the-execution-of-a-script">events triggering the execution of a script</a> has occurred.</p>
<p>When a Pine script is loaded on a chart it executes once on each
historical bar using the available OHLCV (open, high, low, close,
volume) values for each bar. Once the script’s execution reaches the
rightmost bar in the dataset, if trading is currently active on the
chart’s symbol, then Pine Script™ <em>indicators</em> will execute once every
time an <em>update</em> occurs, i.e., price or volume changes. Pine Script™
<em>strategies</em> will by default only execute when the rightmost bar closes,
but they can also be configured to execute on every update, like
indicators do.</p>
<p>All symbol/timeframe pairs have a dataset comprising a limited number of
bars. When you scroll a chart to the left to see the dataset’s earlier
bars, the corresponding bars are loaded on the chart. The loading
process stops when there are no more bars for that particular
symbol/timeframe pair or the <a href="/pine-script-docs/v5/writing/limitations/#chart-bars">maximum number of
bars</a>
your account type permits has been loaded. You can scroll the chart to
the left until the very first bar of the dataset, which has an index
value of 0 (see
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>).</p>
<p>When the script first runs on a chart, all bars in a dataset are
<em>historical bars</em>, except the rightmost one if a trading session is
active. When trading is active on the rightmost bar, it is called the
<em>realtime bar</em>. The realtime bar updates when a price or volume change
is detected. When the realtime bar closes, it becomes an <em>elapsed
realtime bar</em> and a new realtime bar opens.</p>
<h2 class="md-heading" id="calculation-based-on-historical-bars"><a href="#calculation-based-on-historical-bars">Calculation based on historical bars<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Let’s take a simple script and follow its execution on historical bars:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script", overlay = true)
src = close
a = ta.sma(src, 5)
b = ta.sma(src, 50)
c = ta.cross(a, b)
plot(a, color = color.blue)
plot(b, color = color.black)
plotshape(c, color = color.red)</code></div>
<p>On historical bars, a script executes at the equivalent of the bar’s
close, when the OHLCV values are all known for that bar. Prior to
execution of the script on a bar, the built-in variables such as <code dir="auto">open</code>,
<code dir="auto">high</code>, <code dir="auto">low</code>, <code dir="auto">close</code>, <code dir="auto">volume</code> and <code dir="auto">time</code> are set to values
corresponding to those from that bar. A script executes <strong>once per
historical bar</strong>.</p>
<p>Our example script is first executed on the very first bar of the
dataset at index 0. Each statement is executed using the values for the
current bar. Accordingly, on the first bar of the dataset, the following
statement:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">src = close</code></div>
<p>initializes the variable <code dir="auto">src</code> with the <code dir="auto">close</code> value for that first
bar, and each of the next lines is executed in turn. Because the script
only executes once for each historical bar, the script will always
calculate using the same <code dir="auto">close</code> value for a specific historical bar.</p>
<p>The execution of each line in the script produces calculations which in
turn generate the indicator’s output values, which can then be plotted
on the chart. Our example uses the <code dir="auto">plot</code> and <code dir="auto">plotshape</code> calls at the
end of the script to output some values. In the case of a strategy, the
outcome of the calculations can be used to plot values or dictate the
orders to be placed.</p>
<p>After execution and plotting on the first bar, the script is executed on
the dataset’s second bar, which has an index of 1. The process then
repeats until all historical bars in the dataset are processed and the
script reaches the rightmost bar on the chart.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="800" loading="lazy" src="images/1f6fc7c3c785c2ad1ea59519a77cda62.webp" width="1600"/></div></p>
<h2 class="md-heading" id="calculation-based-on-realtime-bars"><a href="#calculation-based-on-realtime-bars">Calculation based on realtime bars<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The behavior of a Pine script on the realtime bar is very different than
on historical bars. Recall that the realtime bar is the rightmost bar on
the chart when trading is active on the chart’s symbol. Also, recall
that strategies can behave in two different ways in the realtime bar. By
default, they only execute when the realtime bar closes, but the
<code dir="auto">calc_on_every_tick</code> parameter of the <code dir="auto">strategy</code> declaration statement
can be set to true to modify the strategy’s behavior so that it
executes each time the realtime bar updates, as indicators do. The
behavior described here for indicators will thus only apply to
strategies using <code dir="auto">calc_on_every_tick=true</code>.</p>
<p>The most important difference between execution of scripts on historical
and realtime bars is that while they execute only once on historical
bars, scripts execute every time an update occurs during a realtime bar.
This entails that built-in variables such as <code dir="auto">high</code>, <code dir="auto">low</code> and <code dir="auto">close</code>
which never change on a historical bar, <strong>can</strong> change at each of a
script’s iteration in the realtime bar. Changes in the built-in
variables used in the script’s calculations will, in turn, induce
changes in the results of those calculations. This is required for the
script to follow the realtime price action. As a result, the same script
may produce different results every time it executes during the realtime
bar.</p>
<p><strong>Note:</strong> In the realtime bar, the <code dir="auto">close</code> variable always represents
the <strong>current price</strong>. Similarly, the <code dir="auto">high</code> and <code dir="auto">low</code> built-in
variables represent the highest high and lowest low reached since the
realtime bar’s beginning. Pine Script™‘s built-in variables will only
represent the realtime bar’s final values on the bar’s last update.</p>
<p>Let’s follow our script example in the realtime bar.</p>
<p>When the script arrives on the realtime bar it executes a first time. It
uses the current values of the built-in variables to produce a set of
results and plots them if required. Before the script executes another
time when the next update happens, its user-defined variables are reset
to a known state corresponding to that of the last <em>commit</em> at the close
of the previous bar. If no commit was made on the variables because they
are initialized every bar, then they are reinitialized. In both cases
their last calculated state is lost. The state of plotted labels and
lines is also reset. This resetting of the script’s user-defined
variables and drawings prior to each new iteration of the script in the
realtime bar is called <em>rollback</em>. Its effect is to reset the script to
the same known state it was in when the realtime bar opened, so
calculations in the realtime bar are always performed from a clean
state.</p>
<p>The constant recalculation of a script’s values as price or volume
changes in the realtime bar can lead to a situation where variable <code dir="auto">c</code>
in our example becomes true because a cross has occurred, and so the red
marker plotted by the script’s last line would appear on the chart. If
on the next price update the price has moved in such a way that the
<code dir="auto">close</code> value no longer produces calculations making <code dir="auto">c</code> true because
there is no longer a cross, then the marker previously plotted will
disappear.</p>
<p>When the realtime bar closes, the script executes a last time. As usual,
variables are rolled back prior to execution. However, since this
iteration is the last one on the realtime bar, variables are committed
to their final values for the bar when calculations are completed.</p>
<p>To summarize the realtime bar process:</p>
<ul>
<li>A script executes <strong>at the open of the realtime bar and then once per update</strong>.</li>
<li>Variables are rolled back <strong>before every realtime update</strong>.</li>
<li>Variables are committed <strong>once at the closing bar update</strong>.</li>
</ul>
<h2 class="md-heading" id="events-triggering-the-execution-of-a-script"><a href="#events-triggering-the-execution-of-a-script">Events triggering the execution of a script<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A script is executed on the complete set of bars on the chart when one
of the following events occurs:</p>
<ul>
<li>A new symbol or timeframe is loaded on a chart.</li>
<li>A script is saved or added to the chart, from the Pine Script™ Editor or the chart’s “Indicators &amp; strategies” dialog box.</li>
<li>A value is modified in the script’s “Settings/Inputs” dialog box.</li>
<li>A value is modified in a strategy’s “Settings/Properties” dialog box.</li>
<li>A browser refresh event is detected.</li>
</ul>
<p>A script is executed on the realtime bar when trading is active and:</p>
<ul>
<li>One of the above conditions occurs, causing the script to execute on the open of the realtime bar, or</li>
<li>The realtime bar updates because a price or volume change was detected.</li>
</ul>
<p>Note that when a chart is left untouched when the market is active, a
succession of realtime bars which have been opened and then closed will
trail the current realtime bar. While these <em>elapsed realtime bars</em> will
have been <em>confirmed</em> because their variables have all been committed,
the script will not yet have executed on them in their <em>historical</em>
state, since they did not exist when the script was last run on the
chart’s dataset.</p>
<p>When an event triggers the execution of the script on the chart and
causes it to run on those bars which have now become historical bars,
the script’s calculation can sometimes vary from what they were when
calculated on the last closing update of the same bars when they were
realtime bars. This can be caused by slight variations between the OHLCV
values saved at the close of realtime bars and those fetched from data
feeds when the same bars have become historical bars. This behavior is
one of the possible causes of <em>repainting</em>.</p>
<h2 class="md-heading" id="more-information"><a href="#more-information">More information<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<ul>
<li>The built-in <code dir="auto">barstate.*</code> variables provide information on
<a href="/pine-script-docs/v5/concepts/bar-states/">the type of bar or the event</a> where the script is executing. The page where they are
documented also contains a script that allows you to visualize the
difference between elapsed realtime and historical bars, for
example.</li>
<li>The <a href="/pine-script-docs/v5/concepts/strategies/">Strategies</a> page
explains the details of strategy calculations, which are not
identical to those of indicators.</li>
</ul>
<h2 class="md-heading" id="historical-values-of-functions"><a href="#historical-values-of-functions">Historical values of functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Every function call in Pine leaves a trail of historical values that a
script can access on subsequent bars using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator. The historical series of functions depend on successive calls
to record the output on every bar. When a script does not call functions
on each bar, it can produce an inconsistent history that may impact
calculations and results, namely when it depends on the continuity of
their historical series to operate as expected. The compiler warns users
in these cases to make them aware that the values from a function,
whether built-in or user-defined, might be misleading.</p>
<p>To demonstrate, let’s write a script that calculates the index of the
current bar and outputs that value on every second bar. In the following
script, we’ve defined a <code dir="auto">calcBarIndex()</code> function that adds 1 to the
previous value of its internal <code dir="auto">index</code> variable on every bar. The script
calls the function on each bar that the <code dir="auto">condition</code> returns <code dir="auto">true</code> on
(every other bar) to update the <code dir="auto">customIndex</code> value. It plots this value
alongside the built-in <code dir="auto">bar_index</code> to validate the output:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="836" loading="lazy" src="images/66c619b23db8002af420431685b50557.webp" width="1712"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My script")

//@function Calculates the index of the current bar by adding 1 to its own value from the previous bar.
// The first bar will have an index of 0.
calcBarIndex() =&gt;
    int index = na
    index := nz(index[1], replacement = -1) + 1

//@variable Returns `true` on every other bar.
condition = bar_index % 2 == 0

int customIndex = na

// Call `calcBarIndex()` when the `condition` is `true`. This prompts the compiler to raise a warning.
if condition
    customIndex := calcBarIndex()

plot(bar_index,   "Bar index",    color = color.green)
plot(customIndex, "Custom index", color = color.red, style = plot.style_cross)</code></div>
<p><strong>Note that:</strong></p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a>
function replaces
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values with a specified <code dir="auto">replacement</code> value (0 by default). On the
first bar of the script, when the <code dir="auto">index</code> series has no history, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
value is replaced with -1 before adding 1 to return an initial value
of 0.</li>
</ul>
<p>Upon inspecting the chart, we see that the two plots differ wildly. The
reason for this behavior is that the script called <code dir="auto">calcBarIndex()</code>
within the scope of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure on every other bar, resulting in a historical output
inconsistent with the <code dir="auto">bar_index</code> series. When calling the function once
every two bars, internally referencing the previous value of <code dir="auto">index</code>
gets the value from two bars ago, i.e., the last bar the function
executed on. This behavior results in a <code dir="auto">customIndex</code> value of half that
of the built-in <code dir="auto">bar_index</code>.</p>
<p>To align the <code dir="auto">calcBarIndex()</code> output with the <code dir="auto">bar_index</code>, we can move
the function call to the script’s global scope. That way, the function
will execute on every bar, allowing its entire history to be recorded
and referenced rather than only the results from every other bar. In the
code below, we’ve defined a <code dir="auto">globalScopeBarIndex</code> variable in the
global scope and assigned it to the return from <code dir="auto">calcBarIndex()</code> rather
than calling the function locally. The script sets the <code dir="auto">customIndex</code> to
the value of <code dir="auto">globalScopeBarIndex</code> on the occurrence of the <code dir="auto">condition</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="836" loading="lazy" src="images/c8042290d94f1ba4334ffc85ae71d231.webp" width="1712"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My script")

//@function Calculates the index of the current bar by adding 1 to its own value from the previous bar.
// The first bar will have an index of 0.
calcBarIndex() =&gt;
    int index = na
    index := nz(index[1], replacement = -1) + 1

//@variable Returns `true` on every second bar.
condition = bar_index % 2 == 0

globalScopeBarIndex = calcBarIndex()
int customIndex = na

// Assign `customIndex` to `globalScopeBarIndex` when the `condition` is `true`. This won't produce a warning.
if condition
    customIndex := globalScopeBarIndex

plot(bar_index,   "Bar index",    color = color.green)
plot(customIndex, "Custom index", color = color.red, style = plot.style_cross)</code></div>
<p>This behavior can also radically impact built-in functions that
reference history internally. For example, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>
function references its past values “under the hood”. If a script
calls this function conditionally rather than on every bar, the values
within the calculation can change significantly. We can ensure
calculation consistency by assigning
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>
to a variable in the global scope and referencing that variable’s
history as needed.</p>
<p>The following example calculates three SMA series: <code dir="auto">controlSMA</code>,
<code dir="auto">localSMA</code>, and <code dir="auto">globalSMA</code>. The script calculates <code dir="auto">controlSMA</code> in the
global scope and <code dir="auto">localSMA</code> within the local scope of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure. Within the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure, it also updates the value of <code dir="auto">globalSMA</code> using the
<code dir="auto">controlSMA</code> value. As we can see, the values from the <code dir="auto">globalSMA</code> and
<code dir="auto">controlSMA</code> series align, whereas the <code dir="auto">localSMA</code> series diverges from
the other two because it uses an incomplete history, which affects its
calculations:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="836" loading="lazy" src="images/2191444e1bcbcd179ee10fcb8565da1f.webp" width="1712"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My script")

//@variable Returns `true` on every second bar.
condition = bar_index % 2 == 0

controlSMA = ta.sma(close, 20)
float globalSMA = na
float localSMA  = na

// Update `globalSMA` and `localSMA` when `condition` is `true`.
if condition
    globalSMA := controlSMA        // No warning.
    localSMA  := ta.sma(close, 20) // Raises warning. This function depends on its history to work as intended.

plot(controlSMA, "Control SMA", color = color.green)
plot(globalSMA,  "Global SMA",  color = color.blue, style = plot.style_cross)
plot(localSMA,   "Local SMA",   color = color.red,  style = plot.style_cross)</code></div>
<h3 class="md-heading" id="why-this-behavior"><a href="#why-this-behavior">Why this behavior?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This behavior is required because forcing the execution of functions on
each bar would lead to unexpected results in those functions that
produce side effects, i.e., the ones that do something aside from
returning the value. For example, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
function creates a label on the chart, so forcing it to be called on
every bar even when it is inside of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure would create labels where they should not logically appear.</p>
<h3 class="md-heading" id="exceptions"><a href="#exceptions">Exceptions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Not all built-in functions use their previous values in their
calculations, meaning not all require execution on every bar. For
example,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dmax">math.max()</a>
compares all arguments passed into it to return the highest value. Such
functions that do not interact with their history in any way do not
require special treatment.</p>
<p>If the usage of a function within a conditional block does not cause a
compiler warning, it’s safe to use without impacting calculations.
Otherwise, move the function call to the global scope to force
consistent execution. When keeping a function call within a conditional
block despite the warning, ensure the output is correct at the very
least to avoid unexpected results.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/time-series"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Time series <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Time series</span> </div> </div> <div data-astro-cid-xgirumru="" data-toc-hidden="" id="slot-container"> <h1 class="md-heading" id="language-time-series"><a href="#time-series">Time series<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>Much of the power of Pine Script™ stems from the fact that it is
designed to process <em>time series</em> efficiently. Time series are not a
qualified type; they are the fundamental structure Pine Script™ uses to
store the successive values of a variable over time, where each value is
tethered to a point in time. Since charts are composed of bars, each
representing a particular point in time, time series are the ideal data
structure to work with values that may change with time.</p>
<p>The notion of time series is intimately linked to Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and
<a href="/pine-script-docs/v5/language/type-system/">type system</a> concepts.
Understanding all three is key to making the most of the power of Pine
Script™.</p>
<p>Take the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
variable, which contains the “open” price of each bar in the dataset,
the <em>dataset</em> being all the bars on any given chart. If your script is
running on a 5min chart, then each value in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
time series is the “open” price of the consecutive 5min chart bars.
When your script refers to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
it is referring to the “open” price of the bar the script is executing
on. To refer to past values in a time series, we use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
history-referencing operator. When a script is executing on a given bar,
<code dir="auto">open[1]</code> refers to the value of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
time series on the previous bar.</p>
<p>While time series may remind programmers of arrays, they are totally
different. Pine Script™ does use an array data structure, but it is a
completely different concept than a time series.</p>
<p>Time series in Pine Script™, combined with its special type of runtime
engine and built-in functions, are what makes it easy to compute the
cumulative total of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values without using a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop, with only <code dir="auto">ta.cum(close)</code>. This is possible because although
<code dir="auto">ta.cum(close)</code> appears rather static in a script, it is in fact
executed on each bar, so its value becomes increasingly larger as the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value of each new bar is added to it. When the script reaches the
rightmost bar of the chart, <code dir="auto">ta.cum(close)</code> returns the sum of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value from all bars on the chart.</p>
<p>Similarly, the mean of the difference between the last 14
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values can be expressed as <code dir="auto">ta.sma(high - low, 14)</code>, or the distance in
bars since the last time the chart made five consecutive higher highs as
<code dir="auto">barssince(rising(high, 5))</code>.</p>
<p>Even the result of function calls on successive bars leaves a trace of
values in a time series that can be referenced using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
history-referencing operator. This can be useful, for example, when
testing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
of the current bar for a breach of the highest
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
in the last 10 bars, but excluding the current bar, which we could write
as <code dir="auto">breach = close &gt; highest(close, 10)[1]</code>. The same statement could
also be written as <code dir="auto">breach = close &gt; highest(close[1], 10)</code>.</p>
<p>The same looping logic on all bars is applied to function calls such as
<code dir="auto">plot(open)</code> which will repeat on each bar, successively plotting on the
chart the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">open</a>
for each bar.</p>
<p>Do not confuse “time series” with the “series” qualifier. The <em>time
series</em> concept explains how consecutive values of variables are stored
in Pine Script™; the “series” qualifier denotes variables whose values
can change bar to bar. Consider, for example, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>
built-in variable which has the “simple” qualifier and “string”
type, meaning it is of the “simple string” qualified type. The
“simple” qualifier entails that the variable’s value is established
on bar zero (the first bar where the script executes) and will not
change during the script’s execution on any of the chart’s bars. The
variable’s value is the chart’s timeframe in string format, so <code dir="auto">"D"</code>
for a 1D chart, for example. Even though its value cannot change during
the script, it would be syntactically correct in Pine Script™ (though
not very useful) to refer to its value 10 bars ago using
<code dir="auto">timeframe.period[10]</code>. This is possible because the successive values
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>
for each bar are stored in a time series, even though all the values in
that particular time series are the same. Note, however, that when the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator is used to access past values of a variable, it yields a
“series” qualified value, even when the variable without an offset
uses a different qualifier, such as “simple” in the case of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>.</p>
<p>When you grasp how time series can be efficiently handled using Pine
Script™‘s syntax and its
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a>,
you can define complex calculations using little code.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/execution-model"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Execution model  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/script-structure"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Script structure <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Script structure</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-script-structure"><a href="#script-structure">Script structure<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>A Pine script follows this general structure:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;version&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;declaration_statement&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;code&gt;</span></div></div></code></pre></figure></link></div>
<h2 class="md-heading" id="version"><a href="#version">Version<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation</a> in the following form tells the compiler which of the
versions of Pine Script™ the script is written in:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5</code></div>
<ul>
<li>The version number can be 1 to 5.</li>
<li>The compiler annotation is not mandatory. When omitted, version 1 is
assumed. It is strongly recommended to always use the latest version
of the language.</li>
<li>While it is synctactically correct to place the version compiler
annotation anywhere in the script, it is much more useful to readers
when it appears at the top of the script.</li>
</ul>
<p>Notable changes to the current version of Pine Script™ are documented in
the <a href="/pine-script-docs/v5/release-notes/">Release notes</a>.</p>
<h2 class="md-heading" id="declaration-statement"><a href="#declaration-statement">Declaration statement<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>All Pine scripts must contain one declaration statement, which is a call
to one of these functions:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a></li>
</ul>
<p>The declaration statement:</p>
<ul>
<li>Identifies the type of the script, which in turn dictates which
content is allowed in it, and how it can be used and executed.</li>
<li>Sets key properties of the script such as its name, where it will
appear when it is added to a chart, the precision and format of the
values it displays, and certain values that govern its runtime
behavior, such as the maximum number of drawing objects it will
display on the chart. With strategies, the properties include
parameters that control backtesting, such as initial capital,
commission, slippage, etc.</li>
</ul>
<p>Each type of script has distinct requirements:</p>
<ul>
<li>Indicators must contain at least one function call which produces
output on the chart (e.g.,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line%7Bdot%7Dnew">line.new()</a>,
etc.).</li>
<li>Strategies must contain at least one <code dir="auto">strategy.*()</code> call, e.g.,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a>.</li>
<li>Libraries must contain at least one exported
<a href="/pine-script-docs/v5/concepts/libraries/#library-functions">function</a>
or <a href="/pine-script-docs/v5/concepts/libraries/#user-defined-types-and-objects">user-defined type</a>.</li>
</ul>
<h2 class="md-heading" id="code"><a href="#code">Code<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Lines in a script that are not
<a href="/pine-script-docs/v5/language/script-structure/#comments">comments</a>
or
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotations</a> are <em>statements</em>, which implement the script’s algorithm. A
statement can be one of these:</p>
<ul>
<li><a href="/pine-script-docs/v5/language/variable-declarations/">variable declaration</a></li>
<li><a href="/pine-script-docs/v5/language/variable-declarations/#variable-reassignment">variable reassignment</a></li>
<li><a href="/pine-script-docs/v5/language/user-defined-functions/#multi-line-functions">function declaration</a></li>
<li><a href="/pine-script-docs/v5/language/built-ins/#built-in-functions">built-in function call</a>,
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function call</a> or
<a href="/pine-script-docs/v5/concepts/libraries/#using-a-library">a library function call</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a>, or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_enum">enum</a>
<em>structure</em>.</li>
</ul>
<p>Statements can be arranged in multiple ways:</p>
<ul>
<li>Some statements can be expressed in one line, like most variable
declarations, lines containing only a function call or single-line
function declarations. Lines can also be
<a href="/pine-script-docs/v5/language/script-structure/#line-wrapping">wrapped</a> (continued on multiple lines). Multiple one-line
statements can be concatenated on a single line by using the comma
as a separator.</li>
<li>Others statements such as structures or multi-line function
declarations always require multiple lines because they require a
<em>local block</em>. A local block must be indented by a tab or four
spaces. Each local block defines a distinct <em>local scope</em>.</li>
<li>Statements in the <em>global scope</em> of the script (i.e., which are not
part of local blocks) cannot begin with white space (a space or a
tab). Their first character must also be the line’s first
character. Lines beginning in a line’s first position become by
definition part of the script’s <em>global scope</em>.</li>
</ul>
<p>A simple valid Pine Script™ v5 indicator can be generated in the Pine
Script™ Editor by using the “Open” button and choosing “New blank
indicator”:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
plot(close)</code></div>
<p>This indicator includes three local blocks, one in the <code dir="auto">barIsUp()</code> function
declaration, and two in the variable declaration using an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

indicator("", "", true)    // Declaration statement (global scope)

barIsUp() =&gt;    // Function declaration (global scope)
    close &gt; open    // Local block (local scope)

plotColor = if barIsUp()  // Variable declaration (global scope)
    color.green     // Local block (local scope)
else
    color.red       // Local block (local scope)

bgcolor(color.new(plotColor, 70))   // Call to a built-in function  (global scope)</code></div>
<p>You can bring up a simple Pine Script™ v5 strategy by selecting “New
blank strategy” instead:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("My Strategy", overlay=true, margin_long=100, margin_short=100)

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))
if (longCondition)
    strategy.entry("My Long Entry Id", strategy.long)

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))
if (shortCondition)
    strategy.entry("My Short Entry Id", strategy.short)</code></div>
<h2 class="md-heading" id="comments"><a href="#comments">Comments<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Double slashes (<code dir="auto">//</code>) define comments in Pine Script™. Comments can
begin anywhere on the line. They can also follow Pine Script™ code on
the same line:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
// This line is a comment
a = close // This is also a comment
plot(a)</code></div>
<p>The Pine Editor has a keyboard shortcut to comment/uncomment lines:
<code dir="auto">ctrl</code> + <code dir="auto">/</code>. You can use it on multiple lines by highlighting them
first.</p>
<h2 class="md-heading" id="line-wrapping"><a href="#line-wrapping">Line wrapping<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Long lines can be split on multiple lines, or “wrapped”. Wrapped lines
must be indented with any number of spaces, provided it’s not a
multiple of four (those boundaries are used to indent local blocks):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = open + high + low + close</code></div>
<p>may be wrapped as:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = open +
      high +
          low +
             close</code></div>
<p>A long
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call may be wrapped as:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(ta.correlation(src, ovr, length),
   color = color.new(color.purple, 40),
   style = plot.style_area,
   trackprice = true)</code></div>
<p>Statements inside user-defined function declarations can also be
wrapped. However, since a local block must syntactically begin with an
indentation (4 spaces or 1 tab), when splitting it onto the following
line, the continuation of the statement must start with more than one
indentation (not equal to a multiple of four spaces). For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">updown(s) =&gt;
    isEqual = s == s[1]
    isGrowing = s &gt; s[1]
    ud = isEqual ?
           0 :
           isGrowing ?
               (nz(ud[1]) &lt;= 0 ?
                     1 :
                   nz(ud[1])+1) :
               (nz(ud[1]) &gt;= 0 ?
                   -1 :
                   nz(ud[1])-1)</code></div>
<p>You can use comments in wrapped lines:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
c = open &gt; close ? color.red :
  high &gt; high[1] ? color.lime : // A comment
  low &lt; low[1] ? color.blue : color.black
bgcolor(c)</code></div>
<h2 class="md-heading" id="compiler-annotations"><a href="#compiler-annotations">Compiler annotations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Compiler annotations are
<a href="/pine-script-docs/v5/language/script-structure/#comments">comments</a>
that issue special instructions for a script:</p>
<ul>
<li><code dir="auto">//@version=</code> specifies the PineScript™ version that the compiler
will use. The number in this annotation should not be confused with
the script’s version number, which updates on every saved change
to the code.</li>
<li><code dir="auto">//@description</code> sets a custom description for scripts that use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>
declaration statement.</li>
<li><code dir="auto">//@function</code>, <code dir="auto">//@param</code> and <code dir="auto">//@returns</code> add custom descriptions
for a <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> or <a href="/pine-script-docs/v5/language/methods/">method</a>, its parameters, and its result when placed above the function declaration.</li>
<li><code dir="auto">//@type</code> adds a custom description for a <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a> when placed
above the type declaration.</li>
<li><code dir="auto">//@enum</code> adds a custom description for an <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a> when placed above the enum declaration.</li>
<li><code dir="auto">//@field</code> adds a custom description for the field of a <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a> or an <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a> when placed above the type or enum declaration.</li>
<li><code dir="auto">//@variable</code> adds a custom description for a variable when placed
above its declaration.</li>
<li><code dir="auto">//@strategy_alert_message</code> provides a default message for strategy
scripts to pre-fill the “Message” field in the alert creation
dialog.</li>
</ul>
<p>The Pine Editor also features two specialized annotations, <code dir="auto">//#region</code> and <code dir="auto">//#endregion</code>, that create <em>collapsible</em> code regions.
Clicking the dropdown arrow next to a <code dir="auto">//#region</code> line collapses all the code between that line and the nearest <code dir="auto">//#endregion</code> annotation
below it.</p>
<p>This example draws a triangle using three interactively selected points on the chart.
The script illustrates how one can use compiler and Editor annotations to document code and make it easier to navigate:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="794" loading="lazy" src="images/b4a1d831f8cadf3937fd779557411e62.webp" width="1848"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Triangle", "", true)

//#region ———————————————————— Constants and inputs

int   TIME_DEFAULT  = 0
float PRICE_DEFAULT = 0.0

x1Input = input.time(TIME_DEFAULT,   "Point 1", inline = "1", confirm = true)
y1Input = input.price(PRICE_DEFAULT, "",        inline = "1", tooltip = "Pick point 1", confirm = true)
x2Input = input.time(TIME_DEFAULT,   "Point 2", inline = "2", confirm = true)
y2Input = input.price(PRICE_DEFAULT, "",        inline = "2", tooltip = "Pick point 2", confirm = true)
x3Input = input.time(TIME_DEFAULT,   "Point 3", inline = "3", confirm = true)
y3Input = input.price(PRICE_DEFAULT, "",        inline = "3", tooltip = "Pick point 3", confirm = true)
//#endregion

//#region ———————————————————— Types and functions

// @type            Used to represent the coordinates and color to draw a triangle.
// @field time1     Time of first point.
// @field time2     Time of second point.
// @field time3     Time of third point.
// @field price1    Price of first point.
// @field price2    Price of second point.
// @field price3    Price of third point.
// @field lineColor Color to be used to draw the triangle lines.
type Triangle
    int   time1
    int   time2
    int   time3
    float price1
    float price2
    float price3
    color lineColor

//@function Draws a triangle using the coordinates of the `t` object.
//@param t  (Triangle) Object representing the triangle to be drawn.
//@returns  The ID of the last line drawn.
drawTriangle(Triangle t) =&gt;
    line.new(t.time1, t.price1, t.time2, t.price2, xloc = xloc.bar_time, color = t.lineColor)
    line.new(t.time2, t.price2, t.time3, t.price3, xloc = xloc.bar_time, color = t.lineColor)
    line.new(t.time1, t.price1, t.time3, t.price3, xloc = xloc.bar_time, color = t.lineColor)
//#endregion

//#region ———————————————————— Calculations

// Draw the triangle only once on the last historical bar.
if barstate.islastconfirmedhistory
    //@variable Used to hold the Triangle object to be drawn.
    Triangle triangle = Triangle.new()

    triangle.time1  := x1Input
    triangle.time2  := x2Input
    triangle.time3  := x3Input
    triangle.price1 := y1Input
    triangle.price2 := y2Input
    triangle.price3 := y3Input
    triangle.lineColor := color.purple

    drawTriangle(triangle)
//#endregion</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/time-series"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Time series  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/identifiers"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Identifiers <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Identifiers</span> </div> </div> <div data-astro-cid-xgirumru="" data-toc-hidden="" id="slot-container"> <h1 class="md-heading" id="language-identifiers"><a href="#identifiers">Identifiers<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>Identifiers are names used for user-defined variables and functions:</p>
<ul>
<li>They must begin with an uppercase (<code dir="auto">A-Z</code>) or lowercase (<code dir="auto">a-z</code>)
letter, or an underscore (<code dir="auto">_</code>).</li>
<li>The next characters can be letters, underscores or digits (<code dir="auto">0-9</code>).</li>
<li>They are case-sensitive.</li>
</ul>
<p>Here are some examples:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myVar
_myVar
my123Var
functionName
MAX_LEN
max_len
maxLen
3barsDown  // NOT VALID!</code></div>
<p>The Pine Script™ <a href="/pine-script-docs/v5/writing/style-guide/">Style Guide</a> recommends using uppercase SNAKE_CASE for constants, and
camelCase for other identifiers:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">GREEN_COLOR = #4CAF50
MAX_LOOKBACK = 100
int fastLength = 7
// Returns 1 if the argument is `true`, 0 if it is `false` or `na`.
zeroOne(boolValue) =&gt; boolValue ? 1 : 0</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/script-structure"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Script structure  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/operators"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Operators <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Operators</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-operators"><a href="#operators">Operators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Some operators are used to build <em>expressions</em> returning a result:</p>
<ul>
<li>Arithmetic operators</li>
<li>Comparison operators</li>
<li>Logical operators</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%7Bquestion%7D%7Bcolon%7D">?:</a>
ternary operator</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
history-referencing operator</li>
</ul>
<p>Other operators are used to assign values to variables:</p>
<ul>
<li><code dir="auto">=</code> is used to assign a value to a variable, <strong>but only when you
declare the variable</strong> (the first time you use it)</li>
<li><code dir="auto">:=</code> is used to assign a value to a <strong>previously declared
variable</strong>. The following operators can also be used in such a way:
<code dir="auto">+=</code>, <code dir="auto">-=</code>, <code dir="auto">*=</code>, <code dir="auto">/=</code>, <code dir="auto">%=</code></li>
</ul>
<p>As is explained in the <a href="/pine-script-docs/v5/language/type-system/">Type system</a> page, <em>qualifiers</em> and <em>types</em> play a critical role in
determining the type of results that expressions yield. This, in turn,
has an impact on how and with what functions you will be allowed to use
those results. Expressions always return a value with the strongest
qualifier used in the expression, e.g., if you multiply an “input int”
with a “series int”, the expression will produce a “series int”
result, which you will not be able to use as the argument to <code dir="auto">length</code> in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>.</p>
<p>This script will produce a compilation error:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
lenInput = input.int(14, "Length")
factor = year &gt; 2020 ? 3 : 1
adjustedLength = lenInput * factor
ma = ta.ema(close, adjustedLength)  // Compilation error!
plot(ma)</code></div>
<p>The compiler will complain: <em>Cannot call ‘ta.ema’ with argument
‘length’=‘adjustedLength’. An argument of ‘series int’ type was
used but a ‘simple int’ is expected;</em>. This is happening because
<code dir="auto">lenInput</code> is an “input int” but <code dir="auto">factor</code> is a “series int” (it can
only be determined by looking at the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a>
on each bar). The <code dir="auto">adjustedLength</code> variable is thus assigned a “series
int” value. Our problem is that the Reference Manual entry for
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>
tells us that its <code dir="auto">length</code> parameter requires a “simple” value, which
is a weaker qualifier than “series”, so a “series int” value is not
allowed.</p>
<p>The solution to our conundrum requires:</p>
<ul>
<li>Using another moving average function that supports a “series int”
length, such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>,
or</li>
<li>Not using a calculation producing a “series int” value for our
length.</li>
</ul>
<h2 class="md-heading" id="arithmetic-operators"><a href="#arithmetic-operators">Arithmetic operators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are five arithmetic operators in Pine Script™:</p>
<table><thead><tr><th>Operator</th><th>Meaning</th></tr></thead><tbody><tr><td><code dir="auto">+</code></td><td>Addition and string concatenation</td></tr><tr><td><code dir="auto">-</code></td><td>Subtraction</td></tr><tr><td><code dir="auto">*</code></td><td>Multiplication</td></tr><tr><td><code dir="auto">/</code></td><td>Division</td></tr><tr><td><code dir="auto">%</code></td><td>Modulo (remainder after division)</td></tr></tbody></table>
<p>The arithmetic operators above are all binary (means they need two
<em>operands</em> — or values — to work on, like in <code dir="auto">1 + 2</code>). The <code dir="auto">+</code> and
<code dir="auto">-</code> also serve as unary operators (means they work on one operand, like
<code dir="auto">-1</code> or <code dir="auto">+1</code>).</p>
<p>If both operands are numbers but at least one of these is of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
type, the result will also be a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>.
If both operands are of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
type, the result will also be an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>.
If at least one operand is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, the
result is also
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>The <code dir="auto">+</code> operator also serves as the concatenation operator for strings.
<code dir="auto">"EUR"+"USD"</code> yields the <code dir="auto">"EURUSD"</code> string.</p>
<p>The <code dir="auto">%</code> operator calculates the modulo by rounding down the quotient to
the lowest possible value. Here is an easy example that helps illustrate
how the modulo is calculated behind the scenes:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Modulo function")
modulo(series int a, series int b) =&gt;
    a - b * math.floor(nz(a/b))
plot(modulo(-1, 100))</code></div>
<h2 class="md-heading" id="comparison-operators"><a href="#comparison-operators">Comparison operators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are six comparison operators in Pine Script™:</p>
<table><thead><tr><th>Operator</th><th>Meaning</th></tr></thead><tbody><tr><td><code dir="auto">&lt;</code></td><td>Less Than</td></tr><tr><td><code dir="auto">&lt;=</code></td><td>Less Than or Equal To</td></tr><tr><td><code dir="auto">!=</code></td><td>Not Equal</td></tr><tr><td><code dir="auto">==</code></td><td>Equal</td></tr><tr><td><code dir="auto">&gt;</code></td><td>Greater Than</td></tr><tr><td><code dir="auto">&gt;=</code></td><td>Greater Than or Equal To</td></tr></tbody></table>
<p>Comparison operations are binary. If both operands have a numerical
value, the result will be of type <em>bool</em>, i.e., <code dir="auto">true</code>, <code dir="auto">false</code> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>Examples:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">1 &gt; 2  // false
1 != 1 // false
close &gt;= open  // Depends on values of `close` and `open`</code></div>
<h2 class="md-heading" id="logical-operators"><a href="#logical-operators">Logical operators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are three logical operators in Pine Script™:</p>
<table><thead><tr><th>Operator</th><th>Meaning</th></tr></thead><tbody><tr><td><code dir="auto">not</code></td><td>Negation</td></tr><tr><td><code dir="auto">and</code></td><td>Logical Conjunction</td></tr><tr><td><code dir="auto">or</code></td><td>Logical Disjunction</td></tr></tbody></table>
<p>The operator <code dir="auto">not</code> is unary. When applied to a <code dir="auto">true</code>, operand the
result will be <code dir="auto">false</code>, and vice versa.</p>
<p><code dir="auto">and</code> operator truth table:</p>
<table><thead><tr><th>a</th><th>b</th><th>a and b</th></tr></thead><tbody><tr><td>true</td><td>true</td><td>true</td></tr><tr><td>true</td><td>false</td><td>false</td></tr><tr><td>false</td><td>true</td><td>false</td></tr><tr><td>false</td><td>false</td><td>false</td></tr></tbody></table>
<p><code dir="auto">or</code> operator truth table:</p>
<table><thead><tr><th>a</th><th>b</th><th>a or b</th></tr></thead><tbody><tr><td>true</td><td>true</td><td>true</td></tr><tr><td>true</td><td>false</td><td>true</td></tr><tr><td>false</td><td>true</td><td>true</td></tr><tr><td>false</td><td>false</td><td>false</td></tr></tbody></table>
<h2 class="md-heading" id="-ternary-operator"><a href="#-ternary-operator">`?:` ternary operator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%7Bquestion%7D%7Bcolon%7D">?:</a>
ternary operator is used to create expressions of the form:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">condition ? valueWhenConditionIsTrue : valueWhenConditionIsFalse</code></div>
<p>The ternary operator returns a result that depends on the value of
<code dir="auto">condition</code>. If it is <code dir="auto">true</code>, then <code dir="auto">valueWhenConditionIsTrue</code> is
returned. If <code dir="auto">condition</code> is <code dir="auto">false</code> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, then
<code dir="auto">valueWhenConditionIsFalse</code> is returned.</p>
<p>A combination of ternary expressions can be used to achieve the same
effect as a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">timeframe.isintraday ? color.red : timeframe.isdaily ? color.green : timeframe.ismonthly ? color.blue : na</code></div>
<p>The example is calculated from left to right:</p>
<ul>
<li>If
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disintraday">timeframe.isintraday</a>
is <code dir="auto">true</code>, then <code dir="auto">color.red</code> is returned. If it is <code dir="auto">false</code>, then
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdaily">timeframe.isdaily</a>
is evaluated.</li>
<li>If
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdaily">timeframe.isdaily</a>
is <code dir="auto">true</code>, then <code dir="auto">color.green</code> is returned. If it is <code dir="auto">false</code>, then
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dismonthly">timeframe.ismonthly</a>
is evaluated.</li>
<li>If
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dismonthly">timeframe.ismonthly</a>
is <code dir="auto">true</code>, then <code dir="auto">color.blue</code> is returned, otherwise
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
is returned.</li>
</ul>
<p>Note that the return values on each side of the <code dir="auto">:</code> are expressions ---
not local blocks, so they will not affect the limit of 500 local blocks
per scope.</p>
<h2 class="md-heading" id="--history-referencing-operator"><a href="#--history-referencing-operator">`[ ]` history-referencing operator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>It is possible to refer to past values of
<a href="/pine-script-docs/v5/language/time-series/">time series</a> using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
history-referencing operator. Past values are values a variable had on
bars preceding the bar where the script is currently executing — the
<em>current bar</em>. See the
<a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>
page for more information about the way scripts are executed on bars.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator is used after a variable, expression or function call. The
value used inside the square brackets of the operator is the offset in
the past we want to refer to. To refer to the value of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
built-in variable two bars away from the current bar, one would use
<code dir="auto">volume[2]</code>.</p>
<p>Because series grow dynamically, as the script moves on sucessive bars,
the offset used with the operator will refer to different bars. Let’s
see how the value returned by the same offset is dynamic, and why series
are very different from arrays. In Pine Script™, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
variable, or <code dir="auto">close[0]</code> which is equivalent, holds the value of the
current bar’s “close”. If your code is now executing on the <strong>third</strong>
bar of the <em>dataset</em> (the set of all bars on your chart), <code dir="auto">close</code> will
contain the price at the close of that bar, <code dir="auto">close[1]</code> will contain the
price at the close of the preceding bar (the dataset’s second bar), and
<code dir="auto">close[2]</code>, the first bar. <code dir="auto">close[3]</code> will return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
because no bar exists in that position, and thus its value is <em>not
available</em>.</p>
<p>When the same code is executed on the next bar, the <strong>fourth</strong> in the
dataset, <code dir="auto">close</code> will now contain the closing price of that bar, and the
same <code dir="auto">close[1]</code> used in your code will now refer to the “close” of the
third bar in the dataset. The close of the first bar in the dataset will
now be <code dir="auto">close[3]</code>, and this time <code dir="auto">close[4]</code> will return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>In the Pine Script™ runtime environment, as your code is executed once
for each historical bar in the dataset, starting from the left of the
chart, Pine Script™ is adding a new element in the series at index 0 and
pushing the pre-existing elements in the series one index further away.
Arrays, in comparison, can have constant or variable sizes, and their
content or indexing structure is not modified by the runtime
environment. Pine Script™ series are thus very different from arrays and
only share familiarity with them through their indexing syntax.</p>
<p>When the market for the chart’s symbol is open and the script is
executing on the chart’s last bar, the <em>realtime bar</em>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
returns the value of the current price. It will only contain the actual
closing price of the realtime bar the last time the script is executed
on that bar, when it closes.</p>
<p>Pine Script™ has a variable that contains the number of the bar the
script is executing on:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.
On the first bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
is equal to 0 and it increases by 1 on each successive bar the script
executes on. On the last bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
is equal to the number of bars in the dataset minus one.</p>
<p>There is another important consideration to keep in mind when using the
<code dir="auto">[]</code> operator in Pine Script™. We have seen cases when a history
reference may return the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
value.
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
represents a value which is not a number and using it in any expression
will produce a result that is also
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
(similar to <a href="https://en.wikipedia.org/wiki/NaN" rel="nofollow">NaN</a>). Such cases often
happen during the script’s calculations in the early bars of the
dataset, but can also occur in later bars under certain conditions. If
your code does not explicitly provide for handling these special cases,
they can introduce invalid results in your script’s calculations which
can ripple through all the way to the realtime bar. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_na">na</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz</a>
functions are designed to allow for handling such cases.</p>
<p>These are all valid uses of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">high[10]
ta.sma(close, 10)[1]
ta.highest(high, 10)[20]
close &gt; nz(close[1], open)</code></div>
<p>Note that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator can only be used once on the same value. This is not allowed:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">close[1][2] // Error: incorrect use of [] operator</code></div>
<h2 class="md-heading" id="operator-precedence"><a href="#operator-precedence">Operator precedence<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The order of calculations is determined by the operators’ precedence.
Operators with greater precedence are calculated first. Below is a list
of operators sorted by decreasing precedence:</p>
<table><thead><tr><th>Precedence</th><th>Operator</th></tr></thead><tbody><tr><td>9</td><td><code dir="auto">[]</code></td></tr><tr><td>8</td><td>unary <code dir="auto">+</code>, unary <code dir="auto">-</code>, <code dir="auto">not</code></td></tr><tr><td>7</td><td><code dir="auto">*</code>, <code dir="auto">/</code>, <code dir="auto">%</code></td></tr><tr><td>6</td><td><code dir="auto">+</code>, <code dir="auto">-</code></td></tr><tr><td>5</td><td><code dir="auto">&gt;</code>, <code dir="auto">&lt;</code>, <code dir="auto">&gt;=</code>, <code dir="auto">&lt;=</code></td></tr><tr><td>4</td><td><code dir="auto">==</code>, <code dir="auto">!=</code></td></tr><tr><td>3</td><td><code dir="auto">and</code></td></tr><tr><td>2</td><td><code dir="auto">or</code></td></tr><tr><td>1</td><td><code dir="auto">?:</code></td></tr></tbody></table>
<p>If in one expression there are several operators with the same
precedence, then they are calculated left to right.</p>
<p>If the expression must be calculated in a different order than
precedence would dictate, then parts of the expression can be grouped
together with parentheses.</p>
<h2 class="md-heading" id="-assignement-operator"><a href="#-assignement-operator">`=` assignement operator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">=</code> operator is used to assign a variable when it is initialized ---
or declared ---, i.e., the first time you use it. It says <em>this is a new
variable that I will be using, and I want it to start on each bar with
this value</em>.</p>
<p>These are all valid variable declarations:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">i = 1
MS_IN_ONE_MINUTE = 1000 * 60
showPlotInput = input.bool(true, "Show plots")
pHi = pivothigh(5, 5)
plotColor = color.green</code></div>
<p>See the
<a href="/pine-script-docs/v5/language/variable-declarations/">Variable declarations</a> page for more information on how to declare variables.</p>
<h2 class="md-heading" id="-reassignment-operator"><a href="#-reassignment-operator">`:=` reassignment operator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">:=</code> is used to <em>reassign</em> a value to an existing variable. It says
<em>use this variable that was declared earlier in my script, and give it a
new value</em>.</p>
<p>Variables which have been first declared, then reassigned using <code dir="auto">:=</code>,
are called <em>mutable</em> variables. All the following examples are valid
variable reassignments. You will find more information on how
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
works in the section on the
<a href="/pine-script-docs/v5/v5/language/variable-declarations#var">`var` declaration mode</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
// Declare `pHi` and initilize it on the first bar only.
var float pHi = na
// Reassign a value to `pHi`
pHi := nz(ta.pivothigh(5, 5), pHi)
plot(pHi)</code></div>
<p>Note that:</p>
<ul>
<li>We declare <code dir="auto">pHi</code> with this code: <code dir="auto">var float pHi = na</code>. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword tells Pine Script™ that we only want that variable
initialized with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
on the dataset’s first bar. The <code dir="auto">float</code> keyword tells the compiler
we are declaring a variable of type “float”. This is necessary
because, contrary to most cases, the compiler cannot automatically
determine the type of the value on the right side of the <code dir="auto">=</code> sign.</li>
<li>While the variable declaration will only be executed on the first
bar because it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>,
the <code dir="auto">pHi := nz(ta.pivothigh(5, 5), pHi)</code> line will be executed on
all the chart’s bars. On each bar, it evaluates if the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">pivothigh()</a>
call returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
because that is what the function does when it hasn’t found a new
pivot. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a>
function is the one doing the “checking for
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>”
part. When its first argument (<code dir="auto">ta.pivothigh(5, 5)</code>) is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
it returns the second argument (<code dir="auto">pHi</code>) instead of the first. When
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">pivothigh()</a>
returns the price point of a newly found pivot, that value is
assigned to <code dir="auto">pHi</code>. When it returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
because no new pivot was found, we assign the previous value of
<code dir="auto">pHi</code> to itself, in effect preserving its previous value.</li>
</ul>
<p>The output of our script looks like this:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="476" loading="lazy" src="images/585535e1d411d23849c9ec879698ee74.webp" width="1402"/></div></p>
<p>Note that:</p>
<ul>
<li>The line preserves its previous value until a new pivot is found.</li>
<li>Pivots are detected five bars after the pivot actually occurs
because our <code dir="auto">ta.pivothigh(5, 5)</code> call says that we require five
lower highs on both sides of a high point for it to be detected as a
pivot.</li>
</ul>
<p>See the
<a href="/pine-script-docs/v5/language/variable-declarations/#variable-reassignment">Variable reassignment</a> section for more information on how to reassign values to
variables.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/identifiers"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Identifiers  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/variable-declarations"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Variable declarations <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Variable declarations</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-variable-declarations"><a href="#variable-declarations">Variable declarations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Variables are <a href="/pine-script-docs/v5/language/identifiers/">identifiers</a> that hold values. They must be <em>declared</em> in your code
before you use them. The syntax of variable declarations is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = &lt;expression&gt; | &lt;structure&gt;</span></div></div></code></pre></figure></link></div>
<p>or</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;tuple_declaration&gt; = &lt;function_call&gt; | &lt;structure&gt;</span></div></div></code></pre></figure></div>
<p>where:</p>
<ul>
<li><code dir="auto">|</code> means “or”, and parts enclosed in square brackets (<code dir="auto">[]</code>) can
appear zero or one time.</li>
<li>&lt;declaration_mode&gt; is the variable’s
<a href="/pine-script-docs/v5/language/variable-declarations/#declaration-modes">declaration mode</a>. It can be
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>,
or nothing.</li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable
declarations (see <a href="/pine-script-docs/v5/language/type-system/#types">types</a>).</li>
<li>&lt;identifier&gt; is the variable’s
<a href="/pine-script-docs/v5/language/identifiers/">name</a>.</li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a
function call.</li>
<li>&lt;structure&gt; can be an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
<em>structure</em>.</li>
<li>&lt;tuple_declaration&gt; is a comma-separated list of variable names
enclosed in square brackets (<code dir="auto">[]</code>), e.g.,
<code dir="auto">[ma, upperBand, lowerBand]</code>.</li>
</ul>
<p>These are all valid variable declarations. The last one requires four
lines:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">BULL_COLOR = color.lime
i = 1
len = input(20, "Length")
float f = 10.5
closeRoundedToTick = math.round_to_mintick(close)
st = ta.supertrend(4, 14)
var barRange = float(na)
var firstBarOpen = open
varip float lastClose = na
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)
plotColor = if close &gt; open
    color.green
else
    color.red</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The above statements all contain the <code dir="auto">=</code> assignment operator because
they are <strong>variable declarations</strong>. When you see similar lines using the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a>
reassignment operator, the code is <strong>reassigning</strong> a value to a variable
that was <strong>already declared</strong>. Those are <strong>variable reassignments</strong>. Be
sure you understand the distinction as this is a common stumbling block
for newcomers to Pine Script™. See the next
<a href="/pine-script-docs/v5/language/variable-declarations/#variable-reassignment">Variable reassignment</a> section for details.</p></div></aside>
<p>The formal syntax of a variable declaration is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;variable_declaration&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = &lt;expression&gt; | &lt;structure&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">|</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;tuple_declaration&gt; = &lt;function_call&gt; | &lt;structure&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;declaration_mode&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">var | varip</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;type&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">int | float | bool | color | string | line | linefill | label | box | table | array&lt;type&gt; | matrix&lt;type&gt; | UDF</span></div></div></code></pre></figure></div>
<h3 class="md-heading" id="initialization-with-na"><a href="#initialization-with-na">Initialization with `na`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In most cases, an explicit type declaration is redundant because type is
automatically inferred from the value on the right of the <code dir="auto">=</code> at compile
time, so the decision to use them is often a matter of preference. For
example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">baseLine0 = na          // compile time error!
float baseLine1 = na    // OK
baseLine2 = float(na)   // OK</code></div>
<p>In the first line of the example, the compiler cannot determine the type
of the <code dir="auto">baseLine0</code> variable because
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is a
generic value of no particular type. The declaration of the <code dir="auto">baseLine1</code>
variable is correct because its
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
type is declared explicitly. The declaration of the <code dir="auto">baseLine2</code> variable
is also correct because its type can be derived from the expression
<code dir="auto">float(na)</code>, which is an explicit cast of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value
to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
type. The declarations of <code dir="auto">baseLine1</code> and <code dir="auto">baseLine2</code> are equivalent.</p>
<h3 class="md-heading" id="tuple-declarations"><a href="#tuple-declarations">Tuple declarations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Function calls or structures are allowed to return multiple values. When
we call them and want to store the values they return, a <em>tuple
declaration</em> must be used, which is a comma-separated set of one or more
values enclosed in brackets. This allows us to declare multiple
variables simultaneously. As an example, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbb">ta.bb()</a>
built-in function for Bollinger bands returns three values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[bbMiddle, bbUpper, bbLower] = ta.bb(close, 5, 4)</code></div>
<h3 class="md-heading" id="using-an-underscore-_-as-an-identifier"><a href="#using-an-underscore-_-as-an-identifier"><span>Using an underscore (​<code dir="auto">_</code>​) as an identifier</span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When declaring a variable, it is possible to use a single underscore (<code dir="auto">_</code>) as its identifier. A value assigned to such a variable cannot be accessed. You can assign any number of values to a <code dir="auto">_</code> identifier anywhere in the script, even if the current scope already has such an assignment.</p>
<p>This is particularly useful when a tuple returns unneeded values. Let’s write another Bollinger Bands script. Here, we only need the bands themselves, without the center line:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Underscore demo")

// We do not need the middle Bollinger Bands value, and do not use it.
// To make this clear, we assign it to the `_` identifier.
[_, bbUpper, bbLower] = ta.bb(close, 5, 4)

// We can continue to use `_` in the same code without causing compilation errors:
[bbMiddleLong, _, _] = ta.bb(close, 20, 2)

plot(bbUpper)</code></div>
<h2 class="md-heading" id="variable-reassignment"><a href="#variable-reassignment">Variable reassignment<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A variable reassignment is done using the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a>
reassignment operator. It can only be done after a variable has been
first declared and given an initial value. Reassigning a new value to a
variable is often necessary in calculations, and it is always necessary
when a variable from the global scope must be assigned a new value from
within a structure’s local block, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
sensitivityInput = input.int(2, "Sensitivity", minval = 1, tooltip = "Higher values make color changes less sensitive.")
ma = ta.sma(close, 20)
maUp = ta.rising(ma, sensitivityInput)
maDn = ta.falling(ma, sensitivityInput)

// On first bar only, initialize color to gray
var maColor = color.gray
if maUp
    // MA has risen for two bars in a row; make it lime.
    maColor := color.lime
else if maDn
    // MA has fallen for two bars in a row; make it fuchsia.
    maColor := color.fuchsia

plot(ma, "MA", maColor, 2)</code></div>
<p>Note that:</p>
<ul>
<li>We initialize <code dir="auto">maColor</code> on the first bar only, so it preserves its
value across bars.</li>
<li>On every bar, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
statement checks if the MA has been rising or falling for the
user-specified number of bars (the default is 2). When that happens,
the value of <code dir="auto">maColor</code> must be reassigned a new value from within
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
local blocks. To do this, we use the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a> reassignment operator.</li>
<li>If we did not use the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a> reassignment operator, the effect would be to initialize
a new <code dir="auto">maColor</code> local variable which would have the same name as
that of the global scope, but actually be a very confusing
independent entity that would persist only for the length of the
local block, and then disappear without a trace.</li>
</ul>
<p>All user-defined variables in Pine Script™ are <em>mutable</em>, which means
their value can be changed using the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a>
reassignment operator. Assigning a new value to a variable may change
its <em>type qualifier</em> (see the page on Pine Script™‘s
<a href="/pine-script-docs/v5/language/type-system/">type system</a> for more
information). A variable can be assigned a new value as many times as
needed during the script’s execution on one bar, so a script can
contain any number of reassignments of one variable. A variable’s
<a href="/pine-script-docs/v5/language/variable-declarations/#declaration-modes">declaration mode</a> determines how new values assigned to a variable will be
saved.</p>
<h2 class="md-heading" id="declaration-modes"><a href="#declaration-modes">Declaration modes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Understanding the impact that declaration modes have on the behavior of
variables requires prior knowledge of Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a>.</p>
<p>When you declare a variable, if a declaration mode is specified, it must
come first. Three modes can be used:</p>
<ul>
<li>“On each bar”, when none is specified</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a></li>
</ul>
<h3 class="md-heading" id="on-each-bar"><a href="#on-each-bar">On each bar<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When no explicit declaration mode is specified, i.e. no
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keyword is used, the variable is declared and initialized on each bar,
e.g., the following declarations from our first set of examples in this
page’s introduction:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">BULL_COLOR = color.lime
i = 1
len = input(20, "Length")
float f = 10.5
closeRoundedToTick = math.round_to_mintick(close)
st = ta.supertrend(4, 14)
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)
plotColor = if close &gt; open
    color.green
else
    color.red</code></div>
<h3 class="md-heading" id="var"><a href="#var">`var`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword is used, the variable is only initialized once, on the first bar
if the declaration is in the global scope, or the first time the local
block is executed if the declaration is inside a local block. After
that, it will preserve its last value on successive bars, until we
reassign a new value to it. This behavior is very useful in many cases
where a variable’s value must persist through the iterations of a
script across successive bars. For example, suppose we’d like to count
the number of green bars on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Green Bars Count")
var count = 0
isGreen = close &gt;= open
if isGreen
    count := count + 1
plot(count)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="800" loading="lazy" src="images/8b7bc3c9e459948ded07c6596dbb5ae5.webp" width="1600"/></div></p>
<p>Without the <code dir="auto">var</code> modifier, variable <code dir="auto">count</code> would be reset to zero
(thus losing its value) every time a new bar update triggered a script
recalculation.</p>
<p>Declaring variables on the first bar only is often useful to manage
drawings more efficiently. Suppose we want to extend the last bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
line to the right of the right chart. We could write:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inefficient version", "", true)
closeLine = line.new(bar_index - 1, close, bar_index, close, extend = extend.right, width = 3)
line.delete(closeLine[1])</code></div>
<p>but this is inefficient because we are creating and deleting the line on
each historical bar and on each update in the realtime bar. It is more
efficient to use:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Efficient version", "", true)
var closeLine = line.new(bar_index - 1, close, bar_index, close, extend = extend.right, width = 3)
if barstate.islast
    line.set_xy1(closeLine, bar_index - 1, close)
    line.set_xy2(closeLine, bar_index, close)</code></div>
<p>Note that:</p>
<ul>
<li>We initialize <code dir="auto">closeLine</code> on the first bar only, using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
declaration mode</li>
<li>We restrict the execution of the rest of our code to the chart’s
last bar by enclosing our code that updates the line in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
structure.</li>
</ul>
<p>There is a very slight penalty performance for using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
declaration mode. For that reason, when declaring constants, it is
preferable not to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> if
performance is a concern, unless the initialization involves
calculations that take longer than the maintenance penalty, e.g.,
functions with complex code or string manipulations.</p>
<h3 class="md-heading" id="varip"><a href="#varip">`varip`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Understanding the behavior of variables using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
declaration mode requires prior knowledge of Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and
<a href="/pine-script-docs/v5/concepts/bar-states/">bar states</a>.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keyword can be used to declare variables that escape the <em>rollback
process</em>, which is explained in the page on Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a>.</p>
<p>Whereas scripts only execute once at the close of historical bars, when
a script is running in realtime, it executes every time the chart’s
feed detects a price or volume update. At every realtime update, Pine
Script™‘s runtime normally resets the values of a script’s variables
to their last committed value, i.e., the value they held when the
previous bar closed. This is generally handy, as each realtime script
execution starts from a known state, which simplifies script logic.</p>
<p>Sometimes, however, script logic requires code to be able to save
variable values <strong>between different executions</strong> in the realtime bar.
Declaring variables with
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
makes that possible. The “ip” in
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
stands for <em>intrabar persist</em>.</p>
<p>Let’s look at the following code, which does not use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
int updateNo = na
if barstate.isnew
    updateNo := 1
else
    updateNo := updateNo + 1

plot(updateNo, style = plot.style_circles)</code></div>
<p>On historical bars,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
is always true, so the plot shows a value of “1” because the <code dir="auto">else</code>
part of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure is never executed. On realtime bars,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
is only
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>
when the script first executes on the bar’s “open”. The plot will
then briefly display “1” until subsequent executions occur. On the
next executions during the realtime bar, the second branch of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
statement is executed because
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
is no longer true. Since <code dir="auto">updateNo</code> is initialized to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> at
each execution, the <code dir="auto">updateNo + 1</code> expression yields
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, so
nothing is plotted on further realtime executions of the script.</p>
<p>If we now use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
to declare the <code dir="auto">updateNo</code> variable, the script behaves very differently:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
varip int updateNo = na
if barstate.isnew
    updateNo := 1
else
    updateNo := updateNo + 1

plot(updateNo, style = plot.style_circles)</code></div>
<p>The difference now is that <code dir="auto">updateNo</code> tracks the number of realtime
updates that occur on each realtime bar. This can happen because the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
declaration allows the value of <code dir="auto">updateNo</code> to be preserved between
realtime updates; it is no longer rolled back at each realtime execution
of the script. The test on
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
allows us to reset the update count when a new realtime bar comes in.</p>
<p>Because
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
only affects the behavior of your code in the realtime bar, it follows
that backtest results on strategies designed using logic based on
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
variables will not be able to reproduce that behavior on historical
bars, which will invalidate test results on them. This also entails that
plots on historical bars will not be able to reproduce the script’s
behavior in realtime.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/operators"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Operators  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/conditional-structures"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Conditional structures <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Conditional structures</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-conditional-structures"><a href="#conditional-structures">Conditional structures<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The conditional structures in Pine Script™ are
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>.
They can be used:</p>
<ul>
<li>For their side effects, i.e., when they don’t return a value but do
things, like reassign values to variables or call functions.</li>
<li>To return a value or a tuple which can then be assigned to one (or
more, in the case of tuples) variable.</li>
</ul>
<p>Conditional structures, like the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
structures, can be embedded; you can use an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
inside another structure.</p>
<p>Some Pine Script™ built-in functions cannot be called from within the
local blocks of conditional structures. They are:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>.
This does not entail their functionality cannot be controlled by
conditions evaluated by your script — only that it cannot be done by
including them in conditional structures. Note that while <code dir="auto">input*.()</code>
function calls are allowed in local blocks, their functionality is the
same as if they were in the script’s global scope.</p>
<p>The local blocks in conditional structures must be indented by four
spaces or a tab.</p>
<h2 class="md-heading" id="if-structure"><a href="#if-structure">`if` structure<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="if-used-for-its-side-effects"><a href="#if-used-for-its-side-effects">`if` used for its side effects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>An <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure used for its side effects has the following syntax:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">if &lt;expression&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">{else if &lt;expression&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[else</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;]</span></div></div></code></pre></figure></link></div>
<p>where:</p>
<ul>
<li>Parts enclosed in square brackets (<code dir="auto">[]</code>) can appear zero or one
time, and those enclosed in curly braces (<code dir="auto">{}</code>) can appear zero or
more times.</li>
<li>&lt;expression&gt; must be of “bool” type or be auto-castable to that
type, which is only possible for “int” or “float” values (see
the <a href="/pine-script-docs/v5/language/type-system/#types">Type system</a> page).</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a
return value, which can be a tuple of values. It must be indented by
four spaces or a tab.</li>
<li>There can be zero or more <code dir="auto">else if</code> clauses.</li>
<li>There can be zero or one <code dir="auto">else</code> clause.</li>
</ul>
<p>When the &lt;expression&gt; following the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
evaluates to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>,
the first local block is executed, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of
the local block are returned.</p>
<p>When the &lt;expression&gt; following the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
evaluates to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_false">false</a>,
the successive <code dir="auto">else if</code> clauses are evaluated, if there are any. When
the &lt;expression&gt; of one evaluates to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>,
its local block is executed, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of
the local block are returned.</p>
<p>When no &lt;expression&gt; has evaluated to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>
and an <code dir="auto">else</code> clause exists, its local block is executed, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of
the local block are returned.</p>
<p>When no &lt;expression&gt; has evaluated to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>
and no <code dir="auto">else</code> clause exists,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is
returned.</p>
<p>Using <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structures for their side effects can be useful to manage the order flow
in strategies, for example. While the same functionality can often be
achieved using the <code dir="auto">when</code> parameter in <code dir="auto">strategy.*()</code> calls, code using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structures is easier to read:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if (ta.crossover(source, lower))
    strategy.entry("BBandLE", strategy.long, stop=lower,
                   oca_name="BollingerBands",
                   oca_type=strategy.oca.cancel, comment="BBandLE")
else
    strategy.cancel(id="BBandLE")</code></div>
<p>Restricting the execution of your code to specific bars ican be done
using <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structures, as we do here to restrict updates to our label to the
chart’s last bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
var ourLabel = label.new(bar_index, na, na, color = color(na), textcolor = color.orange)
if barstate.islast
    label.set_xy(ourLabel, bar_index + 2, hl2[1])
    label.set_text(ourLabel, str.tostring(bar_index + 1, "# bars in chart"))</code></div>
<p>Note that:</p>
<ul>
<li>We initialize the <code dir="auto">ourLabel</code> variable on the script’s first bar
only, as we use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
declaration mode. The value used to initialize the variable is
provided by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
function call, which returns a label ID pointing to the label it
creates. We use that call to set the label’s properties because
once set, they will persist until we change them.</li>
<li>What happens next is that on each successive bar the Pine Script™
runtime will skip the initialization of <code dir="auto">ourLabel</code>, and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s condition
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>)
is evaluated. It returns <code dir="auto">false</code> on all bars until the last one, so
the script does nothing on most historical bars after bar zero.</li>
<li>On the last bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
becomes true and the structure’s local block executes, modifying on
each chart update the properties of our label, which displays the
number of bars in the dataset.</li>
<li>We want to display the label’s text without a background, so we
make the label’s background
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
function call, and we use <code dir="auto">hl2[1]</code> for the label’s <em>y</em> position
because we don’t want it to move all the time. By using the average
of the <strong>previous</strong> bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values, the label doesn’t move until the moment when the next
realtime bar opens.</li>
<li>We use <code dir="auto">bar_index + 2</code> in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xy">label.set_xy()</a>
call to offset the label to the right by two bars.</li>
</ul>
<h3 class="md-heading" id="if-used-to-return-a-value"><a href="#if-used-to-return-a-value">`if` used to return a value<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>An <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure used to return one or more values has the following syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = if &lt;expression&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">{else if &lt;expression&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[else</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;]</span></div></div></code></pre></figure></div>
<p>where:</p>
<ul>
<li>Parts enclosed in square brackets (<code dir="auto">[]</code>) can appear zero or one
time, and those enclosed in curly braces (<code dir="auto">{}</code>) can appear zero or
more times.</li>
<li>&lt;declaration_mode&gt; is the variable’s
<a href="/pine-script-docs/v5/language/variable-declarations/#declaration-modes">declaration mode</a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable
declarations (see <a href="/pine-script-docs/v5/language/type-system/#types">types</a>)</li>
<li>&lt;identifier&gt; is the variable’s
<a href="/pine-script-docs/v5/language/identifiers/">name</a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a
function call.</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a
return value, which can be a tuple of values. It must be indented by
four spaces or a tab.</li>
<li>The value assigned to the variable is the return value of the
&lt;local_block&gt;, or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
if no local block is executed.</li>
</ul>
<p>This is an example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
string barState = if barstate.islastconfirmedhistory
    "islastconfirmedhistory"
else if barstate.isnew
    "isnew"
else if barstate.isrealtime
    "isrealtime"
else
    "other"

f_print(_text) =&gt; 
    var table _t = table.new(position.middle_right, 1, 1)
    table.cell(_t, 0, 0, _text, bgcolor = color.yellow)
f_print(barState)</code></div>
<p>It is possible to omit the <em>else</em> block. In this case, if the
<code dir="auto">condition</code> is false, an <em>empty</em> value (<code dir="auto">na</code>, <code dir="auto">false</code>, or <code dir="auto">""</code>) will be
assigned to the <code dir="auto">var_declarationX</code> variable.</p>
<p>This is an example showing how
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is
returned when no local block is executed. If <code dir="auto">close &gt; open</code> is <code dir="auto">false</code>
in here,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is
returned:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">x = if close &gt; open
    close</code></div>
<p>Scripts can contain <code dir="auto">if</code> structures with nested <code dir="auto">if</code> and other
conditional structures. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if condition1
    if condition2
        if condition3
            expression</code></div>
<p>However, nesting these structures is not recommended from a performance
perspective. When possible, it is typically more optimal to compose a
single <code dir="auto">if</code> statement with multiple logical operators rather than
several nested <code dir="auto">if</code> blocks:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if condition1 and condition2 and condition3
    expression</code></div>
<h2 class="md-heading" id="switch-structure"><a href="#switch-structure">`switch` structure<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure exists in two forms. One switches on the different values of a
key expression:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]switch &lt;expression&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">{&lt;expression&gt; =&gt; &lt;local_block&gt;}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">=&gt; &lt;local_block&gt;</span></div></div></code></pre></figure></div>
<p>The other form does not use an expression as a key; it switches on the
evaluation of different expressions:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]switch</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">{&lt;expression&gt; =&gt; &lt;local_block&gt;}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">=&gt; &lt;local_block&gt;</span></div></div></code></pre></figure></div>
<p>where:</p>
<ul>
<li>Parts enclosed in square brackets (<code dir="auto">[]</code>) can appear zero or one
time, and those enclosed in curly braces (<code dir="auto">{}</code>) can appear zero or
more times.</li>
<li>&lt;declaration_mode&gt; is the variable’s
<a href="/pine-script-docs/v5/language/variable-declarations/#declaration-modes">declaration mode</a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable
declarations (see <a href="/pine-script-docs/v5/language/type-system/#types">types</a>)</li>
<li>&lt;identifier&gt; is the variable’s
<a href="/pine-script-docs/v5/language/identifiers/">name</a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a
function call.</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a
return value, which can be a tuple of values. It must be indented by
four spaces or a tab.</li>
<li>The value assigned to the variable is the return value of the
&lt;local_block&gt;, or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
if no local block is executed.</li>
<li>The <code dir="auto">=&gt; &lt;local_block&gt;</code> at the end allows you to specify a return
value which acts as a default to be used when no other case in the
structure is executed.</li>
</ul>
<p>Only one local block of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure is executed. It is thus a <em>structured switch</em> that doesn’t
<em>fall through</em> cases. Consequently, <code dir="auto">break</code> statements are unnecessary.</p>
<p>Both forms are allowed as the value used to initialize a variable.</p>
<p>As with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure, if no local block is exectuted,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is
returned.</p>
<h3 class="md-heading" id="switch-with-an-expression"><a href="#switch-with-an-expression">`switch` with an expression<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Let’s look at an example of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
using an expression:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Switch using an expression", "", true)

string maType = input.string("EMA", "MA type", options = ["EMA", "SMA", "RMA", "WMA"])
int maLength = input.int(10, "MA length", minval = 2)

float ma = switch maType
    "EMA" =&gt; ta.ema(close, maLength)
    "SMA" =&gt; ta.sma(close, maLength)
    "RMA" =&gt; ta.rma(close, maLength)
    "WMA" =&gt; ta.wma(close, maLength)
    =&gt; 
        runtime.error("No matching MA type found.")
        float(na)

plot(ma)</code></div>
<p>Note that:</p>
<ul>
<li>The expression we are switching on is the variable <code dir="auto">maType</code>, which
is of “input int” type (see here for an explanation of what the
“<a href="/pine-script-docs/v5/language/type-system/#input">input</a>” qualifier is). Since it cannot change during the
execution of the script, this guarantees that whichever MA type the
user selects will be executing on each bar, which is a requirement
for functions like
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>
which require a “simple int” argument for their <code dir="auto">length</code>
parameter.</li>
<li>If no matching value is found for <code dir="auto">maType</code>, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
executes the last local block introduced by <code dir="auto">=&gt;</code>, which acts as a
catch-all. We generate a runtime error in that block. We also end it
with <code dir="auto">float(na)</code> so the local block returns a value whose type is
compatible with that of the other local blocks in the structure, to
avoid a compilation error.</li>
</ul>
<h3 class="md-heading" id="switch-without-an-expression"><a href="#switch-without-an-expression">`switch` without an expression<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This is an example of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure which does not use an expression:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Switch without an expression", "", true)

bool longCondition  = ta.crossover( ta.sma(close, 14), ta.sma(close, 28))
bool shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))

switch
    longCondition  =&gt; strategy.entry("Long ID", strategy.long)
    shortCondition =&gt; strategy.entry("Short ID", strategy.short)</code></div>
<p>Note that:</p>
<ul>
<li>We are using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
to select the appropriate strategy order to emit, depending on
whether the <code dir="auto">longCondition</code> or <code dir="auto">shortCondition</code> “bool” variables
are <code dir="auto">true</code>.</li>
<li>The building conditions of <code dir="auto">longCondition</code> and <code dir="auto">shortCondition</code> are
exclusive. While they can both be <code dir="auto">false</code> simultaneously, they
cannot be <code dir="auto">true</code> at the same time. The fact that only <strong>one</strong> local
block of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure is ever executed is thus not an issue for us.</li>
<li>We evaluate the calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dcrossover">ta.crossover()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dcrossunder">ta.crossunder()</a>
<strong>prior</strong> to entry in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure. Not doing so, as in the following example, would prevent
the functions to be executed on each bar, which would result in a
compiler warning and erratic behavior:</li>
</ul>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Switch without an expression", "", true)

switch
    // Compiler warning! Will not calculate correctly!
    ta.crossover( ta.sma(close, 14), ta.sma(close, 28)) =&gt; strategy.entry("Long ID", strategy.long)
    ta.crossunder(ta.sma(close, 14), ta.sma(close, 28)) =&gt; strategy.entry("Short ID", strategy.short)</code></div>
<h2 class="md-heading" id="matching-local-block-type-requirement"><a href="#matching-local-block-type-requirement">Matching local block type requirement<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When multiple local blocks are used in structures, the type of the
return value of all its local blocks must match. This applies only if
the structure is used to assign a value to a variable in a declaration,
because a variable can only have one type, and if the statement returns
two incompatible types in its branches, the variable type cannot be
properly determined. If the structure is not assigned anywhere, its
branches can return different values.</p>
<p>This code compiles fine because
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
are both of the <code dir="auto">float</code> type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">x = if close &gt; open
    close
else
    open</code></div>
<p>This code does not compile because the first local block returns a
<code dir="auto">float</code> value, while the second one returns a <code dir="auto">string</code>, and the result
of the <code dir="auto">if</code>-statement is assigned to the <code dir="auto">x</code> variable:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Compilation error!
x = if close &gt; open
    close
else
    "open"</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/variable-declarations"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Variable declarations  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/loops"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Loops <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Loops</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-loops"><a href="#loops">Loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Loops are structures that repeatedly execute a block of statements based on specified criteria. They allow scripts to perform repetitive tasks without requiring duplicated lines of code. Pine Script™ features three distinct loop types: <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a>, <a href="/pine-script-docs/v5/language/loops/#while-loops">while</a>, and <a href="/pine-script-docs/v5/language/loops/#forin-loops">for…in</a>.</p>
<p>Every loop structure in Pine Script™ consists of two main parts: a <em>loop header</em> and a <em>loop body</em>. The loop header determines the criteria under which the loop executes. The loop body is the indented block of code (<a href="/pine-script-docs/v5/language/loops/#scope">local block</a>) that the script executes on each loop cycle (<em>iteration</em>) as long as the header’s conditions remain valid. See the <a href="/pine-script-docs/v5/language/loops/#common-characteristics">Common characteristics</a> section to learn more.</p>
<p>Understanding when and how to use loops is essential for making the most of the power of Pine Script™. Inefficient or <a href="/pine-script-docs/v5/language/loops/#when-loops-are-unnecessary">unnecessary</a> usage of loops can lead to suboptimal runtime performance. However, effectively using loops <a href="/pine-script-docs/v5/language/loops/#when-loops-are-necessary">when necessary</a> enables scripts to perform a wide range of calculations that would otherwise be impractical or impossible without them.</p>
<h3 class="md-heading" id="when-loops-are-unnecessary"><a href="#when-loops-are-unnecessary">When loops are unnecessary<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine’s <a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and <a href="/pine-script-docs/v5/language/time-series/">time series</a> structure make loops <em>unnecessary</em> in many situations.</p>
<p>When a user adds a Pine script to a chart, it runs within the equivalent of a <em>large loop</em>, executing its code once on <em>every</em> historical bar and realtime tick in the available data. Scripts can access the values from the executions on previous bars with the <a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">history-referencing operator</a>, and calculated values can <em>persist</em> across executions when assigned to variables declared with the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a> keywords. These capabilities enable scripts to utilize bar-by-bar calculations to accomplish various tasks instead of relying on explicit loops.</p>
<p>In addition, several <a href="/pine-script-docs/v5/language/built-ins/">built-ins</a>, such as those in the <code dir="auto">ta.*</code> namespace, are internally optimized to eliminate the need to use loops for various calculations.</p>
<p>Let’s consider a simple example demonstrating unnecessary loop usage in Pine Script™. To calculate the average <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> over a specified number of bars, newcomers to Pine may write a code like the following, which uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop to calculate the sum of historical values over <code dir="auto">lengthInput</code> bars and divides the result by the <code dir="auto">lengthInput</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="508" loading="lazy" src="images/63c8c7f24ed546fe8493fe1feffadf1e.webp" width="1316"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Unnecessary loops demo", overlay = true)

//@variable The number of bars in the calculation window.
int lengthInput = input.int(defval = 20, title = "Length")

//@variable The sum of `close` values over `lengthInput` bars.
float closeSum = 0

// Loop over the most recent `lengthInput` bars, adding each bar's `close` to the `closeSum`.
for i = 0 to lengthInput - 1
    closeSum += close[i]

//@variable The average `close` value over `lengthInput` bars.
float avgClose = closeSum / lengthInput

// Plot the `avgClose`.
plot(avgClose, "Average close", color.orange, 2)</code></div>
<p>Using a <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a> loop is an <strong>unnecessary</strong>, inefficient way to accomplish tasks like this in Pine. There are several ways to leverage the <a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and the available built-ins to eliminate this loop. Below, we replaced these calculations with a simple call to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a> function. This code is shorter, and it achieves the same result much more efficiently:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="506" loading="lazy" src="images/ec9978d5d7971309a0d622362302fc07.webp" width="1314"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Unnecessary loops corrected demo", overlay = true)

//@variable The number of bars in the calculation window.
int lengthInput = input.int(defval = 20, title = "Length")

//@variable The average `close` value over `lengthInput` bars.
float avgClose = ta.sma(close, lengthInput)

// Plot the `avgClose`.
plot(avgClose, "Average close", color.blue, 2)</code></div>
<p>Note that:</p>
<ul>
<li>Users can see the substantial difference in efficiency between these two example scripts by analyzing their performance with the <a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a>.</li>
</ul>
<h3 class="md-heading" id="when-loops-are-necessary"><a href="#when-loops-are-necessary">When loops are necessary<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Although Pine’s <a href="/pine-script-docs/v5/language/execution-model/">execution model</a>, <a href="/pine-script-docs/v5/language/time-series/">time series</a>, and available <a href="/pine-script-docs/v5/language/built-ins/">built-ins</a> often eliminate the need for loops in many cases, not all iterative tasks have loop-free alternatives. Loops <em>are necessary</em> for several types of tasks, including:</p>
<ul>
<li>Iterating through or manipulating <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and <a href="/pine-script-docs/v5/language/maps/">maps</a>)</li>
<li>Performing calculations that one <strong>cannot</strong> accomplish with loop-free expressions or the available built-ins</li>
<li>Looking back through history to analyze past bars with a reference value only available on the <em>current bar</em></li>
</ul>
<p>For example, a loop is <em>necessary</em> to identify which past bars’ <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> values are above the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> because the current value is <strong>not</strong> obtainable during a script’s executions on previous bars. The script can only access the current bar’s value while it executes on that bar, and it must <em>look back</em> through the historical series during that execution to compare the previous values.</p>
<p>The script below uses a <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a> loop to compare the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> values of <code dir="auto">lengthInput</code> previous bars with the last historical bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>. Within the loop, it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> to draw a circular <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> above each past bar that has a <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> value exceeding that of the last historical bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="528" loading="lazy" src="images/b0d3177e6db07b4d3aac472640f2b33d.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Necessary loop demo", overlay = true, max_labels_count = 500)

//@variable The number of previous `high` values to compare to the last historical bar's `high`. 
int lengthInput = input.int(20, "Length", 1, 500)

if barstate.islastconfirmedhistory
    // Draw a horizontal line segment at the last historical bar's `high` to visualize the level. 
    line.new(bar_index - lengthInput, high, bar_index, high, color = color.gray, style = line.style_dashed, width = 2)
    // Create a `for` loop that counts from 1 to `lengthInput`.
    for i = 1 to lengthInput
        // Draw a circular `label` above the bar from `i` bars ago if that bar's `high` is above the current `high`.
        if high[i] &gt; high
            label.new(
                 bar_index - i, na, "", yloc = yloc.abovebar, color = color.purple, 
                 style = label.style_circle, size = size.tiny
             )

// Highlight the last historical bar.
barcolor(barstate.islastconfirmedhistory ? color.orange : na, title = "Last historical bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>Each <em>iteration</em> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop retrieves a previous bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> with the history-referencing operator <a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>, using the loop’s <em>counter</em> (<code dir="auto">i</code>) as the historical offset. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> call also uses the counter to determine each label’s x-coordinate.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator</a> declaration statement includes <code dir="auto">max_labels_count = 500</code>, meaning the script can show up to 500 <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on the chart.</li>
<li>The script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a> to highlight the last historical chart bar, and it draws a horizontal <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> at that bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> for visual reference.</li>
</ul>
<h2 class="md-heading" id="common-characteristics"><a href="#common-characteristics">Common characteristics<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a>, <a href="/pine-script-docs/v5/language/loops/#while-loops">while</a>, and <a href="/pine-script-docs/v5/language/loops/#forin-loops">for…in</a> loop statements all have similarities in their structure, syntax, and general behavior. Before we explore each specific loop type, let’s familiarize ourselves with these characteristics.</p>
<h3 class="md-heading" id="structure-and-syntax"><a href="#structure-and-syntax">Structure and syntax<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In any loop statement, programmers define the criteria under which a script remains in a loop and performs <em>iterations</em>, where an iteration refers to <em>one execution</em> of the code within the loop’s <a href="/pine-script-docs/v5/language/loops/#scope">local block</a> (<em>body</em>). These criteria are part of the <em>loop header</em>. A script evaluates the header’s criteria <em>before</em> each iteration, only allowing new iterations to occur while they remain valid. When the header’s criteria are no longer valid, the script <em>exits</em> the loop and skips over its body.</p>
<p>The specific header syntax varies with each loop statement (<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>, or <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>) because each uses <em>distinct</em> criteria to control its iterations. Effective use of loops entails choosing the structure with control criteria best suited for a script’s required tasks. See the <a href="/pine-script-docs/v5/language/loops/#for-loops">`for` loops</a>, <a href="/pine-script-docs/v5/language/loops/#while-loops">`while` loops</a>, and <a href="/pine-script-docs/v5/language/loops/#forin-loops">`for…in` loops</a> sections below for more information on each loop statement and its control criteria.</p>
<p>All loop statements in Pine Script™ follow the same general syntax:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var_declaration =] loop_header</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></link></div>
<p>Where:</p>
<ul>
<li><code dir="auto">loop_header</code> refers to the loop structure’s header statement, which defines the criteria that control its iterations.</li>
<li><code dir="auto">statements</code> refers to the code statements and expressions within the loop’s body, i.e., the <em>indented</em> block of code beneath the loop header. All statements within the body belong to the loop’s <a href="/pine-script-docs/v5/language/loops/#scope">local scope</a>.</li>
<li><code dir="auto">continue</code> and <code dir="auto">break</code> are loop-specific <em>keywords</em> that control the flow of a loop’s iterations. The <code dir="auto">continue</code> keyword instructs the script to <em>skip</em> the remainder of the current loop iteration and <em>continue</em> to the next iteration. The <code dir="auto">break</code> keyword prompts the script to <em>stop</em> the current iteration and <em>exit</em> the loop entirely. See <a href="/pine-script-docs/v5/language/loops/#keywords-and-return-expressions">this section</a> for more information.</li>
<li><code dir="auto">return_expression</code> represents the last code line or block within the loop’s body. The loop returns the results from this code after the final iteration. To use the values from a loop’s return expression, <em>assign</em> the results to a variable or <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a>.</li>
<li><code dir="auto">var_declaration</code> is an optional variable or tuple <a href="/pine-script-docs/v5/language/variable-declarations/">declaration</a>. If a loop statement includes a declared variable or tuple, the <code dir="auto">return_expression</code> determines the assigned values. If the header’s conditions do not allow the loop to iterate, the assigned values are <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</li>
</ul>
<h3 class="md-heading" id="scope"><a href="#scope">Scope<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>All code lines that a script will execute within a loop must have an indentation of <em>four spaces</em> or a <em>tab</em> relative to the loop’s header. The indented lines following the header define the loop’s body. This code represents a <em>local block</em>, meaning that all the definitions within the body are accessible only during the loop’s execution. In other words, the code within the loop’s body is part of its <em>local scope</em>.</p>
<p>Scripts can modify and <a href="/pine-script-docs/v5/language/variable-declarations/#variable-reassignment">reassign</a> most variables from <em>outer</em> scopes inside a loop. However, any variables declared within the loop’s body strictly belong to that loop’s local scope. A script <strong>cannot</strong> access a loop’s declared variables <em>outside</em> its local block.</p>
<p>Note that:</p>
<ul>
<li>Variables declared within a loop’s <em>header</em> are also part of the local scope. For instance, a script cannot use the <em>counter variable</em> in a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop anywhere but within the loop’s local block.</li>
</ul>
<p>The body of any Pine loop statement can include <a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> and <em>nested</em> loop statements. When a loop includes nested structures, each structure within the body maintains a <em>distinct</em> local scope. For example, variables declared within an <em>outer</em> loop’s scope are accessible to an <em>inner</em> loop. However, any variables declared within the inner loop’s scope are <strong>not</strong> accessible to the outer loop.</p>
<p>The simple example below demonstrates how a loop’s local scope works. This script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> within a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop on the last historical bar to draw <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> above <code dir="auto">lengthInput</code> past bars. The color of each label depends on the <code dir="auto">labelColor</code> variable declared <em>within</em> the loop’s local block, and each label’s location depends on the loop counter (<code dir="auto">i</code>):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="448" loading="lazy" src="images/21f99f57dfcdc2735f1409c9a051c372.webp" width="996"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop scope demo", overlay = true)

//@variable The number of bars in the calculation.
int lengthInput = input.int(20, "Lookback length", 1)

if barstate.islastconfirmedhistory
    for i = 1 to lengthInput
        //@variable Has a value of `color.blue` if `close[i]` is above the current `close`, `color.orange` otherwise.
        //          This variable is LOCAL to the `for` loop's scope.
        color labelColor = close[i] &gt; close ? color.blue : color.orange
        // Display a colored `label` on the historical `high` from `i` bars back, using `labelColor` to set the color.
        label.new(bar_index - i, high[i], "", color = labelColor, size = size.normal)</code></div>
<p>In the above code, the <code dir="auto">i</code> and <code dir="auto">labelColor</code> variables are only accessible to the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop’s local scope. They are <strong>not</strong> usable within any outer scopes. Here, we added a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> call <em>after</em> the loop with <code dir="auto">bar_index - i</code> as the <code dir="auto">x</code> argument and <code dir="auto">labelColor</code> as the <code dir="auto">color</code> argument. This code causes a <em>compilation error</em> because neither <code dir="auto">i</code> nor <code dir="auto">labelColor</code> are valid variables in the outer scope:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop scope demo", overlay = true)

//@variable The number of bars in the calculation.
int lengthInput = input.int(20, "Lookback length", 1)

if barstate.islastconfirmedhistory
    for i = 1 to lengthInput
        //@variable Has a value of `color.blue` if `close[i]` is above the current `close`, `color.orange` otherwise.
        //          This variable is LOCAL to the `for` loop's scope.
        color labelColor = close[i] &gt; close ? color.blue : color.orange
        // Display a colored `label` on the historical `high` from `i` bars back, using `labelColor` to set the color.
        label.new(bar_index - i, high[i], "", color = labelColor, size = size.normal)

    // Call `label.new()` to using the `i` and `labelColor` variables outside the loop's local scope.
    // This code causes a compilation error because these variables are not accessible in this location.  
    label.new(
         bar_index - i, low, "Scope test", textcolor = color.white, color = labelColor, style = label.style_label_up
     )</code></div>
<h3 class="md-heading" id="keywords-and-return-expressions"><a href="#keywords-and-return-expressions">Keywords and return expressions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Every loop in Pine Script™ implicitly <em>returns</em> a result. The values a loop returns come from the <em>latest</em> execution of the <em>last</em> expression or nested structure within the loop body as of the <em>final</em> iteration. Loops return <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values when no iterations occur. A loop’s returned results are <em>usable</em> only if they are not of the <a href="/pine-script-docs/v5/language/type-system/#void">void</a> type and the script assigns a variable or tuple <a href="/pine-script-docs/v5/language/variable-declarations/">declaration</a> to the loop statement. The declared variables hold the values from the return expression for use in additional calculations outside the loop’s <a href="/pine-script-docs/v5/language/loops/#scope">scope</a>.</p>
<p>The values a loop returns may come from evaluating the last written expression or nested code block on the <em>final</em> iteration. However, a loop’s body can include <code dir="auto">continue</code> and <code dir="auto">break</code> keywords to control the flow of iterations beyond the criteria the loop header specifies, which can also affect the returned results. Programmers often include these keywords within <a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> to control how iterations behave when certain conditions occur.</p>
<p>The <code dir="auto">continue</code> keyword instructs a script to <em>skip</em> the remaining statements and expressions in the current loop iteration, re-evaluate the loop header’s criteria, and proceed to the <em>next</em> iteration. The script <em>exits</em> the loop if the header’s criteria do not allow another iteration.</p>
<p>The <code dir="auto">break</code> keyword instructs a script to <em>stop</em> the loop entirely and immediately <em>exit</em> at that point without allowing any subsequent iterations. After breaking the loop, the script skips any remaining code within the loop’s body and <em>does not</em> re-evaluate the header’s criteria.</p>
<p>If a loop stops <em>prematurely</em> due to a <code dir="auto">continue</code> or <code dir="auto">break</code> keyword, it returns the values from the <em>last iteration</em> where the script <em>evaluated</em> the return expression. If the script <em>did not</em> evaluate the return expression across any of the loop’s iterations, the loop returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> results.</p>
<p>The example below selectively displays numbers from an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> on the last historical bar. It uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to iterate through the array’s elements and build a “string” to use as the displayed text. The loop’s body contains an <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> statement that controls the flow of specific iterations. If the <code dir="auto">number</code> in the current iteration is 8, the script immediately <em>exits</em> the loop using the <code dir="auto">break</code> keyword. Otherwise, if the <code dir="auto">number</code> is even, it <em>skips</em> the rest of the current iteration and moves to the next one using the <code dir="auto">continue</code> keyword.</p>
<p>If neither of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> statement’s conditions occur, the script evaluates the <em>last expression</em> within the loop’s body (i.e., the return expression), which converts the current <code dir="auto">number</code> to a “string” and concatenates the result with the <code dir="auto">tempString</code> value. The loop returns the <em>last evaluated result</em> from this expression after termination. The script assigns the returned value to the <code dir="auto">finalLabelText</code> variable and uses that variable as the <code dir="auto">text</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="282" loading="lazy" src="images/d87773fd2dec4adb76fadd706c644d11.webp" width="750"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop keywords and variable assignment demo")

//@variable An `array` of arbitrary "int" values to selectively convert to "string" and display in a `label`.
var array&lt;int&gt; randomArray = array.from(1, 5, 2, -3, 14, 7, 9, 8, 15, 12)

// Label creation logic.
if barstate.islastconfirmedhistory
    //@variable A "string" containing representations of selected values from the `randomArray`.
    string tempString = ""
    //@variable The final text to display in the `label`. The `for..in` loop returns the result after it terminates.
    string finalLabelText = for number in randomArray
        // Stop the current iteration and exit the loop if the `number` from the `randomArray` is 8.
        if number == 8             
            break 
        // Skip the rest of the current iteration and proceed to the next iteration if the `number` is even.   
        else if number % 2 == 0   
            continue
        // Convert the `number` to a "string", append ", ", and concatenate the result with the current `tempString`.
        // This code represents the loop's return expression. 
        tempString += str.tostring(number) + ", "
    
    // Display the value of the `finalLabelText` within a `label` on the current bar.
    label.new(bar_index, 0, finalLabelText, color = color.blue, textcolor = color.white, size = size.huge)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> displays only <em>odd</em> numbers from the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> because the script does not reassign the <code dir="auto">tempString</code> when the loop iteration’s <code dir="auto">number</code> is even. However, it does not include the <em>last</em> odd number from the array (15) because the loop stops when <code dir="auto">number == 8</code>, preventing iteration over the remaining <code dir="auto">randomArray</code> elements.</li>
<li>When the script exits the loop due to the <code dir="auto">break</code> keyword, the loop’s return value becomes the last evaluated result from the <code dir="auto">tempString</code> reassignment expression. In this case, the last time that code executes is on the iteration where <code dir="auto">number == 9</code>.</li>
</ul>
<h2 class="md-heading" id="for-loops"><a href="#for-loops">`for` loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop statement creates a <em>count-controlled</em> loop, which uses a <em>counter</em> variable to manage the executions of its local code block over a <em>defined number</em> of iterations.</p>
<p>Pine Script™ uses the following syntax to define a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var_declaration =] for counter = from_num to to_num [by step_num]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where the following parts define the <em>loop header</em>:</p>
<ul>
<li><code dir="auto">counter</code> represents the <em>variable</em> whose value the loop increments after each iteration.</li>
<li><code dir="auto">from_num</code> determines the <code dir="auto">counter</code> variable’s <em>initial value</em>, i.e., the value on the first iteration.</li>
<li><code dir="auto">to_num</code> determines the <code dir="auto">counter</code> variable’s <em>final value</em>, i.e., the maximum value of the loop counter that the header allows a new iteration for. The loop increments the <code dir="auto">counter</code> value by a fixed amount until it <em>reaches or passes</em> this value.</li>
<li><code dir="auto">step_num</code> is the amount by which the <code dir="auto">counter</code> value increases or decreases after each iteration until it reaches or passes the <code dir="auto">to_num</code>. Specifying this value is optional. The default value is 1.</li>
</ul>
<p>See the <a href="/pine-script-docs/v5/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">var_declaration</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>This simple script demonstrates a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop that draws several <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> at future bar indices during its execution on the last historical chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="322" loading="lazy" src="images/78304ca106502d0fcc094de653963d2f.webp" width="868"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Simple `for` loop demo")

if barstate.islastconfirmedhistory
    // Define a `for` loop that iterates from `i == 0` to `i == 10`.
    for i = 0 to 10
        // Draw a new `label` on the current bar at the `i` level. 
        label.new(bar_index + i, 0, str.tostring(i), textcolor = color.white, size = size.large)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">i</code> variable represents the loop’s <em>counter</em>. This variable is local to the loop’s <a href="/pine-script-docs/v5/language/loops/#scope">scope</a>, meaning no <em>outer scopes</em> can access it. The code uses the variable within the loop’s body to determine the location and text of each <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> drawing.</li>
<li>Programmers often use <code dir="auto">i</code>, <code dir="auto">j</code>, and <code dir="auto">k</code> as loop counter identifiers. However, <em>any</em> valid variable name is allowed. For example, this code would behave the same if we named the counter <code dir="auto">level</code> instead of <code dir="auto">i</code>.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop structure <em>automatically</em> manages the counter variable. We do not need to define code in the loop’s body to increment its value.</li>
<li>The loop’s header specifies that the counter starts at 0 when the script enters the loop, and its value increases by 1 after each iteration until it reaches 10, at which point the last iteration occurs. In other words, the loop executes <em>11 iterations</em> in total.</li>
</ul>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop’s local block repeatedly executes for the number of times required for its counter variable’s value to reach the specified <code dir="auto">to_num</code> boundary. The counter’s defined boundaries and step size directly control the number of loop iterations. Therefore, a script establishes the expected number of iterations <em>before</em> the loop starts. As such, <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loops are best suited for iterative tasks where the maximum number of iterations is knowable <em>in advance</em>.</p>
<p>The example below calculates and plots the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.vwma">volume-weighted moving average</a> (VWMA) of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a> prices across <code dir="auto">maLengthInput</code> chart bars, and it analyzes the differences between the current <code dir="auto">vwmaOpen</code> and past <code dir="auto">vwmaOpen</code> values within a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop on the last historical chart bar. On each loop iteration, the script retrieves a previous bar’s <code dir="auto">vwmaOpen</code> value, takes the difference between that value and the current <code dir="auto">vwmaOpen</code>, and displays the result in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> at the corresponding historical bar’s opening price:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/d5212597fde6202cd1813e7d68ba8702.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for` loop demo", "VWMA differences", true, max_labels_count = 500)

//@variable Display color for indicator visuals.
const color DISPLAY_COLOR = color.rgb(17, 127, 218)

//@variable The number of bars in the `vwmaOpen` calculation.
int maLengthInput = input.int(20, "VWMA length", 1)
//@variable The number of past bars to look back through and compare to the current bar.
int lookbackInput = input.int(15, "Lookback length", 1, 500)

//@variable The volume-weighted moving average of `open` values over `maLengthInput` bars. 
float vwmaOpen = ta.vwma(open, maLengthInput)

//On last bar, loop through `lengthInput` most recent historical bars and output `label` of differences in `vwmaOpen`.
if barstate.islastconfirmedhistory
    for i = lookbackInput to 1
        //@variable The difference between the `vwmaOpen` from `i` bars ago and the current `vwmaOpen`.
        float vwmaDifference = vwmaOpen[i] - vwmaOpen
        //@variable A "string" representation of the `vwmaDifference` with sign specification and rounding. 
        string displayText = (vwmaDifference &gt; 0 ? "+" : "") + str.tostring(vwmaDifference, "0.00")
        // Draw a `label` showing the `displayText` at the `open` of the bar from `i` bars back.
        label.new(
             bar_index - i, open[i], displayText, textcolor = color.white, color = DISPLAY_COLOR,
             style = label.style_label_lower_right, size = size.normal
         )

// Plot the `vwmaOpen`.
plot(vwmaOpen, "VWMA", color = DISPLAY_COLOR, linewidth = 2)</code></div>
<p>Note that:</p>
<ul>
<li>The script uses the loop’s counter (<code dir="auto">i</code>) to within the <a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">history-referencing operator</a> to retrieve past values of the <code dir="auto">vwmaOpen</code> series. It also uses the counter to determine the location of each <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> drawing.</li>
<li>The loop counter’s value starts at the <code dir="auto">lookbackInput</code> and <em>decreases</em> by 1 until <code dir="auto">i == 1</code>.</li>
</ul>
<p>Programmers can use <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loops to iterate through <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>, such as <a href="/pine-script-docs/v5/language/arrays">arrays</a> and <a href="/pine-script-docs/v5/language/matrices">matrices</a>. The loop’s counter can serve as an <em>index</em> for retrieving or modifying a collection’s contents. For example, this code block uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a> inside a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop to successively retrieve elements from an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for i = 0 to array.size(myArray) – 1
   element = array.get(i)</code></div>
<p>Note that:</p>
<ul>
<li>Array <em>indexing</em> starts from 0, but the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a> function <em>counts</em> the elements (i.e., starting from 1). Therefore, we have to subtract one from the array’s size to get the maximum index value. This way, the loop counter avoids representing an array index that is <a href="/pine-script-docs/v5/language/arrays/#index-xx-is-out-of-bounds-array-size-is-yy">out of bounds</a> on the last loop iteration.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement is often the <em>preferred</em> way to loop through <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>. However, programmers may prefer a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop for some tasks, such as looping through stepped index values, iterating over a collection’s contents in reverse or a nonlinear order, and more. See the <a href="/pine-script-docs/v5/language/loops/#looping-through-arrays">Looping through arrays</a> and <a href="/pine-script-docs/v5/language/loops/#looping-through-matrices">Looping through matrices</a> sections to learn more about the best practices for looping through these collection types.</li>
</ul>
<p>The script below calculates the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi">RSI</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.mom">momentum</a> of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> prices over three different lengths (10, 20, and 50) and displays their values within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the last chart bar. It stores “string” values for the header title within <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and the “float” values of the calculated indicators within a 2x3 <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop to access the elements in the arrays and initialize the <code dir="auto">displayTable</code> header cells. It then uses <em>nested</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loops to iterate over the <em>row</em> and <em>column</em> indices in the <code dir="auto">taMatrix</code> to access its elements, convert their values to strings, and populate the remaining <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> cells:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="390" loading="lazy" src="images/fe910ad694f7a83999a70733b2847270.webp" width="932"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for` loop with collections demo", "Table of TA Indexes", overlay = true)

// Calculate the RSI and momentum of `close` values with constant lengths of 10, 20, and 50.
float rsi10 = ta.rsi(close, 10)
float rsi20 = ta.rsi(close, 20)
float rsi50 = ta.rsi(close, 50)
float mom10 = ta.mom(close, 10)
float mom20 = ta.mom(close, 20)
float mom50 = ta.mom(close, 50)
 
if barstate.islast
    //@variable A `table` that displays indicator values in the top-right corner of the chart. 
    var table displayTable = table.new(
         position.top_right, columns = 5, rows = 4, border_color = color.black, border_width = 1 
     )
    //@variable An array containing the "string" titles to display within the side header of each table row. 
    array&lt;string&gt; sideHeaderTitles = array.from("TA Index", "RSI", "Momentum")
    //@variable An array containing the "string" titles to representing the length of each displayed indicator. 
    array&lt;string&gt; topHeaderTitles = array.from("10", "20", "50")
    //@variable A matrix containing the values to display within the table. 
    matrix&lt;float&gt; taMatrix = matrix.new&lt;float&gt;()
    // Populate the `taMatrix` with indicator values. The first row contains RSI data and the second contains momentum.
    taMatrix.add_row(0, array.from(rsi10, rsi20, rsi50, mom10, mom20, mom50))
    taMatrix.reshape(2, 3)

    // Initialize top header cells.
    displayTable.cell(1, 0, "Bars Length", text_color = color.white, bgcolor = color.blue)
    displayTable.merge_cells(1, 0, 3, 0)

    // Initialize additional header cells within a `for` loop. 
    for i = 0 to 2
        displayTable.cell(0, i + 1, sideHeaderTitles.get(i), text_color = color.white, bgcolor = color.blue)
        displayTable.cell(i + 1, 1, topHeaderTitles.get(i), text_color = color.white, bgcolor = color.purple)

    // Use nested `for` loops to iterate through the row and column indices of the `taMatrix`.
    for i = 0 to taMatrix.rows() - 1 
        for j = 0 to taMatrix.columns() - 1
            //@variable The value stored in the `taMatrix` at the `i` row and `j` column. 
            float elementValue =  taMatrix.get(i, j)
            // Initialize a cell in the `displayTable` at the `i + 2` row and `j + 1` column showing a "string" 
            // representation of the `elementValue`.
            displayTable.cell(
                 column = j + 1, row = i + 2, text = str.tostring(elementValue, "#.##"), text_color = chart.fg_color
             )</code></div>
<p>Note that:</p>
<ul>
<li>Both <a href="/pine-script-docs/v5/language/arrays/">arrays</a> of header names (<code dir="auto">sideHeaderTitles</code> and <code dir="auto">topHeaderTitles</code>) contain the same number of elements, which allows us to iterate through their contents simultaneously using a single <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop.</li>
<li>The nested <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loops iterate over <em>all</em> the index values in the <code dir="auto">taMatrix</code>. The <em>outer</em> loop iterates over each <em>row</em> index, and the <em>inner</em> loop iterates over every <em>column</em> index on each outer loop iteration.</li>
<li>The script creates and displays the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> only on the last historical bar and all realtime bars because the historical states of <a href="/pine-script-docs/v5/concepts/tables/">tables</a> are <em>never</em> visible. See <a href="https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization/#reducing-drawing-updates">this section</a> of the <a href="/pine-script-docs/v5/writing/profiling-and-optimization/">Profiling and optimization</a> page for more information.</li>
</ul>
<h2 class="md-heading" id="while-loops"><a href="#while-loops">`while` loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop statement creates a <em>condition-controlled</em> loop, which uses a <em>conditional expression</em> to control the executions of its local block. The loop continues its iterations as long as the conditional expression remains <code dir="auto">true</code>.</p>
<p>Pine Script™ uses the following syntax to define a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var_declaration =] while condition</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where the <code dir="auto">condition</code> in the loop’s <em>header</em> can be a literal, variable, expression, or function call that returns a “bool” value.</p>
<p>See the <a href="/pine-script-docs/v5/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">var_declaration</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop’s header evaluates its <code dir="auto">condition</code> before each iteration. Consequently, when the script modifies the condition within an iteration, the loop’s header reflects those changes on the <em>next</em> iteration.</p>
<p>Depending on the specified condition in the loop header, a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop can behave similarly to a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop, continuing iteration until a <em>counter</em> variable reaches a specified limit. For example, the following script uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop and <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop to perform the same task. Both loops draw a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> displaying their respective counter value on each iteration:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="316" loading="lazy" src="images/f80d7a620b8fa2c7f8e9102e867b12d5.webp" width="868"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`while` loop with a counter condition demo")

if barstate.islastconfirmedhistory
    // A `for` loop that creates blue labels displaying each `i` value.
    for i = 0 to 10
        label.new(
             bar_index + i, 0, str.tostring(i), color = color.blue, textcolor = color.white, 
             size = size.large, style = label.style_label_down
         )

    //@variable An "int" to use as a counter within a `while` loop.
    int j = 0
    // A `while` loop that creates orange labels displaying each `j` value.
    while j &lt;= 10
        label.new(
             bar_index + j, 0, str.tostring(j), color = color.orange, textcolor = color.white, 
             size = size.large, style = label.style_label_up
         )
        // Update the `j` counter within the local block.
        j += 1</code></div>
<p>Note that:</p>
<ul>
<li>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop uses count-based logic, it must explicitly manage the user-specified counter within the local block. In contrast, a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop increments its counter automatically.</li>
<li>The script declares the variable the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop uses as a counter <em>outside</em> the loop’s <a href="/pine-script-docs/v5/language/loops/#scope">scope</a>, meaning its value is usable in additional calculations after the loop terminates.</li>
<li>If this code did not increment the <code dir="auto">j</code> variable within the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop’s body, the value would <em>never</em> reach 10, meaning the loop would run <em>indefinitely</em> until causing a <a href="/pine-script-docs/v5/error-messages/#loop-is-too-long--500-ms">runtime error</a>.</li>
</ul>
<p>Because a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop’s execution depends on its condition remaining <code dir="auto">true</code> and the condition may not change on a specific iteration, the <em>precise</em> number of expected iterations may <strong>not</strong> be knowable <em>before</em> the loop begins, unlike a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop. Therefore, <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loops are advantageous in scenarios where the exact loop boundaries are <em>unknown</em>.</p>
<p>The script below tracks when the chart’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> crosses outside Keltner Channels with a user-specified length and channel width. When the price crosses outside the current bar’s channel, the script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a> highlighting all the previous <em>consecutive</em> bars with <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> values within that price window. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop to analyze past bars’ prices and incrementally adjust the left side of each new <a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a> until the drawing covers all the latest consecutive bars in the current range.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop is necessary in this case because the current bar’s channel values are <em>not</em> knowable in advance, and we <strong>cannot</strong> predict the precise number of iterations required to encapsulate all the consecutive bars within the channel’s range:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="560" loading="lazy" src="images/e753a91f6b372ea74683ae190ca1d5bd.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`while` loop demo", "Price window boxes", true)

//@variable The length of the channel.
int lengthInput = input.int(20, "Channel length", 1, 4999)
//@variable The width multiplier of the channel. 
float widthInput = input.float(2.0, "Width multiplier", 0)

//@variable The `lengthInput`-bar EMA of `close` prices.
float ma = ta.ema(close, lengthInput)
//@variable The `lengthInput`-bar ATR, multiplied by the `widthInput`.
float atr = ta.atr(lengthInput) * widthInput
//@variable The lower bound of the channel.
float channelLow = ma - atr
//@variable The upper bound of the channel. 
float channelHigh = ma + atr

//@variable Is `true` when the `close` price is outside the current channel range, `false` otherwise. 
bool priceOutsideChannel = close &lt; channelLow or close &gt; channelHigh

// Check if the `close` crossed outside the channel range, then analyze the past bars within the current range. 
if priceOutsideChannel and not priceOutsideChannel[1]
    //@variable A box that highlights consecutive past bars within the current channel's price window.  
    box windowBox = box.new(
         bar_index, channelHigh, bar_index, channelLow, border_width = 2, bgcolor = color.new(color.gray, 85)
     )
    //@variable The lookback index for box adjustment. The `while` loop increments this value on each iteration. 
    int i = 1
    // Use a `while` loop to look backward through close` prices. The loop iterates as long as the past `close` 
    // from `i` bars ago is between the current bar's `channelLow` and `channelHigh`. 
    while close[i] &gt;= channelLow and close[i] &lt;= channelHigh
        // Adjust the left side of the box. 
        windowBox.set_left(bar_index - i)
        // Add 1 to the `i` value to check the `close` from the next bar back on the next iteration. 
        i += 1

// Plot the `channelLow` and `channelHigh` for visual reference. 
plot(channelLow, "Channel low")
plot(channelHigh, "Channel high")</code></div>
<p>Note that:</p>
<ul>
<li>The left and right edges of <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> sit within the horizontal <em>center</em> of their respective bars, meaning that each drawing spans from the middle of the first consecutive bar to the middle of the last bar within each window.</li>
<li>This script uses the <code dir="auto">i</code> variable as a <a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">history-referencing</a> index within the <em>conditional expression</em> the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop checks on each iteration. The variable <strong>does not</strong> behave as a loop counter, as the iteration boundaries are <strong>unknown</strong>. The loop executes its local block repeatedly until the condition becomes <code dir="auto">false</code>.</li>
</ul>
<h2 class="md-heading" id="forin-loops"><a href="#forin-loops">`for…in` loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement creates a <em>collection-controlled</em> loop, which uses the <em>contents</em> of a <a href="/pine-script-docs/v5/language/type-system/#collections">collection</a> to control its iterations. This loop structure is often the preferred approach for looping through <a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and <a href="/pine-script-docs/v5/language/maps/">maps</a>.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop traverses a collection <em>in order</em>, retrieving one of its stored items on each iteration. Therefore, the loop’s boundaries depend directly on the number of <em>items</em> (<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> <em>elements</em>, <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> <em>rows</em>, or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> <em>key-value pairs</em>). As such, similar to a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop, a script establishes the expected number of <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop iterations <em>before</em> the loop starts.</p>
<p>Pine Script™ features <em>two</em> general forms of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement. The <em>first form</em> uses the following syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var_declaration =] for item in collection_id</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where <code dir="auto">item</code> is a <em>variable</em> that holds sequential values from the specified <code dir="auto">collection_id</code>. The variable’s value starts with the collection’s <em>first item</em> and takes on successive items in order after each iteration. This form is convenient when a script must access values from an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> iteratively but does not require the item’s index in its calculations.</p>
<p>The <em>second form</em> has a slightly different syntax that includes a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> in its <em>header</em>:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var_declaration =] for [index, item] in collection_id</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">statements | continue | break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">return_expression</span></div></div></code></pre></figure></div>
<p>Where <code dir="auto">index</code> is a variable that contains the <em>index</em> or <em>key</em> of the retrieved <code dir="auto">item</code>. This form is convenient when a task requires using a collection’s items <em>and</em> their indices in iterative calculations. This form of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop is required when directly iterating through the contents of a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>. See <a href="/pine-script-docs/v5/language/loops/#looping-through-maps">this section</a> for more information.</p>
<p>See the <a href="/pine-script-docs/v5/language/loops/#common-characteristics">Common characteristics</a> section above for detailed information about the <code dir="auto">var_declaration</code>, <code dir="auto">statements</code>, <code dir="auto">continue</code>, <code dir="auto">break</code>, and <code dir="auto">return_expression</code> parts of the loop’s syntax.</p>
<p>The iterative behavior of a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop depends on the <em>type</em> of collection the header specifies as the <code dir="auto">collection_id</code>:</p>
<ul>
<li>When using an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> in the header, the loop performs <a href="/pine-script-docs/v5/language/loops/#looping-through-arrays"><em>element-wise</em> iteration</a>, meaning the retrieved <code dir="auto">item</code> on each iteration is one of the array’s <em>elements</em>.</li>
<li>When using a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> in the header, the loop performs <a href="/pine-script-docs/v5/language/loops/#looping-through-matrices"><em>row-wise</em> iteration</a>, which means that each <code dir="auto">item</code> represents a <em>row array</em>.</li>
<li>When using a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> in the header, the loop performs <a href="/pine-script-docs/v5/language/loops/#looping-through-maps"><em>pair-wise</em> iteration</a>, which retrieves a <em>key</em> and corresponding <em>value</em> on each iteration.</li>
</ul>
<h3 class="md-heading" id="looping-through-arrays"><a href="#looping-through-arrays">Looping through arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine scripts can iterate over the elements of <a href="/pine-script-docs/v5/language/arrays/">arrays</a> using any loop structure. However, the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop is typically the most convenient because it automatically verifies the size of an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> when controlling iterations. With other loop structures, programmers must carefully set the header’s boundaries or conditions to <em>prevent</em> the loop from attempting to access an element at a <em>nonexistent</em> index.</p>
<p>For example, one can use a <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a> loop to access an array’s elements using the counter variable as the lookup index in functions such as <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a>. However, to prevent <a href="/pine-script-docs/v5/language/arrays/#index-xx-is-out-of-bounds-array-size-is-yy">out-of-bounds</a> errors, programmers must ensure the counter always represents a <em>valid index</em>. Additionally, if an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> might be <em>empty</em>, programmers must set conditions to prevent the loop’s execution entirely.</p>
<p>The code below shows a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop whose counter boundaries depend on the number of elements in an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>. If the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> is empty, containing 0 elements, the header’s final counter value is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, which <em>prevents</em> iteration. Otherwise, the final value is <em>one less</em> than the array’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a> (i.e., the index of the last element):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for index = 0 to (array.size(myArray) == 0 ? na : array.size(myArray) - 1)
    element = array.get(myArray, index)</code></div>
<p>In contrast, a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop automatically validates an array’s size and <em>directly</em> accesses its elements, providing a more convenient solution than a traditional <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop. The line below achieves the <em>same effect</em> as the code above without requiring the programmer to define boundaries explicitly or use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a> function to access each element:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for element in myArray</code></div>
<p>The following example examines bars on a lower timeframe to gauge the strength of <em>intrabar</em> trends within each chart bar. The script uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> call to retrieve an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of intrabar <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a> prices from a calculated <code dir="auto">lowerTimeframe</code>. Then, it uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to access each <code dir="auto">price</code> within the <code dir="auto">intrabarPrices</code> array and compare the value to the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> to calculate the bar’s <code dir="auto">strength</code>. The script plots the <code dir="auto">strength</code> as columns in a separate pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="554" loading="lazy" src="images/6014c633f2e86b9963487d05bd462e98.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for element in array` demo", "Intrabar strength")

//@variable A valid timeframe closest to one-tenth of the current chart's timeframe, "1" if the timeframe is too small.
var string lowerTimeframe = timeframe.from_seconds(math.max(int(timeframe.in_seconds() / 10), 60))
//@variable An array of intrabar `hl2` prices calculated from the `lowerTimeframe`.
array&lt;float&gt; intrabarPrices = request.security_lower_tf("", lowerTimeframe, hl2)

//@variable The excess trend strength of `intrabarPrices`. 
float strength = 0.0

// Loop directly through the `intrabarPrices` array. Each iteration's `price` represents an array element.
for price in intrabarPrices
    // Subtract 1 from the `strength` if the retrieved `price` is above the current bar's `close` price. 
    if price &gt; close
        strength -= 1
    // Add 1 to the `strength` if the retrieved `price` is below the current bar's `close` price. 
    else if price &lt; close
        strength += 1

//@variable Is `color.teal` when the `strength` is positive, `color.maroon` otherwise.
color strengthColor = strength &gt; 0 ? color.teal : color.maroon

// Plot the `strength` as columns colored by the `strengthColor`.
plot(strength, "Intrabar strength", strengthColor, 1, plot.style_columns)</code></div>
<p>The <a href="/pine-script-docs/v5/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop is a convenient solution when a script’s calculations require accessing each element <em>and</em> corresponding index within an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for [index, element] in myArray</code></div>
<p>For example, suppose we want to display a <em>numerated</em> list of <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> elements within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> while excluding values at specific indices. We can use the second form of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop structure to accomplish this task. The simple script below declares a <code dir="auto">stringArray</code> variable that references an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of predefined “string” values. On the last historical bar, the script uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to access each <code dir="auto">index</code> and <code dir="auto">element</code> in the <code dir="auto">stringArray</code> to construct the <code dir="auto">labelText</code>, which it uses in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> call after the loop ends:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="400" loading="lazy" src="images/de7d8e7d1ec877ce5f8f3366d520e2bd.webp" width="840"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for [index, item] in array` demo", "Array numerated output")

//@variable An array of "string" values to display as a numerated list.
var array&lt;string&gt; stringArray = array.from("First", "Second", "Third", "Before Last", "Last")

if barstate.islastconfirmedhistory
    //@variable A "string" modified within a loop to display within the `label`.
    string labelText = "Array values: \n"
    // Loop through the `stringArray`, accessing each `index` and corresponding `element`. 
    for [index, element] in stringArray
        // Skip the third `element` (at `index == 2`) in the `labelText`. Include an "ELEMENT SKIPPED" message instead. 
        if index == 2
            labelText += "-- ELEMENT SKIPPED -- \n"
            continue
        labelText += str.tostring(index + 1) + ": " + element + "\n"
    // Display the `labelText` within a `label`.
    label.new(
         bar_index, 0, labelText, textcolor = color.white, size = size.huge, 
         style = label.style_label_center, textalign = text.align_left
     )</code></div>
<p>Note that:</p>
<ul>
<li>This example adds 1 to the <code dir="auto">index</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a> call to start the numerated list with a value of “1”, as <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> indexing always begins at 0.</li>
<li>On the <em>third</em> loop iteration, when <code dir="auto">index == 2</code>, the script adds an “ELEMENT SKIPPED” message to the <code dir="auto">labelText</code> instead of the retrieved <code dir="auto">element</code> and uses the <code dir="auto">continue</code> keyword to skip the remainder of the iteration. See <a href="/pine-script-docs/v5/language/loops/#keywords-and-return-expressions">this section</a> above to learn more about loop keywords.</li>
</ul>
<p>Let’s explore an advanced example demonstrating the utility of <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loops. The following indicator draws a fixed number of horizontal <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> at calculated <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.pivothigh">pivot high</a> levels, and it analyzes the lines within a loop to determine which ones represent active (<em>uncrossed</em>) pivots.</p>
<p>Each time the script detects a new pivot high point, it creates a new <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>, <em>inserts</em> that line at the beginning of the <code dir="auto">pivotLines</code> array, then removes the oldest element and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">deletes</a> its ID. The script accesses each <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> within the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> using a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop, analyzing and <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#modifying-lines">modifying</a> the properties of the <code dir="auto">pivotLine</code> retrieved on each iteration. When the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> crosses above the <code dir="auto">pivotLine</code>, the script changes its style to signify that it is no longer an active level. Otherwise, it extends the line’s <code dir="auto">x2</code> coordinate and uses its <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price">price</a> to calculate the average <em>active</em> pivot value. The script also plots each pivot high value and the average active pivot for visual reference:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="556" loading="lazy" src="images/a4d5ab344ca22e601994230a431e50a9.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for...in` loop with arrays demo", "Active high pivots", true, max_lines_count = 500)

//@variable The number of bars required on the left and right to confirm a pivot point. 
int pivotBarsInput = input.int(5, "Pivot leg length", 1)
//@variable The number of recent pivot lines to analyze. Controls the size of the `pivotLines` array.
int maxRecentLines = input.int(20, "Maximum recent lines", 1, 500)

//@variable An array that acts as a queue holding the most recent pivot high lines. 
var array&lt;line&gt; pivotLines = array.new&lt;line&gt;(maxRecentLines)
//@variable The pivot high price, or `na` if no pivot is found.
float highPivotPrice = ta.pivothigh(pivotBarsInput, pivotBarsInput)
//@variable The average active `highPivotPrice`. 
float avgHiPivot = ta.sma(highPivotPrice, maxRecentLines)

if not na(highPivotPrice)
    //@variable The `chart.point` for the start of the line. Does not contain `time` information.
    firstPoint = chart.point.from_index(bar_index - pivotBarsInput, highPivotPrice)
    //@variable The `chart.point` for the end of each line. Does not contain `time` information.
    secondPoint = chart.point.from_index(bar_index, highPivotPrice)
    //@variable A horizontal line at the new pivot level. 
    line hiPivotLine = line.new(firstPoint, secondPoint, width = 2, color = color.green) 
    // Insert the `hiPivotLine` at the beginning of the `pivotLines` array.
    pivotLines.unshift(hiPivotLine)
    // Remove the oldest line from the array and delete its ID.
    line.delete(pivotLines.pop())

//@variable The sum of active pivot prices.
float activePivotSum = 0.0
//@variable The number of active pivot high levels.
int numActivePivots = 0

// Loop through the `pivotLines` array, directly accessing each `pivotLine` element. 
for pivotLine in pivotLines
    //@variable The `x2` coordinate of the `pivotline`.
    int lineEnd = pivotLine.get_x2()
    // Move to the next `pivotline` in the array if the current line is inactive.
    if pivotLine.get_x2() &lt; bar_index - 1
        continue
    //@variable The price value of the `pivotLine`.
    float pivotPrice = pivotLine.get_price(bar_index)
    // Change the style of the `pivotLine` and stop extending its display if the `high` is above the `pivotPrice`.
    if high &gt; pivotPrice
        pivotLine.set_color(color.maroon)
        pivotLine.set_style(line.style_dotted)
        pivotLine.set_width(1)
        continue
    // Extend the `pivotLine` and add the `pivotPrice` to the `activePivotSum` when the loop allows a full iteration.
    pivotLine.set_x2(bar_index)
    activePivotSum  += pivotPrice
    numActivePivots += 1

//@variable The average active pivot high value.
float avgActivePivot = activePivotSum / numActivePivots

// Plot crosses at the `highPivotPrice`, offset backward by the `pivotBarsInput`.
plot(highPivotPrice, "High pivot marker", color.green, 3, plot.style_cross, offset = -pivotBarsInput)
// Plot the `avgActivePivot` as a line with breaks.
plot(avgActivePivot, "Avg. active pivot", color.orange, 3, plot.style_linebr)</code></div>
<p>Note that:</p>
<ul>
<li>The loop in this example executes on <em>every bar</em> because it has to compare each active <code dir="auto">pivotLine</code>’s price with the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> value, and it uses the prices to calculate the <code dir="auto">avgActivePivot</code> on each bar.</li>
<li>Pine Script™ features several ways to calculate averages, many of which <em>do not</em> require a loop. However, a loop is <a href="/pine-script-docs/v5/language/loops/#when-loops-are-necessary">necessary</a> in this example because the script uses information only available on the <strong>current bar</strong> to determine which prices contribute toward the average.</li>
<li>The <em>first</em> form of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop is the most convenient option in this example because we need direct access to the <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> within the <code dir="auto">pivotLines</code> array, but we do not need the corresponding <em>index</em> values.</li>
</ul>
<h3 class="md-heading" id="looping-through-matrices"><a href="#looping-through-matrices">Looping through matrices<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine scripts can iterate over the contents of a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> in several different ways. Unlike <a href="/pine-script-docs/v5/language/arrays">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a> use <em>two</em> indices to reference their elements because they store data in a <em>rectangular</em> format. The first index refers to <em>rows</em>, and the second refers to <em>columns</em>. If a programmer opts to use <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loops to iterate through <a href="/pine-script-docs/v5/language/matrices/">matrices</a> instead of using <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>, they must carefully define the loop boundaries or conditions to avoid <a href="/pine-script-docs/v5/language/matrices/#the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy">out-of-bounds</a> errors.</p>
<p>This code block shows a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop that performs <em>row-wise</em> iteration, looping through each <em>row index</em> in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> and using the value in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a> call to retrieve a row <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>. If the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> is empty, the loop statement uses a final loop counter value of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> to <em>prevent</em> iteration. Otherwise, the final counter is <em>one less</em> than the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">row count</a>, which represents the <em>last</em> row index:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for rowIndex = 0 to (myMatrix.rows() == 0 ? na : myMatrix.rows() - 1)
    rowArray = myMatrix.row(rowIndex)</code></div>
<p>Note that:</p>
<ul>
<li>If we replace the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">matrix.rows()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a> calls with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns">matrix.columns()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">matrix.col()</a>, the loop performs <em>column-wise</em> iteration instead.</li>
</ul>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement is the more convenient approach to loop over and access the rows of a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> in order, as it automatically validates the number of rows and retrieves an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of the current row’s elements on each iteration:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for rowArray in myMatrix</code></div>
<p>When a script’s calculations require access to each row from a matrix and its corresponding <em>index</em>, programmers can use the <a href="/pine-script-docs/v5/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for [rowIndex, rowArray] in myMatrix</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop only performs <strong>row-wise</strong> iteration on <a href="/pine-script-docs/v5/language/matrices/">matrices</a>. To <em>emulate</em> column-wise iteration, programmers can use a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop on a <a href="/pine-script-docs/v5/language/matrices/#transposing">transposed copy</a>.</li>
</ul>
<p>The following example displays a custom “string” representing the rows of a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> with extra information, which it displays within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>. When the script executes on the last historical bar, it creates a 3x3 <code dir="auto">randomMatrix</code> populated with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a> values. Then, using the <a href="/pine-script-docs/v5/language/loops/#forin-loops">first form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop, the script iterates through each <code dir="auto">row</code> in the <code dir="auto">randomMatrix</code> to create a “string” representing the row’s contents, its <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">average</a>, and whether the average is above 0.5, and it concatenates that “string” with the <code dir="auto">labelText</code>. After the loop ends, the script creates a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> displaying the <code dir="auto">labelText</code> value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="404" loading="lazy" src="images/88b3588857c9a72f48733b50beaa67c6.webp" width="1036"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for row in matrix` demo", "Custom matrix label")

//@variable Generates a random value between 0 and 1, rounded to 4 decimal places. 
rand() =&gt;
    math.round(math.random(), 4)

if barstate.islastconfirmedhistory
    //@variable A matrix of randomized values to format and display in a `label`. 
    matrix&lt;float&gt; randomMatrix = matrix.new&lt;float&gt;()
    // Add a row of 9 randomized values and reshape the matrix to 3x3.
    randomMatrix.add_row(
         0, array.from(rand(), rand(), rand(), rand(), rand(), rand(), rand(), rand(), rand())
     )
    randomMatrix.reshape(3, 3)

    //@variable A custom "string" representation of `randomMatrix` information. Modified within a loop.
    string labelText = "Matrix rows: \n"

    // Loop through the rows in the `randomMatrix`.
    for row in randomMatrix
        //@variable The average element value within the `row`.
        float rowAvg = row.avg()
        //@variable An upward arrow when the `rowAvg` is above 0.5, a downward arrow otherwise.
        string directionChar = rowAvg &gt; 0.5 ? "⬆" : "⬇"
        // Add a "string" representing the `row` array, its average, and the `directionChar` to the `labelText`.
        labelText += str.format("Row: {0} Avg: {1} {2}\n", row, rowAvg, directionChar)
    
    // Draw a `label` displaying the `labelText` on the current bar.
    label.new(
         bar_index, 0, labelText, color = color.purple, textcolor = color.white, size = size.huge, 
         style = label.style_label_center, textalign = text.align_left
     )</code></div>
<p>Working with <a href="/pine-script-docs/v5/language/matrices/">matrices</a> often entails iteratively accessing their <em>elements</em>, not just their rows and columns, typically using <em>nested loops</em>. For example, this code block uses an outer <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop to iterate over row indices. The inner <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop iterates over column indices on <em>each</em> outer loop iteration and calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">matrix.get()</a> to access an element:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for rowIndex = 0 to (myMatrix.rows() == 0 ? na : myMatrix.rows() - 1)
    for columnIndex = 0 to myMatrix.columns() – 1
        element = myMatrix.get(rowIndex, columnIndex)</code></div>
<p>Alternatively, a more convenient approach for this type of task is to use nested <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loops. The outer <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop in this code block retrieves each row <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>, and the inner <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> statement <a href="/pine-script-docs/v5/language/loops/#looping-through-arrays">loops through that array</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for rowArray in myMatrix
    for element in rowArray</code></div>
<p>The script below creates a 3x2 <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>, then accesses and modifies its elements within nested <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loops. Both loops use the <a href="/pine-script-docs/v5/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> statement to retrieve index values and corresponding items. The outer loop accesses a row index and row <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> from the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>. The inner loop accesses each index and respective element from that <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.</p>
<p>Within the nested loop’s iterations, the script converts each <code dir="auto">element</code> to a “string” and initializes a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> cell at the <code dir="auto">rowIndex</code> row and <code dir="auto">colIndex</code> column. Then, it uses the loop header variables within <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">matrix.set()</a> to update the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> element. After the outer loop terminates, the script displays a “string” representation of the <em>updated</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a> within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="370" loading="lazy" src="images/da823f629ea5cedcdabee1e1957d9664.webp" width="848"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Nested `for...in` loops on matrices demo")

if barstate.islastconfirmedhistory
    //@variable  A matrix containing numbers to display.
    matrix&lt;float&gt; displayNumbers = matrix.new&lt;float&gt;()
    // Populate the `displayNumbers` matrix and reshape to 3x2.
    displayNumbers.add_row(0, array.from(1, 2, 3, 4, 5, 6))
    displayNumbers.reshape(3, 2)

    //@variable A table that displays the elements of the `displayNumbers` before modification. 
    table displayTable = table.new(
         position = position.middle_center, columns = displayNumbers.columns(), rows = displayNumbers.rows(), 
         bgcolor = color.purple, border_color = color.white, border_width = 2
     )

    // Loop through the `displayNumbers`, retrieving the `rowIndex` and the current `row`. 
    for [rowIndex, row] in displayNumbers
        // Loop through the current `row` on each outer loop iteration to retrieve the `colIndex` and `element`.
        for [colIndex, element] in row
            // Initialize a table cell at the `rowIndex` row and `colIndex` column displaying the current `element`.
            displayTable.cell(column = colIndex, row = rowIndex, text = str.tostring(element), 
                 text_color = color.white, text_size = size.huge
             )
            // Update the `displayNumbers` value at the `rowIndex` and `colIndex`.
            displayNumbers.set(rowIndex, colIndex, math.round(math.exp(element), 3))

    // Draw a `label` to display a "string" representation of the updated `displayNumbers` matrix. 
    label.new( 
         x = bar_index, y = 0, text = "Matrix now modified: \n" + str.tostring(displayNumbers), color = color.orange, 
         textcolor = color.white, size = size.huge, style = label.style_label_up 
     )</code></div>
<h3 class="md-heading" id="looping-through-maps"><a href="#looping-through-maps">Looping through maps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement is the primary, most convenient approach for iterating over the data within Pine Script™ <a href="/pine-script-docs/v5/language/maps/">maps</a>.</p>
<p>Unlike <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and <a href="/pine-script-docs/v5/language/matrices/">matrices</a>, maps are <em>unordered collections</em> that store data in <em>key-value pairs</em>. Rather than traversing an internal lookup index, a script references the <em>keys</em> from the pairs within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> to access its <em>values</em>. Therefore, when looping through a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>, scripts must perform <em>pair-wise</em> iteration, which entails retrieving key-value pairs across iterations rather than indexed <a href="/pine-script-docs/v5/language/loops/#looping-through-arrays">elements</a> or <a href="/pine-script-docs/v5/language/loops/#looping-through-matrices">rows</a>.</p>
<p>Note that:</p>
<ul>
<li>Although <a href="/pine-script-docs/v5/language/maps/">maps</a> are unordered collections, Pine Script™ internally tracks the <em>insertion order</em> of their key-value pairs.</li>
</ul>
<p>One way to access the data from a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> is to use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a> function, which returns an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> containing all the <em>keys</em> from the map, sorted in their insertion order. A script can use the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> structure to <a href="/pine-script-docs/v5/language/loops/#looping-through-arrays">loop through the array</a> of keys and call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get">map.get()</a> to retrieve corresponding values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for key in myMap.keys()
    value = myMap.get(key)</code></div>
<p>However, the more convenient, <em>recommended</em> approach is to loop through a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> directly <em>without</em> creating new <a href="/pine-script-docs/v5/language/arrays/">arrays</a>. To loop through a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> directly, use the <a href="/pine-script-docs/v5/language/loops/#forin-loops">second form</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement. Using this loop with a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> creates a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> containing a <em>key</em> and respective <em>value</em> on each iteration. As when looping through a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a> array, this <em>direct</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop iterates through a map’s contents in their insertion order:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for [key, value] in myMap</code></div>
<p>Note that:</p>
<ul>
<li>The second form of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop is the <strong>only</strong> way to iterate <em>directly</em> through a map. A script cannot directly loop through this collection type without retrieving a key and value on each iteration.</li>
</ul>
<p>Let’s consider a simple example demonstrating how a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop works on a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>. When the script below executes on the last historical bar, it declares a <code dir="auto">simpleMap</code> variable with an assigned <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> of “string” keys and “float” values. The script <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">puts</a> the keys from the <code dir="auto">newKeys</code> array into the collection with corresponding <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a> values. It then uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to iterate through the key-value pairs from the <code dir="auto">simpleMap</code> and construct the <code dir="auto">displayText</code>. After the loop ends, the script shows the <code dir="auto">displayText</code> within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> to visualize the result:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="404" loading="lazy" src="images/864cf5bfbceb53cdb1e379205e20f9e6.webp" width="860"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Looping through map demo")

if barstate.islastconfirmedhistory
    //@variable A map of "string" keys and "float" values to render within a `label`.
    map&lt;string, float&gt; simpleMap = map.new&lt;string, float&gt;()

    //@variable An array of "string" values representing the keys to put into the map. 
    array&lt;string&gt; newKeys = array.from("A", "B", "C", "D", "E")
    // Put key-value pairs into the `simpleMap`. 
    for key in newKeys
        simpleMap.put(key, math.random(1, 20))

    //@variable A "string" representation of the `simpleMap` contents. Modified within a loop. 
    string displayText = "simpleMap content: \n "

    // Loop through each key-value pair within the `simpleMap`. 
    for [key, value] in simpleMap
        // Add a "string" representation of the pair to the `displayText`.
        displayText += key + ": " + str.tostring(value, "#.##") + "\n "
    
    // Draw a `label` showing the `displayText` on the current bar. 
    label.new( 
         x = bar_index, y = 0, text = displayText, color = color.green, textcolor = color.white, 
         size = size.huge, textalign = text.align_left, style = label.style_label_center
     )</code></div>
<p>Note that:</p>
<ul>
<li>This script utilizes <a href="/pine-script-docs/v5/language/loops/#forin-loops">both forms</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement. The first loop iterates through the “string” elements of the <code dir="auto">newKeys</code> array to put key-value pairs into the <code dir="auto">simpleMap</code>, and the second iterates directly through the map’s key-value pairs to construct the custom <code dir="auto">displayText</code>.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span></p><p>Scripts can modify the sizes of <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and <a href="/pine-script-docs/v5/language/matrices/">matrices</a> while iterating through them with a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop. However, it’s crucial to note that while a script iterates through a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> with a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop, that map’s size <strong>cannot</strong> change. Attempting to <em>add</em> or <em>remove</em> key-value pairs while looping directly through a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> will cause a <em>runtime error</em>.</p><p>To modify a map’s size within a loop, programmers can do any of the following:</p><ul>
<li>Make a <a href="/pine-script-docs/v5/language/maps/#copying-a-map">copy</a> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a> and loop through that copied instance.</li>
<li>Use a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to iterate through the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a> array.</li>
<li>Use a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a> loop instead of a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop.</li>
</ul><p></p></div></aside> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/conditional-structures"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Conditional structures  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/type-system"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Type system <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Type system</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-type-system"><a href="#type-system">Type system<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The Pine Script™ type system determines the compatibility of a script’s
values with various functions and operations. While it’s possible to
write simple scripts without knowing anything about the type system, a
reasonable understanding of it is necessary to achieve any degree of
proficiency with the language, and an in-depth knowledge of its
subtleties allows programmers to harness its full potential.</p>
<p>Pine Script™ uses <a href="/pine-script-docs/v5/language/type-system/#types">types</a> to classify all values, and it uses <a href="/pine-script-docs/v5/language/type-system/#qualifiers">qualifiers</a> to determine whether values and references are constant, established on the first script execution, or dynamic across executions. This system applies to all Pine values and references, including literals, variables, expressions, function returns, and function arguments.</p>
<p>The type system closely intertwines with Pine’s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and
<a href="/pine-script-docs/v5/language/time-series/">time series</a> concepts.
Understanding all three is essential for making the most of the power of
Pine Script™.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>For the sake of brevity, we often use “type” to refer to a “qualified
type”.</p></div></aside>
<h2 class="md-heading" id="qualifiers"><a href="#qualifiers">Qualifiers<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ <em>qualifiers</em> identify when values are accessible to a
script:</p>
<ul>
<li>Values and references qualified as
<a href="/pine-script-docs/v5/language/type-system/#const">const</a> are established at compile time (i.e., when saving the
script in the Pine Editor or adding it to the chart).</li>
<li>Values qualified as
<a href="/pine-script-docs/v5/language/type-system/#input">input</a> are established at input time (i.e., when confirming values
based on user input, primarily from the “Settings/Inputs” tab).</li>
<li>Values qualified as
<a href="/pine-script-docs/v5/language/type-system/#simple">simple</a> are established at bar zero (i.e., the first
script execution).</li>
<li>Values qualified as
<a href="/pine-script-docs/v5/language/type-system/#series">series</a> can change throughout the script’s executions.</li>
</ul>
<p>Pine Script™ bases the dominance of type qualifiers on the following
hierarchy: <strong>const &lt; input &lt; simple &lt; series</strong>, where “const” is
the <em>weakest</em> qualifier and “series” is the <em>strongest</em>. The qualifier
hierarchy translates to this rule: whenever a variable, function, or
operation is compatible with a specific qualified type, values with
<em>weaker</em> qualifiers are also allowed.</p>
<p>Scripts always qualify their expressions’ returned types based on the
<em>dominant qualifier</em> in their calculations. For example, evaluating an
expression that involves “input” and “series” values will return a
value qualified as “series”. Furthermore, scripts <strong>cannot</strong> change a
value’s qualifier to one that’s <em>lower</em> on the hierarchy. If a value
acquires a <em>stronger</em> qualifier (e.g., a value initially inferred as
“simple” becomes “series” later in the script’s executions), that
state is irreversible.</p>
<p>It’s important to note that “series” values are the <strong>only</strong> ones
that can change across script executions, including those from various
built-ins, such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>,
as well as the results of expressions involving “series” values. All
values qualified as “const”, “input”, or “simple” remain
consistent across all script executions.</p>
<h3 class="md-heading" id="const"><a href="#const">const<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values or references qualified as “const” are established at <em>compile
time</em>, before the script starts its executions. Compilation initially
occurs when saving a script in the Pine Editor, which does not require
it to run on a chart. Values or references with the “const” qualifier
<em>never change</em> between script executions, not even on the first
execution.</p>
<p>All <em>literal</em> values and the results returned by expressions involving
only values qualified as “const” automatically adopt the “const”
qualifier.</p>
<p>These are some examples of literal values:</p>
<ul>
<li><em>literal int</em>: <code dir="auto">1</code>, <code dir="auto">-1</code>, <code dir="auto">42</code></li>
<li><em>literal float</em>: <code dir="auto">1.</code>, <code dir="auto">1.0</code>, <code dir="auto">3.14</code>, <code dir="auto">6.02E-23</code>, <code dir="auto">3e8</code></li>
<li><em>literal bool</em>: <code dir="auto">true</code>, <code dir="auto">false</code></li>
<li><em>literal color</em>: <code dir="auto">#FF55C6</code>, <code dir="auto">#FF55C6ff</code></li>
<li><em>literal string</em>: <code dir="auto">"A text literal"</code>,
<code dir="auto">"Embedded single quotes 'text'"</code>, <code dir="auto">'Embedded double quotes "text"'</code></li>
</ul>
<p>Our <a href="/pine-script-docs/v5/writing/style-guide/">Style guide</a>
recommends using uppercase SNAKE_CASE to name “const” variables for
readability. While not a requirement, one can also use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword when declaring “const” variables so the script only
initializes them on the <em>first bar</em> of the dataset. See
<a href="/pine-script-docs/v5/language/variable-declarations/#var">this section</a> of our User Manual for more information.</p>
<p>Below is an example that uses “const” values within the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
functions, which both require a value of the “const string” qualified
type as their <code dir="auto">title</code> argument:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// The following global variables are all of the "const string" qualified type:

//@variable The title of the indicator.
INDICATOR_TITLE = "const demo"
//@variable The title of the first plot.
var PLOT1_TITLE = "High"
//@variable The title of the second plot.
const string PLOT2_TITLE = "Low"
//@variable The title of the third plot.
PLOT3_TITLE = "Midpoint between " + PLOT1_TITLE + " and " + PLOT2_TITLE

indicator(INDICATOR_TITLE, overlay = true)

plot(high, PLOT1_TITLE)
plot(low, PLOT2_TITLE)
plot(hl2, PLOT3_TITLE)</code></div>
<p>The following example will raise a compilation error since it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.ticker">syminfo.ticker</a>,
which returns a “simple” value because it depends on chart information
that’s only accessible after the script’s first execution:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

//@variable The title in the `indicator()` call.
var NAME = "My indicator for " + syminfo.ticker

indicator(NAME, "", true) // Causes an error because `NAME` is qualified as a "simple string".
plot(close)</code></div>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_const">const</a>
keyword allows the declaration of variables and parameters with constant
<em>value assignments</em>. Declaring a variable with this keyword instructs
the script to forbid using <em>reassignment</em> and <em>compound assignment</em>
operations on it. For example, this script declares the <code dir="auto">myVar</code> variable
with the keyword, then attempts to assign a new “float” value to the
variable with the addition assignment operator
(<a href="https://www.tradingview.com/pine-script-reference/v5/#op_+=">+=</a>),
resulting in a compilation error:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Cannot reassign const demo")

//@variable A "float" variable declared as `const`, preventing reassignment. 
const float myVar = 0.0

myVar += 1.0 // Causes an error. Reassignment and compound assignments are not allowed on `const` variables.

plot(myVar)</code></div>
<p>It’s crucial to note that declaring a variable with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_const">const</a>
keyword forces it to maintain a constant reference to the value returned
by a specific expression, but that <em>does not</em> necessarily define the
nature of the assigned value. For example, a script can declare a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_const">const</a>
variable that maintains a constant reference to an expression returning
the <em>ID</em> of a <em>special type</em>. Although the script cannot <em>reassign</em> the
variable, the assigned ID is a “series” value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Constant reference to 'series' ID demo")

//@variable A `label` variable declared as `const`, preventing reassignment.
//          Although the reference is constant, the ID of the `label` is a "series" value.
const label myVar = label.new(bar_index, close)</code></div>
<h3 class="md-heading" id="input"><a href="#input">input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Most values qualified as “input” are established after initialization
via the <code dir="auto">input.*()</code> functions. These functions produce values that users
can modify within the “Inputs” tab of the script’s settings. When one
changes any of the values in this tab, the script <em>restarts</em> from the
beginning of the chart’s history to ensure its inputs are consistent
throughout its executions. Some of Pine’s built-in variables, such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.bg_color">chart.bg_color</a>
also use the “input” qualifier, even though <code dir="auto">input.*()</code> functions do
not return them, since the script receives their values at <em>input time</em>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
functions are exceptions in the <code dir="auto">input.*()</code> namespace, as they <em>do not</em>
return values qualified as “input”. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a>
function returns “series” values since built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
as well as the values from another script’s plots, have the “series”
qualifier. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
function returns a “simple” result because all values belonging to
<a href="/pine-script-docs/v5/language/type-system/#types">enums</a> are
available on the first script execution. See this manual’s
<a href="/pine-script-docs/v5/concepts/inputs/">Inputs</a> page for more
information.</p></div></aside>
<p>The following script plots the value of a <code dir="auto">sourceInput</code> from the
<code dir="auto">symbolInput</code> and <code dir="auto">timeframeInput</code> context. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call is valid in this script since its <code dir="auto">symbol</code> and <code dir="auto">timeframe</code>
parameters allow “simple string” arguments, meaning they can also
accept “input string” values because the “input” qualifier is
<em>lower</em> on the hierarchy:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("input demo", overlay = true)

//@variable The symbol to request data from. Qualified as "input string".
symbolInput = input.symbol("AAPL", "Symbol")
//@variable The timeframe of the data request. Qualified as "input string".
timeframeInput = input.timeframe("D", "Timeframe")
//@variable The source of the calculation. Qualified as "series float".
sourceInput = input.source(close, "Source")

//@variable The `sourceInput` value from the requested context. Qualified as "series float".
requestedSource = request.security(symbolInput, timeframeInput, sourceInput)

plot(requestedSource)</code></div>
<h3 class="md-heading" id="simple"><a href="#simple">simple<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values qualified as “simple” are available on the first script
execution, and they remain consistent across subsequent executions.</p>
<p>Users can explicitly define variables and parameters that accept
“simple” values by including the <code dir="auto">simple</code> keyword in their
declaration.</p>
<p>Many built-in variables return “simple” qualified values because they
depend on information that a script can only obtain once it starts
running on the chart. Additionally, many built-in functions require
“simple” arguments that do not change over time. Wherever a script
allows “simple” values, it can also accept values qualified as
“input” or “const”.</p>
<p>This script highlights the background to warn users that they’re using
a non-standard chart type. It uses the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.is_standard">chart.is_standard</a>
to calculate the <code dir="auto">isNonStandard</code> variable, then uses that variable’s
value to calculate a <code dir="auto">warningColor</code> that also references a “simple”
value. The <code dir="auto">color</code> parameter of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
allows a “series color” argument, meaning it can also accept a
“simple color” value since “simple” is lower on the hierarchy:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("simple demo", overlay = true)

//@variable Is `true` when the current chart is non-standard. Qualified as "simple bool".
isNonStandard = not chart.is_standard
//@variable Is orange when the the current chart is non-standard. Qualified as "simple color".
simple color warningColor = isNonStandard ? color.new(color.orange, 70) : na

// Colors the chart's background to warn that it's a non-standard chart type.
bgcolor(warningColor, title = "Non-standard chart color")</code></div>
<h3 class="md-heading" id="series"><a href="#series">series<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values qualified as “series” provide the most flexibility in scripts
since they can change across executions.</p>
<p>Users can explicitly define variables and parameters that accept
“series” values by including the <code dir="auto">series</code> keyword in their
declarations.</p>
<p>Built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>,
and the result from any expression using such built-ins, are qualified
as “series”. The result of any function or operation that returns a
dynamic value will always be a “series”, as will the results from
using the history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
to access historical values. Wherever a script allows “series” values,
it will also accept values with any other qualifier, as “series” is
the <em>highest</em> qualifier on the hierarchy.</p>
<p>This script displays the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">highest</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.lowest">lowest</a>
value of a <code dir="auto">sourceInput</code> over <code dir="auto">lengthInput</code> bars. The values assigned to
the <code dir="auto">highest</code> and <code dir="auto">lowest</code> variables are of the “series float”
qualified type, as they can change throughout the script’s execution:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("series demo", overlay = true)

//@variable The source value to calculate on. Qualified as "series float".
series float sourceInput = input.source(close, "Source")
//@variable The number of bars in the calculation. Qualified as "input int".
lengthInput = input.int(20, "Length")

//@variable The highest `sourceInput` value over `lengthInput` bars. Qualified as "series float".
series float highest = ta.highest(sourceInput, lengthInput)
//@variable The lowest `sourceInput` value over `lengthInput` bars. Qualified as "series float".
lowest = ta.lowest(sourceInput, lengthInput)

plot(highest, "Highest source", color.green)
plot(lowest, "Lowest source", color.red)</code></div>
<h2 class="md-heading" id="types"><a href="#types">Types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ <em>types</em> classify values and determine the functions and
operations they’re compatible with. They include:</p>
<ul>
<li>The fundamental types:
<a href="/pine-script-docs/v5/language/type-system/#int">int</a>,
<a href="/pine-script-docs/v5/language/type-system/#float">float</a>,
<a href="/pine-script-docs/v5/language/type-system/#bool">bool</a>,
<a href="/pine-script-docs/v5/language/type-system/#color">color</a>,
and <a href="/pine-script-docs/v5/language/type-system/#string">string</a></li>
<li>The special types:
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">plot</a>,
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">hline</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">line</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">linefill</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">box</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">polyline</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">label</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">table</a>,
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart.point</a>,
<a href="/pine-script-docs/v5/language/type-system/#collections">array</a>,
<a href="/pine-script-docs/v5/language/type-system/#collections">matrix</a>, and
<a href="/pine-script-docs/v5/language/type-system/#collections">map</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#user-defined-types">User-defined types (UDTs)</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#enum-types">Enums</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#void">void</a></li>
</ul>
<p>Fundamental types refer to the underlying nature of a value, e.g., a
value of 1 is of the “int” type, 1.0 is of the “float” type,
“AAPL” is of the “string” type, etc. Special types and user-defined
types utilize <em>IDs</em> that refer to objects of a specific type. For
example, a value of the “label” type contains an ID that acts as a
<em>pointer</em> referring to a “label” object. The “void” type refers to
the output from a function or <a href="/pine-script-docs/v5/language/methods/">method</a> that does not return a usable value.</p>
<p>Pine Script™ can automatically convert values from some types into
others. The auto-casting rules are: <strong>int → float → bool</strong>. See the
<a href="/pine-script-docs/v5/language/type-system/#type-casting">Type casting</a> section of this page for more information.</p>
<p>In most cases, Pine Script™ can automatically determine a value’s type.
However, we can also use type keywords to <em>explicitly</em> specify types for
readability and for code that requires explicit definitions (e.g.,
declaring a variable assigned to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>). For
example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Types demo", overlay = true)

//@variable A value of the "const string" type for the `ma` plot's title.
string MA_TITLE = "MA"

//@variable A value of the "input int" type. Controls the length of the average.
int lengthInput = input.int(100, "Length", minval = 2)

//@variable A "series float" value representing the last `close` that crossed over the `ma`.
var float crossValue = na

//@variable A "series float" value representing the moving average of `close`.
float ma = ta.sma(close, lengthInput)
//@variable A "series bool" value that's `true` when the `close` crosses over the `ma`.
bool crossUp = ta.crossover(close, ma)
//@variable A "series color" value based on whether `close` is above or below its `ma`.
color maColor = close &gt; ma ? color.lime : color.fuchsia

// Update the `crossValue`.
if crossUp
    crossValue := close

plot(ma, MA_TITLE, maColor)
plot(crossValue, "Cross value", style = plot.style_circles)
plotchar(crossUp, "Cross Up", "▲", location.belowbar, size = size.small)</code></div>
<h3 class="md-heading" id="int"><a href="#int">int<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values of the “int” type represent integers, i.e., whole numbers
without any fractional quantities.</p>
<p>Integer literals are numeric values written in <em>decimal</em> notation. For
example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">1
-1
750</code></div>
<p>Built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.wintrades">strategy.wintrades</a>
all return values of the “int” type.</p>
<h3 class="md-heading" id="float"><a href="#float">float<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values of the “float” type represent floating-point numbers, i.e.,
numbers that can contain whole and fractional quantities.</p>
<p>Floating-point literals are numeric values written with a <code dir="auto">.</code> delimiter.
They may also contain the symbol <code dir="auto">e</code> or <code dir="auto">E</code> (which means “10 raised to
the power of X”, where X is the number after the <code dir="auto">e</code> or <code dir="auto">E</code> symbol).
For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">3.14159    // Rounded value of Pi (π)
- 3.0
6.02e23    // 6.02 * 10^23 (a very large value)
1.6e-19    // 1.6 * 10^-19 (a very small value)</code></div>
<p>The internal precision of “float” values in Pine Script™ is 1e-16.</p>
<p>Built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlcc4">hlcc4</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ta.vwap">ta.vwap</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a>
all return values of the “float” type.</p>
<h3 class="md-heading" id="bool"><a href="#bool">bool<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values of the “bool” type represent the truth value of a comparison or
condition, which scripts can use in
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> and other expressions.</p>
<p>There are only two literals that represent boolean values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">true    // true value
false   // false value</code></div>
<p>When an expression of the “bool” type returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
scripts treat its value as <code dir="auto">false</code> when evaluating conditional
statements and operators.</p>
<p>Built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isfirst">barstate.isfirst</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.is_heikinashi">chart.is_heikinashi</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_session.ismarket">session.ismarket</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.isdaily">timeframe.isdaily</a>
all return values of the “bool” type.</p>
<h3 class="md-heading" id="color"><a href="#color">color<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Color literals have the following format: <code dir="auto">#RRGGBB</code> or <code dir="auto">#RRGGBBAA</code>. The
letter pairs represent <em>hexadecimal</em> values between <code dir="auto">00</code> and <code dir="auto">FF</code> (0 to
255 in decimal) where:</p>
<ul>
<li><code dir="auto">RR</code>, <code dir="auto">GG</code> and <code dir="auto">BB</code> pairs respectively represent the values for the
color’s red, green and blue components.</li>
<li><code dir="auto">AA</code> is an optional value for the color’s opacity (or <em>alpha</em>
component) where <code dir="auto">00</code> is invisible and <code dir="auto">FF</code> opaque. When the literal
does not include an <code dir="auto">AA</code> pair, the script treats it as fully opaque
(the same as using <code dir="auto">FF</code>).</li>
<li>The hexadecimal letters in the literals can be uppercase or
lowercase.</li>
</ul>
<p>These are examples of “color” literals:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">#000000      // black color
#FF0000      // red color
#00FF00      // green color
#0000FF      // blue color
#FFFFFF      // white color
#808080      // gray color
#3ff7a0      // some custom color
#FF000080    // 50% transparent red color
#FF0000ff    // same as #FF0000, fully opaque red color
#FF000000    // completely transparent red color</code></div>
<p>Pine Script™ also has
<a href="/pine-script-docs/v5/concepts/colors/#constant-colors">built-in color constants</a>, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dgreen">color.green</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dred">color.red</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dorange">color.orange</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dblue">color.blue</a>
(the default color in <code dir="auto">plot*()</code> functions and many of the default
color-related properties in
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a>), etc.</p>
<p>When using built-in color constants, it is possible to add transparency
information to them via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a>
function.</p>
<p>Note that when specifying red, green or blue components in <code dir="auto">color.*()</code>
functions, we use “int” or “float” arguments with values between 0
and 255. When specifying transparency, we use a value between 0 and 100,
where 0 means fully opaque and 100 means completely transparent. For
example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shading the chart's background", overlay = true)

//@variable A "const color" value representing the base for each day's color. 
color BASE_COLOR = color.rgb(0, 99, 165)

//@variable A "series int" value that modifies the transparency of the `BASE_COLOR` in `color.new()`.
int transparency = 50 + int(40 * dayofweek / 7)

// Color the background using the modified `BASE_COLOR`.
bgcolor(color.new(BASE_COLOR, transparency))</code></div>
<p>See the User Manual’s page on <a href="/pine-script-docs/v5/concepts/colors/">colors</a> for more information on using colors in scripts.</p>
<h3 class="md-heading" id="string"><a href="#string">string<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values of the “string” type represent sequences of letters, numbers,
symbols, spaces, and other characters.</p>
<p>String literals in Pine are characters enclosed in single or double
quotation marks. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">"This is a string literal using double quotes."
'This is a string literal using single quotes.'</code></div>
<p>Single and double quotation marks are functionally equivalent in Pine
Script™. A “string” enclosed within double quotation marks can contain
any number of single quotation marks and vice versa:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">"It's an example"
'The "Star" indicator'</code></div>
<p>Scripts can <em>escape</em> the enclosing delimiter in a “string” using the
backslash character (<code dir="auto">\</code>). For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">'It\'s an example'
"The \"Star\" indicator"</code></div>
<p>We can create “string” values containing the new line escape character
(<code dir="auto">\n</code>) for displaying multi-line text with <code dir="auto">plot*()</code> and <code dir="auto">log.*()</code>
functions and objects of
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a>. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">"This\nString\nHas\nOne\nWord\nPer\nLine"</code></div>
<p>We can use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_+">+</a> operator
to concatenate “string” values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">"This is a " + "concatenated string."</code></div>
<p>The built-ins in the <code dir="auto">str.*()</code> namespace create “string” values using
specialized operations. For instance, this script creates a <em>formatted
string</em> to represent “float” price values and displays the result
using a label:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Formatted string demo", overlay = true)

//@variable A "series string" value representing the bar's OHLC data.
string ohlcString = str.format("Open: {0}\nHigh: {1}\nLow: {2}\nClose: {3}", open, high, low, close)

// Draw a label containing the `ohlcString`.
label.new(bar_index, high, ohlcString, textcolor = color.white)</code></div>
<p>See our User Manual’s page on
<a href="/pine-script-docs/v5/concepts/text-and-shapes/">Text and shapes</a> for
more information about displaying “string” values from a script.</p>
<p>Built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a>
return values of the “string” type.</p>
<h3 class="md-heading" id="plot-and-hline"><a href="#plot-and-hline">plot and hline<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™‘s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
functions return IDs that respectively reference instances of the
“plot” and “hline” types. These types display calculated values and
horizontal levels on the chart, and one can assign their IDs to
variables for use with the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function.</p>
<p>For example, this script plots two EMAs on the chart and fills the space
between them using a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("plot fill demo", overlay = true)

//@variable A "series float" value representing a 10-bar EMA of `close`.
float emaFast = ta.ema(close, 10)
//@variable A "series float" value representing a 20-bar EMA of `close`.
float emaSlow = ta.ema(close, 20)

//@variable The plot of the `emaFast` value.
emaFastPlot = plot(emaFast, "Fast EMA", color.orange, 3)
//@variable The plot of the `emaSlow` value.
emaSlowPlot = plot(emaSlow, "Slow EMA", color.gray, 3)

// Fill the space between the `emaFastPlot` and `emaSlowPlot`.
fill(emaFastPlot, emaSlowPlot, color.new(color.purple, 50), "EMA Fill")</code></div>
<p>It’s important to note that unlike other special types, there is no
<code dir="auto">plot</code> or <code dir="auto">hline</code> keyword in Pine to explicitly declare a variable’s
type as “plot” or “hline”.</p>
<p>Users can control where their scripts’ plots display via the variables
in the <code dir="auto">display.*</code> namespace and a <code dir="auto">plot*()</code> function’s <code dir="auto">force_overlay</code>
parameter. Additionally, one script can use the values from another
script’s plots as <em>external inputs</em> via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a>
function (see our User Manual’s section on
<a href="/pine-script-docs/v5/concepts/inputs/#source-input">source inputs</a>).</p>
<h3 class="md-heading" id="drawing-types"><a href="#drawing-types">Drawing types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™ drawing types allow scripts to create custom drawings on
charts. They include the following:
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>.</p>
<p>Each type also has a namespace containing all the built-ins that create
and manage drawing instances. For example, the following <code dir="auto">*.new()</code>
constructors create new objects of these types in a script:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.new">table.new()</a>.</p>
<p>Each of these functions returns an <em>ID</em> which is a reference that
uniquely identifies a drawing object. IDs are always qualified as
“series”, meaning their qualified types are “series line”, “series
label”, etc. Drawing IDs act like pointers, as each ID references a
specific instance of a drawing in all the functions from that drawing’s
namespace. For instance, the ID of a line returned by a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
call is used later to refer to that specific object once it’s time to
delete it with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>.</p>
<h3 class="md-heading" id="chart-points"><a href="#chart-points">Chart points<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Chart points are special types that represent coordinates on the chart.
Scripts use the information from
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects to determine the chart locations of
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>.</p>
<p>Objects of this type contain three <em>fields</em>: <code dir="auto">time</code>, <code dir="auto">index</code>, and
<code dir="auto">price</code>. Whether a drawing instance uses the <code dir="auto">time</code> or <code dir="auto">price</code> field
from a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
as an x-coordinate depends on the drawing’s <code dir="auto">xloc</code> property.</p>
<p>We can use any of the following functions to create chart points in a
script:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.new">chart.point.new()</a> -
Creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
with a specified <code dir="auto">time</code>, <code dir="auto">index</code>, and <code dir="auto">price</code>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a> -
Creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
with a specified <code dir="auto">price</code> y-coordinate. The <code dir="auto">time</code> and <code dir="auto">index</code> fields
contain the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
of the bar the function executes on.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_index">chart.point_from_index()</a> -
Creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
with an <code dir="auto">index</code> x-coordinate and <code dir="auto">price</code> y-coordinate. The <code dir="auto">time</code>
field of the resulting instance is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
meaning it will not work with drawing objects that use an <code dir="auto">xloc</code>
value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_time">chart.point.from_time()</a> -
Creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
with a <code dir="auto">time</code> x-coordinate and <code dir="auto">price</code> y-coordinate. The <code dir="auto">index</code>
field of the resulting instance is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
meaning it will not work with drawing objects that use an <code dir="auto">xloc</code>
value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.copy">chart.point.copy()</a> -
Creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
containing the same <code dir="auto">time</code>, <code dir="auto">index</code>, and <code dir="auto">price</code> information as the
<code dir="auto">id</code> in the function call.</li>
</ul>
<p>This example draws lines connecting the previous bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
to the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> on
each chart bar. It also displays labels at both points of each line. The
line and labels get their information from the <code dir="auto">firstPoint</code> and
<code dir="auto">secondPoint</code> variables, which reference chart points created using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_index">chart.point_from_index()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Chart points demo", overlay = true)

//@variable A new `chart.point` at the previous `bar_index` and `high`.
firstPoint = chart.point.from_index(bar_index - 1, high[1])
//@variable A new `chart.point` at the current bar's `low`.
secondPoint = chart.point.now(low)

// Draw a new line connecting coordinates from the `firstPoint` and `secondPoint`.
// This line uses the `index` fields from the points as x-coordinates.
line.new(firstPoint, secondPoint, color = color.purple, width = 3)
// Draw a label at the `firstPoint`. Uses the point's `index` field as its x-coordinate.
label.new(
     firstPoint, str.tostring(firstPoint.price), color = color.green, 
     style = label.style_label_down, textcolor = color.white
 )
// Draw a label at the `secondPoint`. Uses the point's `index` field as its x-coordinate.
label.new(
     secondPoint, str.tostring(secondPoint.price), color = color.red, 
     style = label.style_label_up, textcolor = color.white
 )</code></div>
<h3 class="md-heading" id="collections"><a href="#collections">Collections<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Collections in Pine Script™ (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>,
and <a href="/pine-script-docs/v5/language/maps/">maps</a>) utilize reference
IDs, much like other special types (e.g., labels). The type of the ID
defines the type of <em>elements</em> the collection will contain. In Pine, we
specify array, matrix, and map types by appending a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>,
or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
keywords:</p>
<ul>
<li><code dir="auto">array&lt;int&gt;</code> defines an array containing “int” elements.</li>
<li><code dir="auto">array&lt;label&gt;</code> defines an array containing “label” IDs.</li>
<li><code dir="auto">array&lt;UDT&gt;</code> defines an array containing IDs referencing objects of
a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a>.</li>
<li><code dir="auto">matrix&lt;float&gt;</code> defines a matrix containing “float” elements.</li>
<li><code dir="auto">matrix&lt;UDT&gt;</code> defines a matrix containing IDs referencing objects of
a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a>.</li>
<li><code dir="auto">map&lt;string, float&gt;</code> defines a map containing “string” keys and
“float” values.</li>
<li><code dir="auto">map&lt;int, UDT&gt;</code> defines a map containing “int” keys and IDs of
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a> instances as values.</li>
</ul>
<p>For example, one can declare an “int” array with a single element
value of 10 in any of the following, equivalent ways:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a1 = array.new&lt;int&gt;(1, 10)
array&lt;int&gt; a2 = array.new&lt;int&gt;(1, 10)
a3 = array.from(10)
array&lt;int&gt; a4 = array.from(10)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">int[]</code> syntax can also specify an array of “int”
elements, but its use is discouraged. No equivalent exists to
specify the types of matrices or maps in that way.</li>
<li>Type-specific built-ins exist for arrays, such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dnew_int">array.new_int()</a>,
but the more generic <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array.new&lt;type&gt;</a>
form is preferred, which would be <code dir="auto">array.new&lt;int&gt;()</code> to create
an array of “int” elements.</li>
</ul>
<h3 class="md-heading" id="user-defined-types"><a href="#user-defined-types">User-defined types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a>
keyword allows the creation of <em>user-defined types</em> (UDTs) from which
scripts can create <a href="/pine-script-docs/v5/language/objects/">objects</a>. UDTs are composite types; they contain an arbitrary number
of <em>fields</em> that can be of any type, including other user-defined types.</p>
<p>The syntax to declare a user-defined type is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[export ]type &lt;UDT_identifier&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_type&gt; &lt;field_name&gt;[ = &lt;value&gt;]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div></code></pre></figure></link></div>
<p>where:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_export">export</a>
is the keyword that a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library</a>
script uses to export the user-defined type. To learn more about
exporting UDTs, see our User Manual’s
<a href="/pine-script-docs/v5/concepts/libraries/#user-defined-types-and-objects">Libraries</a>
page.</li>
<li><code dir="auto">&lt;UDT_identifier&gt;</code> is the name of the user-defined type.</li>
<li><code dir="auto">&lt;field_type&gt;</code> is the type of the field.</li>
<li><code dir="auto">&lt;field_name&gt;</code> is the name of the field.</li>
<li><code dir="auto">&lt;value&gt;</code> is an optional default value for the field, which the
script will assign to it when creating new objects of that UDT. If
one does not provide a value, the field’s default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.
The same rules as those governing the default values of parameters
in function signatures apply to the default values of fields. For
example, a UDT’s default values cannot use results from the
history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
or expressions.</li>
</ul>
<p>This example declares a <code dir="auto">pivotPoint</code> UDT with an “int” <code dir="auto">pivotTime</code>
field and a “float” <code dir="auto">priceLevel</code> field that will respectively hold
time and price information about a calculated pivot:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">    //@type             A user-defined type containing pivot information.
    //@field pivotTime  Contains time information about the pivot.
    //@field priceLevel Contains price information about the pivot.
    type pivotPoint
        int   pivotTime
        float priceLevel</code></div>
<p>User-defined types support <em>type recursion</em>, i.e., the fields of a UDT
can reference objects of the same UDT. Here, we’ve added a <code dir="auto">nextPivot</code>
field to our previous <code dir="auto">pivotPoint</code> type that references another
<code dir="auto">pivotPoint</code> instance:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">    //@type             A user-defined type containing pivot information.
    //@field pivotTime  Contains time information about the pivot.
    //@field priceLevel Contains price information about the pivot.
    //@field nextPivot  A `pivotPoint` instance containing additional pivot information.
    type pivotPoint
        int        pivotTime
        float      priceLevel
        pivotPoint nextPivot</code></div>
<p>Scripts can use two built-in methods to create and copy UDTs: <code dir="auto">new()</code>
and <code dir="auto">copy()</code>. See our User Manual’s page on
<a href="/pine-script-docs/v5/language/objects/">Objects</a> to learn more
about working with UDTs.</p>
<h3 class="md-heading" id="enum-types"><a href="#enum-types">Enum types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_enum">enum</a> keyword allows the creation of an <em>enum</em>, otherwise known as an <em>enumeration</em>, <em>enumerated type</em>, or <em>enum type</em>. An enum is a unique type construct containing distinct, named fields representing <em>members</em> (i.e., possible values) of the type. Enums allow programmers to control the values accepted by variables, conditional expressions, and <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>, and they facilitate convenient dropdown <a href="/pine-script-docs/v5/concepts/inputs/#enum-input">input</a> creation with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a> function.</p>
<p>The syntax to declare an enum is as follows:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[export ]enum &lt;enumName&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_1&gt;[ = &lt;title_1&gt;]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_2&gt;[ = &lt;title_2&gt;]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_N&gt;[ = &lt;title_N&gt;]</span></div></div></code></pre></figure></div>
<p>where:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_export">export</a>
is the optional keyword allowing a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library</a>
to export the enum for use in other scripts. See
<a href="/pine-script-docs/v5/concepts/libraries/#enum-types">this section</a> to learn more about exporting enum types.</li>
<li><code dir="auto">&lt;enumName&gt;</code> is the name of the enum type. Scripts can use the
enum’s name as the type keyword in
<a href="/pine-script-docs/v5/language/variable-declarations/">variable declarations</a> and
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type templates</a>.</li>
<li><code dir="auto">&lt;field_*&gt;</code> is the name of an enum field, representing a named
member (value) of the <code dir="auto">enumName</code> type. Each field must have a unique
name that does not match the name or title of any other field in the
enum. To retrieve an enum member, reference its field name using dot
notation syntax (i.e., <code dir="auto">enumName.fieldName</code>).</li>
<li><code dir="auto">&lt;title_*&gt;</code> is a “const string” title assigned to a field. If one
does not specify a title, the field’s title is the “string”
representation of its name. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
function displays field titles within its dropdown in the script’s
“Settings/Inputs” tab. Users can also retrieve a field’s title
with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
function. As with field names, each field’s title must not match
the name or title of any other field in the enum.</li>
</ul>
<p>This example declares an <code dir="auto">maChoice</code> enum. Each field within this
declaration represents a distinct member of the <code dir="auto">maChoice</code> enum type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@enum       An enumeration of named values for moving average selection.
//@field sma  Selects a Simple Moving Average.
//@field ema  Selects an Exponential Moving Average.
//@field wma  Selects a Weighted Moving Average.
//@field hma  Selects a Hull Moving Average.
enum maChoice
    sma  = "Simple Moving Average"
    ema  = "Exponential Moving Average"
    wma  = "Weighted Moving Average"
    hma  = "Hull Moving Average"</code></div>
<p>Note that:</p>
<ul>
<li>All the enum’s possible values are available upon the <em>first</em>
script execution and do not change across subsequent executions.
Hence, they automatically adopt the
<a href="/pine-script-docs/v5/language/type-system/#simple">simple</a> qualifier.</li>
</ul>
<p>The script below uses the <code dir="auto">maChoice</code> enum within an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
call to create a <em>dropdown</em> input in the “Settings/Inputs” tab that
displays all the field titles. The <code dir="auto">maInput</code> value represents the member
of the enum that corresponds to the user-selected title. The script uses
the selected member within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure to determine the built-in moving average it calculates:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Enum types demo", overlay = true)

//@enum       An enumeration of named values for moving average selection.
//@field sma  Selects a Simple Moving Average.
//@field ema  Selects an Exponential Moving Average.
//@field wma  Selects a Weighted Moving Average.
//@field hma  Selects a Hull Moving Average.
enum maChoice
    sma  = "Simple Moving Average"
    ema  = "Exponential Moving Average"
    wma  = "Weighted Moving Average"
    hma  = "Hull Moving Average"

//@variable The `maChoice` member representing a selected moving average name.
maChoice maInput = input.enum(maChoice.sma, "Moving average type")
//@variable The length of the moving average.
int lengthInput = input.int(20, "Length", 1, 4999)

//@variable The moving average selected by the `maInput`. 
float selectedMA = switch maInput
    maChoice.sma =&gt; ta.sma(close, lengthInput)
    maChoice.ema =&gt; ta.ema(close, lengthInput)
    maChoice.wma =&gt; ta.wma(close, lengthInput)
    maChoice.hma =&gt; ta.hma(close, lengthInput)

// Plot the `selectedMA`.
plot(selectedMA, "Selected moving average", color.teal, 3)</code></div>
<p>See the <a href="/pine-script-docs/v5/language/enums/">Enums</a> page and the
<a href="/pine-script-docs/v5/concepts/inputs/#enum-input">Enum input</a> section of the <a href="/pine-script-docs/v5/concepts/inputs/">Inputs</a> page to learn more about using enums and enum inputs.</p>
<h3 class="md-heading" id="void"><a href="#void">void<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>There is a “void” type in Pine Script™. Functions having only
side-effects and returning no usable result return the “void” type. An
example of such a function is
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>;
it does something (triggers an alert event), but it returns no usable
value.</p>
<p>Scripts cannot use “void” results in expressions or assign them to
variables. No <code dir="auto">void</code> keyword exists in Pine Script™ since one cannot
declare a variable of the “void” type.</p>
<h2 class="md-heading" id="na-value"><a href="#na-value">`na` value<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There is a special value in Pine Script™ called
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
which is an acronym for <em>not available</em>. We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> to
represent an undefined value from a variable or expression. It is
similar to <code dir="auto">null</code> in Java and <code dir="auto">None</code> in Python.</p>
<p>Scripts can automatically cast
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values to almost any type. However, in some cases, the compiler cannot
infer the type associated with an
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value
because more than one type-casting rule may apply. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Compilation error!
myVar = na</code></div>
<p>The above line of code causes a compilation error because the compiler
cannot determine the nature of the <code dir="auto">myVar</code> variable, i.e., whether the
variable will reference numeric values for plotting, string values for
setting text in a label, or other values for some other purpose later in
the script’s execution.</p>
<p>To resolve such errors, we must explicitly declare the type associated
with the variable. Suppose the <code dir="auto">myVar</code> variable will reference “float”
values in subsequent script iterations. We can resolve the error by
declaring the variable with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
keyword:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float myVar = na</code></div>
<p>or by explicitly casting the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value
to the “float” type via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_float">float()</a>
function:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myVar = float(na)</code></div>
<p>To test if the value from a variable or expression is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, we
call the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_na">na()</a>
function, which returns <code dir="auto">true</code> if the value is undefined. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable Is 0 if the `myVar` is `na`, `close` otherwise.
float myClose = na(myVar) ? 0 : close</code></div>
<p>Do not use the <code dir="auto">==</code> comparison operator to test for
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values, as scripts cannot determine the equality of an undefined value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable Returns the `close` value. The script cannot compare the equality of `na` values, as they're undefined.
float myClose = myVar == na ? 0 : close</code></div>
<p>Best coding practices often involve handling
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values to prevent undefined values in calculations.</p>
<p>We can ensure the expression also returns an actionable value on the
first bar by replacing the undefined past value with a value from the
current bar. This line of code uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a>
function to replace the past bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
with the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
when the value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable Is `true` when the `close` exceeds the last bar's `close` (or the current `open` if the value is `na`).
bool risingClose = close &gt; nz(close[1], open)</code></div>
<p>Protecting scripts against
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
instances helps to prevent undefined values from propagating in a
calculation’s results. For example, this script declares an
<code dir="auto">allTimeHigh</code> variable on the first bar. It then uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max">math.max()</a>
between the <code dir="auto">allTimeHigh</code> and the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
to update the <code dir="auto">allTimeHigh</code> throughout its execution:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("na protection demo", overlay = true)

//@variable The result of calculating the all-time high price with an initial value of `na`.
var float allTimeHigh = na

// Reassign the value of the `allTimeHigh`.
// Returns `na` on all bars because `math.max()` can't compare the `high` to an undefined value.
allTimeHigh := math.max(allTimeHigh, high)

plot(allTimeHigh) // Plots `na` on all bars.</code></div>
<p>This script plots a value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> on
all bars, as we have not included any
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
protection in the code. To fix the behavior and plot the intended result
(i.e., the all-time high of the chart’s prices), we can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> to
replace
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values in the <code dir="auto">allTimeHigh</code> series:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("na protection demo", overlay = true)

//@variable The result of calculating the all-time high price with an initial value of `na`.
var float allTimeHigh = na

// Reassign the value of the `allTimeHigh`.
// We've used `nz()` to prevent the initial `na` value from persisting throughout the calculation.
allTimeHigh := math.max(nz(allTimeHigh), high)

plot(allTimeHigh)</code></div>
<h2 class="md-heading" id="type-templates"><a href="#type-templates">Type templates<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Type templates specify the data types that collections
(<a href="/pine-script-docs/v5/language/arrays/">arrays</a>,
<a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and
<a href="/pine-script-docs/v5/language/maps/">maps</a>) can contain.</p>
<p>Templates for <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and
<a href="/pine-script-docs/v5/language/matrices/">matrices</a> consist of a
single type identifier surrounded by angle brackets, e.g., <code dir="auto">&lt;int&gt;</code>,
<code dir="auto">&lt;label&gt;</code>, and <code dir="auto">&lt;PivotPoint&gt;</code> (where <code dir="auto">PivotPoint</code> is a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a>).</p>
<p>Templates for <a href="/pine-script-docs/v5/language/maps/">maps</a> consist of
two type identifiers enclosed in angle brackets, where the first
specifies the type of <em>keys</em> in each key-value pair, and the second
specifies the <em>value</em> type. For example, <code dir="auto">&lt;string, float&gt;</code> is a type
template for a map that holds <code dir="auto">string</code> keys and <code dir="auto">float</code> values.</p>
<p>Users can construct type templates from:</p>
<ul>
<li>Fundamental types:
<a href="/pine-script-docs/v5/language/type-system/#int">int</a>,
<a href="/pine-script-docs/v5/language/type-system/#float">float</a>,
<a href="/pine-script-docs/v5/language/type-system/#bool">bool</a>,
<a href="/pine-script-docs/v5/language/type-system/#color">color</a>,
and <a href="/pine-script-docs/v5/language/type-system/#string">string</a></li>
<li>The following special types:
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">line</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">linefill</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">box</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">polyline</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">label</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">table</a>, and
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart.point</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#user-defined-types">User-defined types (UDTs)</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#enum-types">Enum types</a></li>
</ul>
<p>Note that:</p>
<ul>
<li><a href="/pine-script-docs/v5/language/maps/">Maps</a> can use any of
these types as <em>values</em>, but they can only accept fundamental
types or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a> as <em>keys</em>.</li>
</ul>
<p>Scripts use type templates to declare variables that reference
collections, and when creating new collection instances. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Type templates demo")

//@variable A variable initially assigned to `na` that accepts arrays of "int" values.
array&lt;int&gt; intArray = na
//@variable An empty matrix that holds "float" values.
floatMatrix = matrix.new&lt;float&gt;()
//@variable An empty map that holds "string" keys and "color" values.
stringColorMap = map.new&lt;string, color&gt;()</code></div>
<h2 class="md-heading" id="type-casting"><a href="#type-casting">Type casting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ includes an automatic type-casting mechanism that <em>casts</em>
(converts) <strong>“int”</strong> values to <strong>“float”</strong> when necessary. Variables
or expressions requiring “float” values can also use “int” values
because any integer can be represented as a floating point number with
its fractional part equal to 0.</p>
<p>For the sake of backward compatibility, Pine Script™ also automatically
casts <strong>“int”</strong> and <strong>“float”</strong> values to <strong>“bool”</strong> when
necessary. When passing numeric values to the parameters of functions
and operations that expect “bool” types, Pine auto-casts them to
“bool”. However, we do not recommend relying on this behavior. Most
scripts that automatically cast numeric values to the “bool” type will
produce a <em>compiler warning</em>. One can avoid the compiler warning and
promote code readability by using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bool">bool()</a>
function, which explicitly casts a numeric value to the “bool” type.</p>
<p>When casting an “int” or “float” to “bool”, a value of 0 converts
to <code dir="auto">false</code> and any other numeric value always converts to <code dir="auto">true</code>.</p>
<p>This code below demonstrates deprecated auto-casting behavior in Pine.
It creates a <code dir="auto">randomValue</code> variable with a “series float” value on
every bar, which it passes to the <code dir="auto">condition</code> parameter in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure and the <code dir="auto">series</code> parameter in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
function call. Since both parameters accept “bool” values, the script
automatically casts the <code dir="auto">randomValue</code> to “bool” when evaluating them:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Auto-casting demo", overlay = true)

//@variable A random rounded value between -1 and 1.
float randomValue = math.round(math.random(-1, 1))
//@variable The color of the chart background.
color bgColor = na

// This raises a compiler warning since `randomValue` is a "float", but `if` expects a "bool".
if randomValue
    bgColor := color.new(color.blue, 60)
// This does not raise a warning, as the `bool()` function explicitly casts the `randomValue` to "bool".
if bool(randomValue)
    bgColor := color.new(color.blue, 60)

// Display unicode characters on the chart based on the `randomValue`.
// Whenever `math.random()` returns 0, no character will appear on the chart because 0 converts to `false`.
plotchar(randomValue)
// We recommend explicitly casting the number with the `bool()` function to make the type transformation more obvious.
plotchar(bool(randomValue))

// Highlight the background with the `bgColor`.
bgcolor(bgColor)</code></div>
<p>It’s sometimes necessary to cast one type to another when auto-casting
rules do not suffice. For such cases, the following type-casting
functions are available:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_int">int()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_float">float()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bool">bool()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color">color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_string">string()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line">line()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill">linefill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label">label()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box">box()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table">table()</a>.</p>
<p>The example below shows a code that tries to use a “const float” value
as the <code dir="auto">length</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
function call. The script will fail to compile, as it cannot
automatically convert the “float” value to the required “int” type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Explicit casting demo", overlay = true)

//@variable The length of the SMA calculation. Qualified as "const float".
float LENGTH = 10.0

float sma = ta.sma(close, LENGTH) // Compilation error. The `length` parameter requires an "int" value.

plot(sma)</code></div>
<p>The code raises the following error: <em>“Cannot call ‘ta.sma’ with
argument ‘length’=‘LENGTH’. An argument of ‘const float’ type was
used but a ‘series int’ is expected.”</em></p>
<p>The compiler is telling us that the code is using a “float” value
where an “int” is required. There is no auto-casting rule to cast a
“float” to an “int”, so we must do the job ourselves. In this
version of the code, we’ve used the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_int">int()</a>
function to explicitly convert our “float” <code dir="auto">LENGTH</code> value to the
“int” type within the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("explicit casting demo")

//@variable The length of the SMA calculation. Qualified as "const float".
float LENGTH = 10.0

float sma = ta.sma(close, int(LENGTH)) // Compiles successfully since we've converted the `LENGTH` to "int".

plot(sma)</code></div>
<p>Explicit type casting is also handy when declaring variables assigned to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, as
explained in the
<a href="/pine-script-docs/v5/language/type-system/#na-value">previous section</a>.</p>
<p>For example, once could explicitly declare a variable with a value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> as a
“label” type in either of the following, equivalent ways:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Explicitly specify that the variable references "label" objects:
label myLabel = na

// Explicitly cast the `na` value to the "label" type:
myLabel = label(na)</code></div>
<h2 class="md-heading" id="tuples"><a href="#tuples">Tuples<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A <em>tuple</em> is a comma-separated set of expressions enclosed in brackets.
When a function, <a href="/pine-script-docs/v5/language/methods/">method</a>,
or other local block returns more than one value, scripts return those
values in the form of a tuple.</p>
<p>For example, the following
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> returns the sum and product of two “float” values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function Calculates the sum and product of two values.
calcSumAndProduct(float a, float b) =&gt;
    //@variable The sum of `a` and `b`.
    float sum = a + b
    //@variable The product of `a` and `b`.
    float product = a * b
    // Return a tuple containing the `sum` and `product`.
    [sum, product]</code></div>
<p>When we call this function later in the script, we use a <em>tuple
declaration</em> to declare multiple variables corresponding to the values
returned by the function call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Declare a tuple containing the sum and product of the `high` and `low`, respectively.
[hlSum, hlProduct] = calcSumAndProduct(high, low)</code></div>
<p>Keep in mind that unlike declaring single variables, we cannot
explicitly define the types the tuple’s variables (<code dir="auto">hlSum</code> and
<code dir="auto">hlProduct</code> in this case), will contain. The compiler automatically
infers the types associated with the variables in a tuple.</p>
<p>In the above example, the resulting tuple contains values of the same
type (“float”). However, it’s important to note that tuples can
contain values of <em>multiple types</em>. For example, the <code dir="auto">chartInfo()</code>
function below returns a tuple containing “int”, “float”, “bool”,
“color”, and “string” values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function Returns information about the current chart.
chartInfo() =&gt;
    //@variable The first visible bar's UNIX time value.
    int firstVisibleTime = chart.left_visible_bar_time
    //@variable The `close` value at the `firstVisibleTime`.
    float firstVisibleClose = ta.valuewhen(ta.cross(time, firstVisibleTime), close, 0)
    //@variable Is `true` when using a standard chart type, `false` otherwise.
    bool isStandard = chart.is_standard
    //@variable The foreground color of the chart.
    color fgColor = chart.fg_color
    //@variable The ticker ID of the current chart.
    string symbol = syminfo.tickerid
    // Return a tuple containing the values. 
    [firstVisibleTime, firstVisibleClose, isStandard, fgColor, symbol]</code></div>
<p>Tuples are especially handy for requesting multiple values in one
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call.</p>
<p>For instance, this <code dir="auto">roundedOHLC()</code> function returns a tuple containing
OHLC values rounded to the nearest prices that are divisible by the
symbol’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.mintick">minimum
tick</a>
value. We call this function as the <code dir="auto">expression</code> argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to request a tuple containing daily OHLC values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function Returns a tuple of OHLC values, rounded to the nearest tick.
roundedOHLC() =&gt;
    [math.round_to_mintick(open), math.round_to_mintick(high), math.round_to_mintick(low), math.round_to_mintick(close)]

[op, hi, lo, cl] = request.security(syminfo.tickerid, "D", roundedOHLC())</code></div>
<p>We can also achieve the same result by directly passing a tuple of
rounded values as the <code dir="auto">expression</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[op, hi, lo, cl] = request.security(
     syminfo.tickerid, "D", 
     [math.round_to_mintick(open), math.round_to_mintick(high), math.round_to_mintick(low), math.round_to_mintick(close)]
 )</code></div>
<p>Local blocks of
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
statements, can return tuples. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[v1, v2] = if close &gt; open
    [high, close]
else
    [close, low]</code></div>
<p>and:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[v1, v2] = switch 
close &gt; open =&gt; [high, close]
=&gt;              [close, low]</code></div>
<p>However, ternaries cannot contain tuples, as the return values in a
ternary statement are not considered local blocks:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Not allowed.
[v1, v2] = close &gt; open ? [high, close] : [close, low]</code></div>
<p>Note that all items within a tuple returned from a function are
qualified as “simple” or “series”, depending on its contents. If a
tuple contains a “series” value, all other elements within the tuple
will also adopt the “series” qualifier. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Qualified types in tuples demo")

makeTicker(simple string prefix, simple string ticker) =&gt;
    tId = prefix + ":" + ticker // simple string
    source = close  // series float
    [tId, source]

// Both variables are series now. 
[tId, source] = makeTicker("BATS", "AAPL") 

// Error cannot call 'request.security' with 'series string' tId.
r = request.security(tId, "", source)

plot(r)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/loops"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Loops  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/built-ins"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Built-ins <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Built-ins</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-built-ins"><a href="#built-ins">Built-ins<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ has hundreds of <em>built-in</em> variables and functions. They
provide your scripts with valuable information and make calculations for
you, dispensing you from coding them. The better you know the built-ins,
the more you will be able to do with your Pine scripts.</p>
<p>In this page we present an overview of some of Pine Script™‘s built-in
variables and functions. They will be covered in more detail in the
pages of this manual covering specific themes.</p>
<p>All built-in variables and functions are defined in the Pine Script™ <a href="https://www.tradingview.com/pine-script-reference/v5/">v5
Reference
Manual</a>. It is
called a “Reference Manual” because it is the definitive reference on
the Pine Script™ language. It is an essential tool that will accompany
you anytime you code in Pine, whether you are a beginner or an expert.
If you are learning your first programming language, make the <a href="https://www.tradingview.com/pine-script-reference/v5/">Reference
Manual</a> your
friend. Ignoring it will make your programming experience with Pine
Script™ difficult and frustrating — as it would with any other
programming language.</p>
<p>Variables and functions in the same family share the same <em>namespace</em>,
which is a prefix to the function’s name. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>
function, for example, is in the <code dir="auto">ta</code> namespace, which stands for
“technical analysis”. A namespace can contain both variables and
functions.</p>
<p>Some variables have function versions as well, e.g.:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dtr">ta.tr</a>
variable returns the “True Range” of the current bar. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dtr">ta.tr(true)</a>
function call also returns the “True Range”, but when the previous
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value which is normally needed to calculate it is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
it calculates using <code dir="auto">high - low</code> instead.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
variable gives the time at the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
of the current bar. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time(timeframe)</a>
function returns the time of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
from the <code dir="auto">timeframe</code> specified, even if the chart’s timeframe is
different. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time(timeframe,
session)</a>
function returns the time of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
from the <code dir="auto">timeframe</code> specified, but only if it is within the
<code dir="auto">session</code> time. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time(timeframe, session,
timezone)</a>
function returns the time of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
from the <code dir="auto">timeframe</code> specified, but only if it is within the
<code dir="auto">session</code> time in the specified <code dir="auto">timezone</code>.</li>
</ul>
<h2 class="md-heading" id="built-in-variables"><a href="#built-in-variables">Built-in variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Built-in variables exist for different purposes. These are a few
examples:</p>
<ul>
<li>Price- and volume-related variables:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>.</li>
<li>Symbol-related information in the <code dir="auto">syminfo</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dbasecurrency">syminfo.basecurrency</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dcurrency">syminfo.currency</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Ddescription">syminfo.description</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dmintick">syminfo.mintick</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dpointvalue">syminfo.pointvalue</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dprefix">syminfo.prefix</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Droot">syminfo.root</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dsession">syminfo.session</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dticker">syminfo.ticker</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtickerid">syminfo.tickerid</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone">syminfo.timezone</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtype">syminfo.type</a>.</li>
<li>Timeframe (a.k.a. “interval” or “resolution”, e.g., 15sec,
30min, 60min, 1D, 3M) variables in the <code dir="auto">timeframe</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disseconds">timeframe.isseconds</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disminutes">timeframe.isminutes</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disintraday">timeframe.isintraday</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdaily">timeframe.isdaily</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disweekly">timeframe.isweekly</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dismonthly">timeframe.ismonthly</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdwm">timeframe.isdwm</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dmultiplier">timeframe.multiplier</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>.</li>
<li>Bar states in the <code dir="auto">barstate</code> namespace (see the
<a href="/pine-script-docs/v5/concepts/bar-states/">Bar states</a> page):
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disfirst">barstate.isfirst</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dishistory">barstate.ishistory</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislastconfirmedhistory">barstate.islastconfirmedhistory</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disrealtime">barstate.isrealtime</a>.</li>
<li>Strategy-related information in the <code dir="auto">strategy</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dequity">strategy.equity</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dinitial_capital">strategy.initial_capital</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dgrossloss">strategy.grossloss</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dgrossprofit">strategy.grossprofit</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dwintrades">strategy.wintrades</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dlosstrades">strategy.losstrades</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_size">strategy.position_size</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_avg_price">strategy.position_avg_price</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dwintrades">strategy.wintrades</a>,
etc.</li>
</ul>
<h2 class="md-heading" id="built-in-functions"><a href="#built-in-functions">Built-in functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Many functions are used for the result(s) they return. These are a few
examples:</p>
<ul>
<li>Math-related functions in the <code dir="auto">math</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dabs">math.abs()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dlog">math.log()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dmax">math.max()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Drandom">math.random()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Dround_to_mintick">math.round_to_mintick()</a>,
etc.</li>
<li>Technical indicators in the <code dir="auto">ta</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dmacd">ta.macd()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Drsi">ta.rsi()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsupertrend">ta.supertrend()</a>,
etc.</li>
<li>Support functions often used to calculate technical indicators in
the <code dir="auto">ta</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbarssince">ta.barssince()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dcrossover">ta.crossover()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dhighest">ta.highest()</a>,
etc.</li>
<li>Functions to request data from other symbols or timeframes in the
<code dir="auto">request</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Ddividends">request.dividends()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dearnings">request.earnings()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dfinancial">request.financial()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dquandl">request.quandl()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsplits">request.splits()</a>.</li>
<li>Functions to manipulate strings in the <code dir="auto">str</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dformat">str.format()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dlength">str.length()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtonumber">str.tonumber()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>,
etc.</li>
<li>Functions used to define the input values that script users can
modify in the script’s “Settings/Inputs” tab, in the <code dir="auto">input</code>
namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input">input()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dcolor">input.color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dint">input.int()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsession">input.session()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsymbol">input.symbol()</a>,
etc.</li>
<li>Functions used to manipulate colors in the <code dir="auto">color</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.new()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dnew">color.rgb()</a>,
etc.</li>
</ul>
<p>Some functions do not return a result but are used for their side
effects, which means they do something, even if they don’t return a
result:</p>
<ul>
<li>Functions used as a declaration statement defining one of three
types of Pine scripts, and its properties. Each script must begin
with a call to one of these functions:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>.</li>
<li>Plotting or coloring functions:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>.</li>
<li>Strategy functions placing orders, in the <code dir="auto">strategy</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dcancel">strategy.cancel()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose">strategy.close()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit">strategy.exit()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder">strategy.order()</a>,
etc.</li>
<li>Strategy functions returning information on indivdual past trades,
in the <code dir="auto">strategy</code> namespace:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dentry_bar_index">strategy.closedtrades.entry_bar_index()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dentry_price">strategy.closedtrades.entry_price()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dentry_time">strategy.closedtrades.entry_time()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_bar_index">strategy.closedtrades.exit_bar_index()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dmax_drawdown">strategy.closedtrades.max_drawdown()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dmax_runup">strategy.closedtrades.max_runup()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dprofit">strategy.closedtrades.profit()</a>,
etc.</li>
<li>Functions to generate alert events:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>.</li>
</ul>
<p>Other functions return a result, but we don’t always use it, e.g.:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dpop">array.pop()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>,
etc.</p>
<p>All built-in functions are defined in the Pine Script™ <a href="https://www.tradingview.com/pine-script-reference/v5/">v5 Reference
Manual</a>. You can
click on any of the function names listed here to go to its entry in the
Reference Manual, which documents the function’s signature, i.e., the
list of <em>parameters</em> it accepts and the qualified type of the value(s)
it returns (a function can return more than one result). The Reference
Manual entry will also list, for each parameter:</p>
<ul>
<li>Its name.</li>
<li>The qualified type of the value it requires (we use <em>argument</em> to
name the values passed to a function when calling it).</li>
<li>If the parameter is required or not.</li>
</ul>
<p>All built-in functions have one or more parameters defined in their
signature. Not all parameters are required for every function.</p>
<p>Let’s look at the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dvwma">ta.vwma()</a>
function, which returns the volume-weighted moving average of a source
value. This is its entry in the Reference Manual:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="838" loading="lazy" src="images/f55c24be42f1536f4923a4e63b3f69e1.webp" width="1418"/></div></p>
<p>The entry gives us the information we need to use it:</p>
<ul>
<li>What the function does.</li>
<li>Its signature (or definition):</li>
</ul>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">ta.vwma(source, length) → series float</span></div></div></code></pre></figure></link></div>
<ul>
<li>The parameters it includes: <code dir="auto">source</code> and <code dir="auto">length</code></li>
<li>The qualified type of the result it returns: “series float”.</li>
<li>An example showing it in use: <code dir="auto">plot(ta.vwma(close, 15))</code>.</li>
<li>An example showing what it does, but in long form, so you can better
understand its calculations. Note that this is meant to explain ---
not as usable code, because it is more complicated and takes longer
to execute. There are only disadvantages to using the long form.</li>
<li>The “RETURNS” section explains exacty what value the function
returns.</li>
<li>The “ARGUMENTS” section lists each parameter and gives the
critical information concerning what qualified type is required for
arguments used when calling the function.</li>
<li>The “SEE ALSO” section refers you to related Reference Manual
entries.</li>
</ul>
<p>This is a call to the function in a line of code that declares a
<code dir="auto">myVwma</code> variable and assigns the result of <code dir="auto">ta.vwma(close, 20)</code> to it:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myVwma = ta.vwma(close, 20)</code></div>
<p>Note that:</p>
<ul>
<li>We use the built-in variable
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
as the argument for the <code dir="auto">source</code> parameter.</li>
<li>We use <code dir="auto">20</code> as the argument for the <code dir="auto">length</code> parameter.</li>
<li>If placed in the global scope (i.e., starting in a line’s first
position), it will be executed by the Pine Script™ runtime on each
bar of the chart.</li>
</ul>
<p>We can also use the parameter names when calling the function. Parameter
names are called <em>keyword arguments</em> when used in a function call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myVwma = ta.vwma(source = close, length = 20)</code></div>
<p>You can change the position of arguments when using keyword arguments,
but only if you use them for all your arguments. When calling functions
with many parameters such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
you can also forego keyword arguments for the first arguments, as long
as you don’t skip any. If you skip some, you must then use keyword
arguments so the Pine Script™ compiler can figure out which parameter
they correspond to, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">indicator("Example", "Ex", true, max_bars_back = 100)</code></div>
<p>Mixing things up this way is not allowed:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">indicator(precision = 3, "Example") // Compilation error!</code></div>
<p><strong>When calling built-ins, it is critical to ensure that the arguments
you use are of the required qualified type, which will vary for each
parameter.</strong></p>
<p>To learn how to do this, one needs to understand Pine Script™‘s
<a href="/pine-script-docs/v5/language/type-system/">type system</a>. The
Reference Manual entry for each built-in function includes an
“ARGUMENTS” section which lists the qualified type required for the
argument supplied to each of the function’s parameters.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/type-system"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Type system  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/user-defined-functions"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  User-defined functions <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">User-defined functions</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="language-user-defined-functions"><a href="#user-defined-functions">User-defined functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>User-defined functions are functions that you write, as opposed to the
built-in functions in Pine Script™. They are useful to define
calculations that you must do repetitevely, or that you want to isolate
from your script’s main section of calculations. Think of user-defined
functions as a way to extend the capabilities of Pine Script™, when no
built-in function will do what you need.</p>
<p>You can write your functions in two ways:</p>
<ul>
<li>In a single line, when they are simple, or</li>
<li>On multiple lines</li>
</ul>
<p>Functions can be located in two places:</p>
<ul>
<li>If a function is only used in one script, you can include it in the
script where it is used. See our
<a href="/pine-script-docs/v5/writing/style-guide/#function_declarations">Style guide</a> for recommendations on where to place functions in your
script.</li>
<li>You can create a Pine Script™
<a href="/pine-script-docs/v5/concepts/libraries/">library</a> to include
your functions, which makes them reusable in other scripts without
having to copy their code. Distinct requirements exist for library
functions. They are explained in the page on
<a href="/pine-script-docs/v5/concepts/libraries/">libraries</a>.</li>
</ul>
<p>Whether they use one line or multiple lines, user-defined functions have
the following characteristics:</p>
<ul>
<li>They cannot be embedded. All functions are defined in the script’s
global scope.</li>
<li>They do not support recursion. It is <strong>not allowed</strong> for a function
to call itself from within its own code.</li>
<li>The type of the value returned by a function is determined
automatically and depends on the type of arguments used in each
particular function call.</li>
<li>A function’s returned value is that of the last value in the
function’s body.</li>
<li>Each instance of a function call in a script maintains its own,
independent history.</li>
</ul>
<h2 class="md-heading" id="single-line-functions"><a href="#single-line-functions">Single-line functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Simple functions can often be written in one line. This is the formal
definition of single-line functions:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;function_declaration&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;identifier&gt;(&lt;parameter_list&gt;) =&gt; &lt;return_value&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;parameter_list&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">{&lt;parameter_definition&gt;{, &lt;parameter_definition&gt;}}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;parameter_definition&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">[&lt;identifier&gt; = &lt;default_value&gt;]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;return_value&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;statement&gt; | &lt;expression&gt; | &lt;tuple&gt;</span></div></div></code></pre></figure></link></div>
<p>Here is an example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">f(x, y) =&gt; x + y</code></div>
<p>After the function <code dir="auto">f()</code> has been declared, it’s possible to call it
using different types of arguments:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = f(open, close)
b = f(2, 2)
c = f(open, 2)</code></div>
<p>In the example above, the type of variable <code dir="auto">a</code> is <em>series</em> because the
arguments are both <em>series</em>. The type of variable <code dir="auto">b</code> is <em>integer</em>
because arguments are both <em>literal integers</em>. The type of variable <code dir="auto">c</code>
is <em>series</em> because the addition of a <em>series</em> and <em>literal integer</em>
produces a <em>series</em> result.</p>
<h2 class="md-heading" id="multi-line-functions"><a href="#multi-line-functions">Multi-line functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ also supports multi-line functions with the following
syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;identifier&gt;(&lt;parameter_list&gt;) =&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;local_block&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;identifier&gt;(&lt;list of parameters&gt;) =&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;variable declaration&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;variable declaration or expression&gt;</span></div></div></code></pre></figure></div>
<p>where:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;parameter_list&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">{&lt;parameter_definition&gt;{, &lt;parameter_definition&gt;}}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;parameter_definition&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">[&lt;identifier&gt; = &lt;default_value&gt;]</span></div></div></code></pre></figure></div>
<p>The body of a multi-line function consists of several statements. Each
statement is placed on a separate line and must be preceded by 1
indentation (4 spaces or 1 tab). The indentation before the statement
indicates that it is a part of the body of the function and not part of
the script’s global scope. After the function’s code, the first
statement without an indent indicates the body of the function has
ended.</p>
<p>Either an expression or a declared variable should be the last statement
of the function’s body. The result of this expression (or variable)
will be the result of the function’s call. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">geom_average(x, y) =&gt;
    a = x*x
    b = y*y
    math.sqrt(a + b)</code></div>
<p>The function <code dir="auto">geom_average</code> has two arguments and creates two variables
in the body: <code dir="auto">a</code> and <code dir="auto">b</code>. The last statement calls the function
<code dir="auto">math.sqrt</code> (an extraction of the square root). The <code dir="auto">geom_average</code> call
will return the value of the last expression: <code dir="auto">(math.sqrt(a + b))</code>.</p>
<h2 class="md-heading" id="scopes-in-the-script"><a href="#scopes-in-the-script">Scopes in the script<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Variables declared outside the body of a function or of other local
blocks belong to the <em>global</em> scope. User-declared and built-in
functions, as well as built-in variables also belong to the global
scope.</p>
<p>Each function has its own <em>local</em> scope. All the variables declared
within the function, as well as the function’s arguments, belong to the
scope of that function, meaning that it is impossible to reference them
from outside --- e.g., from the global scope or the local scope of
another function.</p>
<p>On the other hand, since it is possible to refer to any variable or
function declared in the global scope from the scope of a function
(except for self-referencing recursive calls), one can say that the
local scope is embedded into the global scope.</p>
<p>In Pine Script™, nested functions are not allowed, i.e., one cannot
declare a function inside another one. All user functions are declared
in the global scope. Local scopes cannot intersect with each other.</p>
<h2 class="md-heading" id="functions-that-return-multiple-results"><a href="#functions-that-return-multiple-results">Functions that return multiple results<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In most cases a function returns only one result, but it is possible to
return a list of results (a <em>tuple</em>-like result):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">fun(x, y) =&gt;
    a = x+y
    b = x-y
    [a, b]</code></div>
<p>Special syntax is required for calling such functions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[res0, res1] = fun(open, close)
plot(res0)
plot(res1)</code></div>
<h2 class="md-heading" id="limitations"><a href="#limitations">Limitations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>User-defined functions can use any of the Pine Script™ built-ins,
except:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/built-ins"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Built-ins  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/objects"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Objects <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Objects</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-objects"><a href="#objects">Objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ objects are instances of <em>user-defined types</em> (UDTs). They
are the equivalent of variables containing parts called <em>fields</em>, each
able to hold independent values that can be of various types.</p>
<p>Experienced programmers can think of UDTs as methodless classes. They
allow users to create custom types that organize different values under
one logical entity.</p>
<h2 class="md-heading" id="creating-objects"><a href="#creating-objects">Creating objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Before an object can be created, its type must be defined. The
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">User-defined types</a> section of the
<a href="/pine-script-docs/v5/language/type-system/">Type system</a> page
explains how to do so.</p>
<p>Let’s define a <code dir="auto">pivotPoint</code> type to hold pivot information:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">type pivotPoint
    int x
    float y
    string xloc = xloc.bar_time</code></div>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a>
keyword to declare the creation of a UDT.</li>
<li>We name our new UDT <code dir="auto">pivotPoint</code>.</li>
<li>After the first line, we create a local block containing the type
and name of each field.</li>
<li>The <code dir="auto">x</code> field will hold the x-coordinate of the pivot. It is
declared as an “int” because it will hold either a timestamp or a
bar index of “int” type.</li>
<li><code dir="auto">y</code> is a “float” because it will hold the pivot’s price.</li>
<li><code dir="auto">xloc</code> is a field that will specify the units of <code dir="auto">x</code>:
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_index">xloc.bar_index</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>.
We set its default value to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>
by using the <code dir="auto">=</code> operator. When an object is created from that UDT,
its <code dir="auto">xloc</code> field will thus be set to that value.</li>
</ul>
<p>Now that our <code dir="auto">pivotPoint</code> UDT is defined, we can proceed to create
objects from it. We create objects using the UDT’s <code dir="auto">new()</code> built-in
method. To create a new <code dir="auto">foundPoint</code> object from our <code dir="auto">pivotPoint</code> UDT,
we use:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new()</code></div>
<p>We can also specify field values for the created object using the
following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new(time, high)</code></div>
<p>Or the equivalent:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new(x = time, y = high)</code></div>
<p>At this point, the <code dir="auto">foundPoint</code> object’s <code dir="auto">x</code> field will contain the
value of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
built-in when it is created, <code dir="auto">y</code> will contain the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and the <code dir="auto">xloc</code> field will contain its default value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>
because no value was defined for it when creating the object.</p>
<p>Object placeholders can also be created by declaring
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
object names using the following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">pivotPoint foundPoint = na</code></div>
<p>This example displays a label where high pivots are detected. The pivots
are detected <code dir="auto">legsInput</code> bars after they occur, so we must plot the
label in the past for it to appear on the pivot:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pivot labels", overlay = true)
int legsInput = input(10)

// Define the `pivotPoint` UDT.
type pivotPoint
    int x
    float y
    string xloc = xloc.bar_time

// Detect high pivots.
pivotHighPrice = ta.pivothigh(legsInput, legsInput)
if not na(pivotHighPrice)
    // A new high pivot was found; display a label where it occurred `legsInput` bars back.
    foundPoint = pivotPoint.new(time[legsInput], pivotHighPrice)
    label.new(
      foundPoint.x,
      foundPoint.y,
      str.tostring(foundPoint.y, format.mintick),
      foundPoint.xloc,
      textcolor = color.white)</code></div>
<p>Take note of this line from the above example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new(time[legsInput], pivotHighPrice)</code></div>
<p>This could also be written using the following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">pivotPoint foundPoint = na
foundPoint := pivotPoint.new(time[legsInput], pivotHighPrice)</code></div>
<p>When using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword while declaring a variable assigned to an object of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a>, the keyword automatically applies to all the object’s
fields:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Objects using `var` demo")

//@type A custom type to hold index, price, and volume information.
type BarInfo
    int   index = bar_index
    float price = close
    float vol   = volume

//@variable A `BarInfo` instance whose fields persist through all iterations, starting from the first bar.
var BarInfo firstBar = BarInfo.new()
//@variable A `BarInfo` instance declared on every bar.
BarInfo currentBar = BarInfo.new()

// Plot the `index` fields of both instances to compare the difference. 
plot(firstBar.index)
plot(currentBar.index)</code></div>
<p>It’s important to note that assigning an object to a variable that uses
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keyword does <em>not</em> automatically allow the object’s fields to persist
without rolling back on each <em>intrabar</em> update. One must apply the
keyword to each desired field in the type declaration to achieve this
behavior. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Objects using `varip` fields demo")

//@type A custom type that counts the bars and ticks in the script's execution.
type Counter
    int       bars  = 0
    varip int ticks = 0

//@variable A `Counter` object whose reference persists throughout all bars.
var Counter counter = Counter.new()

// Add 1 to the `bars` and `ticks` fields. The `ticks` field is not subject to rollback on unconfirmed bars.
counter.bars  += 1
counter.ticks += 1

// Plot both fields for comparison. 
plot(counter.bars, "Bar counter", color.blue, 3)
plot(counter.ticks, "Tick counter", color.purple, 3)</code></div>
<p>Note that:</p>
<ul>
<li>We used the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to specify that the <code dir="auto">Counter</code> object assigned to the
<code dir="auto">counter</code> variable persists throughout the script’s execution.</li>
<li>The <code dir="auto">bars</code> field rolls back on realtime bars, whereas the
<code dir="auto">ticks</code> field does not since we included
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
in its declaration.</li>
</ul>
<h2 class="md-heading" id="changing-field-values"><a href="#changing-field-values">Changing field values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The value of an object’s fields can be changed using the
<a href="/pine-script-docs/v5/language/operators/#-reassignment-operator">:=</a>
reassignment operator.</p>
<p>This line of our previous example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new(time[legsInput], pivotHighPrice)</code></div>
<p>Could be written using the following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">foundPoint = pivotPoint.new()
foundPoint.x := time[legsInput]
foundPoint.y := pivotHighPrice</code></div>
<h2 class="md-heading" id="collecting-objects"><a href="#collecting-objects">Collecting objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ collections (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and <a href="/pine-script-docs/v5/language/maps/">maps</a>) can contain
objects, allowing users to add virtual dimensions to their data
structures. To declare a collection of objects, pass a UDT name into its
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a>.</p>
<p>This example declares an empty
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
that will hold objects of a <code dir="auto">pivotPoint</code> user-defined type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">pivotHighArray = array.new&lt;pivotPoint&gt;()</code></div>
<p>To explicitly declare the type of a variable as an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>,
or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a>, use the collection’s type keyword followed by its
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a>. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">var array&lt;pivotPoint&gt; pivotHighArray = na
pivotHighArray := array.new&lt;pivotPoint&gt;()</code></div>
<p>Let’s use what we have learned to create a script that detects high
pivot points. The script first collects historical pivot information in
an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.
It then loops through the array on the last historical bar, creating a
label for each pivot and connecting the pivots with lines:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="952" loading="lazy" src="images/9e39a9975e7c52591e7dbf2d11ea0f87.webp" width="2018"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pivot Points High", overlay = true)

int legsInput = input(10)

// Define the `pivotPoint` UDT containing the time and price of pivots.
type pivotPoint
    int openTime
    float level

// Create an empty `pivotPoint` array.
var pivotHighArray = array.new&lt;pivotPoint&gt;()

// Detect new pivots (`na` is returned when no pivot is found).
pivotHighPrice = ta.pivothigh(legsInput, legsInput)

// Add a new `pivotPoint` object to the end of the array for each detected pivot.
if not na(pivotHighPrice)
    // A new pivot is found; create a new object of `pivotPoint` type, setting its `openTime` and `level` fields.
    newPivot = pivotPoint.new(time[legsInput], pivotHighPrice)
    // Add the new pivot object to the array.
    array.push(pivotHighArray, newPivot)

// On the last historical bar, draw pivot labels and connecting lines.
if barstate.islastconfirmedhistory
    var pivotPoint previousPoint = na
    for eachPivot in pivotHighArray
        // Display a label at the pivot point.
        label.new(eachPivot.openTime, eachPivot.level, str.tostring(eachPivot.level, format.mintick), xloc.bar_time, textcolor = color.white)
        // Create a line between pivots.
        if not na(previousPoint)
            // Only create a line starting at the loop's second iteration because lines connect two pivots.
            line.new(previousPoint.openTime, previousPoint.level, eachPivot.openTime, eachPivot.level, xloc = xloc.bar_time)
        // Save the pivot for use in the next iteration.
        previousPoint := eachPivot</code></div>
<h2 class="md-heading" id="copying-objects"><a href="#copying-objects">Copying objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In Pine, objects are assigned by reference. When an existing object is
assigned to a new variable, both point to the same object.</p>
<p>In the example below, we create a <code dir="auto">pivot1</code> object and set its <code dir="auto">x</code> field
to 1000. Then, we declare a <code dir="auto">pivot2</code> variable containing the reference
to the <code dir="auto">pivot1</code> object, so both point to the same instance. Changing
<code dir="auto">pivot2.x</code> will thus also change <code dir="auto">pivot1.x</code>, as both refer to the <code dir="auto">x</code>
field of the same object:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
type pivotPoint
    int x
    float y
pivot1 = pivotPoint.new()
pivot1.x := 1000
pivot2 = pivot1
pivot2.x := 2000
// Both plot the value 2000.
plot(pivot1.x)
plot(pivot2.x)</code></div>
<p>To create a copy of an object that is independent of the original, we
can use the built-in <code dir="auto">copy()</code> method in this case.</p>
<p>In this example, we declare the <code dir="auto">pivot2</code> variable referring to a copied
instance of the <code dir="auto">pivot1</code> object. Now, changing <code dir="auto">pivot2.x</code> will not
change <code dir="auto">pivot1.x</code>, as it refers to the <code dir="auto">x</code> field of a separate object:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
type pivotPoint
    int x
    float y
pivot1 = pivotPoint.new()
pivot1.x := 1000
pivot2 = pivotPoint.copy(pivot1)
pivot2.x := 2000
// Plots 1000 and 2000.
plot(pivot1.x)
plot(pivot2.x)</code></div>
<p>It’s important to note that the built-in <code dir="auto">copy()</code> method produces a
<em>shallow copy</em> of an object. If an object has fields with <em>special
types</em>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>),
those fields in a shallow copy of the object will point to the same
instances as the original.</p>
<p>In the following example, we have defined an <code dir="auto">InfoLabel</code> type with a
label as one of its fields. The script instantiates a <code dir="auto">shallow</code> copy of
the <code dir="auto">parent</code> object, then calls a user-defined <code dir="auto">set()</code>
<a href="/pine-script-docs/v5/language/methods/">method</a> to update the
<code dir="auto">info</code> and <code dir="auto">lbl</code> fields of each object. Since the <code dir="auto">lbl</code> field of both
objects points to the same label instance, changes to this field in
either object affect the other:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shallow Copy")

type InfoLabel
    string info
    label  lbl

method set(InfoLabel this, int x = na, int y = na, string info = na) =&gt;
    if not na(x)
        this.lbl.set_x(x)
    if not na(y)
        this.lbl.set_y(y)
    if not na(info)
        this.info := info
        this.lbl.set_text(this.info)

var parent  = InfoLabel.new("", label.new(0, 0))
var shallow = parent.copy()

parent.set(bar_index, 0, "Parent")
shallow.set(bar_index, 1, "Shallow Copy")</code></div>
<p>To produce a <em>deep copy</em> of an object with all of its special type
fields pointing to independent instances, we must explicitly copy those
fields as well.</p>
<p>In this example, we have defined a <code dir="auto">deepCopy()</code> method that instantiates
a new <code dir="auto">InfoLabel</code> object with its <code dir="auto">lbl</code> field pointing to a copy of the
original’s field. Changes to the <code dir="auto">deep</code> copy’s <code dir="auto">lbl</code> field will not
affect the <code dir="auto">parent</code> object, as it points to a separate instance:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Deep Copy")

type InfoLabel
    string info
    label  lbl

method set(InfoLabel this, int x = na, int y = na, string info = na) =&gt;
    if not na(x)
        this.lbl.set_x(x)
    if not na(y)
        this.lbl.set_y(y)
    if not na(info)
        this.info := info
        this.lbl.set_text(this.info)

method deepCopy(InfoLabel this) =&gt;
    InfoLabel.new(this.info, this.lbl.copy())

var parent = InfoLabel.new("", label.new(0, 0))
var deep   = parent.deepCopy()

parent.set(bar_index, 0, "Parent")
deep.set(bar_index, 1, "Deep Copy")</code></div>
<h2 class="md-heading" id="shadowing"><a href="#shadowing">Shadowing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To avoid potential conflicts in the eventuality where namespaces added
to Pine Script™ in the future would collide with UDTs or object names in
existing scripts; as a rule, UDTs and object names shadow the
language’s namespaces. For example, a UDT or object can use the name of
built-in types, such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>.</p>
<p>Only the language’s five primitive types cannot be used to name UDTs or
objects:
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_bool">bool</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_color">color</a>.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/user-defined-functions"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> User-defined functions  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/enums"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Enums <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Enums</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-enums"><a href="#enums">Enums<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ Enums, otherwise known as <em>enumerations</em>, <em>enumerated
types</em>, or
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a>, are unique data types with all possible values (<em>members</em>)
explicitly defined by the programmer. They provide a human-readable,
expressive way to declare distinct sets of <em>predefined values</em> that
variables, conditional expressions, and
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> can accept, allowing more strict control over the values
used in a script’s logic.</p>
<h2 class="md-heading" id="declaring-an-enum"><a href="#declaring-an-enum">Declaring an enum<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To declare an enum, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_enum">enum</a>
keyword with the following syntax:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[export ]enum &lt;enumName&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_1&gt;[ = &lt;title_1&gt;]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_2&gt;[ = &lt;title_2&gt;]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;field_N&gt;[ = &lt;title_N&gt;]</span></div></div></code></pre></figure></link></div>
<p>Each <strong>field</strong> in the enum represents a unique, <em>named member</em> (value)
of the <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>. Users can specify optional “const string” <strong>titles</strong> for
enum fields to add extra information about what their values represent.
If the programmer does not specify a field’s title, its title is the
“string” representation of its name.
<a href="/pine-script-docs/v5/concepts/inputs/#enum-input">Enum inputs</a> display enum field titles within their dropdown menus in a
script’s “Settings/Inputs” tab. Scripts can also retrieve enum field
titles using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
function, allowing their use in additional calculations. See
<a href="/pine-script-docs/v5/language/enums/#utilizing-field-titles">this section</a> below for more information.</p>
<p>While the above syntax may look similar to the syntax for declaring
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types (UDTs)</a>, it’s crucial to understand that
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a> and
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>
serve different purposes. Scripts use
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>
to create <a href="/pine-script-docs/v5/language/objects/">objects</a> with
“series” fields that can hold values of <em>any</em> specified type. In
contrast, enums are distinct groups of “simple” fields representing
the specific, <em>predefined values</em> of the same <em>unique</em> type that
variables, expressions, and
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> can accept.</p>
<p>For example, this code block declares a <code dir="auto">Signal</code> enum with three fields:
<code dir="auto">buy</code>, <code dir="auto">sell</code>, and <code dir="auto">neutral</code>. Each field represents a distinct member
(possible value) of the <code dir="auto">Signal</code>
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@enum           An enumeration of named values representing buy, sell, and neutral signal states.
//@field buy      Represents a "Buy signal" state.
//@field sell     Represents a "Sell signal" state.
//@field neutral  Represents a "neutral" state. 
enum Signal
    buy     = "Buy signal"
    sell    = "Sell signal"
    neutral </code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">Signal</code> identifier represents the enum’s name, which
signifies the <em>unique type</em> the fields belong to.</li>
<li>We used the <code dir="auto">//@enum</code> and <code dir="auto">//@field</code>
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">annotations</a> to document the meaning of the enum and its fields.</li>
<li>Unlike the <code dir="auto">buy</code> and <code dir="auto">sell</code> fields, the <code dir="auto">neutral</code> field does not
include a specified title. As such, its title is the “string”
representation of its <em>name</em> (“neutral”).</li>
</ul>
<p>To retrieve a member of an enum, reference its field name using <em>dot
notation</em> syntax, i.e.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">enumName.fieldName</code></div>
<p>As with other types, scripts can assign enum members to variables,
function parameters, and
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
fields, allowing strict control over their allowed values.</p>
<p>For instance, this line of code declares a <code dir="auto">mySignal</code> variable whose
value is the <code dir="auto">neutral</code> member of the <code dir="auto">Signal</code> enum. Any value assigned
to this variable later must also be of the same
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">mySignal = Signal.neutral</code></div>
<p>Note that the above line does not require declaring the variable’s
<em>type</em> as <code dir="auto">Signal</code> because the compiler can automatically infer that
information from the assigned value. If we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> as
the initial value instead, we must use <code dir="auto">Signal</code> as the type keyword to
specify that <code dir="auto">mySignal</code> will accept a <code dir="auto">Signal</code> member:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">Signal mySignal = na</code></div>
<h2 class="md-heading" id="using-enums"><a href="#using-enums">Using enums<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts can compare enum members with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_==">==</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_!=">!=</a>
operators and use them in
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>, allowing the convenient creation of logical patterns with a
reduced risk of unintended values or operations.</p>
<p>The following example declares an <code dir="auto">OscType</code> enum with three fields
representing different oscillator choices: <code dir="auto">rsi</code>, <code dir="auto">mfi</code>, and <code dir="auto">cci</code>. The
<code dir="auto">calcOscillator()</code> function uses <code dir="auto">OscType</code> members within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure to determine which oscillator it calculates. The script calls
this function using the value from an
<a href="/pine-script-docs/v5/concepts/inputs/#enum-input">enum input</a> as the <code dir="auto">selection</code> argument and plots the
resulting oscillator:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="620" loading="lazy" src="images/5a5eeb83deacfa6c7aba33ee6ef391f9.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Using enums demo")

//@enum An enumeration of oscillator choices.
enum OscType
    rsi = "Relative Strength Index"
    mfi = "Money Flow Index"
    cci = "Commodity Channel Index"

//@variable An enumerator (member) of the `OscType` enum.
OscType oscInput = input.enum(OscType.rsi, "Oscillator type")

//@function         Calculates one of three oscillators based on a specified `selection`.
//@param source     The series of values to process.
//@param length     The number of bars in the calculation.
//@param selection  Determines which oscillator to calculate.
calcOscillator(float source, simple int length, OscType selection) =&gt;
    result = switch selection
        OscType.rsi =&gt; ta.rsi(source, length)
        OscType.mfi =&gt; ta.mfi(source, length)
        OscType.cci =&gt; ta.cci(source, length)

// Plot the value of a `calcOscillator()` call with `oscInput` as the `selection`.
plot(calcOscillator(close, 20, oscInput))</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">selection</code> parameter of the <code dir="auto">calcOscillator()</code> function can
only take on one of <em>four</em> values: <code dir="auto">OscType.rsi</code>, <code dir="auto">OscType.mfi</code>,
<code dir="auto">OscType.cci</code>, or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</li>
<li>The “Oscillator type” input in the script’s
“Settings/Inputs” tab displays all <code dir="auto">OscType</code> field titles in
its dropdown. See
<a href="/pine-script-docs/v5/concepts/inputs/#enum-input">this section</a> to learn more about enum inputs.</li>
</ul>
<p>It’s crucial to note that each declared enum represents a <em>unique</em>
type. Scripts <strong>cannot</strong> compare members of different enums or use such
members in expressions requiring a specific
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>, even if the fields have identical names and titles.</p>
<p>In this example, we added an <code dir="auto">OscType2</code> enum to the above script and
changed the <code dir="auto">oscInput</code> variable to use a member of that enum. The script
now raises a <em>compilation error</em> because it can’t use a member of the
<code dir="auto">OscType2</code> enum as the <code dir="auto">selection</code> argument in the <code dir="auto">calcOscillator()</code>
call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Incompatible enums demo")

//@enum An enumeration of oscillator choices.
enum OscType
    rsi = "Relative Strength Index"
    mfi = "Money Flow Index"
    cci = "Commodity Channel Index"

//@enum An enumeration of oscillator choices. Its fields DO NOT represent the same values those in the `OscType` enum.
enum OscType2
    rsi = "Relative Strength Index"
    mfi = "Money Flow Index"
    cci = "Commodity Channel Index"

//@variable An enumerator (member) of the `OscType2` enum.
OscType2 oscInput = input.enum(OscType2.rsi, "Oscillator type")

//@function         Calculates one of three oscillators based on a specified `selection`.
//@param source     The series of values to process.
//@param length     The number of bars in the calculation.
//@param selection  Determines which oscillator to calculate.
calcOscillator(float source, simple int length, OscType selection) =&gt;
    result = switch selection
        OscType.rsi =&gt; ta.rsi(source, length)
        OscType.mfi =&gt; ta.mfi(source, length)
        OscType.cci =&gt; ta.cci(source, length)

// Plot the value of a `calcOscillator()` call with `oscInput` as the `selection`.
// Raises a compilation error because only members of `OscType` are allowed. 
plot(calcOscillator(close, 20, oscInput))</code></div>
<h3 class="md-heading" id="utilizing-field-titles"><a href="#utilizing-field-titles">Utilizing field titles<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The “string” titles of an enum’s fields allow programmers to add
extra information to each member. These field titles appear within a
dropdown in the script’s “Settings/Inputs” tab when calling the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
function.</p>
<p>Scripts can also utilize enum field titles in their calculations and
logic. Use the string conversion function
(<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>)
on an enum field to access its title.</p>
<p>The following example combines different enum field titles to construct
a ticker ID for requesting data from
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">another context</a>. The script declares two enums, <code dir="auto">Exchange</code> and <code dir="auto">Pair</code>, whose
respective fields represent <em>exchange</em> and <em>currency pair</em> names. It
uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
to assign user-specified enum members to the <code dir="auto">exchangeInput</code> and
<code dir="auto">pairInput</code> variables, then retrieves the “string” titles from those
variables with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
and concatenates them to form an “Exchange:Symbol” pair for use in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="620" loading="lazy" src="images/76a9eafd0ae1ef19024de40e99a65a1f.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Utilizing field titles demo")

//@enum An enumeration of cryptocurrency exchanges. All field titles are the same as the field names.
enum Exchange
    BINANCE
    BITSTAMP
    BITFINEX
    COINBASE
    KRAKEN

//@enum An enumeration of cryptocurrency pairs. All the field titles are the same as the field names. 
enum Pair
    BTCUSD
    ETHUSD
    SOLUSD
    XRPUSD

//@variable An enumerator (member) of the `Exchange` enum.
Exchange exchangeInput = input.enum(Exchange.BINANCE, "Exchange")
//@variable An enumerator (member) of the `Pair` enum.
Pair pairInput = input.enum(Pair.BTCUSD, "Pair")

//@variable The exchange-symbol pair for the data request. 
simple string symbol = str.tostring(exchangeInput) + ":" + str.tostring(pairInput)

// Plot the `close` value requested from the `symbol` context.
plot(request.security(symbol, timeframe.period, close), "Requested close", color.purple, 3)</code></div>
<p>Note that:</p>
<ul>
<li>None of the members of the <code dir="auto">Exchange</code> or <code dir="auto">Pair</code> enums have
specified titles. Therefore, each field’s title is the
“string” representation of its name, as shown by the script’s
<a href="/pine-script-docs/v5/concepts/inputs/#enum-input">enum inputs</a>.</li>
<li>Calling the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
function on an enum field is the <strong>only</strong> way to retrieve its
title for additional calculations. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
and <code dir="auto">log.*()</code> functions <em>cannot</em> accept enum members. To use a
field’s title in a string formatting function, call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
on the field first, then pass the resulting “string” to the
function.</li>
</ul>
<h2 class="md-heading" id="collecting-enum-members"><a href="#collecting-enum-members">Collecting enum members<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and <a href="/pine-script-docs/v5/language/maps/">maps</a>) can store enum members, allowing strict control over the values they can contain. To declare a collection of enum members, include the enum’s <em>name</em> in the collection’s <a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a>.</p>
<p>For example, this code block creates an empty
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
to hold members of the <code dir="auto">FooBar</code> enum. The only values this array can
allow as elements are <code dir="auto">FooBar.foo</code>, <code dir="auto">FooBar.bar</code>, <code dir="auto">FooBar.baz</code>, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable An enumeration of miscellaneous named members.
enum FooBar
    foo
    bar
    baz

//@variable An array that can only contain the following values: `FooBar.foo`, `FooBar.bar`, `FooBar.baz`, `na`.
array&lt;FooBar&gt; fooBarArray = array.new&lt;FooBar&gt;()</code></div>
<p>Enums are particularly helpful when working with
<a href="/pine-script-docs/v5/language/maps/">maps</a>, as unlike other
<em>non-fundamental</em> <a href="/pine-script-docs/v5/language/type-system/#types">types</a>, scripts can declare <a href="/pine-script-docs/v5/language/maps/">maps</a> with <em>keys</em> of an
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>, enabling strict control over all possible keys allowed in
their key-value pairs.</p>
<p>The following example uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
with enum keys and “int” values to track and count signal states
across chart bars. The script’s <code dir="auto">Signal</code> enum contains five fields
representing specific named states. The <code dir="auto">signalCounters</code>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
uses the <code dir="auto">Signal</code> name as the <em>first keyword</em> in its
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> to specify that it can only accept <code dir="auto">Signal</code> members as keys.</p>
<p>The script uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure to calculate a <code dir="auto">signalState</code> variable whose value is a member
of the <code dir="auto">Signal</code> enum, which it uses to determine the counter value to
update in the <code dir="auto">signalCounters</code> map. It constructs a “string” to
represent the key-value pairs of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
and displays the result in a single-cell
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
on the last chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="524" loading="lazy" src="images/5e5980862ab9eb9aaf5355f8fafc875f.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Collecting enum members demo", overlay = true)

//@enum An enumeration of named signal states. 
enum Signal
    strongBuy  = "Strong buy"
    buy        = "Buy"
    neutral    = "Neutral"
    sell       = "Sell"
    strongSell = "Strong sell"

//@variable The number of bars in the signal calculation.
int lengthInput = input.int(50, "Length", 2)

//@variable A map of `Signal.*` keys and "int" values counting the number of bars with each signal state. 
//          Allowed keys: `Signal.strongBuy`, `Signal.buy`, `Signal.neutral`, `Signal.sell`, `Signal.strongSell`, `na`.
var map&lt;Signal, float&gt; signalCounters = map.new&lt;Signal, float&gt;()

//@variable A single-cell table displaying the key-value pairs of the `signalCounters` map.
var table infoTable = table.new(position.top_right, 1, 1, chart.fg_color)

if barstate.isfirst
    // Put `Signal.*`-"int" pairs into the `signalCounters` map to establish insertion order.
    signalCounters.put(Signal.strongBuy, 0)
    signalCounters.put(Signal.buy, 0)
    signalCounters.put(Signal.neutral, 0)
    signalCounters.put(Signal.sell, 0)
    signalCounters.put(Signal.strongSell, 0)
    // Initialize the `infoTable` cell.
    infoTable.cell(0, 0, text_color = chart.bg_color, text_halign = text.align_left, text_size = size.large)

// Calculate the EMA and Percent rank of `source` data over `length` bars.
float ema  = ta.ema(close, lengthInput)
float rank = ta.percentrank(close, lengthInput)

//@variable A `Signal` member representing the current signal state based on `ema` and `rank` values. 
Signal signalState = switch
    close &gt; ema =&gt; rank &gt; 70 ? Signal.strongBuy  : rank &gt; 50 ? Signal.buy  : Signal.neutral
    close &lt; ema =&gt; rank &lt; 30 ? Signal.strongSell : rank &lt; 50 ? Signal.sell : Signal.neutral
    =&gt; Signal.neutral

// Add 1 to the value in the `signalCounters` map associated with the `signalState` key.
signalCounters.put(signalState, signalCounters.get(signalState) + 1)

// Update the `infoTable` cell's text using the keys and values from the `signalCounters` map on the last bar.
if barstate.islast
    string tableText = ""
    for [state, count] in signalCounters
        tableText += str.tostring(state) + ": " + str.tostring(count) + "\n"
    infoTable.cell_set_text(0, 0, str.trim(tableText))</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">signalCounters</code> map can contain up to <em>six</em> key-value
pairs, as the <code dir="auto">Signal</code> enum has <em>five</em> predefined values, plus a
possible value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
and <a href="/pine-script-docs/v5/language/maps/">maps</a> cannot
contain <em>repetitive</em> keys.</li>
<li>The script declares the <code dir="auto">signalCounters</code> variable using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword, signifying that the assigned
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
instance persists across executions.</li>
<li>On the first chart bar, the script uses five
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>
calls to establish the <em>insertion order</em> of keys in the
<code dir="auto">signalCounters</code> map. See
<a href="/pine-script-docs/v5/language/maps/#mapkeys-and-mapvalues">this section</a> of the <a href="/pine-script-docs/v5/language/maps/">Maps</a> page for more information.</li>
<li>To minimize <em>resource usage</em>, the script declares the
<code dir="auto">infoTable</code> and initializes its cell on the <em>first bar</em>, then
updates the cell’s text on the <em>latest bar</em>. See
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#reducing-drawing-updates">this section</a> of the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/">Profiling and optimization</a> page to learn more.</li>
</ul>
<h2 class="md-heading" id="shadowing"><a href="#shadowing">Shadowing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To avoid potential conflicts where namespaces added to Pine Script™ in
the future would conflict with the names of enums in existing scripts,
enum names can <em>shadow</em> some of Pine’s namespaces.</p>
<p>For example, one can declare an enum like the following, whose name
shadows the <code dir="auto">syminfo.*</code> namespace:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shadowing demo")

enum syminfo
    abcd

log.info(str.tostring(syminfo.abcd))</code></div>
<p>However, using such a name for an enum is only allowed if the enum’s
fields <strong>do not</strong> have names matching any of the namespace’s built-ins.
Otherwise, Pine will not be able to determine which value the script is
supposed to use, resulting in a compilation error:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Name conflict demo")

enum syminfo
    abcd
    tickerid // This matches the built-in `syminfo.tickerid` variable, causing a compilation error.

log.info(str.tostring(syminfo.tickerid))</code></div>
<p>Additionally, one cannot use any of Pine’s built-in
<a href="/pine-script-docs/v5/language/type-system/">type</a> names as the name of an
enum.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>While it is possible for some enum names to shadow language namespaces,
as shown above, we recommend choosing <strong>unique</strong> names for enums
wherever possible for more readable code that’s easier to maintain.</p></div></aside> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/objects"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Objects  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/methods"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Methods <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Methods</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-methods"><a href="#methods">Methods<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ methods are specialized functions associated with values of specific <a href="/pine-script-docs/v5/language/type-system/#types">built-in types</a>,
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>, or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a>.
They behave the same as regular functions in most regards while offering a shorter, more convenient syntax.
Users can access methods using <em>dot notation</em> syntax on variables of the associated type, similar to accessing the fields
of a Pine Script™ <a href="/pine-script-docs/v5/language/objects/">object</a>.</p>
<h2 class="md-heading" id="built-in-methods"><a href="#built-in-methods">Built-in methods<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ includes built-in methods for all <em>special types</em>,
including
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>.
These methods provide users with a more concise way to call specialized
routines for these types within their scripts.</p>
<p>When using these special types, the expressions:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;namespace&gt;.&lt;functionName&gt;([paramName =] &lt;objectName&gt;, …)</span></div></div></code></pre></figure></link></div>
<p>and:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;objectName&gt;.&lt;functionName&gt;(…)</span></div></div></code></pre></figure></div>
<p>are equivalent. For example, rather than using:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">array.get(id, index)</code></div>
<p>to get the value from an array <code dir="auto">id</code> at the specified <code dir="auto">index</code>, we can
simply use:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">id.get(index)</code></div>
<p>to achieve the same effect. This notation eliminates the need for users
to reference the function’s namespace, as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">get()</a>
is a method of <code dir="auto">id</code> in this context.</p>
<p>Written below is a practical example to demonstrate the usage of
built-in methods in place of functions.</p>
<p>The following script computes Bollinger Bands over a specified number of
prices sampled once every <code dir="auto">n</code> bars. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
to queue <code dir="auto">sourceInput</code> values through the <code dir="auto">sourceArray</code>, then
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">array.avg()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.stdev">array.stdev()</a>
to compute the <code dir="auto">sampleMean</code> and <code dir="auto">sampleDev</code>. The script then uses these
values to calculate the <code dir="auto">highBand</code> and <code dir="auto">lowBand</code>, which it plots on the
chart along with the <code dir="auto">sampleMean</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="844" loading="lazy" src="images/8ba354b4814f3f63c0f0e27c994a4b11.webp" width="1814"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Custom Sample BB", overlay = true)

float sourceInput  = input.source(close, "Source")
int   samplesInput = input.int(20, "Samples")
int   n            = input.int(10, "Bars")
float multiplier   = input.float(2.0, "StdDev")

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)
var float        sampleMean  = na
var float        sampleDev   = na

// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    array.push(sourceArray, sourceInput)
    array.shift(sourceArray)
    // Update the mean and standard deviaiton values.
    sampleMean := array.avg(sourceArray)
    sampleDev  := array.stdev(sourceArray) * multiplier

// Calculate bands.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev

plot(sampleMean, "Basis", color.orange)
plot(highBand, "Upper", color.lime)
plot(lowBand, "Lower", color.red)</code></div>
<p>Let’s rewrite this code to utilize methods rather than built-in
functions. In this version, we have replaced all built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array.*</a>
functions in the script with equivalent methods:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Custom Sample BB", overlay = true)

float sourceInput  = input.source(close, "Source")
int   samplesInput = input.int(20, "Samples")
int   n            = input.int(10, "Bars")
float multiplier   = input.float(2.0, "StdDev")

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)
var float        sampleMean  = na
var float        sampleDev   = na

// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.push(sourceInput)
    sourceArray.shift()
    // Update the mean and standard deviaiton values.
    sampleMean := sourceArray.avg()
    sampleDev  := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev

plot(sampleMean, "Basis", color.orange)
plot(highBand, "Upper", color.lime)
plot(lowBand, "Lower", color.red)</code></div>
<p>Note that:</p>
<ul>
<li>We call the array methods using <code dir="auto">sourceArray.*</code> rather than
referencing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
namespace.</li>
<li>We do not include <code dir="auto">sourceArray</code> as a parameter when we call the
methods since they already reference the object.</li>
</ul>
<h2 class="md-heading" id="user-defined-methods"><a href="#user-defined-methods">User-defined methods<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ allows users to define custom methods for use with objects
of any built-in or user-defined type. Defining a method is essentially
the same as defining a function, but with two key differences:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_method">method</a>
keyword must be included before the function name.</li>
<li>The type of the first parameter in the signature must be explicitly
declared, as it represents the type of object that the method will
be associated with.</li>
</ul>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[export] method &lt;functionName&gt;(&lt;paramType&gt; &lt;paramName&gt; [= &lt;defaultValue&gt;], …) =&gt;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">&lt;functionBlock&gt;</span></div></div></code></pre></figure></div>
<p>Let’s apply user-defined methods to our previous Bollinger Bands
example to encapsulate operations from the global scope, which will
simplify the code and promote reusability. See this portion from the
example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.push(sourceInput)
    sourceArray.shift()
    // Update the mean and standard deviaiton values.
    sampleMean := sourceArray.avg()
    sampleDev  := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev</code></div>
<p>We will start by defining a simple method to queue values through an
array in a single call.</p>
<p>This <code dir="auto">maintainQueue()</code> method invokes the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">push()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">shift()</a>
methods on a <code dir="auto">srcArray</code> when <code dir="auto">takeSample</code> is true and returns the
object:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function         Maintains a queue of the size of `srcArray`. 
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue. 
//                   The queue's oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray</code></div>
<p>Note that:</p>
<ul>
<li>Just as with user-defined functions, we use the <code dir="auto">@function</code>
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation</a> to document method descriptions.</li>
</ul>
<p>Now we can replace <code dir="auto">sourceArray.push()</code> and <code dir="auto">sourceArray.shift()</code> with
<code dir="auto">sourceArray.maintainQueue()</code> in our example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.maintainQueue(sourceInput)
    // Update the mean and standard deviaiton values.
    sampleMean  := sourceArray.avg()
    sampleDev   := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand  = sampleMean + sampleDev
float lowBand   = sampleMean - sampleDev</code></div>
<p>From here, we will further simplify our code by defining a method that
handles all Bollinger Band calculations within its scope.</p>
<p>This <code dir="auto">calcBB()</code> method invokes the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">avg()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.stdev">stdev()</a>
methods on a <code dir="auto">srcArray</code> to update <code dir="auto">mean</code> and <code dir="auto">dev</code> values when
<code dir="auto">calculate</code> is true. The method uses these values to return a tuple
containing the basis, upper band, and lower band values respectively:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function         Computes Bollinger Band values from an array of data.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param multiplier (float) Standard deviaiton multiplier.
// @param calcuate   (bool) The method will only calculate new values when this is true.
// @returns          A tuple containing the basis, upper band, and lower band respectively.
method calcBB(array&lt;float&gt; srcArray, float mult, bool calculate = true) =&gt;
    var float mean = na
    var float dev  = na
    if calculate
        // Compute the mean and standard deviation of the array.
        mean := srcArray.avg()
        dev  := srcArray.stdev() * mult
    [mean, mean + dev, mean - dev]</code></div>
<p>With this method, we can now remove Bollinger Band calculations from the
global scope and improve code readability:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Identify if `n` bars have passed.
bool newSample = bar_index % n == 0

// Update the queue and compute new BB values on each new sample.
[sampleMean, highBand, lowBand] = sourceArray.maintainQueue(sourceInput, newSample).calcBB(multiplier, newSample)</code></div>
<p>Note that:</p>
<ul>
<li>Rather than using an <code dir="auto">if</code> block in the global scope, we have
defined a <code dir="auto">newSample</code> variable that is only true once every <code dir="auto">n</code>
bars. The <code dir="auto">maintainQueue()</code> and <code dir="auto">calcBB()</code> methods use this
value for their respective <code dir="auto">takeSample</code> and <code dir="auto">calculate</code>
parameters.</li>
<li>Since the <code dir="auto">maintainQueue()</code> method returns the object that it
references, we’re able to call <code dir="auto">calcBB()</code> from the same line of
code, as both methods apply to <code dir="auto">array&lt;float&gt;</code> instances.</li>
</ul>
<p>Here is how the full script example looks now that we’ve applied our
user-defined methods:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Custom Sample BB", overlay = true)

float sourceInput  = input.source(close, "Source")
int   samplesInput = input.int(20, "Samples")
int   n            = input.int(10, "Bars")
float multiplier   = input.float(2.0, "StdDev")

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)

// @function         Maintains a queue of the size of `srcArray`. 
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue. 
//                   The queue's oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray

// @function         Computes Bollinger Band values from an array of data.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param multiplier (float) Standard deviaiton multiplier.
// @param calcuate   (bool) The method will only calculate new values when this is true.
// @returns          A tuple containing the basis, upper band, and lower band respectively.
method calcBB(array&lt;float&gt; srcArray, float mult, bool calculate = true) =&gt;
    var float mean = na
    var float dev  = na
    if calculate
        // Compute the mean and standard deviation of the array.
        mean := srcArray.avg()
        dev  := srcArray.stdev() * mult
    [mean, mean + dev, mean - dev]

// Identify if `n` bars have passed.
bool newSample = bar_index % n == 0

// Update the queue and compute new BB values on each new sample.
[sampleMean, highBand, lowBand] = sourceArray.maintainQueue(sourceInput, newSample).calcBB(multiplier, newSample)

plot(sampleMean, "Basis", color.orange)
plot(highBand, "Upper", color.lime)
plot(lowBand, "Lower", color.red)</code></div>
<h2 class="md-heading" id="method-overloading"><a href="#method-overloading">Method overloading<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>User-defined methods can override and overload existing built-in and
user-defined methods with the same identifier. This capability allows
users to define multiple routines associated with different parameter
signatures under the same method name.</p>
<p>As a simple example, suppose we want to define a method to identify a
variable’s type. Since we must explicitly specify the type of object
associated with a user-defined method, we will need to define overloads
for each type that we want it to recognize.</p>
<p>Below, we have defined a <code dir="auto">getType()</code> method that returns a string
representation of a variable’s type with overloads for the five
primitive types:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function   Identifies an object's type.
// @param this Object to inspect.
// @returns    (string) A string representation of the type.
method getType(int this) =&gt;
    na(this) ? "int(na)" : "int"

method getType(float this) =&gt;
    na(this) ? "float(na)" : "float"

method getType(bool this) =&gt;
    na(this) ? "bool(na)" : "bool"

method getType(color this) =&gt;
    na(this) ? "color(na)" : "color"

method getType(string this) =&gt;
    na(this) ? "string(na)" : "string"</code></div>
<p>Now we can use these overloads to inspect some variables. This script
uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
to format the results from calling the <code dir="auto">getType()</code> method on five
different variables into a single <code dir="auto">results</code> string, then displays the
string in the <code dir="auto">lbl</code> label using the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.set_text">set_text()</a>
method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="328" loading="lazy" src="images/181232f359d6b7399c78cf326b4e0dc0.webp" width="1210"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Type Inspection")

// @function   Identifies an object's type.
// @param this Object to inspect.
// @returns    (string) A string representation of the type.
method getType(int this) =&gt;
    na(this) ? "int(na)" : "int"

method getType(float this) =&gt;
    na(this) ? "float(na)" : "float"

method getType(bool this) =&gt;
    na(this) ? "bool(na)" : "bool"

method getType(color this) =&gt;
    na(this) ? "color(na)" : "color"

method getType(string this) =&gt;
    na(this) ? "string(na)" : "string"

a = 1
b = 1.0
c = true
d = color.white
e = "1"

// Inspect variables and format results.
results = str.format(
 "a: {0}\nb: {1}\nc: {2}\nd: {3}\ne: {4}", 
 a.getType(), b.getType(), c.getType(), d.getType(), e.getType()
 )

var label lbl = label.new(0, 0)
lbl.set_x(bar_index)
lbl.set_text(results)</code></div>
<p>Note that:</p>
<ul>
<li>The underlying type of each variable determines which overload
of <code dir="auto">getType()</code> the compiler will use.</li>
<li>The method will append “(na)” to the output string when a
variable is <code dir="auto">na</code> to demarcate that it is empty.</li>
</ul>
<h2 class="md-heading" id="advanced-example"><a href="#advanced-example">Advanced example<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Let’s apply what we’ve learned to construct a script that estimates
the cumulative distribution of elements in an array, meaning the
fraction of elements in the array that are less than or equal to any
given value.</p>
<p>There are many ways in which we could choose to tackle this objective.
For this example, we will start by defining a method to replace elements
of an array, which will help us count the occurrences of elements within
a range of values.</p>
<p>Written below is an overload of the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.fill">fill()</a>
method for <code dir="auto">array&lt;float&gt;</code> instances. This overload replaces elements in
a <code dir="auto">srcArray</code> within the range between the <code dir="auto">lowerBound</code> and <code dir="auto">upperBound</code>
with an <code dir="auto">innerValue</code>, and replaces all elements outside the range with
an <code dir="auto">outerValue</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function          Replaces elements in a `srcArray` between `lowerBound` and `upperBound` with an `innerValue`,
//                    and replaces elements outside the range with an `outerValue`.
// @param srcArray    (array&lt;float&gt;) Array to modify.
// @param innerValue  (float) Value to replace elements within the range with.
// @param outerValue  (float) Value to replace elements outside the range with.
// @param lowerBound  (float) Lowest value to replace with `innerValue`.
// @param upperBound  (float) Highest value to replace with `innerValue`.
// @returns           (array&lt;float&gt;) `srcArray` object.
method fill(array&lt;float&gt; srcArray, float innerValue, float outerValue, float lowerBound, float upperBound) =&gt;
    for [i, element] in srcArray
        if (element &gt;= lowerBound or na(lowerBound)) and (element &lt;= upperBound or na(upperBound))
            srcArray.set(i, innerValue)
        else
            srcArray.set(i, outerValue)
    srcArray</code></div>
<p>With this method, we can filter an array by value ranges to produce an
array of occurrences. For example, the expression:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">srcArray.copy().fill(1.0, 0.0, min, val)</code></div>
<p>copies the <code dir="auto">srcArray</code> object, replaces all elements between <code dir="auto">min</code> and
<code dir="auto">val</code> with 1.0, then replaces all elements above <code dir="auto">val</code> with 0.0. From
here, it’s easy to estimate the output of the cumulative distribution
function at the <code dir="auto">val</code>, as it’s simply the average of the resulting
array:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">srcArray.copy().fill(1.0, 0.0, min, val).avg()</code></div>
<p>Note that:</p>
<ul>
<li>The compiler will only use this <code dir="auto">fill()</code> overload instead of the
built-in when the user provides <code dir="auto">innerValue</code>, <code dir="auto">outerValue</code>,
<code dir="auto">lowerBound</code>, and <code dir="auto">upperBound</code> arguments in the call.</li>
<li>If either <code dir="auto">lowerBound</code> or <code dir="auto">upperBound</code> is <code dir="auto">na</code>, its value is
ignored while filtering the fill range.</li>
<li>We are able to call <code dir="auto">copy()</code>, <code dir="auto">fill()</code>, and <code dir="auto">avg()</code> successively
on the same line of code because the first two methods return an
<code dir="auto">array&lt;float&gt;</code> instance.</li>
</ul>
<p>We can now use this to define a method that will calculate our empirical
distribution values. The following <code dir="auto">eCDF()</code> method estimates a number of
evenly spaced ascending <code dir="auto">steps</code> from the cumulative distribution
function of a <code dir="auto">srcArray</code> and pushes the results into a <code dir="auto">cdfArray</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function       Estimates the empirical CDF of a `srcArray`.
// @param srcArray (array&lt;float&gt;) Array to calculate on.
// @param steps    (int) Number of steps in the estimation.
// @returns        (array&lt;float&gt;) Array of estimated CDF ratios.
method eCDF(array&lt;float&gt; srcArray, int steps) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range() / steps
    array&lt;float&gt; cdfArray = array.new&lt;float&gt;()
    // Add averages of `srcArray` filtered by value region to the `cdfArray`.
    float val = min
    for i = 1 to steps
        val += rng
        cdfArray.push(srcArray.copy().fill(1.0, 0.0, min, val).avg())
    cdfArray</code></div>
<p>Lastly, to ensure that our <code dir="auto">eCDF()</code> method functions properly for arrays
containing small and large values, we will define a method to normalize
our arrays.</p>
<p>This <code dir="auto">featureScale()</code> method uses array
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">min()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.range">range()</a>
methods to produce a rescaled copy of a <code dir="auto">srcArray</code>. We will use this to
normalize our arrays prior to invoking the <code dir="auto">eCDF()</code> method:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @function        Rescales the elements within a `srcArray` to the interval [0, 1].
// @param srcArray  (array&lt;float&gt;) Array to normalize.
// @returns         (array&lt;float&gt;) Normalized copy of the `srcArray`.
method featureScale(array&lt;float&gt; srcArray) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range()
    array&lt;float&gt; scaledArray = array.new&lt;float&gt;()
    // Push normalized `element` values into the `scaledArray`.
    for element in srcArray
        scaledArray.push((element - min) / rng)
    scaledArray</code></div>
<p>Note that:</p>
<ul>
<li>This method does not include special handling for divide by zero
conditions. If <code dir="auto">rng</code> is 0, the value of the array element will
be <code dir="auto">na</code>.</li>
</ul>
<p>The full example below queues a <code dir="auto">sourceArray</code> of size <code dir="auto">length</code> with
<code dir="auto">sourceInput</code> values using our previous <code dir="auto">maintainQueue()</code> method,
normalizes the array’s elements using the <code dir="auto">featureScale()</code> method, then
calls the <code dir="auto">eCDF()</code> method to get an array of estimates for <code dir="auto">n</code> evenly
spaced steps on the distribution. The script then calls a user-defined
<code dir="auto">makeLabel()</code> function to display the estimates and prices in a label on
the right side of the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="844" loading="lazy" src="images/d82fd993a714341d8432bc5f68620f78.webp" width="1814"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Empirical Distribution", overlay = true)

float sourceInput = input.source(close, "Source")
int length        = input.int(20, "Length")
int n             = input.int(20, "Steps")

// @function         Maintains a queue of the size of `srcArray`. 
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue. 
//                   The queue's oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray

// @function          Replaces elements in a `srcArray` between `lowerBound` and `upperBound` with an `innerValue`,
//                    and replaces elements outside the range with an `outerValue`.
// @param srcArray    (array&lt;float&gt;) Array to modify.
// @param innerValue  (float) Value to replace elements within the range with.
// @param outerValue  (float) Value to replace elements outside the range with.
// @param lowerBound  (float) Lowest value to replace with `innerValue`.
// @param upperBound  (float) Highest value to replace with `innerValue`.
// @returns           (array&lt;float&gt;) `srcArray` object.
method fill(array&lt;float&gt; srcArray, float innerValue, float outerValue, float lowerBound, float upperBound) =&gt;
    for [i, element] in srcArray
        if (element &gt;= lowerBound or na(lowerBound)) and (element &lt;= upperBound or na(upperBound))
            srcArray.set(i, innerValue)
        else
            srcArray.set(i, outerValue)
    srcArray

// @function       Estimates the empirical CDF of a `srcArray`.
// @param srcArray (array&lt;float&gt;) Array to calculate on.
// @param steps    (int) Number of steps in the estimation.
// @returns        (array&lt;float&gt;) Array of estimated CDF ratios.
method eCDF(array&lt;float&gt; srcArray, int steps) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range() / steps
    array&lt;float&gt; cdfArray = array.new&lt;float&gt;()
    // Add averages of `srcArray` filtered by value region to the `cdfArray`.
    float val = min
    for i = 1 to steps
        val += rng
        cdfArray.push(srcArray.copy().fill(1.0, 0.0, min, val).avg())
    cdfArray

// @function        Rescales the elements within a `srcArray` to the interval [0, 1].
// @param srcArray  (array&lt;float&gt;) Array to normalize.
// @returns         (array&lt;float&gt;) Normalized copy of the `srcArray`.
method featureScale(array&lt;float&gt; srcArray) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range()
    array&lt;float&gt; scaledArray = array.new&lt;float&gt;()
    // Push normalized `element` values into the `scaledArray`.
    for element in srcArray
        scaledArray.push((element - min) / rng)
    scaledArray

// @function        Draws a label containing eCDF estimates in the format "{price}: {percent}%" 
// @param srcArray  (array&lt;float&gt;) Array of source values.
// @param cdfArray  (array&lt;float&gt;) Array of CDF estimates.
// @returns         (void)
makeLabel(array&lt;float&gt; srcArray, array&lt;float&gt; cdfArray) =&gt;
    float max      = srcArray.max()
    float rng      = srcArray.range() / cdfArray.size()
    string results = ""
    var label lbl  = label.new(0, 0, "", style = label.style_label_left, text_font_family = font.family_monospace)
    // Add percentage strings to `results` starting from the `max`.
    cdfArray.reverse()
    for [i, element] in cdfArray
        results += str.format("{0}: {1}%\n", max - i * rng, element * 100)
    // Update `lbl` attributes.
    lbl.set_xy(bar_index + 1, srcArray.avg())
    lbl.set_text(results)

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(length)

// Add background color for the last `length` bars.
bgcolor(bar_index &gt; last_bar_index - length ? color.new(color.orange, 80) : na)

// Queue `sourceArray`, feature scale, then estimate the distribution over `n` steps.
array&lt;float&gt; distArray = sourceArray.maintainQueue(sourceInput).featureScale().eCDF(n)
// Draw label.
makeLabel(sourceArray, distArray)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/enums"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Enums  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/arrays"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Arrays <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Arrays</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-arrays"><a href="#arrays">Arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ Arrays are one-dimensional collections that can hold
multiple value references. Think of them as a better way to handle cases
where one would otherwise need to explicitly declare a set of similar
variables (e.g., <code dir="auto">price00</code>, <code dir="auto">price01</code>, <code dir="auto">price02</code>, …).</p>
<p>All elements in an array must be of the same <a href="/pine-script-docs/v5/language/type-system/#types">built-in type</a>, <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a>, or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>.</p>
<p>Scripts reference arrays using array IDs similar to the IDs of <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>, and other <em>special types</em>. Pine Script™ does not use an indexing operator to reference individual array elements.
Instead, functions including <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set">array.set()</a> read and write the values of array elements.</p>
<p>Scripts reference the elements of an array using an <em>index</em>, which
starts at 0 and extends to the number of elements in the array minus
one. Arrays in Pine Script™ can have a dynamic size that varies across
bars, as one can change the number of elements in an array on each
iteration of a script. Scripts can contain multiple array instances. The
size of arrays is limited to 100,000 elements.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>We will use <em>beginning</em> of an array to designate index 0, and <em>end</em> of
an array to designate the array’s element with the highest index value.
We will also extend the meaning of <em>array</em> to include array IDs, for the
sake of brevity.</p></div></aside>
<h2 class="md-heading" id="declaring-arrays"><a href="#declaring-arrays">Declaring arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ uses the following syntax to declare arrays:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var/varip ][array&lt;type&gt;/&lt;type[]&gt; ]&lt;identifier&gt; = &lt;expression&gt;</span></div></div></code></pre></figure></link></div>
<p>Where <code dir="auto">&lt;type&gt;</code> is a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> for the array that declares the type of values it will
contain, and the <code dir="auto">&lt;expression&gt;</code> returns either an array of the specified
type or <code dir="auto">na</code>.</p>
<p>When declaring a variable as an array, we can use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
keyword followed by a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a>. Alternatively, we can use the <code dir="auto">type</code> name followed by the
<code dir="auto">[]</code> modifier (not to be confused with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
<em>history-referencing operator</em>).</p>
<p>Since Pine always uses type-specific functions to create arrays, the
<code dir="auto">array&lt;type&gt;/type[]</code> part of the declaration is redundant, except when
declaring an array variable assigned to <code dir="auto">na</code>. Even when not required,
explicitly declaring the array type helps clearly state the intention to
readers.</p>
<p>This line of code declares an array variable named <code dir="auto">prices</code> that points
to <code dir="auto">na</code>. In this case, we must specify the type to declare that the
variable can reference arrays containing “float” values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">array&lt;float&gt; prices = na</code></div>
<p>We can also write the above example in this form:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float[] prices = na</code></div>
<p>When declaring an array and the <code dir="auto">&lt;expression&gt;</code> is not <code dir="auto">na</code>, use one of
the following functions: <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;type&gt;(size, initial_value)</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from()</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.copy">array.copy()</a>.
For <code dir="auto">array.new&lt;type&gt;(size, initial_value)</code> functions, the arguments of
the <code dir="auto">size</code> and <code dir="auto">initial_value</code> parameters can be “series” to allow
dynamic sizing and initialization of array elements. The following
example creates an array containing zero “float” elements, and this
time, the array ID returned by the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;float&gt;()</a>
function call is assigned to <code dir="auto">prices</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">prices = array.new&lt;float&gt;(0)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The <code dir="auto">array.*</code> namespace also contains type-specific functions for
creating arrays, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_int">array.new_int()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_float">array.new_float()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_bool">array.new_bool()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_color">array.new_color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_string">array.new_string()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_line">array.new_line()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_linefill">array.new_linefill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_label">array.new_label()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_box">array.new_box()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new_table">array.new_table()</a>.
The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;type&gt;()</a>
function can create an array of any type, including
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>.</p></div></aside>
<p>The <code dir="auto">initial_value</code> parameter of <code dir="auto">array.new*</code> functions allows users to
set all elements in the array to a specified value. If no argument is
provided for <code dir="auto">initial_value</code>, the array is filled with <code dir="auto">na</code> values.</p>
<p>This line declares an array ID named <code dir="auto">prices</code> pointing to an array
containing two elements, each assigned to the bar’s <code dir="auto">close</code> value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">prices = array.new&lt;float&gt;(2, close)</code></div>
<p>To create an array and initialize its elements with different values,
use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from()</a>.
This function infers the array’s size and the type of elements it will
hold from the arguments in the function call. As with <code dir="auto">array.new*</code>
functions, it accepts “series” arguments. All values supplied to the
function must be of the same type.</p>
<p>For example, all three of these lines of code will create identical
“bool” arrays with the same two elements:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">statesArray = array.from(close &gt; open, high != close)
bool[] statesArray = array.from(close &gt; open, high != close)
array&lt;bool&gt; statesArray = array.from(close &gt; open, high != close)</code></div>
<h3 class="md-heading" id="using-var-and-varip-keywords"><a href="#using-var-and-varip-keywords">Using `var` and `varip` keywords<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users can utilize
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keywords to instruct a script to declare an array variable only once on
the first iteration of the script on the first chart bar. Array
variables declared using these keywords point to the same array
instances until explicitly reassigned, allowing an array and its element
references to persist across bars.</p>
<p>When declaring an array variable using these keywords and pushing a new
value to the end of the referenced array on each bar, the array will
grow by one on each bar and be of size <code dir="auto">bar_index + 1</code>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
starts at zero) by the time the script executes on the last bar, as this
code demonstrates:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Using `var`")
//@variable An array that expands its size by 1 on each bar.
var a = array.new&lt;float&gt;(0)
array.push(a, close)

if barstate.islast
    //@variable A string containing the size of `a` and the current `bar_index` value.
    string labelText = "Array size: " + str.tostring(a.size()) + "\nbar_index: " + str.tostring(bar_index)
    // Display the `labelText`.
    label.new(bar_index, 0, labelText, size = size.large)</code></div>
<p>The same code without the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword would re-declare the array on each bar. In this case, after
execution of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
call, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">a.size()</a>
call would return a value of 1.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Array variables declared using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
behave as ones using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> on
historical data, but they update their values for realtime bars (i.e.,
the bars since the script’s last compilation) on each new price tick.
Arrays assigned to
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
variables can only hold
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_bool">bool</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_color">color</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
types or
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> that exclusively contain within their fields these types or
collections (arrays, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>) of
these types.</p></div></aside>
<h2 class="md-heading" id="reading-and-writing-array-elements"><a href="#reading-and-writing-array-elements">Reading and writing array elements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts can write values to existing individual array elements using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set">array.set(id, index,
value)</a>,
and read using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get(id,
index)</a>.
When using these functions, it is imperative that the <code dir="auto">index</code> in the
function call is always less than or equal to the array’s size (because
array indices start at zero). To get the size of an array, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size(id)</a>
function.</p>
<p>The following example uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set">set()</a>
method to populate a <code dir="auto">fillColors</code> array with instances of one base color
using different transparency levels. It then uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a>
to retrieve one of the colors from the array based on the location of
the bar with the highest price within the last <code dir="auto">lookbackInput</code> bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/e11f38f0a0ad3ff0d993b84766d4004e.webp" width="1542"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Distance from high", "", true)
lookbackInput = input.int(100)
FILL_COLOR = color.green
// Declare array and set its values on the first bar only.
var fillColors = array.new&lt;color&gt;(5)
if barstate.isfirst
    // Initialize the array elements with progressively lighter shades of the fill color.
    fillColors.set(0, color.new(FILL_COLOR, 70))
    fillColors.set(1, color.new(FILL_COLOR, 75))
    fillColors.set(2, color.new(FILL_COLOR, 80))
    fillColors.set(3, color.new(FILL_COLOR, 85))
    fillColors.set(4, color.new(FILL_COLOR, 90))

// Find the offset to highest high. Change its sign because the function returns a negative value.
lastHiBar = - ta.highestbars(high, lookbackInput)
// Convert the offset to an array index, capping it to 4 to avoid a runtime error.
// The index used by `array.get()` will be the equivalent of `floor(fillNo)`.
fillNo = math.min(lastHiBar / (lookbackInput / 5), 4)
// Set background to a progressively lighter fill with increasing distance from location of highest high.
bgcolor(array.get(fillColors, fillNo))
// Plot key values to the Data Window for debugging.
plotchar(lastHiBar, "lastHiBar", "", location.top, size = size.tiny)
plotchar(fillNo, "fillNo", "", location.top, size = size.tiny)</code></div>
<p>Another technique for initializing the elements in an array is to create
an <em>empty array</em> (an array with no elements), then use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
to append <strong>new</strong> elements to the end of the array, increasing the size
of the array by one on each call. The following code is functionally
identical to the initialization section from the preceding script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Declare array and set its values on the first bar only.
var fillColors = array.new&lt;color&gt;(0)
if barstate.isfirst
    // Initialize the array elements with progressively lighter shades of the fill color.
    array.push(fillColors, color.new(FILL_COLOR, 70))
    array.push(fillColors, color.new(FILL_COLOR, 75))
    array.push(fillColors, color.new(FILL_COLOR, 80))
    array.push(fillColors, color.new(FILL_COLOR, 85))
    array.push(fillColors, color.new(FILL_COLOR, 90))</code></div>
<p>This code is equivalent to the one above, but it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.unshift">array.unshift()</a>
to insert new elements at the <em>beginning</em> of the <code dir="auto">fillColors</code> array:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Declare array and set its values on the first bar only.
var fillColors = array.new&lt;color&gt;(0)
if barstate.isfirst
    // Initialize the array elements with progressively lighter shades of the fill color.
    array.unshift(fillColors, color.new(FILL_COLOR, 90))
    array.unshift(fillColors, color.new(FILL_COLOR, 85))
    array.unshift(fillColors, color.new(FILL_COLOR, 80))
    array.unshift(fillColors, color.new(FILL_COLOR, 75))
    array.unshift(fillColors, color.new(FILL_COLOR, 70))</code></div>
<p>We can also use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from()</a>
to create the same <code dir="auto">fillColors</code> array with a single function call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Using `var`")
FILL_COLOR = color.green
var array&lt;color&gt; fillColors = array.from(
     color.new(FILL_COLOR, 70),
     color.new(FILL_COLOR, 75),
     color.new(FILL_COLOR, 80),
     color.new(FILL_COLOR, 85),
     color.new(FILL_COLOR, 90)
 )
// Cycle background through the array's colors.
bgcolor(array.get(fillColors, bar_index % (fillColors.size())))</code></div>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.fill">array.fill(id, value, index_from,
index_to)</a>
function points all array elements, or the elements within the
<code dir="auto">index_from</code> to <code dir="auto">index_to</code> range, to a specified <code dir="auto">value</code>. Without the
last two optional parameters, the function fills the whole array, so:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = array.new&lt;float&gt;(10, close)</code></div>
<p>and:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = array.new&lt;float&gt;(10)
a.fill(close)</code></div>
<p>are equivalent, but:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = array.new&lt;float&gt;(10)
a.fill(close, 1, 3)</code></div>
<p>only fills the second and third elements (at index 1 and 2) of the array
with <code dir="auto">close</code>. Note how
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.fill">array.fill()</a>‘s
last parameter, <code dir="auto">index_to</code>, must be one greater than the last index the
function will fill. The remaining elements will hold <code dir="auto">na</code> values, as the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new()</a>
function call does not contain an <code dir="auto">initial_value</code> argument.</p>
<h2 class="md-heading" id="looping-through-array-elements"><a href="#looping-through-array-elements">Looping through array elements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When looping through an array’s element indices and the array’s size
is unknown, one can use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a>
function to get the maximum index value. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Protected `for` loop", overlay = true)
//@variable An array of `close` prices from the 1-minute timeframe.
array&lt;float&gt; a = request.security_lower_tf(syminfo.tickerid, "1", close)

//@variable A string representation of the elements in `a`.
string labelText = ""
for i = 0 to (array.size(a) == 0 ? na : array.size(a) - 1)
    labelText += str.tostring(array.get(a, i)) + "\n"

label.new(bar_index, high, text = labelText)</code></div>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function which returns an array of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices at the <code dir="auto">1 minute</code> timeframe.</li>
<li>This code example will throw an error if you use it on a chart
timeframe smaller than <code dir="auto">1 minute</code>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loops do not execute if the <code dir="auto">to</code> expression is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.
Note that the <code dir="auto">to</code> value is only evaluated once upon entry.</li>
</ul>
<p>An alternative method to loop through an array is to use a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop. This approach is a variation of the standard for loop that can
iterate over the value references and indices in an array. Here is an
example of how we can write the code example from above using a
<code dir="auto">for...in</code> loop:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`for...in` loop", overlay = true)
//@variable An array of `close` prices from the 1-minute timeframe.
array&lt;float&gt; a = request.security_lower_tf(syminfo.tickerid, "1", close)

//@variable A string representation of the elements in `a`.
string labelText = ""
for price in a
    labelText += str.tostring(price) + "\n"

label.new(bar_index, high, text = labelText)</code></div>
<p>Note that:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loops can return a tuple containing each index and corresponding
element. For example, <code dir="auto">for [i, price] in a</code> returns the <code dir="auto">i</code>
index and <code dir="auto">price</code> value for each element in <code dir="auto">a</code>.</li>
</ul>
<p>A
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
loop statement can also be used:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`while` loop", overlay = true)
array&lt;float&gt; a = request.security_lower_tf(syminfo.tickerid, "1", close)

string labelText = ""
int i = 0
while i &lt; array.size(a)
    labelText += str.tostring(array.get(a, i)) + "\n"
    i += 1

label.new(bar_index, high, text = labelText)</code></div>
<h2 class="md-heading" id="scope"><a href="#scope">Scope<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Users can declare arrays within the global scope of a script, as well as
the local scopes of
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a>,
<a href="/pine-script-docs/v5/language/methods/">methods</a>, and
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>. Unlike some of the other built-in types, namely
<em>fundamental</em> types, scripts can modify globally-assigned arrays from
within local scopes, allowing users to implement global variables that
any function in the script can directly interact with. We use the
functionality here to calculate progressively lower or higher price
levels:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/a481243dda5b1896a76661615a60a59e.webp" width="1600"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Bands", "", true)
//@variable The distance ratio between plotted price levels.
factorInput = 1 + (input.float(-2., "Step %") / 100)
//@variable A single-value array holding the lowest `ohlc4` value within a 50 bar window from 10 bars back.
level = array.new&lt;float&gt;(1, ta.lowest(ohlc4, 50)[10])

nextLevel(val) =&gt;
    newLevel = level.get(0) * val
    // Write new level to the global `level` array so we can use it as the base in the next function call.
    level.set(0, newLevel)
    newLevel

plot(nextLevel(1))
plot(nextLevel(factorInput))
plot(nextLevel(factorInput))
plot(nextLevel(factorInput))</code></div>
<h2 class="md-heading" id="history-referencing"><a href="#history-referencing">History referencing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™‘s history-referencing operator <a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[
]</a> can
access the history of array variables, allowing scripts to interact with
past array instances previously assigned to a variable.</p>
<p>To illustrate this, let’s create a simple example to show how one can
fetch the previous bar’s <code dir="auto">close</code> value in two equivalent ways. This
script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[
]</a>
operator to get the array instance assigned to <code dir="auto">a</code> on the previous bar,
then uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">get()</a>
method to retrieve the value of the first element (<code dir="auto">previousClose1</code>).
For <code dir="auto">previousClose2</code>, we use the history-referencing operator on the
<code dir="auto">close</code> variable directly to retrieve the value. As we see from the
plots, <code dir="auto">previousClose1</code> and <code dir="auto">previousClose2</code> both return the same value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="314" loading="lazy" src="images/34fc28159ad86e6aaacd3002d610f2ba.webp" width="1728"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("History referencing")

//@variable A single-value array declared on each bar.
a = array.new&lt;float&gt;(1)
// Set the value of the only element in `a` to `close`.
array.set(a, 0, close)

//@variable The array instance assigned to `a` on the previous bar.
previous = a[1]

previousClose1 = na(previous) ? na : previous.get(0)
previousClose2 = close[1]

plot(previousClose1, "previousClose1", color.gray, 6)
plot(previousClose2, "previousClose2", color.white, 2)</code></div>
<h2 class="md-heading" id="inserting-and-removing-array-elements"><a href="#inserting-and-removing-array-elements">Inserting and removing array elements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="inserting"><a href="#inserting">Inserting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The following three functions can insert new elements into an array.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.unshift">array.unshift()</a>
inserts a new element at the beginning of an array (index 0) and
increases the index values of any existing elements by one.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.insert">array.insert()</a>
inserts a new element at the specified <code dir="auto">index</code> and increases the index
of existing elements at or after the <code dir="auto">index</code> by one.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="182" loading="lazy" src="images/a01aa6739e7d62125aa07e78971ecc8d.webp" width="1020"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.insert()`")
a = array.new&lt;float&gt;(5, 0)
for i = 0 to 4
    array.set(a, i, i + 1)
if barstate.islast
    label.new(bar_index, 0, "BEFORE\na: " + str.tostring(a), size = size.large)
    array.insert(a, 2, 999)    
    label.new(bar_index, 0, "AFTER\na: " + str.tostring(a), style = label.style_label_up, size = size.large)</code></div>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
adds a new element at the end of an array.</p>
<h3 class="md-heading" id="removing"><a href="#removing">Removing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>These four functions remove elements from an array. The first three also
return the value of the removed element.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.remove">array.remove()</a>
removes the element at the specified <code dir="auto">index</code> and returns that element’s
value.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
removes the first element from an array and returns its value.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.pop">array.pop()</a>
removes the last element of an array and returns its value.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.clear">array.clear()</a>
removes all elements from an array. Note that clearing an array won’t
delete any objects its elements referenced. See the example below that
illustrates how this works:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.clear()` example", overlay = true)

// Create a label array and add a label to the array on each new bar.
var a = array.new&lt;label&gt;()
label lbl = label.new(bar_index, high, "Text", color = color.red)
array.push(a, lbl)

var table t = table.new(position.top_right, 1, 1)
// Clear the array on the last bar. This doesn't remove the labels from the chart. 
if barstate.islast
    array.clear(a)
    table.cell(t, 0, 0, "Array elements count: " + str.tostring(array.size(a)), bgcolor = color.yellow)</code></div>
<h3 class="md-heading" id="using-an-array-as-a-stack"><a href="#using-an-array-as-a-stack">Using an array as a stack<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Stacks are LIFO (last in, first out) constructions. They behave somewhat
like a vertical pile of books to which books can only be added or
removed one at a time, always from the top. Pine Script™ arrays can be
used as a stack, in which case we use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.pop">array.pop()</a>
functions to add and remove elements at the end of the array.</p>
<p><code dir="auto">array.push(prices, close)</code> will add a new element to the end of the
<code dir="auto">prices</code> array, increasing the array’s size by one.</p>
<p><code dir="auto">array.pop(prices)</code> will remove the end element from the <code dir="auto">prices</code> array,
return its value and decrease the array’s size by one.</p>
<p>See how the functions are used here to track successive lows in rallies:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="568" loading="lazy" src="images/34e0449d3823267a13d1a8e2fcf6c357.webp" width="1600"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Lows from new highs", "", true)
var lows = array.new&lt;float&gt;(0)
flushLows = false

// Remove last element from the stack when `_cond` is true.
array_pop(id, cond) =&gt; cond and array.size(id) &gt; 0 ? array.pop(id) : float(na)

if ta.rising(high, 1)
    // Rising highs; push a new low on the stack.
    lows.push(low)
    // Force the return type of this `if` block to be the same as that of the next block.
    bool(na)
else if lows.size() &gt;= 4 or low &lt; array.min(lows)
    // We have at least 4 lows or price has breached the lowest low;
    // sort lows and set flag indicating we will plot and flush the levels.
    array.sort(lows, order.ascending)
    flushLows := true

// If needed, plot and flush lows.
lowLevel = array_pop(lows, flushLows)
plot(lowLevel, "Low 1", low &gt; lowLevel ? color.silver : color.purple, 2, plot.style_linebr)
lowLevel := array_pop(lows, flushLows)
plot(lowLevel, "Low 2", low &gt; lowLevel ? color.silver : color.purple, 3, plot.style_linebr)
lowLevel := array_pop(lows, flushLows)
plot(lowLevel, "Low 3", low &gt; lowLevel ? color.silver : color.purple, 4, plot.style_linebr)
lowLevel := array_pop(lows, flushLows)
plot(lowLevel, "Low 4", low &gt; lowLevel ? color.silver : color.purple, 5, plot.style_linebr)

if flushLows
    // Clear remaining levels after the last 4 have been plotted.
    lows.clear()</code></div>
<h3 class="md-heading" id="using-an-array-as-a-queue"><a href="#using-an-array-as-a-queue">Using an array as a queue<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Queues are FIFO (first in, first out) constructions. They behave
somewhat like cars arriving at a red light. New cars are queued at the
end of the line, and the first car to leave will be the first one that
arrived to the red light.</p>
<p>In the following code example, we let users decide through the script’s
inputs how many labels they want to have on their chart. We use that
quantity to determine the size of the array of labels we then create,
initializing the array’s elements to <code dir="auto">na</code>.</p>
<p>When a new pivot is detected, we create a label for it, saving the
label’s ID in the <code dir="auto">pLabel</code> variable. We then queue the ID of that label
by using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
to append the new label’s ID to the end of the array, making our array
size one greater than the maximum number of labels to keep on the chart.</p>
<p>Lastly, we de-queue the oldest label by removing the array’s first
element using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
and deleting the label referenced by that array element’s value. As we
have now de-queued an element from our queue, the array contains
<code dir="auto">pivotCountInput</code> elements once again. Note that on the dataset’s first
bars we will be deleting <code dir="auto">na</code> label IDs until the maximum number of
labels has been created, but this does not cause runtime errors. Let’s
look at our code:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/12d4008a6fa5df5636bb5063f6d59113.webp" width="1602"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
MAX_LABELS = 100
indicator("Show Last n High Pivots", "", true, max_labels_count = MAX_LABELS)

pivotCountInput = input.int(5, "How many pivots to show", minval = 0, maxval = MAX_LABELS)
pivotLegsInput  = input.int(3, "Pivot legs", minval = 1, maxval = 5)

// Create an array containing the user-selected max count of label IDs.
var labelIds = array.new&lt;label&gt;(pivotCountInput)

pHi = ta.pivothigh(pivotLegsInput, pivotLegsInput)
if not na(pHi)
    // New pivot found; plot its label `i_pivotLegs` bars back.
    pLabel = label.new(bar_index[pivotLegsInput], pHi, str.tostring(pHi, format.mintick), textcolor = color.white)
    // Queue the new label's ID by appending it to the end of the array.
    array.push(labelIds, pLabel)
    // De-queue the oldest label ID from the queue and delete the corresponding label.
    label.delete(array.shift(labelIds))</code></div>
<h2 class="md-heading" id="calculations-on-arrays"><a href="#calculations-on-arrays">Calculations on arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>While series variables can be viewed as a horizontal set of values
stretching back in time, Pine Script™‘s one-dimensional arrays can be
viewed as vertical structures residing on each bar. As an array’s set
of elements is not a
<a href="/pine-script-docs/v5/language/time-series/">time series</a>,
Pine Script™‘s usual mathematical functions are not allowed on them.
Special-purpose functions must be used to operate on all of an array’s
values. The available functions are:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.abs">array.abs()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">array.avg()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.covariance">array.covariance()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">array.min()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.max">array.max()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.median">array.median()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.mode">array.mode()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.percentile_linear_interpolation">array.percentile_linear_interpolation()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.percentile_nearest_rank">array.percentile_nearest_rank()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.percentrank">array.percentrank()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.range">array.range()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.standardize">array.standardize()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.stdev">array.stdev()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sum">array.sum()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.variance">array.variance()</a>.</p>
<p>Note that contrary to the usual mathematical functions in Pine Script™,
those used on arrays do not return <code dir="auto">na</code> when some of the values they
calculate on have <code dir="auto">na</code> values. There are a few exceptions to this rule:</p>
<ul>
<li>When all array elements have <code dir="auto">na</code> value or the array contains no
elements, <code dir="auto">na</code> is returned. <code dir="auto">array.standardize()</code> however, will
return an empty array.</li>
<li><code dir="auto">array.mode()</code> will return <code dir="auto">na</code> when no mode is found.</li>
</ul>
<h2 class="md-heading" id="manipulating-arrays"><a href="#manipulating-arrays">Manipulating arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="concatenation"><a href="#concatenation">Concatenation<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Two arrays can be merged — or concatenated — using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.concat">array.concat()</a>.
When arrays are concatenated, the second array is appended to the end of
the first, so the first array is modified while the second one remains
intact. The function returns the array ID of the first array:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="246" loading="lazy" src="images/13fdb73ffdfbfe7a0c03a8b5b76ebdb3.webp" width="1036"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.concat()`")
a = array.new&lt;float&gt;(0)
b = array.new&lt;float&gt;(0)
array.push(a, 0)
array.push(a, 1)
array.push(b, 2)
array.push(b, 3)
if barstate.islast
    label.new(bar_index, 0, "BEFORE\na: " + str.tostring(a) + "\nb: " + str.tostring(b), size = size.large)
    c = array.concat(a, b)
    array.push(c, 4)
    label.new(bar_index, 0, "AFTER\na: " + str.tostring(a) + "\nb: " + str.tostring(b) + "\nc: " + str.tostring(c), style = label.style_label_up, size = size.large)</code></div>
<h3 class="md-heading" id="copying"><a href="#copying">Copying<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>You can copy an array using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.copy">array.copy()</a>.
Here we copy the array <code dir="auto">a</code> to a new array named <code dir="auto">_b</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="190" loading="lazy" src="images/e773274ecfbb8a84839cfb9b4b589d60.webp" width="1018"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.copy()`")
a = array.new&lt;float&gt;(0)
array.push(a, 0)
array.push(a, 1)
if barstate.islast
    b = array.copy(a)
    array.push(b, 2)
    label.new(bar_index, 0, "a: " + str.tostring(a) + "\nb: " + str.tostring(b), size = size.large)</code></div>
<p>Note that simply using <code dir="auto">_b = a</code> in the previous example would not have
copied the array, but only its ID. From thereon, both variables would
point to the same array, so using either one would affect the same
array.</p>
<h3 class="md-heading" id="joining"><a href="#joining">Joining<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.join">array.join()</a>
to concatenate all of the elements in the array into a string and
separate these elements with the specified separator:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
v1 = array.new&lt;string&gt;(10, "test")
v2 = array.new&lt;string&gt;(10, "test")
array.push(v2, "test1")
v3 = array.new_float(5, 5)
v4 = array.new_int(5, 5)
l1 = label.new(bar_index, close, array.join(v1))
l2 = label.new(bar_index, close, array.join(v2, ","))
l3 = label.new(bar_index, close, array.join(v3, ","))
l4 = label.new(bar_index, close, array.join(v4, ","))</code></div>
<h3 class="md-heading" id="sorting"><a href="#sorting">Sorting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Arrays containing “int” or “float” elements can be sorted in either
ascending or descending order using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sort">array.sort()</a>.
The <code dir="auto">order</code> parameter is optional and defaults to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_order.ascending">order.ascending</a>.
As all <code dir="auto">array.*()</code> function arguments, it is qualified as “series”, so
can be determined at runtime, as is done here. Note that in the example,
which array is sorted is also determined at runtime:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/99121374c4a2119b57689ae58608a4c5.webp" width="1077"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.sort()`")
a = array.new&lt;float&gt;(0)
b = array.new&lt;float&gt;(0)
array.push(a, 2)
array.push(a, 0)
array.push(a, 1)
array.push(b, 4)
array.push(b, 3)
array.push(b, 5)
if barstate.islast
    barUp = close &gt; open
    array.sort(barUp ? a : b, barUp ? order.ascending : order.descending)
    label.new(bar_index, 0, 
      "a " + (barUp ? "is sorted ▲: "   : "is not sorted: ") + str.tostring(a) + "\n\n" +
      "b " + (barUp ? "is not sorted: " : "is sorted ▼: ")   + str.tostring(b), size = size.large)</code></div>
<p>Another useful option for sorting arrays is to use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sort_indices">array.sort_indices()</a>
function, which takes a reference to the original array and returns an
array containing the indices from the original array. Please note that
this function won’t modify the original array. The <code dir="auto">order</code> parameter is
optional and defaults to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_order.ascending">order.ascending</a>.</p>
<h3 class="md-heading" id="reversing"><a href="#reversing">Reversing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.reverse">array.reverse()</a>
to reverse an array:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.reverse()`")
a = array.new&lt;float&gt;(0)
array.push(a, 0)
array.push(a, 1)
array.push(a, 2)
if barstate.islast
    array.reverse(a)
    label.new(bar_index, 0, "a: " + str.tostring(a))</code></div>
<h3 class="md-heading" id="slicing"><a href="#slicing">Slicing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Slicing an array using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.slice">array.slice()</a>
creates a shallow copy of a subset of the parent array. You determine
the size of the subset to slice using the <code dir="auto">index_from</code> and <code dir="auto">index_to</code>
parameters. The <code dir="auto">index_to</code> argument must be one greater than the end of
the subset you want to slice.</p>
<p>The shallow copy created by the slice acts like a window on the parent
array’s content. The indices used for the slice define the window’s
position and size over the parent array. If, as in the example below, a
slice is created from the first three elements of an array (indices 0 to
2), then regardless of changes made to the parent array, and as long as
it contains at least three elements, the shallow copy will always
contain the parent array’s first three elements.</p>
<p>Additionally, once the shallow copy is created, operations on the copy
are mirrored on the parent array. Adding an element to the end of the
shallow copy, as is done in the following example, will widen the window
by one element and also insert that element in the parent array at index
3. In this example, to slice the subset from index 0 to index 2 of array
<code dir="auto">a</code>, we must use <code dir="auto">_sliceOfA = array.slice(a, 0, 3)</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="214" loading="lazy" src="images/351df8c3d34ad950ec861191c41b92d0.webp" width="1016"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`array.slice()`")
a = array.new&lt;float&gt;(0)
array.push(a, 0)
array.push(a, 1)
array.push(a, 2)
array.push(a, 3)
if barstate.islast
    // Create a shadow of elements at index 1 and 2 from array `a`.
    sliceOfA = array.slice(a, 0, 3)
    label.new(bar_index, 0, "BEFORE\na: " + str.tostring(a) + "\nsliceOfA: " + str.tostring(sliceOfA))
    // Remove first element of parent array `a`.
    array.remove(a, 0)
    // Add a new element at the end of the shallow copy, thus also affecting the original array `a`.
    array.push(sliceOfA, 4)
    label.new(bar_index, 0, "AFTER\na: " + str.tostring(a) + "\nsliceOfA: " + str.tostring(sliceOfA), style = label.style_label_up)</code></div>
<h2 class="md-heading" id="searching-arrays"><a href="#searching-arrays">Searching arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We can test if a value is part of an array with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.includes">array.includes()</a>
function, which returns true if the element is found. We can find the
first occurrence of a value in an array by using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a>
function. The first occurence is the one with the lowest index. We can
also find the last occurrence of a value with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.lastindexof">array.lastindexof()</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Searching in arrays")
valueInput = input.int(1)
a = array.new&lt;float&gt;(0)
array.push(a, 0)
array.push(a, 1)
array.push(a, 2)
array.push(a, 1)
if barstate.islast
    valueFound      = array.includes(a, valueInput)
    firstIndexFound = array.indexof(a, valueInput)
    lastIndexFound  = array.lastindexof(a, valueInput)
    label.new(bar_index, 0, "a: " + str.tostring(a) + 
      "\nFirst " + str.tostring(valueInput) + (firstIndexFound != -1 ? " value was found at index: " + str.tostring(firstIndexFound) : " value was not found.") +
      "\nLast " + str.tostring(valueInput)  + (lastIndexFound  != -1 ? " value was found at index: " + str.tostring(lastIndexFound) : " value was not found."))</code></div>
<p>We can also perform a binary search on an array but note that performing
a binary search on an array means that the array will first need to be
sorted in ascending order only. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search">array.binary_search()</a>
function will return the value’s index if it was found or -1 if it
wasn’t. If we want to always return an existing index from the array
even if our chosen value wasn’t found, then we can use one of the other
binary search functions available. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search_leftmost">array.binary_search_leftmost()</a>
function, which returns an index if the value was found or the first
index to the left where the value would be found. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search_rightmost">array.binary_search_rightmost()</a>
function is almost identical and returns an index if the value was found
or the first index to the right where the value would be found.</p>
<h2 class="md-heading" id="error-handling"><a href="#error-handling">Error handling<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Malformed <code dir="auto">array.*()</code> call syntax in Pine scripts will cause the usual
<strong>compiler</strong> error messages to appear in Pine Editor’s console, at the
bottom of the window, when you save a script. Refer to the Pine Script™
<a href="https://www.tradingview.com/pine-script-reference/v5/">v5 Reference
Manual</a> when in
doubt regarding the exact syntax of function calls.</p>
<p>Scripts using arrays can also throw <strong>runtime</strong> errors, which appear as
an exclamation mark next to the indicator’s name on the chart. We
discuss those runtime errors in this section.</p>
<h3 class="md-heading" id="index-xx-is-out-of-bounds-array-size-is-yy"><a href="#index-xx-is-out-of-bounds-array-size-is-yy">Index xx is out of bounds. Array size is yy<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This will most probably be the most frequent error you encounter. It
will happen when you reference an nonexistent array index. The “xx”
value will be the value of the faulty index you tried to use, and “yy”
will be the size of the array. Recall that array indices start at
zero — not one — and end at the array’s size, minus one. An array of
size 3’s last valid index is thus <code dir="auto">2</code>.</p>
<p>To avoid this error, you must make provisions in your code logic to
prevent using an index lying outside of the array’s index boundaries.
This code will generate the error because the last index we use in the
loop is outside the valid index range for the array:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Out of bounds index")
a = array.new&lt;float&gt;(3)
for i = 1 to 3
    array.set(a, i, i)
plot(array.pop(a))</code></div>
<p>The correct <code dir="auto">for</code> statement is:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for i = 0 to 2</code></div>
<p>To loop on all array elements in an array of unknown size, use:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Protected `for` loop")
sizeInput = input.int(0, "Array size", minval = 0, maxval = 100000)
a = array.new&lt;float&gt;(sizeInput)
for i = 0 to (array.size(a) == 0 ? na : array.size(a) - 1)
    array.set(a, i, i)
plot(array.pop(a))</code></div>
<p>When you size arrays dynamically using a field in your script’s
<em>Settings/Inputs</em> tab, protect the boundaries of that value using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>‘s
<code dir="auto">minval</code> and <code dir="auto">maxval</code> parameters:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Protected array size")
sizeInput = input.int(10, "Array size", minval = 1, maxval = 100000)
a = array.new&lt;float&gt;(sizeInput)
for i = 0 to sizeInput - 1
    array.set(a, i, i)
plot(array.size(a))</code></div>
<p>See the <a href="/pine-script-docs/v5/language/arrays/#looping-through-array-elements">Looping through array elements</a>
section of this page for more information.</p>
<h3 class="md-heading" id="cannot-call-array-methods-when-id-of-array-is-na"><a href="#cannot-call-array-methods-when-id-of-array-is-na">Cannot call array methods when ID of array is ‘na’<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When an array ID is initialized to <code dir="auto">na</code>, operations on it are not
allowed, since no array exists. All that exists at that point is an
array variable containing the <code dir="auto">na</code> value rather that a valid array ID
pointing to an existing array. Note that an array created with no
elements in it, as you do when you use <code dir="auto">a = array.new_int(0)</code>, has a
valid ID nonetheless. This code will throw the error we are discussing:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Out of bounds index")
array&lt;int&gt; a = na
array.push(a, 111)
label.new(bar_index, 0, "a: " + str.tostring(a))</code></div>
<p>To avoid it, create an array with size zero using:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">array&lt;int&gt; a = array.new_int(0)</code></div>
<p>or:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">a = array.new_int(0)</code></div>
<h3 class="md-heading" id="array-is-too-large-maximum-size-is-100000"><a href="#array-is-too-large-maximum-size-is-100000">Array is too large. Maximum size is 100000<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This error will appear if your code attempts to declare an array with a
size greater than 100,000. It will also occur if, while dynamically
appending elements to an array, a new element would increase the
array’s size past the maximum.</p>
<h3 class="md-heading" id="cannot-create-an-array-with-a-negative-size"><a href="#cannot-create-an-array-with-a-negative-size">Cannot create an array with a negative size<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>We haven’t found any use for arrays of negative size yet, but if you
ever do, we may allow them :)</p>
<h3 class="md-heading" id="cannot-use-shift-if-array-is-empty"><a href="#cannot-use-shift-if-array-is-empty">Cannot use shift() if array is empty.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This error will occur if
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
is called to remove the first element of an empty array.</p>
<h3 class="md-heading" id="cannot-use-pop-if-array-is-empty"><a href="#cannot-use-pop-if-array-is-empty">Cannot use pop() if array is empty.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This error will occur if
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.pop">array.pop()</a>
is called to remove the last element of an empty array.</p>
<h3 class="md-heading" id="index-from-should-be-less-than-index-to"><a href="#index-from-should-be-less-than-index-to">Index ‘from’ should be less than index ‘to’<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When two indices are used in functions such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.slice">array.slice()</a>,
the first index must always be smaller than the second one.</p>
<h3 class="md-heading" id="slice-is-out-of-bounds-of-the-parent-array"><a href="#slice-is-out-of-bounds-of-the-parent-array">Slice is out of bounds of the parent array<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This message occurs whenever the parent array’s size is modified in
such a way that it makes the shallow copy created by a slice point
outside the boundaries of the parent array. This code will reproduce it
because after creating a slice from index 3 to 4 (the last two elements
of our five-element parent array), we remove the parent’s first
element, making its size four and its last index 3. From that moment on,
the shallow copy which is still poiting to the “window” at the parent
array’s indices 3 to 4, is pointing out of the parent array’s
boundaries:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Slice out of bounds")
a = array.new&lt;float&gt;(5, 0)
b = array.slice(a, 3, 5)
array.remove(a, 0)
c = array.indexof(b, 2)
plot(c)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/methods"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Methods  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/matrices"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Matrices <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Matrices</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-matrices"><a href="#matrices">Matrices<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ Matrices are <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> that store value references in a
rectangular format. They are the equivalent of two-dimensional <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> objects with functions and methods for inspection, modification, and specialized calculations. As with <a href="/pine-script-docs/v5/language/arrays/">arrays</a>, all matrix elements must be of the same <a href="/pine-script-docs/v5/language/type-system/#types">type</a>, <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a>, or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>.</p>
<p>Matrices reference their elements using <em>two</em> indices: one index for their
<em>rows</em> and the other for their <em>columns</em>. Each index starts at 0 and extends
to the number of rows/columns in the matrix minus one. Matrices in Pine
can have dynamic numbers of rows and columns that vary across bars. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count">total number of
elements</a>
within a matrix is the <em>product</em> of the number of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">rows</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns">columns</a>
(e.g., a 5x5 matrix has a total of 25). Like
<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, the total number of
elements in a matrix cannot exceed 100,000.</p>
<h2 class="md-heading" id="declaring-a-matrix"><a href="#declaring-a-matrix">Declaring a matrix<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ uses the following syntax for matrix declaration:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var/varip ][matrix&lt;type&gt; ]&lt;identifier&gt; = &lt;expression&gt;</span></div></div></code></pre></figure></link></div>
<p>Where <code dir="auto">&lt;type&gt;</code> is a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> for the matrix that declares the type of values it will
contain, and the <code dir="auto">&lt;expression&gt;</code> returns either a matrix instance of the
type or <code dir="auto">na</code>.</p>
<p>When declaring a matrix variable as <code dir="auto">na</code>, users must specify that the
identifier will reference matrices of a specific type by including the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>
keyword followed by a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a>.</p>
<p>This line declares a new <code dir="auto">myMatrix</code> variable with a value of <code dir="auto">na</code>. It
explicitly declares the variable as <code dir="auto">matrix&lt;float&gt;</code>, which tells the
compiler that the variable can only accept
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>
objects containing
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">matrix&lt;float&gt; myMatrix = na</code></div>
<p>When a matrix variable is not assigned to <code dir="auto">na</code>, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>
keyword and its type template are optional, as the compiler will use the
type information from the object the variable references.</p>
<p>Here, we declare a <code dir="auto">myMatrix</code> variable referencing a new <code dir="auto">matrix&lt;float&gt;</code>
instance with two rows, two columns, and an <code dir="auto">initial_value</code> of 0. The
variable gets its type information from the new object in this case, so
it doesn’t require an explicit type declaration:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myMatrix = matrix.new&lt;float&gt;(2, 2, 0.0)</code></div>
<h3 class="md-heading" id="using-var-and-varip-keywords"><a href="#using-var-and-varip-keywords">Using `var` and `varip` keywords<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>As with other variables, users can include the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keywords to instruct a script to declare a matrix variable only once
rather than on every bar. A matrix variable declared with this keyword
will point to the same instance throughout the span of the chart unless
the script explicitly assigns another matrix to it, allowing a matrix
and its element references to persist between script iterations.</p>
<p>This script declares an <code dir="auto">m</code> variable assigned to a matrix that holds a
single row of two
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
elements using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword. On every 20th bar, the script adds 1 to the first element on
the first row of the <code dir="auto">m</code> matrix. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call displays this element on the chart. As we see from the plot, the
value of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">m.get(0,
0)</a>
persists between bars, never returning to the initial value of 0:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="372" loading="lazy" src="images/6cc89a7f011f68f7ac41a71131a48b39.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("var matrix demo")

//@variable A 1x2 rectangular matrix declared only at `bar_index == 0`, i.e., the first bar.
var m = matrix.new&lt;int&gt;(1, 2, 0)

//@variable Is `true` on every 20th bar.
bool update = bar_index % 20 == 0

if update
    int currentValue = m.get(0, 0) // Get the current value of the first row and column.
    m.set(0, 0, currentValue + 1)  // Set the first row and column element value to `currentValue + 1`.

plot(m.get(0, 0), linewidth = 3) // Plot the value from the first row and column.</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Matrix variables declared using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
behave as ones using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> on
historical data, but they update their values for realtime bars (i.e.,
the bars since the script’s last compilation) on each new price tick.
Matrices assigned to
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
variables can only hold
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_bool">bool</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_color">color</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
types or
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> that exclusively contain within their fields these types or
collections (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>,
matrices, or <a href="/pine-script-docs/v5/language/maps/">maps</a>) of these
types.</p></div></aside>
<h2 class="md-heading" id="reading-and-writing-matrix-elements"><a href="#reading-and-writing-matrix-elements">Reading and writing matrix elements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="matrixget-and-matrixset"><a href="#matrixget-and-matrixset">`matrix.get()` and `matrix.set()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To retrieve the value from a matrix at a specified <code dir="auto">row</code> and <code dir="auto">column</code>
index, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">matrix.get()</a>.
This function locates the specified matrix element and returns its
value. Similarly, to overwrite a specific element’s value, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">matrix.set()</a>
to assign the element at the specified <code dir="auto">row</code> and <code dir="auto">column</code> to a new
<code dir="auto">value</code>.</p>
<p>The example below defines a square matrix <code dir="auto">m</code> with two rows and columns
and an <code dir="auto">initial_value</code> of 0 for all elements on the first bar. The
script adds 1 to each element’s value on different bars using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">m.get()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">m.set()</a>
methods. It updates the first row’s first value once every 11 bars, the
first row’s second value once every seven bars, the second row’s first
value once every five bars, and the second row’s second value once
every three bars. The script plots each element’s value on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="380" loading="lazy" src="images/dfc27127fda0397c49bf05be4cf78bf0.webp" width="1340"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reading and writing elements demo")

//@variable A 2x2 square matrix of `float` values.
var m = matrix.new&lt;float&gt;(2, 2, 0.0)

switch
    bar_index % 11 == 0 =&gt; m.set(0, 0, m.get(0, 0) + 1.0) // Adds 1 to the value at row 0, column 0 every 11th bar.
    bar_index % 7  == 0 =&gt; m.set(0, 1, m.get(0, 1) + 1.0) // Adds 1 to the value at row 0, column 1 every 7th bar.
    bar_index % 5  == 0 =&gt; m.set(1, 0, m.get(1, 0) + 1.0) // Adds 1 to the value at row 1, column 0 every 5th bar.
    bar_index % 3  == 0 =&gt; m.set(1, 1, m.get(1, 1) + 1.0) // Adds 1 to the value at row 1, column 1 every 3rd bar.

plot(m.get(0, 0), "Row 0, Column 0 Value", color.red, 2)
plot(m.get(0, 1), "Row 0, Column 1 Value", color.orange, 2)
plot(m.get(1, 0), "Row 1, Column 0 Value", color.green, 2)
plot(m.get(1, 1), "Row 1, Column 1 Value", color.blue, 2)</code></div>
<h3 class="md-heading" id="matrixfill"><a href="#matrixfill">`matrix.fill()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To overwrite all matrix elements with a specific value, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill">matrix.fill()</a>.
This function points all items in the entire matrix or within the
<code dir="auto">from_row/column</code> and <code dir="auto">to_row/column</code> index range to the <code dir="auto">value</code>
specified in the call. For example, this snippet declares a 4x4 square
matrix, then fills its elements with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a>
value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myMatrix = matrix.new&lt;float&gt;(4, 4)
myMatrix.fill(math.random())</code></div>
<p>Note when using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill">matrix.fill()</a>
with matrices containing special types
(<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>)
or <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>, all replaced elements will point to the same object passed
in the function call.</p>
<p>This script declares a matrix with four rows and columns of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
references, which it fills with a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
object on the first bar. On each bar, the script sets the <code dir="auto">x</code> attribute
of the label referenced at row 0, column 0 to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>,
and the <code dir="auto">text</code> attribute of the one referenced at row 3, column 3 to the
number of labels on the chart. Although the matrix can reference 16
(4x4) labels, each element points to the <em>same</em> instance, resulting in
only one label on the chart that updates its <code dir="auto">x</code> and <code dir="auto">text</code> attributes
on each bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="350" loading="lazy" src="images/313acc5168a88fdaa15eea447e354456.webp" width="986"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Object matrix fill demo")

//@variable A 4x4 label matrix.
var matrix&lt;label&gt; m = matrix.new&lt;label&gt;(4, 4)

// Fill `m` with a new label object on the first bar.
if bar_index == 0
    m.fill(label.new(0, 0, textcolor = color.white, size = size.huge))

//@variable The number of label objects on the chart.
int numLabels = label.all.size()

// Set the `x` of the label from the first row and column to `bar_index`.
m.get(0, 0).set_x(bar_index)
// Set the `text` of the label at the last row and column to the number of labels.
m.get(3, 3).set_text(str.format("Total labels on the chart: {0}", numLabels))</code></div>
<h2 class="md-heading" id="rows-and-columns"><a href="#rows-and-columns">Rows and columns<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="retrieving"><a href="#retrieving">Retrieving<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Matrices facilitate the retrieval of all values from a specific row or
column via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">matrix.col()</a>
functions. These functions return the values as an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
object sized according to the other dimension of the matrix, i.e., the
size of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a>
array equals the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns">number of
columns</a>
and the size of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">matrix.col()</a>
array equals the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">number of
rows</a>.</p>
<p>The script below populates a 3x2 <code dir="auto">m</code> matrix with the values 1 - 6 on the
first chart bar. It calls the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">m.row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">m.col()</a>
methods to access the first row and column arrays from the matrix and
displays them on the chart in a label along with the array sizes:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="340" loading="lazy" src="images/e083d21d169db802cf9f919a100f1f8f.webp" width="954"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Retrieving rows and columns demo")

//@variable A 3x2 rectangular matrix.
var matrix&lt;float&gt; m = matrix.new&lt;float&gt;(3, 2)

if bar_index == 0
    m.set(0, 0, 1.0) // Set row 0, column 0 value to 1.
    m.set(0, 1, 2.0) // Set row 0, column 1 value to 2.
    m.set(1, 0, 3.0) // Set row 1, column 0 value to 3.
    m.set(1, 1, 4.0) // Set row 1, column 1 value to 4.
    m.set(2, 0, 5.0) // Set row 1, column 0 value to 5.
    m.set(2, 1, 6.0) // Set row 1, column 1 value to 6.

//@variable The first row of the matrix.
array&lt;float&gt; row0 = m.row(0)
//@variable The first column of the matrix.
array&lt;float&gt; column0 = m.col(0)

//@variable Displays the first row and column of the matrix and their sizes in a label.
var label debugLabel = label.new(0, 0, color = color.blue, textcolor = color.white, size = size.huge)
debugLabel.set_x(bar_index)
debugLabel.set_text(str.format("Row 0: {0}, Size: {1}\nCol 0: {2}, Size: {3}", row0, m.columns(), column0, m.rows()))</code></div>
<p>Note that:</p>
<ul>
<li>To get the sizes of the arrays displayed in the label, we used
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">rows()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns">columns()</a>
methods rather than
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a>
to demonstrate that the size of the <code dir="auto">row0</code> array equals the
number of columns and the size of the <code dir="auto">column0</code> array equals the
number of rows.</li>
</ul>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">matrix.col()</a>
copy the references in a row/column to a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.
Modifications to the <a href="/pine-script-docs/v5/language/arrays/">arrays</a>
returned by these functions do not directly affect the elements or the
shape of a matrix.</p>
<p>Here, we’ve modified the previous script to set the first element of
<code dir="auto">row0</code> to 10 via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set">array.set()</a>
method before displaying the label. This script also plots the value
from row 0, column 0. As we see, the label shows that the first element
of the <code dir="auto">row0</code> array is 10. However, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a>
shows that the corresponding matrix element still has a value of 1:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="372" loading="lazy" src="images/5a93515cceaf99d6256431506c3ea624.webp" width="1324"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Retrieving rows and columns demo")

//@variable A 3x2 rectangular matrix.
var matrix&lt;float&gt; m = matrix.new&lt;float&gt;(3, 2)

if bar_index == 0
    m.set(0, 0, 1.0) // Set row 0, column 0 value to 1.
    m.set(0, 1, 2.0) // Set row 0, column 1 value to 2.
    m.set(1, 0, 3.0) // Set row 1, column 0 value to 3.
    m.set(1, 1, 4.0) // Set row 1, column 1 value to 4.
    m.set(2, 0, 5.0) // Set row 1, column 0 value to 5.
    m.set(2, 1, 6.0) // Set row 1, column 1 value to 6.

//@variable The first row of the matrix.
array&lt;float&gt; row0 = m.row(0)
//@variable The first column of the matrix.
array&lt;float&gt; column0 = m.col(0)

// Set the first `row` element to 10.
row0.set(0, 10)

//@variable Displays the first row and column of the matrix and their sizes in a label.
var label debugLabel = label.new(0, m.get(0, 0), color = color.blue, textcolor = color.white, size = size.huge)
debugLabel.set_x(bar_index)
debugLabel.set_text(str.format("Row 0: {0}, Size: {1}\nCol 0: {2}, Size: {3}", row0, m.columns(), column0, m.rows()))

// Plot the first element of `m`.
plot(m.get(0, 0), linewidth = 3)</code></div>
<p>Although changes to an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">matrix.row()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">matrix.col()</a>
do not directly affect a parent matrix, it’s important to note the
resulting array from a matrix containing
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>
or special types, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>,
behaves as a <em>shallow copy</em> of a row/column, i.e., the elements within
an array returned from these functions point to the same objects as the
corresponding matrix elements.</p>
<p>This script contains a custom <code dir="auto">myUDT</code> type containing a <code dir="auto">value</code> field
with an initial value of 0. It declares a 1x1 <code dir="auto">m</code> matrix to hold a
single <code dir="auto">myUDT</code> instance on the first bar, then calls <code dir="auto">m.row(0)</code> to copy
the first row of the matrix as an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.
On every chart bar, the script adds 1 to the <code dir="auto">value</code> field of the first
<code dir="auto">row</code> array element. In this case, the <code dir="auto">value</code> field of the matrix
element increases on every bar as well since both elements reference the
same object:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Row with reference types demo")

//@type A custom type that holds a float value.
type myUDT
    float value = 0.0

//@variable A 1x1 matrix of `myUDT` type.
var matrix&lt;myUDT&gt; m = matrix.new&lt;myUDT&gt;(1, 1, myUDT.new())
//@variable A shallow copy of the first row of `m`.
array&lt;myUDT&gt; row = m.row(0)
//@variable The first element of the `row`.
myUDT firstElement = row.get(0)

firstElement.value += 1.0 // Add 1 to the `value` field of `firstElement`. Also affects the element in the matrix.

plot(m.get(0, 0).value, linewidth = 3) // Plot the `value` of the `myUDT` object from the first row and column of `m`.</code></div>
<h3 class="md-heading" id="inserting"><a href="#inserting">Inserting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can add new rows and columns to a matrix via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row">matrix.add_row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col">matrix.add_col()</a>.
These functions insert the value references from an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
into a matrix at the specified <code dir="auto">row/column</code> index. If the <code dir="auto">id</code> matrix is
empty (has no rows or columns), the <code dir="auto">array_id</code> in the call can be of any
size. If a row/column exists at the specified index, the matrix
increases the index value for the existing row/column and all after it
by 1.</p>
<p>The script below declares an empty <code dir="auto">m</code> matrix and inserts rows and
columns using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row">m.add_row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col">m.add_col()</a>
methods. It first inserts an array with three elements at row 0, turning
<code dir="auto">m</code> into a 1x3 matrix, then another at row 1, changing the shape to 2x3.
After that, the script inserts another array at row 0, which changes the
shape of <code dir="auto">m</code> to 3x3 and shifts the index of all rows previously at index
0 and higher. It inserts another array at the last column index,
changing the shape to 3x4. Finally, it adds an array with four values at
the end row index.</p>
<p>The resulting matrix has four rows and columns and contains values 1-16
in ascending order. The script displays the rows of <code dir="auto">m</code> after each
row/column insertion with a user-defined <code dir="auto">debugLabel()</code> function to
visualize the process:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="396" loading="lazy" src="images/ae3a7b936d22ffd36ee50bc1fc60673d.webp" width="1282"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Rows and columns demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//Create an empty matrix.
var m = matrix.new&lt;float&gt;()

if bar_index == last_bar_index - 1
    debugLabel(m, bar_index - 30, note = "Empty matrix")

    // Insert an array at row 0. `m` will now have 1 row and 3 columns.
    m.add_row(0, array.from(5, 6, 7))
    debugLabel(m, bar_index - 20, note = "New row at\nindex 0")

    // Insert an array at row 1. `m` will now have 2 rows and 3 columns.
    m.add_row(1, array.from(9, 10, 11))
    debugLabel(m, bar_index - 10, note = "New row at\nindex 1")

    // Insert another array at row 0. `m` will now have 3 rows and 3 columns.
    // The values previously on row 0 will now be on row 1, and the values from row 1 will be on row 2.
    m.add_row(0, array.from(1, 2, 3))
    debugLabel(m, bar_index, note = "New row at\nindex 0")

    // Insert an array at column 3. `m` will now have 3 rows and 4 columns.
    m.add_col(3, array.from(4, 8, 12))
    debugLabel(m, bar_index + 10, note = "New column at\nindex 3")

    // Insert an array at row 3. `m` will now have 4 rows and 4 columns.
    m.add_row(3, array.from(13, 14, 15, 16))
    debugLabel(m, bar_index + 20, note = "New row at\nindex 3")</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Just as the row or column arrays
<a href="/pine-script-docs/v5/language/matrices/#retrieving">retrieved</a> from a matrix of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>,
or <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
instances behave as shallow copies, the elements of matrices containing
such types reference the same objects as the
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> inserted into them.
Modifications to the element values in either object affect the other in
such cases.</p></div></aside>
<h3 class="md-heading" id="removing"><a href="#removing">Removing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To remove a specific row or column from a matrix, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row">matrix.remove_row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col">matrix.remove_col()</a>.
These functions remove the specified row/column and decrease the index
values of all rows/columns after it by 1.</p>
<p>For this example, we’ve added these lines of code to our “Rows and
columns demo” script from the
<a href="/pine-script-docs/v5/language/matrices/#inserting">section above</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Removing example

    // Remove the first row and last column from the matrix. `m` will now have 3 rows and 3 columns.
    m.remove_row(0)
    m.remove_col(3)
    debugLabel(m, bar_index + 30, color.red, note = "Removed row 0\nand column 3")</code></div>
<p>This code removes the first row and the last column of the <code dir="auto">m</code> matrix
using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row">m.remove_row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col">m.remove_col()</a>
methods and displays the rows in a label at <code dir="auto">bar_index + 30</code>. As we can
see, <code dir="auto">m</code> has a 3x3 shape after executing this block, and the index
values for all existing rows are reduced by 1:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="394" loading="lazy" src="images/2ac4c6e3f45e7d7e52c8a2e4cf037435.webp" width="1044"/></div></p>
<h3 class="md-heading" id="swapping"><a href="#swapping">Swapping<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To swap the rows and columns of a matrix without altering its
dimensions, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.swap_rows">matrix.swap_rows()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.swap_columns">matrix.swap_columns()</a>.
These functions swap the locations of the elements at the <code dir="auto">row1/column1</code>
and <code dir="auto">row2/column2</code> indices.</p>
<p>Let’s add the following lines to the
<a href="/pine-script-docs/v5/language/matrices/#removing">previous example</a>, which swap the first and last rows of <code dir="auto">m</code> and display the
changes in a label at <code dir="auto">bar_index + 40</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Swapping example

    // Swap the first and last row. `m` retains the same dimensions.
    m.swap_rows(0, 2)
    debugLabel(m, bar_index + 40, color.purple, note = "Swapped rows 0\nand 2")</code></div>
<p>In the new label, we see the matrix has the same number of rows as
before, and the first and last rows have traded places:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="392" loading="lazy" src="images/060dd8cd28a209aa0e4616f826ed2882.webp" width="1044"/></div></p>
<h3 class="md-heading" id="replacing"><a href="#replacing">Replacing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>It may be desirable in some cases to completely <em>replace</em> a row or
column in a matrix. To do so,
<a href="/pine-script-docs/v5/language/matrices/#inserting">insert</a> the new array at the desired <code dir="auto">row/column</code> and
<a href="/pine-script-docs/v5/language/matrices/#removing">remove</a> the old elements previously at that index.</p>
<p>In the following code, we’ve defined a <code dir="auto">replaceRow()</code> method that uses
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row">add_row()</a>
method to insert the new <code dir="auto">values</code> at the <code dir="auto">row</code> index and uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_row">remove_row()</a>
method to remove the old row that moved to the <code dir="auto">row + 1</code> index. This
script uses the <code dir="auto">replaceRow()</code> method to fill the rows of a 3x3 matrix
with the numbers 1-9. It draws a label on the chart before and after
replacing the rows using the custom <code dir="auto">debugLabel()</code> method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="296" loading="lazy" src="images/1047ab49400794b69cbfe5e6cba90a65.webp" width="706"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Replacing rows demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@function Replaces the `row` of `this` matrix with a new array of `values`.
//@param    row The row index to replace.
//@param    values The array of values to insert.
method replaceRow(matrix&lt;float&gt; this, int row, array&lt;float&gt; values) =&gt;
    this.add_row(row, values) // Inserts a copy of the `values` array at the `row`.
    this.remove_row(row + 1)  // Removes the old elements previously at the `row`.

//@variable A 3x3 matrix.
var matrix&lt;float&gt; m = matrix.new&lt;float&gt;(3, 3, 0.0)

if bar_index == last_bar_index - 1
    m.debugLabel(note = "Original")
    // Replace each row of `m`.
    m.replaceRow(0, array.from(1.0, 2.0, 3.0))
    m.replaceRow(1, array.from(4.0, 5.0, 6.0))
    m.replaceRow(2, array.from(7.0, 8.0, 9.0))
    m.debugLabel(bar_index + 10, note = "Replaced rows")</code></div>
<h2 class="md-heading" id="looping-through-a-matrix"><a href="#looping-through-a-matrix">Looping through a matrix<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="for"><a href="#for">`for`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a script only needs to iterate over the row/column indices in a
matrix, the most common method is to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loops. For example, this line creates a loop with a <code dir="auto">row</code> value that
starts at 0 and increases by one until it reaches one less than the
number of rows in the <code dir="auto">m</code> matrix (i.e., the last row index):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for row = 0 to m.rows() - 1</code></div>
<p>To iterate over all index values in the <code dir="auto">m</code> matrix, we can create a
<em>nested</em> loop that iterates over each <code dir="auto">column</code> index on each <code dir="auto">row</code>
value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for row = 0 to m.rows() - 1
    for column = 0 to m.columns() - 1</code></div>
<p>Let’s use this nested structure to create a
<a href="/pine-script-docs/v5/language/methods/">method</a> that visualizes
matrix elements. In the script below, we’ve defined a <code dir="auto">toTable()</code>
method that displays the elements of a matrix within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
object. It iterates over each <code dir="auto">row</code> index and over each <code dir="auto">column</code> index
on every <code dir="auto">row</code>. Within the loop, it converts each element to a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
to display in the corresponding table cell.</p>
<p>On the first bar, the script creates an empty <code dir="auto">m</code> matrix, populates it
with rows, and calls <code dir="auto">m.toTable()</code> to display its elements:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="392" loading="lazy" src="images/ca28bd3b515fb42d87e1ace05487bb0b.webp" width="1258"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("for loop demo", "Matrix to table")

//@function Displays the elements of `this` matrix in a table.
//@param    this The matrix to display.
//@param    position The position of the table on the chart.
//@param    bgColor The background color of the table.
//@param    textColor The color of the text in each cell.
//@param    note A note string to display on the bottom row of the table.
//@returns  A new `table` object with cells corresponding to each element of `this` matrix.
method toTable(
     matrix&lt;float&gt; this, string position = position.middle_center,
     color bgColor = color.blue, color textColor = color.white,
     string note = na
 ) =&gt;
    //@variable The number of rows in `this` matrix.
    int rows = this.rows()
    //@variable The number of columns in `this` matrix.
    int columns = this.columns()
    //@variable A table that displays the elements of `this` matrix with an optional `note` cell.
    table result = table.new(position, columns, rows + 1, bgColor)

    // Iterate over each row index of `this` matrix.
    for row = 0 to rows - 1
        // Iterate over each column index of `this` matrix on each `row`.
        for col = 0 to columns - 1
            //@variable The element from `this` matrix at the `row` and `col` index.
            float element = this.get(row, col)
            // Initialize the corresponding `result` cell with the `element` value.
            result.cell(col, row, str.tostring(element), text_color = textColor, text_size = size.huge)

    // Initialize a merged cell on the bottom row if a `note` is provided.
    if not na(note)
        result.cell(0, rows, note, text_color = textColor, text_size = size.huge)
        result.merge_cells(0, rows, columns - 1, rows)

    result // Return the `result` table.

//@variable A 3x4 matrix of values.
var m = matrix.new&lt;float&gt;()

if bar_index == 0
    // Add rows to `m`.
    m.add_row(0, array.from(1, 2, 3))
    m.add_row(1, array.from(5, 6, 7))
    m.add_row(2, array.from(9, 10, 11))
    // Add a column to `m`.
    m.add_col(3, array.from(4, 8, 12))
    // Display the elements of `m` in a table.
    m.toTable()</code></div>
<h3 class="md-heading" id="forin"><a href="#forin">`for…in`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a script needs to iterate over and retrieve the rows of a matrix,
using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_for%7Bdot%7D%7Bdot%7D%7Bdot%7Din">for…in</a>
structure is often preferred over the standard <code dir="auto">for</code> loop. This
structure directly references the row
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> in a matrix, making
it a more convenient option for such use cases. For example, this line
creates a loop that returns a <code dir="auto">row</code> array for each row in the <code dir="auto">m</code>
matrix:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for row in m</code></div>
<p>The following indicator calculates the moving average of OHLC data with
an input <code dir="auto">length</code> and displays the values on the chart. The custom
<code dir="auto">rowWiseAvg()</code> method loops through the rows of a matrix using a
<code dir="auto">for...in</code> structure to produce an array containing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">array.avg()</a>
of each <code dir="auto">row</code>.</p>
<p>On the first chart bar, the script creates a new <code dir="auto">m</code> matrix with four
rows and <code dir="auto">length</code> columns, which it queues a new column of OHLC data
into via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col">m.add_col()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.remove_col">m.remove_col()</a>
methods on each subsequent bar. It uses <code dir="auto">m.rowWiseAvg()</code> to calculate
the array of row-wise <code dir="auto">averages</code>, then it plots the element values on
the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="682" loading="lazy" src="images/8e7ec55abed229848b0d5057dc51718b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("for...in loop demo", "Average OHLC", overlay = true)

//@variable The number of terms in the average.
int length = input.int(20, "Length", minval = 1)

//@function Calculates the average of each matrix row.
method rowWiseAvg(matrix&lt;float&gt; this) =&gt;
    //@variable An array with elements corresponding to each row's average.
    array&lt;float&gt; result = array.new&lt;float&gt;()
    // Iterate over each `row` of `this` matrix.
    for row in this
        // Push the average of each `row` into the `result`.
        result.push(row.avg())
    result // Return the resulting array.

//@variable A 4x`length` matrix of values.
var matrix&lt;float&gt; m = matrix.new&lt;float&gt;(4, length)

// Add a new column containing OHLC values to the matrix.
m.add_col(m.columns(), array.from(open, high, low, close))
// Remove the first column.
m.remove_col(0)

//@variable An array containing averages of `open`, `high`, `low`, and `close` over `length` bars.
array&lt;float&gt; averages = m.rowWiseAvg()

plot(averages.get(0), "Average Open",  color.blue,   2)
plot(averages.get(1), "Average High",  color.green,  2)
plot(averages.get(2), "Average Low",   color.red,    2)
plot(averages.get(3), "Average Close", color.orange, 2)</code></div>
<p>Note that:</p>
<ul>
<li><code dir="auto">for...in</code> loops can also reference the index value of each row.
For example, <code dir="auto">for [i, row] in m</code> creates a tuple containing the
<code dir="auto">i</code> row index and the corresponding <code dir="auto">row</code> array from the <code dir="auto">m</code>
matrix on each loop iteration.</li>
</ul>
<h2 class="md-heading" id="copying-a-matrix"><a href="#copying-a-matrix">Copying a matrix<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="shallow-copies"><a href="#shallow-copies">Shallow copies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine scripts can copy matrices via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy">matrix.copy()</a>.
This function returns a <em>shallow copy</em> of a matrix that does not affect
the shape of the original matrix or its references.</p>
<p>For example, this script assigns a new matrix to the <code dir="auto">myMatrix</code> variable
and adds two columns. It creates a new <code dir="auto">myCopy</code> matrix from <code dir="auto">myMatrix</code>
using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy">myMatrix.copy()</a>
method, then adds a new row. It displays the rows of both matrices in
labels via the user-defined <code dir="auto">debugLabel()</code> function:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="328" loading="lazy" src="images/93e9c81fada46d758aae3fe1d9fe5f70.webp" width="774"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shallow copy demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 2x2 `float` matrix.
matrix&lt;float&gt; myMatrix = matrix.new&lt;float&gt;()
myMatrix.add_col(0, array.from(1.0, 3.0))
myMatrix.add_col(1, array.from(2.0, 4.0))

//@variable A shallow copy of `myMatrix`.
matrix&lt;float&gt; myCopy = myMatrix.copy()
// Add a row to the last index of `myCopy`.
myCopy.add_row(myCopy.rows(), array.from(5.0, 6.0))

if bar_index == last_bar_index - 1
    // Display the rows of both matrices in separate labels.
    myMatrix.debugLabel(note = "Original")
    myCopy.debugLabel(bar_index + 10, color.green, note = "Shallow Copy")</code></div>
<p>It’s important to note that the elements within shallow copies of a
matrix point to the same values as the original matrix. When matrices
contain special types
(<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>)
or
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>, the elements of a shallow copy reference the same objects
as the original.</p>
<p>This script declares a <code dir="auto">myMatrix</code> variable with a <code dir="auto">newLabel</code> as the
initial value. It then copies <code dir="auto">myMatrix</code> to a <code dir="auto">myCopy</code> variable via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy">myMatrix.copy()</a>
and plots the number of labels. As we see below, there’s only one
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
on the chart, as the element in <code dir="auto">myCopy</code> references the same object as
the element in <code dir="auto">myMatrix</code>. Consequently, changes to the element values
in <code dir="auto">myCopy</code> affect the values in both matrices:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="236" loading="lazy" src="images/f6a0234edc67c962539a6b6dc00b1bad.webp" width="522"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shallow copy demo")

//@variable Initial value of the original matrix elements.
var label newLabel = label.new(
     bar_index, 1, "Original", color = color.blue, textcolor = color.white, size = size.huge
 )

//@variable A 1x1 matrix containing a new `label` instance.
var matrix&lt;label&gt; myMatrix = matrix.new&lt;label&gt;(1, 1, newLabel)
//@variable A shallow copy of `myMatrix`.
var matrix&lt;label&gt; myCopy = myMatrix.copy()

//@variable The first label from the `myCopy` matrix.
label testLabel = myCopy.get(0, 0)

// Change the `text`, `style`, and `x` values of `testLabel`. Also affects the `newLabel`.
testLabel.set_text("Copy")
testLabel.set_style(label.style_label_up)
testLabel.set_x(bar_index)

// Plot the total number of labels.
plot(label.all.size(), linewidth = 3)</code></div>
<h3 class="md-heading" id="deep-copies"><a href="#deep-copies">Deep copies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One can produce a <em>deep copy</em> of a matrix (i.e., a matrix whose elements
point to copies of the original values) by explicitly copying each
object the matrix references.</p>
<p>Here, we’ve added a <code dir="auto">deepCopy()</code> user-defined method to our previous
script. The method creates a new matrix and uses
<a href="/pine-script-docs/v5/language/matrices/#for">nested for loops</a> to assign all elements to copies of the originals. When the
script calls this method instead of the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.copy">copy()</a>,
we see that there are now two labels on the chart, and any changes to
the label from <code dir="auto">myCopy</code> do not affect the one from <code dir="auto">myMatrix</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="248" loading="lazy" src="images/9b7c65f54d77d5fbdaab0bbe94f22e04.webp" width="624"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Deep copy demo")

//@function Returns a deep copy of a label matrix.
method deepCopy(matrix&lt;label&gt; this) =&gt;
    //@variable A deep copy of `this` matrix.
    matrix&lt;label&gt; that = this.copy()
    for row = 0 to that.rows() - 1
        for column = 0 to that.columns() - 1
            // Assign the element at each `row` and `column` of `that` matrix to a copy of the retrieved label.
            that.set(row, column, that.get(row, column).copy())
    that

//@variable Initial value of the original matrix.
var label newLabel = label.new(
     bar_index, 2, "Original", color = color.blue, textcolor = color.white, size = size.huge
 )

//@variable A 1x1 matrix containing a new `label` instance.
var matrix&lt;label&gt; myMatrix = matrix.new&lt;label&gt;(1, 1, newLabel)
//@variable A deep copy of `myMatrix`.
var matrix&lt;label&gt; myCopy = myMatrix.deepCopy()

//@variable The first label from the `myCopy` matrix.
label testLabel = myCopy.get(0, 0)

// Change the `text`, `style`, and `x` values of `testLabel`. Does not affect the `newLabel`.
testLabel.set_text("Copy")
testLabel.set_style(label.style_label_up)
testLabel.set_x(bar_index)

// Change the `x` value of `newLabel`.
newLabel.set_x(bar_index)

// Plot the total number of labels.
plot(label.all.size(), linewidth = 3)</code></div>
<h3 class="md-heading" id="submatrices"><a href="#submatrices">Submatrices<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In Pine, a <em>submatrix</em> is a
<a href="/pine-script-docs/v5/language/matrices/#shallow-copies">shallow copy</a> of an existing matrix that only includes the rows and
columns specified by the <code dir="auto">from_row/column</code> and <code dir="auto">to_row/column</code>
parameters. In essence, it is a sliced copy of a matrix.</p>
<p>For example, the script below creates an <code dir="auto">mSub</code> matrix from the <code dir="auto">m</code>
matrix via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix">m.submatrix()</a>
method, then calls our user-defined <code dir="auto">debugLabel()</code> function to display
the rows of both matrices in labels:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/87779f0395a2c257289abb404103aa69.webp" width="774"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Submatrix demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 3x3 matrix of values.
var m = matrix.new&lt;float&gt;()

if bar_index == last_bar_index - 1
    // Add columns to `m`.
    m.add_col(0, array.from(9, 6, 3))
    m.add_col(1, array.from(8, 5, 2))
    m.add_col(2, array.from(7, 4, 1))
    // Display the rows of `m`.
    m.debugLabel(note = "Original Matrix")

    //@variable A 2x2 submatrix of `m` containing the first two rows and columns.
    matrix&lt;float&gt; mSub = m.submatrix(from_row = 0, to_row = 2, from_column = 0, to_column = 2)
    // Display the rows of `mSub`
    debugLabel(mSub, bar_index + 10, bgColor = color.green, note = "Submatrix")</code></div>
<h2 class="md-heading" id="scope-and-history"><a href="#scope-and-history">Scope and history<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Matrix variables leave historical trails on each bar, allowing scripts
to use the history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
to interact with past matrix instances previously assigned to a
variable. Additionally, scripts can modify matrices assigned to global
variables from within the scopes of
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a>,
<a href="/pine-script-docs/v5/language/methods/">methods</a>, and
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>.</p>
<p>This script calculates the average ratios of body and wick distances
relative to the bar range over <code dir="auto">length</code> bars. It displays the data along
with values from <code dir="auto">length</code> bars ago in a table. The user-defined
<code dir="auto">addData()</code> function adds columns of current and historical ratios to
the <code dir="auto">globalMatrix</code>, and the <code dir="auto">calcAvg()</code> function references <code dir="auto">previous</code>
matrices assigned to <code dir="auto">globalMatrix</code> using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
operator to calculate a matrix of averages:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="650" loading="lazy" src="images/7f8a566038752103e0c4f7a1de5a974d.webp" width="1282"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scope and history demo", "Bar ratio comparison")

int length = input.int(10, "Length", 1)

//@variable A global matrix.
matrix&lt;float&gt; globalMatrix = matrix.new&lt;float&gt;()

//@function Calculates the ratio of body range to candle range.
bodyRatio() =&gt;
    math.abs(close - open) / (high - low)

//@function Calculates the ratio of upper wick range to candle range.
upperWickRatio() =&gt;
    (high - math.max(open, close)) / (high - low)

//@function Calculates the ratio of lower wick range to candle range.
lowerWickRatio() =&gt;
    (math.min(open, close) - low) / (high - low)

//@function Adds data to the `globalMatrix`.
addData() =&gt;
    // Add a new column of data at `column` 0.
    globalMatrix.add_col(0, array.from(bodyRatio(), upperWickRatio(), lowerWickRatio()))
    //@variable The column of `globalMatrix` from index 0 `length` bars ago.
    array&lt;float&gt; pastValues = globalMatrix.col(0)[length]
    // Add `pastValues` to the `globalMatrix`, or an array of `na` if `pastValues` is `na`.
    if na(pastValues)
        globalMatrix.add_col(1, array.new&lt;float&gt;(3))
    else
        globalMatrix.add_col(1, pastValues)

//@function Returns the `length`-bar average of matrices assigned to `globalMatrix` on historical bars.
calcAvg() =&gt;
    //@variable The sum historical `globalMatrix` matrices.
    matrix&lt;float&gt; sums = matrix.new&lt;float&gt;(globalMatrix.rows(), globalMatrix.columns(), 0.0)
    for i = 0 to length - 1
        //@variable The `globalMatrix` matrix `i` bars before the current bar.
        matrix&lt;float&gt; previous = globalMatrix[i]
        // Break the loop if `previous` is `na`.
        if na(previous)
            sums.fill(na)
            break
        // Assign the sum of `sums` and `previous` to `sums`.
        sums := matrix.sum(sums, previous)
    // Divide the `sums` matrix by the `length`.
    result = sums.mult(1.0 / length)

// Add data to the `globalMatrix`.
addData()

//@variable The historical average of the `globalMatrix` matrices.
globalAvg = calcAvg()

//@variable A `table` displaying information from the `globalMatrix`.
var table infoTable = table.new(
     position.middle_center, globalMatrix.columns() + 1, globalMatrix.rows() + 1, bgcolor = color.navy
 )

// Define value cells.
for [i, row] in globalAvg
    for [j, value] in row
        color textColor = value &gt; 0.333 ? color.orange : color.gray
        infoTable.cell(j + 1, i + 1, str.tostring(value), text_color = textColor, text_size = size.huge)

// Define header cells.
infoTable.cell(0, 1, "Body ratio", text_color = color.white, text_size = size.huge)
infoTable.cell(0, 2, "Upper wick ratio", text_color = color.white, text_size = size.huge)
infoTable.cell(0, 3, "Lower wick ratio", text_color = color.white, text_size = size.huge)
infoTable.cell(1, 0, "Current average", text_color = color.white, text_size = size.huge)
infoTable.cell(2, 0, str.format("{0} bars ago", length), text_color = color.white, text_size = size.huge)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">addData()</code> and <code dir="auto">calcAvg()</code> functions have no parameters, as
they directly interact with the <code dir="auto">globalMatrix</code> and <code dir="auto">length</code>
variables declared in the outer scope.</li>
<li><code dir="auto">calcAvg()</code> calculates the average by adding <code dir="auto">previous</code> matrices
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum">matrix.sum()</a>
and multiplying all elements by <code dir="auto">1 / length</code> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>.
We discuss these and other specialized functions in our
<a href="/pine-script-docs/v5/language/matrices/#matrix-calculations">Matrix calculations</a> section below.</li>
</ul>
<h2 class="md-heading" id="inspecting-a-matrix"><a href="#inspecting-a-matrix">Inspecting a matrix<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The ability to inspect the shape of a matrix and patterns within its
elements is crucial, as it helps reveal important information about a
matrix and its compatibility with various calculations and
transformations. Pine Script™ includes several built-ins for matrix
inspection, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square">matrix.is_square()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_identity">matrix.is_identity()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_diagonal">matrix.is_diagonal()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antidiagonal">matrix.is_antidiagonal()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_symmetric">matrix.is_symmetric()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antisymmetric">matrix.is_antisymmetric()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_triangular">matrix.is_triangular()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_stochastic">matrix.is_stochastic()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_binary">matrix.is_binary()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_zero">matrix.is_zero()</a>.</p>
<p>To demonstrate these features, this example contains a custom
<code dir="auto">inspect()</code> method that uses conditional blocks with <code dir="auto">matrix.is_*()</code>
functions to return information about a matrix. It displays a string
representation of an <code dir="auto">m</code> matrix and the description returned from
<code dir="auto">m.inspect()</code> in labels on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="424" loading="lazy" src="images/c83b4af9412d3782a69fd101447c6860.webp" width="1196"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix inspection demo")

//@function Inspects a matrix using `matrix.is_*()` functions and returns a `string` describing some of its features.
method inspect(matrix&lt;int&gt; this)=&gt;
    //@variable A string describing `this` matrix.
    string result = "This matrix:\n"
    if this.is_square()
        result += "- Has an equal number of rows and columns.\n"
    if this.is_binary()
        result += "- Contains only 1s and 0s.\n"
    if this.is_zero()
        result += "- Is filled with 0s.\n"
    if this.is_triangular()
        result += "- Contains only 0s above and/or below its main diagonal.\n"
    if this.is_diagonal()
        result += "- Only has nonzero values in its main diagonal.\n"
    if this.is_antidiagonal()
        result += "- Only has nonzero values in its main antidiagonal.\n"
    if this.is_symmetric()
        result += "- Equals its transpose.\n"
    if this.is_antisymmetric()
        result += "- Equals the negative of its transpose.\n"
    if this.is_identity()
        result += "- Is the identity matrix.\n"
    result

//@variable A 4x4 identity matrix.
matrix&lt;int&gt; m = matrix.new&lt;int&gt;()

// Add rows to the matrix.
m.add_row(0, array.from(1, 0, 0, 0))
m.add_row(1, array.from(0, 1, 0, 0))
m.add_row(2, array.from(0, 0, 1, 0))
m.add_row(3, array.from(0, 0, 0, 1))

if bar_index == last_bar_index - 1
    // Display the `m` matrix in a blue label.
    label.new(
         bar_index, 0, str.tostring(m), color = color.blue, style = label.style_label_right,
         textcolor = color.white, size = size.huge
     )
    // Display the result of `m.inspect()` in a purple label.
    label.new(
         bar_index, 0, m.inspect(), color = color.purple, style = label.style_label_left,
         textcolor = color.white, size = size.huge
     )</code></div>
<h2 class="md-heading" id="manipulating-a-matrix"><a href="#manipulating-a-matrix">Manipulating a matrix<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="reshaping"><a href="#reshaping">Reshaping<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The shape of a matrix can determine its compatibility with various
matrix operations. In some cases, it is necessary to change the
dimensions of a matrix without affecting the number of elements or the
values they reference, otherwise known as <em>reshaping</em>. To reshape a
matrix in Pine, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape">matrix.reshape()</a>
function.</p>
<p>This example demonstrates the results of multiple reshaping operations
on a matrix. The initial <code dir="auto">m</code> matrix has a 1x8 shape (one row and eight
columns). Through successive calls to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape">m.reshape()</a>
method, the script changes the shape of <code dir="auto">m</code> to 2x4, 4x2, and 8x1. It
displays each reshaped matrix in a label on the chart using the custom
<code dir="auto">debugLabel()</code> method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="430" loading="lazy" src="images/2b84280e0072b61dd531991bdcf034d6.webp" width="1206"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reshaping example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A matrix containing the values 1-8.
matrix&lt;int&gt; m = matrix.new&lt;int&gt;()

if bar_index == last_bar_index - 1
    // Add the initial vector of values.
    m.add_row(0, array.from(1, 2, 3, 4, 5, 6, 7, 8))
    m.debugLabel(note = "Initial 1x8 matrix")

    // Reshape. `m` now has 2 rows and 4 columns.
    m.reshape(2, 4)
    m.debugLabel(bar_index + 10, note = "Reshaped to 2x4")

    // Reshape. `m` now has 4 rows and 2 columns.
    m.reshape(4, 2)
    m.debugLabel(bar_index + 20, note = "Reshaped to 4x2")

    // Reshape. `m` now has 8 rows and 1 column.
    m.reshape(8, 1)
    m.debugLabel(bar_index + 30, note = "Reshaped to 8x1")</code></div>
<p>Note that:</p>
<ul>
<li>The order of elements in <code dir="auto">m</code> does not change with each
<code dir="auto">m.reshape()</code> call.</li>
<li>When reshaping a matrix, the product of the <code dir="auto">rows</code> and <code dir="auto">columns</code>
arguments must equal the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count">matrix.elements_count()</a>
value, as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reshape">matrix.reshape()</a>
cannot change the number of elements in a matrix.</li>
</ul>
<h3 class="md-heading" id="reversing"><a href="#reversing">Reversing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One can reverse the order of all elements in a matrix using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reverse">matrix.reverse()</a>.
This function moves the references of an m-by-n matrix <code dir="auto">id</code> at the i-th
row and j-th column to the m - 1 - i row and n - 1 - j column.</p>
<p>For example, this script creates a 3x3 matrix containing the values 1-9
in ascending order, then uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.reverse">reverse()</a>
method to reverse its contents. It displays the original and modified
versions of the matrix in labels on the chart via <code dir="auto">m.debugLabel()</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="242" loading="lazy" src="images/ec599dd5e4ba3566be16ac6b73d252e2.webp" width="634"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reversing demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 3x3 matrix.
matrix&lt;float&gt; m = matrix.new&lt;float&gt;()

// Add rows to `m`.
m.add_row(0, array.from(1, 2, 3))
m.add_row(1, array.from(4, 5, 6))
m.add_row(2, array.from(7, 8, 9))

if bar_index == last_bar_index - 1
    // Display the contents of `m`.
    m.debugLabel(note = "Original")
    // Reverse `m`, then display its contents.
    m.reverse()
    m.debugLabel(bar_index + 10, color.red, note = "Reversed")</code></div>
<h3 class="md-heading" id="transposing"><a href="#transposing">Transposing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Transposing a matrix is a fundamental operation that flips all rows and
columns in a matrix about its <em>main diagonal</em> (the diagonal vector of
all values in which the row index equals the column index). This process
produces a new matrix with reversed row and column dimensions, known as
the <em>transpose</em>. Scripts can calculate the transpose of a matrix using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">matrix.transpose()</a>.</p>
<p>For any m-row, n-column matrix, the matrix returned from
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">matrix.transpose()</a>
will have n rows and m columns. All elements in a matrix at the i-th row
and j-th column correspond to the elements in its transpose at the j-th
row and i-th column.</p>
<p>This example declares a 2x4 <code dir="auto">m</code> matrix, calculates its transpose using
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">m.transpose()</a>
method, and displays both matrices on the chart using our custom
<code dir="auto">debugLabel()</code> method. As we can see below, the transposed matrix has a
4x2 shape, and the rows of the transpose match the columns of the
original:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="294" loading="lazy" src="images/49355da4713bab63c07dcb5c220aadec.webp" width="744"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Transpose example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 2x4 matrix.
matrix&lt;int&gt; m = matrix.new&lt;int&gt;()

// Add columns to `m`.
m.add_col(0, array.from(1, 5))
m.add_col(1, array.from(2, 6))
m.add_col(2, array.from(3, 7))
m.add_col(3, array.from(4, 8))

//@variable The transpose of `m`. Has a 4x2 shape.
matrix&lt;int&gt; mt = m.transpose()

if bar_index == last_bar_index - 1
    m.debugLabel(note = "Original")
    mt.debugLabel(bar_index + 10, note = "Transpose")</code></div>
<h3 class="md-heading" id="sorting"><a href="#sorting">Sorting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can sort the contents of a matrix via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort">matrix.sort()</a>.
Unlike
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sort">array.sort()</a>,
which sorts <em>elements</em>, this function organizes all <em>rows</em> in a matrix
in a specified <code dir="auto">order</code>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_order.ascending">order.ascending</a>
by default) based on the values in a specified <code dir="auto">column</code>.</p>
<p>This script declares a 3x3 <code dir="auto">m</code> matrix, sorts the rows of the <code dir="auto">m1</code> copy
in ascending order based on the first column, then sorts the rows of the
<code dir="auto">m2</code> copy in descending order based on the second column. It displays
the original matrix and sorted copies in labels using our <code dir="auto">debugLabel()</code>
method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="320" loading="lazy" src="images/0947b54fdabb02617f3c7dc5fd5687b9.webp" width="892"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Sorting rows example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 3x3 matrix.
matrix&lt;int&gt; m = matrix.new&lt;int&gt;()

if bar_index == last_bar_index - 1
    // Add rows to `m`.
    m.add_row(0, array.from(3, 2, 4))
    m.add_row(1, array.from(1, 9, 6))
    m.add_row(2, array.from(7, 8, 9))
    m.debugLabel(note = "Original")

    // Copy `m` and sort rows in ascending order based on the first column (default).
    matrix&lt;int&gt; m1 = m.copy()
    m1.sort()
    m1.debugLabel(bar_index + 10, color.green, note = "Sorted using col 0\n(Ascending)")

    // Copy `m` and sort rows in descending order based on the second column.
    matrix&lt;int&gt; m2 = m.copy()
    m2.sort(1, order.descending)
    m2.debugLabel(bar_index + 20, color.red, note = "Sorted using col 1\n(Descending)")</code></div>
<p>It’s important to note that
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort">matrix.sort()</a>
does not sort the columns of a matrix. However, one <em>can</em> use this
function to sort matrix columns with the help of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">matrix.transpose()</a>.</p>
<p>As an example, this script contains a <code dir="auto">sortColumns()</code> method that uses
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sort">sort()</a>
method to sort the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">transpose</a>
of a matrix using the column corresponding to the <code dir="auto">row</code> of the original
matrix. The script uses this method to sort the <code dir="auto">m</code> matrix based on the
contents of its first row:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="316" loading="lazy" src="images/fe51fee9f2f7dfb00c1aaf80ace86b47.webp" width="826"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Sorting columns example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@function Sorts the columns of `this` matrix based on the values in the specified `row`.
method sortColumns(matrix&lt;int&gt; this, int row = 0, bool ascending = true) =&gt;
    //@variable The transpose of `this` matrix.
    matrix&lt;int&gt; thisT = this.transpose()
    //@variable Is `order.ascending` when `ascending` is `true`, `order.descending` otherwise.
    order = ascending ? order.ascending : order.descending
    // Sort the rows of `thisT` using the `row` column.
    thisT.sort(row, order)
    //@variable A copy of `this` matrix with sorted columns.
    result = thisT.transpose()

//@variable A 3x3 matrix.
matrix&lt;int&gt; m = matrix.new&lt;int&gt;()

if bar_index == last_bar_index - 1
    // Add rows to `m`.
    m.add_row(0, array.from(3, 2, 4))
    m.add_row(1, array.from(1, 9, 6))
    m.add_row(2, array.from(7, 8, 9))
    m.debugLabel(note = "Original")

    // Sort the columns of `m` based on the first row and display the result.
    m.sortColumns(0).debugLabel(bar_index + 10, note = "Sorted using row 0\n(Ascending)")</code></div>
<h3 class="md-heading" id="concatenating"><a href="#concatenating">Concatenating<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can <em>concatenate</em> two matrices using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.concat">matrix.concat()</a>.
This function appends the rows of an <code dir="auto">id2</code> matrix to the end of an <code dir="auto">id1</code>
matrix with the same number of columns.</p>
<p>To create a matrix with elements representing the <em>columns</em> of a matrix
appended to another,
<a href="/pine-script-docs/v5/language/matrices/#transposing">transpose</a> both matrices, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.concat">matrix.concat()</a>
on the transposed matrices, then
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">transpose()</a>
the result.</p>
<p>For example, this script appends the rows of the <code dir="auto">m2</code> matrix to the <code dir="auto">m1</code>
matrix and appends their columns using <em>transposed copies</em> of the
matrices. It displays the <code dir="auto">m1</code> and <code dir="auto">m2</code> matrices and the results after
concatenating their rows and columns in labels using the custom
<code dir="auto">debugLabel()</code> method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="366" loading="lazy" src="images/1ed417d38182cb877654d46ecec99fb3.webp" width="1222"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Concatenation demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 2x3 matrix filled with 1s.
matrix&lt;int&gt; m1 = matrix.new&lt;int&gt;(2, 3, 1)
//@variable A 2x3 matrix filled with 2s.
matrix&lt;int&gt; m2 = matrix.new&lt;int&gt;(2, 3, 2)

//@variable The transpose of `m1`.
t1 = m1.transpose()
//@variable The transpose of `m2`.
t2 = m2.transpose()

if bar_index == last_bar_index - 1
    // Display the original matrices.
    m1.debugLabel(note = "Matrix 1")
    m2.debugLabel(bar_index + 10, note = "Matrix 2")
    // Append the rows of `m2` to the end of `m1` and display `m1`.
    m1.concat(m2)
    m1.debugLabel(bar_index + 20, color.blue, note = "Appended rows")
    // Append the rows of `t2` to the end of `t1`, then display the transpose of `t1.
    t1.concat(t2)
    t1.transpose().debugLabel(bar_index + 30, color.purple, note = "Appended columns")</code></div>
<h2 class="md-heading" id="matrix-calculations"><a href="#matrix-calculations">Matrix calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="element-wise-calculations"><a href="#element-wise-calculations">Element-wise calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine scripts can calculate the <em>average</em>, <em>minimum</em>, <em>maximum</em>, and
<em>mode</em> of all elements within a matrix via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg">matrix.avg()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.min">matrix.min()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.max">matrix.max()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mode">matrix.mode()</a>.
These functions operate the same as their <code dir="auto">array.*</code> equivalents,
allowing users to run element-wise calculations on a matrix, its
<a href="/pine-script-docs/v5/language/matrices/#submatrices">submatrices</a>, and its
<a href="/pine-script-docs/v5/language/matrices/#rows-and-columns">rows and columns</a> using the same syntax. For example, the built-in <code dir="auto">*.avg()</code>
functions called on a 3x3 matrix with values 1-9 and an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
with the same nine elements will both return a value of 5.</p>
<p>The script below uses <code dir="auto">*.avg()</code>, <code dir="auto">*.max()</code>, and <code dir="auto">*.min()</code> methods to
calculate developing averages and extremes of OHLC data in a period. It
adds a new column of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values to the end of the <code dir="auto">ohlcData</code> matrix whenever <code dir="auto">queueColumn</code> is
<code dir="auto">true</code>. When <code dir="auto">false</code>, the script uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">get()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">set()</a>
matrix methods to adjust the elements in the last column for developing
HLC values in the current period. It uses the <code dir="auto">ohlcData</code> matrix, a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix">submatrix()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.row">row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.col">col()</a>
arrays to calculate the developing OHLC4 and HL2 averages over <code dir="auto">length</code>
periods, the maximum high and minimum low over <code dir="auto">length</code> periods, and the
current period’s developing OHLC4 price:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="678" loading="lazy" src="images/4448a60890ad574b3aaa4f21117ffa50.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Element-wise calculations example", "Developing values", overlay = true)

//@variable The number of data points in the averages.
int length = input.int(3, "Length", 1)
//@variable The timeframe of each reset period.
string timeframe = input.timeframe("D", "Reset Timeframe")

//@variable A 4x`length` matrix of OHLC values.
var matrix&lt;float&gt; ohlcData = matrix.new&lt;float&gt;(4, length)

//@variable Is `true` at the start of a new bar at the `timeframe`.
bool queueColumn = timeframe.change(timeframe)

if queueColumn
    // Add new values to the end column of `ohlcData`.
    ohlcData.add_col(length, array.from(open, high, low, close))
    // Remove the oldest column from `ohlcData`.
    ohlcData.remove_col(0)
else
    // Adjust the last element of column 1 for new highs.
    if high &gt; ohlcData.get(1, length - 1)
        ohlcData.set(1, length - 1, high)
    // Adjust the last element of column 2 for new lows.
    if low &lt; ohlcData.get(2, length - 1)
        ohlcData.set(2, length - 1, low)
    // Adjust the last element of column 3 for the new closing price.
    ohlcData.set(3, length - 1, close)

//@variable The `matrix.avg()` of all elements in `ohlcData`.
avgOHLC4 = ohlcData.avg()
//@variable The `matrix.avg()` of all elements in rows 1 and 2, i.e., the average of all `high` and `low` values.
avgHL2   = ohlcData.submatrix(from_row = 1, to_row = 3).avg()
//@variable The `matrix.max()` of all values in `ohlcData`. Equivalent to `ohlcData.row(1).max()`.
maxHigh = ohlcData.max()
//@variable The `array.min()` of all `low` values in `ohlcData`. Equivalent to `ohlcData.min()`.
minLow = ohlcData.row(2).min()
//@variable The `array.avg()` of the last column in `ohlcData`, i.e., the current OHLC4.
ohlc4Value = ohlcData.col(length - 1).avg()

plot(avgOHLC4, "Average OHLC4", color.purple, 2)
plot(avgHL2, "Average HL2", color.navy, 2)
plot(maxHigh, "Max High", color.green)
plot(minLow, "Min Low", color.red)
plot(ohlc4Value, "Current OHLC4", color.blue)</code></div>
<p>Note that:</p>
<ul>
<li>In this example, we used
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array.*()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix.*()</a>
methods interchangeably to demonstrate their similarities in
syntax and behavior.</li>
<li>Users can calculate the matrix equivalent of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.sum">array.sum()</a>
by multiplying the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg">matrix.avg()</a>
by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count">matrix.elements_count()</a>.</li>
</ul>
<h3 class="md-heading" id="special-calculations"><a href="#special-calculations">Special calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™ features several built-in functions for performing
essential matrix arithmetic and linear algebra operations, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum">matrix.sum()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff">matrix.diff()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pow">matrix.pow()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det">matrix.det()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">matrix.inv()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv">matrix.pinv()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank">matrix.rank()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.trace">matrix.trace()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvalues">matrix.eigenvalues()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvectors">matrix.eigenvectors()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.kron">matrix.kron()</a>.
These functions are advanced features that facilitate a variety of
matrix calculations and transformations.</p>
<p>Below, we explain a few fundamental functions with some basic examples.</p>
<h4 class="md-heading" id="matrixsum-and-matrixdiff"><a href="#matrixsum-and-matrixdiff">`matrix.sum()` and `matrix.diff()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Scripts can perform addition and subtraction of two matrices with the
same shape or a matrix and a scalar value using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum">matrix.sum()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff">matrix.diff()</a>
functions. These functions use the values from the <code dir="auto">id2</code> matrix or
scalar to add to or subtract from the elements in <code dir="auto">id1</code>.</p>
<p>This script demonstrates a simple example of matrix addition and
subtraction in Pine. It creates a 3x3 matrix, calculates its
<a href="/pine-script-docs/v5/language/matrices/#transposing">transpose</a>, then calculates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum">matrix.sum()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.diff">matrix.diff()</a>
of the two matrices. This example displays the original matrix, its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">transpose</a>,
and the resulting sum and difference matrices in labels on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="332" loading="lazy" src="images/f2e01b79c6d4a72e00cad32ef9459f78.webp" width="1056"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix sum and diff example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 3x3 matrix.
m = matrix.new&lt;float&gt;()

// Add rows to `m`.
m.add_row(0, array.from(0.5, 1.0, 1.5))
m.add_row(1, array.from(2.0, 2.5, 3.0))
m.add_row(2, array.from(3.5, 4.0, 4.5))

if bar_index == last_bar_index - 1
    // Display `m`.
    m.debugLabel(note = "A")
    // Get and display the transpose of `m`.
    matrix&lt;float&gt; t = m.transpose()
    t.debugLabel(bar_index + 10, note = "Aᵀ")
    // Calculate the sum of the two matrices. The resulting matrix is symmetric.
    matrix.sum(m, t).debugLabel(bar_index + 20, color.green, note = "A + Aᵀ")
    // Calculate the difference between the two matrices. The resulting matrix is antisymmetric.
    matrix.diff(m, t).debugLabel(bar_index + 30, color.red, note = "A - Aᵀ")</code></div>
<p>Note that:</p>
<ul>
<li>In this example, we’ve labeled the original matrix as “A” and
the transpose as “Aᵀ”.</li>
<li>Adding “A” and “Aᵀ” produces a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_symmetric">symmetric</a>
matrix, and subtracting them produces an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_antisymmetric">antisymmetric</a>
matrix.</li>
</ul>
<h4 class="md-heading" id="matrixmult"><a href="#matrixmult">`matrix.mult()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Scripts can multiply two matrices via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>
function. This function also facilitates the multiplication of a matrix
by an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
or a scalar value.</p>
<p>In the case of multiplying two matrices, unlike addition and
subtraction, matrix multiplication does not require two matrices to
share the same shape. However, the number of columns in the first matrix
must equal the number of rows in the second one. The resulting matrix
returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>
will contain the same number of rows as <code dir="auto">id1</code> and the same number of
columns as <code dir="auto">id2</code>. For instance, a 2x3 matrix multiplied by a 3x4 matrix
will produce a matrix with two rows and four columns, as shown below.
Each value within the resulting matrix is the <a href="https://en.wikipedia.org/wiki/Dot_product" rel="nofollow">dot
product</a> of the corresponding
row in <code dir="auto">id1</code> and column in <code dir="auto">id2</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="338" loading="lazy" src="images/a4664b7633edca19bd6aa6bbf2902ce2.webp" width="1010"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix mult example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 2x3 matrix.
a = matrix.new&lt;float&gt;()
//@variable A 3x4 matrix.
b = matrix.new&lt;float&gt;()

// Add rows to `a`.
a.add_row(0, array.from(1, 2, 3))
a.add_row(1, array.from(4, 5, 6))

// Add rows to `b`.
b.add_row(0, array.from(0.5, 1.0, 1.5, 2.0))
b.add_row(1, array.from(2.5, 3.0, 3.5, 4.0))
b.add_row(0, array.from(4.5, 5.0, 5.5, 6.0))

if bar_index == last_bar_index - 1
    //@variable The result of `a` * `b`.
    matrix&lt;float&gt; ab = a.mult(b)
    // Display `a`, `b`, and `ab` matrices.
    debugLabel(a, note = "A")
    debugLabel(b, bar_index + 10, note = "B")
    debugLabel(ab, bar_index + 20, color.green, note = "A * B")</code></div>
<p>Note that:</p>
<ul>
<li>In contrast to the multiplication of scalars, matrix
multiplication is <em>non-commutative</em>, i.e., <code dir="auto">matrix.mult(a, b)</code>
does not necessarily produce the same result as
<code dir="auto">matrix.mult(b, a)</code>. In the context of our example, the latter
will raise a runtime error because the number of columns in <code dir="auto">b</code>
doesn’t equal the number of rows in <code dir="auto">a</code>.</li>
</ul>
<p>When multiplying a matrix and an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
this function treats the operation the same as multiplying <code dir="auto">id1</code> by a
single-column matrix, but it returns an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
with the same number of elements as the number of rows in <code dir="auto">id1</code>. When
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>
passes a scalar as its <code dir="auto">id2</code> value, the function returns a new matrix
whose elements are the elements in <code dir="auto">id1</code> multiplied by the <code dir="auto">id2</code> value.</p>
<h4 class="md-heading" id="matrixdet"><a href="#matrixdet">`matrix.det()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>A <em>determinant</em> is a scalar value associated with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square">square</a>
matrix that describes some of its characteristics, namely its
invertibility. If a matrix has an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">inverse</a>,
its determinant is nonzero. Otherwise, the matrix is <em>singular</em>
(non-invertible). Scripts can calculate the determinant of a matrix via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det">matrix.det()</a>.</p>
<p>Programmers can use determinants to detect similarities between
matrices, identify <em>full-rank</em> and <em>rank-deficient</em> matrices, and solve
systems of linear equations, among other applications.</p>
<p>For example, this script utilizes determinants to solve a system of
linear equations with a matching number of unknown values using
<a href="https://en.wikipedia.org/wiki/Cramer's_rule" rel="nofollow">Cramer’s rule</a>. The
user-defined <code dir="auto">solve()</code> function returns an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing solutions for each unknown value in the system, where the
n-th element of the array is the determinant of the coefficient matrix
with the n-th column replaced by the column of constants divided by the
determinant of the original coefficients.</p>
<p>In this script, we’ve defined the matrix <code dir="auto">m</code> that holds coefficients
and constants for these three equations:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">3 * x0 + 4 * x1 - 1 * x2 = 8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">5 * x0 - 2 * x1 + 1 * x2 = 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">2 * x0 - 2 * x1 + 1 * x2 = 1</span></div></div></code></pre></figure></div>
<p>The solution to this system is <code dir="auto">(x0 = 1, x1 = 2, x2 = 3)</code>. The script
calculates these values from <code dir="auto">m</code> via <code dir="auto">m.solve()</code> and plots them on the
chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="344" loading="lazy" src="images/120dcaaf7449a8cd4551fb8f4cec9a47.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Determinants example", "Cramer's Rule")

//@function Solves a system of linear equations with a matching number of unknowns using Cramer's rule.
//@param    this An augmented matrix containing the coefficients for each unknown and the results of
//          the equations. For example, a row containing the values 2, -1, and 3 represents the equation
//          `2 * x0 + (-1) * x1 = 3`, where `x0` and `x1` are the unknown values in the system.
//@returns  An array containing solutions for each variable in the system.
solve(matrix&lt;float&gt; this) =&gt;
    //@variable The coefficient matrix for the system of equations.
    matrix&lt;float&gt; coefficients = this.submatrix(from_column = 0, to_column = this.columns() - 1)
    //@variable The array of resulting constants for each equation.
    array&lt;float&gt; constants = this.col(this.columns() - 1)
    //@variable An array containing solutions for each unknown in the system.
    array&lt;float&gt; result = array.new&lt;float&gt;()

    //@variable The determinant value of the coefficient matrix.
    float baseDet = coefficients.det()
    matrix&lt;float&gt; modified = na
    for col = 0 to coefficients.columns() - 1        
        modified := coefficients.copy()
        modified.add_col(col, constants)
        modified.remove_col(col + 1)

        // Calculate the solution for the column's unknown by dividing the determinant of `modified` by the `baseDet`.
        result.push(modified.det() / baseDet)

    result

//@variable A 3x4 matrix containing coefficients and results for a system of three equations.
m = matrix.new&lt;float&gt;()

// Add rows for the following equations:
// Equation 1: 3 * x0 + 4 * x1 - 1 * x2 = 8
// Equation 2: 5 * x0 - 2 * x1 + 1 * x2 = 4
// Equation 3: 2 * x0 - 2 * x1 + 1 * x2 = 1
m.add_row(0, array.from(3.0, 4.0, -1.0, 8.0))
m.add_row(1, array.from(5.0, -2.0, 1.0, 4.0))
m.add_row(2, array.from(2.0, -2.0, 1.0, 1.0))

//@variable An array of solutions to the unknowns in the system of equations represented by `m`.
solutions = solve(m)

plot(solutions.get(0), "x0", color.red, 3)   // Plots 1.
plot(solutions.get(1), "x1", color.green, 3) // Plots 2.
plot(solutions.get(2), "x2", color.blue, 3)  // Plots 3.</code></div>
<p>Note that:</p>
<ul>
<li>Solving systems of equations is particularly useful for
<em>regression analysis</em>, e.g., linear and polynomial regression.</li>
<li>Cramer’s rule works fine for small systems of equations.
However, it’s computationally inefficient on larger systems.
Other methods, such as <a href="https://en.wikipedia.org/wiki/Gaussian_elimination" rel="nofollow">Gaussian
elimination</a>,
are often preferred for such use cases.</li>
</ul>
<h4 class="md-heading" id="matrixinv-and-matrixpinv"><a href="#matrixinv-and-matrixpinv">`matrix.inv()` and `matrix.pinv()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>For any non-singular
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square">square</a>
matrix, there is an inverse matrix that yields the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_identity">identity</a>
matrix when
<a href="/pine-script-docs/v5/language/matrices/#matrixmult">multiplied</a> by the original. Inverses have utility in various matrix
transformations and solving systems of equations. Scripts can calculate
the inverse of a matrix <strong>when one exists</strong> via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">matrix.inv()</a>
function.</p>
<p>For singular (non-invertible) matrices, one can calculate a generalized
inverse
(<a href="https://en.wikipedia.org/wiki/Moore%E2%80%93Penrose_inverse" rel="nofollow">pseudoinverse</a>),
regardless of whether the matrix is square or has a nonzero
<code dir="auto">determinant &lt;_PageMatrices_MatrixCalculations_SpecialCalculations_MatrixDet&gt;</code>, via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv">matrix.pinv()</a>
function. Keep in mind that unlike a true inverse, the product of a
pseudoinverse and the original matrix does not necessarily equal the
identity matrix unless the original matrix <em>is invertible</em>.</p>
<p>The following example forms a 2x2 <code dir="auto">m</code> matrix from user inputs, then uses
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">m.inv()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv">m.pinv()</a>
methods to calculate the inverse or pseudoinverse of <code dir="auto">m</code>. The script
displays the original matrix, its inverse or pseudoinverse, and their
product in labels on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="314" loading="lazy" src="images/8b5e0bd03df31b632e5824303cfe86fc.webp" width="844"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inverse example")

// Element inputs for the 2x2 matrix.
float r0c0 = input.float(4.0, "Row 0, Col 0")
float r0c1 = input.float(3.0, "Row 0, Col 1")
float r1c0 = input.float(2.0, "Row 1, Col 0")
float r1c1 = input.float(1.0, "Row 1, Col 1")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix&lt;float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 2x2 matrix of input values.
m = matrix.new&lt;float&gt;()

// Add input values to `m`.
m.add_row(0, array.from(r0c0, r0c1))
m.add_row(1, array.from(r1c0, r1c1))

//@variable Is `true` if `m` is square with a nonzero determinant, indicating invertibility.
bool isInvertible = m.is_square() and m.det()

//@variable The inverse or pseudoinverse of `m`.
mInverse = isInvertible ? m.inv() : m.pinv()

//@variable The product of `m` and `mInverse`. Returns the identity matrix when `isInvertible` is `true`.
matrix&lt;float&gt; product = m.mult(mInverse)

if bar_index == last_bar_index - 1
    // Display `m`, `mInverse`, and their `product`.
    m.debugLabel(note = "Original")
    mInverse.debugLabel(bar_index + 10, color.purple, note = isInvertible ? "Inverse" : "Pseudoinverse")
    product.debugLabel(bar_index + 20, color.green, note = "Product")</code></div>
<p>Note that:</p>
<ul>
<li>This script will only call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">m.inv()</a>
when <code dir="auto">isInvertible</code> is <code dir="auto">true</code>, i.e., when <code dir="auto">m</code> is
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.is_square">square</a>
and has a nonzero
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det">determinant</a>.
Otherwise, it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.pinv">m.pinv()</a>
to calculate the generalized inverse.</li>
</ul>
<h4 class="md-heading" id="matrixrank"><a href="#matrixrank">`matrix.rank()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <em>rank</em> of a matrix represents the number of linearly independent
vectors (rows or columns) it contains. In essence, matrix rank measures
the number of vectors one cannot express as a linear combination of
others, or in other words, the number of vectors that contain <strong>unique</strong>
information. Scripts can calculate the rank of a matrix via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank">matrix.rank()</a>.</p>
<p>This script identifies the number of linearly independent vectors in two
3x3 matrices (<code dir="auto">m1</code> and <code dir="auto">m2</code>) and plots the values in a separate pane. As
we see on the chart, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank">m1.rank()</a>
value is 3 because each vector is unique. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rank">m2.rank()</a>
value, on the other hand, is 1 because it has just one unique vector:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="338" loading="lazy" src="images/28d179e81c4cc8177b2938b1e3205c23.webp" width="952"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix rank example")

//@variable A 3x3 full-rank matrix.
m1 = matrix.new&lt;float&gt;()
//@variable A 3x3 rank-deficient matrix.
m2 = matrix.new&lt;float&gt;()

// Add linearly independent vectors to `m1`.
m1.add_row(0, array.from(3, 2, 3))
m1.add_row(1, array.from(4, 6, 6))
m1.add_row(2, array.from(7, 4, 9))

// Add linearly dependent vectors to `m2`.
m2.add_row(0, array.from(1, 2, 3))
m2.add_row(1, array.from(2, 4, 6))
m2.add_row(2, array.from(3, 6, 9))

// Plot `matrix.rank()` values.
plot(m1.rank(), color = color.green, linewidth = 3)
plot(m2.rank(), color = color.red, linewidth = 3)</code></div>
<p>Note that:</p>
<ul>
<li>The highest rank value a matrix can have is the minimum of its
number of rows and columns. A matrix with the maximum possible
rank is known as a <em>full-rank</em> matrix, and any matrix without
full rank is known as a <em>rank-deficient</em> matrix.</li>
<li>The
<a href="/pine-script-docs/v5/language/matrices/#matrixdet">determinants</a> of full-rank square matrices are nonzero, and such
matrices have
<a href="/pine-script-docs/v5/language/matrices/#matrixinv-and-matrixpinv">inverses</a>. Conversely, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det">determinant</a>
of a rank-deficient matrix is always 0.</li>
<li>For any matrix that contains nothing but the same value in each
of its elements (e.g., a matrix filled with 0), the rank is
always 0 since none of the vectors hold unique information. For
any other matrix with distinct values, the minimum possible rank
is 1.</li>
</ul>
<h2 class="md-heading" id="error-handling"><a href="#error-handling">Error handling<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In addition to usual <strong>compiler</strong> errors, which occur during a script’s
compilation due to improper syntax, scripts using matrices can raise
specific <strong>runtime</strong> errors during their execution. When a script raises
a runtime error, it displays a red exclamation point next to the script
title. Users can view the error message by clicking this icon.</p>
<p>In this section, we discuss runtime errors that users may encounter
while utilizing matrices in their scripts.</p>
<h3 class="md-heading" id="the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy"><a href="#the-rowcolumn-index-xx-is-out-of-bounds-rowcolumn-size-is-yy">The row/column index (xx) is out of bounds, row/column size is (yy).<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This runtime error occurs when trying to access indices outside the
matrix dimensions with functions including
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.get">matrix.get()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">matrix.set()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.fill">matrix.fill()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix">matrix.submatrix()</a>,
as well as some of the functions relating to the
<a href="/pine-script-docs/v5/language/matrices/#rows-and-columns">rows and columns</a> of a matrix.</p>
<p>For example, this code contains two lines that will produce this runtime
error. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.set">m.set()</a>
method references a <code dir="auto">row</code> index that doesn’t exist (2). The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.submatrix">m.submatrix()</a>
method references all column indices up to <code dir="auto">to_column - 1</code>. A
<code dir="auto">to_column</code> value of 4 results in a runtime error because the last
column index referenced (3) does not exist in <code dir="auto">m</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Out of bounds demo")

//@variable A 2x3 matrix with a max row index of 1 and max column index of 2. 
matrix&lt;float&gt; m = matrix.new&lt;float&gt;(2, 3, 0.0)

m.set(row = 2, column = 0, value = 1.0)     // The `row` index is out of bounds on this line. The max value is 1.
m.submatrix(from_column = 1, to_column = 4) // The `to_column` index is invalid on this line. The max value is 3.

if bar_index == last_bar_index - 1
    label.new(bar_index, 0, str.tostring(m), color = color.navy, textcolor = color.white, size = size.huge)</code></div>
<p>Users can avoid this error in their scripts by ensuring their function
calls do not reference indices greater than or equal to the number of
rows/columns.</p>
<h3 class="md-heading" id="the-array-size-does-not-match-the-number-of-rowscolumns-in-the-matrix"><a href="#the-array-size-does-not-match-the-number-of-rowscolumns-in-the-matrix">The array size does not match the number of rows/columns in the matrix.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_row">matrix.add_row()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.add_col">matrix.add_col()</a>
functions to
<a href="/pine-script-docs/v5/language/matrices/#inserting">insert</a> rows and columns into a non-empty matrix, the size of the
inserted array must align with the matrix dimensions. The size of an
inserted row must match the number of columns, and the size of an
inserted column must match the number of rows. Otherwise, the script
will raise this runtime error. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Invalid array size demo")

// Declare an empty matrix.
m = matrix.new&lt;float&gt;()

m.add_col(0, array.from(1, 2))    // Add a column. Changes the shape of `m` to 2x1.
m.add_col(1, array.from(1, 2, 3)) // Raises a runtime error because `m` has 2 rows, not 3. 

plot(m.col(0).get(1))</code></div>
<p>Note that:</p>
<ul>
<li>When <code dir="auto">m</code> is empty, one can insert a row or column array of <em>any</em>
size, as shown in the first <code dir="auto">m.add_col()</code> line.</li>
</ul>
<h3 class="md-heading" id="cannot-call-matrix-methods-when-the-id-of-matrix-is-na"><a href="#cannot-call-matrix-methods-when-the-id-of-matrix-is-na">Cannot call matrix methods when the ID of matrix is ‘na’.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a matrix variable is assigned to <code dir="auto">na</code>, it means that the variable
doesn’t reference an existing object. Consequently, one cannot use
built-in <code dir="auto">matrix.*()</code> functions and methods with it. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("na matrix methods demo") 

//@variable A `matrix` variable assigned to `na`.
matrix&lt;float&gt; m = na

mCopy = m.copy() // Raises a runtime error. You can't copy a matrix that doesn't exist.

if bar_index == last_bar_index - 1
    label.new(bar_index, 0, str.tostring(mCopy), color = color.navy, textcolor = color.white, size = size.huge)</code></div>
<p>To resolve this error, assign <code dir="auto">m</code> to a valid matrix instance before
using <code dir="auto">matrix.*()</code> functions.</p>
<h3 class="md-heading" id="matrix-is-too-large-maximum-size-of-the-matrix-is-100000-elements"><a href="#matrix-is-too-large-maximum-size-of-the-matrix-is-100000-elements">Matrix is too large. Maximum size of the matrix is 100,000 elements.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The total number of elements in a matrix
(<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.elements_count">matrix.elements_count()</a>)
cannot exceed <strong>100,000</strong>, regardless of its shape. For example, this
script will raise an error because it
<a href="/pine-script-docs/v5/language/matrices/#inserting">inserts</a> 1000 rows with 101 elements into the <code dir="auto">m</code> matrix:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix too large demo") 

var matrix&lt;float&gt; m = matrix.new&lt;float&gt;()

if bar_index == 0
    for i = 1 to 1000
        // This raises an error because the script adds 101 elements on each iteration.
        // 1000 rows * 101 elements per row = 101000 total elements. This is too large.
        m.add_row(m.rows(), array.new&lt;float&gt;(101, i))

plot(m.get(0, 0))</code></div>
<h3 class="md-heading" id="the-rowcolumn-index-must-be-0--from_rowcolumn--to_rowcolumn"><a href="#the-rowcolumn-index-must-be-0--from_rowcolumn--to_rowcolumn">The row/column index must be 0 &lt;= from_row/column &lt; to_row/column.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When using <code dir="auto">matrix.*()</code> functions with <code dir="auto">from_row/column</code> and
<code dir="auto">to_row/column</code> indices, the <code dir="auto">from_*</code> values must be less than the
corresponding <code dir="auto">to_*</code> values, with the minimum possible value being 0.
Otherwise, the script will raise a runtime error.</p>
<p>For example, this script shows an attempt to declare a
<a href="/pine-script-docs/v5/language/matrices/#submatrices">submatrix</a> from a 4x4 <code dir="auto">m</code> matrix with a <code dir="auto">from_row</code> value of 2 and a
<code dir="auto">to_row</code> value of 2, which will result in an error:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Invalid from_row, to_row demo") 

//@variable A 4x4 matrix filled with a random value. 
matrix&lt;float&gt; m = matrix.new&lt;float&gt;(4, 4, math.random())

matrix&lt;float&gt; mSub = m.submatrix(from_row = 2, to_row = 2) // Raises an error. `from_row` can't equal `to_row`.

plot(mSub.get(0, 0))</code></div>
<h3 class="md-heading" id="matrices-id1-and-id2-must-have-an-equal-number-of-rows-and-columns-to-be-added"><a href="#matrices-id1-and-id2-must-have-an-equal-number-of-rows-and-columns-to-be-added">Matrices ‘id1’ and ‘id2’ must have an equal number of rows and columns to be added.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When using
<a href="/pine-script-docs/v5/language/matrices/#matrixsum-and-matrixdiff">matrix.sum() and matrix.diff()</a> functions, the <code dir="auto">id1</code> and <code dir="auto">id2</code> matrices must have the same
number of rows and the same number of columns. Attempting to add or
subtract two matrices with mismatched dimensions will raise an error, as
demonstrated by this code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Invalid sum dimensions demo") 

//@variable A 2x3 matrix. 
matrix&lt;float&gt; m1 = matrix.new&lt;float&gt;(2, 3, 1)
//@variable A 3x4 matrix.
matrix&lt;float&gt; m2 = matrix.new&lt;float&gt;(3, 4, 2)

mSum = matrix.sum(m1, m2) // Raises an error. `m1` and `m2` don't have matching dimensions.

plot(mSum.get(0, 0))</code></div>
<h3 class="md-heading" id="the-number-of-columns-in-the-id1-matrix-must-equal-the-number-of-rows-in-the-matrix-or-the-number-of-elements-in-the-array-id2"><a href="#the-number-of-columns-in-the-id1-matrix-must-equal-the-number-of-rows-in-the-matrix-or-the-number-of-elements-in-the-array-id2">The number of columns in the ‘id1’ matrix must equal the number of rows in the matrix (or the number of elements in the array) ‘id2’.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When using
<a href="/pine-script-docs/v5/language/matrices/#matrixmult">matrix.mult()</a> to multiply an <code dir="auto">id1</code> matrix by an <code dir="auto">id2</code> matrix or array, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.rows">matrix.rows()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a>
of <code dir="auto">id2</code> must equal the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.columns">matrix.columns()</a>
in <code dir="auto">id1</code>. If they don’t align, the script will raise this error.</p>
<p>For example, this script tries to multiply two 2x3 matrices. While
<em>adding</em> these matrices is possible, <em>multiplying</em> them is not:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Invalid mult dimensions demo") 

//@variable A 2x3 matrix. 
matrix&lt;float&gt; m1 = matrix.new&lt;float&gt;(2, 3, 1)
//@variable A 2x3 matrix.
matrix&lt;float&gt; m2 = matrix.new&lt;float&gt;(2, 3, 2)

mSum = matrix.mult(m1, m2) // Raises an error. The number of columns in `m1` and rows in `m2` aren't equal.

plot(mSum.get(0, 0))</code></div>
<h3 class="md-heading" id="operation-not-available-for-non-square-matrices"><a href="#operation-not-available-for-non-square-matrices">Operation not available for non-square matrices.<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Some matrix operations, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">matrix.inv()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.det">matrix.det()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.eigenvalues">matrix.eigenvalues()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.inv">matrix.eigenvectors()</a>
only work with <strong>square</strong> matrices, i.e., matrices with the same number
of rows and columns. When attempting to execute such functions on
non-square matrices, the script will raise an error stating the
operation isn’t available or that it cannot calculate the result for
the matrix <code dir="auto">id</code>. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Non-square demo") 

//@variable A 3x5 matrix. 
matrix&lt;float&gt; m = matrix.new&lt;float&gt;(3, 5, 1)

plot(m.det()) // Raises a runtime error. You can't calculate the determinant of a 3x5 matrix.</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/arrays"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Arrays  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/maps"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Maps <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-has-labels-above="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/language/execution-model">Language</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Maps</span> </div> <div class="not-content" data-astro-cid-i7sip6yg="" id="article-labels"><div data-astro-cid-i7sip6yg="" style="background-color: #651FFF">ADVANCED</div></div> </div> <div data-astro-cid-xgirumru="" data-has-labels="" id="slot-container"> <h1 class="md-heading" id="language-maps"><a href="#maps">Maps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This page contains advanced material. If you are a beginning Pine
Script™ programmer, we recommend you become familiar with other, more
accessible Pine Script™ features before you venture here.</p></div></aside>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ Maps are collections that store elements in <em>key-value
pairs</em>. They allow scripts to collect multiple value references
associated with unique identifiers (keys).</p>
<p>Unlike <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and
<a href="/pine-script-docs/v5/language/matrices/">matrices</a>, maps are <em>unordered</em> collections. Scripts quickly access a map’s
values by referencing the keys from the key-value pairs put into them
rather than traversing an internal index.</p>
<p>A map’s keys can be of any <a href="/pine-script-docs/v5/language/type-system/#types">fundamental type</a> or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>,
and its values can be of any available type. Maps cannot directly use other <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> (maps, <a href="/pine-script-docs/v5/language/arrays/">arrays</a>, or <a href="/pine-script-docs/v5/language/matrices/">matrices</a>) as values, but they can hold <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a> instances containing these data structures within their fields. See <a href="/pine-script-docs/v5/language/maps/#maps-of-other-collections">this section</a> for more information.</p>
<p>As with other collections, maps can contain up to 100,000 elements in
total. Since each key-value pair in a map consists of two elements (a
unique <em>key</em> and its associated <em>value</em>), the maximum number of
key-value pairs a map can hold is 50,000.</p>
<h2 class="md-heading" id="declaring-a-map"><a href="#declaring-a-map">Declaring a map<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ uses the following syntax to declare maps:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">[var/varip ][map&lt;keyType, valueType&gt; ]&lt;identifier&gt; = &lt;expression&gt;</span></div></div></code></pre></figure></link></div>
<p>Where <code dir="auto">&lt;keyType, valueType&gt;</code> is the map’s
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> that declares the types of keys and values it will contain,
and the <code dir="auto">&lt;expression&gt;</code> returns either a map instance or <code dir="auto">na</code>.</p>
<p>When declaring a map variable assigned to <code dir="auto">na</code>, users must include the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
keyword followed by a
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> to tell the compiler that the variable can accept maps with
<code dir="auto">keyType</code> keys and <code dir="auto">valueType</code> values.</p>
<p>For example, this line of code declares a new <code dir="auto">myMap</code> variable that can
accept map instances holding pairs of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">map&lt;string, float&gt; myMap = na</code></div>
<p>When the <code dir="auto">&lt;expression&gt;</code> is not <code dir="auto">na</code>, the compiler does not require
explicit type declaration, as it will infer the type information from
the assigned map object.</p>
<p>This line declares a <code dir="auto">myMap</code> variable assigned to an empty map with
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values. Any maps assigned to this variable later must have the same key
and value types:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">myMap = map.new&lt;string, float&gt;()</code></div>
<h3 class="md-heading" id="using-var-and-varip-keywords"><a href="#using-var-and-varip-keywords">Using `var` and `varip` keywords<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users can include the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keywords to instruct their scripts to declare map variables only on the
first chart bar. Variables that use these keywords point to the same map
instances on each script iteration until explicitly reassigned.</p>
<p>For example, this script declares a <code dir="auto">colorMap</code> variable assigned to a
map that holds pairs of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_color">color</a>
values on the first chart bar. The script displays an <code dir="auto">oscillator</code> on
the chart and uses the values it
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">put</a>
into the <code dir="auto">colorMap</code> on the <em>first</em> bar to color the plots on <em>all</em> bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="646" loading="lazy" src="images/0b1db1c4f398057d99706e564a5a52f0.webp" width="1280"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("var map demo")

//@variable A map associating color values with string keys.
var colorMap = map.new&lt;string, color&gt;()

// Put `&lt;string, color&gt;` pairs into `colorMap` on the first bar.
if bar_index == 0
    colorMap.put("Bull", color.green)
    colorMap.put("Bear", color.red)
    colorMap.put("Neutral", color.gray)

//@variable The 14-bar RSI of `close`.
float oscillator = ta.rsi(close, 14)

//@variable The color of the `oscillator`.
color oscColor = switch
    oscillator &gt; 50 =&gt; colorMap.get("Bull")
    oscillator &lt; 50 =&gt; colorMap.get("Bear")
    =&gt;                 colorMap.get("Neutral")

// Plot the `oscillator` using the `oscColor` from our `colorMap`.
plot(oscillator, "Histogram", oscColor, 2, plot.style_histogram, histbase = 50)
plot(oscillator, "Line", oscColor, 3)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Map variables declared using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
behave as ones using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> on
historical data, but they update their key-value pairs for realtime bars
(i.e., the bars since the script’s last compilation) on each new price
tick. Maps assigned to
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
variables can only hold values of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_bool">bool</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_color">color</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
types or
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> that exclusively contain within their fields these types or
collections (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>,
<a href="/pine-script-docs/v5/language/matrices/">matrices</a>, or maps) of
these types.</p></div></aside>
<h2 class="md-heading" id="reading-and-writing"><a href="#reading-and-writing">Reading and writing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="putting-and-getting-key-value-pairs"><a href="#putting-and-getting-key-value-pairs">Putting and getting key-value pairs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>
function is one that map users will utilize quite often, as it’s the
primary method to put a new key-value pair into a map. It associates the
<code dir="auto">key</code> argument with the <code dir="auto">value</code> argument in the call and adds the pair
to the map <code dir="auto">id</code>.</p>
<p>If the <code dir="auto">key</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>
call already exists in the map’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">keys</a>,
the new pair passed into the function will <strong>replace</strong> the existing one.</p>
<p>To retrieve the value from a map <code dir="auto">id</code> associated with a given <code dir="auto">key</code>, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get">map.get()</a>.
This function returns the value if the <code dir="auto">id</code> map
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.contains">contains</a>
the <code dir="auto">key</code>. Otherwise, it returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>The following example calculates the difference between the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
values from when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
was last
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rising">rising</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.falling">falling</a>
over a given <code dir="auto">length</code> with the help of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get">map.get()</a>
methods. The script puts a <code dir="auto">("Rising", bar_index)</code> pair into the <code dir="auto">data</code>
map when the price is rising and puts a <code dir="auto">("Falling", bar_index)</code> pair
into the map when the price is falling. It then puts a pair containing
the “Difference” between the “Rising” and “Falling” values into
the map and plots its value on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="646" loading="lazy" src="images/cdb777e7832e16da1ebbd5cdcb255469.webp" width="1280"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Putting and getting demo")

//@variable The length of the `ta.rising()` and `ta.falling()` calculation.
int length = input.int(2, "Length")

//@variable A map associating `string` keys with `int` values.
var data = map.new&lt;string, int&gt;()

// Put a new ("Rising", `bar_index`) pair into the `data` map when `close` is rising.
if ta.rising(close, length)
    data.put("Rising", bar_index)
// Put a new ("Falling", `bar_index`) pair into the `data` map when `close` is falling.
if ta.falling(close, length)
    data.put("Falling", bar_index)

// Put the "Difference" between current "Rising" and "Falling" values into the `data` map.
data.put("Difference", data.get("Rising") - data.get("Falling"))

//@variable The difference between the last "Rising" and "Falling" `bar_index`.
int index = data.get("Difference")

//@variable Returns `color.green` when `index` is positive, `color.red` when negative, and `color.gray` otherwise.
color indexColor = index &gt; 0 ? color.green : index &lt; 0 ? color.red : color.gray

plot(index, color = indexColor, style = plot.style_columns)</code></div>
<p>Note that:</p>
<ul>
<li>This script replaces the values associated with the “Rising”,
“Falling”, and “Difference” keys on successive
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">data.put()</a>
calls, as each of these keys is unique and can only appear once
in the <code dir="auto">data</code> map.</li>
<li>Replacing the pairs in a map does not change the internal
<em>insertion order</em> of its keys. We discuss this further in the
<a href="/pine-script-docs/v5/language/maps/#inspecting-keys-and-values">next section</a>.</li>
</ul>
<p>Similar to working with other collections, when putting a value of a
<em>special type</em>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>)
or a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> into a map, it’s important to note the inserted pair’s
<code dir="auto">value</code> points to that same object without copying it. Modifying the
value referenced by a key-value pair will also affect the original
object.</p>
<p>For example, this script contains a custom <code dir="auto">ChartData</code> type with <code dir="auto">o</code>,
<code dir="auto">h</code>, <code dir="auto">l</code>, and <code dir="auto">c</code> fields. On the first chart bar, the script declares a
<code dir="auto">myMap</code> variable and adds the pair <code dir="auto">("A", myData)</code>, where <code dir="auto">myData</code> is a
<code dir="auto">ChartData</code> instance with initial field values of <code dir="auto">na</code>. It adds the pair
<code dir="auto">("B", myData)</code> to <code dir="auto">myMap</code> and updates the object from this pair on
every bar via the user-defined <code dir="auto">update()</code> method.</p>
<p>Each change to the object with the “B” key affects the one referenced
by the “A” key, as shown by the candle plot of the “A” object’s
fields:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="506" loading="lazy" src="images/01aea8d1fdf31a8ab6eca0a26ea838e1.webp" width="1332"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Putting and getting objects demo")

//@type A custom type to hold OHLC data.
type ChartData
    float o
    float h
    float l
    float c

//@function Updates the fields of a `ChartData` object.
method update(ChartData this) =&gt;
    this.o := open
    this.h := high
    this.l := low
    this.c := close

//@variable A new `ChartData` instance declared on the first bar.
var myData = ChartData.new()
//@variable A map associating `string` keys with `ChartData` instances.
var myMap = map.new&lt;string, ChartData&gt;()

// Put a new pair with the "A" key into `myMap` only on the first bar.
if bar_index == 0
    myMap.put("A", myData)

// Put a pair with the "B" key into `myMap` on every bar.
myMap.put("B", myData)

//@variable The `ChartData` value associated with the "A" key in `myMap`.
ChartData oldest = myMap.get("A")
//@variable The `ChartData` value associated with the "B" key in `myMap`.
ChartData newest = myMap.get("B")

// Update `newest`. Also affects `oldest` and `myData` since they all reference the same `ChartData` object.
newest.update()

// Plot the fields of `oldest` as candles.
plotcandle(oldest.o, oldest.h, oldest.l, oldest.c)</code></div>
<p>Note that:</p>
<ul>
<li>This script would behave differently if it passed a copy of
<code dir="auto">myData</code> into each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">myMap.put()</a>
call. For more information, see
<a href="/pine-script-docs/v5/language/objects/#copying-objects">this</a> section of our User Manual’s page on
<a href="/pine-script-docs/v5/language/objects/">objects</a>.</li>
</ul>
<h3 class="md-heading" id="inspecting-keys-and-values"><a href="#inspecting-keys-and-values">Inspecting keys and values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<h4 class="md-heading" id="mapkeys-and-mapvalues"><a href="#mapkeys-and-mapvalues">`map.keys()` and `map.values()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>To retrieve all keys and values put into a map, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">map.values()</a>.
These functions copy all key/value references within a map <code dir="auto">id</code> to a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
object. Modifying the array returned from either of these functions does
not affect the <code dir="auto">id</code> map.</p>
<p>Although maps are <em>unordered</em> collections, Pine Script™ internally
maintains the <em>insertion order</em> of a map’s key-value pairs. As a
result, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">map.values()</a>
functions always return <a href="/pine-script-docs/v5/language/arrays/">arrays</a> with their elements ordered based on the <code dir="auto">id</code> map’s
insertion order.</p>
<p>The script below demonstrates this by displaying the key and value
arrays from an <code dir="auto">m</code> map in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
once every 50 bars. As we see on the chart, the order of elements in
each array returned by <code dir="auto">m.keys()</code> and <code dir="auto">m.values()</code> aligns with the
insertion order of the key-value pairs in <code dir="auto">m</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/9880705df5e9deac1b48bf63252c7299.webp" width="1078"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Keys and values demo")

if bar_index % 50 == 0
    //@variable A map containing pairs of `string` keys and `float` values.
    m = map.new&lt;string, float&gt;()

    // Put pairs into `m`. The map will maintain this insertion order.
    m.put("First", math.round(math.random(0, 100)))
    m.put("Second", m.get("First") + 1)
    m.put("Third", m.get("Second") + 1)

    //@variable An array containing the keys of `m` in their insertion order.
    array&lt;string&gt; keys = m.keys()
    //@variable An array containing the values of `m` in their insertion order.
    array&lt;float&gt; values = m.values()

    //@variable A label displaying the `size` of `m` and the `keys` and `values` arrays.
    label debugLabel = label.new(
         bar_index, 0,
         str.format("Pairs: {0}\nKeys: {1}\nValues: {2}", m.size(), keys, values),
         color = color.navy, style = label.style_label_center, 
         textcolor = color.white, size = size.huge
     )</code></div>
<p>Note that:</p>
<ul>
<li>The value with the “First” key is a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a>
whole number between 0 and 100. The “Second” value is one
greater than the “First”, and the “Third” value is one
greater than the “Second”.</li>
</ul>
<p>It’s important to note a map’s internal insertion order <strong>does not</strong>
change when replacing its key-value pairs. The locations of the new
elements in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">keys()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">values()</a>
arrays will be the same as the old elements in such cases. The only
exception is if the script completely
<a href="/pine-script-docs/v5/language/maps/#removing-key-value-pairs">removes</a> the key beforehand.</p>
<p>Below, we’ve added a line of code to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">put</a>
a new value with the “Second” key into the <code dir="auto">m</code> map, overwriting the
previous value associated with that key. Although the script puts this
new pair into the map <em>after</em> the one with the “Third” key, the
pair’s key and value are still second in the <code dir="auto">keys</code> and <code dir="auto">values</code> arrays
since the key was already present in <code dir="auto">m</code> <em>before</em> the change:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/cd9ac37b6ebd6d3a1d1040c4066292f3.webp" width="1078"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Keys and values demo")

if bar_index % 50 == 0
    //@variable A map containing pairs of `string` keys and `float` values.
    m = map.new&lt;string, float&gt;()

    // Put pairs into `m`. The map will maintain this insertion order.
    m.put("First", math.round(math.random(0, 100)))
    m.put("Second", m.get("First") + 1)
    m.put("Third", m.get("Second") + 1)

    // Overwrite the "Second" pair in `m`. This will NOT affect the insertion order.
    // The key and value will still appear second in the `keys` and `values` arrays.
    m.put("Second", -2)

    //@variable An array containing the keys of `m` in their insertion order.
    array&lt;string&gt; keys = m.keys()
    //@variable An array containing the values of `m` in their insertion order.
    array&lt;float&gt; values = m.values()

    //@variable A label displaying the `size` of `m` and the `keys` and `values` arrays.
    label debugLabel = label.new(
         bar_index, 0,
         str.format("Pairs: {0}\nKeys: {1}\nValues: {2}", m.size(), keys, values),
         color = color.navy, style = label.style_label_center, 
         textcolor = color.white, size = size.huge
     )</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The elements in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">map.values()</a>
array point to the same values as the map <code dir="auto">id</code>. Consequently, when the
map’s values are of <em>reference types</em>, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>,
or <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>, modifying the instances referenced by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">map.values()</a>
array will also affect those referenced by the map <code dir="auto">id</code> since the
contents of both collections point to identical objects.</p></div></aside>
<h4 class="md-heading" id="mapcontains"><a href="#mapcontains">`map.contains()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>To check if a specific <code dir="auto">key</code> exists within a map <code dir="auto">id</code>, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.contains">map.contains()</a>.
This function is a convenient alternative to calling
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.includes">array.includes()</a>
on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
returned from
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">map.keys()</a>.</p>
<p>For example, this script checks if various keys exist within an <code dir="auto">m</code> map,
then displays the results in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="272" loading="lazy" src="images/9a110425cce2320c0ccb137167d296f9.webp" width="864"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inspecting keys demo")

//@variable A map containing `string` keys and `string` values.
m = map.new&lt;string, string&gt;()

// Put key-value pairs into the map.
m.put("A", "B")
m.put("C", "D")
m.put("E", "F")

//@variable An array of keys to check for in `m`.
array&lt;string&gt; testKeys = array.from("A", "B", "C", "D", "E", "F")

//@variable An array containing all elements from `testKeys` found in the keys of `m`.
array&lt;string&gt; mappedKeys = array.new&lt;string&gt;()

for key in testKeys
    // Add the `key` to `mappedKeys` if `m` contains it.
    if m.contains(key)
        mappedKeys.push(key)

//@variable A string representing the `testKeys` array and the elements found within the keys of `m`.
string testText = str.format("Tested keys: {0}\nKeys found: {1}", testKeys, mappedKeys)

if bar_index == last_bar_index - 1
    //@variable Displays the `testText` in a label at the `bar_index` before the last.
    label debugLabel = label.new(
         bar_index, 0, testText, style = label.style_label_center, 
         textcolor = color.white, size = size.huge
     )</code></div>
<h3 class="md-heading" id="removing-key-value-pairs"><a href="#removing-key-value-pairs">Removing key-value pairs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To remove a specific key-value pair from a map <code dir="auto">id</code>, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.remove">map.remove()</a>.
This function removes the <code dir="auto">key</code> and its associated value from the map
while preserving the insertion order of other key-value pairs. It
returns the removed value if the map
<a href="/pine-script-docs/v5/language/maps/#mapcontains">contained</a> the <code dir="auto">key</code>. Otherwise, it returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>To remove all key-value pairs from a map <code dir="auto">id</code> at once, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.clear">map.clear()</a>.</p>
<p>The following script creates a new <code dir="auto">m</code> map,
<a href="/pine-script-docs/v5/language/maps/#putting-and-getting-key-value-pairs">puts</a> key-value pairs into the map, uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.remove">m.remove()</a>
within a loop to remove each valid <code dir="auto">key</code> listed in the <code dir="auto">removeKeys</code>
array, then calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.clear">m.clear()</a>
to remove all remaining key-value pairs. It uses a custom <code dir="auto">debugLabel()</code>
method to display the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.size">size</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">keys</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">values</a>
of <code dir="auto">m</code> after each change:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="324" loading="lazy" src="images/6c9f5b9f0e3266910578513f4fc6ede1.webp" width="1134"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Removing key-value pairs demo")

//@function Returns a label to display the keys and values from a map.
method debugLabel(
     map&lt;string, int&gt; this, int barIndex = bar_index,
     color bgColor = color.blue, string note = ""
 ) =&gt;
    //@variable A string representing the size, keys, and values in `this` map.
    string repr = str.format(
         "{0}\nSize: {1}\nKeys: {2}\nValues: {3}",
         note, this.size(), str.tostring(this.keys()), str.tostring(this.values())
     )
    label.new(
         barIndex, 0, repr, color = bgColor, style = label.style_label_center,
         textcolor = color.white, size = size.huge
     )

if bar_index == last_bar_index - 1
    //@variable A map containing `string` keys and `int` values.
    m = map.new&lt;string, int&gt;()

    // Put key-value pairs into `m`.
    for [i, key] in array.from("A", "B", "C", "D", "E")
        m.put(key, i)
    m.debugLabel(bar_index, color.green, "Added pairs")

    //@variable An array of keys to remove from `m`.
    array&lt;string&gt; removeKeys = array.from("B", "B", "D", "F", "a")

    // Remove each `key` in `removeKeys` from `m`.
    for key in removeKeys
        m.remove(key)
    m.debugLabel(bar_index + 10, color.red, "Removed pairs")

    // Remove all remaining keys from `m`.
    m.clear()
    m.debugLabel(bar_index + 20, color.purple, "Cleared the map")</code></div>
<p>Note that:</p>
<ul>
<li>Not all strings in the <code dir="auto">removeKeys</code> array were present in the
keys of <code dir="auto">m</code>. Attempting to remove non-existent keys (“F”,
“a”, and the second “B” in this example) has no effect on a
map’s contents.</li>
</ul>
<h3 class="md-heading" id="combining-maps"><a href="#combining-maps">Combining maps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can combine two maps via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put_all">map.put_all()</a>.
This function puts <em>all</em> key-value pairs from the <code dir="auto">id2</code> map, in their
insertion order, into the <code dir="auto">id1</code> map. As with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>,
if any keys in <code dir="auto">id2</code> are also present in <code dir="auto">id1</code>, this function
<strong>replaces</strong> the key-value pairs that contain those keys without
affecting their initial insertion order.</p>
<p>This example contains a user-defined <code dir="auto">hexMap()</code> function that maps
decimal
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
keys to
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
representations of their
<a href="https://en.wikipedia.org//wiki/Hexadecimal" rel="nofollow">hexadecimal</a> forms. The
script uses this function to create two maps, <code dir="auto">mapA</code> and <code dir="auto">mapB</code>, then
uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put_all">mapA.put_all(mapB)</a>
to put all key-value pairs from <code dir="auto">mapB</code> into <code dir="auto">mapA</code>.</p>
<p>The script uses a custom <code dir="auto">debugLabel()</code> function to display labels
showing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">keys</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">values</a>
of <code dir="auto">mapA</code> and <code dir="auto">mapB</code>, then another label displaying the contents of
<code dir="auto">mapA</code> after putting all key-value pairs from <code dir="auto">mapB</code> into it:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="364" loading="lazy" src="images/ec229e729ae8dc5475b635a7d7743045.webp" width="1230"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Combining maps demo", "Hex map")

//@variable An array of string hex digits.
var array&lt;string&gt; hexDigits = str.split("0123456789ABCDEF", "")

//@function Returns a hexadecimal string for the specified `value`.
hex(int value) =&gt;
    //@variable A string representing the hex form of the `value`.
    string result = ""
    //@variable A temporary value for digit calculation.
    int tempValue = value  
    while tempValue &gt; 0
        //@variable The next integer digit.
        int digit = tempValue % 16
        // Add the hex form of the `digit` to the `result`.
        result := hexDigits.get(digit) + result
        // Divide the `tempValue` by the base.
        tempValue := int(tempValue / 16)
    result

//@function Returns a map holding the `numbers` as keys and their `hex` strings as values.  
hexMap(array&lt;int&gt; numbers) =&gt;
    //@variable A map associating `int` keys with `string` values.
    result = map.new&lt;int, string&gt;()
    for number in numbers
        // Put a pair containing the `number` and its `hex()` representation into the `result`.
        result.put(number, hex(number))
    result

//@function Returns a label to display the keys and values of a hex map.
debugLabel(
     map&lt;int, string&gt; this, int barIndex = bar_index, color bgColor = color.blue, 
     string style = label.style_label_center, string note = ""
 ) =&gt;
    string repr = str.format(
         "{0}\nDecimal: {1}\nHex: {2}", 
         note, str.tostring(this.keys()), str.tostring(this.values())
     )
    label.new(
         barIndex, 0, repr, color = bgColor, style = style,
         textcolor = color.white, size = size.huge
     )

if bar_index == last_bar_index - 1
    //@variable A map with decimal `int` keys and hexadecimal `string` values.
    map&lt;int, string&gt; mapA = hexMap(array.from(101, 202, 303, 404))
    debugLabel(mapA, bar_index, color.navy, label.style_label_down, "A")

    //@variable A map containing key-value pairs to add to `mapA`.
    map&lt;int, string&gt; mapB = hexMap(array.from(303, 404, 505, 606, 707, 808))
    debugLabel(mapB, bar_index, color.maroon, label.style_label_up, "B")

    // Put all pairs from `mapB` into `mapA`.
    mapA.put_all(mapB)
    debugLabel(mapA, bar_index + 10, color.purple, note = "Merge B into A")</code></div>
<h2 class="md-heading" id="looping-through-a-map"><a href="#looping-through-a-map">Looping through a map<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are several ways scripts can iteratively access the keys and
values in a map. For example, one could loop through a map’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys">keys()</a>
array and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get">get()</a>
the value for each <code dir="auto">key</code>, like so:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for key in thisMap.keys()
    value = thisMap.get(key)</code></div>
<p>However, we recommend using a <code dir="auto">for...in</code> loop directly on a map, as it
iterates over the map’s key-value pairs in their insertion order,
returning a tuple containing the next pair’s key and value on each
iteration.</p>
<p>For example, this line of code loops through each <code dir="auto">key</code> and <code dir="auto">value</code> in
<code dir="auto">thisMap</code>, starting from the first key-value pair put into it:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for [key, value] in thisMap</code></div>
<p>Let’s use this structure to write a script that displays a map’s
key-value pairs in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>.
In the example below, we’ve defined a custom <code dir="auto">toTable()</code> method that
creates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
then uses a <code dir="auto">for...in</code> loop to iterate over the map’s key-value pairs
and populate the table’s cells. The script uses this method to
visualize a map containing <code dir="auto">length</code>-bar <code dir="auto">averages</code> of price and volume
data:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="620" loading="lazy" src="images/f15ad1760a8fbd91a31154bd9a2ba023.webp" width="1264"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Looping through a map demo", "Table of averages")

//@variable The length of the moving average.
int length = input.int(20, "Length")
//@variable The size of the table text.
string txtSize = input.string(
     size.huge, "Text size",
     options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge]
 )

//@function Displays the pairs of `this` map within a table.
//@param    this A map with `string` keys and `float` values.
//@param    position The position of the table on the chart.
//@param    header The string to display on the top row of the table.
//@param    textSize The size of the text in the table.
//@returns  A new `table` object with cells displaying each pair in `this`.
method toTable(
     map&lt;string, float&gt; this, string position = position.middle_center, string header = na,
     string textSize = size.huge
 ) =&gt;
    // Color variables
    borderColor = #000000
    headerColor = color.rgb(1, 88, 80)
    pairColor   = color.maroon
    textColor   = color.white

    //@variable A table that displays the key-value pairs of `this` map.
    table result = table.new(
         position, this.size() + 1, 3, border_width = 2, border_color = borderColor
     )
    // Initialize top and side header cells.
    result.cell(1, 0, header, bgcolor = headerColor, text_color = textColor, text_size = textSize)
    result.merge_cells(1, 0, this.size(), 0)
    result.cell(0, 1, "Key", bgcolor = headerColor, text_color = textColor, text_size = textSize)
    result.cell(0, 2, "Value", bgcolor = headerColor, text_color = textColor, text_size = textSize)

    //@variable The column index of the table. Updates on each loop iteration.
    int col = 1

    // Loop over each `key` and `value` from `this` map in the insertion order.
    for [key, value] in this
        // Initialize a `key` cell in the `result` table on row 1.
        result.cell(
             col, 1, str.tostring(key), bgcolor = color.maroon,
             text_color = color.white, text_size = textSize
         )
        // Initialize a `value` cell in the `result` table on row 2.
        result.cell(
             col, 2, str.tostring(value), bgcolor = color.maroon,
             text_color = color.white, text_size = textSize
         )
        // Move to the next column index.
        col += 1
    result // Return the `result` table.

//@variable A map with `string` keys and `float` values to hold `length`-bar averages.
averages = map.new&lt;string, float&gt;()

// Put key-value pairs into the `averages` map.
averages.put("Open", ta.sma(open, length))
averages.put("High", ta.sma(high, length))
averages.put("Low", ta.sma(low, length))
averages.put("Close", ta.sma(close, length))
averages.put("Volume", ta.sma(volume, length))

//@variable The text to display at the top of the table.
string headerText = str.format("{0} {1}-bar averages", "'" + syminfo.tickerid + "'", length)
// Display the `averages` map in a `table` with the `headerText`.
averages.toTable(header = headerText, textSize = txtSize)</code></div>
<h2 class="md-heading" id="copying-a-map"><a href="#copying-a-map">Copying a map<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="shallow-copies"><a href="#shallow-copies">Shallow copies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can make a <em>shallow copy</em> of a map <code dir="auto">id</code> using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.copy">map.copy()</a>
function. Modifications to a shallow copy do not affect the original
<code dir="auto">id</code> map or its internal insertion order.</p>
<p>For example, this script constructs an <code dir="auto">m</code> map with the keys “A”,
“B”, “C”, and “D” assigned to four
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a>
values between 0 and 10. It then creates an <code dir="auto">mCopy</code> map as a shallow
copy of <code dir="auto">m</code> and updates the values associated with its keys. The script
displays the key-value pairs in <code dir="auto">m</code> and <code dir="auto">mCopy</code> on the chart using our
custom <code dir="auto">debugLabel()</code> method:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="320" loading="lazy" src="images/0affc6908b48a34bc74562d0867ee251.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Shallow copy demo")

//@function Displays the key-value pairs of `this` map in a label. 
method debugLabel(
     map&lt;string, float&gt; this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
 ) =&gt;
    //@variable The text to display in the label.
    labelText = note + "\n{"
    for [key, value] in this
        labelText += str.format("{0}: {1}, ", key, value)
    labelText := str.replace(labelText, ", ", "}", this.size() - 1)

    if barstate.ishistory
        label result = label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center, 
             textcolor = textColor, size = size.huge
         )

if bar_index == last_bar_index - 1
    //@variable A map of `string` keys and random `float` values.
    m = map.new&lt;string, float&gt;()

    // Assign random values to an array of keys in `m`.
    for key in array.from("A", "B", "C", "D")
        m.put(key, math.random(0, 10))

    //@variable A shallow copy of `m`.
    mCopy = m.copy()

    // Assign the insertion order value `i` to each `key` in `mCopy`.
    for [i, key] in mCopy.keys()
        mCopy.put(key, i)

    // Display the labels.
    m.debugLabel(bar_index, note = "Original")
    mCopy.debugLabel(bar_index + 10, color.purple, note = "Copied and changed")</code></div>
<h3 class="md-heading" id="deep-copies"><a href="#deep-copies">Deep copies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>While a <a href="/pine-script-docs/v5/language/maps/#shallow-copies">shallow copy</a> will suffice when copying maps that have values of a
<a href="/pine-script-docs/v5/language/type-system/#types">fundamental type</a> or <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>, it’s crucial to understand that shallow copies of a map holding values of a <em>special type</em>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
or a <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>) point to the same objects as the original. Modifying the
objects referenced by a shallow copy will affect the instances
referenced by the original map and vice versa.</p>
<p>To ensure changes to objects referenced by a copied map do not affect
instances referenced in other locations, one can make a <em>deep copy</em> by
creating a new map with key-value pairs containing copies of each value
in the original map.</p>
<p>This example creates an <code dir="auto">original</code> map of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
values and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">puts</a>
a key-value pair into it. The script copies the map to a <code dir="auto">shallow</code>
variable via the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.copy">copy()</a>
method, then to a <code dir="auto">deep</code> variable using a custom <code dir="auto">deepCopy()</code> method.</p>
<p>As we see from the chart, changes to the label retrieved from the
<code dir="auto">shallow</code> copy also affect the instance referenced by the <code dir="auto">original</code>
map, but changes to the one from the <code dir="auto">deep</code> copy do not:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="264" loading="lazy" src="images/3006b45ab561514dcbf8c8d10518435b.webp" width="870"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Deep copy demo")

//@function Returns a deep copy of `this` map.
method deepCopy(map&lt;string, label&gt; this) =&gt;
    //@variable A deep copy of `this` map.
    result = map.new&lt;string, label&gt;()
    // Add key-value pairs with copies of each `value` to the `result`.
    for [key, value] in this
        result.put(key, value.copy())
    result //Return the `result`.

//@variable A map containing `string` keys and `label` values.
var original = map.new&lt;string, label&gt;()

if bar_index == last_bar_index - 1
    // Put a new key-value pair into the `original` map.
    map.put(
         original, "Test",
         label.new(bar_index, 0, "Original", textcolor = color.white, size = size.huge)
     )

    //@variable A shallow copy of the `original` map.
    map&lt;string, label&gt; shallow = original.copy()
    //@variable A deep copy of the `original` map.
    map&lt;string, label&gt; deep = original.deepCopy()

    //@variable The "Test" label from the `shallow` copy.
    label shallowLabel = shallow.get("Test")
    //@variable The "Test" label from the `deep` copy.
    label deepLabel = deep.get("Test")

    // Modify the "Test" label's `y` attribute in the `original` map.
    // This also affects the `shallowLabel`.
    original.get("Test").set_y(label.all.size())

    // Modify the `shallowLabel`. Also modifies the "Test" label in the `original` map.
    shallowLabel.set_text("Shallow copy")
    shallowLabel.set_color(color.red)
    shallowLabel.set_style(label.style_label_up)

    // Modify the `deepLabel`. Does not modify any other label instance.
    deepLabel.set_text("Deep copy")
    deepLabel.set_color(color.navy)
    deepLabel.set_style(label.style_label_left)
    deepLabel.set_x(bar_index + 5)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">deepCopy()</code> method loops through the <code dir="auto">original</code> map,
copying each <code dir="auto">value</code> and
<a href="/pine-script-docs/v5/language/maps/#putting-and-getting-key-value-pairs">putting</a> key-value pairs containing the copies into a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.new%3Ctype,type%3E">new</a>
map instance.</li>
</ul>
<h2 class="md-heading" id="scope-and-history"><a href="#scope-and-history">Scope and history<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>As with other collections in Pine, map variables leave historical trails
on each bar, allowing a script to access past map instances assigned to
a variable using the history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>.
Scripts can also assign maps to global variables and interact with them
from the scopes of
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a>,
<a href="/pine-script-docs/v5/language/methods/">methods</a>, and
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>.</p>
<p>As an example, this script uses a global map and its history to
calculate an aggregate set of
<a href="https://www.tradingview.com/support/solutions/43000592270/">EMAs</a>. It
declares a <code dir="auto">globalData</code> map of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values, where each key in the map corresponds to the length of each EMA
calculation. The user-defined <code dir="auto">update()</code> function calculates each
<code dir="auto">key</code>-length EMA by mixing the values from the <code dir="auto">previous</code> map assigned
to <code dir="auto">globalData</code> with the current <code dir="auto">source</code> value.</p>
<p>The script plots the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.max">maximum</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">minimum</a>
values in the global map’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.values">values()</a>
array and the value from <code dir="auto">globalData.get(50)</code> (i.e., the 50-bar EMA):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="500" loading="lazy" src="images/c0ac7c0f2a23ad62cc2849ea0ff84b4b.webp" width="1316"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scope and history demo", overlay = true)

//@variable The source value for EMA calculation.
float source = input.source(close, "Source")

//@variable A map containing global key-value pairs.
globalData = map.new&lt;int, float&gt;()

//@function Calculates a set of EMAs and updates the key-value pairs in `globalData`.
update() =&gt;
    //@variable The previous map instance assigned to `globalData`.
    map&lt;int, float&gt; previous = globalData[1]

    // Put key-value pairs with keys 10-200 into `globalData` if `previous` is `na`.
    if na(previous)
        for i = 10 to 200
            globalData.put(i, source)
    else
        // Iterate each `key` and `value` in the `previous` map.
        for [key, value] in previous
            //@variable The smoothing parameter for the `key`-length EMA.
            float alpha = 2.0 / (key + 1.0)
            //@variable The `key`-length EMA value.
            float ema = (1.0 - alpha) * value + alpha * source
            // Put the `key`-length `ema` into the `globalData` map.
            globalData.put(key, ema)

// Update the `globalData` map.
update()

//@variable The array of values from `globalData` in their insertion order.
array&lt;float&gt; values = globalData.values()

// Plot the max EMA, min EMA, and 50-bar EMA values.
plot(values.max(), "Max EMA", color.green, 2)
plot(values.min(), "Min EMA", color.red, 2)
plot(globalData.get(50), "50-bar EMA", color.orange, 3)</code></div>
<h2 class="md-heading" id="maps-of-other-collections"><a href="#maps-of-other-collections">Maps of other collections<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Maps cannot directly use other maps,
<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, or
<a href="/pine-script-docs/v5/language/matrices/">matrices</a> as values, but
they can hold values of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> that contains collections within its fields.</p>
<p>For example, suppose we want to create a “2D” map that uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys to access <em>nested maps</em> that hold pairs of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values. Since maps cannot use other collections as values, we will first
create a <em>wrapper type</em> with a field to hold a <code dir="auto">map&lt;string, float&gt;</code>
instance, like so:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@type A wrapper type for maps with `string` keys and `float` values.
type Wrapper
    map&lt;string, float&gt; data</code></div>
<p>With our <code dir="auto">Wrapper</code> type defined, we can create maps of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keys and <code dir="auto">Wrapper</code> values, where the <code dir="auto">data</code> field of each value in the
map points to a <code dir="auto">map&lt;string, float&gt;</code> instance:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">mapOfMaps = map.new&lt;string, Wrapper&gt;()</code></div>
<p>The script below uses this concept to construct a map containing maps
that hold OHLCV data requested from multiple tickers. The user-defined
<code dir="auto">requestData()</code> function requests price and volume data from a ticker,
creates a <code dir="auto">&lt;string, float&gt;</code> map,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">puts</a>
the data into it, then returns a <code dir="auto">Wrapper</code> instance containing the new
map.</p>
<p>The script
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">puts</a>
the results from each call to <code dir="auto">requestData()</code> into the <code dir="auto">mapOfMaps</code>, then
creates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
representation of the nested maps with a user-defined <code dir="auto">toString()</code>
method, which it displays on the chart in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="362" loading="lazy" src="images/6f50843edbf7b7d1313adf3fd7ba1b29.webp" width="1268"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Nested map demo")

//@variable The timeframe of the requested data.
string tf = input.timeframe("D", "Timeframe")
// Symbol inputs.
string symbol1 = input.symbol("EURUSD", "Symbol 1")
string symbol2 = input.symbol("GBPUSD", "Symbol 2")
string symbol3 = input.symbol("EURGBP", "Symbol 3")

//@type A wrapper type for maps with `string` keys and `float` values.
type Wrapper
    map&lt;string, float&gt; data

//@function Returns a wrapped map containing OHLCV data from the `tickerID` at the `timeframe`.
requestData(string tickerID, string timeframe) =&gt;
    // Request a tuple of OHLCV values from the specified ticker and timeframe.
    [o, h, l, c, v] = request.security(
         tickerID, timeframe,
         [open, high, low, close, volume]
     )
    //@variable A map containing requested OHLCV data.
    result = map.new&lt;string, float&gt;()
    // Put key-value pairs into the `result`.
    result.put("Open", o)
    result.put("High", h)
    result.put("Low", l)
    result.put("Close", c)
    result.put("Volume", v)
    //Return the wrapped `result`.
    Wrapper.new(result)

//@function Returns a string representing `this` map of `string` keys and `Wrapper` values.
method toString(map&lt;string, Wrapper&gt; this) =&gt;
    //@variable A string representation of `this` map.
    string result = "{"

    // Iterate over each `key1` and associated `wrapper` in `this`.
    for [key1, wrapper] in this
        // Add `key1` to the `result`.
        result += key1

        //@variable A string representation of the `wrapper.data` map.
        string innerStr = ": {"
        // Iterate over each `key2` and associated `value` in the wrapped map.
        for [key2, value] in wrapper.data
            // Add the key-value pair's representation to `innerStr`.
            innerStr += str.format("{0}: {1}, ", key2, str.tostring(value))

        // Replace the end of `innerStr` with "}" and add to `result`.
        result += str.replace(innerStr, ", ", "},\n", wrapper.data.size() - 1)

    // Replace the blank line at the end of `result` with "}".
    result := str.replace(result, ",\n", "}", this.size() - 1)
    result

//@variable A map of wrapped maps containing OHLCV data from multiple tickers.
var mapOfMaps = map.new&lt;string, Wrapper&gt;()

//@variable A label showing the contents of the `mapOfMaps`.
var debugLabel = label.new(
     bar_index, 0, color = color.navy, textcolor = color.white, size = size.huge,
     style = label.style_label_center, text_font_family = font.family_monospace
 )

// Put wrapped maps into `mapOfMaps`.
mapOfMaps.put(symbol1, requestData(symbol1, tf))
mapOfMaps.put(symbol2, requestData(symbol2, tf))
mapOfMaps.put(symbol3, requestData(symbol3, tf))

// Update the label.
debugLabel.set_text(mapOfMaps.toString())
debugLabel.set_x(bar_index)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/language/matrices"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Matrices  </h4> </a> <span data-astro-cid-xgirumru=""></span> </div> </main><h1>Concepts</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Alerts</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-alerts"><a href="#alerts">Alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView alerts run 24x7 on our servers and do not require users to
be logged in to execute. Alerts are created from the charts user
interface (<em>UI</em>). You will find all the information necessary to
understand how alerts work and how to create them from the charts UI in
the Help Center’s <a href="https://www.tradingview.com/support/solutions/43000520149">About TradingView
alerts</a> page.</p>
<p>Some of the alert types available on TradingView (<em>generic alerts</em>,
<em>drawing alerts</em> and <em>script alerts</em> on order fill events) are created
from symbols or scripts loaded on the chart and do not require specific
coding. Any user can create these types of alerts from the charts UI.</p>
<p>Other types of alerts (<em>script alerts</em> triggering on <em>alert() function
calls</em>, and <em>alertcondition() alerts</em>) require specific Pine Script™
code to be present in a script to create an <em>alert event</em> before script
users can create alerts from them using the charts UI. Additionally,
while script users can create <em>script alerts</em> triggering on <em>order fill
events</em> from the charts UI on any strategy loaded on their chart,
Programmers can specify explicit order fill alert messages in their
script for each type of order filled by the broker emulator.</p>
<p>This page covers the different ways Pine Script™ programmers can code
their scripts to create alert events from which script users will in
turn be able to create alerts from the charts UI. We will cover:</p>
<ul>
<li>How to use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function to <em>alert() function calls</em> in indicators or strategies,
which can then be included in <em>script alerts</em> created from the
charts UI.</li>
<li>How to add custom alert messages to be included in <em>script alerts</em>
triggering on the <em>order fill events</em> of strategies.</li>
<li>How to use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function to generate, in indicators only, <em>alertcondition() events</em>
which can then be used to create <em>alertcondition() alerts</em> from the
charts UI.</li>
</ul>
<p>Keep in mind that:</p>
<ul>
<li>No alert-related Pine Script™ code can create a running alert in the
charts UI; it merely creates alert events which can then be used by
script users to create running alerts from the charts UI.</li>
<li>Alerts only trigger in the realtime bar. The operational scope of
Pine Script™ code dealing with any type of alert is therefore
restricted to realtime bars only.</li>
<li>When an alert is created in the charts UI, TradingView saves a
mirror image of the script and its inputs, along with the chart’s
main symbol and timeframe to run the alert on its servers.
Subsequent changes to your script’s inputs or the chart will thus
not affect running alerts previously created from them. If you want
any changes to your context to be reflected in a running alert’s
behavior, you will need to delete the alert and create a new one in
the new context.</li>
</ul>
<h3 class="md-heading" id="background"><a href="#background">Background<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The different methods Pine programmers can use today to create alert
events in their script are the result of successive enhancements
deployed throughout Pine Script™‘s evolution. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function, which works in indicators only, was the first feature allowing
Pine Script™ programmers to create alert events. Then came order fill
alerts for strategies, which trigger when the broker emulator creates
<em>order fill events</em>. <em>Order fill events</em> require no special code for
script users to create alerts on them, but by way of the <code dir="auto">alert_message</code>
parameter for order-generating <code dir="auto">strategy.*()</code> functions, programmers can
customize the message of alerts triggering on <em>order fill events</em> by
defining a distinct alert message for any number of order fulfillment
events.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function is the most recent addition to Pine Script™. It more or less
supersedes
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>,
and when used in strategies, provides a useful complement to alerts on
<em>order fill events</em>.</p>
<h3 class="md-heading" id="which-type-of-alert-is-best"><a href="#which-type-of-alert-is-best">Which type of alert is best?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>For Pine Script™ programmers, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function will generally be easier and more flexible to work with.
Contrary to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>,
it allows for dynamic alert messages, works in both indicators and
strategies and the programmer decides on the frequency of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
events.</p>
<p>While
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls can be generated on any logic programmable in Pine, including when
orders are <strong>sent</strong> to the broker emulator in strategies, they cannot be
coded to trigger when orders are <strong>executed</strong> (or <em>filled</em>) because
after orders are sent to the broker emulator, the emulator controls
their execution and does not report fill events back to the script
directly.</p>
<p>When a script user wants to generate an alert on a strategy’s order
fill events, he must include those events when creating a <em>script alert</em>
on the strategy in the “Create Alert” dialog box. No special code is
required in scripts for users to be able to do this. The message sent
with order fill events can, however, be customized by programmers
through use of the <code dir="auto">alert_message</code> parameter in order-generating
<code dir="auto">strategy.*()</code> function calls. A combination of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls and the use of custom <code dir="auto">alert_message</code> arguments in
order-generating <code dir="auto">strategy.*()</code> calls should allow programmers to
generate alert events on most conditions occurring in their script’s
execution.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function remains in Pine Script™ for backward compatibility, but it can
also be used advantageously to generate distinct alerts available for
selection as individual items in the “Create Alert” dialog box’s
“Condition” field.</p>
<h2 class="md-heading" id="script-alerts"><a href="#script-alerts">Script alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When a script user creates a <em>script alert</em> using the “Create Alert”
dialog box, the events able to trigger the alert will vary depending on
whether the alert is created from an indicator or a strategy.</p>
<p>A <em>script alert</em> created from an <strong>indicator</strong> will trigger when:</p>
<ul>
<li>The indicator contains
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls.</li>
<li>The code’s logic allows a specific
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call to execute.</li>
<li>The frequency specified in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call allows the alert to trigger.</li>
</ul>
<p>A <em>script alert</em> created from a <strong>strategy</strong> can trigger on <em>alert()
function calls</em>, on <em>order fill events</em>, or both. The script user
creating an alert on a strategy decides which type of events he wishes
to include in his <em>script alert</em>. While users can create a <em>script
alert</em> on <em>order fill events</em> without the need for a strategy to include
special code, it must contain
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls for users to include <em>alert() function calls</em> in their <em>script
alert</em>.</p>
<h3 class="md-heading" id="alert-function-events"><a href="#alert-function-events">`alert()` function events<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function has the following signature:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">alert(message, freq)</span></div></div></code></pre></figure></link></div>
<p><code dir="auto">message</code></p>
<p>A “series string” representing the message text sent when the
alert triggers. Because this argument allows “series” values, it
can be generated at runtime and differ bar to bar, making it
dynamic.</p>
<p><code dir="auto">freq</code></p>
<p>An “input string” specifying the triggering frequency of the
alert. Valid arguments are:</p>
<ul>
<li><code dir="auto">alert.freq_once_per_bar</code>: Only the first call per realtime bar
triggers the alert (default value).</li>
<li><code dir="auto">alert.freq_once_per_bar_close</code>: An alert is only triggered when
the realtime bar closes and an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call is executed during that script iteration.</li>
<li><code dir="auto">alert.freq_all</code>: All calls during the realtime bar trigger the
alert.</li>
</ul>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function can be used in both indicators and strategies. For an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call to trigger a <em>script alert</em> configured on <em>alert() function calls</em>,
the script’s logic must allow the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call to execute, <strong>and</strong> the frequency determined by the <code dir="auto">freq</code>
parameter must allow the alert to trigger.</p>
<p>Note that by default, strategies are recalculated at the bar’s close,
so if the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function with the frequency <code dir="auto">alert.freq_all</code> or
<code dir="auto">alert.freq_once_per_bar</code> is used in a strategy, then it will be called
no more often than once at the bar’s close. In order to enable the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function to be called during the bar construction process, you need to
enable the <code dir="auto">calc_on_every_tick</code> option.</p>
<h4 class="md-heading" id="using-all-alert-calls"><a href="#using-all-alert-calls">Using all `alert()` calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Let’s look at an example where we detect crosses of the RSI centerline:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("All `alert()` calls")
r = ta.rsi(close, 20)

// Detect crosses.
xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)
// Trigger an alert on crosses.
if xUp
    alert("Go long (RSI is " + str.tostring(r, "#.00)"))
else if xDn
    alert("Go short (RSI is " + str.tostring(r, "#.00)"))

plotchar(xUp, "Go Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(xDn, "Go Short", "▼", location.top,    color.red,  size = size.tiny)
hline(50)
plot(r)</code></div>
<p>If a <em>script alert</em> is created from this script:</p>
<ul>
<li>When RSI crosses the centerline up, the <em>script alert</em> will trigger
with the “Go long…” message. When RSI crosses the centerline
down, the <em>script alert</em> will trigger with the “Go short…”
message.</li>
<li>Because no argument is specified for the <code dir="auto">freq</code> parameter in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call, the default value of <code dir="auto">alert.freq_once_per_bar</code> will be used,
so the alert will only trigger the first time each of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls is executed during the realtime bar.</li>
<li>The message sent with the alert is composed of two parts: a constant
string and then the result of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>
call which will include the value of RSI at the moment where the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call is executed by the script. An alert message for a cross up
would look like: “Go long (RSI is 53.41)“.</li>
<li>Because a <em>script alert</em> always triggers on any occurrence of a call
to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>,
as long as the frequency used in the call allows for it, this
particular script does not allow a script user to restrict his
<em>script alert</em> to longs only, for example.</li>
</ul>
<p>Note that:</p>
<ul>
<li>Contrary to an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
call which is always placed at column 0 (in the script’s global
scope), the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call is placed in the local scope of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
branch so it only executes when our triggering condition is met. If
an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call was placed in the script’s global scope at column 0, it would
execute on all bars, which would likely not be the desired behavior.</li>
<li>An
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
could not accept the same string we use for our alert’s message
because of its use of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>
call.
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
messages must be constant strings.</li>
</ul>
<p>Lastly, because
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
messages can be constructed dynamically at runtime, we could have used
the following code to generate our alert events:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Trigger an alert on crosses.
if xUp or xDn
    firstPart = (xUp ? "Go long" : "Go short") + " (RSI is "
    alert(firstPart + str.tostring(r, "#.00)"))</code></div>
<h4 class="md-heading" id="using-selective-alert-calls"><a href="#using-selective-alert-calls">Using selective `alert()` calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When users create a <em>script alert</em> on <em>alert() function calls</em>, the
alert will trigger on any call the script makes to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function, provided its frequency constraints are met. If you want to
allow your script’s users to select which
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function call in your script will trigger a <em>script alert</em>, you will
need to provide them with the means to indicate their preference in your
script’s inputs, and code the appropriate logic in your script. This
way, script users will be able to create multiple <em>script alerts</em> from a
single script, each behaving differently as per the choices made in the
script’s inputs prior to creating the alert in the charts UI.</p>
<p>Suppose, for our next example, that we want to provide the option of
triggering alerts on only longs, only shorts, or both. You could code
your script like this:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Selective `alert()` calls")
detectLongsInput  = input.bool(true,  "Detect Longs")
detectShortsInput = input.bool(true,  "Detect Shorts")
repaintInput      = input.bool(false, "Allow Repainting")

r = ta.rsi(close, 20)
// Detect crosses.
xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)
// Only generate entries when the trade's direction is allowed in inputs.
enterLong  = detectLongsInput  and xUp and (repaintInput or barstate.isconfirmed)
enterShort = detectShortsInput and xDn and (repaintInput or barstate.isconfirmed)
// Trigger the alerts only when the compound condition is met.
if enterLong
    alert("Go long (RSI is " + str.tostring(r, "#.00)"))
else if enterShort
    alert("Go short (RSI is " + str.tostring(r, "#.00)"))

plotchar(enterLong,  "Go Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(enterShort, "Go Short", "▼", location.top,    color.red,  size = size.tiny)
hline(50)
plot(r)</code></div>
<p>Note how:</p>
<ul>
<li>We create a compound condition that is met only when the user’s
selection allows for an entry in that direction. A long entry on a
crossover of the centerline only triggers the alert when long
entries have been enabled in the script’s Inputs.</li>
<li>We offer the user to indicate his repainting preference. When he
does not allow the calculations to repaint, we wait until the bar’s
confirmation to trigger the compound condition. This way, the alert
and the marker only appear at the end of the realtime bar.</li>
<li>If a user of this script wanted to create two distinct script alerts
from this script, i.e., one triggering only on longs, and one only
on shorts, then he would need to:
<ul>
<li>Select only “Detect Longs” in the inputs and create a first
<em>script alert</em> on the script.</li>
<li>Select only “Detect Shorts” in the Inputs and create another
<em>script alert</em> on the script.</li>
</ul>
</li>
</ul>
<h4 class="md-heading" id="in-strategies"><a href="#in-strategies">In strategies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function calls can be used in strategies also, with the provision that
strategies, by default, only execute on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
of realtime bars. Unless <code dir="auto">calc_on_every_tick = true</code> is used in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement, all
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls will use the <code dir="auto">alert.freq_once_per_bar_close</code> frequency, regardless
of the argument used for <code dir="auto">freq</code>.</p>
<p>While <em>script alerts</em> on strategies will use <em>order fill events</em> to
trigger alerts when the broker emulator fills orders,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
can be used advantageously to generate other alert events in strategies.</p>
<p>This strategy creates <em>alert() function calls</em> when RSI moves against
the trade for three consecutive bars:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Strategy with selective `alert()` calls")
r = ta.rsi(close, 20)

// Detect crosses.
xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)
// Place orders on crosses.
if xUp
    strategy.entry("Long", strategy.long)
else if xDn
    strategy.entry("Short", strategy.short)

// Trigger an alert when RSI diverges from our trade's direction.
divInLongTrade  = strategy.position_size &gt; 0 and ta.falling(r, 3)
divInShortTrade = strategy.position_size &lt; 0 and ta.rising( r, 3)
if divInLongTrade 
    alert("WARNING: Falling RSI", alert.freq_once_per_bar_close)
if divInShortTrade
    alert("WARNING: Rising RSI", alert.freq_once_per_bar_close)

plotchar(xUp, "Go Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(xDn, "Go Short", "▼", location.top,    color.red,  size = size.tiny)
plotchar(divInLongTrade,  "WARNING: Falling RSI", "•", location.top,    color.red,  size = size.tiny)
plotchar(divInShortTrade, "WARNING: Rising RSI",  "•", location.bottom, color.lime, size = size.tiny)
hline(50)
plot(r)</code></div>
<p>If a user created a <em>script alert</em> from this strategy and included both
<em>order fill events</em> and <em>alert() function calls</em> in his alert, the alert
would trigger whenever an order is executed, or when one of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls was executed by the script on the realtime bar’s closing
iteration, i.e., when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disrealtime">barstate.isrealtime</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
are both true. The <em>alert() function events</em> in the script would only
trigger the alert when the realtime bar closes because
<code dir="auto">alert.freq_once_per_bar_close</code> is the argument used for the <code dir="auto">freq</code>
parameter in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
calls.</p>
<h3 class="md-heading" id="order-fill-events"><a href="#order-fill-events">Order fill events<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a <em>script alert</em> is created from an indicator, it can only trigger
on <em>alert() function calls</em>. However, when a <em>script alert</em> is created
from a strategy, the user can specify that <em>order fill events</em> also
trigger the <em>script alert</em>. An <em>order fill event</em> is any event generated
by the broker emulator which causes a simulated order to be executed. It
is the equivalent of a trade order being filled by a broker/exchange.
Orders are not necessarily executed when they are placed. In a strategy,
the execution of orders can only be detected indirectly and after the
fact, by analyzing changes in built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dopentrades">strategy.opentrades</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy%7Bdot%7Dposition_size">strategy.position_size</a>.
<em>Script alerts</em> configured on <em>order fill events</em> are thus useful in
that they allow the triggering of alerts at the precise moment of an
order’s execution, before a script’s logic can detect it.</p>
<p>Pine Script™ programmers can customize the alert message sent when
specific orders are executed. While this is not a pre-requisite for
<em>order fill events</em> to trigger, custom alert messages can be useful
because they allow custom syntax to be included with alerts in order to
route actual orders to a third-party execution engine, for example.
Specifying custom alert messages for specific <em>order fill events</em> is
done by means of the <code dir="auto">alert_message</code> parameter in functions which can
generate orders:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclose">strategy.close()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dexit">strategy.exit()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dorder">strategy.order()</a>.</p>
<p>The argument used for the <code dir="auto">alert_message</code> parameter is a “series
string”, so it can be constructed dynamically using any variable
available to the script, as long as it is converted to string format.</p>
<p>Let’s look at a strategy where we use the <code dir="auto">alert_message</code> parameter in
both our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a>
calls:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Strategy using `alert_message`")
r = ta.rsi(close, 20)

// Detect crosses.
xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)
// Place order on crosses using a custom alert message for each.
if xUp
    strategy.entry("Long", strategy.long, stop = high, alert_message = "Stop-buy executed (stop was " + str.tostring(high) + ")")
else if xDn
    strategy.entry("Short", strategy.short, stop = low, alert_message = "Stop-sell executed (stop was " + str.tostring(low) + ")")

plotchar(xUp, "Go Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(xDn, "Go Short", "▼", location.top,    color.red,  size = size.tiny)
hline(50)
plot(r)</code></div>
<p>Note that:</p>
<ul>
<li>We use the <code dir="auto">stop</code> parameter in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a>
calls, which creates stop-buy and stop-sell orders. This entails
that buy orders will only execute once price is higher than the
<code dir="auto">high</code> on the bar where the order is placed, and sell orders will
only execute once price is lower than the [low] on the
bar where the order is placed.</li>
<li>The up/down arrows which we plot with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
are plotted when orders are <strong>placed</strong>. Any number of bars may
elapse before the order is actually executed, and in some cases the
order will never be executed because price does not meet the
required condition.</li>
<li>Because we use the same <code dir="auto">id</code> argument for all buy orders, any new
buy order placed before a previous order’s condition is met will
replace that order. The same applies to sell orders.</li>
<li>Variables included in the <code dir="auto">alert_message</code> argument are evaluated
when the order is executed, so when the alert triggers.</li>
</ul>
<p>When the <code dir="auto">alert_message</code> parameter is used in a strategy’s
order-generating <code dir="auto">strategy.*()</code> function calls, script users must
include the <code dir="auto">{{strategy.order.alert_message}}</code> placeholder in the
“Create Alert” dialog box’s “Message” field when creating <em>script
alerts</em> on <em>order fill events</em>. This is required so the <code dir="auto">alert_message</code>
argument used in the order-generating <code dir="auto">strategy.*()</code> function calls is
used in the message of alerts triggering on each <em>order fill event</em>.
When only using the <code dir="auto">{{strategy.order.alert_message}}</code> placeholder in
the “Message” field and the <code dir="auto">alert_message</code> parameter is present in
only some of the order-generating <code dir="auto">strategy.*()</code> function calls in your
strategy, an empty string will replace the placeholder in the message of
alerts triggered by any order-generating <code dir="auto">strategy.*()</code> function call
not using the <code dir="auto">alert_message</code> parameter.</p>
<p>While other placeholders can be used in the “Create Alert” dialog
box’s “Message” field by users creating alerts on <em>order fill
events</em>, they cannot be used in the argument of <code dir="auto">alert_message</code>.</p>
<h2 class="md-heading" id="alertcondition-events"><a href="#alertcondition-events">`alertcondition()` events<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function allows programmers to create individual <em>alertcondition events</em>
in their indicators. One indicator may contain more than one
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
call. Each call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
in a script will create a corresponding alert selectable in the
“Condition” dropdown menu of the “Create Alert” dialog box.</p>
<p>While the presence of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls in a <strong>strategy</strong> script will not cause a compilation error,
alerts cannot be created from them.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">alertcondition(condition, title, message)</span></div></div></code></pre></figure></div>
<p><code dir="auto">condition</code></p>
<p>A “series bool” value (<code dir="auto">true</code> or <code dir="auto">false</code>) which determines when
the alert will trigger. It is a required argument. When the value is
<code dir="auto">true</code> the alert will trigger. When the value is <code dir="auto">false</code> the alert
will not trigger. Contrary to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
function calls,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls must start at column zero of a line, so cannot be placed in
conditional blocks.</p>
<p><code dir="auto">title</code></p>
<p>A “const string” optional argument that sets the name of the alert
condition as it will appear in the “Create Alert” dialog box’s
“Condition” field in the charts UI. If no argument is supplied,
“Alert” will be used.</p>
<p><code dir="auto">message</code></p>
<p>A “const string” optional argument that specifies the text message
to display when the alert triggers. The text will appear in the
“Message” field of the “Create Alert” dialog box, from where
script users can then modify it when creating an alert. <strong>As this
argument must be a “const string”, it must be known at compilation
time and thus cannot vary bar to bar.</strong> It can, however, contain
placeholders which will be replaced at runtime by dynamic values
that may change bar to bar. See this page’s
<a href="#placeholders">Placeholders</a> section for a list.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
function does not include a <code dir="auto">freq</code> parameter. The frequency of
<em>alertcondition() alerts</em> is determined by users in the “Create Alert”
dialog box.</p>
<h3 class="md-heading" id="using-one-condition"><a href="#using-one-condition">Using one condition<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Here is an example of code creating <em>alertcondition() events</em>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`alertcondition()` on single condition")
r = ta.rsi(close, 20)

xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)

plot(r, "RSI")
hline(50)
plotchar(xUp, "Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(xDn, "Short", "▼", location.top,    color.red,  size = size.tiny)

alertcondition(xUp, "Long Alert",  "Go long")
alertcondition(xDn, "Short Alert", "Go short ")</code></div>
<p>Because we have two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls in our script, two different alerts will be available in the
“Create Alert” dialog box’s “Condition” field: “Long Alert” and
“Short Alert”.</p>
<p>If we wanted to include the value of RSI when the cross occurs, we could
not simply add its value to the <code dir="auto">message</code> string using
<code dir="auto">str.tostring(r)</code>, as we could in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a>
call or in an <code dir="auto">alert_message</code> argument in a strategy. We can, however,
include it using a placeholder. This shows two alternatives:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">alertcondition(xUp, "Long Alert",  "Go long. RSI is {{plot_0}}")
alertcondition(xDn, "Short Alert", 'Go short. RSI is {{plot("RSI")}}')</code></div>
<p>Note that:</p>
<ul>
<li>The first line uses the <code dir="auto">{{plot_0}}</code> placeholder, where the plot
number corresponds to the order of the plot in the script.</li>
<li>The second line uses the <code dir="auto">{{plot("[plot_title]")}}</code> type of
placeholder, which must include the <code dir="auto">title</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call used in our script to plot RSI. Double quotes are used to wrap
the plot’s title inside the <code dir="auto">{{plot("RSI")}}</code> placeholder. This
requires that we use single quotes to wrap the <code dir="auto">message</code> string.</li>
<li>Using one of these methods, we can include any numeric value that is
plotted by our indicator, but as strings cannot be plotted, no
string variable can be used.</li>
</ul>
<h3 class="md-heading" id="using-compound-conditions"><a href="#using-compound-conditions">Using compound conditions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If we want to offer script users the possiblity of creating a single
alert from an indicator using multiple
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls, we will need to provide options in the script’s inputs through
which users will indicate the conditions they want to trigger their
alert before creating it.</p>
<p>This script demonstrates one way to do it:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`alertcondition()` on multiple conditions")
detectLongsInput  = input.bool(true, "Detect Longs")
detectShortsInput = input.bool(true, "Detect Shorts")

r = ta.rsi(close, 20)
// Detect crosses.
xUp = ta.crossover( r, 50)
xDn = ta.crossunder(r, 50)
// Only generate entries when the trade's direction is allowed in inputs.
enterLong  = detectLongsInput  and xUp
enterShort = detectShortsInput and xDn

plot(r)
plotchar(enterLong,  "Go Long",  "▲", location.bottom, color.lime, size = size.tiny)
plotchar(enterShort, "Go Short", "▼", location.top,    color.red,  size = size.tiny)
hline(50)
// Trigger the alert when one of the conditions is met.
alertcondition(enterLong or enterShort, "Compound alert", "Entry")</code></div>
<p>Note how the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
call is allowed to trigger on one of two conditions. Each condition can
only trigger the alert if the user enables it in the script’s inputs
before creating the alert.</p>
<h3 class="md-heading" id="placeholders"><a href="#placeholders">Placeholders<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>These placeholders can be used in the <code dir="auto">message</code> argument of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls. They will be replaced with dynamic values when the alert
triggers. They are the only way to include dynamic values (values that
can vary bar to bar) in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
messages.</p>
<p>Note that users creating <em>alertcondition() alerts</em> from the “Create
Alert” dialog box in the charts UI are also able to use these
placeholders in the dialog box’s “Message” field.</p>
<p><code dir="auto">{{exchange}}</code></p>
<p>Exchange of the symbol used in the alert (NASDAQ, NYSE, MOEX, etc.).
Note that for delayed symbols, the exchange will end with “_DL” or
“_DLY.” For example, “NYMEX_DL.”</p>
<p><code dir="auto">{{interval}}</code></p>
<p>Returns the timeframe of the chart the alert is created on. Note
that Range charts are calculated based on 1m data, so the
placeholder will always return “1” on any alert created on a Range
chart.</p>
<p><code dir="auto">{{open}}</code>, <code dir="auto">{{high}}</code>, <code dir="auto">{{low}}</code>, <code dir="auto">{{close}}</code>, <code dir="auto">{{volume}}</code></p>
<p>Corresponding values of the bar on which the alert has been
triggered.</p>
<p><code dir="auto">{{plot_0}}</code>, <code dir="auto">{{plot_1}}</code>, […], <code dir="auto">{{plot_19}}</code></p>
<p>Value of the corresponding plot number. Plots are numbered from zero
to 19 in order of appearance in the script, so only one of the first
20 plots can be used. For example, the built-in “Volume” indicator
has two output series: Volume and Volume MA, so you could use the
following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">alertcondition(volume &gt; ta.sma(volume,20), "Volume alert", "Volume ({{plot_0}}) &gt; average ({{plot_1}})")</code></div>
<p><code dir="auto">{{plot("[plot_title]")}}</code></p>
<p>This placeholder can be used when one needs to refer to a plot using
the <code dir="auto">title</code> argument used in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call. Note that double quotation marks (<code dir="auto">"</code>) <strong>must</strong> be used inside
the placeholder to wrap the <code dir="auto">title</code> argument. This requires that a
single quotation mark (<code dir="auto">'</code>) be used to wrap the <code dir="auto">message</code> string:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
r = ta.rsi(close, 14)
xUp = ta.crossover(r, 50)
plot(r, "RSI", display = display.none)
alertcondition(xUp, "xUp alert", message = 'RSI is bullish at: {{plot("RSI")}}')</code></div>
<p><code dir="auto">{{ticker}}</code></p>
<p>Ticker of the symbol used in the alert (AAPL, BTCUSD, etc.).</p>
<p><code dir="auto">{{time}}</code></p>
<p>Returns the time at the beginning of the bar. Time is UTC, formatted
as <code dir="auto">yyyy-MM-ddTHH:mm:ssZ</code>, so for example: <code dir="auto">2019-08-27T09:56:00Z</code>.</p>
<p><code dir="auto">{{timenow}}</code></p>
<p>Current time when the alert triggers, formatted in the same way as
<code dir="auto">{{time}}</code>. The precision is to the nearest second, regardless of
the chart’s timeframe.</p>
<h2 class="md-heading" id="avoiding-repainting-with-alerts"><a href="#avoiding-repainting-with-alerts">Avoiding repainting with alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The most common instances of repainting traders want to avoid with
alerts are ones where they must prevent an alert from triggering at some
point during the realtime bar when it would <strong>not</strong> have triggered at
its close. This can happen when these conditions are met:</p>
<ul>
<li>The calculations used in the condition triggering the alert can vary
during the realtime bar. This will be the case with any calculation
using <code dir="auto">high</code>, <code dir="auto">low</code> or <code dir="auto">close</code>, for example, which includes almost
all built-in indicators. It will also be the case with the result of
any
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
call using a higher timeframe than the chart’s, when the higher
timeframe’s current bar has not closed yet.</li>
<li>The alert can trigger before the close of the realtime bar, so with
any frequency other than “Once Per Bar Close”.</li>
</ul>
<p>The simplest way to avoid this type of repainting is to configure the
triggering frequency of alerts so they only trigger on the close of the
realtime bar. There is no panacea; avoiding this type of repainting
<strong>always</strong> entails waiting for confirmed information, which means the
trader must sacrifice immediacy to achieve reliability.</p>
<p>Note that other types of repainting such as those documented in our
<a href="/pine-script-docs/v5/concepts/repainting/">Repainting</a> section may
not be preventable by simply triggering alerts on the close of realtime
bars.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/backgrounds"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Backgrounds <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Backgrounds</span> </div> </div> <div data-astro-cid-xgirumru="" data-toc-hidden="" id="slot-container"> <h1 class="md-heading" id="concepts-backgrounds"><a href="#backgrounds">Backgrounds<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
function changes the color of the script’s background. If the script is
running in <code dir="auto">overlay = true</code> mode, then it will color the chart’s
background.</p>
<p>The function’s signature is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">bgcolor(color, offset, editable, show_last, title, force_overlay) → void</span></div></div></code></pre></figure></link></div>
<p>Its <code dir="auto">color</code> parameter allows a “series color” to be used for its
argument, so it can be dynamically calculated in an expression.</p>
<p>If the correct transparency is not part of the color to be used, it can
be be generated using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dnew">color.new()</a>
function.</p>
<p>Here is a script that colors the background of trading sessions (try it
on 30min EURUSD, for example):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Session backgrounds", overlay = true)

// Default color constants using tranparency of 25.
BLUE_COLOR   = #0050FF40
PURPLE_COLOR = #0000FF40
PINK_COLOR   = #5000FF40
NO_COLOR     = color(na)

// Allow user to change the colors.
preMarketColor  = input.color(BLUE_COLOR, "Pre-market")
regSessionColor = input.color(PURPLE_COLOR, "Pre-market")
postMarketColor = input.color(PINK_COLOR, "Pre-market")

// Function returns `true` when the bar's time is 
timeInRange(tf, session) =&gt; 
    time(tf, session) != 0

// Function prints a message at the bottom-right of the chart.
f_print(_text) =&gt; 
    var table _t = table.new(position.bottom_right, 1, 1)
    table.cell(_t, 0, 0, _text, bgcolor = color.yellow)

var chartIs30MinOrLess = timeframe.isseconds or (timeframe.isintraday and timeframe.multiplier &lt;=30)
sessionColor = if chartIs30MinOrLess
    switch
        timeInRange(timeframe.period, "0400-0930") =&gt; preMarketColor
        timeInRange(timeframe.period, "0930-1600") =&gt; regSessionColor
        timeInRange(timeframe.period, "1600-2000") =&gt; postMarketColor
        =&gt; NO_COLOR
else
    f_print("No background is displayed.\nChart timeframe must be &lt;= 30min.")
    NO_COLOR

bgcolor(sessionColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="520" loading="lazy" src="images/4d0f0f94b31cfce0c864ea4f6dc3cd98.webp" width="1406"/></div></p>
<p>Note that:</p>
<ul>
<li>The script only works on chart timeframes of 30min or less. It
prints an error message when the chart’s timeframe is higher than
30min.</li>
<li>When the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s <code dir="auto">else</code> branch is used because the chart’s timeframe is
incorrect, the local block returns the <code dir="auto">NO_COLOR</code> color so that no
background is displayed in that case.</li>
<li>We first initialize constants using our base colors, which include
the <code dir="auto">40</code> transparency in hex notation at the end. 40 in the
hexadecimal notation on the reversed 00-FF scale for transparency
corresponds to 75 in Pine Script™‘s 0-100 decimal scale for
transparency.</li>
<li>We provide color inputs allowing script users to change the default
colors we propose.</li>
</ul>
<p>In our next example, we generate a gradient for the background of a CCI
line:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("CCI Background")

bullColor = input.color(color.lime, "🠅", inline = "1")
bearColor = input.color(color.fuchsia, "🠇", inline = "1")

// Calculate CCI.
myCCI = ta.cci(hlc3, 20)
// Get relative position of CCI in last 100 bars, on a 0-100% scale.
myCCIPosition = ta.percentrank(myCCI, 100)
// Generate a bull gradient when position is 50-100%, bear gradient when position is 0-50%.
backgroundColor = if myCCIPosition &gt;= 50
    color.from_gradient(myCCIPosition, 50, 100, color.new(bullColor, 75), bullColor)
else
    color.from_gradient(myCCIPosition, 0, 50, bearColor, color.new(bearColor, 75))

// Wider white line background.
plot(myCCI, "CCI", color.white, 3)
// Think black line.
plot(myCCI, "CCI", color.black, 1)
// Zero level.
hline(0)
// Gradient background.
bgcolor(backgroundColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="742" loading="lazy" src="images/8698613faf9026a61ed28f2d1ece286e.webp" width="1402"/></div></p>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dcci">ta.cci()</a>
built-in function to calculate the indicator value.</li>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#ta.percentrank">ta.percentrank()</a>
built-in function to calculate <code dir="auto">myCCIPosition</code>, i.e., the percentage
of past <code dir="auto">myCCI</code> values in the last 100 bars that are below the
current value of <code dir="auto">myCCI</code>.</li>
<li>To calculate the gradient, we use two different calls of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>
built-in: one for the bull gradient when <code dir="auto">myCCIPosition</code> is in the
50-100% range, which means that more past values are below its
current value, and another for the bear gradient when
<code dir="auto">myCCIPosition</code> is in the 0-49.99% range, which means that more past
values are above it.</li>
<li>We provide inputs so the user can change the bull/bear colors, and
we place both color input widgets on the same line using
<code dir="auto">inline = "1"</code> in both
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dcolor">input.color()</a>
calls.</li>
<li>We plot the CCI signal using two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls to achieve the best contrast over the busy background: the
first plot is a 3-pixel wide white background, the second
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call plots the thin, 1-pixel wide black line.</li>
</ul>
<p>See the <a href="/pine-script-docs/v5/concepts/colors/">Colors</a> page for
more examples of backgrounds.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/alerts"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Alerts  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-coloring"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Bar coloring <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Bar coloring</span> </div> </div> <div data-astro-cid-xgirumru="" data-toc-hidden="" id="slot-container"> <h1 class="md-heading" id="concepts-bar-coloring"><a href="#bar-coloring">Bar coloring<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a> function colors bars on the main chart, regardless of whether the script is running in the main chart pane or a separate pane.</p>
<p>The function’s signature is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">barcolor(color, offset, editable, show_last, title, display) → void</span></div></div></code></pre></figure></link></div>
<p>The coloring can be conditional because the <code dir="auto">color</code> parameter accepts “series color” arguments.</p>
<p>The following script renders <em>inside</em> and <em>outside</em> bars in different colors:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="430" loading="lazy" src="images/ff729efb6df2927bc9ba38f02e1621e8.webp" width="1350"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("barcolor example", overlay = true)
isUp = close &gt; open
isDown = close &lt;= open
isOutsideUp = high &gt; high[1] and low &lt; low[1] and isUp
isOutsideDown = high &gt; high[1] and low &lt; low[1] and isDown
isInside = high &lt; high[1] and low &gt; low[1]
barcolor(isInside ? color.yellow : isOutsideUp ? color.aqua : isOutsideDown ? color.purple : na)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value leaves bars as is.</li>
<li>In the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a> call, we use embedded <a href="https://www.tradingview.com/pine-script-reference/v5/#op_%7Bquestion%7D%7Bcolon%7D">?:</a> ternary operator expressions to select the color.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/backgrounds"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Backgrounds  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-plotting"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Bar plotting <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Bar plotting</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-bar-plotting"><a href="#bar-plotting">Bar plotting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
built-in function is used to plot candles.
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>
is used to plot conventional bars.</p>
<p>Both functions require four arguments that will be used for the OHLC
prices
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>)
of the bars they will be plotting. If one of those is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, no
bar is plotted.</p>
<h2 class="md-heading" id="plotting-candles-with-plotcandle"><a href="#plotting-candles-with-plotcandle">Plotting candles with `plotcandle()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The signature of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plotcandle(open, high, low, close, title, color, wickcolor, editable, show_last, bordercolor, display) → void</span></div></div></code></pre></figure></link></div>
<p>This plots simple candles, all in blue, using the habitual OHLC values,
in a separate pane:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Single-color candles")
plotcandle(open, high, low, close)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="604" loading="lazy" src="images/bc065a13523d53583cf27036acc84681.webp" width="1350"/></div></p>
<p>To color them green or red, we can use the following code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 2")
paletteColor = close &gt;= open ? color.lime : color.red
plotbar(open, high, low, close, color = paletteColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="604" loading="lazy" src="images/1594abbcd448ffa769aa365ace3bbb96.webp" width="1350"/></div></p>
<p>Note that the <code dir="auto">color</code> parameter accepts “series color” arguments, so
constant values such as <code dir="auto">color.red</code>, <code dir="auto">color.lime</code>, <code dir="auto">"#FF9090"</code>, as well
as expressions that calculate colors at runtime, as is done with the
<code dir="auto">paletteColor</code> variable here, will all work.</p>
<p>You can build bars or candles using values other than the actual OHLC
values. For example you could calculate and plot smoothed candles using
the following code, which also colors wicks depending on the position of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
relative to the smoothed close (<code dir="auto">c</code>) of our indicator:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Smoothed candles", overlay = true)
lenInput = input.int(9)
smooth(source, length) =&gt;
    ta.sma(source, length)
o = smooth(open, lenInput)
h = smooth(high, lenInput)
l = smooth(low, lenInput)
c = smooth(close, lenInput)
ourWickColor = close &gt; c ? color.green : color.red
plotcandle(o, h, l, c, wickcolor = ourWickColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="602" loading="lazy" src="images/3b6b161cd049c228c4c3a73b20392b71.webp" width="1356"/></div></p>
<p>You may find it useful to plot OHLC values taken from a higher
timeframe. You can, for example, plot daily bars on an intraday chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// NOTE: Use this script on an intraday chart.
//@version=5
indicator("Daily bars")

// Use gaps to only return data when the 1D timeframe completes, `na` otherwise.
[o, h, l, c] = request.security(syminfo.tickerid, "D", [open, high, low, close], gaps = barmerge.gaps_on)

var color UP_COLOR = color.silver
var color DN_COLOR = color.blue
color wickColor = c &gt;= o ? UP_COLOR : DN_COLOR
color bodyColor = c &gt;= o ? color.new(UP_COLOR, 70) : color.new(DN_COLOR, 70)
// Only plot candles on intraday timeframes, 
// and when non `na` values are returned by `request.security()` because a HTF has completed.
plotcandle(timeframe.isintraday ? o : na, h, l, c, color = bodyColor, wickcolor = wickColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="836" loading="lazy" src="images/74905ebe54e1a97e9d8bd602f38d0097.webp" width="1762"/></div></p>
<p>Note that:</p>
<ul>
<li>
<p>We show the script’s plot after having used “Visual Order/Bring to
Front” from the script’s “More” menu. This causes our script’s
candles to appear on top of the chart’s candles.</p>
</li>
<li>
<p>The script will only display candles when two conditions are met:</p>
<ul>
<li>The chart is using an intraday timeframe (see the check on</li>
</ul>
<blockquote>
<p><code dir="auto">timeframe.isintraday</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
call). We do this because it’s not useful to show a daily
value on timeframes higher or equal to 1D.</p>
</blockquote>
<ul>
<li>The</li>
</ul>
<blockquote>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
function returns non
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values (see <code dir="auto">gaps = barmerge.gaps_on</code> in the function call).</p>
</blockquote>
</li>
<li>
<p>We use a tuple (<code dir="auto">[open, high, low, close]</code>) with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch four values in one call.</p>
</li>
<li>
<p>We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
to declare our <code dir="auto">UP_COLOR</code> and <code dir="auto">DN_COLOR</code> color constants on bar zero
only. We use constants because those colors are used in more than
one place in our code. This way, if we need to change them, we need
only do so in one place.</p>
</li>
<li>
<p>We create a lighter transparency for the body of our candles in the
<code dir="auto">bodyColor</code> variable initialization, so they don’t obstruct the
chart’s candles.</p>
</li>
</ul>
<h2 class="md-heading" id="plotting-bars-with-plotbar"><a href="#plotting-bars-with-plotbar">Plotting bars with `plotbar()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The signature of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>
is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plotbar(open, high, low, close, title, color, editable, show_last, display, force_overlay) → void</span></div></div></code></pre></figure></div>
<p>Note that
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>
has no parameter for <code dir="auto">bordercolor</code> or <code dir="auto">wickcolor</code>, as there are no
borders or wicks on conventional bars.</p>
<p>This plots conventional bars using the same coloring logic as in the
second example of the previous section:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Dual-color bars")
paletteColor = close &gt;= open ? color.lime : color.red
plotbar(open, high, low, close, color = paletteColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="434" loading="lazy" src="images/1a4cde7a9dca44ec9c2b11e67c25feeb.webp" width="1354"/></div></p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-coloring"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Bar coloring  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-states"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Bar states <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Bar states</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-bar-states"><a href="#bar-states">Bar states<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A set of built-in variables in the <code dir="auto">barstate</code> namespace allow your
script to detect different properties of the bar on which the script is
currently executing.</p>
<p>These states can be used to restrict the execution or the logic of your
code to specific bars.</p>
<p>Some built-ins return information on the trading session the current bar
belongs to. They are explained in the
<a href="/pine-script-docs/v5/concepts/sessions/#session-states">Session states</a> section.</p>
<h2 class="md-heading" id="bar-state-built-in-variables"><a href="#bar-state-built-in-variables">Bar state built-in variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Note that while indicators and libraries run on all price or volume
updates in real time, strategies not using <code dir="auto">calc_on_every_tick</code> will
not; they will only execute when the realtime bar closes. This will
affect the detection of bar states in that type of script. On open
markets, for example, this code will not display a background until the
realtime closes because that is when the strategy runs:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("S")
bgcolor(barstate.islast ? color.silver : na)</code></div>
<h3 class="md-heading" id="barstateisfirst"><a href="#barstateisfirst">`barstate.isfirst`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disfirst">barstate.isfirst</a>
is only <code dir="auto">true</code> on the dataset’s first bar, i.e., when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
is zero.</p>
<p>It can be useful to initialize variables on the first bar only, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Declare array and set its values on the first bar only.
FILL_COLOR = color.green
var fillColors = array.new_color(0)
if barstate.isfirst
    // Initialize the array elements with progressively lighter shades of the fill color.
    array.push(fillColors, color.new(FILL_COLOR, 70))
    array.push(fillColors, color.new(FILL_COLOR, 75))
    array.push(fillColors, color.new(FILL_COLOR, 80))
    array.push(fillColors, color.new(FILL_COLOR, 85))
    array.push(fillColors, color.new(FILL_COLOR, 90))</code></div>
<h3 class="md-heading" id="barstateislast"><a href="#barstateislast">`barstate.islast`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
is <code dir="auto">true</code> if the current bar is the last one on the chart, whether that
bar is a realtime bar or not.</p>
<p>It can be used to restrict the execution of code to the chart’s last
bar, which is often useful when drawing lines, labels or tables. Here,
we use it to determine when to update a label which we want to appear
only on the last bar. We create the label only once and then update its
properties using <code dir="auto">label.set_*()</code> functions because it is more efficient:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
// Create label on the first bar only.
var label hiLabel = label.new(na, na, "")
// Update the label's position and text on the last bar,
// including on all realtime bar updates.
if barstate.islast
    label.set_xy(hiLabel, bar_index, high)
    label.set_text(hiLabel, str.tostring(high, format.mintick))</code></div>
<h3 class="md-heading" id="barstateishistory"><a href="#barstateishistory">`barstate.ishistory`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dishistory">barstate.ishistory</a>
is <code dir="auto">true</code> on all historical bars. It can never be <code dir="auto">true</code> on a bar when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disrealtime">barstate.isrealtime</a>
is also <code dir="auto">true</code>, and it does not become <code dir="auto">true</code> on a realtime bar’s
closing update, when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
becomes <code dir="auto">true</code>. On closed markets, it can be <code dir="auto">true</code> on the same bar
where
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
is also <code dir="auto">true</code>.</p>
<h3 class="md-heading" id="barstateisrealtime"><a href="#barstateisrealtime">`barstate.isrealtime`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disrealtime">barstate.isrealtime</a>
is <code dir="auto">true</code> if the current data update is a real-time bar update, <code dir="auto">false</code>
otherwise (thus it is historical). Note that
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
is also <code dir="auto">true</code> on all realtime bars.</p>
<h3 class="md-heading" id="barstateisnew"><a href="#barstateisnew">`barstate.isnew`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
is <code dir="auto">true</code> on all historical bars and on the realtime bar’s first
(opening) update.</p>
<p>All historical bars are considered <em>new</em> bars because the Pine Script™
runtime executes your script on each bar sequentially, from the chart’s
first bar in time, to the last. Each historical bar is thus <em>discovered</em>
by your script as it executes, bar to bar.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
can be useful to reset
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
variables when a new realtime bar comes in. The following code will
reset <code dir="auto">updateNo</code> to 1 on all historical bars and at the beginning of
each realtime bar. It calculates the number of realtime updates during
each realtime bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
updateNo() =&gt; 
    varip int updateNo = na
    if barstate.isnew
        updateNo := 1
    else
        updateNo += 1
plot(updateNo())</code></div>
<h3 class="md-heading" id="barstateisconfirmed"><a href="#barstateisconfirmed">`barstate.isconfirmed`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
is <code dir="auto">true</code> on all historical bars and on the last (closing) update of a
realtime bar.</p>
<p>It can be useful to avoid repainting by requiring the realtime bar to be
closed before a condition can become <code dir="auto">true</code>. We use it here to hold
plotting of our RSI until the realtime bar closes and becomes an elapsed
realtime bar. It will plot on historical bars because
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
is always <code dir="auto">true</code> on them:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
myRSI = ta.rsi(close, 20)
plot(barstate.isconfirmed ? myRSI : na)</code></div>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
will not work when used in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
call.</p>
<h3 class="md-heading" id="barstateislastconfirmedhistory"><a href="#barstateislastconfirmedhistory">`barstate.islastconfirmedhistory`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislastconfirmedhistory">barstate.islastconfirmedhistory</a>
is <code dir="auto">true</code> if the script is executing on the dataset’s last bar when the
market is closed, or on the bar immediately preceding the realtime bar
if the market is open.</p>
<p>It can be used to detect the first realtime bar with
<code dir="auto">barstate.islastconfirmedhistory[1]</code>, or to postpone server-intensive
calculations until the last historical bar, which would otherwise be
undetectable on open markets.</p>
<h2 class="md-heading" id="example"><a href="#example">Example<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Here is an example of a script using <code dir="auto">barstate.*</code> variables:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Bar States", overlay = true, max_labels_count = 500)

stateText() =&gt;
    string txt = ""
    txt += barstate.isfirst     ? "isfirst\n"     : ""
    txt += barstate.islast      ? "islast\n"      : ""
    txt += barstate.ishistory   ? "ishistory\n"   : ""
    txt += barstate.isrealtime  ? "isrealtime\n"  : ""
    txt += barstate.isnew       ? "isnew\n"       : ""
    txt += barstate.isconfirmed ? "isconfirmed\n" : ""
    txt += barstate.islastconfirmedhistory ? "islastconfirmedhistory\n" : ""

labelColor = switch
    barstate.isfirst                =&gt; color.fuchsia
    barstate.islastconfirmedhistory =&gt; color.gray
    barstate.ishistory              =&gt; color.silver
    barstate.isconfirmed            =&gt; color.orange
    barstate.isnew                  =&gt; color.red
    =&gt; color.yellow

label.new(bar_index, na, stateText(), yloc = yloc.abovebar, color = labelColor)</code></div>
<p>Note that:</p>
<ul>
<li>Each state’s name will appear in the label’s text when it is
<code dir="auto">true</code>.</li>
<li>There are five possible colors for the label’s background:
<ul>
<li>fuchsia on the first bar</li>
<li>silver on historical bars</li>
<li>gray on the last confirmed historical bar</li>
<li>orange when a realtime bar is confirmed (when it closes and
becomes an elapsed realtime bar)</li>
<li>red on the realtime bar’s first execution</li>
<li>yellow for other executions of the realtime bar</li>
</ul>
</li>
</ul>
<p>We begin by adding the indicator to the chart of an open market, but
before any realtime update is received. Note how the last confirmed
history bar is identified in #1, and how the last bar is identified as
the last one, but is still considered a historical bar because no
realtime updates have been received.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="862" loading="lazy" src="images/092e3635f4ed54ac4aff8ea3aa404fef.webp" width="1786"/></div></p>
<p>Let’s look at what happens when realtime updates start coming in:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="672" loading="lazy" src="images/67e7d906ca6fc895a9d355526cab8da7.webp" width="1768"/></div></p>
<p>Note that:</p>
<ul>
<li>The realtime bar is red because it is its first execution, because
<code dir="auto">barstate.isnew</code> is <code dir="auto">true</code> and <code dir="auto">barstate.ishistory</code> is no longer
<code dir="auto">true</code>, so our
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure determing our color uses the <code dir="auto">barstate.isnew =&gt; color.red</code>
branch. This will usually not last long because on the next update
<code dir="auto">barstate.isnew</code> will no longer be <code dir="auto">true</code> so the label’s color will
turn yellow.</li>
<li>The label of elapsed realtime bars is orange because those bars were
not historical bars when they closed. Accordingly, the
<code dir="auto">barstate.ishistory =&gt; color.silver</code> branch in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure was not executed, but the next one,
<code dir="auto">barstate.isconfirmed =&gt; color.orange</code> was.</li>
</ul>
<p>This last example shows how the realtime bar’s label will turn yellow
after the first execution on the bar. This is the way the label will
usually appear on realtime bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="864" loading="lazy" src="images/ecec4cd6d37775d6aa22e0d5557a8f7b.webp" width="1784"/></div></p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-plotting"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Bar plotting  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/chart-information"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Chart information <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Chart information</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-chart-information"><a href="#chart-information">Chart information<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The way scripts can obtain information about the chart and symbol they
are currently running on is through a subset of Pine Script™‘s
<a href="/pine-script-docs/v5/language/built-ins/#built-in-variables">built-in variables</a>. The ones we cover here allow scripts to access information
relating to:</p>
<ul>
<li>The chart’s prices and volume</li>
<li>The chart’s symbol</li>
<li>The chart’s timeframe</li>
<li>The session (or time period) the symbol trades on</li>
</ul>
<h2 class="md-heading" id="prices-and-volume"><a href="#prices-and-volume">Prices and volume<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The built-in variables for OHLCV values are:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>:
the bar’s opening price.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>:
the bar’s highest price, or the highest price reached during the
realtime bar’s elapsed time.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>:
the bar’s lowest price, or the lowest price reached during the
realtime bar’s elapsed time.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>:
the bar’s closing price, or the <strong>current price</strong> in the realtime
bar.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>:
the volume traded during the bar, or the volume traded during the
realtime bar’s elapsed time. The unit of volume information varies
with the instrument. It is in shares for stocks, in lots for forex,
in contracts for futures, in the base currency for crypto, etc.</li>
</ul>
<p>Other values are available through:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>:
the average of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>:
the average of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>:
the average of the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values.</li>
</ul>
<p>On historical bars, the values of the above variables do not vary during
the bar because only OHLCV information is available on them. When
running on historical bars, scripts execute on the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
when all the bar’s information is known and cannot change during the
script’s execution on the bar.</p>
<p>Realtime bars are another story altogether. When indicators (or
strategies using <code dir="auto">calc_on_every_tick = true</code>) run in realtime, the
values of the above variables (except
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>)
will vary between successive iterations of the script on the realtime
bar, because they represent their <strong>current</strong> value at one point in time
during the progress of the realtime bar. This may lead to one form of
<a href="/pine-script-docs/v5/concepts/repainting/">repainting</a>. See the
page on Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> for
more details.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
<a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">history-referencing operator</a> can be used to refer to past values of the built-in
variables, e.g., <code dir="auto">close[1]</code> refers to the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
on the previous bar, relative to the particular bar the script is
executing on.</p>
<h2 class="md-heading" id="symbol-information"><a href="#symbol-information">Symbol information<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Built-in variables in the <code dir="auto">syminfo</code> namespace provide scripts with
information on the symbol of the chart the script is running on. This
information changes every time a script user changes the chart’s
symbol. The script then re-executes on all the chart’s bars using the
new values of the built-in variables:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dbasecurrency">syminfo.basecurrency</a>:
the base currency, e.g., “BTC” in “BTCUSD”, or “EUR” in
“EURUSD”.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dcurrency">syminfo.currency</a>:
the quote currency, e.g., “USD” in “BTCUSD”, or “CAD” in
“USDCAD”.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Ddescription">syminfo.description</a>:
The long description of the symbol.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dmintick">syminfo.mintick</a>:
The symbol’s tick value, or the minimum increment price can move
in. Not to be confused with <em>pips</em> or <em>points</em>. On “ES1!” (“S&amp;P
500 E-Mini”) the tick size is 0.25 because that is the minimal
increment the price moves in.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dpointvalue">syminfo.pointvalue</a>:
The point value is the multiple of the underlying asset determining
a contract’s value. On “ES1!” (“S&amp;P 500 E-Mini”) the point
value is 50, so a contract is worth 50 times the price of the
instrument.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dprefix">syminfo.prefix</a>:
The prefix is the exchange or broker’s identifier: “NASDAQ” or
“BATS” for “AAPL”, “CME_MINI_DL” for “ES1!”.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Droot">syminfo.root</a>:
It is the ticker’s prefix for structured tickers like those of
futures. It is “ES” for “ES1!”, “ZW” for “ZW1!”.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dsession">syminfo.session</a>:
It reflects the session setting on the chart for that symbol. If the
“Chart settings/Symbol/Session” field is set to “Extended”, it
will only return “extended” if the symbol and the user’s feed
allow for extended sessions. It is rarely displayed and used mostly
as an argument to the <code dir="auto">session</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dticker">syminfo.ticker</a>:
It is the symbol’s name, without the exchange part
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dprefix">syminfo.prefix</a>):
“BTCUSD”, “AAPL”, “ES1!”, “USDCAD”.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtickerid">syminfo.tickerid</a>:
This string is rarely displayed. It is mostly used as an argument
for
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>‘s
<code dir="auto">symbol</code> parameter. It includes session, prefix and ticker
information.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtimezone">syminfo.timezone</a>:
The timezone the symbol is traded in. The string is an <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" rel="nofollow">IANA time
zone database
name</a>
(e.g., “America/New_York”).</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtype">syminfo.type</a>:
The type of market the symbol belongs to. The values are “stock”,
“futures”, “index”, “forex”, “crypto”, “fund”, “dr”,
“cfd”, “bond”, “warrant”, “structured” and “right”.</li>
</ul>
<p>This script will display the values of those built-in variables on the
chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`syminfo.*` built-ins", "", true)
printTable(txtLeft, txtRight) =&gt; 
    var table t = table.new(position.middle_right, 2, 1)
    table.cell(t, 0, 0, txtLeft, bgcolor = color.yellow, text_halign = text.align_right)
    table.cell(t, 1, 0, txtRight, bgcolor = color.yellow, text_halign = text.align_left)

nl = "\n"
left =
  "syminfo.basecurrency: "  + nl +
  "syminfo.currency: "      + nl +
  "syminfo.description: "   + nl +
  "syminfo.mintick: "       + nl +
  "syminfo.pointvalue: "    + nl +
  "syminfo.prefix: "        + nl +
  "syminfo.root: "          + nl +
  "syminfo.session: "       + nl +
  "syminfo.ticker: "        + nl +
  "syminfo.tickerid: "      + nl +
  "syminfo.timezone: "      + nl +
  "syminfo.type: "

right =
  syminfo.basecurrency              + nl +
  syminfo.currency                  + nl +
  syminfo.description               + nl +
  str.tostring(syminfo.mintick)     + nl +
  str.tostring(syminfo.pointvalue)  + nl +
  syminfo.prefix                    + nl +
  syminfo.root                      + nl +
  syminfo.session                   + nl +
  syminfo.ticker                    + nl +
  syminfo.tickerid                  + nl +
  syminfo.timezone                  + nl +
  syminfo.type

printTable(left, right)</code></div>
<h2 class="md-heading" id="chart-timeframe"><a href="#chart-timeframe">Chart timeframe<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A script can obtain information on the type of timeframe used on the
chart using these built-ins, which all return a “simple bool” result:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disseconds">timeframe.isseconds</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disminutes">timeframe.isminutes</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disintraday">timeframe.isintraday</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdaily">timeframe.isdaily</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disweekly">timeframe.isweekly</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dismonthly">timeframe.ismonthly</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Disdwm">timeframe.isdwm</a></li>
</ul>
<p>Two additional built-ins return more specific timeframe information:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dmultiplier">timeframe.multiplier</a>
returns a “simple int” containing the multiplier of the timeframe
unit. A chart timeframe of one hour will return <code dir="auto">60</code> because
intraday timeframes are expressed in minutes. A 30sec timeframe will
return <code dir="auto">30</code> (seconds), a daily chart will return <code dir="auto">1</code> (day), a
quarterly chart will return <code dir="auto">3</code> (months), and a yearly chart will
return <code dir="auto">12</code> (months). The value of this variable cannot be used as
an argument to <code dir="auto">timeframe</code> parameters in built-in functions, as they
expect a string in timeframe specifications format.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>
returns a string in Pine Script™‘s timeframe specification format.</li>
</ul>
<p>See the page on <a href="/pine-script-docs/v5/concepts/timeframes/">Timeframes</a> for more information.</p>
<h2 class="md-heading" id="session-information"><a href="#session-information">Session information<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Session information is available in different forms:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dsession">syminfo.session</a>
built-in variable returns a value that is either
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_session%7Bdot%7Dregular">session.regular</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_session%7Bdot%7Dextended">session.extended</a>.
It reflects the session setting on the chart for that symbol. If the
“Chart settings/Symbol/Session” field is set to “Extended”, it
will only return “extended” if the symbol and the user’s feed
allow for extended sessions. It is used when a session type is
expected, for example as the argument for the <code dir="auto">session</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>.</li>
<li><a href="/pine-script-docs/v5/concepts/sessions/#session-states">Session state built-ins</a> provide information on the trading session a bar belongs
to.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/bar-states"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Bar states  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/colors"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Colors <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Colors</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-colors"><a href="#colors">Colors<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Script visuals can play a critical role in the usability of the indicators we write in Pine Script™. Well-designed plots and drawings make indicators easier to use and understand. Good visual designs establish a visual hierarchy that allows the more important information to stand out, and the less important one to not get in the way.</p>
<p>Using colors in Pine can be as simple as you want, or as involved as your concept requires. The 4,294,967,296 possible assemblies of color and transparency available in Pine Script™ can be applied to:</p>
<ul>
<li>Any element you can plot or draw in an indicator’s visual space, be
it lines, fills, text or candles.</li>
<li>The background of a script’s visual space, whether the script is
running in its own pane, or in overlay mode on the chart.</li>
<li>The color of bars or the body of candles appearing on a chart.</li>
</ul>
<p>A script can only color the elements it places in its own visual space. The only exception to this rule is that a pane indicator can color chart bars or candles.</p>
<p>Pine Script™ has built-in colors such as <a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dgreen">color.green</a>, as well as functions like <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb()</a> which allow you to dynamically generate any color in the RGBA color space.</p>
<h3 class="md-heading" id="transparency"><a href="#transparency">Transparency<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Each color in Pine Script™ is defined by four values:</p>
<ul>
<li>Its red, green and blue components (0-255), following the <a href="https://en.wikipedia.org/wiki/RGB_color_space" rel="nofollow">RGB color
model</a>.</li>
<li>Its transparency (0-100), often referred to as the Alpha channel
outside Pine, as defined in the <a href="https://en.wikipedia.org/wiki/RGB_color_space" rel="nofollow">RGBA color
model</a>. Even though
transparency is expressed in the 0-100 range, its value can be a
“float” when used in functions, which gives you access to the 256
underlying values of the alpha channel.</li>
</ul>
<p>The transparency of a color defines how opaque it is: zero is fully opaque, 100 makes the color — whichever it is — invisible. Modulating transparency can be crucial in more involved color visuals or when using backgrounds, to control which colors dominate the others, and how they mix together when superimposed.</p>
<h3 class="md-heading" id="z-index"><a href="#z-index">Z-index<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When you place elements in a script’s visual space, they have relative depth on the <em>z</em> axis; some will appear on top of others. The <em>z-index</em> is a value that represents the position of elements on the <em>z</em> axis. Elements with the highest z-index appear on top.</p>
<p>Elements drawn in Pine Script™ are divided in groups. Each group has its own position in the <em>z</em> space, and <strong>within the same group</strong>, elements created last in the script’s logic will appear on top of other elements from the same group. An element of one group cannot be placed outside the region of the <em>z</em> space attributed to its group, so a plot can never appear on top of a table, for example, because tables have the highest z-index.</p>
<p>This list contains the groups of visual elements, ordered by increasing z-index, so background colors are always at the bottom of <em>z</em> space, and tables will always appear on top of all other elements:</p>
<ul>
<li>Background colors</li>
<li>Fills</li>
<li>Plots</li>
<li>Hlines</li>
<li>LineFills</li>
<li>Lines</li>
<li>Boxes</li>
<li>Labels</li>
<li>Tables</li>
</ul>
<p>Note that by using <code dir="auto">explicit_plot_zorder = true</code> in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>, you can control the relative z-index of <code dir="auto">plot*()</code>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a> visuals using their sequential order in the script.</p>
<h2 class="md-heading" id="constant-colors"><a href="#constant-colors">Constant colors<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are 17 built-in colors in Pine Script™. This table lists their names, hexadecimal equivalent, and RGB values as arguments to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb()</a>:</p>
<table><thead><tr><th>Name</th><th>Hex</th><th>RGB values</th></tr></thead><tbody><tr><td>color.aqua</td><td>#00BCD4</td><td>color.rgb(0, 188, 212)</td></tr><tr><td>color.black</td><td>#363A45</td><td>color.rgb(54, 58, 69)</td></tr><tr><td>color.blue</td><td>#2196F3</td><td>color.rgb(33, 150, 243)</td></tr><tr><td>color.fuchsia</td><td>#E040FB</td><td>color.rgb(224, 64, 251)</td></tr><tr><td>color.gray</td><td>#787B86</td><td>color.rgb(120, 123, 134)</td></tr><tr><td>color.green</td><td>#4CAF50</td><td>color.rgb(76, 175, 80)</td></tr><tr><td>color.lime</td><td>#00E676</td><td>color.rgb(0, 230, 118)</td></tr><tr><td>color.maroon</td><td>#880E4F</td><td>color.rgb(136, 14, 79)</td></tr><tr><td>color.navy</td><td>#311B92</td><td>color.rgb(49, 27, 146)</td></tr><tr><td>color.olive</td><td>#808000</td><td>color.rgb(128, 128, 0)</td></tr><tr><td>color.orange</td><td>#FF9800</td><td>color.rgb(255, 152, 0)</td></tr><tr><td>color.purple</td><td>#9C27B0</td><td>color.rgb(156, 39, 176)</td></tr><tr><td>color.red</td><td>#FF5252</td><td>color.rgb(255, 82, 82)</td></tr><tr><td>color.silver</td><td>#B2B5BE</td><td>color.rgb(178, 181, 190)</td></tr><tr><td>color.teal</td><td>#00897B</td><td>color.rgb(0, 137, 123)</td></tr><tr><td>color.white</td><td>#FFFFFF</td><td>color.rgb(255, 255, 255)</td></tr><tr><td>color.yellow</td><td>#FFEB3B</td><td>color.rgb(255, 235, 59)</td></tr></tbody></table>
<p>In the following script, all plots use the same <a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dolive">color.olive</a> color with a transparency of 40, but expressed in different ways. All five methods are functionally equivalent:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="540" loading="lazy" src="images/f52e487df0456cc9f17e56818e290444.webp" width="1796"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
// ————  Transparency (#99) is included in the hex value.
plot(ta.sma(close, 10), "10", #80800099)
// ————  Transparency is included in the color-generating function's arguments.
plot(ta.sma(close, 30), "30", color.new(color.olive, 40))
plot(ta.sma(close, 50), "50", color.rgb(128, 128, 0, 40))
  // ————  Use `transp` parameter (deprecated and advised against)
plot(ta.sma(close, 70), "70", color.olive, transp = 40)
plot(ta.sma(close, 90), "90", #808000, transp = 40)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The last two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls specify transparency using the <code dir="auto">transp</code> parameter. This use should
be avoided as the <code dir="auto">transp</code> is deprecated in Pine Script™ v5. Using the
<code dir="auto">transp</code> parameter to define transparency is not as flexible because it
requires an argument of <em>input integer</em> type, which entails it must be
known before the script is executed, and so cannot be calculated
dynamically, as your script executes bar to bar. Additionally, if you
use a <code dir="auto">color</code> argument that already includes transparency information,
as is done in the next three
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls, any argument used for the <code dir="auto">transp</code> parameter would have no
effect. This is also true for other functions with a <code dir="auto">transp</code> parameter.</p></div></aside>
<p>The colors in the previous script do not vary as the script executes bar to bar. Sometimes, however, colors need to be created as the script executes on each bar because they depend on conditions that are unknown at compile time, or when the script begins execution on bar zero. For those cases, programmers have two options:</p>
<ol>
<li>Use conditional statements to select colors from a few
pre-determined base colors.</li>
<li>Build new colors dynamically, by calculating them as the script
executes bar to bar, to implement color gradients, for example.</li>
</ol>
<h2 class="md-heading" id="conditional-coloring"><a href="#conditional-coloring">Conditional coloring<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Let’s say you want to color a moving average in different colors, depending on some conditions you define. To do so, you can use a conditional statement that will select a different color for each of your states. Let’s start by coloring a moving average in a bull color when it’s rising, and in a bear color when it’s not:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="468" loading="lazy" src="images/0412294cabb7471b24d7a6f8f8497031.webp" width="1534"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional colors", "", true)
int   lengthInput = input.int(20, "Length", minval = 2)
color maBullColorInput = input.color(color.green, "Bull")
color maBearColorInput = input.color(color.maroon, "Bear")
float ma = ta.sma(close, lengthInput)
// Define our states.
bool maRising  = ta.rising(ma, 1)
// Build our color.
color c_ma = maRising ? maBullColorInput : maBearColorInput
plot(ma, "MA", c_ma, 2)</code></div>
<p>Note that:</p>
<ul>
<li>We provide users of our script a selection of colors for our
bull/bear colors.</li>
<li>We define an <code dir="auto">maRising</code> boolean variable which will hold <code dir="auto">true</code> when
the moving average is higher on the current bar than it was on the
last.</li>
<li>We define a <code dir="auto">c_ma</code> color variable that is assigned one of our two
colors, depending on the value of the <code dir="auto">maRising</code> boolean. We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%7Bquestion%7D%7Bcolon%7D">? : ternary
operator</a>
to write our conditional statement.</li>
</ul>
<p>You can also use conditional colors to avoid plotting under certain conditions. Here, we plot high and low pivots using a line, but we do not want to plot anything when a new pivot comes in, to avoid the joints that would otherwise appear in pivot transitions. To do so, we test for pivot changes and use <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> as the color value when a change is detected, so that no line is plotted on that bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="472" loading="lazy" src="images/f9c271f55610ec7c3b4802e8756e6de2.webp" width="1530"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional colors", "", true)
int legsInput = input.int(5, "Pivot Legs", minval = 1)
color pHiColorInput = input.color(color.olive, "High pivots")
color pLoColorInput = input.color(color.orange, "Low pivots")
// Intialize the pivot level variables.
var float pHi = na
var float pLo = na
// When a new pivot is detected, save its value.
pHi := nz(ta.pivothigh(legsInput, legsInput), pHi)
pLo := nz(ta.pivotlow( legsInput, legsInput), pLo)
// When a new pivot is detected, do not plot a color.
plot(pHi, "High", ta.change(pHi) ? na : pHiColorInput, 2, plot.style_line)
plot(pLo, "Low",  ta.change(pLo) ? na : pLoColorInput, 2, plot.style_line)</code></div>
<p>To undertand how this code works, one must first know that <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">ta.pivothigh()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivotlow">ta.pivotlow()</a>, used as they are here without an argument to the <code dir="auto">source</code> parameter, will return a value when they find a <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>/<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> pivot, otherwise they return <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>When we test the value returned by the pivot function for <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> function, we allow the value returned to be assigned to the <code dir="auto">pHi</code> or <code dir="auto">pLo</code> variables only when it is not <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, otherwise the previous value of the variable is simply reassigned to it, which has no impact on its value. Keep in mind that previous values of <code dir="auto">pHi</code> and <code dir="auto">pLo</code> are preserved bar to bar because we use the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> keyword when initializing them, which causes the initialization to only occur on the first bar.</p>
<p>All that’s left to do next is, when we plot our lines, to insert a ternary conditional statement that will yield <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> for the color when the pivot value changes, or the color selected in the script’s inputs when the pivot level does not change.</p>
<h2 class="md-heading" id="calculated-colors"><a href="#calculated-colors">Calculated colors<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Using functions like <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dnew">color.new()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>, one can build colors on the fly, as the script executes bar to bar.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dnew">color.new()</a> is most useful when you need to generate different transparency levels from a base color.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb()</a> is useful when you need to build colors dynamically from red, green, blue, or tranparency components. While <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb()</a> creates a color, its sister functions <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dr">color.r()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dg">color.g()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Db">color.b()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dt">color.t()</a> can be used to extract the red, green, blue or transparency values from a color, which can in turn be used to generate a variant.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a> is useful to create linear gradients between two base colors. It determines which intermediary color to use by evaluating a source value against minimum and maximum values.</p>
<h3 class="md-heading" id="colornew"><a href="#colornew">color.new()<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Let’s put <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dnew">color.new(color, transp)</a> to use to create different transparencies for volume columns using one of two bull/bear base colors:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="548" loading="lazy" src="images/191da2e073d8b12aa2e330c68f047288.webp" width="1407"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Volume")
// We name our color constants to make them more readable.
var color GOLD_COLOR   = #CCCC00ff
var color VIOLET_COLOR = #AA00FFff
color bullColorInput = input.color(GOLD_COLOR,   "Bull")
color bearColorInput = input.color(VIOLET_COLOR, "Bear")
int levelsInput = input.int(10, "Gradient levels", minval = 1)
// We initialize only once on bar zero with `var`, otherwise the count would reset to zero on each bar.
var float riseFallCnt = 0
// Count the rises/falls, clamping the range to: 1 to `i_levels`.
riseFallCnt := math.max(1, math.min(levelsInput, riseFallCnt + math.sign(volume - nz(volume[1]))))
// Rescale the count on a scale of 80, reverse it and cap transparency to &lt;80 so that colors remains visible.
float transparency = 80 - math.abs(80 * riseFallCnt / levelsInput)
// Build the correct transparency of either the bull or bear color.
color volumeColor = color.new(close &gt; open ? bullColorInput : bearColorInput, transparency)
plot(volume, "Volume", volumeColor, 1, plot.style_columns)</code></div>
<p>Note that:</p>
<ul>
<li>In the next to last line of our script, we dynamically calculate the
column color by varying both the base color used, depending on
whether the bar is up or down, <strong>and</strong> the transparency level, which
is calculated from the cumulative rises or falls of volume.</li>
<li>We offer the script user control over not only the base bull/bear
colors used, but also on the number of brightness levels we use. We
use this value to determine the maximum number of rises or falls we
will track. Giving users the possiblity to manage this value allows
them to adapt the indicator’s visuals to the timeframe or market
they use.</li>
<li>We take care to control the maximum level of transparency we use so
that it never goes higher than 80. This ensures our colors always
retain some visibility.</li>
<li>We also set the minimum value for the number of levels to 1 in the
inputs. When the user selects 1, the volume columns will be either
in bull or bear color of maximum brightness — or transparency zero.</li>
</ul>
<h3 class="md-heading" id="colorrgb"><a href="#colorrgb">color.rgb()<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In our next example we use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Drgb">color.rgb(red, green, blue, transp)</a> to build colors from RGBA values. We use the result in a holiday season gift for our friends, so they can bring their TradingView charts to parties:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="548" loading="lazy" src="images/24d0702a37a43bd2fe261b85989c1d6f.webp" width="1786"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Holiday candles", "", true)
float r = math.random(0, 255)
float g = math.random(0, 255)
float b = math.random(0, 255)
float t = math.random(0, 100)
color holidayColor = color.rgb(r, g, b, t)
plotcandle(open, high, low, close, color = c_holiday, wickcolor = holidayColor, bordercolor = c_holiday)</code></div>
<p>Note that:</p>
<ul>
<li>We generate values in the zero to 255 range for the red, green and
blue channels, and in the zero to 100 range for transparency. Also
note that because
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Drandom">math.random()</a>
returns float values, the float 0.0-100.0 range provides access to
the full 0-255 transparency values of the underlying alpha channel.</li>
<li>We use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math%7Bdot%7Drandom">math.random(min, max,
seed)</a>
function to generate pseudo-random values. We do not use an argument
for the third parameter of the function: <code dir="auto">seed</code>. Using it is handy
when you want to ensure the repeatability of the function’s
results. Called with the same seed, it will produce the same
sequence of values.</li>
</ul>
<h3 class="md-heading" id="colorfrom_gradient"><a href="#colorfrom_gradient">color.from_gradient()<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Our last examples of color calculations will use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient(value, bottom_value, top_value, bottom_color, top_color)</a>. Let’s first use it in its simplest form, to color a CCI signal in a version of the indicator that otherwise looks like the built-in:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="250" loading="lazy" src="images/65baf274e87ed607c5cfb36e7074979f.webp" width="1450"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator(title="CCI line gradient", precision=2, timeframe="")
var color GOLD_COLOR   = #CCCC00
var color VIOLET_COLOR = #AA00FF
var color BEIGE_COLOR  = #9C6E1B
float srcInput = input.source(close, title="Source")
int   lenInput = input.int(20, "Length", minval = 5)
color bullColorInput = input.color(GOLD_COLOR,   "Bull")
color bearColorInput = input.color(BEIGE_COLOR, "Bear")
float signal = ta.cci(srcInput, lenInput)
color signalColor = color.from_gradient(signal, -200, 200, bearColorInput, bullColorInput)
plot(signal, "CCI", signalColor)
bandTopPlotID = hline(100,  "Upper Band", color.silver, hline.style_dashed)
bandBotPlotID = hline(-100, "Lower Band", color.silver, hline.style_dashed)
fill(bandTopPlotID, bandBotPlotID, color.new(BEIGE_COLOR, 90), "Background")</code></div>
<p>Note that:</p>
<ul>
<li>To calculate the gradient,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>
requires minimum and maximum values against which the argument used
for the <code dir="auto">value</code> parameter will be compared. The fact that we want a
gradient for an unbounded signal like CCI (i.e., without fixed
boundaries such as RSI, which always oscillates between 0-100), does
not entail we cannot use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>.
Here, we solve our conundrum by providing values of -200 and 200 as
arguments. They do not represent the real minimum and maximum values
for CCI, but they are at levels from which we do not mind the colors
no longer changing, as whenever the series is outside the
<code dir="auto">bottom_value</code> and <code dir="auto">top_value</code> limits, the colors used for
<code dir="auto">bottom_color</code> and <code dir="auto">top_color</code> will apply.</li>
<li>The color progression calculated by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>
is linear. If the value of the series is halfway between the
<code dir="auto">bottom_value</code> and <code dir="auto">top_value</code> arguments, the generated color’s
RGBA components will also be halfway between those of <code dir="auto">bottom_color</code>
and <code dir="auto">top_color</code>.</li>
<li>Many common indicator calculations are available in Pine Script™ as
built-in functions. Here we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dcci">ta.cci()</a>
instead of calculating it the long way.</li>
</ul>
<p>The argument used for <code dir="auto">value</code> in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a> does not necessarily have to be the value of the line we are calculating. Anything we want can be used, as long as arguments for <code dir="auto">bottom_value</code> and <code dir="auto">top_value</code> can be supplied. Here, we enhance our CCI indicator by coloring the band using the number of bars since the signal has been above/below the centerline:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="250" loading="lazy" src="images/a555a4195545a925e288362f23dfb96f.webp" width="1459"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator(title="CCI line gradient", precision=2, timeframe="")
var color GOLD_COLOR   = #CCCC00
var color VIOLET_COLOR = #AA00FF  
var color GREEN_BG_COLOR = color.new(color.green, 70)
var color RED_BG_COLOR   = color.new(color.maroon, 70)
float srcInput      = input.source(close, "Source")
int   lenInput      = input.int(20, "Length", minval = 5)
int   stepsInput    = input.int(50, "Gradient levels", minval = 1)
color bullColorInput   = input.color(GOLD_COLOR, "Line: Bull", inline = "11")
color bearColorInput   = input.color(VIOLET_COLOR, "Bear", inline = "11")
color bullBgColorInput = input.color(GREEN_BG_COLOR, "Background: Bull", inline = "12")
color bearBgColorInput = input.color(RED_BG_COLOR, "Bear", inline = "12")

// Plot colored signal line.
float signal = ta.cci(srcInput, lenInput)
color signalColor = color.from_gradient(signal, -200, 200, color.new(bearColorInput, 0), color.new(bullColorInput, 0))
plot(signal, "CCI", signalColor, 2)

// Detect crosses of the centerline.
bool signalX = ta.cross(signal, 0)
// Count no of bars since cross. Capping it to the no of steps from inputs.
int gradientStep = math.min(stepsInput, nz(ta.barssince(signalX)))
// Choose bull/bear end color for the gradient.
color endColor = signal &gt; 0 ? bullBgColorInput : bearBgColorInput
// Get color from gradient going from no color to `c_endColor` 
color bandColor = color.from_gradient(gradientStep, 0, stepsInput, na, endColor)
bandTopPlotID = hline(100,  "Upper Band", color.silver, hline.style_dashed)
bandBotPlotID = hline(-100, "Lower Band", color.silver, hline.style_dashed)
fill(bandTopPlotID, bandBotPlotID, bandColor, title = "Band")</code></div>
<p>Note that:</p>
<ul>
<li>The signal plot uses the same base colors and gradient as in our
previous example. We have however increased the width of the line
from the default 1 to 2. It is the most important component of our
visuals; increasing its width is a way to give it more prominence,
and ensure users are not distracted by the band, which has become
busier than it was in its original, flat beige color.</li>
<li>The fill must remain unobtrusive for two reasons. First, it is of
secondary importance to the visuals, as it provides complementary
information, i.e., the duration for which the signal has been in
bull/bear territory. Second, since fills have a greater z-index than
plots, the fill will cover the signal plot. For these reasons, we
make the fill’s base colors fairly transparent, at 70, so they do
not mask the plots. The gradient used for the band starts with no
color at all (see the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
used as the argument to <code dir="auto">bottom_color</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>
call), and goes to the base bull/bear colors from the inputs, which
the conditional, <code dir="auto">c_endColor</code> color variable contains.</li>
<li>We provide users with distinct bull/bear color selections for the
line and the band.</li>
<li>When we calculate the <code dir="auto">gradientStep</code> variable, we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a>
on
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbarssince">ta.barssince()</a>
because in early bars of the dataset, when the condition tested has
not occurred yet,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbarssince">ta.barssince()</a>
will return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.
Because we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a>,
the value returned is replaced with zero in those cases.</li>
</ul>
<h2 class="md-heading" id="mixing-transparencies"><a href="#mixing-transparencies">Mixing transparencies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In this example we take our CCI indicator in another direction. We will build dynamically adjusting extremes zone buffers using a Donchian Channel (historical highs/lows) calculated from the CCI. We build the top/bottom bands by making them 1/4 the height of the DC. We will use a dynamically adjusting lookback to calculate the DC. To modulate the lookback, we will calculate a simple measure of volatility by keeping a ratio of a short-period ATR to a long one. When that ratio is higher than 50 of its last 100 values, we consider the volatility high. When the volatility is high/low, we decrease/increase the lookback.</p>
<p>Our aim is to provide users of our indicator with:</p>
<ul>
<li>The CCI line colored using a bull/bear gradient, as we illustrated
in our most recent examples.</li>
<li>The top and bottom bands of the Donchian Channel, filled in such a
way that their color darkens as a historical high/low becomes older
and older.</li>
<li>A way to appreciate the state of our volatility measure, which we
will do by painting the background with one color whose intensity
increases when volatility increases.</li>
</ul>
<p>This is what our indicator looks like using the light theme:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="180" loading="lazy" src="images/5fa022fc12c4e51d897a4e2d707fd853.webp" width="1788"/></div></p>
<p>And with the dark theme:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="178" loading="lazy" src="images/8bccc15c1ac9d8286947227327dc42c5.webp" width="1786"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("CCI DC", precision = 6)
color GOLD_COLOR   = #CCCC00ff
color VIOLET_COLOR = #AA00FFff
int lengthInput = input.int(20, "Length", minval = 5)
color bullColorInput = input.color(GOLD_COLOR,   "Bull")
color bearColorInput = input.color(VIOLET_COLOR, "Bear")

// ————— Function clamps `val` between `min` and `max`.
clamp(val, min, max) =&gt;
    math.max(min, math.min(max, val))

// ————— Volatility expressed as 0-100 value.
float v = ta.atr(lengthInput / 5) / ta.atr(lengthInput * 5)
float vPct = ta.percentrank(v, lengthInput * 5)

// ————— Calculate dynamic lookback for DC. It increases/decreases on low/high volatility.
bool highVolatility = vPct &gt; 50
var int lookBackMin = lengthInput * 2
var int lookBackMax = lengthInput * 10
var float lookBack = math.avg(lookBackMin, lookBackMax)
lookBack += highVolatility ? -2 : 2
lookBack := clamp(lookBack, lookBackMin, lookBackMax)

// ————— Dynamic lookback length Donchian channel of signal.
float signal = ta.cci(close, lengthInput)
// `lookBack` is a float; need to cast it to int to be used a length.
float hiTop  = ta.highest(signal, int(lookBack))
float loBot  = ta.lowest( signal, int(lookBack))
// Get margin of 25% of the DC height to build high and low bands.
float margin = (hiTop - loBot) / 4
float hiBot  = hiTop - margin
float loTop  = loBot + margin
// Center of DC.
float center = math.avg(hiTop, loBot)

// ————— Create colors.
color signalColor = color.from_gradient(signal, -200, 200, bearColorInput, bullColorInput)
// Bands: Calculate transparencies so the longer since the hi/lo has changed, 
//        the darker the color becomes. Cap highest transparency to 90.
float hiTransp = clamp(100 - (100 * math.max(1, nz(ta.barssince(ta.change(hiTop)) + 1)) / 255), 60, 90)
float loTransp = clamp(100 - (100 * math.max(1, nz(ta.barssince(ta.change(loBot)) + 1)) / 255), 60, 90)
color hiColor = color.new(bullColorInput, hiTransp)
color loColor = color.new(bearColorInput, loTransp)
// Background: Rescale the 0-100 range of `vPct` to 0-25 to create 75-100 transparencies.
color bgColor = color.new(color.gray, 100 - (vPct / 4))

// ————— Plots
// Invisible lines for band fills.
hiTopPlotID = plot(hiTop, color = na)
hiBotPlotID = plot(hiBot, color = na)
loTopPlotID = plot(loTop, color = na)
loBotPlotID = plot(loBot, color = na)
// Plot signal and centerline.
p_signal = plot(signal, "CCI", signalColor, 2)
plot(center, "Centerline", color.silver, 1)

// Fill the bands.
fill(hiTopPlotID, hiBotPlotID, hiColor)
fill(loTopPlotID, loBotPlotID, loColor)

// ————— Background.
bgcolor(bgColor)</code></div>
<p>Note that:</p>
<ul>
<li>We clamp the transparency of the background to a 100-75 range so
that it doesn’t overwhelm. We also use a neutral color that will
not distract too much. The darker the background is, the higher our
measure of volatility.</li>
<li>We also clamp the transparency values for the band fills between 60
and 90. We use 90 so that when a new high/low is found and the
gradient resets, the starting transparency makes the color somewhat
visible. We do not use a transparency lower than 60 because we
don’t want those bands to hide the signal line.</li>
<li>We use the very handy
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpercentrank">ta.percentrank()</a>
function to generate a 0-100 value from our ATR ratio measuring
volatility. It is useful to convert values whose scale is unknown
into known values that can be used to produce transparencies.</li>
<li>Because we must clamp values three times in our script, we wrote an
<code dir="auto">f_clamp()</code> function, instead of explicitly coding the logic three
times.</li>
</ul>
<h2 class="md-heading" id="tips"><a href="#tips">Tips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="maintaining-automatic-color-selectors"><a href="#maintaining-automatic-color-selectors">Maintaining automatic color selectors<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Under certain conditions, PineScript can automatically display all of the colors used in script’s plots in the “Settings/Styles” menu. These plots are graphics created by all <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot*()</a> functions, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>. The user can change the colors using a color picker. This feature allows colors in scripts to be customized without any extra code.</p>
<p>For example, this simple script has a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> that is colored either teal or red, depending on the relationship between the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>. The script does not specify that these colors should be editable, nor does it create any color-related inputs. Nevertheless, PineScript automatically displays the colors in the “Settings/Styles” menu and allows the user to change them, along with the style of the plot:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="962" loading="lazy" src="images/508c53188a9121253c62a5150a822dd6.webp" width="752"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Color picker showcase")
plotColor = close &gt; open ? color.teal : color.red
plot(close, color = plotColor)</code></div>
<aside aria-label="Tip" class="tv-informer not-content" style="--informer-header-color:#089981;--informer-back-color-light:#DAF2EE;--informer-back-color-dark:#082621"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z" fill="currentColor"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Tip</span>To prevent the user from changing the color or the type of the plot via the “Styles” tab, include <code dir="auto">editable = false</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> call.</p></div></aside>
<p>The colors in the above script can be automatically displayed in this way because they are already known <em>during compilation</em>. Colors that are known during compilation are of type <a href="/pine-script-docs/v5/language/type-system#const">“const”</a> or <a href="/pine-script-docs/v5/language/type-system#input">“input”</a> only.</p>
<p>However, if <em>even a</em> <em>single calculated color</em> is of type “simple color” or “series color”, <em>all</em> colors are calculated in the script’s runtime, and no color pickers are available in the “Style” section.</p>
<p>In practice, the creation of <a href="/pine-script-docs/v5/language/type-system#simple">“simple”</a> or <a href="/pine-script-docs/v5/language/type-system#series">“series”</a> colors is most often due to using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.rgb">color.rgb()</a> functions. The qualifier of the color that they return is the strongest qualifier of the values passed to these functions. If each call to these functions passes only <a href="/pine-script-docs/v5/language/type-system#const">“const”</a> or <a href="/pine-script-docs/v5/language/type-system#input">“input”</a> values, the resulting colors are also <a href="/pine-script-docs/v5/language/type-system#const">“const”</a> or <a href="/pine-script-docs/v5/language/type-system#input">“input”</a>, and the script <em>does</em> display them in the “Styles” menu.</p>
<aside aria-label="Warning" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Warning</span>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient">color.from_gradient()</a> function always returns a “series color” value, regardless of the parameters passed to it. If it’s used in a script, all that script’s colors are calculated at runtime.</p></div></aside>
<p>For example, let’s try to make the plots in the script above semi-transparent by adding a transparency of <code dir="auto">50</code> to its colors via <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a>. The easiest way to do this is to wrap the <code dir="auto">plotColor</code> variable with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a>, like in the example below:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Color picker showcase")
plotColor = color.new(close &gt; open ? color.teal : color.red, 50)
plot(close, color = plotColor)</code></div>
<p>Unfortunately, with these changes the “Style” tab does not display a color picker any longer. This is because we use the “series bool” condition <code dir="auto">close &gt; open</code> to decide the color, and then pass the result of this expression to a single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a> call. The qualified type of the calculated color that it returns is “series color”.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="810" loading="lazy" src="images/7458b8e210a638d695a04577bd84d035.webp" width="752"/></div></p>
<p><div class="image-container"><img alt="image" decoding="async" height="384" loading="lazy" src="images/b06f7262bdfbe82b57a5d208bcae8255.webp" width="1304"/></div></p>
<p>To avoid this, we can ensure that every calculated color created by <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a> is a “const color”. Below, we wrap teal and red separately with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a> – creating two constant calculated colors in the process – and then decide which one to assign to <code dir="auto">plotColor</code> based on the condition. And while the <code dir="auto">plotColor</code> variable is a “series color”, each <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a> call returns a constant color, so the script displays a color picker n the “Style” tab:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Color picker showcase")
plotColor = close &gt; open ? color.new(color.teal, 50) : color.new(color.red, 50)
plot(close, color = plotColor)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="966" loading="lazy" src="images/6fada89bf1937f9a33f324ac830d35d8.webp" width="752"/></div></p>
<p>To calculate the colors at runtime, create custom color inputs for all of the colors that are to be editable. This approach requires more effort, but allows significantly more control over what the user can affect. Learn more about creating color inputs on the Inputs page.</p>
<h3 class="md-heading" id="designing-usable-colors-schemes"><a href="#designing-usable-colors-schemes">Designing usable colors schemes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If you write scripts intended for other traders, try to avoid colors that will not work well in some environments, whether it be for plots, labels, tables or fills. At a minimum, test your visuals to ensure they perform satisfactorily with both the light and dark TradingView themes; they are the most commonly used. Colors such as black and white, for example, should be avoided.</p>
<p>Build the appropriate inputs to provide script users the flexibility to adapt your script’s visuals to their particular environments.</p>
<p>Take care to build a visual hierarchy of the colors you use that matches the relative importance of your script’s visual components. Good designers understand how to achieve the optimal balance of color and weight so the eye is naturally drawn to the most important elements of the design. When you make everything stand out, nothing does. Make room for some elements to stand out by toning down the visuals surrounding it.</p>
<p>Providing a selection of color presets in your inputs — rather than a single color that can be changed — can help color-challenged users. Our <a href="https://www.tradingview.com/script/Jdw7wW2g-Technical-Ratings/">Technical Ratings</a> demonstrates one way of achieving this.</p>
<h3 class="md-heading" id="plot-crisp-lines"><a href="#plot-crisp-lines">Plot crisp lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>It is best to use zero transparency to plot the important lines in your visuals, to keep them crisp. This way, they will show through fills more precisely. Keep in mind that fills have a higher z-index than plots, so they are placed on top of them. A slight increase of a line’s width can also go a long way in making it stand out.</p>
<p>If you want a special plot to stand out, you can also give it more importance by using multiple plots for the same line. These are examples where we modulate the successive width and transparency of plots to achieve this:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="206" loading="lazy" src="images/f9fddaddbe31610e6f930f2816003143.webp" width="1794"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
plot(high, "", color.new(color.orange, 80), 8)
plot(high, "", color.new(color.orange, 60), 4)
plot(high, "", color.new(color.orange, 00), 1)

plot(hl2, "", color.new(color.orange, 60), 4)
plot(hl2, "", color.new(color.orange, 00), 1)

plot(low, "", color.new(color.orange, 0), 1)</code></div>
<h3 class="md-heading" id="customize-gradients"><a href="#customize-gradients">Customize gradients<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When building gradients, adapt them to the visuals they apply to. If you are using a gradient to color candles, for example, it is usually best to limit the number of steps in the gradient to ten or less, as it is more difficult for the eye to perceive intensity variations of discrete objects. As we did in our examples, cap minimum and maximum transparency levels so your visual elements remain visible and do not overwhelm when it’s not necessary.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/chart-information"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Chart information  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/fills"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Fills <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Fills</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-fills"><a href="#fills">Fills<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Some of Pine Script’s visual outputs, including
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">plots</a>,
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">hlines</a>, <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
allow one to fill the chart space they occupy with colors. Three
different mechanisms facilitate filling the space between such outputs:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function fills the space between two plots from
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls or two horizontal lines (hlines) from
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
calls with a specified color.</li>
<li>Objects of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
type fill the space between
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instances created with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>.</li>
<li>Other drawing types, namely
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>, have built-in properties that allow the drawings to
fill the visual spaces they occupy.</li>
</ul>
<h2 class="md-heading" id="plot-and-hline-fills"><a href="#plot-and-hline-fills">`plot()` and `hline()` fills<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function fills the space between two plots or horizontal lines. It has
the following two signatures:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">fill(plot1, plot2, color, title, editable, show_last, fillgaps) → void</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">fill(hline1, hline2, color, title, editable, fillgaps) → void</span></div></div></code></pre></figure></link></div>
<p>The <code dir="auto">plot1</code>, <code dir="auto">plot2</code>, <code dir="auto">hline1</code>, and <code dir="auto">hline2</code> parameters accept
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">plot</a>
or <a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">hline</a> IDs returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
function calls. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function is the only built-in that can use these IDs.</p>
<p>This simple example demonstrates how the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function works with
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">plot and hline</a> IDs. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
three times to display arbitrary values on the chart. Each of these
calls returns an ID, which the script assigns to variables for use in
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function. The values of <code dir="auto">p1</code>, <code dir="auto">p2</code>, and <code dir="auto">p3</code> are “plot” IDs, whereas
<code dir="auto">h1</code>, <code dir="auto">h2</code>, and <code dir="auto">h3</code> reference “hline” IDs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="627" loading="lazy" src="images/a98040945141502d9bc0c71bfedb77c3.webp" width="1348"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 1")

// Assign "plot" IDs to the `p1`, `p2`, and `p3` variables.
p1 = plot(math.sin(high), "Sine of `high`")
p2 = plot(math.cos(low), "Cosine of `low`")
p3 = plot(math.sin(close), "Sine of `close`")
// Fill the space between `p1` and `p2` with 90% transparent red.
fill(p1, p3, color.new(color.red, 90), "`p1`-`p3` fill")
// Fill the space between `p2` and `p3` with 90% transparent blue.
fill(p2, p3, color.new(color.blue, 90), "`p2`-`p3` fill")

// Assign "hline" IDs to the `h1`, `h2`, and `h3` variables.
h1 = hline(0, "First level")
h2 = hline(1.0, "Second level")
h3 = hline(0.5, "Third level")
h4 = hline(1.5, "Fourth level")
// Fill the space between `h1` and `h2` with 90% transparent yellow.
fill(h1, h2, color.new(color.yellow, 90), "`h1`-`h2` fill")
// Fill the space between `h3` and `h4` with 90% transparent lime.
fill(h3, h4, color.new(color.lime, 90), "`h3`-`h4` fill")</code></div>
<p>It’s important to note that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function requires <em>either</em> two “plot” IDs or two “hline” IDs. One
<em>cannot</em> mix and match these types in the function call. Consequently,
programmers will sometimes need to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
where they otherwise might have used
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
if they want to fill the space between a consistent level and a
fluctuating series.</p>
<p>For example, this script calculates an <code dir="auto">oscillator</code> based on the
percentage distance between the chart’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price and a 10-bar
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">SMA</a>,
then plots it on the chart pane. In this case, we wanted to fill the
area between the <code dir="auto">oscillator</code> and zero. Although we can display the zero
level with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
since its value does not change, we cannot pass a “plot” and “hline”
ID to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function. Therefore, we must use a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call for the level to allow the script to fill the space:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="628" loading="lazy" src="images/bb3fe16e44b25b13b109a35cf8c376e8.webp" width="1352"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 2")

//@variable The 10-bar moving average of `close` prices.
float ma = ta.sma(close, 10)
//@variable The distance from the `ma` to the `close` price, as a percentage of the `ma`.
float oscillator = 100 * (ma - close) / ma

//@variable The ID of the `oscillator` plot for use in the `fill()` function.
oscPlotID = plot(oscillator, "Oscillator")
//@variable The ID of the zero level plot for use in the `fill()` function. 
//          Requires a "plot" ID since the `fill()` function can't use "plot" and "hline" IDs at the same time.
zeroPlotID = plot(0, "Zero level", color.silver, 1, plot.style_circles)

// Filll the space between the `oscPlotID` and `zeroPlotID` with 90% transparent blue. 
fill(oscPlotID, zeroPlotID, color.new(color.blue, 90), "Oscillator fill")</code></div>
<p>The <code dir="auto">color</code> parameter of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function accepts a “series color” argument, meaning the fill’s color
can change across chart bars. For example, this code fills the space
between two moving average plots with 90% transparent green or red
colors based on whether <code dir="auto">ma1</code> is above <code dir="auto">ma2</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="632" loading="lazy" src="images/85bc58922da60451062538f4a02efff2.webp" width="1352"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 3", overlay = true)

//@variable The 5-bar moving average of `close` prices.
float ma1 = ta.sma(close, 5)
//@variable The 20-bar moving average of `close` prices.
float ma2 = ta.sma(close, 20)

//@variable The 90% transparent color of the space between MA plots. Green if `ma1 &gt; ma2`, red otherwise. 
color fillColor = ma1 &gt; ma2 ? color.new(color.green, 90) : color.new(color.red, 90) 

//@variable The ID of the `ma1` plot for use in the `fill()` function.
ma1PlotID = plot(ma1, "5-bar SMA")
//@variable The ID of the `ma2` plot for use in the `fill()` function.
ma2PlotID = plot(ma2, "20-bar SMA")

// Fill the space between the `ma1PlotID` and `ma2PlotID` using the `fillColor`.
fill(ma1PlotID, ma2PlotID, fillColor, "SMA plot fill")</code></div>
<h2 class="md-heading" id="line-fills"><a href="#line-fills">Line fills<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>While the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
function allows a script to fill the space between two
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">plots or hlines</a>, it does not work with
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
objects. When a script needs to fill the space between
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, it
requires a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
object created by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>
function. The function has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">linefill.new(line1, line2, color) → series linefill</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">line1</code> and <code dir="auto">line2</code> parameters accept
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
IDs. These IDs determine the chart region that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
object will fill with its specified <code dir="auto">color</code>. A script can update the
<code dir="auto">color</code> property of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
ID returned by this function by calling
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.set_color">linefill.set_color()</a>
with the ID as its <code dir="auto">id</code> argument.</p>
<p>The behavior of linefills depends on the lines they reference. Scripts
cannot move linefills directly, as the lines that a linefill uses
determine the space it will fill. To retrieve the IDs of the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>
referenced by a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
object, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.get_line1">linefill.get_line1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.get_line2">linefill.get_line2()</a>
functions.</p>
<p>Any pair of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instances can only have <em>one</em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
between them. Successive calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>
using the same <code dir="auto">line1</code> and <code dir="auto">line2</code> arguments will create a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
ID that <em>replaces</em> the previous one associated with them.</p>
<p>The example below demonstrates a simple use case for linefills. The
script calculates a <code dir="auto">pivotHigh</code> and <code dir="auto">pivotLow</code> series using the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.pivothigh">ta.pivothigh()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.pivotlow">ta.pivotlow()</a>
functions with constant <code dir="auto">leftbars</code> and <code dir="auto">rightbars</code> arguments. On the
last confirmed historical bar, the script draws two extended lines. The
first line connects the two most recent non-na <code dir="auto">pivotHigh</code> values, and
the second connects the most recent non-na <code dir="auto">pivotLow</code> values.</p>
<p>To emphasize the “channel” formed by these lines, the script fills the
space between them using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="827" loading="lazy" src="images/31a1c37655587eaa5cac2add5753519e.webp" width="1600"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Linefill demo", "Channel", true)

//@variable The number bars to the left of a detected pivot.
int LEFT_BARS = 15
//@variable The number bars to the right for pivot confirmation. 
int RIGHT_BARS = 5

//@variable The price of the pivot high point.
float pivotHigh = ta.pivothigh(LEFT_BARS, RIGHT_BARS)
//@variable The price of the pivot low point.
float pivotLow = ta.pivotlow(LEFT_BARS, RIGHT_BARS)

// Initialize the chart points the lines will use.
var firstHighPoint  = chart.point.new(na, na, na)
var secondHighPoint = chart.point.new(na, na, na)
var firstLowPoint   = chart.point.new(na, na, na)
var secondLowPoint  = chart.point.new(na, na, na)

// Update the `firstHighPoint` and `secondHighPoint` when `pivotHigh` is not `na`.
if not na(pivotHigh)
    firstHighPoint  := secondHighPoint
    secondHighPoint := chart.point.from_index(bar_index - RIGHT_BARS, pivotHigh)
// Update the `firstLowPoint` and `secondLowPoint` when `pivotlow` is not `na`.
if not na(pivotLow)
    firstLowPoint  := secondLowPoint
    secondLowPoint := chart.point.from_index(bar_index - RIGHT_BARS, pivotLow)

if barstate.islastconfirmedhistory
    //@variable An extended line that passes through the `firstHighPoint` and `secondHighPoint`.
    line pivotHighLine = line.new(firstHighPoint, secondHighPoint, extend = extend.right)
    //@variable An extended line that passes through the `firstLowPoint` and `secondLowPoint`.
    line pivotLowLine = line.new(firstLowPoint, secondLowPoint, extend = extend.right)
    //@variable The color of the space between the lines.
    color fillColor = switch
        secondHighPoint.price &gt; firstHighPoint.price and secondLowPoint.price &gt; firstLowPoint.price =&gt; color.lime
        secondHighPoint.price &lt; firstHighPoint.price and secondLowPoint.price &lt; firstLowPoint.price =&gt; color.red
        =&gt;                                                                                             color.silver
    //@variable A linefill that colors the space between the `pivotHighLine` and `pivotLowLine`.
    linefill channelFill = linefill.new(pivotHighLine, pivotLowLine, color.new(fillColor, 90))</code></div>
<h2 class="md-heading" id="box-and-polyline-fills"><a href="#box-and-polyline-fills">Box and polyline fills<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
types allow scripts to draw geometric shapes and other formations on the
chart. Scripts create
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>
with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
functions, which include parameters that allow the drawings to fill
their visual spaces.</p>
<p>To fill the space inside the borders of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
with a specified color, include a <code dir="auto">bgcolor</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
function. To fill a polyline’s visual space, pass a <code dir="auto">fill_color</code>
argument to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
function.</p>
<p>For example, this script draws an octagon with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
and an inscribed rectangle with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a> on
the last confirmed historical bar. It determines the size of the
drawings using the value from the <code dir="auto">radius</code> variable, which corresponds
to approximately one-fourth of the number of bars visible on the chart.
We included <code dir="auto">fill_color = color.new(color.blue, 60)</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
call to fill the octagon with a translucent blue color, and we used
<code dir="auto">bgcolor = color.purple</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
call to fill the inscribed rectangle with opaque purple:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="554" loading="lazy" src="images/38c40691437b8197652ff11b24214286.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Box and polyline fills demo")

//@variable The number of visible chart bars, excluding the leftmost and rightmost bars.
var int barCount = 0
if time &gt; chart.left_visible_bar_time and time &lt; chart.right_visible_bar_time
    barCount += 1

//@variable The approximate radius used to calculate the octagon and rectangle coordinates.
int radius = math.ceil(barCount / 4)

if barstate.islastconfirmedhistory
    //@variable An array of chart points. The polyline uses all points in this array, but the box only needs two.
    array&lt;chart.point&gt; points = array.new&lt;chart.point&gt;()
    //@variable The counterclockwise angle of each point, in radians. Updates on each loop iteration. 
    float angle = 0.0
    //@variable The radians to add to the `angle` on each loop iteration.
    float increment = 0.25 * math.pi
    // Loop 8 times to calculate octagonal points.
    for i = 0 to 7
        //@variable The point's x-coordinate (bar offset).
        int x = int(math.round(math.cos(angle) * radius))
        //@variable The point's y-coordinate.
        float y = math.round(math.sin(angle) * radius)
        // Push a new chart point into the `points` array and increase the `angle`.
        points.push(chart.point.from_index(bar_index - radius + x, y))
        angle += increment
    // Create a closed polyline to draw the octagon and fill it with translucent blue. 
    polyline.new(points, closed = true, fill_color = color.new(color.blue, 60))
    // Create a box for the rectangle using index 3 and 7 for the top-left and bottom-right corners, 
    // and fill it with opaque purple. 
    box.new(points.get(3), points.get(7), bgcolor = color.purple)</code></div>
<p>See this manual’s
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/">Lines and boxes</a> page
to learn more about working with these types.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/colors"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Colors  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/inputs"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Inputs <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Inputs</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-inputs"><a href="#inputs">Inputs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Inputs receive values that users can change from a script’s
“Settings/Inputs” tab. By utilizing inputs, programmers can write
scripts that users can more easily adapt to their preferences.</p>
<p>The following script plots a 20-period <a href="https://www.tradingview.com/support/solutions/43000502589">simple moving average
(SMA)</a> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(close,
20)</a>.
While it is straightforward to write, the code is not very <em>flexible</em>
because the function call uses specific <code dir="auto">source</code> and <code dir="auto">length</code> arguments
that users cannot change without modifying the code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
plot(ta.sma(close, 20))</code></div>
<p>If we write our script this way instead, it becomes much more flexible,
as users can select the <code dir="auto">source</code> and the <code dir="auto">length</code> values they want to
use from the “Settings/Inputs” tab without changing the source code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
sourceInput = input(close, "Source")
lengthInput = input(20, "Length")
plot(ta.sma(sourceInput, lengthInput))</code></div>
<p>Inputs are only accessible while a script runs on a chart. Users can
access script inputs from the “Settings” dialog box. To open this
dialog, users can:</p>
<ul>
<li>Double-click on the name of an on-chart indicator</li>
<li>Right-click on the script’s name and choose the “Settings” item
from the dropdown menu</li>
<li>Choose the “Settings” item from the “More” menu icon (three
dots) that appears when hovering over the indicator’s name on the
chart</li>
<li>Double-click on the indicator’s name from the Data Window (fourth
icon down to the right of the chart)</li>
</ul>
<p>The “Settings” dialog always contains the “Style” and “Visibility”
tabs, which allow users to specify their preferences about the script’s
visuals and the chart timeframes that can display its outputs.</p>
<p>When a script contains calls to <code dir="auto">input.*()</code> functions, an “Inputs” tab
also appears in the “Settings” dialog box.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1052" loading="lazy" src="images/43b6c9c9e7a4b7564fb47754552ec649.webp" width="2356"/></div></p>
<p>Scripts process inputs when users add them to the chart or change the
values in the script’s “Settings/Inputs” tab. Any changes to a
script’s inputs prompt it to re-execute across all available data using
the new specified values.</p>
<h2 class="md-heading" id="input-functions"><a href="#input-functions">Input functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ features the following input functions:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input">input()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.float">input.float()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.bool">input.bool()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.color">input.color()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.string">input.string()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.text_area">input.text_area()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.timeframe">input.timeframe()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.symbol">input.symbol()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.price">input.price()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.session">input.session()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a></li>
</ul>
<p>Scripts create input <em>widgets</em> in the “Inputs” tab that accept
different types of inputs based on their <code dir="auto">input.*()</code> function calls. By
default, each input appears on a new line of the “Inputs” tab in the
order of the <code dir="auto">input.*()</code> calls. Programmers can also organize inputs in
different ways by using the <code dir="auto">input.*()</code> functions’ <code dir="auto">group</code> and <code dir="auto">inline</code>
parameters. See <a href="/pine-script-docs/v5/concepts/inputs/#input-function-parameters">this section</a> below for more information.</p>
<p>Our <a href="/pine-script-docs/v5/writing/style-guide/#style-guide">Style guide</a>
recommends placing <code dir="auto">input.*()</code> calls at the beginning of the script.</p>
<p>Input functions typically contain several parameters that allow
programmers to define their default values, value limits, their
organization in the “Inputs” tab, and other properties.</p>
<p>Since an <code dir="auto">input.*()</code> call is simply another function call in Pine
Script™, programmers can combine them with
<a href="/pine-script-docs/v5/language/operators/#arithmetic-operators">arithmetic</a>, <a href="/pine-script-docs/v5/language/operators/#comparison-operators">comparison</a>,
<a href="/pine-script-docs/v5/language/operators/#logical-operators">logical</a>, and
<a href="/pine-script-docs/v5/language/operators/#-ternary-operator">ternary</a>
operators to assign expressions to variables. This simple script
compares the result from a call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.string">input.string()</a>
to the “On” string and assigns the result to the <code dir="auto">plotDisplayInput</code>
variable. This variable is of the “input bool” type because the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_==">==</a>
operator returns a “bool” value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Input in an expression`", "", true)
bool plotDisplayInput = input.string("On", "Plot Display", options = ["On", "Off"]) == "On"
plot(plotDisplayInput ? close : na)</code></div>
<p>All values returned by <code dir="auto">input.*()</code> functions except “source” ones are
“input” qualified values. See our User Manual’s section on
<a href="/pine-script-docs/v5/language/type-system/#qualifiers">type qualifiers</a> for more information.</p>
<h2 class="md-heading" id="input-function-parameters"><a href="#input-function-parameters">Input function parameters<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The parameters common to all input functions are: <code dir="auto">defval</code>, <code dir="auto">title</code>,
<code dir="auto">tooltip</code>, <code dir="auto">inline</code>, <code dir="auto">group</code>, and <code dir="auto">display</code>. Some input functions also
include other parameters: <code dir="auto">options</code>, <code dir="auto">minval</code>, <code dir="auto">maxval</code>, <code dir="auto">step</code> and
<code dir="auto">confirm</code>.</p>
<p>All these parameters expect “const” arguments. The only exceptions are
for the <code dir="auto">defval</code> and <code dir="auto">options</code> parameters of the <a href="/pine-script-docs/v5/concepts/inputs/#source-input">source</a>
and <a href="/pine-script-docs/v5/concepts/inputs/#enum-input">enum</a>
inputs, as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a>
uses “series float” value, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
uses <em>members</em> of an <a href="/pine-script-docs/v5/language/type-system/#qualifiers">enum type</a>.</p>
<p>Since <code dir="auto">input.*()</code> parameters accept “const” arguments in most cases
and the “input” and other
<a href="/pine-script-docs/v5/language/type-system/#qualifiers">qualifiers</a>
are stronger than “const”, it follows that one cannot use the result
from one <code dir="auto">input.*()</code> call as an argument in another <code dir="auto">input.*()</code> call.</p>
<p>Let’s go over each parameter:</p>
<ul>
<li><code dir="auto">defval</code> is the first parameter of all input functions. It is the
default value that appears in the input widget. It requires an
argument of the type of input value that the function applies to.</li>
<li><code dir="auto">title</code> requires a “const string” argument. It is the field’s
label.</li>
<li><code dir="auto">tooltip</code> requires a “const string” argument. When the parameter
is used, a question mark icon will appear to the right of the field.
When users hover over it, the tooltip’s text will appear. Note that
if multiple input fields are grouped on one line using <code dir="auto">inline</code>, the
tooltip will always appear to the right of the rightmost field, and
display the text of the last <code dir="auto">tooltip</code> argument used in the line.
Newlines (<code dir="auto">\n</code>) are supported in the argument string.</li>
<li><code dir="auto">inline</code> requires a “const string” argument. Using the same
argument for the parameter in multiple <code dir="auto">input.*()</code> calls will group
their input widgets on the same line. There is a limit to the width
the “Inputs” tab will expand, so a limited quantity of input
fields can be fitted on one line. Using one <code dir="auto">input.*()</code> call with a
unique argument for <code dir="auto">inline</code> has the effect of bringing the input
field left, immediately after the label, foregoing the default
left-alignment of all input fields used when no <code dir="auto">inline</code> argument is
used.</li>
<li><code dir="auto">group</code> requires a “const string” argument. Use it to group any
number of inputs in an organized section. The string used as the
<code dir="auto">group</code> argument becomes the section’s heading. All <code dir="auto">input.*()</code>
calls to be grouped together must use the same string for their
<code dir="auto">group</code> argument.</li>
<li><code dir="auto">options</code> requires a comma-separated list of elements enclosed in
square brackets (e.g., <code dir="auto">["ON", "OFF"]</code>, <code dir="auto">[1, 2, 3]</code>,
<code dir="auto">[myEnum.On, myEnum.Off]</code>). The input uses the specified elements as
menu selections in its resulting dropdown widget. Users can only
select one menu item at a time. When supplying an <code dir="auto">options</code> list,
the <code dir="auto">defval</code> value must be one of the list’s elements. Inputs that
allow <code dir="auto">minval</code>, <code dir="auto">maxval</code>, or <code dir="auto">step</code> parameters cannot use those
parameters and the <code dir="auto">options</code> parameter simultaneously.</li>
<li><code dir="auto">minval</code> requires a “const int/float” argument, depending on the
type of the <code dir="auto">defval</code> value. It is the minimum valid value for the
input field.</li>
<li><code dir="auto">maxval</code> requires a “const int/float” argument, depending on the
type of the <code dir="auto">defval</code> value. It is the maximum valid value for the
input field.</li>
<li><code dir="auto">step</code> is the increment by which the field’s value will move when
the widget’s up/down arrows are used.</li>
<li><code dir="auto">confirm</code> requires a “const bool” (<code dir="auto">true</code> or <code dir="auto">false</code>) argument.
This parameter affects the behavior of the script when it is added
to a chart. <code dir="auto">input.*()</code> calls using <code dir="auto">confirm = true</code> will cause the
“Settings/Inputs” tab to popup when the script is added to the
chart. <code dir="auto">confirm</code> is useful to ensure that users configure a
particular field.</li>
</ul>
<p>The <code dir="auto">minval</code>, <code dir="auto">maxval</code> and <code dir="auto">step</code> parameters are only present in the
signature of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.float">input.float()</a>
functions.</p>
<h2 class="md-heading" id="input-types"><a href="#input-types">Input types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The next sections explain what each input function does. As we proceed,
we will explore the different ways you can use input functions and
organize their display.</p>
<h3 class="md-heading" id="generic-input"><a href="#generic-input">Generic input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input">input()</a>
is a simple, generic function that supports the fundamental Pine Script™
types: “int”, “float”, “bool”, “color” and “string”. It also
supports “source” inputs, which are price-related values such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#hl2">hl2</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlcc4">hlcc4</a>,
or which can be used to receive the output value of another script.</p>
<p>Its signature is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">input(defval, title, tooltip, inline, group) → input int/float/bool/color/string | series float</span></div></div></code></pre></figure></link></div>
<p>The function automatically detects the type of input by analyzing the
type of the <code dir="auto">defval</code> argument used in the function call. This script
shows all the supported types and the qualified type returned by the
function when used with <code dir="auto">defval</code> arguments of different types:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`input()`", "", true)
a = input(1, "input int")
b = input(1.0, "input float")
c = input(true, "input bool")
d = input(color.orange, "input color")
e = input("1", "input string")
f = input(close, "series float")
plot(na)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="782" loading="lazy" src="images/b297fdcb4a0efe9889b9e313febcf3e6.webp" width="616"/></div></p>
<h3 class="md-heading" id="integer-input"><a href="#integer-input">Integer input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Two signatures exist for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
function; one when <code dir="auto">options</code> is not used, the other when it is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">input.int(defval, title, minval, maxval, step, tooltip, inline, group, confirm) → input int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">input.int(defval, title, options, tooltip, inline, group, confirm) → input int</span></div></div></code></pre></figure></div>
<p>This call uses the <code dir="auto">options</code> parameter to propose a pre-defined list of
lengths for the MA:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
maLengthInput = input.int(10, options = [3, 5, 7, 10, 14, 20, 50, 100, 200])
ma = ta.sma(close, maLengthInput)
plot(ma)</code></div>
<p>This one uses the <code dir="auto">minval</code> parameter to limit the length:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
maLengthInput = input.int(10, minval = 2)
ma = ta.sma(close, maLengthInput)
plot(ma)</code></div>
<p>The version with the <code dir="auto">options</code> list uses a dropdown menu for its widget.
When the <code dir="auto">options</code> parameter is not used, a simple input widget is used
to enter the value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="826" loading="lazy" src="images/19d6274e901fb6a5be7ed9f46998948c.webp" width="1936"/></div></p>
<h3 class="md-heading" id="float-input"><a href="#float-input">Float input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Two signatures exist for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.float">input.float()</a>
function; one when <code dir="auto">options</code> is not used, the other when it is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">input.float(defval, title, minval, maxval, step, tooltip, inline, group, confirm) → input int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">input.float(defval, title, options, tooltip, inline, group, confirm) → input int</span></div></div></code></pre></figure></div>
<p>Here, we use a “float” input for the factor used to multiple the
standard deviation, to calculate Bollinger Bands:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
maLengthInput = input.int(10, minval = 1)
bbFactorInput = input.float(1.5, minval = 0, step = 0.5)
ma      = ta.sma(close, maLengthInput)
bbWidth = ta.stdev(ma, maLengthInput) * bbFactorInput
bbHi    = ma + bbWidth
bbLo    = ma - bbWidth
plot(ma)
plot(bbHi, "BB Hi", color.gray)
plot(bbLo, "BB Lo", color.gray)</code></div>
<p>The input widgets for floats are similar to the ones used for integer
inputs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="670" loading="lazy" src="images/f879cbe06bcaa530ea431f1ab9b4967c.webp" width="1748"/></div></p>
<h3 class="md-heading" id="boolean-input"><a href="#boolean-input">Boolean input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Let’s continue to develop our script further, this time by adding a
boolean input to allow users to toggle the display of the BBs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="674" loading="lazy" src="images/2906a3de5c53020c332a12e8fa696371.webp" width="1746"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
maLengthInput = input.int(10,    "MA length", minval = 1)
bbFactorInput = input.float(1.5, "BB factor", inline = "01", minval = 0, step = 0.5)
showBBInput   = input.bool(true, "Show BB",   inline = "01")
ma      = ta.sma(close, maLengthInput)
bbWidth = ta.stdev(ma, maLengthInput) * bbFactorInput
bbHi    = ma + bbWidth
bbLo    = ma - bbWidth
plot(ma, "MA", color.aqua)
plot(showBBInput ? bbHi : na, "BB Hi", color.gray)
plot(showBBInput ? bbLo : na, "BB Lo", color.gray)</code></div>
<p>Note that:</p>
<ul>
<li>We have added an input using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.bool">input.bool()</a>
to set the value of <code dir="auto">showBBInput</code>.</li>
<li>We use the <code dir="auto">inline</code> parameter in that input and in the one for
<code dir="auto">bbFactorInput</code> to bring them on the same line. We use <code dir="auto">"01"</code> for
its argument in both cases. That is how the Pine Script™ compiler
recognizes that they belong on the same line. The particular string
used as an argument is unimportant and does not appear anywhere in
the “Inputs” tab; it is only used to identify which inputs go on
the same line.</li>
<li>We have vertically aligned the <code dir="auto">title</code> arguments of our <code dir="auto">input.*()</code>
calls to make them easier to read.</li>
<li>We use the <code dir="auto">showBBInput</code> variable in our two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls to plot conditionally. When the user unchecks the checkbox of
the <code dir="auto">showBBInput</code> input, the variable’s value becomes <code dir="auto">false</code>. When
that happens, our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls plot the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
value, which displays nothing. We use <code dir="auto">true</code> as the default value of
the input, so the BBs plot by default.</li>
<li>Because we use the <code dir="auto">inline</code> parameter for the <code dir="auto">bbFactorInput</code>
variable, its input field in the “Inputs” tab does not align
vertically with that of <code dir="auto">maLengthInput</code>, which doesn’t use
<code dir="auto">inline</code>.</li>
</ul>
<h3 class="md-heading" id="color-input"><a href="#color-input">Color input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>As explained in
<a href="/pine-script-docs/v5/concepts/colors/#maintaining-automatic-color-selectors">this</a> section of the <a href="/pine-script-docs/v5/concepts/colors/">Colors</a> page, selecting the colors of a script’s outputs via the
“Settings/Style” tab is not always possible. In the case where one
cannot choose colors from the “Style” tab, programmers can create
color inputs with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.color">input.color()</a>
function to allow color customization from the “Settings/Inputs” tab.</p>
<p>Suppose we wanted to plot our BBs with a ligther transparency when the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values are higher/lower than the BBs. We can use a code like this to
create the colors:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">bbHiColor = color.new(color.gray, high &gt; bbHi ? 60 : 0)
bbLoColor = color.new(color.gray, low  &lt; bbLo ? 60 : 0)</code></div>
<p>When using dynamic (“series”) color components like the <code dir="auto">transp</code>
arguments in the above code, the color widgets in the “Settings/Style”
tab will no longer appear. Let’s create our own input for color
selection, which will appear in the “Settings/Inputs” tab:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="676" loading="lazy" src="images/ed0077ab9214bd1783cb3b23ad4c0682.webp" width="1748"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
maLengthInput = input.int(10,           "MA length", inline = "01", minval = 1)
maColorInput  = input.color(color.aqua, "",          inline = "01")
bbFactorInput = input.float(1.5,        "BB factor", inline = "02", minval = 0, step = 0.5)
bbColorInput  = input.color(color.gray, "",          inline = "02")
showBBInput   = input.bool(true,        "Show BB",   inline = "02")
ma      = ta.sma(close, maLengthInput)
bbWidth = ta.stdev(ma, maLengthInput) * bbFactorInput
bbHi    = ma + bbWidth
bbLo    = ma - bbWidth
bbHiColor = color.new(bbColorInput, high &gt; bbHi ? 60 : 0)
bbLoColor = color.new(bbColorInput, low  &lt; bbLo ? 60 : 0)
plot(ma, "MA", maColorInput)
plot(showBBInput ? bbHi : na, "BB Hi", bbHiColor, 2)
plot(showBBInput ? bbLo : na, "BB Lo", bbLoColor, 2)</code></div>
<p>Note that:</p>
<ul>
<li>We have added two calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.color">input.color()</a>
to gather the values of the <code dir="auto">maColorInput</code> and <code dir="auto">bbColorInput</code>
variables. We use <code dir="auto">maColorInput</code> directly in the
<code dir="auto">plot(ma, "MA", maColorInput)</code> call, and we use <code dir="auto">bbColorInput</code> to
build the <code dir="auto">bbHiColor</code> and <code dir="auto">bbLoColor</code> variables, which modulate the
transparency using the position of price relative to the BBs. We use
a conditional value for the <code dir="auto">transp</code> value we call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.new">color.new()</a>
with, to generate different transparencies of the same base color.</li>
<li>We do not use a <code dir="auto">title</code> argument for our new color inputs because
they are on the same line as other inputs allowing users to
understand to which plots they apply.</li>
<li>We have reorganized our <code dir="auto">inline</code> arguments so they reflect the fact
we have inputs grouped on two distinct lines.</li>
</ul>
<h3 class="md-heading" id="timeframe-input"><a href="#timeframe-input">Timeframe input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Timeframe inputs can be useful when you want to be able to change the
timeframe used to calculate values in your scripts.</p>
<p>Let’s do away with our BBs from the previous sections and add a
timeframe input to a simple MA script:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1122" loading="lazy" src="images/acd75ee67e109c24a065e00ded4d6850.webp" width="1752"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
tfInput = input.timeframe("D", "Timeframe")
ma = ta.sma(close, 20)
securityNoRepaint(sym, tf, src) =&gt;
    request.security(sym, tf, src[barstate.isrealtime ? 1 : 0])[barstate.isrealtime ? 0 : 1]
maHTF = securityNoRepaint(syminfo.tickerid, tfInput, ma)
plot(maHTF, "MA", color.aqua)</code></div>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.timeframe">input.timeframe()</a>
function to receive the timeframe input.</li>
<li>The function creates a dropdown widget where some standard
timeframes are proposed. The list of timeframes also includes any
you have favorated in the chart user interface.</li>
<li>We use the <code dir="auto">tfInput</code> in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call. We also use <code dir="auto">gaps = barmerge.gaps_on</code> in the call, so the
function only returns data when the higher timeframe has completed.</li>
</ul>
<h3 class="md-heading" id="symbol-input"><a href="#symbol-input">Symbol input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.symbol">input.symbol()</a>
function creates a widget that allows users to search and select symbols
like they would from the chart’s user interface.</p>
<p>Let’s add a symbol input to our script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true)
tfInput = input.timeframe("D", "Timeframe")
symbolInput = input.symbol("", "Symbol")
ma = ta.sma(close, 20)
securityNoRepaint(sym, tf, src) =&gt;
    request.security(sym, tf, src[barstate.isrealtime ? 1 : 0])[barstate.isrealtime ? 0 : 1]
maHTF = securityNoRepaint(symbolInput, tfInput, ma)
plot(maHTF, "MA", color.aqua)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">defval</code> argument we use is an empty string. This causes
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>,
where we use the <code dir="auto">symbolInput</code> variable containing that input, to
use the chart’s symbol by default. If the user selects another
symbol and wants to return to the default value using the chart’s
symbol, he will need to use the “Reset Settings” selection from
the “Inputs” tab’s “Defaults” menu.</li>
<li>We use the <code dir="auto">securityNoRepaint()</code> user-defined function to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
in such a way that it does not repaint; it only returns values when
the higher timeframe has completed.</li>
</ul>
<h3 class="md-heading" id="session-input"><a href="#session-input">Session input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Session inputs are useful to gather start-stop values for periods of
time. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.session">input.session()</a>
built-in function creates an input widget allowing users to specify the
beginning and end time of a session. Selections can be made using a
dropdown menu, or by entering time values in “hh:mm” format.</p>
<p>The value returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.session">input.session()</a>
is a valid string in session format. See the manual’s page on
<a href="/pine-script-docs/v5/concepts/sessions/">sessions</a> for more
information.</p>
<p>Session information can also contain information on the days where the
session is valid. We use an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.string">input.string()</a>
function call here to input that day information:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Session input", "", true)
string sessionInput = input.session("0600-1700", "Session")
string daysInput = input.string("1234567", tooltip = "1 = Sunday, 7 = Saturday")
sessionString = sessionInput + ":" + daysInput
inSession = not na(time(timeframe.period, sessionString))
bgcolor(inSession ? color.silver : na)</code></div>
<p>Note that:</p>
<ul>
<li>This script proposes a default session of “0600-1700”.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.string">input.string()</a>
call uses a tooltip to provide users with help on the format to use
to enter day information.</li>
<li>A complete session string is built by concatenating the two strings
the script receives as inputs.</li>
<li>We explicitly declare the type of our two inputs with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_string">string</a>
keyword to make it clear those variables will contain a string.</li>
<li>We detect if the chart bar is in the user-defined session by calling
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
with the session string. If the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
value (the time at the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>)
is not in the session,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
so <code dir="auto">inSession</code> will be <code dir="auto">true</code> whenever
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
returns a value that is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</li>
</ul>
<p><div class="image-container"><img alt="image" decoding="async" height="670" loading="lazy" src="images/07d3efb5ab21310b5ad5f21eaa063b19.webp" width="1276"/></div></p>
<h3 class="md-heading" id="source-input"><a href="#source-input">Source input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Source inputs are useful to provide a selection of two types of sources:</p>
<ul>
<li>Price values, namely:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>.</li>
<li>The values plotted by other scripts on the chart. This can be useful
to “link” two or more scripts together by sending the output of
one as an input to another script.</li>
</ul>
<p>This script simply plots the user’s selection of source. We propose the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
as the default value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Source input", "", true)
srcInput = input.source(high, "Source")
plot(srcInput, "Src", color.new(color.purple, 70), 6)</code></div>
<p>This shows a chart where, in addition to our script, we have loaded an
“Arnaud Legoux Moving Average” indicator. See here how we use our
script’s source input widget to select the output of the ALMA script as
an input into our script. Because our script plots that source in a
light-purple thick line, you see the plots from the two scripts overlap
because they plot the same value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="820" loading="lazy" src="images/46735952d29381f53ee1dffae61d88c5.webp" width="1747"/></div></p>
<h3 class="md-heading" id="time-input"><a href="#time-input">Time input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Time inputs use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a>
function. The function returns a Unix time in milliseconds (see the
<a href="/pine-script-docs/v5/concepts/time/">Time</a> page for more
information). This type of data also contains date information, so the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a>
function returns a time <strong>and</strong> a date. That is the reason why its
widget allows for the selection of both.</p>
<p>Here, we test the bar’s time against an input value, and we plot an
arrow when it is greater:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Time input", "T", true)
timeAndDateInput = input.time(timestamp("1 Aug 2021 00:00 +0300"), "Date and time")
barIsLater = time &gt; timeAndDateInput
plotchar(barIsLater, "barIsLater", "🠆", location.top, size = size.tiny)</code></div>
<p>Note that the <code dir="auto">defval</code> value we use is a call to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a>
function.</p>
<h3 class="md-heading" id="enum-input"><a href="#enum-input">Enum input<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
function creates a dropdown input that displays <em>field titles</em>
corresponding to distinct <em>members</em> (possible values) of an
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>. The function returns one of the unique, named values from a
declared <a href="/pine-script-docs/v5/language/enums/">enum</a>, which scripts
can use in calculations and logic requiring more strict control over
allowed values and operations. Supply a list of enum members to the
<code dir="auto">options</code> parameter to specify the members users can select from the
dropdown. If one does not specify an enum field’s title, its title is
the “string” representation of its <em>name</em>.</p>
<p>This example declares a <code dir="auto">SignalType</code> enum with four fields representing
named signal display modes: <code dir="auto">long</code>, <code dir="auto">short</code>, <code dir="auto">both</code>, and <code dir="auto">none</code>. The
script uses a member of this
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a> as the <code dir="auto">defval</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
call to generate a dropdown in the “Inputs” tab, allowing users to
select one of the enum’s titles to control which signals it displays on
the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/b2773342c6c69a7586fa3d990f361434.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Enum input demo", overlay = true)

//@enum         An enumeration of named values representing signal display modes.
//@field long   Named value to specify that only long signals are allowed.
//@field short  Named value to specify that only short signals are allowed.
//@field both   Named value to specify that either signal type is allowed.
//@field none   Named value to specify that no signals are allowed. 
enum SignalType
    long  = "Only long signals"
    short = "Only short signals"
    both  = "Long and short signals"
    none 

//@variable An enumerator (member) of the `SignalType` enum. Controls the script's signals. 
SignalType sigInput = input.enum(SignalType.long, "Signal type")

// Calculate moving averages.
float ma1 = ta.sma(ohlc4, 10)
float ma2 = ta.sma(ohlc4, 200)
// Calculate cross signals. 
bool longCross  = ta.crossover(close, math.max(ma1, ma2))
bool shortCross = ta.crossunder(close, math.min(ma1, ma2))
// Calculate long and short signals based on the selected `sigInput` value.
bool longSignal = (sigInput == SignalType.long or sigInput == SignalType.both) and longCross
bool shortSignal = (sigInput == SignalType.short or sigInput == SignalType.both) and shortCross

// Plot shapes for the `longSignal` and `shortSignal`.
plotshape(longSignal, "Long signal", shape.triangleup, location.belowbar, color.teal, size = size.normal)
plotshape(shortSignal, "Short signal", shape.triangledown, location.abovebar, color.maroon, size = size.normal)
// Plot the moving averages.
plot(ma1, "Fast MA")
plot(ma2, "Slow MA") </code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">sigInput</code> value is the <code dir="auto">SignalType</code> member whose field
contains the selected title.</li>
<li>Since we did not specify a title for the <code dir="auto">none</code> field of the
enum, its title is the “string” representation of its name
(“none”), as we see in the above image of the enum input’s
dropdown.</li>
</ul>
<p>By default, an enum input displays the titles of all an enum’s members
within its dropdown. If we supply an <code dir="auto">options</code> argument to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.enum">input.enum()</a>
call, it will only allow users to select the members included in that
list, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">SignalType sigInput = input.enum(SignalType.long, "Signal type", options = [SignalType.long, SignalType.short])</code></div>
<p>The above <code dir="auto">options</code> argument specifies that users can only view and
select the titles of the <code dir="auto">long</code> and <code dir="auto">short</code> fields from the <code dir="auto">SignalType</code>
enum. No other options are allowed:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="568" loading="lazy" src="images/a4186757aaf51e0cc42b35dc7bd36718.webp" width="1338"/></div></p>
<h2 class="md-heading" id="other-features-affecting-inputs"><a href="#other-features-affecting-inputs">Other features affecting Inputs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Some parameters of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">strategy()</a>
functions populate a script’s “Settings/Inputs” tab with additional
inputs. These parameters are <code dir="auto">timeframe</code>, <code dir="auto">timeframe_gaps</code>, and
<code dir="auto">calc_bars_count</code>. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("MA", "", true, timeframe = "D", timeframe_gaps = false)
plot(ta.vwma(close, 10))</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="634" loading="lazy" src="images/92fcd0d4a7c8fea527870142d603065d.webp" width="1748"/></div></p>
<h2 class="md-heading" id="tips"><a href="#tips">Tips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The design of your script’s inputs has an important impact on the
usability of your scripts. Well-designed inputs are more intuitively
usable and make for a better user experience:</p>
<ul>
<li>Choose clear and concise labels (your input’s <code dir="auto">title</code> argument).</li>
<li>Choose your default values carefully.</li>
<li>Provide <code dir="auto">minval</code> and <code dir="auto">maxval</code> values that will prevent your code
from producing unexpected results, e.g., limit the minimal value of
lengths to 1 or 2, depending on the type of MA you are using.</li>
<li>Provide a <code dir="auto">step</code> value that is congruent with the value you are
capturing. Steps of 5 can be more useful on a 0-200 range, for
example, or steps of 0.05 on a 0.0-1.0 scale.</li>
<li>Group related inputs on the same line using <code dir="auto">inline</code>; bull and bear
colors for example, or the width and color of a line.</li>
<li>When you have many inputs, group them into meaningful sections using
<code dir="auto">group</code>. Place the most important sections at the top.</li>
<li>Do the same for individual inputs <strong>within</strong> sections.</li>
</ul>
<p>It can be advantageous to vertically align different arguments of
multliple <code dir="auto">input.*()</code> calls in your code. When you need to make global
changes, this will allow you to use the Editor’s multi-cursor feature
to operate on all the lines at once.</p>
<p>Because It is sometimes necessary to use Unicode spaces to In order to
achieve optimal alignment in inputs. This is an example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Aligned inputs", "", true)

var GRP1 = "Not aligned"
ma1SourceInput   = input(close, "MA source",     inline = "11", group = GRP1)
ma1LengthInput   = input(close, "Length",        inline = "11", group = GRP1)
long1SourceInput = input(close, "Signal source", inline = "12", group = GRP1)
long1LengthInput = input(close, "Length",        inline = "12", group = GRP1)

var GRP2 = "Aligned"
// The three spaces after "MA source" are Unicode EN spaces (U+2002).
ma2SourceInput   = input(close, "MA source   ",  inline = "21", group = GRP2)
ma2LengthInput   = input(close, "Length",        inline = "21", group = GRP2)
long2SourceInput = input(close, "Signal source", inline = "22", group = GRP2)
long2LengthInput = input(close, "Length",        inline = "22", group = GRP2)

plot(ta.vwma(close, 10))</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="946" loading="lazy" src="images/34c22dbfb970130345d505eb0a2f5bcd.webp" width="1752"/></div></p>
<p>Note that:</p>
<ul>
<li>We use the <code dir="auto">group</code> parameter to distinguish between the two sections
of inputs. We use a constant to hold the name of the groups. This
way, if we decide to change the name of the group, we only need to
change it in one place.</li>
<li>The first sections inputs widgets do not align vertically. We are
using <code dir="auto">inline</code>, which places the input widgets immediately to the
right of the label. Because the labels for the <code dir="auto">ma1SourceInput</code> and
<code dir="auto">long1SourceInput</code> inputs are of different lengths the labels are in
different <em>y</em> positions.</li>
<li>To make up for the misalignment, we pad the <code dir="auto">title</code> argument in the
<code dir="auto">ma2SourceInput</code> line with three Unicode EN spaces (U+2002). Unicode
spaces are necessary because ordinary spaces would be stripped from
the label. You can achieve precise alignment by combining different
quantities and types of Unicode spaces. See here for a list of
<a href="https://jkorpela.fi/chars/spaces.html" rel="nofollow">Unicode spaces</a> of different
widths.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/fills"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Fills  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/levels"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Levels <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Levels</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-levels"><a href="#levels">Levels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="hline-levels"><a href="#hline-levels">`hline()` levels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Levels are lines plotted using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
function. It is designed to plot <strong>horizontal</strong> levels using a <strong>single
color</strong>, i.e., it does not change on different bars. See the
<a href="/pine-script-docs/v5/concepts/plots/#levels">Levels</a> section of the
page on
<a href="https://www.tradingview.com/pine-script-reference/v5/#plot">plot()</a> for
alternative ways to plot levels when
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
won’t do what you need.</p>
<p>The function has the following signature:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">hline(price, title, color, linestyle, linewidth, editable) → hline</span></div></div></code></pre></figure></link></div>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
has a few constraints when compared to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>:</p>
<ul>
<li>Since the function’s objective is to plot horizontal lines, its
<code dir="auto">price</code> parameter requires an “input int/float” argument, which
means that “series float” values such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
or dynamically-calculated values cannot be used.</li>
<li>Its <code dir="auto">color</code> parameter requires an “input int” argument, which
precludes the use of dynamic colors, i.e., colors calculated on each
bar — or “series color” values.</li>
<li>Three different line styles are supported through the <code dir="auto">linestyle</code>
parameter: <code dir="auto">hline.style_solid</code>, <code dir="auto">hline.style_dotted</code> and
<code dir="auto">hline.style_dashed</code>.</li>
</ul>
<p>Let’s see
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
in action in the “True Strength Index” indicator:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("TSI")
myTSI = 100 * ta.tsi(close, 25, 13)

hline( 50, "+50",  color.lime)
hline( 25, "+25",  color.green)
hline(  0, "Zero", color.gray, linestyle = hline.style_dotted)
hline(-25, "-25",  color.maroon)
hline(-50, "-50",  color.red)

plot(myTSI)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="376" loading="lazy" src="images/e04317d3acebc2c2f68593192b165046.webp" width="1756"/></div></p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/3f88a54f307f6639eecd5d91e9a55f37.webp" width="1750"/></div></p>
<p>Note that:</p>
<ul>
<li>We display 5 levels, each of a different color.</li>
<li>We use a different line style for the zero centerline.</li>
<li>We choose colors that will work well on both light and dark themes.</li>
<li>The usual range for the indicator’s values is +100 to -100. Since
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dtsi">ta.tsi()</a>
built-in returns values in the +1 to -1 range, we make the
adjustment in our code.</li>
</ul>
<h2 class="md-heading" id="fills-between-levels"><a href="#fills-between-levels">Fills between levels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The space between two levels plotted with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
can be colored using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>.
Keep in mind that <strong>both</strong> plots must have been plotted with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>.</p>
<p>Let’s put some background colors in our TSI indicator:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("TSI")
myTSI = 100 * ta.tsi(close, 25, 13)

plus50Hline  = hline( 50, "+50",  color.lime)
plus25Hline  = hline( 25, "+25",  color.green)
zeroHline    = hline(  0, "Zero", color.gray, linestyle = hline.style_dotted)
minus25Hline = hline(-25, "-25",  color.maroon)
minus50Hline = hline(-50, "-50",  color.red)

// ————— Function returns a color in a light shade for use as a background.
fillColor(color col) =&gt;
    color.new(col, 90)

fill(plus50Hline,  plus25Hline,  fillColor(color.lime))
fill(plus25Hline,  zeroHline,    fillColor(color.teal))
fill(zeroHline,    minus25Hline, fillColor(color.maroon))
fill(minus25Hline, minus50Hline, fillColor(color.red))

plot(myTSI)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="260" loading="lazy" src="images/e9caee64f36c72a5a40c7b56fe566906.webp" width="1282"/></div></p>
<p><div class="image-container"><img alt="image" decoding="async" height="262" loading="lazy" src="images/1c1f527ddd3067d6b4e1ff95364a0f77.webp" width="1280"/></div></p>
<p>Note that:</p>
<ul>
<li>We have now used the return value of our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
function calls, which is of the
<a href="/pine-script-docs/v5/language/type-system/#plot-and-hline">hline</a> special type. We use the <code dir="auto">plus50Hline</code>, <code dir="auto">plus25Hline</code>,
<code dir="auto">zeroHline</code>, <code dir="auto">minus25Hline</code> and <code dir="auto">minus50Hline</code> variables to store
those “hline” IDs because we will need them in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
calls later.</li>
<li>To generate lighter color shades for the background colors, we
declare a <code dir="auto">fillColor()</code> function that accepts a color and returns
its 90 transparency. We use calls to that function for the <code dir="auto">color</code>
arguments in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
calls.</li>
<li>We make our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>
calls for each of the four different fills we want, between four
different pairs of levels.</li>
<li>We use <code dir="auto">color.teal</code> in our second fill because it produces a green
that fits the color scheme better than the <code dir="auto">color.green</code> used for
the 25 level.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/inputs"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Inputs  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/libraries"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Libraries <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Libraries</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-libraries"><a href="#libraries">Libraries<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ libraries are publications containing functions that can be
reused in indicators, strategies, or in other libraries. They are useful
to define frequently-used functions so their source code does not have
to be included in every script where they are needed.</p>
<p>A library must be published (privately or publicly) before it can be
used in another script. All libraries are published open-source. Public
scripts can only use public libraries and they must be open-source.
Private scripts or personal scripts saved in the Pine Script™ Editor can
use public or private libraries. A library can use other libraries, or
even previous versions of itself.</p>
<p>Library programmers should be familiar with Pine Script™‘s typing
nomenclature, scopes and user-defined functions. If you need to brush up
on qualified types, see the User Manual’s page on the
<a href="/pine-script-docs/v5/language/type-system/">Type system</a>. For more
information on user-defined functions and scopes, see the
<a href="/pine-script-docs/v5/language/user-defined-functions/">User-defined functions</a> page.</p>
<p>You can browse the library scripts published publicly by members in
TradingView’s <a href="https://www.tradingview.com/scripts/?script_type=libraries">Community
Scripts</a>.</p>
<h2 class="md-heading" id="creating-a-library"><a href="#creating-a-library">Creating a library<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A library is a special kind of script that begins with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>
declaration statement, rather than
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>.
A library contains exportable
<a href="/pine-script-docs/v5/language/user-defined-functions/">function</a>,
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>,
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>,
and <a href="/pine-script-docs/v5/language/type-system/#enum-types">enum</a> definitions, which constitute the only visible part of the
library when imported by another script. Like other script types,
libraries can also include Pine Script™ code in their global scopes.
Programmers typically use a library’s global code to demonstrate how
other scripts can use its exported structures.</p>
<p>A library script has a structure like the following, which must include
one or more exportable functions or types:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// @description &lt;library_description&gt;
library(title, overlay)

&lt;script_code&gt;

//@type &lt;type_description&gt;
//@field &lt;field_name&gt; &lt;field_description&gt;
// ...
export type &lt;UDT_identifier&gt;
    &lt;field_type&gt; &lt;field_name&gt;[ = &lt;value&gt;]   
    ... 

//@enum &lt;enum_description&gt;
//@field &lt;field_name&gt; &lt;field_description&gt;
// ...
export enum &lt;enum_name&gt;
    &lt;field_name&gt;[ = &lt;field_title&gt;]
    ...

//@function &lt;function_description&gt;
//@param &lt;parameter&gt; &lt;parameter_description&gt;
//@returns &lt;return_value_description&gt;
export &lt;function_name&gt;([simple/series] &lt;parameter_type&gt; &lt;parameter_name&gt; [= &lt;default_value&gt;] [, ...]) =&gt;
    &lt;function_code&gt;

&lt;script_code&gt;</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">//@description</code>, <code dir="auto">//@enum</code>, <code dir="auto">//@type</code>, <code dir="auto">@field</code>,
<code dir="auto">// @function</code>, <code dir="auto">// @param</code>, and <code dir="auto">// @returns</code>
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotations</a> are optional but we highly recommend you use them. These
annotations document the library’s code and populate the default
library description, which authors can use when publishing the
library.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_export">export</a>
keyword is mandatory.</li>
<li>&lt;parameter_type&gt; is mandatory, contrary to user-defined function
parameter definitions in indicators or strategies, which are
typeless.</li>
<li>&lt;script_code&gt; can be any code one would normally use in an
indicator, including <a href="/pine-script-docs/v5/concepts/inputs/">inputs</a>.</li>
</ul>
<p>This is an example library:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// @description Provides functions calculating the all-time high/low of values.
library("AllTimeHighLow", true)

// @function Calculates the all-time high of a series.
// @param val Series to use (`high` is used if no argument is supplied).
// @returns The all-time high for the series.
export hi(float val = high) =&gt;
    var float ath = val
    ath := math.max(ath, val)

// @function Calculates the all-time low of a series.
// @param val Series to use (`low` is used if no argument is supplied).
// @returns The all-time low for the series.
export lo(float val = low) =&gt;
    var float atl = val
    atl := math.min(atl, val)

plot(hi())
plot(lo())</code></div>
<h3 class="md-heading" id="library-functions"><a href="#library-functions">Library functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Exported functions and methods have slightly different requirements and constraints compared to non-exported functions.</p>
<p>In exported library function signatures (their first line):</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_export">export</a> is mandatory.</li>
<li>The function’s signature must include type keywords to specify the required <a href="/pine-script-docs/v5/language/type-system/#types">type</a> for each parameter.</li>
<li>Programmers can include either the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_simple">simple</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_series">series</a> qualifier keywords to specify the qualified type each parameter accepts. See the <a href="/pine-script-docs/v5/concepts/libraries/#qualified-type-control">next section</a> for more information.</li>
</ul>
<p>Exported library functions have the following constraints:</p>
<ul>
<li>They cannot use variables from the library’s global scope except for those with the “const” qualifier, meaning they cannot use global
variables initialized from script inputs, for example, or globally declared <a href="/pine-script-docs/v5/language/arrays/">arrays</a>.</li>
<li>They cannot include calls to any <code dir="auto">input.*()</code> functions.</li>
<li>They cannot call <code dir="auto">request.*()</code> functions in their local scopes unless the script includes <code dir="auto">dynamic_requests = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a> declaration statement. See <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#dynamic-requests">this section</a> of the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data">Other timeframes and data</a> page to learn more about <em>dynamic requests</em>.</li>
</ul>
<p>Library functions always return “simple” or “series” results. Consequently, scripts cannot use their returned values in locations requiring “const” or “input” values. For example, a library function cannot calculate an argument for the <code dir="auto">show_last</code> parameter in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> call because the parameter requires an “input int” qualified type.</p>
<h3 class="md-heading" id="qualified-type-control"><a href="#qualified-type-control">Qualified type control<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The qualified types of arguments supplied in calls to library functions
are autodetected based on how each argument is used inside the function.
If the argument can be used as a “series”, it is qualified as such. If
it cannot, an attempt is made with the “simple” type qualifier. This
explains why this code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">export myEma(int x) =&gt;
    ta.ema(close, x)</code></div>
<p>will work when called using <code dir="auto">myCustomLibrary.myEma(20)</code>, even though
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>‘s
<code dir="auto">length</code> parameter requires a “simple int” argument. When the Pine
Script™ compiler detects that a “series” length cannot be used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>,
it tries the “simple” qualifier, which in this case is allowed.</p>
<p>While library functions cannot return “const” or “input” values,
they can be written to produce “simple” results. This makes them
useful in more contexts than functions returning “series” results, as
some built-in functions do not allow “series” arguments. For example,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
requires a “simple string” argument for its <code dir="auto">symbol</code> parameter when a script does not allow <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#dynamic-requests">dynamic requests</a>. If we wrote a
library function to assemble the argument to <code dir="auto">symbol</code> in the following
way, the function’s result would not work with a non-dynamic <code dir="auto">request.*()</code> call because it is of the “series
string” qualified type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">export makeTickerid(string prefix, string ticker) =&gt;
    prefix + ":" + ticker</code></div>
<p>However, by restricting the parameter qualifiers to “simple”, we can
force the function to yield a “simple” result. We can achieve this by
prefixing the parameters’ type with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_simple">simple</a>
keyword:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">export makeTickerid(simple string prefix, simple string ticker) =&gt;
    prefix + ":" + ticker</code></div>
<p>Note that for the function to return a “simple” value, no “series”
values can be used in its calculation; otherwise the result will be a
“series” value.</p>
<p>One can also use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_simple">series</a>
keyword to prefix the type of a library function parameter. However,
because arguments are qualified as “series” by default, using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_simple">series</a>
modifier is redundant.</p>
<h3 class="md-heading" id="user-defined-types-and-objects"><a href="#user-defined-types-and-objects">User-defined types and objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Libraries can export <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types (UDTs)</a>, and library functions can return <a href="/pine-script-docs/v5/language/objects/">objects</a> of these types.</p>
<p>To export a UDT, prefix its definition with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_export">export</a>
keyword, similar to exporting a function:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5    
library("Point")    

export type point   
    int x   
    float y 
    bool isHi   
    bool wasBreached = false    </code></div>
<p>A script importing that library and creating an
<a href="/pine-script-docs/v5/language/objects/">object</a> of its <code dir="auto">point</code> UDT
would look somewhat like this:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5  
indicator("") 
import userName/Point/1 as pt 
newPoint = pt.point.new() </code></div>
<p>Note that:</p>
<ul>
<li>This code won’t compile because no “Point” library is published,
and the script doesn’t display anything.</li>
<li><code dir="auto">userName</code> would need to be replaced by the TradingView user name of
the library’s publisher.</li>
<li>We use the built-in <code dir="auto">new()</code> method to create an object from the
<code dir="auto">point</code> UDT.</li>
<li>We prefix the reference to the library’s <code dir="auto">point</code> UDT with the <code dir="auto">pt</code>
alias defined in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statement, just like we would when using a function from an imported
library.</li>
</ul>
<p>A library <strong>must</strong> export a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a> if
any exported functions or methods accept or return an
<a href="/pine-script-docs/v5/language/objects/">object</a> of that type, or if
the fields of another exported
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
accept an instance of the type.</p>
<p>When a library only uses a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
internally, it does not need to export the type. The following library
uses the <code dir="auto">point</code> type internally, but it only exports the <code dir="auto">drawPivots()</code>
function, which does not have a parameter of the <code dir="auto">point</code> type or return
a <code dir="auto">point</code> <a href="/pine-script-docs/v5/language/objects/">object</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5    
library("PivotLabels", true)    

// We use this `point` UDT in the library, but it does NOT require exporting because    
//   1. The exported function's parameters do not use the UDT.  
//   2. The exported function does not return a UDT result. 
type point  
    int x   
    float y 
    bool isHi   
    bool wasBreached = false    


fillPivotsArray(qtyLabels, leftLegs, rightLegs) =&gt;  
    // Create an array of the specified qty of pivots to maintain.  
    var pivotsArray = array.new&lt;point&gt;(math.max(qtyLabels, 0))  

    // Detect pivots.   
    float pivotHi = ta.pivothigh(leftLegs, rightLegs)   
    float pivotLo = ta.pivotlow(leftLegs, rightLegs)    

    // Create a new `point` object when a pivot is found.   
    point foundPoint = switch   
        pivotHi =&gt; point.new(time[rightLegs], pivotHi, true)    
        pivotLo =&gt; point.new(time[rightLegs], pivotLo, false)   
        =&gt; na   

    // Add new pivot info to the array and remove the oldest pivot. 
    if not na(foundPoint)   
        array.push(pivotsArray, foundPoint) 
        array.shift(pivotsArray)    

    array&lt;point&gt; result = pivotsArray   


detectBreaches(pivotsArray) =&gt;  
    // Detect breaches. 
    for [i, eachPoint] in pivotsArray   
        if not na(eachPoint)    
            if not eachPoint.wasBreached    
                bool hiWasBreached =     eachPoint.isHi and high[1] &lt;= eachPoint.y and high &gt; eachPoint.y   
                bool loWasBreached = not eachPoint.isHi and low[1]  &gt;= eachPoint.y and low  &lt; eachPoint.y   
                if hiWasBreached or loWasBreached   
                    // This pivot was breached; change its `wasBreached` field. 
                    point p = array.get(pivotsArray, i) 
                    p.wasBreached := true   
                    array.set(pivotsArray, i, p)    


drawLabels(pivotsArray) =&gt;  
    for eachPoint in pivotsArray    
        if not na(eachPoint)    
            label.new(  
              eachPoint.x,  
              eachPoint.y,  
              str.tostring(eachPoint.y, format.mintick),    
              xloc.bar_time,    
              color = eachPoint.wasBreached ? color.gray : eachPoint.isHi ? color.teal : color.red, 
              style = eachPoint.isHi ? label.style_label_down: label.style_label_up,    
              textcolor = eachPoint.wasBreached ? color.silver : color.white)   


// @function        Displays a label for each of the last `qtyLabels` pivots.   
//                  Colors high pivots in green, low pivots in red, and breached pivots in gray.    
// @param qtyLabels (simple int) Quantity of last labels to display.    
// @param leftLegs  (simple int) Left pivot legs.   
// @param rightLegs (simple int) Right pivot legs.  
// @returns         Nothing.    
export drawPivots(int qtyLabels, int leftLegs, int rightLegs) =&gt;    
    // Gather pivots as they occur. 
    pointsArray = fillPivotsArray(qtyLabels, leftLegs, rightLegs)   

    // Mark breached pivots.    
    detectBreaches(pointsArray) 

    // Draw labels once.    
    if barstate.islastconfirmedhistory  
        drawLabels(pointsArray) 


// Example use of the function. 
drawPivots(20, 10, 5)   </code></div>
<p>If the TradingView user published the above library, it could be used
like this:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5  
indicator("") 
import TradingView/PivotLabels/1 as dpl   
dpl.drawPivots(20, 10, 10)</code></div>
<h3 class="md-heading" id="enum-types"><a href="#enum-types">Enum types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Libraries can also export
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum types</a>, allowing other scripts to import sets of predefined, named
values that help control the values accepted by variables, conditional
expressions, and
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>.</p>
<p>For example, this library exports a <code dir="auto">State</code> enum with three fields
representing distinct signal states: <code dir="auto">long</code>, <code dir="auto">short</code>, and <code dir="auto">neutral</code>.
These fields represent the <em>possible values</em> a variable, expression, or
collection of the
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a> can take on:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
library("Signal")

//@enum           An enumeration of named signal states.
//@field long     Represents a "Long" signal.
//@field short    Represents a "Short" signal.
//@field neutral  Represents a "Neutral" signal. 
export enum State
    long    = "Long"
    short   = "Short"
    neutral = "Neutral"</code></div>
<p>A script that imports this library can use the members (values) of the
<code dir="auto">State</code> enum as named states in its logic. Here, we show a simple,
hypothetical script that imports the “Signal” library published by the
<code dir="auto">userName</code> user and uses the <code dir="auto">Signal.State</code> enum to assign one of three
possible values to a <code dir="auto">mySignal</code> variable:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")

import userName/Signal/1 as Signal

// Calculate the median and quarter range values. 
float medianValue = ta.median(close, 100)
float rangeValue  = ta.range(close, 100) * 0.25
// Calculate upper and lower channel values.
float upper = medianValue + rangeValue
float lower = medianValue - rangeValue

//@variable Returns `Signal.State.long`, `Signal.State.short`, or `Signal.State.neutral` based on the price action.
Signal.State mySignal = switch
    close &gt; upper =&gt; Signal.State.long
    close &lt; lower =&gt; Signal.State.short
    =&gt;               Signal.State.neutral

plot(close, color = mySignal == Signal.State.long ? color.green : mySignal == Signal.State.short ? color.red : na)</code></div>
<p>Similar to exporting <a href="/pine-script-docs/v5/concepts/libraries/#user-defined-types-and-objects">UDTs</a>, a library <strong>must</strong> export an enum when its exported
functions or methods accept or return the
<a href="/pine-script-docs/v5/language/enums/">enum’s</a> members, or when the
fields of an exported
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
accept values of that
<a href="/pine-script-docs/v5/language/type-system/#enum-types">enum type</a>.</p>
<h2 class="md-heading" id="publishing-a-library"><a href="#publishing-a-library">Publishing a library<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Before you or other Pine Script™ programmers can reuse any library, it
must be published. If you want to share your library with all
TradingViewers, publish it publicly. To use it privately, use a private
publication. As with indicators or strategies, the active chart when you
publish a library will appear in both its widget (the small placeholder
denoting libraries in the TradingView scripts stream) and script page
(the page users see when they click on the widget).</p>
<p>Private libraries can be used in public Protected or Invite-only
scripts.</p>
<p>After adding our example library to the chart and setting up a clean
chart showing our library plots the way we want them, we use the Pine
Editor’s “Publish Script” button. The “Publish Library” window
comes up:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="855" loading="lazy" src="images/b065fcb57fa8b13771cb59f266152dee.webp" width="1304"/></div></p>
<p>Note that:</p>
<ul>
<li>We leave the library’s title as is (the <code dir="auto">title</code> argument in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>
declaration statement is used as the default). While you can change
the publication’s title, it is preferable to keep its default value
because the <code dir="auto">title</code> argument is used to reference imported libraries
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statement. It makes life easier for library users when your
publication’s title matches the actual name of the library.</li>
<li>A default description is built from the
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotations</a> we used in our library. We will publish the library
wihout retouching it.</li>
<li>We chose to publish our library publicly, so it will be visible to
all TradingViewers.</li>
<li>We do not have the possibility of selecting a visibility type other
than “Open” because libraries are always open-source.</li>
<li>The list of categories for libraries is different than for
indicators and strategies. We have selected the “Statistics and
Metrics” category.</li>
<li>We have added some custom tags: “all-time”, “high” and “low”.</li>
</ul>
<p>The intended users of public libraries being other Pine programmers; the
better you explain and document your library’s functions, the more
chances others will use them. Providing examples demonstrating how to
use your library’s functions in your publication’s code will also
help.</p>
<h3 class="md-heading" id="house-rules"><a href="#house-rules">House Rules<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine libraries are considered “public domain” code in our <a href="https://www.tradingview.com/support/solutions/43000590599">House Rules
on Script
Publishing</a>,
which entails that permission is not required from their author if you
call their functions or reuse their code in your open-source scripts.
However, if you intend to reuse code from a Pine Script™ library’s
functions in a public protected or invite-only publication, explicit
permission for reuse in that form is required from its author.</p>
<p>Whether using a library’s functions or reusing its code, you must
credit the author in your publication’s description. It is also good
form to credit in open-source comments.</p>
<h2 class="md-heading" id="using-a-library"><a href="#using-a-library">Using a library<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Using a library from another script (which can be an indicator, a
strategy or another library), is done through the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statement:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">import &lt;username&gt;/&lt;libraryName&gt;/&lt;libraryVersion&gt; [as &lt;alias&gt;]</span></div></div></code></pre></figure></link></div>
<p>where:</p>
<ul>
<li>The &lt;username&gt;/&lt;libraryName&gt;/&lt;libraryVersion&gt; path will
uniquely identify the library.</li>
<li>The &lt;libraryVersion&gt; must be specified explicitly. To ensure the
reliability of scripts using libraries, there is no way to
automatically use the latest version of a library. Every time a
library update is published by its author, the library’s version
number increases. If you intend to use the latest version of the
library, the &lt;libraryVersion&gt; value will require updating in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statement.</li>
<li>The <code dir="auto">as &lt;alias&gt;</code> part is optional. When used, it defines the
namespace that will refer to the library’s functions. For example,
if you import a library using the <code dir="auto">allTime</code> alias as we do in the
example below, you will refer to that library’s functions as
<code dir="auto">allTime.&lt;function_mame&gt;()</code>. When no alias is defined, the
library’s name becomes its namespace.</li>
</ul>
<p>To use the library we published in the previous section, our next script
will require an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statement:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">import PineCoders/AllTimeHighLow/1 as allTime</code></div>
<p>As you type the user name of the library’s author, you can use the
Editor’s <code dir="auto">ctrl</code> +
<code dir="auto">space</code> / <code dir="auto">cmd</code> “Auto-complete”
command to display a popup providing selections that match the available
libraries:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="111" loading="lazy" src="images/a1de2087391741be3ef958a2ee1aed6b.webp" width="726"/></div></p>
<p>This is an indicator that reuses our library:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Using AllTimeHighLow library", "", true)
import PineCoders/AllTimeHighLow/1 as allTime

plot(allTime.hi())
plot(allTime.lo())
plot(allTime.hi(close))</code></div>
<p>Note that:</p>
<ul>
<li>We have chosen to use the “allTime” alias for the library’s
instance in our script. When typing that alias in the Editor, a
popup will appear to help you select the particular function you
want to use from the library.</li>
<li>We use the library’s <code dir="auto">hi()</code> and <code dir="auto">lo()</code> functions without an
argument, so the default
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
built-in variables will be used for their series, respectively.</li>
<li>We use a second call to <code dir="auto">allTime.hi()</code>, but this time using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
as its argument, to plot the highest
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
in the chart’s history.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/levels"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Levels  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/lines-and-boxes"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Lines and boxes <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Lines and boxes</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-lines-and-boxes"><a href="#lines-and-boxes">Lines and boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ facilitates drawing lines, boxes, and other geometric
formations from code using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
types. These types provide utility for programmatically drawing support
and resistance levels, trend lines, price ranges, and other custom
formations on a chart.</p>
<p>Unlike <a href="/pine-script-docs/v5/concepts/plots/">plots</a>, the
flexibility of these types makes them particularly well-suited for
visualizing current calculated data at virtually any available point on
the chart, irrespective of the chart bar the script executes on.</p>
<p><a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">Lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>
are <em>objects</em>, like
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>,
<a href="/pine-script-docs/v5/concepts/tables/">tables</a>, and other <em>special
types</em>. Scripts reference objects of these types using IDs, which act
like <em>pointers</em>. As with other objects,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
IDs are qualified as “series” values, and all functions that manage
these objects accept “series” arguments.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Using the types we discuss on this page often involves
<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, especially when
working with <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>, which <em>require</em> an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
instances. We therefore recommend you become familiar with
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> to make the most of
these drawing types in your scripts.</p></div></aside>
<p>Lines drawn by a script may be vertical, horizontal, or angled. Boxes
are always rectangular. Polylines sequentially connect multiple
vertical, horizontal, angled, or curved line segments. Although all of
these drawing types have different characteristics, they do have some
things in common:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">Lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a> can have coordinates at any available location on the
chart, including ones at future times beyond the last chart bar.</li>
<li>Objects of these types can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
instances to set their coordinates.</li>
<li>The x-coordinates of each object can be bar index or time values,
depending on their specified <code dir="auto">xloc</code> property.</li>
<li>Each object can have one of multiple predefined line styles.</li>
<li>Scripts can call the functions that manage these objects from within
the scopes of <a href="/pine-script-docs/v5/language/loops/">loops</a> and
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>, allowing iterative and conditional control of their
drawings.</li>
<li>There are limits on the number of these objects that a script can
reference and display on the chart. A single script instance can
display up to 500 lines, 500 boxes, and 100 polylines. Users can
specify the maximum number allowed for each type via the
<code dir="auto">max_lines_count</code>, <code dir="auto">max_boxes_count</code>, and <code dir="auto">max_polylines_count</code>
parameters of the script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement. If unspecified, the default is ~50. As with
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
types, lines, boxes, and polylines utilize a <em>garbage collection</em>
mechanism that deletes the oldest objects on the chart when the
total number of drawings exceeds the script’s limit.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>On TradingView charts, a complete set of <em>Drawing Tools</em> allows users to
create and modify drawings using mouse actions. While they may sometimes
resemble drawing objects created with Pine Script™ code, they are
<strong>unrelated</strong> entities. Pine scripts cannot interact with drawing tools
from the chart user interface, and mouse actions do not directly affect
Pine drawing objects.</p></div></aside>
<h2 class="md-heading" id="lines"><a href="#lines">Lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The built-ins in the <code dir="auto">line.*</code> namespace control the creation and
management of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
objects:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
function creates a new line.</li>
<li>The <code dir="auto">line.set_*()</code> functions modify line properties.</li>
<li>The <code dir="auto">line.get_*()</code> functions retrieve values from a line instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy">line.copy()</a>
function clones a line instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>
function deletes an existing line instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.all">line.all</a>
variable references a read-only
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing the IDs of all lines displayed by the script. The
array’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
depends on the <code dir="auto">max_lines_count</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement and the number of lines the script has drawn.</li>
</ul>
<p>Scripts can call <code dir="auto">line.set_*()</code>, <code dir="auto">line.get_*()</code>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy">line.copy()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>
built-ins as functions or <a href="/pine-script-docs/v5/language/methods/">methods</a>.</p>
<h3 class="md-heading" id="creating-lines"><a href="#creating-lines">Creating lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
function creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instance to display on the chart. It has the following signatures:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">line.new(first_point, second_point, xloc, extend, color, style, width, force_overlay) → series line</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">line.new(x1, y1, x2, y2, xloc, extend, color, style, width, force_overlay) → series line</span></div></div></code></pre></figure></link></div>
<p>The first overload of this function contains the <code dir="auto">first_point</code> and
<code dir="auto">second_point</code> parameters. The <code dir="auto">first_point</code> is a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
representing the start of the line, and the <code dir="auto">second_point</code> is a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
representing the line’s end. The function copies the information from
these
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> to determine the line’s coordinates. Whether it uses the
<code dir="auto">index</code> or <code dir="auto">time</code> fields from the <code dir="auto">first_point</code> and <code dir="auto">second_point</code> as
x-coordinates depends on the function’s <code dir="auto">xloc</code> value.</p>
<p>The second overload specifies <code dir="auto">x1</code>, <code dir="auto">y1</code>, <code dir="auto">x2</code>, and <code dir="auto">y2</code> values
independently, where <code dir="auto">x1</code> and <code dir="auto">x2</code> are
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
values representing the starting and ending x-coordinates of the line,
and <code dir="auto">y1</code> and <code dir="auto">y2</code> are
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values representing the y-coordinates. Whether the line considers the
<code dir="auto">x</code> values as bar indices or timestamps depends on the <code dir="auto">xloc</code> value in
the function call.</p>
<p>Both overloads share the same additional parameters:</p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer/>Controls whether the x-coordinates of the new line use bar index or
time values. Its default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>.</p>
<p class="spacer-wrapper"><spacer/>When calling the first overload, using an <code dir="auto">xloc</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
tells the function to use the <code dir="auto">index</code> fields of the <code dir="auto">first_point</code>
and <code dir="auto">second_point</code>, and a value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>
tells the function to use the <code dir="auto">time</code> fields of the points.</p>
<p class="spacer-wrapper"><spacer/>When calling the second overload, an <code dir="auto">xloc</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
prompts the function to treat the <code dir="auto">x1</code> and <code dir="auto">x2</code> arguments as bar
index values. When using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>,
the function will treat <code dir="auto">x1</code> and <code dir="auto">x2</code> as time values.</p>
<p class="spacer-wrapper"><spacer/>When the specified x-coordinates represent <em>bar index</em> values, it’s
important to note that the minimum x-coordinate allowed is
<code dir="auto">bar_index - 9999</code>. For larger offsets, one can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>.</p>
<p><code dir="auto">extend</code></p>
<p class="spacer-wrapper"><spacer/>Determines whether the drawn line will infinitely extend beyond its
defined start and end coordinates. It accepts one of the following
values:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.left">extend.left</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right">extend.right</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.both">extend.both</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.none">extend.none</a>
(default).</p>
<p><code dir="auto">color</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the color of the line drawing. The default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue">color.blue</a>.</p>
<p><code dir="auto">style</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the line’s style, which can be any of the options listed
in this page’s
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#line-styles">Line styles</a> section. The default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_solid">line.style_solid</a>.</p>
<p><code dir="auto">width</code></p>
<p class="spacer-wrapper"><spacer/>Controls the width of the line, in pixels. The default value is 1.</p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer/>If <code dir="auto">true</code>, the drawing will display on the main chart pane, even when the script occupies a separate pane. Optional. The default is <code dir="auto">false</code>.</p>
<p>The example below demonstrates how one can draw lines in their simplest
form. This script draws a new vertical line connecting the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices at the horizontal center of each chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="550" loading="lazy" src="images/7b5eb53a810ec6353bd2e17d8e2bbb40.webp" width="1334"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Creating lines demo", overlay = true)

//@variable The `chart.point` for the start of the line. Contains `index` and `time` information.
firstPoint = chart.point.now(open)
//@variable The `chart.point` for the end of the line. Contains `index` and `time` information.
secondPoint = chart.point.now(close)

// Draw a basic line with a `width` of 5 connecting the `firstPoint` to the `secondPoint`.
// This line uses the `index` field from each point for its x-coordinates.
line.new(firstPoint, secondPoint, width = 5)

// Color the background on the unconfirmed bar.
bgcolor(barstate.isconfirmed ? na : color.new(color.orange, 70), title = "Unconfirmed bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>If the <code dir="auto">firstPoint</code> and <code dir="auto">secondPoint</code> reference identical
coordinates, the script will <em>not</em> display a line since there is
no distance between them to draw. However, the line ID will
still exist.</li>
<li>The script will only display approximately the last 50 lines on
the chart, as it does not have a specified <code dir="auto">max_lines_count</code> in
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call. Line drawings persist on the chart until deleted
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>
or removed by the garbage collector.</li>
<li>The script <em>redraws</em> the line on the open chart bar (i.e., the
bar with an orange background highlight) until it closes. After
the bar closes, it will no longer update the drawing.</li>
</ul>
<p>Let’s look at a more involved example. This script uses the previous
bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>
price and the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
prices to draw a fan with a user-specified number of lines projecting a
range of hypothetical price values for the following chart bar. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
within a <a href="/pine-script-docs/v5/language/loops/#for-loops">for</a> loop to
create <code dir="auto">linesPerBar</code> lines on each bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="598" loading="lazy" src="images/e8e1d6f2a468eab9ef021608ddd445c1.webp" width="1328"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Creating lines demo", "Simple projection fan", true, max_lines_count = 500)

//@variable The number of fan lines drawn on each chart bar.
int linesPerBar = input.int(20, "Line drawings per bar", 2, 100)

//@variable The distance between each y point on the current bar.
float step = (high - low) / (linesPerBar - 1)

//@variable The `chart.point` for the start of each line. Does not contain `time` information.
firstPoint = chart.point.from_index(bar_index - 1, hl2[1])
//@variable The `chart.point` for the end of each line. Does not contain `time` information.
secondPoint = chart.point.from_index(bar_index + 1, float(na))

//@variable The stepped y value on the current bar for `secondPoint.price` calculation, starting from the `low`.
float barValue = low
// Loop to draw the fan.
for i = 1 to linesPerBar
    // Update the `price` of the `secondPoint` using the difference between the `barValue` and `firstPoint.price`.
    secondPoint.price := 2.0 * barValue - firstPoint.price
    //@variable Is `color.aqua` when the line's slope is positive, `color.fuchsia` otherwise.
    color lineColor = secondPoint.price &gt; firstPoint.price ? color.aqua : color.fuchsia
    // Draw a new `lineColor` line connecting the `firstPoint` and `secondPoint` coordinates.
    // This line uses the `index` field from each point for its x-coordinates.
    line.new(firstPoint, secondPoint, color = lineColor)
    // Add the `step` to the `barValue`.
    barValue += step

// Color the background on the unconfirmed bar.
bgcolor(barstate.isconfirmed ? na : color.new(color.orange, 70), title = "Unconfirmed bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We’ve included <code dir="auto">max_lines_count = 500</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call, meaning the script preserves up to 500 lines on
the chart.</li>
<li>Each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
call <em>copies</em> the information from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
referenced by the <code dir="auto">firstPoint</code> and <code dir="auto">secondPoint</code> variables. As
such, the script can change the <code dir="auto">price</code> field of the
<code dir="auto">secondPoint</code> on each loop iteration without affecting the
y-coordinates in other lines.</li>
</ul>
<h3 class="md-heading" id="modifying-lines"><a href="#modifying-lines">Modifying lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">line.*</code> namespace contains multiple <em>setter</em> functions that modify
the properties of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instances:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_first_point">line.set_first_point()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_second_point">line.set_second_point()</a>
respectively update the start and end points of the <code dir="auto">id</code> line using
information from the specified <code dir="auto">point</code>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_x1">line.set_x1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_x2">line.set_x2()</a>
set one of the x-coordinates of the <code dir="auto">id</code> line to a new <code dir="auto">x</code> value,
which can represent a bar index or time value depending on the
line’s <code dir="auto">xloc</code> property.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_y1">line.set_y1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_y2">line.set_y2()</a>
set one of the y-coordinates of the <code dir="auto">id</code> line to a new <code dir="auto">y</code> value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xy1">line.set_xy1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xy2">line.set_xy2()</a>
update one of the <code dir="auto">id</code> line’s points with new <code dir="auto">x</code> and <code dir="auto">y</code> values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_xloc">line.set_xloc()</a>
sets the <code dir="auto">xloc</code> of the <code dir="auto">id</code> line and updates both of its
x-coordinates with new <code dir="auto">x1</code> and <code dir="auto">x2</code> values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_extend">line.set_extend()</a>
sets the <code dir="auto">extend</code> property of the <code dir="auto">id</code> line.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color">line.set_color()</a>
updates the <code dir="auto">id</code> line’s <code dir="auto">color</code> value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_style">line.set_style()</a>
changes the <code dir="auto">style</code> of the <code dir="auto">id</code> line.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_width">line.set_width()</a>
sets the <code dir="auto">width</code> of the <code dir="auto">id</code> line.</li>
</ul>
<p>All setter functions directly modify the <code dir="auto">id</code> line passed into the call
and do not return any value. Each setter function accepts “series”
arguments, as a script can change a line’s properties throughout its
execution.</p>
<p>The following example draws lines connecting the opening price of a
<code dir="auto">timeframe</code> to its closing price. The script uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to declare the <code dir="auto">periodLine</code> and the variables that reference
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
values (<code dir="auto">openPoint</code> and <code dir="auto">closePoint</code>) only on the <em>first</em> chart bar, and
it assigns new values to these variables over its execution. After
detecting a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">change</a>
on the <code dir="auto">timeframe</code>, it sets the <code dir="auto">color</code> of the existing <code dir="auto">periodLine</code>
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color">line.set_color()</a>,
creates new values for the <code dir="auto">openPoint</code> and <code dir="auto">closePoint</code> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a>,
then assigns a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">new
line</a>
using those points to the <code dir="auto">periodLine</code>.</p>
<p>On other bars where the <code dir="auto">periodLine</code> value is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, the
script assigns a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
to the <code dir="auto">closePoint</code>, then uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_second_point">line.set_second_point()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_color">line.set_color()</a>
as <a href="/pine-script-docs/v5/language/methods/">methods</a> to update the
line’s properties:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="604" loading="lazy" src="images/ddbcdcc62922d1837ca782ee989030d1.webp" width="1334"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Modifying lines demo", overlay = true)

//@variable The size of each period.
string timeframe = input.timeframe("D", "Timeframe")

//@variable A line connecting the period's opening and closing prices.
var line periodLine = na

//@variable The first point of the line. Contains `time` and `index` information.
var chart.point openPoint = chart.point.now(open)
//@variable The closing point of the line. Contains `time` and `index` information.
var chart.point closePoint = chart.point.now(close)

if timeframe.change(timeframe)
    //@variable The final color of the `periodLine`.
    color finalColor = switch
        closePoint.price &gt; openPoint.price =&gt; color.green
        closePoint.price &lt; openPoint.price =&gt; color.red
        =&gt;                                    color.gray

    // Update the color of the current `periodLine` to the `finalColor`.
    line.set_color(periodLine, finalColor)

    // Assign new points to the `openPoint` and `closePoint`.
    openPoint  := chart.point.now(open)
    closePoint := chart.point.now(close)
    // Assign a new line to the `periodLine`. Uses `time` fields from the `openPoint` and `closePoint` as x-coordinates.
    periodLine := line.new(openPoint, closePoint, xloc.bar_time, style = line.style_arrow_right, width = 3)

else if not na(periodLine)
    // Assign a new point to the `closePoint`.
    closePoint := chart.point.now(close)

    //@variable The color of the developing `periodLine`.
    color developingColor = switch
        closePoint.price &gt; openPoint.price =&gt; color.aqua
        closePoint.price &lt; openPoint.price =&gt; color.fuchsia
        =&gt;                                    color.gray

    // Update the coordinates of the line's second point using the new `closePoint`.
    // It uses the `time` field from the point for its new x-coordinate.
    periodLine.set_second_point(closePoint)
    // Update the color of the line using the `developingColor`.
    periodLine.set_color(developingColor)</code></div>
<p>Note that:</p>
<ul>
<li>Each line drawing in this example uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_arrow_right">line.style_arrow_right</a>
style. See the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#line-styles">Line styles</a> section below for an overview of all available style
settings.</li>
</ul>
<h3 class="md-heading" id="line-styles"><a href="#line-styles">Line styles<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users can control the style of their scripts’ line drawings by passing
one of the following variables as the <code dir="auto">style</code> argument in their
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_style">line.set_style()</a>
function calls:</p>
<table><thead><tr><th>Argument</th><th>Line</th></tr></thead><tbody><tr><td><code dir="auto">line.style_solid</code></td><td><div class="image-container"><img alt="line_style_solid" decoding="async" height="652" loading="lazy" src="images/5637a1ccfc9debce2f153212ff79d8ec.webp" width="744"/></div></td></tr><tr><td><code dir="auto">line.style_dotted</code></td><td><div class="image-container"><img alt="line_style_dotted" decoding="async" height="652" loading="lazy" src="images/5a7b381110dbe170d4598d982beb6823.webp" width="744"/></div></td></tr><tr><td><code dir="auto">line.style_dashed</code></td><td><div class="image-container"><img alt="line_style_dashed" decoding="async" height="652" loading="lazy" src="images/1e07a119a82b390948d7f4183e5f43dd.webp" width="744"/></div></td></tr><tr><td><code dir="auto">line.style_arrow_left</code></td><td><div class="image-container"><img alt="line_style_arrow_left" decoding="async" height="652" loading="lazy" src="images/92fcd126f1e461f2d180894d060068e6.webp" width="744"/></div></td></tr><tr><td><code dir="auto">line.style_arrow_right</code></td><td><div class="image-container"><img alt="line_style_arrow_right" decoding="async" height="652" loading="lazy" src="images/1f7eacfb5f8cb0de3d50f16171357762.webp" width="744"/></div></td></tr><tr><td><code dir="auto">line.style_arrow_both</code></td><td><div class="image-container"><img alt="line_style_arrow_both" decoding="async" height="652" loading="lazy" src="images/6ead7e2621aed591477a7e229dfd8906.webp" width="744"/></div></td></tr></tbody></table>
<p>Note that:</p>
<ul>
<li><em>Polylines</em> can also use any of these variables as their
<code dir="auto">line_style</code> value. See the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#creating-polylines">Creating polylines</a> section of this page.</li>
</ul>
<h3 class="md-heading" id="reading-line-values"><a href="#reading-line-values">Reading line values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">line.*</code> namespace includes <em>getter</em> functions, which allow a script
to retrieve values from a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
object for further use:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x1">line.get_x1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x2">line.get_x2()</a>
respectively get the first and second x-coordinate from the <code dir="auto">id</code>
line. Whether the value returned represents a bar index or time
value depends on the line’s <code dir="auto">xloc</code> property.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y1">line.get_y1()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y2">line.get_y2()</a>
respectively get the <code dir="auto">id</code> line’s first and second y-coordinate.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price">line.get_price()</a>
retrieves the price (y-coordinate) from a line <code dir="auto">id</code> at a specified
<code dir="auto">x</code> value, including at bar indices outside the line’s start and
end points. This function is only compatible with lines that use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
as the <code dir="auto">xloc</code> value.</li>
</ul>
<p>The script below draws a new line upon the onset of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rising">rising</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.falling">falling</a>
price pattern forming over <code dir="auto">length</code> bars. It uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to declare the <code dir="auto">directionLine</code> variable on the first chart bar.
The ID assigned to the <code dir="auto">directionLine</code> persists over subsequent bars
until the <code dir="auto">newDirection</code> condition occurs, in which case the script
assigns a new line to the variable.</p>
<p>On every bar, the script calls the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y2">line.get_y2()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_y1">line.get_y1()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x2">line.get_x2()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_x1">line.get_x1()</a>
getters as <a href="/pine-script-docs/v5/language/methods/">methods</a> to
retrieve values from the current <code dir="auto">directionLine</code> and calculate its
<code dir="auto">slope</code>, which it uses to determine the color of each drawing and plot.
It retrieves extended values of the <code dir="auto">directionLine</code> from <em>beyond</em> its
second point using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price">line.get_price()</a>
and <a href="/pine-script-docs/v5/concepts/plots/">plots</a> them on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/7cf61d9c8ceb0d1ed330acbe72d4f7e3.webp" width="1276"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reading line values demo", overlay = true)

//@variable The number of bars for rising and falling calculations.
int length = input.int(2, "Length", 2)

//@variable A line that's drawn whenever `hlc3` starts rising or falling over `length` bars.
var line directionLine = na

//@variable Is `true` when `hlc3` is rising over `length` bars, `false` otherwise.
bool rising = ta.rising(hlc3, length)
//@variable Is `true` when `hlc3` is falling over `length` bars, `false` otherwise.
bool falling = ta.falling(hlc3, length)
//@variable Is `true` when a rising or falling pattern begins, `false` otherwise.
bool newDirection = (rising and not rising[1]) or (falling and not falling[1])

// Update the `directionLine` when `newDirection` is `true`. The line uses the default `xloc.bar_index`.
if newDirection
    directionLine := line.new(bar_index - length, hlc3[length], bar_index, hlc3, width = 3)

//@variable The slope of the `directionLine`.
float slope = (directionLine.get_y2() - directionLine.get_y1()) / (directionLine.get_x2() - directionLine.get_x1())
//@variable The value extrapolated from the `directionLine` at the `bar_index`.
float lineValue = line.get_price(directionLine, bar_index)

//@variable Is `color.green` when the `slope` is positive, `color.red` otherwise.
color slopeColor = slope &gt; 0 ? color.green : color.red

// Update the color of the `directionLine`.
directionLine.set_color(slopeColor)
// Plot the `lineValue`.
plot(lineValue, "Extrapolated value", slopeColor, 3, plot.style_circles)</code></div>
<p>Note that:</p>
<ul>
<li>This example calls the second overload of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
function, which uses <code dir="auto">x1</code>, <code dir="auto">y1</code>, <code dir="auto">x2</code>, and <code dir="auto">y2</code> parameters to
define the start and end points of the line. The <code dir="auto">x1</code> value is
<code dir="auto">length</code> bars behind the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>,
and the <code dir="auto">y1</code> value is the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>
value at that index. The <code dir="auto">x2</code> and <code dir="auto">y2</code> in the function call use
the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>
values.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.get_price">line.get_price()</a>
function call treats the <code dir="auto">directionLine</code> as though it extends
infinitely, regardless of its <code dir="auto">extend</code> property.</li>
<li>The script only displays approximately the last 50 lines on the
chart, but the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a>
of extrapolated values spans throughout the chart’s history.</li>
</ul>
<h3 class="md-heading" id="cloning-lines"><a href="#cloning-lines">Cloning lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can clone a line <code dir="auto">id</code> and all its properties with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy">line.copy()</a>
function. Any changes to the copied line instance do not affect the
original.</p>
<p>For example, this script creates a horizontal line at the the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
price once every <code dir="auto">length</code> bars, which it assigns to a <code dir="auto">mainLine</code>
variable. On all other bars, it creates a <code dir="auto">copiedLine</code> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.copy">line.copy()</a>
and calls <code dir="auto">line.set_*()</code> functions to
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#modifying-lines">modify</a> its properties. As we see below, altering the <code dir="auto">copiedLine</code>
does not affect the <code dir="auto">mainLine</code> in any way:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="584" loading="lazy" src="images/361a20e7fd5e009b5fbf6957eaf7a549.webp" width="1330"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Cloning lines demo", overlay = true, max_lines_count = 500)

//@variable The number of bars between each new mainLine assignment.
int length = input.int(20, "Length", 2, 500)

//@variable The first `chart.point` used by the `mainLine`. Contains `index` and `time` information.
firstPoint = chart.point.now(open)
//@variable The second `chart.point` used by the `mainLine`. Does not contain `time` information.
secondPoint = chart.point.from_index(bar_index + length, open)

//@variable A horizontal line drawn at the `open` price once every `length` bars.
var line mainLine = na

if bar_index % length == 0
    // Assign a new line to the `mainLine` that connects the `firstPoint` to the `secondPoint`.
    // This line uses the `index` fields from both points as x-coordinates.
    mainLine := line.new(firstPoint, secondPoint, color = color.purple, width = 2)

//@variable A copy of the `mainLine`. Changes to this line do not affect the original.
line copiedLine = line.copy(mainLine)

// Update the color, style, and second point of the `copiedLine`.
line.set_color(copiedLine, color.orange)
line.set_style(copiedLine, line.style_dotted)
line.set_second_point(copiedLine, chart.point.now(close))</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">index</code> field of the <code dir="auto">secondPoint</code> is <code dir="auto">length</code> bars beyond
the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.
Since the maximum x-coordinate allowed with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
is <code dir="auto">bar_index + 500</code>, we’ve set the <code dir="auto">maxval</code> of the <code dir="auto">length</code>
input to 500.</li>
</ul>
<h3 class="md-heading" id="deleting-lines"><a href="#deleting-lines">Deleting lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To delete a line <code dir="auto">id</code> drawn by a script, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>
function. This function removes the line instance from the script and
its drawing on the chart.</p>
<p>Deleting line instances is often handy when one wants to only keep a
specific number of lines on the chart at any given time or conditionally
remove drawings as a chart progresses.</p>
<p>For example, this script draws a horizontal line with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right">extend.right</a>
property whenever an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi">RSI</a>
crosses its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema">EMA</a>.</p>
<p>The script stores all line IDs in a <code dir="auto">lines</code> array that it
<a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">uses as a queue</a> to only display the last <code dir="auto">numberOfLines</code> on the chart. When
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
exceeds the specified <code dir="auto">numberOfLines</code>, the script removes the array’s
oldest line ID using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
and deletes it with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/9e9b4e4475c655d3147e8fe1c630ad84.webp" width="1280"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

//@variable The maximum number of lines allowed on the chart.
const int MAX_LINES_COUNT = 500

indicator("Deleting lines demo", "RSI cross levels", max_lines_count = MAX_LINES_COUNT)

//@variable The length of the RSI.
int rsiLength = input.int(14, "RSI length", 2)
//@variable The length of the RSI's EMA.
int emaLength = input.int(28, "RSI average length", 2)
//@variable The maximum number of lines to keep on the chart.
int numberOfLines = input.int(20, "Lines on the chart", 0, MAX_LINES_COUNT)

//@variable An array containing the IDs of lines on the chart.
var array&lt;line&gt; lines = array.new&lt;line&gt;()

//@variable An `rsiLength` RSI of `close`.
float rsi = ta.rsi(close, rsiLength)
//@variable A `maLength` EMA of the `rsi`.
float rsiMA = ta.ema(rsi, emaLength)

if ta.cross(rsi, rsiMA)
    //@variable The color of the horizontal line.
    color lineColor = rsi &gt; rsiMA ? color.green : color.red
    // Draw a new horizontal line. Uses the default `xloc.bar_index`.
    newLine = line.new(bar_index, rsiMA, bar_index + 1, rsiMA, extend = extend.right, color = lineColor, width = 2)
    // Push the `newLine` into the `lines` array.
    lines.push(newLine)
    // Delete the oldest line when the size of the array exceeds the specified `numberOfLines`.
    if array.size(lines) &gt; numberOfLines
        line.delete(lines.shift())

// Plot the `rsi` and `rsiMA`.
plot(rsi, "RSI", color.new(color.blue, 40))
plot(rsiMA, "EMA of RSI", color.new(color.gray, 30))</code></div>
<p>Note that:</p>
<ul>
<li>We declared a <code dir="auto">MAX_LINES_COUNT</code> variable with the “const int”
<em>qualified type</em>, which the script uses as the <code dir="auto">max_lines_count</code>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function and the <code dir="auto">maxval</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
assigned to the <code dir="auto">numberOfLines</code> variable.</li>
<li>This example uses the second overload of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
function, which specifies <code dir="auto">x1</code>, <code dir="auto">y1</code>, <code dir="auto">x2</code>, and <code dir="auto">y2</code> coordinates
independently.</li>
</ul>
<h3 class="md-heading" id="filling-the-space-between-lines"><a href="#filling-the-space-between-lines">Filling the space between lines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can <em>fill</em> the space between two
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
drawings by creating a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
object that references them with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>
function. Linefills automatically determine their fill boundaries using
the properties from the <code dir="auto">line1</code> and <code dir="auto">line2</code> IDs that they reference.</p>
<p>For example, this script calculates a simple linear regression channel.
On the first chart bar, the script declares the <code dir="auto">basisLine</code>,
<code dir="auto">upperLine</code>, and <code dir="auto">lowerLine</code> variables to reference the channel’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
IDs, then it makes two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_linefill.new">linefill.new()</a>
calls to create
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
objects that fill the upper and lower portions of the channel. The first
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
fills the space between the <code dir="auto">basisLine</code> and the <code dir="auto">upperLine</code>, and the
second fills the space between the <code dir="auto">basisLine</code> and <code dir="auto">lowerLine</code>.</p>
<p>The script updates the coordinates of the lines across subsequent bars.
However, notice that the script never needs to update the linefills
declared on the first bar. They automatically update their fill regions
based on the coordinates of their assigned lines:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/792117097a0c3d610a367e53cc1ace01.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Filling the space between lines demo", "Simple linreg channel", true)

//@variable The number of bars in the linear regression calculation.
int lengthInput = input.int(100)

//@variable The basis line of the regression channel.
var line basisLine = line.new(na, na, na, na, extend = extend.right, color = chart.fg_color, width = 2)
//@variable The channel's upper line.
var line upperLine = line.new(na, na, na, na, extend = extend.right, color = color.teal, width = 2)
//@variable The channel's lower line.
var line lowerLine = line.new(na, na, na, na, extend = extend.right, color = color.maroon, width = 2)

//@variable A linefill instance that fills the space between the `basisLine` and `upperLine`.
var linefill upperFill = linefill.new(basisLine, upperLine, color.new(color.teal, 80))
//@variable A linefill instance that fills the space between the `basisLine` and `lowerLine`.
var linefill lowerFill = linefill.new(basisLine, lowerLine, color.new(color.maroon, 80))

// Update the `basisLine` coordinates with current linear regression values.
basisLine.set_xy1(bar_index + 1 - lengthInput, ta.linreg(close, lengthInput, lengthInput - 1))
basisLine.set_xy2(bar_index, ta.linreg(close, lengthInput, 0))

//@variable The channel's standard deviation.
float stDev = 0.0
for i = 0 to lengthInput - 1
    stDev += math.pow(close[i] - line.get_price(basisLine, bar_index - i), 2)
stDev := math.sqrt(stDev / lengthInput) * 2.0

// Update the `upperLine` and `lowerLine` using the values from the `basisLine` and the `stDev`.
upperLine.set_xy1(basisLine.get_x1(), basisLine.get_y1() + stDev)
upperLine.set_xy2(basisLine.get_x2(), basisLine.get_y2() + stDev)
lowerLine.set_xy1(basisLine.get_x1(), basisLine.get_y1() - stDev)
lowerLine.set_xy2(basisLine.get_x2(), basisLine.get_y2() - stDev)</code></div>
<p>To learn more about the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_linefill">linefill</a>
type, see <a href="/pine-script-docs/v5/concepts/fills/#line-fills">this</a>
section of the <a href="/pine-script-docs/v5/concepts/fills/">Fills</a> page.</p>
<h2 class="md-heading" id="boxes"><a href="#boxes">Boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The built-ins in the <code dir="auto">box.*</code> namespace create and manage
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
objects:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
function creates a new box.</li>
<li>The <code dir="auto">box.set_*()</code> functions modify box properties.</li>
<li>The <code dir="auto">box.get_*()</code> functions retrieve values from a box instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy">box.copy()</a>
function clones a box instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete">box.delete()</a>
function deletes a box instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_box.all">box.all</a>
variable references a read-only
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing the IDs of all boxes displayed by the script. The
array’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
depends on the <code dir="auto">max_boxes_count</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement and the number of boxes the script has drawn.</li>
</ul>
<p>As with <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>,
users can call <code dir="auto">box.set_*()</code>, <code dir="auto">box.get_*()</code>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy">box.copy()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete">box.delete()</a>
built-ins as functions or <a href="/pine-script-docs/v5/language/methods/">methods</a>.</p>
<h3 class="md-heading" id="creating-boxes"><a href="#creating-boxes">Creating boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
function creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
object to display on the chart. It has the following signatures:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">box.new(top_left, bottom_right, border_color, border_width, border_style, extend, xloc, bgcolor, text, text_size, text_color, text_halign, text_valign, text_wrap, text_font_family, force_overlay) → series box</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">box.new(left, top, right, bottom, border_color, border_width, border_style, extend, xloc, bgcolor, text, text_size, text_color, text_halign, text_valign, text_wrap, text_font_family, force_overlay) → series box</span></div></div></code></pre></figure></div>
<p>This function’s first overload includes the <code dir="auto">top_left</code> and
<code dir="auto">bottom_right</code> parameters, which accept
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects representing the top-left and bottom-right corners of the box,
respectively. The function copies the information from these
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> to set the coordinates of the box’s corners. Whether it
uses the <code dir="auto">index</code> or <code dir="auto">time</code> fields of the <code dir="auto">top_left</code> and <code dir="auto">bottom_right</code>
points as x-coordinates depends on the function’s <code dir="auto">xloc</code> value.</p>
<p>The second overload specifies <code dir="auto">left</code>, <code dir="auto">top</code>, <code dir="auto">right</code>, and <code dir="auto">bottom</code> edges
of the box. The <code dir="auto">left</code> and <code dir="auto">right</code> parameters accept
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
values specifying the box’s left and right x-coordinates, which can be
bar index or time values depending on the <code dir="auto">xloc</code> value in the function
call. The <code dir="auto">top</code> and <code dir="auto">bottom</code> parameters accept
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_float">float</a>
values representing the box’s top and bottom y-coordinates.</p>
<p>The function’s additional parameters are identical in both overloads:</p>
<p><code dir="auto">border_color</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the color of all four of the box’s borders. The default
is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue">color.blue</a>.</p>
<p><code dir="auto">border_width</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the width of the borders, in pixels. Its default value is
1.</p>
<p><code dir="auto">border_style</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the style of the borders, which can be any of the options
in the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#box-styles">Box styles</a> section of this page.</p>
<p><code dir="auto">extend</code></p>
<p class="spacer-wrapper"><spacer/>Determines whether the box’s borders extend infinitely beyond the
left or right x-coordinates. It accepts one of the following values:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.left">extend.left</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.right">extend.right</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.both">extend.both</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_extend.none">extend.none</a>
(default).</p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer/>Determines whether the left and right edges of the box use bar index
or time values as x-coordinates. The default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>.</p>
<p class="spacer-wrapper"><spacer/>In the first overload, an <code dir="auto">xloc</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
means that the function will use the <code dir="auto">index</code> fields of the
<code dir="auto">top_left</code> and <code dir="auto">bottom_right</code> chart points, and an <code dir="auto">xloc</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>
means that it will use their <code dir="auto">time</code> fields.</p>
<p class="spacer-wrapper"><spacer/>In the second overload, using an <code dir="auto">xloc</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
means the function treats the <code dir="auto">left</code> and <code dir="auto">right</code> values as bar
indices, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>
means it will treat them as timestamps.</p>
<p class="spacer-wrapper"><spacer/>When the specified x-coordinates represent <em>bar index</em> values, it’s
important to note that the minimum x-coordinate allowed is
<code dir="auto">bar_index - 9999</code>. For larger offsets, one can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>.</p>
<p><code dir="auto">bgcolor</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the background color of the space inside the box. The
default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue">color.blue</a>.</p>
<p><code dir="auto">text</code></p>
<p class="spacer-wrapper"><spacer/>The text to display inside the box. By default, its value is an
empty string.</p>
<p><code dir="auto">text_size</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the size of the text within the box. It accepts one of the
following values:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.tiny">size.tiny</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.small">size.small</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.normal">size.normal</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.large">size.large</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.huge">size.huge</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_size.auto">size.auto</a>
(default).</p>
<p><code dir="auto">text_color</code></p>
<p class="spacer-wrapper"><spacer/>Controls the color of the text. Its default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.black">color.black</a>.</p>
<p><code dir="auto">text_halign</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the horizontal alignment of the text within the box’s
boundaries. It accepts one of the following:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_left">text.align_left</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_right">text.align_right</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_center">text.align_center</a>
(default).</p>
<p><code dir="auto">text_valign</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the vertical alignment of the text within the box’s
boundaries. It accepts one of the following:
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_top">text.align_top</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_bottom">text.align_bottom</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.align_center">text.align_center</a>
(default).</p>
<p><code dir="auto">text_wrap</code></p>
<p class="spacer-wrapper"><spacer/>Determines whether the box will wrap the text within it. If its
value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_auto">text.wrap_auto</a>,
the box wraps the text to ensure it does not span past its vertical
borders. It also clips the wrapped text when it extends past the
bottom. If the value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_none">text.wrap_none</a>,
the box displays the text on a single line that can extend beyond
its borders. The default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_text.wrap_none">text.wrap_none</a>.</p>
<p><code dir="auto">text_font_family</code></p>
<p class="spacer-wrapper"><spacer/>Defines the font family of the box’s text. Using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_default">font.family_default</a>
displays the box’s text with the system’s default font. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_monospace">font.family_monospace</a>
displays the text in a monospace format. The default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_font.family_default">font.family_default</a>.</p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer/>If <code dir="auto">true</code>, the drawing will display on the main chart pane, even when the script occupies a separate pane. Optional. The default is <code dir="auto">false</code>.</p>
<p>Let’s write a simple script to display boxes on a chart. The example
below draws a box projecting each bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values from the horizontal center of the current bar to the center of
the next available bar.</p>
<p>On each bar, the script creates <code dir="auto">topLeft</code> and <code dir="auto">bottomRight</code> points via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_index">chart.point_from_index()</a>,
then calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
to construct a new box and display it on the chart. It also highlights
the background on the unconfirmed chart bar using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
to indicate that it redraws that box until the bar’s last update:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="608" loading="lazy" src="images/44c61879bda9f4885fbd44dc0649195e.webp" width="1334"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Creating boxes demo", overlay = true)

//@variable The `chart.point` for the top-left corner of the box. Contains `index` and `time` information.
topLeft = chart.point.now(high)
//@variable The `chart.point` for the bottom-right corner of the box. Does not contain `time` information.
bottomRight = chart.point.from_index(bar_index + 1, low)

// Draw a box using the `topLeft` and `bottomRight` corner points. Uses the `index` fields as x-coordinates.
box.new(topLeft, bottomRight, color.purple, 2, bgcolor = color.new(color.gray, 70))

// Color the background on the unconfirmed bar.
bgcolor(barstate.isconfirmed ? na : color.new(color.orange, 70), title = "Unconfirmed bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">bottomRight</code> point’s <code dir="auto">index</code> field is one bar greater than
the <code dir="auto">index</code> in the <code dir="auto">topLeft</code>. If the x-coordinates of the
corners were equal, the script would draw a vertical line at the
horizontal center of each bar, resembling the example in this
page’s
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#creating-lines">Creating lines</a> section.</li>
<li>Similar to <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, if the <code dir="auto">topLeft</code> and <code dir="auto">bottomRight</code> contained
identical coordinates, the box wouldn’t display on the chart
since there would be no space between them to draw. However, its
ID would still exist.</li>
<li>This script only displays approximately the last 50 boxes on the
chart, as we have not specified a <code dir="auto">max_boxes_count</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call.</li>
</ul>
<h3 class="md-heading" id="modifying-boxes"><a href="#modifying-boxes">Modifying boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Multiple <em>setter</em> functions exist in the <code dir="auto">box.*</code> namespace, allowing
scripts to modify the properties of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
objects:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top_left_point">box.set_top_left_point()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom_right_point">box.set_bottom_right_point()</a>
respectively update the top-left and bottom-right coordinates of the
<code dir="auto">id</code> box using information from the specified <code dir="auto">point</code>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_left">box.set_left()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_right">box.set_right()</a>
set the left or right x-coordinate of the <code dir="auto">id</code> box to a new
<code dir="auto">left/right</code> value, which can be a bar index or time value depending
on the box’s <code dir="auto">xloc</code> property.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top">box.set_top()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom">box.set_bottom()</a>
set the top or bottom y-coordinate of the <code dir="auto">id</code> box to a new
<code dir="auto">top/bottom</code> value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_lefttop">box.set_lefttop()</a>
sets the <code dir="auto">left</code> and <code dir="auto">top</code> coordinates of the <code dir="auto">id</code> box, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_rightbottom">box.set_rightbottom()</a>
sets its <code dir="auto">right</code> and <code dir="auto">bottom</code> coordinates.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_color">box.set_border_color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_width">box.set_border_width()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_style">box.set_border_style()</a>
respectively update the <code dir="auto">color</code>, <code dir="auto">width</code>, and <code dir="auto">style</code> of the <code dir="auto">id</code>
box’s border.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_extend">box.set_extend()</a>
sets the horizontal <code dir="auto">extend</code> property of the <code dir="auto">id</code> box.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bgcolor">box.set_bgcolor()</a>
sets the color of the space inside the <code dir="auto">id</code> box to a new <code dir="auto">color</code>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text">box.set_text()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_size">box.set_text_size()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_color">box.set_text_color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_halign">box.set_text_halign()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_valign">box.set_text_valign()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_wrap">box.set_text_wrap()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_text_font_family">box.set_text_font_family()</a>
update the <code dir="auto">id</code> box’s text-related properties.</li>
</ul>
<p>As with setter functions in the <code dir="auto">line.*</code> namespace, all box setters
modify the <code dir="auto">id</code> box directly without returning a value, and each setter
function accepts “series” arguments.</p>
<p>Note that, unlike <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, the <code dir="auto">box.*</code> namespace does not contain a setter function to
modify a box’s <code dir="auto">xloc</code>. Users must
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#creating-boxes">create</a> a new box with the desired <code dir="auto">xloc</code> setting for such cases.</p>
<p>This example uses boxes to visualize the ranges of upward and downward
bars with the highest
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
over a user-defined <code dir="auto">timeframe</code>. When the script detects a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">change</a>
in the <code dir="auto">timeframe</code>, it assigns <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">new
boxes</a>
to its <code dir="auto">upBox</code> and <code dir="auto">downBox</code> variables, resets its <code dir="auto">upVolume</code> and
<code dir="auto">downVolume</code> values, and highlights the chart background.</p>
<p>When an upward or downward bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
exceeds the <code dir="auto">upVolume</code> or <code dir="auto">downVolume</code>, the script updates the
volume-tracking variables and calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_top_left_point">box.set_top_left_point()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_bottom_right_point">box.set_bottom_right_point()</a>
to update the <code dir="auto">upBox</code> or <code dir="auto">downBox</code> coordinates. The setters use the
information from the
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> created with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.from_time">chart.point.from_time()</a>
to project that bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values from the current time to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">closing
time</a>
of the <code dir="auto">timeframe</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="604" loading="lazy" src="images/545f03f5c0a54e92c331f7e5c7ff905a.webp" width="1330"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Modifying boxes demo", "High volume boxes", true, max_boxes_count = 100)

//@variable The timeframe of the calculation.
string timeframe = input.timeframe("D", "Timeframe")

//@variable A box projecting the range of the upward bar with the highest `volume` over the `timeframe`.
var box upBox = na
//@variable A box projecting the range of the downward bar with the lowest `volume` over the `timeframe`.
var box downBox = na
//@variable The highest volume of upward bars over the `timeframe`.
var float upVolume = na
//@variable The highest volume of downward bars over the `timeframe`.
var float downVolume = na

// Color variables.
var color upBorder   = color.teal
var color upFill     = color.new(color.teal, 90)
var color downBorder = color.maroon
var color downFill   = color.new(color.maroon, 90)

//@variable The closing time of the `timeframe`.
int closeTime = time_close(timeframe)
//@variable Is `true` when a new bar starts on the `timeframe`.
bool changeTF = timeframe.change(timeframe)

//@variable The `chart.point` for the top-left corner of the boxes. Contains `index` and `time` information.
topLeft = chart.point.now(high)
//@variable The `chart.point` for the bottom-right corner of the boxes. Does not contain `index` information.
bottomRight = chart.point.from_time(closeTime, low)

if changeTF and not na(volume)
    if close &gt; open
        // Update `upVolume` and `downVolume` values.
        upVolume   := volume
        downVolume := 0.0
        // Draw a new `upBox` using `time` and `price` info from the `topLeft` and `bottomRight` points.
        upBox := box.new(topLeft, bottomRight, upBorder, 3, xloc = xloc.bar_time, bgcolor = upFill)
        // Draw a new `downBox` with `na` coordinates.
        downBox := box.new(na, na, na, na, downBorder, 3, xloc = xloc.bar_time, bgcolor = downFill)
    else
        // Update `upVolume` and `downVolume` values.
        upVolume   := 0.0
        downVolume := volume
        // Draw a new `upBox` with `na` coordinates.
        upBox := box.new(na, na, na, na, upBorder, 3, xloc = xloc.bar_time, bgcolor = upFill)
        // Draw a new `downBox` using `time` and `price` info from the `topLeft` and `bottomRight` points.
        downBox := box.new(topLeft, bottomRight, downBorder, 3, xloc = xloc.bar_time, bgcolor = downFill)
// Update the ``upVolume`` and change the ``upBox`` coordinates when volume increases on an upward bar.
else if close &gt; open and volume &gt; upVolume
    upVolume := volume
    box.set_top_left_point(upBox, topLeft)
    box.set_bottom_right_point(upBox, bottomRight)
// Update the ``downVolume`` and change the ``downBox`` coordinates when volume increases on a downward bar.
else if close &lt;= open and volume &gt; downVolume
    downVolume := volume
    box.set_top_left_point(downBox, topLeft)
    box.set_bottom_right_point(downBox, bottomRight)

// Highlight the background when a new `timeframe` bar starts.
bgcolor(changeTF ? color.new(color.orange, 70) : na, title = "Timeframe change highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call contains <code dir="auto">max_boxes_count = 100</code>, meaning the
script will preserve the last 100 boxes on the chart.</li>
<li>We utilized <em>both overloads</em> of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
in this example. On the first bar of the <code dir="auto">timeframe</code>, the script
calls the first overload for the <code dir="auto">upBox</code> when the bar is rising,
and it calls that overload for the <code dir="auto">downBox</code> when the bar is
falling. It uses the second overload to assign a new box with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values to the other box variable on that bar.</li>
</ul>
<h3 class="md-heading" id="box-styles"><a href="#box-styles">Box styles<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users can include one of the following <code dir="auto">line.style_*</code> variables in their
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_border_style">box.set_border_style()</a>
function calls to set the border styles of boxes drawn by their scripts:</p>
<hr/>
<table><thead><tr><th>Argument</th><th>Box</th></tr></thead><tbody><tr><td><code dir="auto">line.style_solid</code></td><td><div class="image-container"><img alt="box_style_solid" decoding="async" height="88" loading="lazy" src="images/ffe0727b9d63b4a00fa20d718e87b495.webp" width="125"/></div></td></tr><tr><td><code dir="auto">line.style_dotted</code></td><td><div class="image-container"><img alt="box_style_dotted" decoding="async" height="88" loading="lazy" src="images/a1c6af0e62d15c91d140ef9314bb0c70.webp" width="125"/></div></td></tr><tr><td><code dir="auto">line.style_dashed</code></td><td><div class="image-container"><img alt="box_style_dashed" decoding="async" height="88" loading="lazy" src="images/719f7cf760925299c416858f8725f964.webp" width="125"/></div></td></tr></tbody></table>
<h3 class="md-heading" id="reading-box-values"><a href="#reading-box-values">Reading box values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">box.*</code> namespace features <em>getter</em> functions that allow scripts to
retrieve coordinate values from a box instance:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_left">box.get_left()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_right">box.get_right()</a>
respectively get the x-coordinates of the left and right edges of
the <code dir="auto">id</code> box. Whether the value returned represents a bar index or
time value depends on the box’s <code dir="auto">xloc</code> property.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top">box.get_top()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_bottom">box.get_bottom()</a>
respectively get the top and bottom y-coordinates of the <code dir="auto">id</code> box.</li>
</ul>
<p>The example below draws boxes to visualize hypothetical price ranges
over a period of <code dir="auto">length</code> bars. At the start of each new period, it uses
the average candle range multiplied by the <code dir="auto">scaleFactor</code> input to
calculate the corner points of a box centered at the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>
price with an <code dir="auto">initialRange</code> height. After drawing the first box, it
creates <code dir="auto">numberOfBoxes - 1</code> new boxes inside a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop.</p>
<p>Within each loop iteration, the script gets the <code dir="auto">lastBoxDrawn</code> by
retrieving the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last">last</a>
element from the read-only
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_box.all">box.all</a>
array, then calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top">box.get_top()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_bottom">box.get_bottom()</a>
to get its y-coordinates. It uses these values to calculate the
coordinates for a new box that’s <code dir="auto">scaleFactor</code> times taller than the
previous:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="608" loading="lazy" src="images/f9299ad887645471497177cfe816311d.webp" width="1332"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reading box values demo", "Nested boxes", overlay = true, max_boxes_count = 500)

//@variable The number of bars in the range calculation.
int length = input.int(10, "Length", 2, 500)
//@variable The number of nested boxes drawn on each period.
int numberOfBoxes = input.int(5, "Nested box count", 1)
//@variable The scale factor applied to each box.
float scaleFactor = input.float(1.6, "Scale factor", 1)

//@variable The initial box range.
float initialRange = scaleFactor * ta.sma(high - low, length)

if bar_index % length == 0
    //@variable The top-left `chart.point` for the initial box. Does not contain `time` information.
    topLeft = chart.point.from_index(bar_index, hl2 + initialRange / 2)
    //@variable The bottom-right `chart.point` for the initial box. Does not contain `time` information.
    bottomRight = chart.point.from_index(bar_index + length, hl2 - initialRange / 2)

    // Calculate border and fill colors of the boxes.
    borderColor = color.rgb(math.random(100, 255), math.random(0, 100), math.random(100, 255))
    bgColor = color.new(borderColor, math.max(100 * (1 - 1/numberOfBoxes), 90))

    // Draw a new box using the `topLeft` and `bottomRight` points. Uses their `index` fields as x-coordinates.
    box.new(topLeft, bottomRight, borderColor, 2, bgcolor = bgColor)

    if numberOfBoxes &gt; 1
        // Loop to create additional boxes.
        for i = 1 to numberOfBoxes - 1
            //@variable The last box drawn by the script.
            box lastBoxDrawn = box.all.last()

            //@variable The top price of the last box.
            float top = box.get_top(lastBoxDrawn)
            //@variable The bottom price of the last box.
            float bottom = box.get_bottom(lastBoxDrawn)

            //@variable The scaled range of the new box.
            float newRange = scaleFactor * (top - bottom) * 0.5

            // Update the `price` fields of the `topLeft` and `bottomRight` points.
            // This does not affect the coordinates of previous boxes.
            topLeft.price     := hl2 + newRange
            bottomRight.price := hl2 - newRange

            // Draw a new box using the updated `topLeft` and `bottomRight` points.
            box.new(topLeft, bottomRight, borderColor, 2, bgcolor = bgColor)</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call uses <code dir="auto">max_boxes_count = 500</code>, meaning the script
can display up to 500 boxes on the chart.</li>
<li>Each drawing has a <code dir="auto">right</code> index <code dir="auto">length</code> bars beyond the <code dir="auto">left</code>
index. Since the x-coordinates of these drawings can be up to
500 bars into the future, we’ve set the <code dir="auto">maxval</code> of the
<code dir="auto">length</code> input to 500.</li>
<li>On each new period, the script uses randomized
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.rgb">color.rgb()</a>
values for the <code dir="auto">border_color</code> and <code dir="auto">bgcolor</code> of the boxes.</li>
<li>Each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
call copies the coordinates from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects assigned to the <code dir="auto">topLeft</code> and <code dir="auto">bottomRight</code> variables,
which is why the script can modify their <code dir="auto">price</code> fields on each
loop iteration without affecting the other boxes.</li>
</ul>
<h3 class="md-heading" id="cloning-boxes"><a href="#cloning-boxes">Cloning boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To clone a specific box <code dir="auto">id</code>, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy">box.copy()</a>.
This function copies the box and its properties. Any changes to the
copied box do not affect the original.</p>
<p>For example, this script declares an <code dir="auto">originalBox</code> variable on the first
bar and assigns a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">new
box</a>
to it once every <code dir="auto">length</code> bars. On other bars, it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.copy">box.copy()</a>
to create a <code dir="auto">copiedBox</code> and calls <code dir="auto">box.set_*()</code> functions to
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#modifying-boxes">modify</a> its properties. As shown on the chart below, these changes
do not modify the <code dir="auto">originalBox</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="604" loading="lazy" src="images/db1ecfae698beaaa54322fd710bc0aa5.webp" width="1334"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Cloning boxes demo", overlay = true, max_boxes_count = 500)

//@variable The number of bars between each new mainLine assignment.
int length = input.int(20, "Length", 2)

//@variable The `chart.point` for the top-left of the `originalBox`. Contains `time` and `index` information.
topLeft = chart.point.now(high)
//@variable The `chart.point` for the bottom-right of the `originalBox`. Does not contain `time` information.
bottomRight = chart.point.from_index(bar_index + 1, low)

//@variable A new box with `topLeft` and `bottomRight` corners on every `length` bars.
var box originalBox = na

//@variable Is teal when the bar is rising, maroon when it's falling.
color originalColor = close &gt; open ? color.teal : color.maroon

if bar_index % length == 0
    // Assign a new box using the `topLeft` and `bottomRight` info to the `originalBox`.
    // This box uses the `index` fields from the points as x-coordinates.
    originalBox := box.new(topLeft, bottomRight, originalColor, 2, bgcolor = color.new(originalColor, 60))
else
    //@variable A clone of the `originalBox`.
    box copiedBox = box.copy(originalBox)
    // Modify the `copiedBox`. These changes do not affect the `originalBox`.
    box.set_top(copiedBox, high)
    box.set_bottom_right_point(copiedBox, bottomRight)
    box.set_border_color(copiedBox, color.gray)
    box.set_border_width(copiedBox, 1)
    box.set_bgcolor(copiedBox, na)</code></div>
<h3 class="md-heading" id="deleting-boxes"><a href="#deleting-boxes">Deleting boxes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To delete boxes drawn by a script, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete">box.delete()</a>.
As with <code dir="auto">*.delete()</code> functions in other drawing namespaces, this
function is handy for conditionally removing boxes or maintaining a
specific number of boxes on the chart.</p>
<p>This example displays boxes representing periodic cumulative volume
values. The script
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#creating-boxes">creates</a> a new box ID and stores it in a <code dir="auto">boxes</code> array once every
<code dir="auto">length</code> bars. If the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array’s
size</a>
exceeds the specified <code dir="auto">numberOfBoxes</code>, the script removes the oldest box
from the array using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
and deletes it using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete">box.delete()</a>.</p>
<p>On other bars, it accumulates
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
over each period by
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#modifying-boxes">modifying</a> the <code dir="auto">top</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last">last</a>
box in the <code dir="auto">boxes</code> array. The script then uses
<a href="/pine-script-docs/v5/language/loops/#for-loops">for loops</a> to find the
<code dir="auto">highestTop</code> of all the array’s boxes and set the <code dir="auto">bgcolor</code> of each box
with a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient">gradient
color</a>
based on its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top">box.get_top()</a>
value relative to the <code dir="auto">highestTop</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="608" loading="lazy" src="images/179585ff10f22938735ea80a068a1929.webp" width="1326"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

//@variable The maximum number of boxes to show on the chart.
const int MAX_BOXES_COUNT = 500

indicator("Deleting boxes demo", "Cumulative volume boxes", format = format.volume, max_boxes_count = MAX_BOXES_COUNT)

//@variable The number of bars in each period.
int length = input.int(20, "Length", 1)
//@variable The maximum number of volume boxes in the calculation.
int numberOfBoxes = input.int(10, "Number of boxes", 1, MAX_BOXES_COUNT)

//@variable An array containing the ID of each box displayed by the script.
var boxes = array.new&lt;box&gt;()

if bar_index % length == 0
    // Push a new box into the `boxes` array. The box has the default `xloc.bar_index` property.
    boxes.push(box.new(bar_index, 0, bar_index + 1, 0, #000000, 2, text_color = #000000))
    // Shift the oldest box out of the array and delete it when the array's size exceeds the `numberOfBoxes`.
    if boxes.size() &gt; numberOfBoxes
        box.delete(boxes.shift())

//@variable The last box drawn by the script as of the current chart bar.
box lastBox = boxes.last()
// Add the current bar's volume to the top of the `lastBox` and update the `right` index.
lastBox.set_top(lastBox.get_top() + volume)
lastBox.set_right(bar_index + 1)
// Display the top of the `lastBox` as volume-formatted text.
lastBox.set_text(str.tostring(lastBox.get_top(), format.volume))

//@variable The highest `top` of all boxes in the `boxes` array.
float highestTop = 0.0
for id in boxes
    highestTop := math.max(id.get_top(), highestTop)

// Set the `bgcolor` of each `id` in `boxes` with a gradient based on the ratio of its `top` to the `highestTop`.
for id in boxes
    id.set_bgcolor(color.from_gradient(id.get_top() / highestTop, 0, 1, color.purple, color.orange))</code></div>
<p>Note that:</p>
<ul>
<li>At the top of the code, we’ve declared a <code dir="auto">MAX_BOXES_COUNT</code>
variable with the “const int” <em>qualified type</em>. We use this
value as the <code dir="auto">max_boxes_count</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function and the maximum possible value of the <code dir="auto">numberOfBoxes</code>
input.</li>
<li>This script uses the second overload of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
function, which specifies the box’s <code dir="auto">left</code>, <code dir="auto">top</code>, <code dir="auto">right</code>, and
<code dir="auto">bottom</code> coordinates separately.</li>
<li>We’ve included
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume">format.volume</a>
as the <code dir="auto">format</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
call, which tells the script that the y-axis of the chart pane
represents <em>volume</em> values. Each box also displays its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.get_top">top</a>
value as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume">volume-formatted</a>
text.</li>
</ul>
<h2 class="md-heading" id="polylines"><a href="#polylines">Polylines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ polylines are <strong>advanced</strong> drawings that sequentially
connect the coordinates from an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
instances using straight or <em>curved</em> line segments.</p>
<p>These powerful drawings can connect up to 10,000 points at any available
location on the chart, allowing scripts to draw custom series, polygons,
and other complex geometric formations that are otherwise difficult or
impossible to draw using
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
or <a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
objects.</p>
<p>The <code dir="auto">polyline.*</code> namespace features the following built-ins for creating
and managing
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
objects:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
function creates a new polyline instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete">polyline.delete()</a>
function deletes an existing polyline instance.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_polyline.all">polyline.all</a>
variable references a read-only
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing the IDs of all polylines displayed by the script. The
array’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
depends on the <code dir="auto">max_polylines_count</code> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement and the number of polylines drawn by the
script.</li>
</ul>
<p>Unlike <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>
or <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>,
polylines do not have functions for modification or reading their
properties. To redraw a polyline on the chart, one can <em>delete</em> the
existing instance and <em>create</em> a new polyline with the desired changes.</p>
<h3 class="md-heading" id="creating-polylines"><a href="#creating-polylines">Creating polylines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
function creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
instance to display on the chart. It has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">polyline.new(points, curved, closed, xloc, line_color, fill_color, line_style, line_width, force_overlay) → series polyline</span></div></div></code></pre></figure></div>
<p>The following eight parameters affect the behavior of a polyline
drawing:</p>
<p><code dir="auto">points</code></p>
<p class="spacer-wrapper"><spacer/>Accepts an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects that determine the coordinates of each point in the
polyline. The drawing connects the coordinates from each element in
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
sequentially, starting from the <em>first</em>. Whether the polyline uses
the <code dir="auto">index</code> or <code dir="auto">time</code> field from each
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart point</a> for its x-coordinates depends on the <code dir="auto">xloc</code> value in the
function call.</p>
<p><code dir="auto">curved</code></p>
<p class="spacer-wrapper"><spacer/>Specifies whether the drawing uses curved line segments to connect
each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in the <code dir="auto">points</code> array. The default value is <code dir="auto">false</code>, meaning it uses
straight line segments.</p>
<p><code dir="auto">closed</code></p>
<p class="spacer-wrapper"><spacer/>Controls whether the polyline will connect the last
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in the <code dir="auto">points</code> array to the first, forming a <em>closed polyline</em>. The
default value is <code dir="auto">false</code>.</p>
<p><code dir="auto">xloc</code></p>
<p class="spacer-wrapper"><spacer/>Specifies which field from each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in the <code dir="auto">points</code> array the polyline uses for its x-coordinates. When
its value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>,
the function uses the <code dir="auto">index</code> fields to create the polyline. When
its value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_time">xloc.bar_time</a>,
the function uses the <code dir="auto">time</code> fields. The default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>.</p>
<p><code dir="auto">line_color</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the color of all line segments in the polyline drawing.
The default is <code dir="auto">color.blue</code>.</p>
<p><code dir="auto">fill_color</code></p>
<p class="spacer-wrapper"><spacer/>Controls the color of the closed space filled by the polyline
drawing. Its default value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p><code dir="auto">line_style</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the style of the polyline, which can be any of the
available options in the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#line-styles">Line styles</a> section of this page. The default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_line.style_solid">line.style_solid</a>.</p>
<p><code dir="auto">line_width</code></p>
<p class="spacer-wrapper"><spacer/>Specifies the width of the polyline, in pixels. The default value is
1.</p>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer/>If <code dir="auto">true</code>, the drawing will display on the main chart pane, even when the script occupies a separate pane. Optional. The default is <code dir="auto">false</code>.</p>
<p>This script demonstrates a simple example of drawing a polyline on the
chart. It
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">pushes</a>
a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
with an alternating <code dir="auto">price</code> value into a <code dir="auto">points</code> array and colors the
background with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
once every <code dir="auto">length</code> bars.</p>
<p>On the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islastconfirmedhistory">last confirmed historical
bar</a>,
the script draws a new polyline on the chart, connecting the coordinates
from each
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart point</a> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
starting from the first:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="552" loading="lazy" src="images/b73ce46d4775a8be29aacb25d9c514b7.webp" width="1348"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Creating polylines demo", "Oscillating polyline")

//@variable The number of bars between each point in the drawing.
int length = input.int(20, "Length between points", 2)

//@variable An array of `chart.point` objects to sequentially connect with a polyline.
var points = array.new&lt;chart.point&gt;()

//@variable The y-coordinate of each point in the `points`. Alternates between 1 and -1 on each `newPoint`.
var int yValue = 1

//@variable Is `true` once every `length` bars, `false` otherwise.
bool newPoint = bar_index % length == 0

if newPoint
    // Push a new `chart.point` into the `points`. The new point contains `time` and `index` info.
    points.push(chart.point.now(yValue))
    // Change the sign of the `yValue`.
    yValue *= -1

// Draw a new `polyline` on the last confirmed historical chart bar.
// The polyline uses the `time` field from each `chart.point` in the `points` array as x-coordinates.
if barstate.islastconfirmedhistory
    polyline.new(points, xloc = xloc.bar_time, line_color = #9151A6, line_width = 3)

// Highlight the chart background on every `newPoint` condition.
bgcolor(newPoint ? color.new(color.gray, 70) : na, title = "New point highlight")</code></div>
<p>Note that:</p>
<ul>
<li>This script uses only <em>one</em> polyline to connect each
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart point</a> from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
with straight line segments, and this drawing spans throughout
the available chart data, starting from the first bar.</li>
<li>While one can achieve a similar effect using
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>,
doing so would require a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instance on each occurrence of the <code dir="auto">newPoint</code> condition, and
such a drawing would be limited to a maximum of 500 line
segments. This single unclosed polyline drawing, on the other
hand, can contain up to 9,999 line segments.</li>
</ul>
<h4 class="md-heading" id="curved-drawings"><a href="#curved-drawings">Curved drawings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Polylines can draw <em>curves</em> that are otherwise impossible to produce
with <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> or
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>. When
enabling the <code dir="auto">curved</code> parameter of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
function, the resulting polyline interpolates <em>nonlinear</em> values between
the coordinates from each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in its
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of <code dir="auto">points</code> to generate a curvy effect.</p>
<p>For instance, the “Oscillating polyline” script in our previous
example uses <em>straight</em> line segments to produce a drawing resembling a
triangle wave, meaning a waveform that zig-zags between its peaks and
valleys. If we set the <code dir="auto">curved</code> parameter in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
call from that example to <code dir="auto">true</code>, the resulting drawing would connect
the points using <em>curved</em> segments, producing a smooth, nonlinear shape
similar to a sine wave:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="552" loading="lazy" src="images/723816e8ab2cbe0951554d73373ff934.webp" width="1348"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Curved drawings demo", "Smooth oscillating polyline")

//@variable The number of bars between each point in the drawing.
int length = input.int(20, "Length between points", 2)

//@variable An array of `chart.point` objects to sequentially connect with a polyline.
var points = array.new&lt;chart.point&gt;()

//@variable The y-coordinate of each point in the `points`. Alternates between 1 and -1 on each `newPoint`.
var int yValue = 1

//@variable Is `true` once every `length` bars, `false` otherwise.
bool newPoint = bar_index % length == 0

if newPoint
    // Push a new `chart.point` into the `points`. The new point contains `time` and `index` info.
    points.push(chart.point.now(yValue))
    // Change the sign of the `yValue`.
    yValue *= -1

// Draw a new curved `polyline` on the last confirmed historical chart bar.
// The polyline uses the `time` field from each `chart.point` in the `points` array as x-coordinates.
if barstate.islastconfirmedhistory
    polyline.new(points, curved = true, xloc = xloc.bar_time, line_color = #9151A6, line_width = 3)

// Highlight the chart background on every `newPoint` condition.
bgcolor(newPoint ? color.new(color.gray, 70) : na, title = "New point highlight")</code></div>
<p>Notice that in this example, the smooth curves have relatively
consistent behavior, and no portion of the drawing extends past its
defined coordinates, which is not always the case when drawing curved
polylines. The data used to construct a polyline heavily impacts the
smooth, piecewise function it interpolates between its points. In some
cases, the interpolated curve <em>can</em> reach beyond its actual coordinates.</p>
<p>Let’s add some variation to the
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> in our example’s <code dir="auto">points</code> array to demonstrate this
behavior. In the version below, the script multiplies the <code dir="auto">yValue</code> by a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">random</a>
value in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_chart.point.now">chart.point.now()</a>
calls.</p>
<p>To visualize the behavior, this script also creates a horizontal
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
at the <code dir="auto">price</code> value from each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in the <code dir="auto">points</code> array, and it displays another polyline connecting the
same points with straight line segments. As we see on the chart, both
polylines pass through all coordinates from the <code dir="auto">points</code> array. However,
the curvy polyline occasionally reaches <em>beyond</em> the vertical boundaries
indicated by the horizontal
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, whereas
the polyline drawn using straight segments does not:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="552" loading="lazy" src="images/dea4e7e2178b9ab7a321f1f6190de533.webp" width="1348"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Curved drawings demo", "Random oscillating polylines")

//@variable The number of bars between each point in the drawing.
int length = input.int(20, "Length between points", 2)

//@variable An array of `chart.point` objects to sequentially connect with a polyline.
var points = array.new&lt;chart.point&gt;()

//@variable The sign of each `price` in the `points`. Alternates between 1 and -1 on each `newPoint`.
var int yValue = 1

//@variable Is `true` once every `length` bars.
bool newPoint = bar_index % length == 0

if newPoint
    // Push a new `chart.point` with a randomized `price` into the `points`.
    // The new point contains `time` and `index` info.
    points.push(chart.point.now(yValue * math.random()))
    // Change the sign of the `yValue`.
    yValue *= -1

    //@variable The newest `chart.point`.
    lastPoint = points.last()
    // Draw a horizontal line at the `lastPoint.price`. This line uses the default `xloc.bar_index`.
    line.new(lastPoint.index - length, lastPoint.price, lastPoint.index + length, lastPoint.price, color = color.red)

// Draw two `polyline` instances on the last confirmed chart bar.
// Both polylines use the `time` field from each `chart.point` in the `points` array as x-coordinates.
if barstate.islastconfirmedhistory
    polyline.new(points, curved = false, xloc = xloc.bar_time, line_color = #EB8A3B, line_width = 2)
    polyline.new(points, curved = true, xloc = xloc.bar_time, line_color = #9151A6, line_width = 3)

// Highlight the chart background on every `newPoint` condition.
bgcolor(newPoint ? color.new(color.gray, 70) : na, title = "New point highlight")</code></div>
<h4 class="md-heading" id="closed-shapes"><a href="#closed-shapes">Closed shapes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Since a single polyline can contain numerous straight or curved line
segments, and the <code dir="auto">closed</code> parameter allows the drawing to connect the
coordinates from the first and last
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
in its
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of <code dir="auto">points</code>, we can use polylines to draw many different types of closed
polygonal shapes.</p>
<p>Let’s draw some polygons in Pine. The following script periodically
draws randomized polygons centered at
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>
price values.</p>
<p>On each occurrence of the <code dir="auto">newPolygon</code> condition, it
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.clear">clears</a>
the <code dir="auto">points</code> array, calculates the <code dir="auto">numberOfSides</code> and <code dir="auto">rotationOffset</code>
of the new polygon drawing based on
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">math.random()</a>
values, then uses a <a href="/pine-script-docs/v5/language/loops/#for-loops">for loop</a> to push <code dir="auto">numberOfSides</code> new
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> into the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
that contain stepped coordinates from an elliptical path with <code dir="auto">xScale</code>
and <code dir="auto">yScale</code> semi-axes. The script draws the polygon by connecting each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
from the <code dir="auto">points</code> array using a <em>closed polyline</em> with straight line
segments:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="612" loading="lazy" src="images/38f8bff5b2c129fda1bb6e00feb65d00.webp" width="1332"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Closed shapes demo", "N-sided polygons", true)

//@variable The size of the horizontal semi-axis.
float xScale = input.float(3.0, "X scale", 1.0)
//@variable The size of the vertical semi-axis.
float yScale = input.float(1.0, "Y scale") * ta.atr(2)

//@variable An array of `chart.point` objects containing vertex coordinates.
var points = array.new&lt;chart.point&gt;()

//@variable The condition that triggers a new polygon drawing. Based on the horizontal axis to prevent overlaps.
bool newPolygon = bar_index % int(math.round(2 * xScale)) == 0 and barstate.isconfirmed

if newPolygon
    // Clear the `points` array.
    points.clear()

    //@variable The number of sides and vertices in the new polygon.
    int numberOfSides = int(math.random(3, 7))
    //@variable A random rotation offset applied to the new polygon, in radians.
    float rotationOffset = math.random(0.0, 2.0) * math.pi
    //@variable The size of the angle between each vertex, in radians.
    float step = 2 * math.pi / numberOfSides

    //@variable The counter-clockwise rotation angle of each vertex.
    float angle = rotationOffset

    for i = 1 to numberOfSides
        //@variable The approximate x-coordinate from an ellipse at the `angle`, rounded to the nearest integer.
        int xValue = int(math.round(xScale * math.cos(angle))) + bar_index
        //@variable The y-coordinate from an ellipse at the `angle`.
        float yValue = yScale * math.sin(angle) + hl2

        // Push a new `chart.point` containing the `xValue` and `yValue` into the `points` array.
        // The new point does not contain `time` information.
        points.push(chart.point.from_index(xValue, yValue))
        // Add the `step` to the `angle`.
        angle += step

    // Draw a closed polyline connecting the `points`.
    // The polyline uses the `index` field from each `chart.point` in the `points` array.
    polyline.new(
         points, closed = true, line_color = color.navy, fill_color = color.new(color.orange, 50), line_width = 3
     )</code></div>
<p>Note that:</p>
<ul>
<li>This example shows the last ~50 polylines on the chart, as we
have not specified a <code dir="auto">max_polylines_count</code> value in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call.</li>
<li>The <code dir="auto">yScale</code> calculation multiplies an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.float">input.float()</a>
by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.atr">ta.atr(2)</a>
to adapt the vertical scale of the drawings to recent price
ranges.</li>
<li>The resulting polygons have a maximum width of twice the
horizontal semi-axis (<code dir="auto">2 * xScale</code>), rounded to the nearest
integer. The <code dir="auto">newPolygon</code> condition uses this value to prevent
the polygon drawings from overlapping.</li>
<li>The script rounds the <code dir="auto">xValue</code> calculation to the nearest
integer because the <code dir="auto">index</code> field of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
only accepts an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
value, as the x-axis of the chart does not include fractional
bar indices.</li>
</ul>
<h3 class="md-heading" id="deleting-polylines"><a href="#deleting-polylines">Deleting polylines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>To delete a specific polyline <code dir="auto">id</code>, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete">polyline.delete()</a>.
This function removes the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
object from the script and its drawing on the chart.</p>
<p>As with other drawing objects, we can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete">polyline.delete()</a>
to maintain a specific number of polyline drawings or conditionally
remove drawings from a chart.</p>
<p>For example, the script below periodically draws approximate arithmetic
spirals and stores their polyline IDs in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
which it
<a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">uses as a queue</a> to manage the number of drawings it displays.</p>
<p>When the <code dir="auto">newSpiral</code> condition occurs, the script creates a <code dir="auto">points</code>
array and adds
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> within a <a href="/pine-script-docs/v5/language/loops/#for-loops">for loop</a>. On each loop iteration, it calls the <code dir="auto">spiralPoint()</code>
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> to create a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
containing stepped values from an elliptical path that grows with
respect to the <code dir="auto">angle</code>. The script then creates a randomly colored
<em>curved polyline</em> connecting the coordinates from the <code dir="auto">points</code> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">pushes</a>
its ID into the <code dir="auto">polylines</code> array.</p>
<p>When the array’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
exceeds the specified <code dir="auto">numberOfSpirals</code>, the script removes the oldest
polyline using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>
and deletes the object using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete">polyline.delete()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="610" loading="lazy" src="images/eb722e02a79a54fa9edd87a88c948a91.webp" width="1332"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

//@variable The maximum number of polylines allowed on the chart.
const int MAX_POLYLINES_COUNT = 100

indicator("Deleting polylines example", "Spirals", true, max_polylines_count = MAX_POLYLINES_COUNT)

//@variable The number of spiral drawings on the chart.
int numberOfSpirals = input.int(10, "Spirals shown", 1, MAX_POLYLINES_COUNT)
//@variable The number of full spiral rotations to draw.
int rotations = input.int(5, "Rotations", 1)
//@variable The scale of the horizontal semi-axis.
float xScale = input.float(1.0, "X scale")
//@variable The scale of the vertical semi-axis.
float yScale = input.float(0.2, "Y scale") * ta.atr(2)

//@function Calculates an approximate point from an elliptically-scaled arithmetic spiral.
//@returns  A `chart.point` with `index` and `price` information.
spiralPoint(float angle, int xOffset, float yOffset) =&gt;
    result = chart.point.from_index(
         int(math.round(angle * xScale * math.cos(angle))) + xOffset,
         angle * yScale * math.sin(angle) + yOffset
     )

//@variable An array of polylines.
var polylines = array.new&lt;polyline&gt;()

//@variable The condition to create a new spiral.
bool newSpiral = bar_index % int(math.round(4 * math.pi * rotations * xScale)) == 0

if newSpiral
    //@variable An array of `chart.point` objects for the `spiral` drawing.
    points = array.new&lt;chart.point&gt;()
    //@variable The counter-clockwise angle between calculated points, in radians.
    float step = math.pi / 2
    //@variable The rotation angle of each calculated point on the spiral, in radians.
    float theta = 0.0
    // Loop to create the spiral's points. Creates 4 points per full rotation.
    for i = 0 to rotations * 4
        //@variable A new point on the calculated spiral.
        chart.point newPoint = spiralPoint(theta, bar_index, ohlc4)
        // Add the `newPoint` to the `points` array.
        points.push(newPoint)
        // Add the `step` to the `theta` angle.
        theta += step

    //@variable A random color for the new `spiral` drawing.
    color spiralColor = color.rgb(math.random(150, 255), math.random(0, 100), math.random(150, 255))
    //@variable A new polyline connecting the spiral points. Uses the `index` field from each point as x-coordinates.
    polyline spiral = polyline.new(points, true, line_color = spiralColor, line_width = 3)

    // Push the new `spiral` into the `polylines` array.
    polylines.push(spiral)
    // Shift the first polyline out of the array and delete it when the array's size exceeds the `numberOfSpirals`.
    if polylines.size() &gt; numberOfSpirals
        polyline.delete(polylines.shift())

// Highlight the background when `newSpiral` is `true`.
bgcolor(newSpiral ? color.new(color.blue, 70) : na, title = "New drawing highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We declared a <code dir="auto">MAX_POLYLINES_COUNT</code> global variable with a
constant value of 100. The script uses this constant as the
<code dir="auto">max_polylines_count</code> value in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function and the <code dir="auto">maxval</code> of the <code dir="auto">numberOfSpirals</code> input.</li>
<li>As with our “N-sided polygons” example in the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#closed-shapes">previous section</a>, we round the calculation of x-coordinates to the
nearest integer since the <code dir="auto">index</code> field of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
can only accept an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_int">int</a>
value.</li>
<li>Despite the smooth appearance of the drawings, each polyline’s
<code dir="auto">points</code> array only contains <em>four</em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects per spiral rotation. Since the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
call includes <code dir="auto">curved = true</code>, each polyline uses <em>smooth
curves</em> to connect their <code dir="auto">points</code>, producing a visual
approximation of the spiral’s actual curvature.</li>
<li>The width of each spiral is approximately
<code dir="auto">4 * math.pi * rotations * xScale</code>, rounded to the nearest
integer. We use this value in the <code dir="auto">newSpiral</code> condition to space
each drawing and prevent overlaps.</li>
</ul>
<h3 class="md-heading" id="redrawing-polylines"><a href="#redrawing-polylines">Redrawing polylines<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>It may be desirable in some cases to change a polyline drawing
throughout a script’s execution. While the <code dir="auto">polyline.*</code> namespace does
not contain built-in setter functions, we can <em>redraw</em> polylines
referenced by variables or
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> by <em>deleting</em> the existing polylines and assigning <em>new
instances</em> with the desired changes.</p>
<p>The following example uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.delete">polyline.delete()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">polyline.new()</a>
calls to update the value of a polyline variable.</p>
<p>This script draws closed polylines that connect the open, high, low, and
close points of periods containing <code dir="auto">length</code> bars. It creates a
<code dir="auto">currentDrawing</code> variable on the first bar and assigns a polyline ID to
it on every chart bar. It uses the <code dir="auto">openPoint</code>, <code dir="auto">highPoint</code>, <code dir="auto">lowPoint</code>,
and <code dir="auto">closePoint</code> variables to reference
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> that track the period’s developing OHLC values. As new
values emerge, the script assigns new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects to the variables, collects them in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from</a>,
then creates a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_polyline.new">new
polyline</a>
connecting the coordinates from the array’s points and assigns it to
the <code dir="auto">currentDrawing</code>.</p>
<p>When the <code dir="auto">newPeriod</code> condition is <code dir="auto">false</code> (i.e., the current period is
not complete), the script
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#deleting-polylines">deletes</a> the polyline referenced by the <code dir="auto">currentDrawing</code> before
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#creating-polylines">creating a new one</a>, resulting in a dynamic drawing that changes over the
developing period:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="540" loading="lazy" src="images/84209db8e08da1678e4334f5270ecdd8.webp" width="1278"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Redrawing polylines demo", "OHLC polygons", true, max_polylines_count = 100)

//@variable The length of the period.
int length = input.int(100, "Length", 1)

//@variable A `chart.point` representing the start of each period.
var chart.point openPoint = na
//@variable A `chart.point` representing the highest point of each period.
var chart.point highPoint = na
//@variable A `chart.point` representing the lowest point of each period.
var chart.point lowPoint = na
//@variable A `chart.point` representing the current bar's closing point.
closePoint = chart.point.now(close)

//@variable The current period's polyline drawing.
var polyline currentDrawing = na

//@variable Is `true` once every `length` bars.
bool newPeriod = bar_index % length == 0

if newPeriod
    // Assign new chart points to the `openPoint`, `highPoint`, and `closePoint`.
    openPoint := chart.point.now(open)
    highPoint := chart.point.now(high)
    lowPoint  := chart.point.now(low)
else
    // Assign a new `chart.point` to the `highPoint` when the `high` is greater than its `price`.
    if high &gt; highPoint.price
        highPoint := chart.point.now(high)
    // Assign a new `chart.point` to the `lowPoint` when the `low` is less than its `price`.
    if low &lt; lowPoint.price
        lowPoint := chart.point.now(low)

//@variable Is teal when the `closePoint.price` is greater than the `openPoint.price`, maroon otherwise.
color drawingColor = closePoint.price &gt; openPoint.price ? color.teal : color.maroon

// Delete the polyline assigned to the `currentDrawing` if it's not a `newPeriod`.
if not newPeriod
    polyline.delete(currentDrawing)
// Assign a new polyline to the `currentDrawing`.
// Uses the `index` field from each `chart.point` in its array as x-coordinates.
currentDrawing := polyline.new(
     array.from(openPoint, highPoint, closePoint, lowPoint), closed = true,
     line_color = drawingColor, fill_color = color.new(drawingColor, 60)
 )</code></div>
<h2 class="md-heading" id="realtime-behavior"><a href="#realtime-behavior">Realtime behavior<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">Lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>
are subject to both <em>commit</em> and <em>rollback</em> actions, which affect the
behavior of a script when it executes on a realtime bar. See the page on
Pine Script™‘s <a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>.</p>
<p>This script demonstrates the effect of rollback when it executes on the
realtime, <em>unconfirmed</em> chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="474" loading="lazy" src="images/0759b6e042adb2a89350458b38c91df9.webp" width="1328"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Realtime behavior demo", overlay = true)

//@variable Is orange when the `line` is subject to rollback and gray after the `line` is committed.
color lineColor = barstate.isconfirmed ? color.gray : color.orange

line.new(bar_index, hl2, bar_index + 1, hl2, color = lineColor, width = 4)</code></div>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>
call in this example creates a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
ID on each iteration when values change on the unconfirmed bar. The
script automatically deletes the objects created on each change in that
bar because of the <em>rollback</em> before each iteration. It only <em>commits</em>
the last line created before the bar closes, and that
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
instance is the one that persists on the confirmed bar.</p>
<h2 class="md-heading" id="limitations"><a href="#limitations">Limitations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="total-number-of-objects"><a href="#total-number-of-objects">Total number of objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">Lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, and
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>
consume server resources, which is why there are limits on the total
number of drawings per script. When a script creates more drawing
objects than the allowed limit, the Pine Script™ runtime automatically
deletes the oldest ones in a process referred to as <em>garbage
collection</em>.</p>
<p>A single script can contain up to 500 lines, 500 boxes, and 100
polylines. Users can control the garbage collection limits by specifying
the <code dir="auto">max_lines_count</code>, <code dir="auto">max_boxes_count</code>, and <code dir="auto">max_polylines_count</code>
values in their script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement.</p>
<p>This script demonstrates how garbage collection works in Pine. It
creates a new line, box, and polyline on each chart bar. We haven’t
specified values for the <code dir="auto">max_lines_count</code>, <code dir="auto">max_boxes_count</code>, or
<code dir="auto">max_polylines_count</code> parameters in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function call, so the script will maintain the most recent ~50 lines,
boxes, and polylines on the chart, as this is the default setting for
each parameter:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="534" loading="lazy" src="images/9eaf4b8c02d1d3a3bee57fd00879e0d7.webp" width="1196"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Garbage collection demo", overlay = true)

//@variable A new `chart.point` at the current `bar_index` and `high`.
firstPoint = chart.point.now(high)
//@variable A new `chart.point` one bar into the future at the current `low`.
secondPoint = chart.point.from_index(bar_index + 1, low)
//@variable A new `chart.point` one bar into the future at the current `high`.
thirdPoint = chart.point.from_index(bar_index + 1, high)

// Draw a new `line` connecting the `firstPoint` to the `secondPoint`.
line.new(firstPoint, secondPoint, color = color.red, width = 2)
// Draw a new `box` with the `firstPoint` top-left corner and `secondPoint` bottom-right corner.
box.new(firstPoint, secondPoint, color.purple, 2, bgcolor = na)
// Draw a new `polyline` connecting the `firstPoint`, `secondPoint`, and `thirdPoint` sequentially.
polyline.new(array.from(firstPoint, secondPoint, thirdPoint), true, line_width = 2)</code></div>
<p>Note that:</p>
<ul>
<li>We’ve used TradingView’s “Measure” drawing tool to measure
the number of bars covered by the script’s drawing objects.</li>
</ul>
<h3 class="md-heading" id="future-references-with-xlocbar_index"><a href="#future-references-with-xlocbar_index">Future references with `xloc.bar_index`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Objects positioned using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_xloc.bar_index">xloc.bar_index</a>
can contain x-coordinates no further than 500 bars into the future.</p>
<h3 class="md-heading" id="other-contexts"><a href="#other-contexts">Other contexts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts cannot use <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>, or
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>
in <code dir="auto">request.*()</code> functions. Instances of these types can use the values
from <code dir="auto">request.*()</code> calls, but scripts can only create and draw them in
the chart’s context.</p>
<p>This limitation is also why drawing objects will not work when using the
<code dir="auto">timeframe</code> parameter in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
declaration statement.</p>
<h3 class="md-heading" id="historical-buffer-and-max_bars_back"><a href="#historical-buffer-and-max_bars_back">Historical buffer and `max_bars_back`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">barstate.isrealtime</a>
in combination with drawings may sometimes produce unexpected results.
For example, the intention of this script is to ignore all historical
bars and draw horizontal lines spanning 300 bars back on <em>realtime</em>
bars:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Historical buffer demo", overlay = true)

//@variable A `chart.point` at the `bar_index` from 300 bars ago and current `close`.
firstPoint = chart.point.from_index(bar_index[300], close)
//@variable The current bar's `chart.point` containing the current `close`.
secondPoint = chart.point.now(close)

// Draw a new line on realtime bars.
if barstate.isrealtime
    line.new(firstPoint, secondPoint)</code></div>
<p>However, it will fail at runtime and raise an error. The script fails
because it cannot determine the buffer size for historical values of the
underlying
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
series. Although the code doesn’t contain the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
variable, the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
series in its inner workings. Therefore, accessing the value of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
from 300 bars back requires the history buffer of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
series to be at least 300 bars.</p>
<p>Pine Script™ includes a mechanism that detects the required historical
buffer size automatically in most cases. It works by letting the script
access historical values any number of bars back for a limited duration.
In this script’s case, using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">barstate.isrealtime</a>
to control the drawing of lines prevents it from accessing the
historical series, so it cannot infer the required historical buffer
size, and the script fails.</p>
<p>The simple solution to this issue is to use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a>
function to <em>explicitly define</em> the historical buffer of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
series before evaluating the
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structure</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Historical buffer demo", overlay = true)

//@variable A `chart.point` at the `bar_index` from 300 bars ago and current `close.
firstPoint = chart.point.from_index(bar_index[300], close)
//@variable The current bar's `chart.point` containing the current `close`.
secondPoint = chart.point.now(close)

// Explicitly set the historical buffer of the `time` series to 300 bars.
max_bars_back(time, 300)

// Draw a new line on realtime bars.
if barstate.isrealtime
    line.new(firstPoint, secondPoint)</code></div>
<p>Such issues can be confusing, but they’re quite rare. The Pine Script™
team hopes to eliminate them over time.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/libraries"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Libraries  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/non-standard-charts-data"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Non-standard charts data <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Non-standard charts data</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-non-standard-charts-data"><a href="#non-standard-charts-data">Non-standard charts data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>These functions allow scripts to fetch information from non-standard
bars or chart types, regardless of the type of chart the script is
running on. They are:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dheikinashi">ticker.heikinashi()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Drenko">ticker.renko()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dlinebreak">ticker.linebreak()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dkagi">ticker.kagi()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dpointfigure">ticker.pointfigure()</a>.
All of them work in the same manner; they create a special ticker
identifier to be used as the first argument in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
function call.</p>
<h2 class="md-heading" id="tickerheikinashi"><a href="#tickerheikinashi">`ticker.heikinashi()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Heikin-Ashi</em> means <em>average bar</em> in Japanese. The open/high/low/close
values of Heikin-Ashi candlesticks are synthetic; they are not actual
market prices. They are calculated by averaging combinations of real
OHLC values from the current and previous bar. The calculations used
make Heikin-Ashi bars less noisy than normal candlesticks. They can be
useful to make visual assessments, but are unsuited to backtesting or
automated trading, as orders execute on market prices — not
Heikin-Ashi prices.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dheikinashi">ticker.heikinashi()</a>
function creates a special ticker identifier for requesting Heikin-Ashi
data with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
function.</p>
<p>This script requests the close value of Heikin-Ashi bars and plots them
on top of the normal candlesticks:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="820" loading="lazy" src="images/b41e89c0c7f3f71146af6083bbbf7221.webp" width="1766"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("HA Close", "", true)
haTicker = ticker.heikinashi(syminfo.tickerid)
haClose = request.security(haTicker, timeframe.period, close)
plot(haClose, "HA Close", color.black, 3)</code></div>
<p>Note that:</p>
<ul>
<li>The close values for Heikin-Ashi bars plotted as the black line are
very different from those of real candles using market prices. They
act more like a moving average.</li>
<li>The black line appears over the chart bars because we have selected
“Visual Order/Bring to Front” from the script’s “More” menu.</li>
</ul>
<p>If you wanted to omit values for extended hours in the last example, an
intermediary ticker without extended session information would need to
be created first:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="874" loading="lazy" src="images/f0a42469770025f0d70cedf26f524cd2.webp" width="1768"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("HA Close", "", true)
regularSessionTicker = ticker.new(syminfo.prefix, syminfo.ticker, session.regular)
haTicker = ticker.heikinashi(regularSessionTicker)
haClose = request.security(haTicker, timeframe.period, close, gaps = barmerge.gaps_on)
plot(haClose, "HA Close", color.black, 3, plot.style_linebr)</code></div>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>
function first, to create a ticker without extended session
information.</li>
<li>We use that ticker instead of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtickerid">syminfo.tickerid</a>
in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dheikinashi">ticker.heikinashi()</a>
call.</li>
<li>In our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
call, we set the <code dir="auto">gaps</code> parameter’s value to <code dir="auto">barmerge.gaps_on</code>.
This instructs the function not to use previous values to fill slots
where data is absent. This makes it possible for it to return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values outside of regular sessions.</li>
<li>To be able to see this on the chart, we also need to use a special
<code dir="auto">plot.style_linebr</code> style, which breaks the plots on
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values.</li>
</ul>
<p>This script plots Heikin-Ashi candles under the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="872" loading="lazy" src="images/f05b0fdf9747f9645d885231b1cf137e.webp" width="1766"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Heikin-Ashi candles")
CANDLE_GREEN = #26A69A
CANDLE_RED   = #EF5350

haTicker = ticker.heikinashi(syminfo.tickerid)
[haO, haH, haL, haC] = request.security(haTicker, timeframe.period, [open, high, low, close])
candleColor = haC &gt;= haO ? CANDLE_GREEN : CANDLE_RED
plotcandle(haO, haH, haL, haC, color = candleColor)</code></div>
<p>Note that:</p>
<ul>
<li>We use a
<a href="/pine-script-docs/v5/language/variable-declarations/#tuple-declarations">tuple</a> with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch four values with the same call.</li>
<li>We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
to plot our candles. See the
<a href="/pine-script-docs/v5/concepts/bar-plotting/">Bar plotting</a> page
for more information.</li>
</ul>
<h2 class="md-heading" id="tickerrenko"><a href="#tickerrenko">`ticker.renko()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Renko</em> bars only plot price movements, without taking time or volume
into consideration. They look like bricks stacked in adjacent
columns<sup><a aria-describedby="footnote-label" data-footnote-ref="" href="#user-content-fn-1" id="user-content-fnref-1">1</a></sup>. A new brick is only drawn after the price passes the top or
bottom by a predetermined amount. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Drenko">ticker.renko()</a>
function creates a ticker id which can be used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch Renko values, but there is no Pine Script™ function to draw
Renko bars on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
renkoTicker = ticker.renko(syminfo.tickerid, "ATR", 10)
renkoLow = request.security(renkoTicker, timeframe.period, low)
plot(renkoLow)</code></div>
<h2 class="md-heading" id="tickerlinebreak"><a href="#tickerlinebreak">`ticker.linebreak()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <em>Line Break</em> chart type displays a series of vertical boxes that are
based on price changes<sup><a aria-describedby="footnote-label" data-footnote-ref="" href="#user-content-fn-1" id="user-content-fnref-1-2">1</a></sup>. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dlinebreak">ticker.linebreak()</a>
function creates a ticker id which can be used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch “Line Break” values, but there is no Pine Script™ function to
draw such bars on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
lineBreakTicker = ticker.linebreak(syminfo.tickerid, 3)
lineBreakClose = request.security(lineBreakTicker, timeframe.period, close)
plot(lineBreakClose)</code></div>
<h2 class="md-heading" id="tickerkagi"><a href="#tickerkagi">`ticker.kagi()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Kagi</em> charts are made of a continuous line that changes directions. The
direction changes when the price changes<sup><a aria-describedby="footnote-label" data-footnote-ref="" href="#user-content-fn-1" id="user-content-fnref-1-3">1</a></sup> beyond a predetermined
amount. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dkagi">ticker.kagi()</a>
function creates a ticker id which can be used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch “Kagi” values, but there is no Pine Script™ function to draw
such bars on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
kagiBreakTicker = ticker.linebreak(syminfo.tickerid, 3)
kagiBreakClose = request.security(kagiBreakTicker, timeframe.period, close)
plot(kagiBreakClose)</code></div>
<h2 class="md-heading" id="tickerpointfigure"><a href="#tickerpointfigure">`ticker.pointfigure()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Point and Figure</em> (PnF) charts only plot price movements<sup><a aria-describedby="footnote-label" data-footnote-ref="" href="#user-content-fn-1" id="user-content-fnref-1-4">1</a></sup>, without
taking time into consideration. A column of X’s is plotted as the price
rises, and O’s are plotted when price drops. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dpointfigure">ticker.pointfigure()</a>
function creates a ticker id which can be used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to fetch “PnF” values, but there is no Pine Script™ function to draw
such bars on the chart. Every column of X’s or O’s is represented with
four numbers. You may think of them as synthetic OHLC PnF values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
pnfTicker = ticker.pointfigure(syminfo.tickerid, "hl", "ATR", 14, 3)
[pnfO, pnfC] = request.security(pnfTicker, timeframe.period, [open, close], barmerge.gaps_on)
plot(pnfO, "PnF Open", color.green, 4, plot.style_linebr)
plot(pnfC, "PnF Close", color.red, 4, plot.style_linebr)</code></div>
<section class="footnotes" data-footnotes=""><h2 class="md-heading" id="footnote-label"><a href="#footnote-label">Footnotes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<ol>
<li id="user-content-fn-1">
<p>On TradingView, Renko, Line Break, Kagi and PnF chart types are
generated from OHLC values from a lower timeframe. These chart types
thus represent only an approximation of what they would be like if
they were generated from tick data. <a aria-label="Back to reference 1" class="data-footnote-backref" data-footnote-backref="" href="#user-content-fnref-1">↩</a> <a aria-label="Back to reference 1-2" class="data-footnote-backref" data-footnote-backref="" href="#user-content-fnref-1-2">↩<sup>2</sup></a> <a aria-label="Back to reference 1-3" class="data-footnote-backref" data-footnote-backref="" href="#user-content-fnref-1-3">↩<sup>3</sup></a> <a aria-label="Back to reference 1-4" class="data-footnote-backref" data-footnote-backref="" href="#user-content-fnref-1-4">↩<sup>4</sup></a></p>
</li>
</ol>
</section> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/lines-and-boxes"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Lines and boxes  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/other-timeframes-and-data"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Other timeframes and data <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Other timeframes and data</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-other-timeframes-and-data"><a href="#other-timeframes-and-data">Other timeframes and data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ allows users to request data from sources and contexts
other than those their charts use. The functions we present on this page
can fetch data from a variety of alternative sources:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity">request.security()</a> retrieves data from another symbol, timeframe, or other
context.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity_lower_tf">request.security_lower_tf()</a> retrieves <em>intrabar</em> data, i.e., data from a timeframe
lower than the chart timeframe.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestcurrency_rate">request.currency_rate()</a> requests a <em>daily rate</em> to convert a value expressed in
one currency to another.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestdividends-requestsplits-and-requestearnings">request.dividends(), request.splits(), and request.earnings()</a> respectively retrieve information about an issuing
company’s dividends, splits, and earnings.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestquandl">request.quandl()</a> retrieves information from <a href="https://data.nasdaq.com/" rel="nofollow">NASDAQ Data
Link</a> (formerly Quandl).</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestfinancial">request.financial()</a> retrieves financial data from
<a href="https://www.factset.com/" rel="nofollow">FactSet</a>.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requesteconomic">request.economic()</a> retrieves economic and industry data.</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestseed">request.seed()</a> retrieves data from a <em>user-maintained</em> GitHub
repository.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Throughout this page, and in other parts of our documentation that discuss <code dir="auto">request.*()</code> functions, we often use the term <em>“context”</em> to describe the symbol, timeframe, and any modifications (price adjustments, session settings, non-standard chart types, etc.) that apply to a chart or the data retrieved by a script.</p></div></aside>
<p>These are the signatures of the functions in the <code dir="auto">request.*</code> namespace:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.security(symbol, timeframe, expression, gaps, lookahead, ignore_invalid_symbol, currency, calc_bars_count) → series &lt;type&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.security_lower_tf(symbol, timeframe, expression, ignore_invalid_symbol, currency, ignore_invalid_timeframe, calc_bars_count) → array&lt;type&gt;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.currency_rate(from, to, ignore_invalid_currency) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.dividends(ticker, field, gaps, lookahead, ignore_invalid_symbol, currency) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.splits(ticker, field, gaps, lookahead, ignore_invalid_symbol) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.earnings(ticker, field, gaps, lookahead, ignore_invalid_symbol, currency) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.quandl(ticker, gaps, index, ignore_invalid_symbol) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.financial(symbol, financial_id, period, gaps, ignore_invalid_symbol, currency) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.economic(country_code, field, gaps, ignore_invalid_symbol) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.seed(source, symbol, expression, ignore_invalid_symbol, calc_bars_count) → series &lt;type&gt;</span></div></div></code></pre></figure></link></div>
<p>The <code dir="auto">request.*()</code> family of functions has numerous potential applications. Throughout this page, we discuss in detail these functions and some of their typical use cases.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Users can also allow compatible scripts to evaluate their scopes in other contexts without requiring <code dir="auto">request.*()</code> functions by using the <code dir="auto">timeframe</code> parameter of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration statement.</p></div></aside>
<h2 class="md-heading" id="common-characteristics"><a href="#common-characteristics">Common characteristics<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Many functions in the <code dir="auto">request.*()</code> namespace share some common properties and parameters. Before we explore each function in depth, let’s familiarize ourselves with these characteristics.</p>
<h3 class="md-heading" id="behavior"><a href="#behavior">Behavior<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>All <code dir="auto">request.*()</code> functions have similar internal behavior, even though they do not all share the same required parameters. Every unique <code dir="auto">request.*()</code> call in a script requests a dataset from a defined <em>context</em> (i.e., ticker ID and timeframe) and evaluates an <em>expression</em> across the retrieved data.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> functions allow programmers to specify the context of a request and the expression directly via the <code dir="auto">symbol</code>, <code dir="auto">timeframe</code>, and <code dir="auto">expression</code> parameters, making them suitable for a wide range of data requests.</p>
<p>For example, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call in this simple script requests daily “AMEX:SPY” data, and it calculates the slope of a 20-bar linear regression line using the retrieved <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a> prices. The first two arguments specify the context of the request, and the third specifies the expression to evaluate across the requested data:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="568" loading="lazy" src="images/7bd2b72a99d334eff740c6de92d89a21.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Behavior of `request.security()` demo")

//@variable The 20-bar linear regression slope of `hl2` prices from the "AMEX:SPY" symbol on the "1D" timeframe.
float requestedSlope = request.security("AMEX:SPY", "1D", ta.linreg(hl2, 20, 0) - ta.linreg(hl2, 20, 1))

//@variable Is `color.teal` when the `requestedSlope` is positive, and `color.maroon` otherwise.
color plotColor = requestedSlope &gt; 0 ? color.teal : color.maroon

// Plot the `requestedSlope` with the `plotColor`.
plot(requestedSlope, "Requested slope", plotColor, 1, plot.style_area)</code></div>
<p>Other functions within the <code dir="auto">request.*()</code> namespace <em>do not</em> allow programmers to directly define the full context of a request or the evaluated expression. Instead, these functions determine some of the necessary information <em>internally</em> because they perform only specific types of requests.</p>
<p>For instance, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a> exclusively retrieves periodic financial data. Its required parameters (<code dir="auto">symbol</code>, <code dir="auto">financial_id</code>, and <code dir="auto">period</code>) all define parts of a specific financial <em>ticker ID</em>. The function does not allow specification of the timeframe or expression, as it determines these details internally. The script below demonstrates a simple call to this function that retrieves the annual cost of goods data for the chart symbol’s issuing company:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/ffde4bbeba62bc7cc062f37923998bc9.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Behavior of `request.financial()` demo", format = format.volume)

//@variable The annual cost of goods sold by the chart symbol's issuing company.
float costOfGoods = request.financial(syminfo.tickerid, "COST_OF_GOODS", "FY")

// Plot the `costOfGoods`.
plot(costOfGoods, "Cost of goods", color.purple, 3, plot.style_stepline_diamond)</code></div>
<p>Scripts can perform up to 40 unique requests using any combination of <code dir="auto">request.*()</code> function calls. Only unique <code dir="auto">request.*()</code> calls count toward this limit because they are the only calls that fetch <em>new data</em>. Redundant calls to the same <code dir="auto">request.*()</code> function with identical arguments <em>do not</em> retrieve new data. Instead, they <em>reuse</em> the data from the first executed call. See <a href="/pine-script-docs/v5/writing/limitations/#number-of-calls">this section</a> of the <a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for more information.</p>
<h3 class="md-heading" id="gaps"><a href="#gaps">`gaps`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When using a <code dir="auto">request.*()</code> function to retrieve data from another context, the data may not come in on each new bar as it would with the current chart. The <code dir="auto">gaps</code> parameter of a <code dir="auto">request.*()</code> function controls how the function responds to nonexistent values in the requested series.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>When using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">timeframe</a> parameter of the <code dir="auto">indicator()</code> function to evaluate the entire script in a different timeframe, the <code dir="auto">timeframe_gaps</code> parameter specifies how the script handles nonexistent values. This parameter is similar to the <code dir="auto">gaps</code> parameter for <code dir="auto">request.*()</code> functions.</p></div></aside>
<p>Suppose we have a script executing on an 1-minute chart that requests hourly data for the chart’s symbol using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>. The function call returns new values only on the 1-minute bars that cover the opening and closing times of the symbol’s hourly bars. On other chart bars, we can decide whether the function returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values or the last available values via the <code dir="auto">gaps</code> parameter.</p>
<p>When the <code dir="auto">gaps</code> parameter uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_on">barmerge.gaps_on</a>, the function returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> results on all chart bars where new data is not yet confirmed from the requested context. Otherwise, when the parameter uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_off">barmerge.gaps_off</a>, the function fills the gaps in the requested data with the last confirmed values on historical bars and the most recent developing values on realtime bars.</p>
<p>The script below demonstrates the difference in behavior by <a href="/pine-script-docs/v5/concepts/plots/">plotting</a> the results from two <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> calls that fetch the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> price of the current symbol from the hourly timeframe on a 1-minute chart. The first call uses <code dir="auto">gaps = barmerge.gaps_off</code> and the second uses <code dir="auto">gaps = barmerge.gaps_on</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="598" loading="lazy" src="images/05222a919c8df6001224727279ac3a04.webp" width="1332"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`gaps` demo", overlay = true)

//@variable The `close` requested from the hourly timeframe without gaps.
float dataWithoutGaps = request.security(syminfo.tickerid, "60", close, gaps = barmerge.gaps_off)
//@variable The `close` requested from the hourly timeframe with gaps.
float dataWithGaps = request.security(syminfo.tickerid, "60", close, gaps = barmerge.gaps_on)

// Plot the requested data.
plot(dataWithoutGaps, "Data without gaps", color.blue, 3, plot.style_linebr)
plot(dataWithGaps, "Data with gaps", color.purple, 15, plot.style_linebr)

// Highlight the background for realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.aqua, 70) : na, title = "Realtime bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_off">barmerge.gaps_off</a> is the default value for the <code dir="auto">gaps</code> parameter in all applicable <code dir="auto">request.*()</code> functions.</li>
<li>The script plots the requested series as lines with breaks (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_plot.style_linebr">plot.style_linebr</a>), which do not bridge over <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values as the default style (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_plot.style_line">plot.style_line</a>) does.</li>
<li>When using <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_off">barmerge.gaps_off</a>, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function returns the last confirmed <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> from the hourly timeframe on all historical bars. When running on <em>realtime bars</em> (the bars with the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.aqua">color.aqua</a> background in this example), it returns the symbol’s current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> value, regardless of confirmation. For more information, see the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#historical-and-realtime-behavior">Historical and realtime behavior</a> section of this page.</li>
</ul>
<h3 class="md-heading" id="ignore_invalid_symbol"><a href="#ignore_invalid_symbol">`ignore_invalid_symbol`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">ignore_invalid_symbol</code> parameter of <code dir="auto">request.*()</code> functions determines how a function handles invalid data requests, e.g.:</p>
<ul>
<li>Using a <code dir="auto">request.*()</code> function with a nonexistent ticker ID as the <code dir="auto">symbol/ticker</code> parameter.</li>
<li>Using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a> to retrieve information that does not exist for the specified <code dir="auto">symbol</code> or <code dir="auto">period</code>.</li>
<li>Using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a> to request a <code dir="auto">field</code> that does not exist for a <code dir="auto">country_code</code>.</li>
</ul>
<p>A <code dir="auto">request.*()</code> function call produces a <em>runtime error</em> and halts the execution of the script when making an erroneous request if its <code dir="auto">ignore_invalid_symbol</code> parameter is <code dir="auto">false</code>. When this parameter’s value is <code dir="auto">true</code>, the function returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values in such a case instead of raising an error.</p>
<p>This example uses <code dir="auto">request.*()</code> calls within a <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> to retrieve data for estimating an instrument’s market capitalization (market cap). The user-defined <code dir="auto">calcMarketCap()</code> function calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a> to retrieve the total shares outstanding for a symbol and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve a tuple containing the symbol’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> price and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">currency</a>. We’ve included <code dir="auto">ignore_invalid_symbol = true</code> in both of these <code dir="auto">request.*()</code> calls to prevent runtime errors for invalid requests.</p>
<p>The script displays a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">formatted string</a> representing the symbol’s estimated market cap value and currency in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the chart and uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a> to visualize the <code dir="auto">marketCap</code> history:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="596" loading="lazy" src="images/b54591ba5f2b9fd37d4148da486398c7.webp" width="1334"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`ignore_invalid_symbol` demo", "Market cap estimate", format = format.volume)

//@variable The symbol to request data from.
string symbol = input.symbol("TSX:SHOP", "Symbol")

//@function Estimates the market capitalization of the specified `tickerID` if the data exists.
calcMarketCap(simple string tickerID) =&gt;
    //@variable The quarterly total shares outstanding for the `tickerID`. Returns `na` when the data isn't available.
    float tso = request.financial(tickerID, "TOTAL_SHARES_OUTSTANDING", "FQ", ignore_invalid_symbol = true)
    //@variable The `close` price and currency for the `tickerID`. Returns `[na, na]` when the `tickerID` is invalid.
    [price, currency] = request.security(
         tickerID, timeframe.period, [close, syminfo.currency], ignore_invalid_symbol = true
     )
    // Return a tuple containing the market cap estimate and the quote currency.
    [tso * price, currency]

//@variable A `table` object with a single cell that displays the `marketCap` and `quoteCurrency`.
var table infoTable = table.new(position.top_right, 1, 1)
// Initialize the table's cell on the first bar.
if barstate.isfirst
    table.cell(infoTable, 0, 0, "", text_color = color.white, text_size = size.huge, bgcolor = color.teal)

// Get the market cap estimate and quote currency for the `symbol`.
[marketCap, quoteCurrency] = calcMarketCap(symbol)

if barstate.islast
    //@variable The formatted text displayed inside the `infoTable`.
    string tableText = str.format("Market cap:\n{0} {1}", str.tostring(marketCap, format.volume), quoteCurrency)
    // Update the `infoTable`.
    table.cell_set_text(infoTable, 0, 0, tableText)

// Plot the `marketCap` value.
plot(marketCap, "Market cap", color.new(color.purple, 60), style = plot.style_area)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">calcMarketCap()</code> function only returns non-na values on valid instruments with total shares outstanding data, such as the one we selected for this example. It returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> on others that do not have financial data, including forex, crypto, and derivatives.</li>
<li>Not all issuing companies publish quarterly financial reports. If the issuing company of the <code dir="auto">symbol</code> does not report on a quarterly basis, change the “FQ” value in this script to the company’s minimum reporting period. See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestfinancial">request.financial()</a> section for more information.</li>
<li>We included <a href="https://www.tradingview.com/pine-script-reference/v5/#var_format.volume">format.volume</a> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a> calls to specify that the y-axis of the chart pane represents volume-formatted values and the “string” representation of the <code dir="auto">marketCap</code> value shows as volume-formatted text.</li>
<li>This script creates a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> and initializes its cell on the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isfirst">first chart bar</a>, then <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell_set_text">updates the cell’s text</a> on the last chart bar. To learn more about working with tables, see the <a href="/pine-script-docs/v5/concepts/tables/">Tables</a> page.</li>
</ul>
<h3 class="md-heading" id="currency"><a href="#currency">`currency`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">currency</code> parameter of a <code dir="auto">request.*()</code> function allows users to specify the currency of the requested data. When this parameter’s value differs from the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a> of the symbol, the function converts the requested values to express them in the specified <code dir="auto">currency</code>. This parameter accepts a built-in variable from the <code dir="auto">currency.*</code> namespace, such as <a href="https://www.tradingview.com/pine-script-reference/v5/#var_currency.JPY">currency.JPY</a>, or a “string” representing a valid currency code (e.g., “JPY”). If a script allows <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#dynamic-requests">dynamic requests</a>, this parameter allows a “series” argument that can change across executions. Otherwise, it accepts a value with a “simple” or weaker <a href="/pine-script-docs/v5/language/type-system/#qualifiers">qualifier</a>.</p>
<p>The conversion rate between the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a> of the requested data and the specified <code dir="auto">currency</code> depends on the <em>previous daily value</em> of the corresponding currency pair from the most popular exchange. If no exchange provides the rate directly, the function derives the rate using a <a href="https://www.tradingview.com/support/solutions/43000502298/">spread symbol</a>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Not all <code dir="auto">request.*()</code> function calls return values expressed as a currency amount. Therefore, currency conversion is <em>not</em> always necessary. For example, some series the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a> function returns use units other than currency, such as the “PIOTROSKI_F_SCORE” and “NUMBER_OF_EMPLOYEES” metrics. It is up to programmers to determine when currency conversion is appropriate in their data requests.</p></div></aside>
<h3 class="md-heading" id="lookahead"><a href="#lookahead">`lookahead`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">lookahead</code> parameter in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a> specifies the lookahead behavior of the function call. Its default value is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_off">barmerge.lookahead_off</a>.</p>
<p>When requesting data from a higher-timeframe (HTF) context, the <code dir="auto">lookahead</code> value determines whether the <code dir="auto">request.*()</code> function can return values from times <em>beyond</em> those of the historical bars it executes on. In other words, the <code dir="auto">lookahead</code> paremeter determines whether the requested data may contain <em>lookahead bias</em> on historical bars.</p>
<p>When requesting data from a lower-timeframe (LTF) context, the <code dir="auto">lookahead</code> parameter determines whether the function requests values from the first or last <em>intrabar</em> (LTF bar) of each chart-timeframe bar.</p>
<p><strong>Programmers should exercise extreme caution when using lookahead in their requests, namely when requesting data from higher timeframes.</strong>
When using <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a> as the <code dir="auto">lookahead</code> value, ensure that it does not compromise the integrity of the script’s logic by leaking <em>future data</em> into historical chart bars.</p>
<p>The following scenarios are cases where enabling lookahead is acceptable in a <code dir="auto">request.*()</code> call:</p>
<ul>
<li>The <code dir="auto">expression</code> in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> references a series with a <em>historical offset</em> (e.g., <code dir="auto">close[1]</code>), which prevents the function from requesting future values that it would <strong>not</strong> have access to on a realtime basis.</li>
<li>The specified <code dir="auto">timeframe</code> in the call is the same as the chart the script executes on, i.e., <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a>.</li>
<li>The function call requests data from an intrabar timeframe, i.e., a timeframe smaller than the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a>. See <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lower-timeframes">this section</a> for more information.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> to leak future data into the past is <strong>misleading</strong> and <strong>not allowed</strong> in script publications. While your script’s results on historical bars may look great due to its seemingly “magical” acquisition of prescience (which it will not be able to reproduce on realtime bars), you will mislead yourself and the users of your script. If you <a href="/pine-script-docs/v5/writing/publishing/">publish your script</a> to share it with others, ensure you <strong>do not mislead users</strong> by accessing future information from a dataset on historical bars.</p></div></aside>
<p>This example demonstrates how the <code dir="auto">lookahead</code> parameter affects the behavior of higher-timeframe data requests and why enabling lookahead in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> without offsetting the <code dir="auto">expression</code> is misleading. The script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> to get the HTF <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> price for the current chart’s symbol in three different ways and <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the resulting series on the chart for comparison.</p>
<p>The first call uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_off">barmerge.lookahead_off</a> (default), and the others use <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>. However, the third <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call also <em>offsets</em> its <code dir="auto">expression</code> using the history-referencing operator <a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a> to avoid leaking future data into the past.</p>
<p>As we see on the chart, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a> of the series requested using <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a> without an offset (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.fuchsia">fuchsia</a> line) shows final HTF <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> prices <em>before</em> they are actually available on historical bars, whereas the other two calls do not:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/9ee5b8c829867533f27207c35240ee2a.webp" width="1348"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`lookahead` demo", overlay = true)

//@variable The timeframe to request the data from.
string timeframe = input.timeframe("30", "Timeframe")

//@variable The requested `high` price from the current symbol on the `timeframe` without lookahead bias.
//          On realtime bars, it returns the current `high` of the `timeframe`.
float lookaheadOff = request.security(syminfo.tickerid, timeframe, high, lookahead = barmerge.lookahead_off)

//@variable The requested `high` price from the current symbol on the `timeframe` with lookahead bias.
//          Returns values that should NOT be accessible yet on historical bars.
float lookaheadOn = request.security(syminfo.tickerid, timeframe, high, lookahead = barmerge.lookahead_on)

//@variable The requested `high` price from the current symbol on the `timeframe` without lookahead bias or repainting.
//          Behaves the same on historical and realtime bars.
float lookaheadOnOffset = request.security(syminfo.tickerid, timeframe, high[1], lookahead = barmerge.lookahead_on)

// Plot the values.
plot(lookaheadOff, "High, no lookahead bias", color.new(color.blue, 40), 5)
plot(lookaheadOn, "High with lookahead bias", color.fuchsia, 3)
plot(lookaheadOnOffset, "High, no lookahead bias or repaint", color.aqua, 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 60) : na, title = "Realtime bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The series requested using <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_off">barmerge.lookahead_off</a> has a new historical value at the <em>end</em> of each HTF period, and both series requested using <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a> have new historical data at the <em>start</em> of each period.</li>
<li>On realtime bars, the plot of the series without lookahead (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.blue">blue</a>) and the series with lookahead and no historical offset (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.fuchsia">fuchsia</a>) show the <em>same value</em> (i.e., the HTF period’s unconfirmed <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> price), as no data exists beyond those points to leak into the past. Both of these plots <em>repaint</em> their results after restarting the script’s executions, as <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">realtime</a> bars become <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.ishistory">historical</a> bars.</li>
<li>The series that uses lookahead and a historical offset (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.aqua">aqua</a>) <em>does not</em> repaint its values, as it always references the last <em>confirmed</em> value from the higher timeframe. See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a> section of this page for more information.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>In Pine Script™ v1 and v2, the <code dir="auto">security()</code> function did not include a <code dir="auto">lookahead</code> parameter, but it behaved as it does in later versions of Pine with <code dir="auto">lookahead = barmerge.lookahead_on</code>, meaning that it systematically used data from the future HTF context on historical bars. Therefore, users should <em>exercise caution</em> with Pine v1 or v2 scripts that use HTF <code dir="auto">security()</code> calls unless the function calls contain historical offsets.</p></div></aside>
<h3 class="md-heading" id="dynamic-requests"><a href="#dynamic-requests">Dynamic requests<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A script can define all its <code dir="auto">request.*()</code> functions as <em>dynamic</em> by specifying <code dir="auto">dynamic_requests = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>, or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a> declaration statement. By default, dynamic requests are off.</p>
<p>In contrast to non-dynamic requests, dynamic requests can:</p>
<ul>
<li>Access data from different data feeds using a single <code dir="auto">request.*()</code> instance with <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#series-arguments">“series” arguments</a>.</li>
<li>Execute within the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#in-local-scopes">local scopes</a> of <a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>, <a href="/pine-script-docs/v5/language/loops/">loops</a>, and <a href="/pine-script-docs/v5/concepts/libraries/#library-functions">exported functions</a>.</li>
<li>Execute <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#nested-requests">nested requests</a>.</li>
</ul>
<h4 class="md-heading" id="series-arguments"><a href="#series-arguments">”series” arguments<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Scripts without dynamic requests enabled cannot use “series” arguments for most <code dir="auto">request.*()</code> function parameters, which means the argument values <em>cannot change</em>. The only exception is the <code dir="auto">expression</code> parameter in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a>, which <em>always</em> allows “series” values.</p>
<p>In contrast, when a script allows dynamic requests, all <code dir="auto">request.*()</code> function parameters that define parts of the ticker ID or timeframe of a request accept “series” arguments that <em>can change</em> with each script execution. In other words, with dynamic requests, it’s possible for a single <code dir="auto">request.*()</code> instance to fetch data from <em>different contexts</em> in different executions. Some other optional parameters, such as <code dir="auto">ignore_invalid_symbol</code>, can also accept “series” arguments, allowing additional flexibility in <code dir="auto">request.*()</code> call behaviors.</p>
<p>The following script declares a <code dir="auto">symbolSeries</code> variable that is assigned four different symbol strings in 20-bar cycles, with its value changing after every five bars. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call uses this variable as the <code dir="auto">symbol</code> argument. The script plots the <code dir="auto">requestedClose</code> values, which therefore represent a different symbol’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> prices for each five-bar period.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="566" loading="lazy" src="images/1af1a874ecc413795287dc460f7f1139.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("'series' arguments demo", dynamic_requests = true)
 
//@variable A "series" that cycles through four different symbol strings. Its value changes every five bars.  
string symbolSeries = switch int(bar_index / 5) % 4
    1 =&gt; "NASDAQ:MSFT"
    2 =&gt; "NASDAQ:AMD"
    3 =&gt; "NASDAQ:INTC"
    =&gt;   "AMEX:SPY"

//@variable The requested `close` value from one of the four `symbolSeries` values on the chart's timeframe.
float requestedClose = request.security(symbolSeries, timeframe.period, close)

// Plot the `requestedClose`.
plot(requestedClose, "Requested close", color.purple, 3)

// Draw a label displaying the requested symbol each time the `symbolSeries` changes.
if symbolSeries != symbolSeries[1]
    label.new(bar_index, requestedClose, symbolSeries, textcolor = color.white)</code></div>
<p>Note that:</p>
<ul>
<li>The script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> every time the <code dir="auto">symbolSeries</code> changes, to signify which symbol’s data the <code dir="auto">requestedClose</code> currently represents.</li>
<li>Removing <code dir="auto">dynamic_requests = true</code> from this script’s declaration statement causes a <em>compilation error</em>. Scripts without dynamic requests enabled cannot use “series string” <code dir="auto">symbol</code> arguments in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> calls.</li>
</ul>
<p>An important limitation is that when using dynamic <code dir="auto">request.*()</code> calls with “series” arguments or within <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#in-local-scopes">local scopes</a>, scripts must request all required datasets while executing on <strong>historical bars</strong>. All <code dir="auto">request.*()</code> calls on <em>realtime</em> bars can retrieve data from the datasets that the script previously accessed on historical bars, but they <strong>cannot</strong> request a new context or evaluate a new expression.</p>
<p>To illustrate this limitation, let’s revisit the above script. Notice that it requests <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> data for all four symbols on the chart’s timeframe during its historical executions. The external datasets for those four contexts are the <strong>only</strong> ones that any <code dir="auto">request.*()</code> call on realtime bars can access.</p>
<p>Below, we changed the <code dir="auto">timeframe</code> argument in the script’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call to specify that it requests <code dir="auto">symbolSeries</code> data from the chart’s timeframe on historical bars and the “240” (240 minutes = 4H) timeframe on realtime bars. This version raises a runtime error on the first realtime tick, if it is run on any timeframe other than the 4H timeframe, because it <strong>cannot</strong> access the 4H data feeds without requesting them on historical bars first:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Invalid realtime request demo", dynamic_requests = true)
 
//@variable A "series" that cycles through four different symbol strings. Its value changes every five bars.  
string symbolSeries = switch int(bar_index / 5) % 4
    1 =&gt; "NASDAQ:MSFT"
    2 =&gt; "NASDAQ:AMD"
    3 =&gt; "NASDAQ:INTC"
    =&gt;   "AMEX:SPY"

// Request the `close` of the `symbolSeries` from the chart's timeframe on historical bars and the "240" (4H) timeframe 
// on realtime bars. Causes a runtime error on the first realtime tick because the script did not previously access 
// data from the "240" timeframe on any historical bars. 
float requestedClose = request.security(symbolSeries, barstate.isrealtime ? "240" : timeframe.period, close)

// Plot the `requestedClose`.
plot(requestedClose, "Requested close", color.purple, 3)

// Draw a label displaying the requested symbol each time the `symbolSeries` changes.
if symbolSeries != symbolSeries[1]
    label.new(bar_index, requestedClose, symbolSeries, textcolor = color.white)</code></div>
<h4 class="md-heading" id="in-local-scopes"><a href="#in-local-scopes">In local scopes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When scripts do not allow dynamic requests, all <code dir="auto">request.*()</code> calls execute once on <em>every</em> bar or realtime tick, which prevents their use within most local scopes. The only exception is for <code dir="auto">request.*()</code> calls in the scopes of <em>non-exported</em> <a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and <a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>, because the Pine Script™ compiler extracts such calls into the <em>global scope</em> during translation.</p>
<p>Scripts that allow dynamic requests <em>do not</em> restrict the execution of <code dir="auto">request.*()</code> calls to the global scope. They can call <code dir="auto">request.*()</code> functions directly within the scopes of <a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> and <a href="/pine-script-docs/v5/language/loops/">loops</a>, meaning that each <code dir="auto">request.*()</code> instance in the code can activate zero, one, or several times on each script execution.</p>
<p>The following example uses a single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> instance within a loop to request data from multiple forex data feeds. The script declares an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of <code dir="auto">symbols</code> on the first chart bar, which it iterates through on all bars using a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop. Each loop iteration calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> to retrieve the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a> value for one of the symbols and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">pushes</a> the result into the <code dir="auto">requestedData</code> array. After the loop terminates, the script calculates the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">average</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.max">maximum</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">minimum</a> values from the <code dir="auto">requestedData</code> array and plots those values on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="596" loading="lazy" src="images/de48dda7ec8b5950f79c539e7eeb24df.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("In local scopes demo", dynamic_requests = true, format = format.volume)

//@variable An array of "string" values representing different symbols to request. 
var array&lt;string&gt; symbols = array.from(
     "EURUSD", "USDJPY", "GBPUSD", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD", "EURJPY", "GBPJPY", "EURGBP"
 )

//@variable An array containing the data retrieved for each requested symbol.  
array&lt;float&gt; requestedData = array.new&lt;float&gt;()

// Retrieve `volume` data for each symbol in the `symbols` array and push the results into the `requestedData` array. 
for symbol in symbols
    float data = request.security("OANDA:" + symbol, timeframe.period, volume)
    requestedData.push(data)

// Calculate the average, maximum, and minimum tick volume in the `requestedData`.
float avgVolume = requestedData.avg()
float maxVolume = requestedData.max()
float minVolume = requestedData.min()

// Plot the `avgVolume`, `maxVolume`, and `minVolume`. 
plot(avgVolume, "Average volume", color.gray,   3)
plot(maxVolume, "Highest volume", color.teal,   3)
plot(minVolume, "Lowest volume",  color.maroon, 3)</code></div>
<p>Notice that the <code dir="auto">expression</code> argument in the above example (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>) is <em>loop-invariant</em>, i.e., it does not change on any loop iteration. When using <code dir="auto">request.*()</code> calls within a loop, all parameters defining parts of the requested <em>context</em> can accept arguments that depend on variables from the loop’s header or mutable variables that change within the loop’s local scope. However, a <code dir="auto">request.*()</code> call’s evaluated expression <strong>cannot</strong> depend on the values of those variables.</p>
<p>Here, we modified the above script to use the <em>second form</em> of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop statement, which creates a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> containing the index and value of each element in the <code dir="auto">symbols</code> array. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> instance in this version uses the index (<code dir="auto">i</code>) in its <code dir="auto">expression</code> argument, resulting in a <em>compilation error</em>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop-dependent expression demo", dynamic_requests = true, format = format.volume)

//@variable An array of "string" values representing different symbols to request. 
var array&lt;string&gt; symbols = array.from(
     "EURUSD", "USDJPY", "GBPUSD", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD", "EURJPY", "GBPJPY", "EURGBP"
 )

//@variable An array containing the data retrieved for each requested symbol.  
array&lt;float&gt; requestedData = array.new&lt;float&gt;()

// Retrieve `volume` data for each symbol in the `symbols` array, weighted using the element index.
// Causes a compilation error because the `expression` in `request.security()` cannot depend on loop variables 
// or mutable variables that change within the loop's scope. 
for [i, symbol] in symbols
    float data = request.security("OANDA:" + symbol, timeframe.period, volume * (10 - i))
    requestedData.push(data)

// Calculate the average, maximum, and minimum tick volume in the `requestedData`.
float avgVolume = requestedData.avg()
float maxVolume = requestedData.max()
float minVolume = requestedData.min()

// Plot the `avgVolume`, `maxVolume`, and `minVolume`. 
plot(avgVolume, "Average volume", color.gray,   3)
plot(maxVolume, "Highest volume", color.teal,   3)
plot(minVolume, "Lowest volume",  color.maroon, 3)</code></div>
<h4 class="md-heading" id="in-libraries"><a href="#in-libraries">In libraries<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/concepts/libraries/">Libraries</a> with dynamic requests enabled can <em>export</em> <a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and <a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a> that utilize <code dir="auto">request.*()</code> calls within their local scopes, provided that the evaluated expressions <strong>do not</strong> depend on any exported function parameters.</p>
<p>For example, this simple library exports an <code dir="auto">htfPrices()</code> function that requests a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> of confirmed <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> prices using a specified <code dir="auto">tickerID</code> and <code dir="auto">timeframe</code>. If we publish this library, another script can <em>import</em> the function to request higher-timeframe prices without explicitly calling <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
library("DynamicRequests", dynamic_requests = true)

//@function        Requests a tuple containing confirmed HTF OHLC data for a specified `tickerID` and `timeframe`.
//@param tickerID  The ticker identifier to request data for. 
//@param timeframe The timeframe of the requested data.
//@returns         A tuple containing the last confirmed `open`, `high`, `low`, and `close` from the requested context.
export htfPrices(string tickerID, string timeframe) =&gt;
    if timeframe.in_seconds() &gt;= timeframe.in_seconds(timeframe)
        runtime.error("The `timeframe` argument of `getHTFPrices()` must be higher than the chart's timeframe.")
    request.security(tickerID, timeframe, [open[1], high[1], low[1], close[1]], lookahead = barmerge.lookahead_on)</code></div>
<p>Note that:</p>
<ul>
<li>The tuple that the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call includes as the <code dir="auto">expression</code> argument <em>does not</em> depend on the <code dir="auto">htfPrices()</code> parameters.</li>
<li>The <code dir="auto">htfPrices()</code> function raises a custom <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error">runtime error</a> when the <code dir="auto">timeframe</code> argument is not higher than the chart’s timeframe. See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#higher-timeframes">higher timeframes</a> section for more information.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call uses <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_on">barmerge.lookahead_on</a> and offsets each item in the tuple by one bar. This is the only recommended method to <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">avoid repainting</a>.</li>
</ul>
<h4 class="md-heading" id="nested-requests"><a href="#nested-requests">Nested requests<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Scripts that include <code dir="auto">dynamic_requests = true</code> can execute <em>nested requests</em>, i.e., <code dir="auto">request.*()</code> calls that dynamically evaluate other <code dir="auto">request.*()</code> calls that their <code dir="auto">expression</code> arguments depend on.</p>
<p>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> call uses an empty string or <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a> for its <code dir="auto">symbol</code> argument, or if it uses an empty string or <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a> for the <code dir="auto">timeframe</code> argument, the requested ticker ID or timeframe <em>depends</em> on the context where the call executes. This context is normally the ticker ID or timeframe of the chart that the script is running on. However, if such a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> function call is evaluated by another <code dir="auto">request.*()</code> call, the nested request <em>inherits</em> that <code dir="auto">request.*()</code> call’s ticker ID or timeframe information.</p>
<p>For example, the script below contains two <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> calls and uses <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> to display their results. The first call uses empty strings as its <code dir="auto">symbol</code> and <code dir="auto">timeframe</code> arguments, meaning that the requested context depends on where the call executes. It evaluates a concatenated string containing the call’s requested ticker ID and timeframe, and the script assigns its result to the <code dir="auto">info1</code> variable.</p>
<p>The second call requests data for a specific <code dir="auto">symbol</code> and <code dir="auto">timeframe</code> using the <code dir="auto">info1</code> variable as its <code dir="auto">expression</code> argument. Since the <code dir="auto">info1</code> variable depends on the first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call, the second call evaluates the first call <em>within</em> its own context. Therefore, the first call adopts the second call’s ticker ID and timeframe while executing within that context, resulting in a different returned value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/2fc798e2a086de6b71af9449f1c19cb3.webp" width="1230"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Nested requests demo", dynamic_requests = true)

//@variable A concatenated string containing the current `syminfo.tickerid` and `timeframe.period`.
string info1 = request.security("", "", syminfo.tickerid + "_" + timeframe.period)
//@variable A concatenated string representing the `info1` value calculated within the "NASDAQ:AAPL, 240" context.
//          This call evaluates the call on line 5 within its context to determine its result because the script 
//          allows dynamic requests.
string info2 = request.security("NASDAQ:AAPL", "240", info1)

// Log the results from both calls in the Pine Logs pane on the last historical bar. 
if barstate.islastconfirmedhistory
    log.info("First request: {0}", info1)
    log.info("Second request: {0}", info2)</code></div>
<p>This script allows the execution of the first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call within the context of the second call because we included <code dir="auto">dynamic_requests = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration statement. Without dynamic requests enabled, the script evaluates each call <em>independently</em>, passing the first call’s calculated value directly into the second call rather than executing the first call within the second context. Consequently, the second call’s returned value is the <em>same</em> as the first call’s value, as we see below:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/4d998d068341632b24a106597f5919c1.webp" width="1230"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Nested requests demo")

//@variable A concatenated string containing the current `syminfo.tickerid` and `timeframe.period`.
string info1 = request.security("", "", syminfo.tickerid + "_" + timeframe.period)
//@variable The same value as `info1`. This call does not evalutate the call on line 5 because dynamic requests aren't 
//          allowed. Instead, it only uses the value of `info1`, meaning its result does not change. 
string info2 = request.security("NASDAQ:AAPL", "240", info1)

// Log the results from both calls in the Pine Logs pane on the last historical bar. 
if barstate.islastconfirmedhistory
    log.info("First request: {0}", info1)
    log.info("Second request: {0}", info2)</code></div>
<h2 class="md-heading" id="data-feeds"><a href="#data-feeds">Data feeds<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView’s data providers supply different data feeds that scripts
can access to retrieve information about an instrument, including:</p>
<ul>
<li>Intraday historical data (for timeframes &lt; 1D)</li>
<li>End-of-day (EOD) historical data (for timeframes &gt;= 1D)</li>
<li>Realtime data (which may be delayed, depending on your account type
and extra data services)</li>
<li>Extended hours data</li>
</ul>
<p>Not all of these data feed types exist for every instrument. For
example, the symbol “BNC:BLX” only has EOD data available.</p>
<p>For some instruments with intraday and EOD historical feeds, volume data
may not be the same since some trades (block trades, OTC trades, etc.)
may only be available at the <em>end</em> of the trading day. Consequently, the
EOD feed will include this volume data, but the intraday feed will not.
Differences between EOD and intraday volume feeds are almost nonexistent
for instruments such as cryptocurrencies, but they are commonplace in
stocks.</p>
<p>Slight price discrepancies may also occur between EOD and intraday
feeds. For example, the high value on one EOD bar may not match any
intraday high values supplied by the data provider for that day.</p>
<p>Another distinction between EOD and intraday data feeds is that EOD
feeds do not contain information from <em>extended hours</em>.</p>
<p>When retrieving information on realtime bars with <code dir="auto">request.*()</code>
functions, it’s important to note that historical and realtime data
reported for an instrument often rely on <em>different</em> data feeds. A
broker/exchange may retroactively modify values reported on realtime
bars, which the data will only reflect after refreshing the chart or
restarting the script.</p>
<p>Another important consideration is that the chart’s data feeds and
feeds requested from providers by the script are managed by
<em>independent</em>, concurrent processes. Consequently, in some <em>rare</em> cases,
it’s possible for races to occur where requested results temporarily
fall out of synch with the chart on a realtime bar, which a script
retroactively adjusts after restarting its executions.</p>
<p>These points may account for variations in the values retrieved by
<code dir="auto">request.*()</code> functions when requesting data from other contexts. They
may also result in discrepancies between data received on realtime bars
and historical bars. There are no steadfast rules about the variations
one may encounter in their requested data feeds.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>As a rule, TradingView <em>does not</em> generate data; it relies on its data
providers for the information displayed on charts and accessed by
scripts.</p></div></aside>
<p>When using data feeds requested from other contexts, it’s also crucial
to consider the <em>time axis</em> differences between the chart the script
executes on and the requested feeds since <code dir="auto">request.*()</code> functions adapt
the returned series to the chart’s time axis. For example, requesting
“BTCUSD” data on the “SPY” chart with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
will only show new values when the “SPY” chart has new data as well.
Since “SPY” is not a 24-hour symbol, the “BTCUSD” data returned will
contain gaps that are otherwise not present when viewing its chart
directly.</p>
<h2 class="md-heading" id="requestsecurity"><a href="#requestsecurity">`request.security()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function allows scripts to request data from other contexts than the
chart the script executes on, such as:</p>
<ul>
<li>Other symbols, including <a href="https://www.tradingview.com/support/solutions/43000502298/">spread
symbols</a></li>
<li>Other timeframes (see our User Manual’s page on
<a href="/pine-script-docs/v5/concepts/timeframes/">Timeframes</a> to learn
about timeframe specifications in Pine Script™)</li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#custom-contexts">Custom contexts</a>, including alternative sessions, price adjustments,
chart types, etc. using <code dir="auto">ticker.*()</code> functions</li>
</ul>
<p>This is the function’s signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.security(symbol, timeframe, expression, gaps, lookahead, ignore_invalid_symbol, currency, calc_bars_count) → series &lt;type&gt;</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">symbol</code> value is the ticker identifier representing the symbol to
fetch data from. This parameter accepts values in any of the following
formats:</p>
<ul>
<li>A “string” representing a symbol (e.g., “IBM” or “EURUSD”) or
an <em>“Exchange:Symbol” pair</em> (e.g., “NYSE:IBM” or
“OANDA:EURUSD”). When the value does not contain an exchange
prefix, the function selects the exchange automatically. We
recommend specifying the exchange prefix when possible for
consistent results. Users can also pass an empty string to this
parameter, which prompts the function to use the current chart’s
symbol.</li>
<li>A “string” representing a <a href="https://www.tradingview.com/support/solutions/43000502298/">spread
symbol</a>
(e.g., “AMD/INTC”). Note that “Bar Replay” mode does not work
with these symbols.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.ticker">syminfo.ticker</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>
built-in variables, which return the symbol or the
“Exchange:Symbol” pair that the current chart references. We
recommend using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>
to avoid ambiguity unless the exchange information does not matter
in the data request. For more information on <code dir="auto">syminfo.*</code> variables,
see
<a href="/pine-script-docs/v5/concepts/chart-information/#symbol-information">this</a> section of our
<a href="/pine-script-docs/v5/concepts/chart-information/">Chart information</a> page.</li>
<li>A custom ticker identifier created using <code dir="auto">ticker.*()</code> functions.
Ticker IDs constructed from these functions may contain additional
settings for requesting data using
<a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard chart</a> calculations, alternative sessions, and other contexts.
See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#custom-contexts">Custom contexts</a> section for more information.</li>
</ul>
<p>The <code dir="auto">timeframe</code> value specifies the timeframe of the requested data.
This parameter accepts “string” values in our
<a href="/pine-script-docs/v5/concepts/timeframes/#timeframe-string-specifications">timeframe specification</a> format (e.g., a value of “1D” represents the daily
timeframe). To request data from the same timeframe as the chart the
script executes on, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a>
variable or an empty string.</p>
<p>The <code dir="auto">expression</code> parameter of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function determines the data it retrieves from the specified context.
This versatile parameter accepts “series” values of
<a href="/pine-script-docs/v5/language/type-system/#int">int</a>,
<a href="/pine-script-docs/v5/language/type-system/#float">float</a>,
<a href="/pine-script-docs/v5/language/type-system/#bool">bool</a>,
<a href="/pine-script-docs/v5/language/type-system/#color">color</a>,
<a href="/pine-script-docs/v5/language/type-system/#string">string</a>,
and <a href="/pine-script-docs/v5/language/type-system/#chart-points">chart.point</a> types. It can also accept
<a href="/pine-script-docs/v5/language/type-system/#tuples">tuples</a>,
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>,
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>, and the outputs of function and
<a href="/pine-script-docs/v5/language/methods/">method</a> calls. For more
details on the data one can retrieve, see the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestable-data">Requestable data</a> section below.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>When using the value from an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a>
call in the <code dir="auto">expression</code> argument and the input references a series from
another indicator, <code dir="auto">request.*()</code> functions calculate that value’s
results using the <strong>chart’s symbol</strong>, regardless of the <code dir="auto">symbol</code>
argument supplied, since they cannot evaluate the scopes required by an
external series. We therefore do not recommend attempting to request
external source input data from other contexts.</p></div></aside>
<h3 class="md-heading" id="timeframes"><a href="#timeframes">Timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can request data from any available timeframe, regardless of
the chart the script executes on. The timeframe of the data retrieved
depends on the <code dir="auto">timeframe</code> argument in the function call, which may
represent a higher timeframe (e.g., using “1D” as the <code dir="auto">timeframe</code>
value while running the script on an intraday chart) or the chart’s
timeframe (i.e., using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a>
or an empty string as the <code dir="auto">timeframe</code> argument).</p>
<p>Scripts can also request <em>limited</em> data from lower timeframes with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
(e.g., using “1” as the <code dir="auto">timeframe</code> argument while running the script
on a 60-minute chart). However, we don’t typically recommend using this
function for LTF data requests. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function is more optimal for such cases.</p>
<h4 class="md-heading" id="higher-timeframes"><a href="#higher-timeframes">Higher timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Most use cases of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
involve requesting data from a timeframe higher than or the same as the
chart timeframe. For example, this script retrieves the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>
price from a requested <code dir="auto">higherTimeframe</code>. It
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the resulting series
on the chart alongside the current chart’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a> for
comparison:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/62625446f086131bbdfe6bb240bb71f4.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Higher timeframe security demo", overlay = true)

//@variable The higher timeframe to request data from.
string higherTimeframe = input.timeframe("240", "Higher timeframe")

//@variable The `hl2` value from the `higherTimeframe`. Combines lookahead with an offset to avoid repainting.
float htfPrice = request.security(syminfo.tickerid, higherTimeframe, hl2[1], lookahead = barmerge.lookahead_on)

// Plot the `hl2` from the chart timeframe and the `higherTimeframe`.
plot(hl2, "Current timeframe HL2", color.teal, 2)
plot(htfPrice, "Higher timeframe HL2", color.purple, 3)</code></div>
<p>Note that:</p>
<ul>
<li>We’ve included an offset to the <code dir="auto">expression</code> argument and used
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to ensure the series returned behaves the same on historical and
realtime bars. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a> section for more information.</li>
</ul>
<p>Notice that in the above example, it is possible to select a
<code dir="auto">higherTimeframe</code> value that actually represents a <em>lower timeframe</em>
than the one the chart uses, as the code does not prevent it. When
designing a script to work specifically with higher timeframes, we
recommend including conditions to prevent it from accessing lower
timeframes, especially if you intend to
<a href="/pine-script-docs/v5/writing/publishing/">publish</a> it.</p>
<p>Below, we’ve added an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure to our previous example that raises a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error">runtime
error</a>
when the <code dir="auto">higherTimeframe</code> input represents a timeframe smaller than the
chart timeframe, effectively preventing the script from requesting LTF
data:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/9bba462a7745d5eea8aeb0875ab94cbb.webp" width="804"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Higher timeframe security demo", overlay = true)

//@variable The higher timeframe to request data from.
string higherTimeframe = input.timeframe("240", "Higher timeframe")

// Raise a runtime error when the `higherTimeframe` is smaller than the chart's timeframe.
if timeframe.in_seconds() &gt; timeframe.in_seconds(higherTimeframe)
    runtime.error("The requested timeframe is smaller than the chart's timeframe. Select a higher timeframe.")

//@variable The `hl2` value from the `higherTimeframe`. Combines lookahead with an offset to avoid repainting.
float htfPrice = request.security(syminfo.tickerid, higherTimeframe, hl2[1], lookahead = barmerge.lookahead_on)

// Plot the `hl2` from the chart timeframe and the `higherTimeframe`.
plot(hl2, "Current timeframe HL2", color.teal, 2)
plot(htfPrice, "Higher timeframe HL2", color.purple, 3)</code></div>
<h4 class="md-heading" id="lower-timeframes"><a href="#lower-timeframes">Lower timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Although the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function is intended to operate on timeframes greater than or equal to
the chart timeframe, it <em>can</em> request data from lower timeframes as
well, with limitations. When calling this function to access a lower
timeframe, it will evaluate the <code dir="auto">expression</code> from the LTF context.
However, it can only return the results from a <em>single</em> intrabar (LTF
bar) on each chart bar.</p>
<p>The intrabar that the function returns data from on each historical
chart bar depends on the <code dir="auto">lookahead</code> value in the function call. When
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>,
it will return the <em>first</em> available intrabar from the chart period.
When using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_off">barmerge.lookahead_off</a>,
it will return the <em>last</em> intrabar from the chart period. On realtime
bars, it returns the last available value of the <code dir="auto">expression</code> from the
timeframe, regardless of the <code dir="auto">lookahead</code> value, as the realtime intrabar
information retrieved by the function is not yet sorted.</p>
<p>This script retrieves
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
data from the valid timeframe closest to a fourth of the size of the
chart timeframe. It makes two calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
with different <code dir="auto">lookahead</code> values. The first call uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
to access the first intrabar value in each chart bar. The second uses
the default <code dir="auto">lookahead</code> value
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_off">barmerge.lookahead_off</a>),
which requests the last intrabar value assigned to each chart bar. The
script <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the outputs of
both calls on the chart to compare the difference:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="552" loading="lazy" src="images/be38596d79a05cf21a28df74cf533eb4.webp" width="1258"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Lower timeframe security demo", overlay = true)

//@variable The valid timeframe closest to 1/4 the size of the chart timeframe.
string lowerTimeframe = timeframe.from_seconds(int(timeframe.in_seconds() / 4))

//@variable The `close` value on the `lowerTimeframe`. Represents the first intrabar value on each chart bar.
float firstLTFClose = request.security(syminfo.tickerid, lowerTimeframe, close, lookahead = barmerge.lookahead_on)
//@variable The `close` value on the `lowerTimeframe`. Represents the last intrabar value on each chart bar.
float lastLTFClose = request.security(syminfo.tickerid, lowerTimeframe, close)

// Plot the values.
plot(firstLTFClose, "First intrabar close", color.teal, 3)
plot(lastLTFClose, "Last intrabar close", color.purple, 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 70) : na, title = "Realtime background highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The script determines the value of the <code dir="auto">lowerTimeframe</code> by
calculating the number of seconds in the chart timeframe with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a>,
then dividing by four and converting the result to a
<a href="/pine-script-docs/v5/concepts/timeframes/#timeframe-string-specifications">valid timeframe string</a> via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a>.</li>
<li>The plot of the series without lookahead
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.purple">purple</a>)
aligns with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value on the chart timeframe, as this is the last intrabar value
in the chart bar.</li>
<li>Both
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
calls return the <em>same</em> value (the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>)
on each
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">realtime</a>
bar, as shown on the bars with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_color.orange">orange</a>
background.</li>
<li>Scripts can retrieve up to 200,000 intrabars from a lower-timeframe context. The number of chart bars with available intrabar data varies with the requested lower timeframe, the <code dir="auto">calc_bars_count</code> value, and the user’s plan. See <a href="/pine-script-docs/v5/writing/limitations/#intrabars">this</a> section of the <a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>While scripts can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve the values from a <em>single</em> intrabar on each chart bar, which
might provide utility in some unique cases, we recommend using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function for intrabar analysis when possible, as it returns an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing data from <em>all</em> available intrabars within a chart bar. See
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity_lower_tf">this section</a> to learn more.</p></div></aside>
<h3 class="md-heading" id="requestable-data"><a href="#requestable-data">Requestable data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function is quite versatile, as it can retrieve values of any
fundamental type (<a href="/pine-script-docs/v5/language/type-system/#int">int</a>, <a href="/pine-script-docs/v5/language/type-system/#float">float</a>, <a href="/pine-script-docs/v5/language/type-system/#bool">bool</a>, <a href="/pine-script-docs/v5/language/type-system/#color">color</a>, or <a href="/pine-script-docs/v5/language/type-system/#string">string</a>). It can also request the IDs of data structures and
built-in or
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> that reference fundamental types. The data this function
requests depends on its <code dir="auto">expression</code> parameter, which accepts any of the
following arguments:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#built-in-variables-and-functions">Built-in variables and function calls</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#calculated-variables">Variables calculated by the script</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">Tuples</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#user-defined-functions">Calls to user-defined functions</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#chart-points">Chart points</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#collections">Collections</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#user-defined-types">User-defined types</a></li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function duplicates the scopes and operations required by the
<code dir="auto">expression</code> to calculate its requested values in another context, which
elevates runtime memory consumption. Additionally, the extra scopes
produced by each call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
count toward the script’s <em>compilation limits</em>. See the
<a href="/pine-script-docs/v5/writing/limitations/#scope-count">Scope count</a> section of the
<a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for
more information.</p></div></aside>
<h4 class="md-heading" id="built-in-variables-and-functions"><a href="#built-in-variables-and-functions">Built-in variables and functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>A frequent use case of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
is requesting the output of a built-in variable or
function/<a href="/pine-script-docs/v5/language/methods/">method</a> call from
another symbol or timeframe.</p>
<p>For example, suppose we want to calculate the 20-bar
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">SMA</a>
of a symbol’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>
price from the daily timeframe while on an intraday chart. We can
accomplish this with a single line of code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float ma = request.security(syminfo.tickerid, "1D", ta.sma(ohlc4, 20))</code></div>
<p>The above line calculates the value of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(ohlc4,
20)</a>
on the current symbol from the daily timeframe.</p>
<p>It’s important to note that newcomers to Pine may sometimes confuse the
above line of code as being equivalent to the following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float ma = ta.sma(request.security(syminfo.tickerid, "1D", ohlc4), 20)</code></div>
<p>However, this line will return an entirely <em>different</em> result. Rather
than requesting a 20-bar SMA from the daily timeframe, it requests the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>
price from the daily timeframe and calclates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
of the results over 20 <strong>chart bars</strong>.</p>
<p>In essence, when the intention is to request the results of an
expression from other contexts, pass the expression <em>directly</em> to the
<code dir="auto">expression</code> parameter in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call, as demonstrated in the initial example.</p>
<p>Let’s expand on this concept. The script below calculates a
multi-timeframe (MTF) ribbon of moving averages, where each moving
average in the ribbon calculates over the same number of bars on its
respective timeframe. Each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(close,
length)</a>
as its <code dir="auto">expression</code> argument to return a <code dir="auto">length</code>-bar SMA from the
specified timeframe:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/71dbe06f93e60b95b602cf7650fb470b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting built-ins demo", "MTF Ribbon", true)

//@variable The length of each moving average.
int length = input.int(20, "Length", 1)

//@variable The number of seconds in the chart timeframe.
int chartSeconds = timeframe.in_seconds()

// Calculate the higher timeframes closest to 2, 3, and 4 times the size of the chart timeframe.
string htf1 = timeframe.from_seconds(chartSeconds * 2)
string htf2 = timeframe.from_seconds(chartSeconds * 3)
string htf3 = timeframe.from_seconds(chartSeconds * 4)

// Calculate the `length`-bar moving averages from each timeframe.
float chartAvg = ta.sma(ohlc4, length)
float htfAvg1  = request.security(syminfo.tickerid, htf1, ta.sma(ohlc4, length))
float htfAvg2  = request.security(syminfo.tickerid, htf2, ta.sma(ohlc4, length))
float htfAvg3  = request.security(syminfo.tickerid, htf3, ta.sma(ohlc4, length))

// Plot the results.
plot(chartAvg, "Chart timeframe SMA", color.red, 3)
plot(htfAvg1, "Double timeframe SMA", color.orange, 3)
plot(htfAvg2, "Triple timeframe SMA", color.green, 3)
plot(htfAvg3, "Quadruple timeframe SMA", color.blue, 3)

// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.aqua, 70) : na, title = "Realtime highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The script calculates the ribbon’s higher timeframes by
multiplying the chart’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a>
value by 2, 3, and 4, then converting each result into a
<a href="/pine-script-docs/v5/concepts/timeframes/#timeframe-string-specifications">valid timeframe string</a> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a>.</li>
<li>Instead of calling
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
within each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call, one could use the <code dir="auto">chartAvg</code> variable as the <code dir="auto">expression</code>
in each call to achieve the same result. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#calculated-variables">next section</a> for more information.</li>
<li>On realtime bars, this script also tracks <em>unconfirmed</em> SMA
values from each higher timeframe. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#historical-and-realtime-behavior">Historical and realtime behavior</a> section to learn more.</li>
</ul>
<h4 class="md-heading" id="calculated-variables"><a href="#calculated-variables">Calculated variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <code dir="auto">expression</code> parameter of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
accepts variables declared in the global scope, allowing scripts to
evaluate their variables’ calculations from other contexts without
redundantly listing the operations in each function call.</p>
<p>For example, one can declare the following variable:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">priceReturn = (close - close[1]) / close[1]</code></div>
<p>and execute the variable’s calculation from another context with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">requestedReturn = request.security(symbol, timeframe.period, priceReturn)</code></div>
<p>The function call in the line above will return the result of the
<code dir="auto">priceReturn</code> calculation on another <code dir="auto">symbol</code>’s data as a series
adapted to the current chart, which the script can display directly on
the chart or utilize in additional operations.</p>
<p>The following example compares the price returns of the current chart’s
symbol and another specified <code dir="auto">symbol</code>. The script declares the
<code dir="auto">priceReturn</code> variable from the chart’s context, then uses that
variable in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to evaluate its calculation on another <code dir="auto">symbol</code>. It then calculates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.correlation">correlation</a>
between the <code dir="auto">priceReturn</code> and <code dir="auto">requestedReturn</code> and
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the result on the
chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/27bd33a6c03ee9aaab8403bac2f1711b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting calculated variables demo", "Price return correlation")

//@variable The symbol to compare to the chart symbol.
string symbol = input.symbol("SPY", "Symbol to compare")
//@variable The number of bars in the calculation window.
int length = input.int(60, "Length", 1)

//@variable The close-to-close price return.
float priceReturn = (close - close[1]) / close[1]
//@variable The close-to-close price return calculated on another `symbol`.
float requestedReturn = request.security(symbol, timeframe.period, priceReturn)

//@variable The correlation between the `priceReturn` and `requestedReturn` over `length` bars.
float correlation = ta.correlation(priceReturn, requestedReturn, length)
//@variable The color of the correlation plot.
color plotColor = color.from_gradient(correlation, -1, 1, color.purple, color.orange)

// Plot the correlation value.
plot(correlation, "Correlation", plotColor, style = plot.style_area)</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call executes the same calculation used in the <code dir="auto">priceReturn</code>
declaration, except it uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values fetched from the input <code dir="auto">symbol</code>.</li>
<li>The script colors the plot with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient">gradient</a>
based on the <code dir="auto">correlation</code> value. To learn more about color
gradients in Pine, see
<a href="/pine-script-docs/v5/concepts/colors/#colorfrom_gradient">this</a> section of our User Manual’s page on
<a href="/pine-script-docs/v5/concepts/colors/">colors</a>.</li>
</ul>
<h4 class="md-heading" id="tuples"><a href="#tuples">Tuples<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/type-system/#tuples">Tuples</a> in Pine
Script™ are comma-separated sets of expressions enclosed in brackets
that can hold multiple values of any available type. We use tuples when
creating functions or other local blocks that return more than one
value.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can accept a tuple as its <code dir="auto">expression</code> argument, allowing
scripts to request multiple series of different types using a single
function call. The expressions within requested tuples can be of any
type outlined throughout the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestable-data">Requestable data</a> section of this page, excluding other tuples.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The combined size of all tuples returned by <code dir="auto">request.*()</code> calls in a
script cannot exceed 127 elements. See
<a href="/pine-script-docs/v5/writing/limitations/#tuple-element-limit">this</a> section of the
<a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for
more information.</p></div></aside>
<p>Tuples are particularly handy when a script needs to retrieve more than
one value from a specific context.</p>
<p>For example, this script calculates the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentrank">percent
rank</a>
of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price over <code dir="auto">length</code> bars and assigns the expression to the <code dir="auto">rank</code>
variable. It then calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to request a tuple containing the <code dir="auto">rank</code>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.crossover">ta.crossover(rank,
50)</a>,
and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.crossunder">ta.crossunder(rank,
50)</a>
values from the specified <code dir="auto">timeframe</code>. The script
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the <code dir="auto">requestedRank</code>
and uses the <code dir="auto">crossOver</code> and <code dir="auto">crossUnder</code> “bool” values within
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
to conditionally highlight the chart pane’s background:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/26363b18cfd5ea5450e4fc376cd23f16.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting tuples demo", "Percent rank cross")

//@variable The timeframe of the request.
string timeframe = input.timeframe("240", "Timeframe")
//@variable The number of bars in the calculation.
int length = input.int(20, "Length")

//@variable The previous bar's percent rank of the `close` price over `length` bars.
float rank = ta.percentrank(close, length)[1]

// Request the `rank` value from another `timeframe`, and two "bool" values indicating the `rank` from the `timeframe`
// crossed over or under 50.
[requestedRank, crossOver, crossUnder] = request.security(
     syminfo.tickerid, timeframe, [rank, ta.crossover(rank, 50), ta.crossunder(rank, 50)],
     lookahead = barmerge.lookahead_on
 )

// Plot the `requestedRank` and create a horizontal line at 50.
plot(requestedRank, "Percent Rank", linewidth = 3)
hline(50, "Cross line", linewidth = 2)
// Highlight the background of all bars where the `timeframe`'s `crossOver` or `crossUnder` value is `true`.
bgcolor(crossOver ? color.new(color.green, 50) : crossUnder ? color.new(color.red, 50) : na)</code></div>
<p>Note that:</p>
<ul>
<li>We’ve offset the <code dir="auto">rank</code> variable’s expression by one bar using
the history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
and included
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call to ensure the values on realtime bars do not repaint after
becoming historical bars. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a> section for more information.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call returns a tuple, so we use a <em>tuple declaration</em> to declare
the <code dir="auto">requestedRank</code>, <code dir="auto">crossOver</code>, and <code dir="auto">crossUnder</code> variables. To
learn more about using tuples, see
<a href="/pine-script-docs/v5/language/type-system/#tuples">this section</a> of our User Manual’s
<a href="/pine-script-docs/v5/language/type-system/">Type system</a>
page.</li>
</ul>
<h4 class="md-heading" id="user-defined-functions"><a href="#user-defined-functions">User-defined functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/user-defined-functions/">User-defined functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
are custom functions written by users. They allow users to define
sequences of operations associated with an identifier that scripts can
conveniently call throughout their executions (e.g., <code dir="auto">myUDF()</code>).</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can request the results of
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
whose scopes consist of any types outlined throughout this page’s
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestable-data">Requestable data</a> section.</p>
<p>For example, this script contains a user-defined <code dir="auto">weightedBB()</code> function
that calculates Bollinger Bands with the basis average weighted by a
specified <code dir="auto">weight</code> series. The function returns a
<a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> of custom
band values. The script calls the <code dir="auto">weightedBB()</code> as the <code dir="auto">expression</code>
argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve a
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">tuple</a> of band values calculated on the specified <code dir="auto">timeframe</code> and
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the results on the
chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="578" loading="lazy" src="images/e8bda6fb5e0b3bb5b61e81ca3a521e29.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting user-defined functions demo", "Weighted Bollinger Bands", true)

//@variable The timeframe of the request.
string timeframe = input.timeframe("480", "Timeframe")

//@function     Calculates Bollinger Bands with a custom weighted basis.
//@param source The series of values to process.
//@param length The number of bars in the calculation.
//@param mult   The standard deviation multiplier.
//@param weight The series of weights corresponding to each `source` value.
//@returns      A tuple containing the basis, upper band, and lower band respectively.
weightedBB(float source, int length, float mult = 2.0, float weight = 1.0) =&gt;
    //@variable The basis of the bands.
    float ma = math.sum(source * weight, length) / math.sum(weight, length)
    //@variable The standard deviation from the `ma`.
    float dev = 0.0
    // Loop to accumulate squared error.
    for i = 0 to length - 1
        difference = source[i] - ma
        dev += difference * difference
    // Divide `dev` by the `length`, take the square root, and multiply by the `mult`.
    dev := math.sqrt(dev / length) * mult
    // Return the bands.
    [ma, ma + dev, ma - dev]

// Request weighted bands calculated on the chart symbol's prices over 20 bars from the
// last confirmed bar on the `timeframe`.
[basis, highBand, lowBand] = request.security(
     syminfo.tickerid, timeframe, weightedBB(close[1], 20, 2.0, (high - low)[1]), lookahead = barmerge.lookahead_on
 )

// Plot the values.
basisPlot = plot(basis, "Basis", color.orange, 2)
upperPlot = plot(highBand, "Upper", color.teal, 2)
lowerPlot = plot(lowBand, "Lower", color.maroon, 2)
fill(upperPlot, lowerPlot, color.new(color.gray, 90), "Background")</code></div>
<p>Note that:</p>
<ul>
<li>We offset the <code dir="auto">source</code> and <code dir="auto">weight</code> arguments in the
<code dir="auto">weightedBB()</code> call used as the <code dir="auto">expression</code> in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
and used
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
to ensure the requested results reflect the last confirmed
values from the <code dir="auto">timeframe</code> on realtime bars. See
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">this section</a> to learn more.</li>
</ul>
<h4 class="md-heading" id="chart-points"><a href="#chart-points">Chart points<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/type-system/#chart-points">Chart points</a> are reference types that represent coordinates on the chart.
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">Lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>
use
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
objects to set their display locations.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can use the ID of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
instance in its <code dir="auto">expression</code> argument, allowing scripts to retrieve
chart coordinates from other contexts.</p>
<p>The example below requests a tuple of historical
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> from a higher timeframe and uses them to draw
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> on the
chart. The script declares the <code dir="auto">topLeft</code> and <code dir="auto">bottomRight</code> variables
that reference
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_chart.point">chart.point</a>
IDs from the last confirmed bar. It then uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to request a
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">tuple</a> containing the IDs of
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> representing the <code dir="auto">topLeft</code> and <code dir="auto">bottomRight</code> from a
<code dir="auto">higherTimeframe</code>.</p>
<p>When a new bar starts on the <code dir="auto">higherTimeframe</code>, the script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">new
box</a>
using the <code dir="auto">time</code> and <code dir="auto">price</code> coordinates from the <code dir="auto">requestedTopLeft</code> and
<code dir="auto">requestedBottomRight</code> chart points:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/570302e9b67b62837be6b7d02e4a3e0b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting chart points demo", "HTF Boxes", true, max_boxes_count = 500)

//@variable The timeframe to request data from.
string higherTimeframe = input.timeframe("1D", "Timeframe")

// Raise a runtime error if the `higherTimeframe` is smaller than the chart's timeframe.
if timeframe.in_seconds(higherTimeframe) &lt; timeframe.in_seconds(timeframe.period)
    runtime.error("The selected timeframe is too small. Choose a higher timeframe.")

//@variable A `chart.point` containing top-left coordinates from the last confirmed bar.
topLeft = chart.point.now(high)[1]
//@variable A `chart.point` containing bottom-right coordinates from the last confirmed bar.
bottomRight = chart.point.from_time(time_close, low)[1]

// Request the last confirmed `topLeft` and `bottomRight` chart points from the `higherTimeframe`.
[requestedTopLeft, requestedBottomRight] = request.security(
     syminfo.tickerid, higherTimeframe, [topLeft, bottomRight], lookahead = barmerge.lookahead_on
 )

// Draw a new box when a new `higherTimeframe` bar starts.
// The box uses the `time` fields from the `requestedTopLeft` and `requestedBottomRight` as x-coordinates.
if timeframe.change(higherTimeframe)
    box.new(
         requestedTopLeft, requestedBottomRight, color.purple, 3, 
         xloc = xloc.bar_time, bgcolor = color.new(color.purple, 90)
     )</code></div>
<p>Note that:</p>
<ul>
<li>Since this example is designed specifically for higher
timeframes, we’ve included a custom <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error">runtime
error</a>
that the script raises when the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a>
of the <code dir="auto">higherTimeframe</code> is smaller than that of the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">chart’s
timeframe</a>.</li>
</ul>
<h4 class="md-heading" id="collections"><a href="#collections">Collections<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Pine Script™ <em>collections</em> (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>,
and <a href="/pine-script-docs/v5/language/maps/">maps</a>) are data structures
that contain an arbitrary number of elements with specified types. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can retrieve the IDs of
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> whose elements consist of:</p>
<ul>
<li>Fundamental types</li>
<li><a href="/pine-script-docs/v5/language/type-system/#chart-points">Chart points</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#user-defined-types">User-defined types</a> that satisfy the criteria listed in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#user-defined-types">section below</a></li>
</ul>
<p>This example calculates the ratio of a confirmed bar’s high-low range
to the range between the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">highest</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.lowest">lowest</a>
values over 10 bars from a specified <code dir="auto">symbol</code> and <code dir="auto">timeframe</code>. It uses
<a href="/pine-script-docs/v5/language/maps/">maps</a> to hold the values used
in the calculations.</p>
<p>The script creates a <code dir="auto">data</code> map with “string” keys and “float”
values to hold
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">highest</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.lowest">lowest</a>
price values on each bar, which it uses as the <code dir="auto">expression</code> in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to calculate an <code dir="auto">otherData</code> map representing the <code dir="auto">data</code> from the
specified context. It uses the values associated with the “High”,
“Low”, “Highest”, and “Lowest” keys of the <code dir="auto">otherData</code> map to
calculate the <code dir="auto">ratio</code> that it <a href="/pine-script-docs/v5/concepts/plots/">plots</a> in the chart pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/0ae4fda32b9153855f005ab999e284b1.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting collections demo", "Bar range ratio")

//@variable The ticker ID to request data from.
string symbol = input.symbol("", "Symbol")
//@variable The timeframe of the request.
string timeframe = input.timeframe("30", "Timeframe")

//@variable A map with "string" keys and "float" values.
var map&lt;string, float&gt; data = map.new&lt;string, float&gt;()

// Put key-value pairs into the `data` map.
map.put(data, "High", high)
map.put(data, "Low", low)
map.put(data, "Highest", ta.highest(10))
map.put(data, "Lowest", ta.lowest(10))

//@variable A new `map` whose data is calculated from the last confirmed bar of the requested context.
map&lt;string, float&gt; otherData = request.security(symbol, timeframe, data[1], lookahead = barmerge.lookahead_on)

//@variable The ratio of the context's bar range to the max range over 10 bars. Returns `na` if no data is available.
float ratio = na
if not na(otherData)
    ratio := (otherData.get("High") - otherData.get("Low")) / (otherData.get("Highest") - otherData.get("Lowest"))

//@variable A gradient color for the plot of the `ratio`.
color ratioColor = color.from_gradient(ratio, 0, 1, color.purple, color.orange)

// Plot the `ratio`.
plot(ratio, "Range Ratio", ratioColor, 3, plot.style_area)</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call in this script can return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
if no data is available from the specified context. Since one
cannot call <a href="/pine-script-docs/v5/language/methods/">methods</a> on a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
variable when its value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
we’ve added an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure to only calculate a new <code dir="auto">ratio</code> value when <code dir="auto">otherData</code>
references a valid
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
ID.</li>
</ul>
<h4 class="md-heading" id="user-defined-types"><a href="#user-defined-types">User-defined types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/type-system/#user-defined-types">User-defined types (UDTs)</a> are <em>composite types</em> containing an arbitrary number of
<em>fields</em>, which can be of any available type, including other
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can retrieve the IDs of
<a href="/pine-script-docs/v5/language/objects/">objects</a> produced by
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>
from other contexts if their fields consist of:</p>
<ul>
<li>Fundamental types</li>
<li><a href="/pine-script-docs/v5/language/type-system/#chart-points">Chart points</a></li>
<li><a href="/pine-script-docs/v5/language/type-system/#collections">Collections</a> that satisfy the criteria listed in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#collections">section above</a></li>
<li>Other <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a> whose fields consist of any of these types</li>
</ul>
<p>The following example requests an
<a href="/pine-script-docs/v5/language/objects/">object</a> ID using a
specified <code dir="auto">symbol</code> and displays its field values on a chart pane.</p>
<p>The script contains a <code dir="auto">TickerInfo</code> UDT with “string” fields for
<code dir="auto">syminfo.*</code> values, an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
field to store recent “float” price data, and an “int” field to hold
the requested ticker’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
value. It assigns a new <code dir="auto">TickerInfo</code> ID to an <code dir="auto">info</code> variable on every
bar and uses the variable as the <code dir="auto">expression</code> in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve the ID of an <a href="/pine-script-docs/v5/language/objects/">object</a> representing the calculated <code dir="auto">info</code> from the specified
<code dir="auto">symbol</code>.</p>
<p>The script displays the <code dir="auto">requestedInfo</code> object’s <code dir="auto">description</code>,
<code dir="auto">tickerType</code>, <code dir="auto">currency</code>, and <code dir="auto">barIndex</code> values in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
and uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
to display the values from its <code dir="auto">prices</code> array:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/2a6df558fc8c536174d5d5cfcec36a6a.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting user-defined types demo", "Ticker info")

//@variable The symbol to request information from.
string symbol = input.symbol("NASDAQ:AAPL", "Symbol")

//@type               A custom type containing information about a ticker.
//@field description  The symbol's description.
//@field tickerType   The type of ticker.
//@field currency     The symbol's currency.
//@field prices       An array of the symbol's current prices.
//@field barIndex     The ticker's `bar_index`.
type TickerInfo
    string       description
    string       tickerType
    string       currency
    array&lt;float&gt; prices
    int          barIndex

//@variable A `TickerInfo` object containing current data.
info = TickerInfo.new(
     syminfo.description, syminfo.type, syminfo.currency, array.from(open, high, low, close), bar_index
 )
//@variable The `info` requested from the specified `symbol`.
TickerInfo requestedInfo = request.security(symbol, timeframe.period, info)
// Assign a new `TickerInfo` instance to `requestedInfo` if one wasn't retrieved.
if na(requestedInfo)
    requestedInfo := TickerInfo.new(prices = array.new&lt;float&gt;(4))

//@variable A label displaying information from the `requestedInfo` object.
var infoLabel = label.new(
     na, na, "", color = color.purple, style = label.style_label_left, textcolor = color.white, size = size.large
 )
//@variable The text to display inside the `infoLabel`.
string infoText = na(requestedInfo) ? "" : str.format(
     "{0}\nType: {1}\nCurrency: {2}\nBar Index: {3}",
     requestedInfo.description, requestedInfo.tickerType, requestedInfo.currency, requestedInfo.barIndex
 )

// Set the `point` and `text` of the `infoLabel`.
label.set_point(infoLabel, chart.point.now(array.last(requestedInfo.prices)))
label.set_text(infoLabel, infoText)
// Plot candles using the values from the `prices` array of the `requestedInfo`.
plotcandle(
     requestedInfo.prices.get(0), requestedInfo.prices.get(1), requestedInfo.prices.get(2), requestedInfo.prices.get(3),
     "Requested Prices"
 )</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">syminfo.*</code> variables used in this script all return
“simple string” qualified types. However,
<a href="/pine-script-docs/v5/language/objects/">objects</a> in Pine
are <em>always</em> qualified as “series”. Consequently, all values
assigned to the <code dir="auto">info</code> object’s fields automatically adopt the
“series”
<a href="/pine-script-docs/v5/language/type-system/#qualifiers">qualifier</a>.</li>
<li>It is possible for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call to return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
due to differences between the data requested from the <code dir="auto">symbol</code>
and the main chart. This script assigns a new <code dir="auto">TickerInfo</code>
object to the <code dir="auto">requestedInfo</code> in that case to prevent runtime
errors.</li>
</ul>
<h2 class="md-heading" id="requestsecurity_lower_tf"><a href="#requestsecurity_lower_tf">`request.security_lower_tf()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function is an alternative to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
designed for reliably requesting information from lower-timeframe (LTF)
contexts.</p>
<p>While
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
can retrieve data from a <em>single</em> intrabar (LTF bar) in each chart bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
retrieves data from <em>all</em> available intrabars in each chart bar, which
the script can access and use in additional calculations. Each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
call can retrieve up to 100,000 intrabars from a lower timeframe. See
<a href="/pine-script-docs/v5/writing/limitations/#request-calls">this</a>
section of our <a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for more information.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Working with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
involves frequent usage of <a href="/pine-script-docs/v5/language/arrays/">arrays</a> since it always returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
results. We therefore recommend you familiarize yourself with
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> to make the most of
this function in your scripts.</p></div></aside>
<p>Below is the function’s signature, which is similar to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.security_lower_tf(symbol, timeframe, expression, ignore_invalid_symbol, currency, ignore_invalid_timeframe, calc_bars_count) → array&lt;type&gt;</span></div></div></code></pre></figure></div>
<p>This function <strong>only</strong> requests data from timeframes less than or equal
to the chart’s timeframe. If the <code dir="auto">timeframe</code> of the request represents
a higher timeframe than the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">chart’s
timeframe</a>,
the function will either raise a runtime error or return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values depending on the <code dir="auto">ignore_invalid_timeframe</code> argument in the call.
The default value for this parameter is <code dir="auto">false</code>, meaning it raises
an error and halt the script’s executions when attempting to request HTF
data.</p>
<h3 class="md-heading" id="requesting-intrabar-data"><a href="#requesting-intrabar-data">Requesting intrabar data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Intrabar data can provide a script with additional information that may
not be obvious or accessible from solely analyzing data sampled on the
chart’s timerframe. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function can retrieve many data types from an intrabar context.</p>
<p>Before you venture further in this section, we recommend exploring the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestable-data">Requestable data</a> portion of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity">request.security()</a> section above, which provides foundational information about
the types of data one can request. The <code dir="auto">expression</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
accepts most of the same arguments discussed in that section, excluding
direct references to
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> and mutable variables declared in the script’s main scope.
Although it accepts many of the same types of arguments, this function
returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
results, which comes with some differences in interpretation and
handling, as explained below.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>As with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
duplicates the scopes and operations required to calculate the
<code dir="auto">expression</code> from another context. The scopes from
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
increase runtime memory consumption and count toward the script’s
compilation limits. See the
<a href="/pine-script-docs/v5/writing/limitations/#scope-count">Scope count</a> section of the
<a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page to
learn more.</p></div></aside>
<h3 class="md-heading" id="intrabar-data-arrays"><a href="#intrabar-data-arrays">Intrabar data arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Lower timeframes contain more data points than higher timeframes, as new
values come in at a <em>higher frequency</em>. For example, when comparing a
1-minute chart to an hourly chart, the 1-minute chart will have up to 60
times the number of bars per hour, depending on the available data.</p>
<p>To address the fact that multiple intrabars exist within a chart bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
always returns its results as <a href="/pine-script-docs/v5/language/arrays/">arrays</a>. The elements in the returned
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> represent the
<code dir="auto">expression</code> values retrieved from the lower timeframe sorted in
ascending order based on each intrabar’s timestamp.</p>
<p>The <a href="/pine-script-docs/v5/language/type-system/#type-templates">type template</a> assigned to the returned
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> corresponds to the
value types passed in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
call. For example, using an “int” as the <code dir="auto">expression</code> will produce an
<code dir="auto">array&lt;int&gt;</code> instance, a “bool” as the <code dir="auto">expression</code> will produce an
<code dir="auto">array&lt;bool&gt;</code> instance, etc.</p>
<p>The following script uses intrabar information to decompose the chart’s
close-to-close price changes into positive and negative parts. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
to fetch a “float”
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.change">ta.change(close)</a>
values from the <code dir="auto">lowerTimeframe</code> on each chart bar, then accesses all
the array’s elements using a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop to accumulate <code dir="auto">positiveChange</code> and <code dir="auto">negativeChange</code> sums. The
script adds the accumulated values to calculate the <code dir="auto">netChange</code>, then
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the results on the
chart alongside the <code dir="auto">priceChange</code> for comparison:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="574" loading="lazy" src="images/45f83290f1efa287224ec614015db4ae.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Intrabar arrays demo", "Intrabar price changes")

//@variable The lower timeframe of the requested data.
string lowerTimeframe = input.timeframe("1", "Timeframe")

//@variable The close-to-close price change.
float priceChange = ta.change(close)

//@variable An array of `close` values from available intrabars on the `lowerTimeframe`.
array&lt;float&gt; intrabarChanges = request.security_lower_tf(syminfo.tickerid, lowerTimeframe, priceChange)

//@variable The total positive intrabar `close` movement on the chart bar.
float positiveChange = 0.0
//@variable The total negative intrabar `close` movement on the chart bar.
float negativeChange = 0.0

// Loop to calculate totals, starting from the chart bar's first available intrabar.
for change in intrabarChanges
    // Add the `change` to `positiveChange` if its sign is 1, and add to `negativeChange` if its sign is -1.
    switch math.sign(change)
        1  =&gt; positiveChange += change
        -1 =&gt; negativeChange += change

//@variable The sum of `positiveChange` and `negativeChange`. Equals the `priceChange` on bars with available intrabars.
float netChange = positiveChange + negativeChange

// Plot the `positiveChange`, `negativeChange`, and `netChange`.
plot(positiveChange, "Positive intrabar change", color.teal, style = plot.style_area)
plot(negativeChange, "Negative intrabar change", color.maroon, style = plot.style_area)
plot(netChange, "Net intrabar change", color.yellow, 5)
// Plot the `priceChange` to compare.
plot(priceChange, "Chart price change", color.orange, 2)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="/pine-script-docs/v5/concepts/plots/">plots</a> based on
intrabar data may not appear on all available chart bars, as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
can only access up to the most recent 100,000 intrabars
available from the requested context. When executing this
function on a chart bar that doesn’t have accessible intrabar
data, it will return an <em>empty array</em>.</li>
<li>The number of intrabars per chart bar may vary depending on the
data available from the context and the chart the script
executes on. For example, a provider’s 1-minute data feed may
not include data for every minute within the 60-minute timeframe
due to a lack of trading activity over some 1-minute intervals.
To check the number of intrabars retrieved for a chart bar, one
can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a>
on the resulting
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.</li>
<li>If the <code dir="auto">lowerTimeframe</code> value is greater than the chart’s
timeframe, the script will raise a <em>runtime error</em>, as we have
not supplied an <code dir="auto">ignore_invalid_timeframe</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
call.</li>
</ul>
<h3 class="md-heading" id="tuples-of-intrabar-data"><a href="#tuples-of-intrabar-data">Tuples of intrabar data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When passing a tuple or a function call that returns a tuple as the
<code dir="auto">expression</code> argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>,
the result is a tuple of <a href="/pine-script-docs/v5/language/arrays/">arrays</a> with
<a href="/pine-script-docs/v5/language/type-system/#type-templates">type templates</a> corresponding to the types within the argument. For example,
using a <code dir="auto">[float, string, color]</code> tuple as the <code dir="auto">expression</code> will result
in <code dir="auto">[array&lt;float&gt;, array&lt;string&gt;, array&lt;color&gt;]</code> data returned by the
function. Using a tuple <code dir="auto">expression</code> allows a script to fetch several
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> of intrabar data
with a single
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
function call.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The combined size of all tuples returned by <code dir="auto">request.*()</code> calls in a
script is limited to 127 elements. See
<a href="/pine-script-docs/v5/writing/limitations/#tuple-element-limit">this</a> section of the
<a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for
more information.</p></div></aside>
<p>The following example requests OHLC data from a lower timeframe and
visualizes the current bar’s intrabars on the chart using
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/">lines and boxes</a>. The
script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
with the <code dir="auto">[open, high, low, close]</code> tuple as its <code dir="auto">expression</code> to
retrieve a tuple of <a href="/pine-script-docs/v5/language/arrays/">arrays</a>
representing OHLC information from a calculated <code dir="auto">lowerTimeframe</code>. It
then uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
to set line coordinates with the retrieved data and current bar indices
to display the results next to the current chart bar, providing a
“magnified view” of the price movement within the latest candle. It
also draws a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
around the <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> to indicate the chart region occupied by intrabar drawings:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="572" loading="lazy" src="images/83bdbe9fbb0745885035f2b2d42e18c9.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Tuples of intrabar data demo", "Candle magnifier", max_lines_count = 500)

//@variable The maximum number of intrabars to display.
int maxIntrabars = input.int(20, "Max intrabars", 1, 250)
//@variable The width of the drawn candle bodies.
int candleWidth = input.int(20, "Candle width", 2)

//@variable The largest valid timeframe closest to `maxIntrabars` times smaller than the chart timeframe.
string lowerTimeframe = timeframe.from_seconds(math.ceil(timeframe.in_seconds() / maxIntrabars))

//@variable An array of lines to represent intrabar wicks.
var array&lt;line&gt; wicks  = array.new&lt;line&gt;()
//@variable An array of lines to represent intrabar bodies.
var array&lt;line&gt; bodies = array.new&lt;line&gt;()
//@variable A box that surrounds the displayed intrabars.
var box magnifierBox = box.new(na, na, na, na, bgcolor = na)

// Fill the `wicks` and `bodies` arrays with blank lines on the first bar.
if barstate.isfirst
    for i = 1 to maxIntrabars
        array.push(wicks, line.new(na, na, na, na, color = color.gray))
        array.push(bodies, line.new(na, na, na, na, width = candleWidth))

//@variable A tuple of "float" arrays containing `open`, `high`, `low`, and `close` prices from the `lowerTimeframe`.
[oData, hData, lData, cData] = request.security_lower_tf(syminfo.tickerid, lowerTimeframe, [open, high, low, close])
//@variable The number of intrabars retrieved from the `lowerTimeframe` on the chart bar.
int numIntrabars = array.size(oData)

if numIntrabars &gt; 0
    // Define the start and end bar index values for intrabar display.
    int startIndex = bar_index + 2
    int endIndex = startIndex + numIntrabars
    // Loop to update lines.
    for i = 0 to maxIntrabars - 1
        line wickLine = array.get(wicks, i)
        line bodyLine = array.get(bodies, i)
        if i &lt; numIntrabars
            //@variable The `bar_index` of the drawing.
            int candleIndex = startIndex + i
            // Update the properties of the `wickLine` and `bodyLine`.
            line.set_xy1(wickLine, startIndex + i, array.get(hData, i))
            line.set_xy2(wickLine, startIndex + i, array.get(lData, i))
            line.set_xy1(bodyLine, startIndex + i, array.get(oData, i))
            line.set_xy2(bodyLine, startIndex + i, array.get(cData, i))
            line.set_color(bodyLine, bodyLine.get_y2() &gt; bodyLine.get_y1() ? color.teal : color.maroon)
            continue
        // Set the coordinates of the `wickLine` and `bodyLine` to `na` if no intrabar data is available at the index.
        line.set_xy1(wickLine, na, na)
        line.set_xy2(wickLine, na, na)
        line.set_xy1(bodyLine, na, na)
        line.set_xy2(bodyLine, na, na)
    // Set the coordinates of the `magnifierBox`.
    box.set_lefttop(magnifierBox, startIndex - 1, array.max(hData))
    box.set_rightbottom(magnifierBox, endIndex, array.min(lData))</code></div>
<p>Note that:</p>
<ul>
<li>The script draws each candle using two
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>:
one to represent wicks and the other to represent the body.
Since the script can display up to 500 lines on the chart,
we’ve limited the <code dir="auto">maxIntrabars</code> input to 250.</li>
<li>The <code dir="auto">lowerTimeframe</code> value is the result of calculating the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.ceil">math.ceil()</a>
of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a>
divided by the <code dir="auto">maxIntrabars</code> and converting to a
<a href="/pine-script-docs/v5/concepts/timeframes/#timeframe-string-specifications">valid timeframe string</a> with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a>.</li>
<li>The script sets the top of the box drawing using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.max">array.max()</a>
of the requested <code dir="auto">hData</code> array, and it sets the box’s bottom
using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">array.min()</a>
of the requested <code dir="auto">lData</code> array. As we see on the chart, these
values correspond to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
of the chart bar.</li>
</ul>
<h3 class="md-heading" id="requesting-collections"><a href="#requesting-collections">Requesting collections<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In some cases, a script may need to request the IDs of
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> from an intrabar context. However, unlike
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>,
one cannot pass
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> or calls to functions that return them as the <code dir="auto">expression</code>
argument in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
call, as <a href="/pine-script-docs/v5/language/arrays/">arrays</a> cannot
directly reference other
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>.</p>
<p>Despite these limitations, it is possible to request
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> from lower timeframes, if needed, with the help of <em>wrapper</em>
types.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The use case described below is <strong>advanced</strong> and <strong>not</strong> recommended for
beginners. Before exploring this approach, we recommend understanding
how
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> and
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> work in Pine Script™. When possible, we recommend using
<em>simpler</em> methods to manage LTF requests, and only using this approach
when <em>nothing else</em> will suffice.</p></div></aside>
<p>To make
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> requestable with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>,
we must create a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
with a field to reference a collection ID. This step is necessary since
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> cannot reference
other <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> directly but <em>can</em> reference UDTs with collection fields:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@type A "wrapper" type to hold an `array&lt;float&gt;` instance.
type Wrapper
    array&lt;float&gt; collection</code></div>
<p>With our <code dir="auto">Wrapper</code> UDT defined, we can now pass the IDs of
<a href="/pine-script-docs/v5/language/objects/">objects</a> of the UDT to the
<code dir="auto">expression</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>.</p>
<p>A straightforward approach is to call the built-in <code dir="auto">*.new()</code> function as
the <code dir="auto">expression</code>. For example, this line of code calls <code dir="auto">Wrapper.new()</code>
with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from(close)</a>
as its <code dir="auto">collection</code> within
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable An array of `Wrapper` IDs requested from the 1-minute timeframe.
array&lt;Wrapper&gt; wrappers = request.security_lower_tf(syminfo.tickerid, "1", Wrapper.new(array.from(close)))</code></div>
<p>Alternatively, we can create a
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
that returns an <a href="/pine-script-docs/v5/language/objects/">object</a> of
the <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a> and call that function within
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>.
For instance, this code calls a custom <code dir="auto">newWrapper()</code> function that
returns a <code dir="auto">Wrapper</code> ID as the <code dir="auto">expression</code> argument:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function Creates a new `Wrapper` instance to wrap the specified `collection`.
newWrapper(array&lt;float&gt; collection) =&gt;
    Wrapper.new(collection)

//@variable An array of `Wrapper` IDs requested from the 1-minute timeframe.
array&lt;Wrapper&gt; wrappers = request.security_lower_tf(syminfo.tickerid, "1", newWrapper(array.from(close)))</code></div>
<p>The result with either of the above is an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
containing <code dir="auto">Wrapper</code> IDs from all available intrabars in the chart bar,
which the script can use to reference <code dir="auto">Wrapper</code> instances from specific
intrabars and use their <code dir="auto">collection</code> fields in additional operations.</p>
<p>The script below utilizes this approach to collect
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> of intrabar data
from a <code dir="auto">lowerTimeframe</code> and uses them to display data from a specific
intrabar. Its custom <code dir="auto">Prices</code> type contains a single <code dir="auto">data</code> field to
reference <code dir="auto">array&lt;float&gt;</code> instances that hold price data, and the
user-defined <code dir="auto">newPrices()</code> function returns the ID of a <code dir="auto">Prices</code> object.</p>
<p>The script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
with a <code dir="auto">newPrices()</code> call as its <code dir="auto">expression</code> argument to retrieve an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of <code dir="auto">Prices</code> IDs from each intrabar in the chart bar, then uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a>
to get the ID from a specified available intrabar, if it exists. Lastly,
it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a>
on the <code dir="auto">data</code> array assigned to that instance and calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
to display its values on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/148dfb98d4305c333535b77fb8f26f26.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting LTF collections demo", "Intrabar viewer", true)

//@variable The timeframe of the LTF data request.
string lowerTimeframe = input.timeframe("1", "Timeframe")
//@variable The index of the intrabar to show on each chart bar. 0 is the first available intrabar.
int intrabarIndex = input.int(0, "Intrabar to show", 0)

//@variable A custom type to hold an array of price `data`.
type Prices
    array&lt;float&gt; data

//@function Returns a new `Prices` instance containing current `open`, `high`, `low`, and `close` prices.
newPrices() =&gt;
    Prices.new(array.from(open, high, low, close))

//@variable An array of `Prices` requested from the `lowerTimeframe`.
array&lt;Prices&gt; requestedPrices = request.security_lower_tf(syminfo.tickerid, lowerTimeframe, newPrices())

//@variable The `Prices` ID from the `requestedPrices` array at the `intrabarIndex`, or `na` if not available.
Prices intrabarPrices = array.size(requestedPrices) &gt; intrabarIndex ? array.get(requestedPrices, intrabarIndex) : na
//@variable The `data` array from the `intrabarPrices`, or an array of `na` values if `intrabarPrices` is `na`.
array&lt;float&gt; intrabarData = na(intrabarPrices) ? array.new&lt;float&gt;(4, na) : intrabarPrices.data

// Plot the `intrabarData` values as candles.
plotcandle(intrabarData.get(0), intrabarData.get(1), intrabarData.get(2), intrabarData.get(3))</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">intrabarPrices</code> variable only references a <code dir="auto">Prices</code> ID if
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">size</a>
of the <code dir="auto">requestedPrices</code> array is greater than the
<code dir="auto">intrabarIndex</code>, as attempting to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a>
to get an element that doesn’t exist will result in an
<a href="/pine-script-docs/v5/language/arrays/#index-xx-is-out-of-bounds-array-size-is-yy">out of bounds error</a>.</li>
<li>The <code dir="auto">intrabarData</code> variable only references the <code dir="auto">data</code> field
from <code dir="auto">intrabarPrices</code> if a valid <code dir="auto">Prices</code> ID exists since a
script cannot reference fields of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
value.</li>
<li>The process used in this example is <em>not</em> necessary to achieve
the intended result. We could instead avoid using
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a> and pass an <code dir="auto">[open, high, low, close]</code> tuple to the
<code dir="auto">expression</code> parameter to retrieve a tuple of
<a href="/pine-script-docs/v5/language/arrays/">arrays</a> for further
operations, as explained in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples-of-intrabar-data">previous section</a>.</li>
</ul>
<h2 class="md-heading" id="custom-contexts"><a href="#custom-contexts">Custom contexts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ includes multiple <code dir="auto">ticker.*()</code> functions that allow scripts
to construct <em>custom</em> ticker IDs that specify additional settings for
data requests when used as a <code dir="auto">symbol</code> argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.new">ticker.new()</a>
constructs a custom ticker ID from a specified <code dir="auto">prefix</code> and <code dir="auto">ticker</code>
with additional <code dir="auto">session</code> and <code dir="auto">adjustment</code> settings.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.modify">ticker.modify()</a>
constructs a modified form of a specified <code dir="auto">tickerid</code> with additional
<code dir="auto">session</code> and <code dir="auto">adjustment</code> settings.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.heikinashi">ticker.heikinashi()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.renko">ticker.renko()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.pointfigure">ticker.pointfigure()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.kagi">ticker.kagi()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.linebreak">ticker.linebreak()</a>
construct a modified form a <code dir="auto">symbol</code> with
<a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard chart</a> settings.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.inherit">ticker.inherit()</a>
constructs a new ticker ID for a <code dir="auto">symbol</code> with additional parameters
inherited from the <code dir="auto">from_tickerid</code> specified in the function call,
allowing scripts to request the <code dir="auto">symbol</code> data with the same
modifiers as the <code dir="auto">from_tickerid</code>, including session, dividend
adjustment, currency conversion, non-standard chart type,
back-adjustment, settlement-as-close, etc.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.standard">ticker.standard()</a>
constructs a standard ticker ID representing the <code dir="auto">symbol</code> <em>without</em>
additional modifiers.</li>
</ul>
<p>Let’s explore some practical examples of applying <code dir="auto">ticker.*()</code>
functions to request data from custom contexts.</p>
<p>Suppose we want to include dividend adjustment in a stock symbol’s
prices without enabling the “Adjust data for dividends” option in the
“Symbol” section of the chart’s settings. We can achieve this in a
script by constructing a custom ticker ID for the instrument using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.new">ticker.new()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.modify">ticker.modify()</a>
with an <code dir="auto">adjustment</code> value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_adjustment.dividends">adjustment.dividends</a>.</p>
<p>This script creates an <code dir="auto">adjustedTickerID</code> using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.modify">ticker.modify()</a>,
uses that ticker ID as the <code dir="auto">symbol</code> in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve a
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">tuple</a> of adjusted price values, then plots the result as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">candles</a>
on the chart. It also highlights the background when the requested
prices differ from the prices without dividend adjustment.</p>
<p>As we see on the “NYSE:XOM” chart below, enabling dividend adjustment
results in different historical values before the date of the latest
dividend:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="574" loading="lazy" src="images/e27c037e27fa39ac230e9ffb38852652.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Custom contexts demo 1", "Adjusted prices", true)

//@variable A custom ticker ID representing the chart's symbol with the dividend adjustment modifier.
string adjustedTickerID = ticker.modify(syminfo.tickerid, adjustment = adjustment.dividends)

// Request the adjusted prices for the chart's symbol.
[o, h, l, c] = request.security(adjustedTickerID, timeframe.period, [open, high, low, close])

//@variable The color of the candles on the chart.
color candleColor = c &gt; o ? color.teal : color.maroon

// Plot the adjusted prices.
plotcandle(o, h, l, c, "Adjusted Prices", candleColor)
// Highlight the background when `c` is different from `close`.
bgcolor(c != close ? color.new(color.orange, 80) : na)</code></div>
<p>Note that:</p>
<ul>
<li>If a modifier included in a constructed ticker ID does not apply
to the symbol, the script will <em>ignore</em> that modifier when
requesting data. For instance, this script will display the same
values as the main chart on forex symbols such as “EURUSD”.</li>
</ul>
<p>While the example above demonstrates a simple way to modify the chart’s
symbol, a more frequent use case for <code dir="auto">ticker.*()</code> functions is applying
custom modifiers to another symbol while requesting data. If a ticker ID
referenced in a script already has the modifiers one would like to apply
(e.g., adjustment settings, session type, etc.), they can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.inherit">ticker.inherit()</a>
to quickly and efficiently add those modifiers to another symbol.</p>
<p>In the example below, we’ve edited the previous script to request data
for a <code dir="auto">symbolInput</code> using modifiers inherited from the
<code dir="auto">adjustedTickerID</code>. This script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.inherit">ticker.inherit()</a>
to construct an <code dir="auto">inheritedTickerID</code> and uses that ticker ID in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call. It also requests data for the <code dir="auto">symbolInput</code> without additional
modifiers and plots
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">candles</a>
for both ticker IDs in a separate chart pane to compare the difference.</p>
<p>As shown on the chart, the data requested using the <code dir="auto">inheritedTickerID</code>
includes dividend adjustment, whereas the data requested using the
<code dir="auto">symbolInput</code> directly does not:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="574" loading="lazy" src="images/99335cf4fabcc91b5e14ef69205db77b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Custom contexts demo 2", "Inherited adjustment")

//@variable The symbol to request data from.
string symbolInput = input.symbol("NYSE:PFE", "Symbol")

//@variable A custom ticker ID representing the chart's symbol with the dividend adjustment modifier.
string adjustedTickerID = ticker.modify(syminfo.tickerid, adjustment = adjustment.dividends)
//@variable A custom ticker ID representing the `symbolInput` with modifiers inherited from the `adjustedTickerID`.
string inheritedTickerID = ticker.inherit(adjustedTickerID, symbolInput)

// Request prices using the `symbolInput`.
[o1, h1, l1, c1] = request.security(symbolInput, timeframe.period, [open, high, low, close])
// Request prices using the `inheritedTickerID`.
[o2, h2, l2, c2] = request.security(inheritedTickerID, timeframe.period, [open, high, low, close])

//@variable The color of the candles that use the `inheritedTickerID` prices.
color candleColor = c2 &gt; o2 ? color.teal : color.maroon

// Plot the `symbol` prices.
plotcandle(o1, h1, l1, c1, "Symbol", color.gray, color.gray, bordercolor = color.gray)
// Plot the `inheritedTickerID` prices.
plotcandle(o2, h2, l2, c2, "Symbol With Modifiers", candleColor)
// Highlight the background when `c1` is different from `c2`.
bgcolor(c1 != c2 ? color.new(color.orange, 80) : na)</code></div>
<p>Note that:</p>
<ul>
<li>Since the <code dir="auto">adjustedTickerID</code> represents a modified form of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>,
if we modify the chart’s context in other ways, such as
changing the chart type or enabling extended trading hours in
the chart’s settings, those modifiers will also apply to the
<code dir="auto">adjustedTickerID</code> and <code dir="auto">inheritedTickerID</code>. However, they will
<em>not</em> apply to the <code dir="auto">symbolInput</code> since it represents a
<em>standard</em> ticker ID.</li>
</ul>
<p>Another frequent use case for requesting custom contexts is retrieving
data that uses
<a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard chart</a> calculations. For example, suppose we want to use
<a href="https://www.tradingview.com/support/solutions/43000502284-renko-charts/">Renko</a>
price values to calculate trade signals in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
script. If we simply change the chart type to “Renko” to get the
prices, the <a href="/pine-script-docs/v5/concepts/strategies/">strategy</a>
will also simulate its trades based on those synthetic prices, producing
<a href="https://www.tradingview.com/support/solutions/43000481029/">misleading
results</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="656" loading="lazy" src="images/c1a66716076b0cd8a5350460b66f2e01.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Custom contexts demo 3", "Renko strategy", true, default_qty_type = strategy.percent_of_equity,
     default_qty_value = 2, initial_capital = 50000, slippage = 2,
     commission_type = strategy.commission.cash_per_contract, commission_value = 1, margin_long = 100,
     margin_short = 100
 )

//@variable When `true`, the strategy places a long market order.
bool longEntry = ta.crossover(close, open)
//@variable When `true`, the strategy places a short market order.
bool shortEntry = ta.crossunder(close, open)

if longEntry
    strategy.entry("Long Entry", strategy.long)
if shortEntry
    strategy.entry("Short Entry", strategy.short)</code></div>
<p>To ensure our strategy shows results based on <em>actual</em> prices, we can
create a Renko ticker ID using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.renko">ticker.renko()</a>
while keeping the chart on a <em>standard type</em>, allowing the script to
request and use
<a href="https://www.tradingview.com/support/solutions/43000502284-renko-charts/">Renko</a>
prices to calculate its signals without calculating the strategy results
on them:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="634" loading="lazy" src="images/571469d2785fdecab3cbce5125aa807f.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Custom contexts demo 3", "Renko strategy", true, default_qty_type = strategy.percent_of_equity,
     default_qty_value = 2, initial_capital = 50000, slippage = 1,
     commission_type = strategy.commission.cash_per_contract, commission_value = 1, margin_long = 100,
     margin_short = 100
 )

//@variable A Renko ticker ID.
string renkoTickerID = ticker.renko(syminfo.tickerid, "ATR", 14)
// Request the `open` and `close` prices using the `renkoTickerID`.
[renkoOpen, renkoClose] = request.security(renkoTickerID, timeframe.period, [open, close])

//@variable When `true`, the strategy places a long market order.
bool longEntry = ta.crossover(renkoClose, renkoOpen)
//@variable When `true`, the strategy places a short market order.
bool shortEntry = ta.crossunder(renkoClose, renkoOpen)

if longEntry
    strategy.entry("Long Entry", strategy.long)
if shortEntry
    strategy.entry("Short Entry", strategy.short)

plot(renkoOpen)
plot(renkoClose)</code></div>
<h2 class="md-heading" id="historical-and-realtime-behavior"><a href="#historical-and-realtime-behavior">Historical and realtime behavior<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Functions in the <code dir="auto">request.*()</code> namespace can behave differently on
historical and realtime bars. This behavior is closely related to
Pine’s <a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>.</p>
<p>Consider how a script behaves within the main context. Throughout the
chart’s history, the script calculates its required values once and
<em>commits</em> them to that bar so their states are accessible on subsequent executions.
On an unconfirmed bar, however, the script recalculates its
values on <em>each update</em> to the bar’s data to align with realtime
changes. Before recalculating the values on that bar, it reverts
calculated values to their last committed states, otherwise known as
<em>rollback</em>, and it only commits values to that bar once the bar closes.</p>
<p>Now consider the behavior of data requests from other contexts with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.
As when evaluating historical bars in the main context,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
only returns new historical values when it confirms a bar in its
specified context. When executing on realtime bars, it returns
recalculated values on each chart bar, similar to how a script
recalculates values in the main context on the open chart bar.</p>
<p>However, the function only <em>confirms</em> the requested values when a bar
from its context closes. When the script restarts, what
were previously <em>realtime</em> bars become <em>historical</em> bars.
Therefore,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
only returns the values it confirmed on those bars. In essence, this
behavior means that requested data may <em>repaint</em> when its values
fluctuate on realtime bars without confirmation from the context.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>It’s often helpful to distinguish historical bars from realtime bars
when working with <code dir="auto">request.*()</code> functions. Scripts can determine whether
bars have historical or realtime states via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.ishistory">barstate.ishistory</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">barstate.isrealtime</a>
variables.</p></div></aside>
<p>In most circumstances where a script requests data from a broader
context, one will typically require confirmed, stable values that <em>do
not</em> fluctuate on realtime bars. The
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">section below</a> explains how to achieve such a result and avoid repainting
data requests.</p>
<h3 class="md-heading" id="avoiding-repainting"><a href="#avoiding-repainting">Avoiding Repainting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<h4 class="md-heading" id="higher-timeframe-data"><a href="#higher-timeframe-data">Higher-timeframe data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When requesting values from a higher timeframe, they are subject to
repainting since realtime bars can contain <em>unconfirmed</em> information
from developing HTF bars, and the script may adjust the times that new
values come in on historical bars. To avoid repainting HTF data, one
must ensure that the function only returns confirmed values with
consistent timing on all bars, regardless of bar state.</p>
<p>The most reliable approach to achieve non-repainting results is to use
an <code dir="auto">expression</code> argument that only references past bars (e.g.,
<code dir="auto">close[1]</code>) while using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
as the <code dir="auto">lookahead</code> value.</p>
<p>Using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
with non-offset HTF data requests is discouraged since it prompts
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to “look ahead” to the final values of an HTF bar, retrieving
confirmed values <em>before</em> they’re actually available in the script’s
history. However, if the values used in the <code dir="auto">expression</code> are offset by
at least one bar, the “future” data the function retrieves is no
longer from the future. Instead, the data represents confirmed values
from established, <em>available</em> HTF bars. In other words, applying an
offset to the <code dir="auto">expression</code> effectively prevents the requested data from
repainting when the script restarts its executions and eliminates
lookahead bias in the historical series.</p>
<p>The following example demonstrates a repainting HTF data request. The
script uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
without offset modifications or additional arguments to retrieve the
results of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.wma">ta.wma()</a>
call from a higher timeframe. It also highlights the background to
indicate which bars were in a realtime state during its calculations.</p>
<p>As shown on the chart below, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a>
of the requested WMA only changes on historical bars when HTF bars
close, whereas it fluctuates on all realtime bars since the data
includes unconfirmed values from the higher timeframe:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/465c7ccdf43ae5993c8e5285ae5f1068.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Avoiding HTF repainting demo", overlay = true)

//@variable The multiplier applied to the chart's timeframe.
int tfMultiplier = input.int(10, "Timeframe multiplier", 1)
//@variable The number of bars in the moving average.
int length = input.int(5, "WMA smoothing length")

//@variable The valid timeframe string closest to `tfMultiplier` times larger than the chart timeframe.
string timeframe = timeframe.from_seconds(timeframe.in_seconds() * tfMultiplier)

//@variable The weighted MA of `close` prices over `length` bars on the `timeframe`.
//          This request repaints because it includes unconfirmed HTF data on realtime bars and it may offset the
//          times of its historical results.
float requestedWMA = request.security(syminfo.tickerid, timeframe, ta.wma(close, length))

// Plot the requested series.
plot(requestedWMA, "HTF WMA", color.purple, 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 70) : na, title = "Realtime bar highlight")</code></div>
<p>To avoid repainting in this script, we can add
<code dir="auto">lookahead = barmerge.lookahead_on</code> to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call and offset the call history of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.wma">ta.wma()</a>
by one bar with the history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>,
ensuring the request always retrieves the last confirmed HTF bar’s WMA
at the start of each new <code dir="auto">timeframe</code>. Unlike the previous script, this
version has consistent behavior on historical and realtime bar states,
as we see below:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/186e3b3e87d223775e741bcd61152f7f.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Avoiding HTF repainting demo", overlay = true)

//@variable The multiplier applied to the chart's timeframe.
int tfMultiplier = input.int(10, "Timeframe multiplier", 1)
//@variable The number of bars in the moving average.
int length = input.int(5, "WMA smoothing length")

//@variable The valid timeframe string closest to `tfMultiplier` times larger than the chart timeframe.
string timeframe = timeframe.from_seconds(timeframe.in_seconds() * tfMultiplier)

//@variable The weighted MA of `close` prices over `length` bars on the `timeframe`.
//          This request does not repaint, as it always references the last confirmed WMA value on all bars.
float requestedWMA = request.security(
     syminfo.tickerid, timeframe, ta.wma(close, length)[1], lookahead = barmerge.lookahead_on
 )

// Plot the requested value.
plot(requestedWMA, "HTF WMA", color.purple, 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 70) : na, title = "Realtime bar highlight")</code></div>
<h4 class="md-heading" id="lower-timeframe-data"><a href="#lower-timeframe-data">Lower-timeframe data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
functions can retrieve data from lower-timeframe contexts. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function can only retrieve data from a <em>single</em> intrabar in each chart
bar, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
retrieves data from <em>all</em> available intrabars.</p>
<p>When using these functions to retrieve intrabar data, it’s important to
note that such requests are <strong>not</strong> immune to repainting behavior.
Historical and realtime series often rely on <em>separate</em> data feeds. Data
providers may retroactively modify realtime data, and it’s possible for
races to occur in realtime data feeds, as explained in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#data-feeds">Data feeds</a> section of this page. Either case may result in intrabar
data retrieved on realtime bars repainting after the script restarts its
executions.</p>
<p>Additionally, a particular case that <em>will</em> cause repainting LTF
requests is using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
to retrieve data from the first intrabar in each chart bar. While it
will generally work as expected on historical bars, it will track only
the most recent intrabar on realtime bars, as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
does not retain all intrabar information, and the intrabars the function retrieves on realtime bars are unsorted until restarting the
script:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/bf2e77e143469b4d298688fb79a72a36.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Avoiding LTF repainting demo", overlay = true)

//@variable The lower timeframe of the requested data.
string lowerTimeframe = input.timeframe("1", "Timeframe")

//@variable The first intrabar `close` requested from the `lowerTimeframe` on each bar.
//          Only works as intended on historical bars.
float requestedClose = request.security(syminfo.tickerid, lowerTimeframe, close, lookahead = barmerge.lookahead_on)

// Plot the `requestedClose`.
plot(requestedClose, "First intrabar close", linewidth = 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 60) : na, title = "Realtime bar Highlight")</code></div>
<p>One can mitigate this behavior and track the values from the first
intrabar, or any available intrabar in the chart bar, by using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
since it maintains an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of intrabar values ordered by the times they come in. Here, we call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.first">array.first()</a>
on a requested
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
of intrabar data to retrieve the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price from the first available intrabar in each chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/a5b64e3003bb78df2f5a607d2e9b2da6.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Avoiding LTF repainting demo", overlay = true)

//@variable The lower timeframe of the requested data.
string lowerTimeframe = input.timeframe("1", "Timeframe")

//@variable An array of intrabar `close` values requested from the `lowerTimeframe` on each bar.
array&lt;float&gt; requestedCloses = request.security_lower_tf(syminfo.tickerid, lowerTimeframe, close)

//@variable The first intrabar `close` on each bar with available data.
float firstClose = requestedCloses.size() &gt; 0 ? requestedCloses.first() : na

// Plot the `firstClose`.
plot(firstClose, "First intrabar close", linewidth = 3)
// Highlight the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 60) : na, title = "Realtime bar Highlight")</code></div>
<p>Note that:</p>
<ul>
<li>While
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
is more optimized for handling historical and realtime
intrabars, it’s still possible in some cases for minor
repainting to occur due to data differences from the provider,
as outlined above.</li>
<li>This code may not show intrabar data on all available chart
bars, depending on how many intrabars each chart bar contains,
as <code dir="auto">request.*()</code> functions can retrieve up to 100,000 intrabars
from an LTF context. See
<a href="/pine-script-docs/v5/writing/limitations/#request-calls">this</a> section of the
<a href="/pine-script-docs/v5/writing/limitations/">Limitations</a>
page for more information.</li>
</ul>
<h2 class="md-heading" id="requestcurrency_rate"><a href="#requestcurrency_rate">`request.currency_rate()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When a script needs to convert values expressed in one currency to
another, one can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a>.
This function requests a <em>daily rate</em> for currency conversion
calculations based on currency pair or <a href="https://www.tradingview.com/support/solutions/43000502298/">spread</a> data from the most popular exchanges, providing a simpler alternative
to fetching specific pairs or
<a href="https://www.tradingview.com/support/solutions/43000502298/">spreads</a>
with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.</p>
<p>While one can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve daily currency rates, its use case is more involved than
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a>,
as one needs to supply a valid <em>ticker ID</em> for a currency pair or spread
to request the rate. Additionally, a historical offset and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
are necessary to prevent the results from repainting, as explained in
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">this section</a>.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a>
function, on the other hand, only requires <em>currency codes</em>. No ticker
ID is needed when requesting rates with this function, and it ensures
non-repainting results without requiring additional specification.</p>
<p>The function’s signature is as follows:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.currency_rate(from, to, ignore_invalid_currency) → series float</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">from</code> parameter specifies the currency to convert, and the <code dir="auto">to</code>
parameter specifies the target currency. Both parameters accept
“string” values representing valid currency codes (e.g.,
“USD”) or any built-in <code dir="auto">currency.*</code> variable (e.g.,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_currency.USD">currency.USD</a>).</p>
<p>When the function cannot calculate a valid conversion rate between the specified
<code dir="auto">from</code> and <code dir="auto">to</code> currencies, programmers can decide whether
it raises a runtime error or returns
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> via
the <code dir="auto">ignore_invalid_currency</code> parameter. The default value is <code dir="auto">false</code>,
meaning the function raises a runtime error and halts the script’s
executions.</p>
<p>The following example demonstrates a simple use case for
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a>.
Suppose we want to convert values expressed in Turkish lira
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_currency.TRY">currency.TRY</a>)
to South Korean won
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_currency.KRW">currency.KRW</a>)
using a daily conversion rate. If we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to retrieve the rate, we must supply a valid ticker ID and request the
last confirmed
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
from the previous day.</p>
<p>In this case, no valid symbol exists that would allow us to
retrieve a conversion rate directly with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.
Therefore, we first need a ticker ID for a
<a href="https://www.tradingview.com/support/solutions/43000502298/">spread</a>
that converts TRY to an intermediate currency, such as USD, then
converts the intermediate currency to KRW. We can then use that ticker
ID within
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
with <code dir="auto">close[1]</code> as the <code dir="auto">expression</code> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
as the <code dir="auto">lookahead</code> value to request a non-repainting daily rate.</p>
<p>Alternatively, we can achieve the same result more simply by calling
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a>.
This function does all the heavy lifting for us, only requiring <code dir="auto">from</code>
and <code dir="auto">to</code> currency arguments to perform its calculation.</p>
<p>As we see below, both approaches return the same daily rate:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/2f487cf9f767f9bd5bb792c1fca3db27.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting currency rates demo")

//@variable The currency to convert.
simple string fromCurrency = currency.TRY
//@variable The resulting currency.
simple string toCurrency = currency.KRW

//@variable The spread symbol to request. Required in `request.security()` because no direct symbol exists.
simple string spreadSymbol = str.format("{0}{2} * {2}{1}", fromCurrency, toCurrency, currency.USD)

//@variable The non-repainting conversion rate from `request.security()` using the `spreadSymbol`.
float securityRequestedRate = request.security(spreadSymbol, "1D", close[1], lookahead = barmerge.lookahead_on)
//@variable The non-repainting conversion rate from `request.currency_rate()`.
float nonSecurityRequestedRate = request.currency_rate(fromCurrency, toCurrency)

// Plot the requested rates. We can multiply TRY values by these rates to convert them to KRW.
plot(securityRequestedRate, "`request.security()` value", color.purple, 5)
plot(nonSecurityRequestedRate, "`request.currency_rate()` value", color.yellow, 2)</code></div>
<h2 class="md-heading" id="requestdividends-requestsplits-and-requestearnings"><a href="#requestdividends-requestsplits-and-requestearnings">`request.dividends()`, `request.splits()`, and `request.earnings()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Analyzing a stock’s earnings data and corporate actions provides
helpful insights into its underlying financial strength. Pine Script™
provides the ability to retrieve essential information about applicable
stocks via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a>.</p>
<p>These are the functions’ signatures:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.dividends(ticker, field, gaps, lookahead, ignore_invalid_symbol, currency) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.splits(ticker, field, gaps, lookahead, ignore_invalid_symbol) → series float</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.earnings(ticker, field, gaps, lookahead, ignore_invalid_symbol, currency) → series float</span></div></div></code></pre></figure></div>
<p>Each function has the same parameters in its signature, with the
exception of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>,
which doesn’t have a <code dir="auto">currency</code> parameter.</p>
<p>Note that unlike the <code dir="auto">symbol</code> parameter in other <code dir="auto">request.*()</code>
functions, the <code dir="auto">ticker</code> parameter in these functions only accepts an
<em>“Exchange:Symbol” pair</em>, such as “NASDAQ:AAPL”. The built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.ticker">syminfo.ticker</a>
variable does not work with these functions since it does not contain
exchange information. Instead, one must use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>
for such cases.</p>
<p>The <code dir="auto">field</code> parameter determines the data the function will retrieve.
Each of these functions accepts different built-in variables as the
<code dir="auto">field</code> argument since each requests different information about a
stock:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a>
function retrieves current dividend information for a stock, i.e.,
the amount per share the issuing company paid out to investors who
purchased shares before the ex-dividend date. Passing the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_dividends.gross">dividends.gross</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_dividends.net">dividends.net</a>
variables to the <code dir="auto">field</code> parameter specifies whether the returned
value represents dividends before or after factoring in expenses the
company deducts from its payouts.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>
function retrieves current split and reverse split information for a
stock. A split occurs when a company increases its outstanding
shares to promote liquidity. A reverse split occurs when a company
consolidates its shares and offers them at a higher price to attract
specific investors or maintain their listing on a market that has a
minimum per-share price. Companies express their split information
as <em>ratios</em>. For example, a 5:1 split means the company issued
additional shares to its shareholders so that they have five times
the number of shares they had before the split, and the raw price of
each share becomes one-fifth of the previous price. Passing
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_splits.numerator">splits.numerator</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_splits.denominator">splits.denominator</a>
to the <code dir="auto">field</code> parameter of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>
determines whether it returns the numerator or denominator of the
split ratio.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a>
function retrieves the earnings per share (EPS) information for a
stock <code dir="auto">ticker</code>’s issuing company. The EPS value is the ratio of a
company’s net income to the number of outstanding stock shares,
which investors consider an indicator of the company’s
profitability. Passing
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_earnings.actual">earnings.actual</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_earnings.estimate">earnings.estimate</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_earnings.standardized">earnings.standardized</a>
as the <code dir="auto">field</code> argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a>
respectively determines whether the function requests the actual,
estimated, or standardized EPS value.</li>
</ul>
<p>For a detailed explanation of the <code dir="auto">gaps</code>, <code dir="auto">lookahead</code>, and
<code dir="auto">ignore_invalid_symbol</code> parameters of these functions, see the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#common-characteristics">Common characteristics</a> section at the top of this page.</p>
<p>It’s important to note that the values returned by these functions
reflect the data available as it comes in. This behavior differs from
financial data originating from a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
call in that the underlying data from such calls becomes available
according to a company’s fiscal reporting period.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Scripts can also retrieve information about upcoming earnings and
dividends for an instrument via the <code dir="auto">earnings.future_*</code> and
<code dir="auto">dividends.future_*</code> built-in variables.</p></div></aside>
<p>Here, we’ve included an example that displays a handy
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
containing the most recent dividend, split, and EPS data. The script
calls the <code dir="auto">request.*()</code> functions discussed in this section to retrieve
the data, then converts the values to “strings” with <code dir="auto">str.*()</code>
functions and displays the results in the <code dir="auto">infoTable</code> with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell">table.cell()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="560" loading="lazy" src="images/f173cc79f5a25ad36a212880fd9e9dff.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Dividends, splits, and earnings demo", overlay = true)

//@variable The size of the table's text.
string tableSize = input.string(
     size.large, "Table size", [size.auto, size.tiny, size.small, size.normal, size.large, size.huge]
 )

//@variable The color of the table's text and frame.
var color tableColor = chart.fg_color
//@variable A `table` displaying the latest dividend, split, and EPS information.
var table infoTable = table.new(position.top_right, 3, 4, frame_color = tableColor, frame_width = 1)

// Add header cells on the first bar.
if barstate.isfirst
    table.cell(infoTable, 0, 0, "Field", text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 1, 0, "Value", text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 2, 0, "Date", text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 0, 1, "Dividend", text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 0, 2, "Split", text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 0, 3, "EPS", text_color = tableColor, text_size = tableSize)

//@variable The amount of the last reported dividend as of the current bar.
float latestDividend = request.dividends(syminfo.tickerid, dividends.gross, barmerge.gaps_on)
//@variable The numerator of that last reported split ratio as of the current bar.
float latestSplitNum = request.splits(syminfo.tickerid, splits.numerator, barmerge.gaps_on)
//@variable The denominator of the last reported split ratio as of the current bar.
float latestSplitDen = request.splits(syminfo.tickerid, splits.denominator, barmerge.gaps_on)
//@variable The last reported earnings per share as of the current bar.
float latestEPS = request.earnings(syminfo.tickerid, earnings.actual, barmerge.gaps_on)

// Update the "Value" and "Date" columns when new values come in.
if not na(latestDividend)
    table.cell(
         infoTable, 1, 1, str.tostring(math.round(latestDividend, 3)), text_color = tableColor, text_size = tableSize
     )
    table.cell(infoTable, 2, 1, str.format_time(time, "yyyy-MM-dd"), text_color = tableColor, text_size = tableSize)
if not na(latestSplitNum)
    table.cell(
         infoTable, 1, 2, str.format("{0}-for-{1}", latestSplitNum, latestSplitDen), text_color = tableColor,
         text_size = tableSize
     )
    table.cell(infoTable, 2, 2, str.format_time(time, "yyyy-MM-dd"), text_color = tableColor, text_size = tableSize)
if not na(latestEPS)
    table.cell(infoTable, 1, 3, str.tostring(latestEPS), text_color = tableColor, text_size = tableSize)
    table.cell(infoTable, 2, 3, str.format_time(time, "yyyy-MM-dd"), text_color = tableColor, text_size = tableSize)</code></div>
<p>Note that:</p>
<ul>
<li>We’ve included
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_on">barmerge.gaps_on</a>
in the <code dir="auto">request.*()</code> calls, so they only return values when new
data is available. Otherwise, they return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</li>
<li>The script assigns a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
ID to the <code dir="auto">infoTable</code> variable on the first chart bar. On
subsequent bars, it updates necessary cells with new information
whenever data is available.</li>
<li>If no information is available from any of the <code dir="auto">request.*()</code>
calls throughout the chart’s history (e.g., if the <code dir="auto">ticker</code> has
no dividend information), the script does not initialize the
corresponding cells since it’s unnecessary.</li>
</ul>
<h2 class="md-heading" id="requestquandl"><a href="#requestquandl">`request.quandl()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView forms partnerships with many fintech companies to provide
users access to extensive information on financial instruments, economic
data, and more. One of our many partners is <a href="https://data.nasdaq.com/" rel="nofollow">Nasdaq Data
Link</a> (formerly Quandl), which provides
multiple <em>external</em> data feeds that scripts can access via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.quandl">request.quandl()</a>
function.</p>
<p>Here is the function’s signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.quandl(ticker, gaps, index, ignore_invalid_symbol) → series float</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">ticker</code> parameter accepts a “string” value representing the ID
of the database published on Nasdaq Data Link and its time series code,
separated by the ”/” delimiter. For example, the code “FRED/DFF”
represents the “Effective Federal Funds Rate” time series from the
“Federal Reserve Economic Data” database.</p>
<p>The <code dir="auto">index</code> parameter accepts an “int” value representing the <em>column
index</em> of the requested data, where 0 is the first available column.
Consult the database’s documentaion on Nasdaq Data Link’s website to
see available columns.</p>
<p>For details on the <code dir="auto">gaps</code> and <code dir="auto">ignore_invalid_symbol</code> parameters, see
the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#common-characteristics">Common characteristics</a> section of this page.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.quandl">request.quandl()</a>
function can only request <strong>free</strong> data from Nasdaq Data Link. No data
that requires a paid subscription to their services is accessible with
this function. Nasdaq Data Link may change the data it provides over
time, and they may not update available datasets regularly. Therefore,
it’s up to programmers to research the supported data available for
request and review the documentation provided for each dataset. You can
search for free data
<a href="https://data.nasdaq.com/search?filters=%5B%22Free%22%5D" rel="nofollow">here</a>.</p></div></aside>
<p>This script requests Bitcoin hash rate (“HRATE”) information from the
“Bitcoin Data Insights” (“BCHAIN”) database and
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the retrieved time
series data on the chart. It uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient">color.from_gradient()</a>
to color the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_plot.style_area">area</a>
plot based on the distance from the current hash rate to its <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.max">all-time
high</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/7384c6f1f4a60a746a0fa9ca8db78bdc.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Quandl demo", "BTC hash rate")

//@variable The estimated hash rate for the Bitcoin network.
float hashRate = request.quandl("BCHAIN/HRATE", barmerge.gaps_off, 0)
//@variable The percentage threshold from the all-time highest `hashRate`.
float dropThreshold = input.int(40, "Drop threshold", 0, 100)

//@variable The all-time highest `hashRate`.
float maxHashRate = ta.max(hashRate)
//@variable The value `dropThreshold` percent below the `maxHashRate`.
float minHashRate = maxHashRate * (100 - dropThreshold) / 100
//@variable The color of the plot based on the `minHashRate` and `maxHashRate`.
color plotColor = color.from_gradient(hashRate, minHashRate, maxHashRate, color.orange, color.blue)

// Plot the `hashRate`.
plot(hashRate, "Hash Rate Estimate", plotColor, style = plot.style_area)</code></div>
<h2 class="md-heading" id="requestfinancial"><a href="#requestfinancial">`request.financial()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Financial metrics provide investors with insights about a company’s
economic and financial health that are not tangible from solely
analyzing its stock prices. TradingView offers a wide variety of
financial metrics from <a href="https://www.factset.com/" rel="nofollow">FactSet</a> that traders
can access via the “Financials” tab in the “Indicators” menu of the
chart. Scripts can access available metrics for an instrument directly
via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
function.</p>
<p>This is the function’s signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.financial(symbol, financial_id, period, gaps, ignore_invalid_symbol, currency) → series float</span></div></div></code></pre></figure></div>
<p>As with the first parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a>,
the <code dir="auto">symbol</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
requires an <em>“Exchange:Symbol” pair</em>. To request financial information
for the chart’s ticker ID, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>,
as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.ticker">syminfo.ticker</a>
will not work.</p>
<p>The <code dir="auto">financial_id</code> parameter accepts a “string” value representing
the ID of the requested financial metric. TradingView has numerous
financial metrics to choose from. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#financial-ids">Financial IDs</a> section below for an overview of all accessible metrics and
their “string” identifiers.</p>
<p>The <code dir="auto">period</code> parameter specifies the fiscal period for which new
requested data comes in. It accepts one of the following “string” arguments:
<strong>“FQ” (quarterly), “FH” (semiannual), “FY” (annual), or “TTM”
(trailing twelve months)</strong>. Not all fiscal periods are available for all
metrics or instruments. To confirm which periods are available for
specific metrics, see the second column of the tables in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#financial-ids">Financial IDs</a> section.</p>
<p>See this page’s
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#common-characteristics">Common characteristics</a> section for a detailed explanation of this function’s
<code dir="auto">gaps</code>, <code dir="auto">ignore_invalid_symbol</code>, and <code dir="auto">currency</code> parameters.</p>
<p>It’s important to note that the data retrieved from this function comes
in at a <em>fixed frequency</em>, independent of the precise date on which the
data is made available within a fiscal period. For a company’s
dividends, splits, and earnings per share (EPS) information, one can
request data reported on exact dates via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a>.</p>
<p>This script uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
to retrieve information about the income and expenses of a stock’s
issuing company and visualize the profitability of its typical business
operations. It requests the “OPER_INCOME”, “TOTAL_REVENUE”, and
“TOTAL_OPER_EXPENSE”
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#financial-ids">financial IDs</a> for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>
over the latest <code dir="auto">fiscalPeriod</code>, then
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the results on the
chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="560" loading="lazy" src="images/bf0821c23f957bead2dbbf0e2c7cc986.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting financial data demo", format = format.volume)

//@variable The size of the fiscal reporting period. Some options may not be available, depending on the instrument.
string fiscalPeriod = input.string("FQ", "Period", ["FQ", "FH", "FY", "TTM"])

//@variable The operating income after expenses reported for the stock's issuing company.
float operatingIncome = request.financial(syminfo.tickerid, "OPER_INCOME", fiscalPeriod)
//@variable The total revenue reported for the stock's issuing company.
float totalRevenue = request.financial(syminfo.tickerid, "TOTAL_REVENUE", fiscalPeriod)
//@variable The total operating expenses reported for the stock's issuing company.
float totalExpenses = request.financial(syminfo.tickerid, "TOTAL_OPER_EXPENSE", fiscalPeriod)

//@variable Is aqua when the `totalRevenue` exceeds the `totalExpenses`, fuchsia otherwise.
color incomeColor = operatingIncome &gt; 0 ? color.new(color.aqua, 50) : color.new(color.fuchsia, 50)

// Display the requested data.
plot(operatingIncome, "Operating income", incomeColor, 1, plot.style_area)
plot(totalRevenue, "Total revenue", color.green, 3)
plot(totalExpenses, "Total operating expenses", color.red, 3)</code></div>
<p>Note that:</p>
<ul>
<li>Not all <code dir="auto">fiscalPeriod</code> options are available for every ticker
ID. For example, companies in the US typically publish
<em>quarterly</em> reports, whereas many European companies publish
<em>semiannual</em> reports. See <a href="https://www.tradingview.com/support/solutions/43000540147">this
page</a>
in our Help Center for more information.</li>
</ul>
<h3 class="md-heading" id="calculating-financial-metrics"><a href="#calculating-financial-metrics">Calculating financial metrics<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
function can provide scripts with numerous useful financial metrics that
don’t require additional calculations. However, some commonly used
financial estimates require combining an instrument’s current market
price with requested financial data. Such is the case for:</p>
<ul>
<li>Market Capitalization (market price * total shares outstanding)</li>
<li>Earnings Yield (12-month EPS / market price)</li>
<li>Price-to-Book Ratio (market price / BVPS)</li>
<li>Price-to-Earnings Ratio (market price / EPS)</li>
<li>Price-to-Sales Ratio (market cap / 12-month total revenue)</li>
</ul>
<p>The following script contains
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> that calculate the above financial metrics for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.tickerid">syminfo.tickerid</a>.
We’ve created these functions so users can easily copy them into their
scripts. This example uses them within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
call to construct a <code dir="auto">tooltipText</code>, which it displays in tooltips on the
chart using <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>. Hovering over any bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
will expose the tooltip containing the metrics calculated on that bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="592" loading="lazy" src="images/0705764271536cc6ccf6d041919b98dd.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Calculating financial metrics demo", overlay = true, max_labels_count = 500)

//@function Calculates the market capitalization (market cap) for the chart's symbol.
marketCap() =&gt;
    //@variable The most recent number of outstanding shares reported for the symbol.
    float totalSharesOutstanding = request.financial(syminfo.tickerid, "TOTAL_SHARES_OUTSTANDING", "FQ")
    // Return the market cap value.
    totalSharesOutstanding * close

//@function Calculates the Earnings Yield for the chart's symbol.
earningsYield() =&gt;
    //@variable The most recent 12-month earnings per share reported for the symbol.
    float eps = request.financial(syminfo.tickerid, "EARNINGS_PER_SHARE", "TTM")
    //Return the Earnings Yield percentage.
    100.0 * eps / close

//@function Calculates the Price-to-Book (P/B) ratio for the chart's symbol.
priceBookRatio() =&gt;
    //@variable The most recent Book Value Per Share (BVPS) reported for the symbol.
    float bookValuePerShare = request.financial(syminfo.tickerid, "BOOK_VALUE_PER_SHARE", "FQ")
    // Return the P/B ratio.
    close / bookValuePerShare

//@function Calculates the Price-to-Earnings (P/E) ratio for the chart's symbol.
priceEarningsRatio() =&gt;
    //@variable The most recent 12-month earnings per share reported for the symbol.
    float eps = request.financial(syminfo.tickerid, "EARNINGS_PER_SHARE", "TTM")
    // Return the P/E ratio.
    close / eps

//@function Calculates the Price-to-Sales (P/S) ratio for the chart's symbol.
priceSalesRatio() =&gt;
    //@variable The most recent number of outstanding shares reported for the symbol.
    float totalSharesOutstanding = request.financial(syminfo.tickerid, "TOTAL_SHARES_OUTSTANDING", "FQ")
    //@variable The most recent 12-month total revenue reported for the symbol.
    float totalRevenue = request.financial(syminfo.tickerid, "TOTAL_REVENUE", "TTM")
    // Return the P/S ratio.
    totalSharesOutstanding * close / totalRevenue

//@variable The text to display in label tooltips.
string tooltipText = str.format(
     "Market Cap: {0} {1}\nEarnings Yield: {2}%\nP/B Ratio: {3}\nP/E Ratio: {4}\nP/S Ratio: {5}",
     str.tostring(marketCap(), format.volume), syminfo.currency, earningsYield(), priceBookRatio(),
     priceEarningsRatio(), priceSalesRatio()
 )

//@variable Displays a blank label with a tooltip containing the `tooltipText`.
label info = label.new(chart.point.now(high), tooltip = tooltipText)</code></div>
<p>Note that:</p>
<ul>
<li>Since not all companies publish quarterly financial reports, one
may need to change the “FQ” in these functions to match the
minimum reporting period for a specific company, as the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>
calls will return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
when “FQ” data isn’t available.</li>
</ul>
<h3 class="md-heading" id="financial-ids"><a href="#financial-ids">Financial IDs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Below is an overview of all financial metrics one can request via
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>,
along with the periods in which reports may be available. We’ve divided
this information into four tables corresponding to the categories
displayed in the “Financials” section of the “Indicators” menu:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#income-statements">Income statements</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#balance-sheet">Balance sheet</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#cash-flow">Cash flow</a></li>
<li><a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#statistics">Statistics</a></li>
</ul>
<p>Each table has the following three columns:</p>
<ul>
<li>The first column contains descriptions of each metric with links to
Help Center pages for additional information.</li>
<li>The second column lists the possible <code dir="auto">period</code> arguments allowed for
the metric. Note that all available values may not be compatible
with specific ticker IDs, e.g., while “FQ” may be a possible
argument, it will not work if the issuing company does not publish
quarterly data.</li>
<li>The third column lists the “string” IDs for the <code dir="auto">financial_id</code>
argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a>.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The tables in these sections are quite lengthy, as there are many
<code dir="auto">financial_id</code> arguments available. Use the <strong>“Click to show/hide”</strong>
option above each table to toggle its visibility.</p></div></aside>
<h4 class="md-heading" id="income-statements"><a href="#income-statements">Income statements<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>This table lists the available metrics that provide information about a
company’s income, costs, profits and losses.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th>Financial</th><th><code dir="auto">period</code></th><th><code dir="auto">financial_id</code></th></tr></thead><tbody><tr><td><a href="https://www.tradingview.com/support/solutions/43000563497">After tax other income/expense</a></td><td>FQ, FH, FY, TTM</td><td>AFTER_TAX_OTHER_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670320">Average basic shares outstanding</a></td><td>FQ, FH, FY</td><td>BASIC_SHARES_OUTSTANDING</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563520">Basic earnings per share (Basic EPS)</a></td><td>FQ, FH, FY, TTM</td><td>EARNINGS_PER_SHARE_BASIC</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553618">Cost of goods sold</a></td><td>FQ, FH, FY, TTM</td><td>COST_OF_GOODS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563477">Deprecation and amortization</a></td><td>FQ, FH, FY, TTM</td><td>DEP_AMORT_EXP_INCOME_S</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553616">Diluted earnings per share (Diluted EPS)</a></td><td>FQ, FH, FY, TTM</td><td>EARNINGS_PER_SHARE_DILUTED</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563516">Diluted net income available to common stockholders</a></td><td>FQ, FH, FY, TTM</td><td>DILUTED_NET_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670322">Diluted shares outstanding</a></td><td>FQ, FH, FY</td><td>DILUTED_SHARES_OUTSTANDING</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563504">Dilution adjustment</a></td><td>FQ, FH, FY, TTM</td><td>DILUTION_ADJUSTMENT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563502">Discontinued operations</a></td><td>FQ, FH, FY, TTM</td><td>DISCONTINUED_OPERATIONS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670329">EBIT</a></td><td>FQ, FH, FY, TTM</td><td>EBIT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553610">EBITDA</a></td><td>FQ, FH, FY, TTM</td><td>EBITDA</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563487">Equity in earnings</a></td><td>FQ, FH, FY, TTM</td><td>EQUITY_IN_EARNINGS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553611">Gross profit</a></td><td>FQ, FH, FY, TTM</td><td>GROSS_PROFIT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563468">Interest capitalized</a></td><td>FQ, FH, FY, TTM</td><td>INTEREST_CAPITALIZED</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563467">Interest expense on debt</a></td><td>FQ, FH, FY, TTM</td><td>INTEREST_EXPENSE_ON_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563466">Interest expense, net of interest capitalized</a></td><td>FQ, FH, FY, TTM</td><td>NON_OPER_INTEREST_EXP</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563479">Miscellaneous non-operating expense</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553617">Net income</a></td><td>FQ, FH, FY, TTM</td><td>NET_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563500">Net income before discontinued operations</a></td><td>FQ, FH, FY, TTM</td><td>NET_INCOME_BEF_DISC_OPER</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563495">Non-controlling/minority interest</a></td><td>FQ, FH, FY, TTM</td><td>MINORITY_INTEREST_EXP</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563471">Non-operating income, excl. interest expenses</a></td><td>FQ, FH, FY, TTM</td><td>NON_OPER_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563465">Non-operating income, total</a></td><td>FQ, FH, FY, TTM</td><td>TOTAL_NON_OPER_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563473">Non-operating interest income</a></td><td>FQ, FH, FY, TTM</td><td>NON_OPER_INTEREST_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563463">Operating expenses (excl. COGS)</a></td><td>FQ, FH, FY, TTM</td><td>OPERATING_EXPENSES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563464">Operating income</a></td><td>FQ, FH, FY, TTM</td><td>OPER_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563478">Other cost of goods sold</a></td><td>FQ, FH, FY, TTM</td><td>COST_OF_GOODS_EXCL_DEP_AMORT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563483">Other operating expenses, total</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_OPER_EXPENSE_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563506">Preferred dividends</a></td><td>FQ, FH, FY, TTM</td><td>PREFERRED_DIVIDENDS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563474">Pretax equity in earnings</a></td><td>FQ, FH, FY, TTM</td><td>PRETAX_EQUITY_IN_EARNINGS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563462">Pretax income</a></td><td>FQ, FH, FY, TTM</td><td>PRETAX_INCOME</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553612">Research &amp; development</a></td><td>FQ, FH, FY, TTM</td><td>RESEARCH_AND_DEV</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553614">Selling/general/admin expenses, other</a></td><td>FQ, FH, FY, TTM</td><td>SELL_GEN_ADMIN_EXP_OTHER</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553613">Selling/general/admin expenses, total</a></td><td>FQ, FH, FY, TTM</td><td>SELL_GEN_ADMIN_EXP_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563492">Taxes</a></td><td>FQ, FH, FY, TTM</td><td>INCOME_TAX</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553615">Total operating expenses</a></td><td>FQ, FH, FY, TTM</td><td>TOTAL_OPER_EXPENSE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553619">Total revenue</a></td><td>FQ, FH, FY, TTM</td><td>TOTAL_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563476">Unusual income/expense</a></td><td>FQ, FH, FY, TTM</td><td>UNUSUAL_EXPENSE_INC</td></tr></tbody></table></details>
<h4 class="md-heading" id="balance-sheet"><a href="#balance-sheet">Balance sheet<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>This table lists the metrics that provide information about a company’s
capital structure.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th>Financial</th><th><code dir="auto">period</code></th><th><code dir="auto">financial_id</code></th></tr></thead><tbody><tr><td><a href="https://www.tradingview.com/support/solutions/43000563619">Accounts payable</a></td><td>FQ, FH, FY</td><td>ACCOUNTS_PAYABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563740">Accounts receivable - trade, net</a></td><td>FQ, FH, FY</td><td>ACCOUNTS_RECEIVABLES_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563628">Accrued payroll</a></td><td>FQ, FH, FY</td><td>ACCRUED_PAYROLL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563673">Accumulated depreciation, total</a></td><td>FQ, FH, FY</td><td>ACCUM_DEPREC_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563874">Additional paid-in capital/Capital surplus</a></td><td>FQ, FH, FY</td><td>ADDITIONAL_PAID_IN_CAPITAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670330">Book value per share</a></td><td>FQ, FH, FY</td><td>BOOK_VALUE_PER_SHARE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563522">Capital and operating lease obligations</a></td><td>FQ, FH, FY</td><td>CAPITAL_OPERATING_LEASE_OBLIGATIONS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563527">Capitalized lease obligations</a></td><td>FQ, FH, FY</td><td>CAPITAL_LEASE_OBLIGATIONS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563709">Cash &amp; equivalents</a></td><td>FQ, FH, FY</td><td>CASH_N_EQUIVALENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563702">Cash and short term investments</a></td><td>FQ, FH, FY</td><td>CASH_N_SHORT_TERM_INVEST</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563866">Common equity, total</a></td><td>FQ, FH, FY</td><td>COMMON_EQUITY_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563873">Common stock par/Carrying value</a></td><td>FQ, FH, FY</td><td>COMMON_STOCK_PAR</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563557">Current portion of LT debt and capital leases</a></td><td>FQ, FH, FY</td><td>CURRENT_PORT_DEBT_CAPITAL_LEASES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563631">Deferred income, current</a></td><td>FQ, FH, FY</td><td>DEFERRED_INCOME_CURRENT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563540">Deferred income, non-current</a></td><td>FQ, FH, FY</td><td>DEFERRED_INCOME_NON_CURRENT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563683">Deferred tax assets</a></td><td>FQ, FH, FY</td><td>DEFERRED_TAX_ASSESTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563536">Deferred tax liabilities</a></td><td>FQ, FH, FY</td><td>DEFERRED_TAX_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563624">Dividends payable</a></td><td>FY</td><td>DIVIDENDS_PAYABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563688">Goodwill, net</a></td><td>FQ, FH, FY</td><td>GOODWILL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563667">Gross property/plant/equipment</a></td><td>FQ, FH, FY</td><td>PPE_TOTAL_GROSS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563621">Income tax payable</a></td><td>FQ, FH, FY</td><td>INCOME_TAX_PAYABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563749">Inventories - finished goods</a></td><td>FQ, FH, FY</td><td>INVENTORY_FINISHED_GOODS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563748">Inventories - progress payments &amp; other</a></td><td>FQ, FH, FY</td><td>INVENTORY_PROGRESS_PAYMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563753">Inventories - raw materials</a></td><td>FQ, FH, FY</td><td>INVENTORY_RAW_MATERIALS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563746">Inventories - work in progress</a></td><td>FQ, FH, FY</td><td>INVENTORY_WORK_IN_PROGRESS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563645">Investments in unconsolidated subsidiaries</a></td><td>FQ, FH, FY</td><td>INVESTMENTS_IN_UNCONCSOLIDATE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553621">Long term debt</a></td><td>FQ, FH, FY</td><td>LONG_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563521">Long term debt excl. lease liabilities</a></td><td>FQ, FH, FY</td><td>LONG_TERM_DEBT_EXCL_CAPITAL_LEASE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563639">Long term investments</a></td><td>FQ, FH, FY</td><td>LONG_TERM_INVESTMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563884">Minority interest</a></td><td>FQ, FH, FY</td><td>MINORITY_INTEREST</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000665310">Net debt</a></td><td>FQ, FH, FY</td><td>NET_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563686">Net intangible assets</a></td><td>FQ, FH, FY</td><td>INTANGIBLES_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563657">Net property/plant/equipment</a></td><td>FQ, FH, FY</td><td>PPE_TOTAL_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563641">Note receivable - long term</a></td><td>FQ, FH, FY</td><td>LONG_TERM_NOTE_RECEIVABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563600">Notes payable</a></td><td>FY</td><td>NOTES_PAYABLE_SHORT_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563532">Operating lease liabilities</a></td><td>FQ, FH, FY</td><td>OPERATING_LEASE_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563877">Other common equity</a></td><td>FQ, FH, FY</td><td>OTHER_COMMON_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563761">Other current assets, total</a></td><td>FQ, FH, FY</td><td>OTHER_CURRENT_ASSETS_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563635">Other current liabilities</a></td><td>FQ, FH, FY</td><td>OTHER_CURRENT_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563689">Other intangibles, net</a></td><td>FQ, FH, FY</td><td>OTHER_INTANGIBLES_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563649">Other investments</a></td><td>FQ, FH, FY</td><td>OTHER_INVESTMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563693">Other long term assets, total</a></td><td>FQ, FH, FY</td><td>LONG_TERM_OTHER_ASSETS_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563545">Other non-current liabilities, total</a></td><td>FQ, FH, FY</td><td>OTHER_LIABILITIES_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563741">Other receivables</a></td><td>FQ, FH, FY</td><td>OTHER_RECEIVABLES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563614">Other short term debt</a></td><td>FY</td><td>OTHER_SHORT_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563871">Paid in capital</a></td><td>FQ, FH, FY</td><td>PAID_IN_CAPITAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563879">Preferred stock, carrying value</a></td><td>FQ, FH, FY</td><td>PREFERRED_STOCK_CARRYING_VALUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563757">Prepaid expenses</a></td><td>FQ, FH, FY</td><td>PREPAID_EXPENSES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563535">Provision for risks &amp; charge</a></td><td>FQ, FH, FY</td><td>PROVISION_F_RISKS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563867">Retained earnings</a></td><td>FQ, FH, FY</td><td>RETAINED_EARNINGS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000557442">Shareholders’ equity</a></td><td>FQ, FH, FY</td><td>SHRHLDRS_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563554">Short term debt</a></td><td>FQ, FH, FY</td><td>SHORT_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563563">Short term debt excl. current portion of LT debt</a></td><td>FQ, FH, FY</td><td>SHORT_TERM_DEBT_EXCL_CURRENT_PORT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563716">Short term investments</a></td><td>FQ, FH, FY</td><td>SHORT_TERM_INVEST</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597072">Tangible book value per share</a></td><td>FQ, FH, FY</td><td>BOOK_TANGIBLE_PER_SHARE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553623">Total assets</a></td><td>FQ, FH, FY</td><td>TOTAL_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000557441">Total current assets</a></td><td>FQ, FH, FY</td><td>TOTAL_CURRENT_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000557437">Total current liabilities</a></td><td>FQ, FH, FY</td><td>TOTAL_CURRENT_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553622">Total debt</a></td><td>FQ, FH, FY</td><td>TOTAL_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553625">Total equity</a></td><td>FQ, FH, FY</td><td>TOTAL_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563745">Total inventory</a></td><td>FQ, FH, FY</td><td>TOTAL_INVENTORY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553624">Total liabilities</a></td><td>FQ, FH, FY</td><td>TOTAL_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553626">Total liabilities &amp; shareholders’ equities</a></td><td>FQ, FH, FY</td><td>TOTAL_LIABILITIES_SHRHLDRS_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000557440">Total non-current assets</a></td><td>FQ, FH, FY</td><td>TOTAL_NON_CURRENT_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000557436">Total non-current liabilities</a></td><td>FQ, FH, FY</td><td>TOTAL_NON_CURRENT_LIABILITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563738">Total receivables, net</a></td><td>FQ, FH, FY</td><td>TOTAL_RECEIVABLES_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563875">Treasury stock - common</a></td><td>FQ, FH, FY</td><td>TREASURY_STOCK_COMMON</td></tr></tbody></table></details>
<h4 class="md-heading" id="cash-flow"><a href="#cash-flow">Cash flow<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>This table lists the available metrics that provide information about
how cash flows through a company.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th>Financial</th><th><code dir="auto">period</code></th><th><code dir="auto">financial_id</code></th></tr></thead><tbody><tr><td><a href="https://www.tradingview.com/support/solutions/43000564143">Amortization</a></td><td>FQ, FH, FY, TTM</td><td>AMORTIZATION</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564166">Capital expenditures</a></td><td>FQ, FH, FY, TTM</td><td>CAPITAL_EXPENDITURES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564167">Capital expenditures - fixed assets</a></td><td>FQ, FH, FY, TTM</td><td>CAPITAL_EXPENDITURES_FIXED_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564168">Capital expenditures - other assets</a></td><td>FQ, FH, FY, TTM</td><td>CAPITAL_EXPENDITURES_OTHER_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553629">Cash from financing activities</a></td><td>FQ, FH, FY, TTM</td><td>CASH_F_FINANCING_ACTIVITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553628">Cash from investing activities</a></td><td>FQ, FH, FY, TTM</td><td>CASH_F_INVESTING_ACTIVITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553627">Cash from operating activities</a></td><td>FQ, FH, FY, TTM</td><td>CASH_F_OPERATING_ACTIVITIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564150">Change in accounts payable</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_ACCOUNTS_PAYABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564148">Change in accounts receivable</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_ACCOUNTS_RECEIVABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564151">Change in accrued expenses</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_ACCRUED_EXPENSES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564153">Change in inventories</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_INVENTORIES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564154">Change in other assets/liabilities</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_OTHER_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564149">Change in taxes payable</a></td><td>FQ, FH, FY, TTM</td><td>CHANGE_IN_TAXES_PAYABLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564147">Changes in working capital</a></td><td>FQ, FH, FY, TTM</td><td>CHANGES_IN_WORKING_CAPITAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564185">Common dividends paid</a></td><td>FQ, FH, FY, TTM</td><td>COMMON_DIVIDENDS_CASH_FLOW</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564144">Deferred taxes (cash flow)</a></td><td>FQ, FH, FY, TTM</td><td>CASH_FLOW_DEFERRED_TAXES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563892">Depreciation &amp; amortization (cash flow)</a></td><td>FQ, FH, FY, TTM</td><td>CASH_FLOW_DEPRECATION_N_AMORTIZATION</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564142">Depreciation/depletion</a></td><td>FQ, FH, FY, TTM</td><td>DEPRECIATION_DEPLETION</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564181">Financing activities - other sources</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_FINANCING_CASH_FLOW_SOURCES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564182">Financing activities - other uses</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_FINANCING_CASH_FLOW_USES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000553630">Free cash flow</a></td><td>FQ, FH, FY, TTM</td><td>FREE_CASH_FLOW</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563886">Funds from operations</a></td><td>FQ, FH, FY, TTM</td><td>FUNDS_F_OPERATIONS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564164">Investing activities - other sources</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_INVESTING_CASH_FLOW_SOURCES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564165">Investing activities - other uses</a></td><td>FQ, FH, FY</td><td>OTHER_INVESTING_CASH_FLOW_USES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564176">Issuance of long term debt</a></td><td>FQ, FH, FY, TTM</td><td>SUPPLYING_OF_LONG_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564172">Issuance/retirement of debt, net</a></td><td>FQ, FH, FY, TTM</td><td>ISSUANCE_OF_DEBT_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564175">Issuance/retirement of long term debt</a></td><td>FQ, FH, FY, TTM</td><td>ISSUANCE_OF_LONG_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564178">Issuance/retirement of other debt</a></td><td>FQ, FH, FY, TTM</td><td>ISSUANCE_OF_OTHER_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564173">Issuance/retirement of short term debt</a></td><td>FQ, FH, FY, TTM</td><td>ISSUANCE_OF_SHORT_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564169">Issuance/retirement of stock, net</a></td><td>FQ, FH, FY, TTM</td><td>ISSUANCE_OF_STOCK_NET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000563888">Net income (cash flow)</a></td><td>FQ, FH, FY, TTM</td><td>NET_INCOME_STARTING_LINE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564146">Non-cash items</a></td><td>FQ, FH, FY, TTM</td><td>NON_CASH_ITEMS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564179">Other financing cash flow items, total</a></td><td>FQ, FH, FY, TTM</td><td>OTHER_FINANCING_CASH_FLOW_ITEMS_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564163">Other investing cash flow items, total</a></td><td>FQ, FH, FY</td><td>OTHER_INVESTING_CASH_FLOW_ITEMS_TOTAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564186">Preferred dividends paid</a></td><td>FQ, FH, FY</td><td>PREFERRED_DIVIDENDS_CASH_FLOW</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564162">Purchase of investments</a></td><td>FQ, FH, FY, TTM</td><td>PURCHASE_OF_INVESTMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564159">Purchase/acquisition of business</a></td><td>FQ, FH, FY, TTM</td><td>PURCHASE_OF_BUSINESS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564156">Purchase/sale of business, net</a></td><td>FQ, FH, FY</td><td>PURCHASE_SALE_BUSINESS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564160">Purchase/sale of investments, net</a></td><td>FQ, FH, FY, TTM</td><td>PURCHASE_SALE_INVESTMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564177">Reduction of long term debt</a></td><td>FQ, FH, FY, TTM</td><td>REDUCTION_OF_LONG_TERM_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564171">Repurchase of common &amp; preferred stock</a></td><td>FQ, FH, FY, TTM</td><td>PURCHASE_OF_STOCK</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564170">Sale of common &amp; preferred stock</a></td><td>FQ, FH, FY, TTM</td><td>SALE_OF_STOCK</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564158">Sale of fixed assets &amp; businesses</a></td><td>FQ, FH, FY, TTM</td><td>SALES_OF_BUSINESS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564161">Sale/maturity of investments</a></td><td>FQ, FH, FY</td><td>SALES_OF_INVESTMENTS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000564183">Total cash dividends paid</a></td><td>FQ, FH, FY, TTM</td><td>TOTAL_CASH_DIVIDENDS_PAID</td></tr></tbody></table></details>
<h4 class="md-heading" id="statistics"><a href="#statistics">Statistics<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>This table contains a variety of statistical metrics, including commonly
used financial ratios.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th>Financial</th><th><code dir="auto">period</code></th><th><code dir="auto">financial_id</code></th></tr></thead><tbody><tr><td><a href="https://www.tradingview.com/support/solutions/43000597073">Accruals</a></td><td>FQ, FH, FY</td><td>ACCRUALS_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597092">Altman Z-score</a></td><td>FQ, FH, FY</td><td>ALTMAN_Z_SCORE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597022">Asset turnover</a></td><td>FQ, FH, FY</td><td>ASSET_TURNOVER</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597835">Beneish M-score</a></td><td>FQ, FH, FY</td><td>BENEISH_M_SCORE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597088">Buyback yield %</a></td><td>FQ, FH, FY</td><td>BUYBACK_YIELD</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597026">COGS to revenue ratio</a></td><td>FQ, FH, FY</td><td>COGS_TO_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597089">Cash conversion cycle</a></td><td>FQ, FY</td><td>CASH_CONVERSION_CYCLE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597023">Cash to debt ratio</a></td><td>FQ, FH, FY</td><td>CASH_TO_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597051">Current ratio</a></td><td>FQ, FH, FY</td><td>CURRENT_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597028">Days inventory</a></td><td>FQ, FY</td><td>DAYS_INVENT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597029">Days payable</a></td><td>FQ, FY</td><td>DAYS_PAY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597030">Days sales outstanding</a></td><td>FQ, FY</td><td>DAY_SALES_OUT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597032">Debt to EBITDA ratio</a></td><td>FQ, FH, FY</td><td>DEBT_TO_EBITDA</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597031">Debt to assets ratio</a></td><td>FQ, FH, FY</td><td>DEBT_TO_ASSET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597078">Debt to equity ratio</a></td><td>FQ, FH, FY</td><td>DEBT_TO_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597033">Debt to revenue ratio</a></td><td>FQ, FH, FY</td><td>DEBT_TO_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597738">Dividend payout ratio %</a></td><td>FQ, FH, FY, TTM</td><td>DIVIDEND_PAYOUT_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597817">Dividend yield %</a></td><td>FQ, FH, FY</td><td>DIVIDENDS_YIELD</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670334">Dividends per share - common stock primary issue</a></td><td>FQ, FH, FY, TTM</td><td>DPS_COMMON_STOCK_PRIM_ISSUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597075">EBITDA margin %</a></td><td>FQ, FH, FY, TTM</td><td>EBITDA_MARGIN</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597069">EPS basic one year growth</a></td><td>FQ, FH, FY, TTM</td><td>EARNINGS_PER_SHARE_BASIC_ONE_YEAR_GROWTH</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597071">EPS diluted one year growth</a></td><td>FQ, FH, FY</td><td>EARNINGS_PER_SHARE_DILUTED_ONE_YEAR_GROWTH</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597066">EPS estimates</a></td><td>FQ, FH, FY</td><td>EARNINGS_ESTIMATE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597034">Effective interest rate on debt %</a></td><td>FQ, FH, FY</td><td>EFFECTIVE_INTEREST_RATE_ON_DEBT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597077">Enterprise value</a></td><td>FQ, FH, FY</td><td>ENTERPRISE_VALUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597063">Enterprise value to EBIT ratio</a></td><td>FQ, FH, FY</td><td>EV_EBIT</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597064">Enterprise value to EBITDA ratio</a></td><td>FQ, FH, FY</td><td>ENTERPRISE_VALUE_EBITDA</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597065">Enterprise value to revenue ratio</a></td><td>FQ, FH, FY</td><td>EV_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597035">Equity to assets ratio</a></td><td>FQ, FH, FY</td><td>EQUITY_TO_ASSET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670341">Float shares outstanding</a></td><td>FY</td><td>FLOAT_SHARES_OUTSTANDING</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597813">Free cash flow margin %</a></td><td>FQ, FH, FY</td><td>FREE_CASH_FLOW_MARGIN</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597847">Fulmer H factor</a></td><td>FQ, FY</td><td>FULMER_H_FACTOR</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597036">Goodwill to assets ratio</a></td><td>FQ, FH, FY</td><td>GOODWILL_TO_ASSET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597084">Graham’s number</a></td><td>FQ, FY</td><td>GRAHAM_NUMBERS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597811">Gross margin %</a></td><td>FQ, FH, FY, TTM</td><td>GROSS_MARGIN</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597087">Gross profit to assets ratio</a></td><td>FQ, FY</td><td>GROSS_PROFIT_TO_ASSET</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597037">Interest coverage</a></td><td>FQ, FH, FY</td><td>INTERST_COVER</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597047">Inventory to revenue ratio</a></td><td>FQ, FH, FY</td><td>INVENT_TO_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597046">Inventory turnover</a></td><td>FQ, FH, FY</td><td>INVENT_TURNOVER</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597844">KZ index</a></td><td>FY</td><td>KZ_INDEX</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597048">Long term debt to total assets ratio</a></td><td>FQ, FH, FY</td><td>LONG_TERM_DEBT_TO_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597085">Net current asset value per share</a></td><td>FQ, FY</td><td>NCAVPS_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597082">Net income per employee</a></td><td>FY</td><td>NET_INCOME_PER_EMPLOYEE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597074">Net margin %</a></td><td>FQ, FH, FY, TTM</td><td>NET_MARGIN</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597080">Number of employees</a></td><td>FY</td><td>NUMBER_OF_EMPLOYEES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000684072">Operating earnings yield %</a></td><td>FQ, FH, FY</td><td>OPERATING_EARNINGS_YIELD</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597076">Operating margin %</a></td><td>FQ, FH, FY</td><td>OPERATING_MARGIN</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597090">PEG ratio</a></td><td>FQ, FY</td><td>PEG_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597734">Piotroski F-score</a></td><td>FQ, FH, FY</td><td>PIOTROSKI_F_SCORE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597831">Price earnings ratio forward</a></td><td>FQ, FY</td><td>PRICE_EARNINGS_FORWARD</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597832">Price sales ratio forward</a></td><td>FQ, FY</td><td>PRICE_SALES_FORWARD</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597086">Quality ratio</a></td><td>FQ, FH, FY</td><td>QUALITY_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597050">Quick ratio</a></td><td>FQ, FH, FY</td><td>QUICK_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597739">Research &amp; development to revenue ratio</a></td><td>FQ, FH, FY</td><td>RESEARCH_AND_DEVELOP_TO_REVENUE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597054">Return on assets %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000656797">Return on common equity %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_COMMON_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597021">Return on equity %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597055">Return on equity adjusted to book value %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_EQUITY_ADJUST_TO_BOOK</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597056">Return on invested capital %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_INVESTED_CAPITAL</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597052">Return on tangible assets %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_TANG_ASSETS</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597053">Return on tangible equity %</a></td><td>FQ, FH, FY</td><td>RETURN_ON_TANG_EQUITY</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597067">Revenue estimates</a></td><td>FQ, FH, FY</td><td>SALES_ESTIMATES</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597068">Revenue one year growth</a></td><td>FQ, FH, FY, TTM</td><td>REVENUE_ONE_YEAR_GROWTH</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597081">Revenue per employee</a></td><td>FY</td><td>REVENUE_PER_EMPLOYEE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597057">Shares buyback ratio %</a></td><td>FQ, FH, FY</td><td>SHARE_BUYBACK_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597058">Sloan ratio %</a></td><td>FQ, FH, FY</td><td>SLOAN_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597848">Springate score</a></td><td>FQ, FY</td><td>SPRINGATE_SCORE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597736">Sustainable growth rate</a></td><td>FQ, FY</td><td>SUSTAINABLE_GROWTH_RATE</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597079">Tangible common equity ratio</a></td><td>FQ, FH, FY</td><td>TANGIBLE_COMMON_EQUITY_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597834">Tobin’s Q (approximate)</a></td><td>FQ, FH, FY</td><td>TOBIN_Q_RATIO</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000670331">Total common shares outstanding</a></td><td>FQ, FH, FY</td><td>TOTAL_SHARES_OUTSTANDING</td></tr><tr><td><a href="https://www.tradingview.com/support/solutions/43000597850">Zmijewski score</a></td><td>FQ, FY</td><td>ZMIJEWSKI_SCORE</td></tr></tbody></table></details>
<h2 class="md-heading" id="requesteconomic"><a href="#requesteconomic">`request.economic()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a>
function provides scripts with the ability to retrieve economic data for
a specified country or region, including information about the state of
the economy (GDP, inflation rate, etc.) or of a particular industry
(steel production, ICU beds, etc.).</p>
<p>Below is the signature for this function:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.economic(country_code, field, gaps, ignore_invalid_symbol) → series float</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">country_code</code> parameter accepts a “string” value representing
the identifier of the country or region to request economic data for
(e.g., “US”, “EU”, etc.). See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#countryregion-codes">Country/region codes</a> section for a complete list of codes this function supports.
Note that the economic metrics available depend on the country or region
specified in the function call.</p>
<p>The <code dir="auto">field</code> parameter accepts a “string” specifying the metric that the function requests.
The
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#field-codes">Field codes</a> section covers all accessible metrics and the
countries/regions they’re available for.</p>
<p>For a detailed explanation on the last two parameters of this function,
see the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#common-characteristics">Common characteristics</a> section at the top of this page.</p>
<p>This simple example requests the growth rate of the Gross Domestic
Product (“GDPQQ”) for the United States (“US”) using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a>,
then <a href="/pine-script-docs/v5/concepts/plots/">plots</a> its value on the
chart with a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.from_gradient">gradient
color</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/f180b9ad3a0004033389922c021854fa.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requesting economic data demo")

//@variable The GDP growth rate for the US economy.
float gdpqq = request.economic("US", "GDPQQ")

//@variable The all-time maximum growth rate.
float maxRate = ta.max(gdpqq)
//@variable The all-time minimum growth rate.
float minRate = ta.min(gdpqq)

//@variable The color of the `gdpqq` plot.
color rateColor = switch
    gdpqq &gt;= 0 =&gt; color.from_gradient(gdpqq, 0, maxRate, color.purple, color.blue)
    =&gt;            color.from_gradient(gdpqq, minRate, 0, color.red, color.purple)

// Plot the results.
plot(gdpqq, "US GDP Growth Rate", rateColor, style = plot.style_area)</code></div>
<p>Note that:</p>
<ul>
<li>This example does not include a <code dir="auto">gaps</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a>
call, so the function uses the default
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.gaps_off">barmerge.gaps_off</a>.
In other words, it returns the last retrieved value when new
data isn’t yet available.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The tables in the sections below are rather large, as there are numerous
<code dir="auto">country_code</code> and <code dir="auto">field</code> arguments available. Use the <strong>“Click to
show/hide”</strong> option above each table to toggle its visibility.</p></div></aside>
<h3 class="md-heading" id="countryregion-codes"><a href="#countryregion-codes">Country/region codes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The table in this section lists all country/region codes available for
use with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a>.
The first column of the table contains the “string” values that
represent the country or region code, and the second column contains the
corresponding country/region names.</p>
<p>It’s important to note that the value used as the <code dir="auto">country_code</code>
argument determines which
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#field-codes">field codes</a> are accessible to the function.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th><code dir="auto">country_code</code></th><th>Country/region name</th></tr></thead><tbody><tr><td>AF</td><td>Afghanistan</td></tr><tr><td>AL</td><td>Albania</td></tr><tr><td>DZ</td><td>Algeria</td></tr><tr><td>AD</td><td>Andorra</td></tr><tr><td>AO</td><td>Angola</td></tr><tr><td>AG</td><td>Antigua and Barbuda</td></tr><tr><td>AR</td><td>Argentina</td></tr><tr><td>AM</td><td>Armenia</td></tr><tr><td>AW</td><td>Aruba</td></tr><tr><td>AU</td><td>Australia</td></tr><tr><td>AT</td><td>Austria</td></tr><tr><td>AZ</td><td>Azerbaijan</td></tr><tr><td>BS</td><td>Bahamas</td></tr><tr><td>BH</td><td>Bahrain</td></tr><tr><td>BD</td><td>Bangladesh</td></tr><tr><td>BB</td><td>Barbados</td></tr><tr><td>BY</td><td>Belarus</td></tr><tr><td>BE</td><td>Belgium</td></tr><tr><td>BZ</td><td>Belize</td></tr><tr><td>BJ</td><td>Benin</td></tr><tr><td>BM</td><td>Bermuda</td></tr><tr><td>BT</td><td>Bhutan</td></tr><tr><td>BO</td><td>Bolivia</td></tr><tr><td>BA</td><td>Bosnia and Herzegovina</td></tr><tr><td>BW</td><td>Botswana</td></tr><tr><td>BR</td><td>Brazil</td></tr><tr><td>BN</td><td>Brunei</td></tr><tr><td>BG</td><td>Bulgaria</td></tr><tr><td>BF</td><td>Burkina Faso</td></tr><tr><td>BI</td><td>Burundi</td></tr><tr><td>KH</td><td>Cambodia</td></tr><tr><td>CM</td><td>Cameroon</td></tr><tr><td>CA</td><td>Canada</td></tr><tr><td>CV</td><td>Cape Verde</td></tr><tr><td>KY</td><td>Cayman Islands</td></tr><tr><td>CF</td><td>Central African Republic</td></tr><tr><td>TD</td><td>Chad</td></tr><tr><td>CL</td><td>Chile</td></tr><tr><td>CN</td><td>China</td></tr><tr><td>CO</td><td>Colombia</td></tr><tr><td>KM</td><td>Comoros</td></tr><tr><td>CG</td><td>Congo</td></tr><tr><td>CR</td><td>Costa Rica</td></tr><tr><td>HR</td><td>Croatia</td></tr><tr><td>CU</td><td>Cuba</td></tr><tr><td>CY</td><td>Cyprus</td></tr><tr><td>CZ</td><td>Czech Republic</td></tr><tr><td>DK</td><td>Denmark</td></tr><tr><td>DJ</td><td>Djibouti</td></tr><tr><td>DM</td><td>Dominica</td></tr><tr><td>DO</td><td>Dominican Republic</td></tr><tr><td>TL</td><td>East Timor</td></tr><tr><td>EC</td><td>Ecuador</td></tr><tr><td>EG</td><td>Egypt</td></tr><tr><td>SV</td><td>El Salvador</td></tr><tr><td>GQ</td><td>Equatorial Guinea</td></tr><tr><td>ER</td><td>Eritrea</td></tr><tr><td>EE</td><td>Estonia</td></tr><tr><td>ET</td><td>Ethiopia</td></tr><tr><td>EU</td><td>Euro area</td></tr><tr><td>FO</td><td>Faroe Islands</td></tr><tr><td>FJ</td><td>Fiji</td></tr><tr><td>FI</td><td>Finland</td></tr><tr><td>FR</td><td>France</td></tr><tr><td>GA</td><td>Gabon</td></tr><tr><td>GM</td><td>Gambia</td></tr><tr><td>GE</td><td>Georgia</td></tr><tr><td>DE</td><td>Germany</td></tr><tr><td>GH</td><td>Ghana</td></tr><tr><td>GR</td><td>Greece</td></tr><tr><td>GL</td><td>Greenland</td></tr><tr><td>GD</td><td>Grenada</td></tr><tr><td>GT</td><td>Guatemala</td></tr><tr><td>GN</td><td>Guinea</td></tr><tr><td>GW</td><td>Guinea Bissau</td></tr><tr><td>GY</td><td>Guyana</td></tr><tr><td>HT</td><td>Haiti</td></tr><tr><td>HN</td><td>Honduras</td></tr><tr><td>HK</td><td>Hong Kong</td></tr><tr><td>HU</td><td>Hungary</td></tr><tr><td>IS</td><td>Iceland</td></tr><tr><td>IN</td><td>India</td></tr><tr><td>ID</td><td>Indonesia</td></tr><tr><td>IR</td><td>Iran</td></tr><tr><td>IQ</td><td>Iraq</td></tr><tr><td>IE</td><td>Ireland</td></tr><tr><td>IM</td><td>Isle of Man</td></tr><tr><td>IL</td><td>Israel</td></tr><tr><td>IT</td><td>Italy</td></tr><tr><td>CI</td><td>Ivory Coast</td></tr><tr><td>JM</td><td>Jamaica</td></tr><tr><td>JP</td><td>Japan</td></tr><tr><td>JO</td><td>Jordan</td></tr><tr><td>KZ</td><td>Kazakhstan</td></tr><tr><td>KE</td><td>Kenya</td></tr><tr><td>KI</td><td>Kiribati</td></tr><tr><td>XK</td><td>Kosovo</td></tr><tr><td>KW</td><td>Kuwait</td></tr><tr><td>KG</td><td>Kyrgyzstan</td></tr><tr><td>LA</td><td>Laos</td></tr><tr><td>LV</td><td>Latvia</td></tr><tr><td>LB</td><td>Lebanon</td></tr><tr><td>LS</td><td>Lesotho</td></tr><tr><td>LR</td><td>Liberia</td></tr><tr><td>LY</td><td>Libya</td></tr><tr><td>LI</td><td>Liechtenstein</td></tr><tr><td>LT</td><td>Lithuania</td></tr><tr><td>LU</td><td>Luxembourg</td></tr><tr><td>MO</td><td>Macau</td></tr><tr><td>MK</td><td>Macedonia</td></tr><tr><td>MG</td><td>Madagascar</td></tr><tr><td>MW</td><td>Malawi</td></tr><tr><td>MY</td><td>Malaysia</td></tr><tr><td>MV</td><td>Maldives</td></tr><tr><td>ML</td><td>Mali</td></tr><tr><td>MT</td><td>Malta</td></tr><tr><td>MR</td><td>Mauritania</td></tr><tr><td>MU</td><td>Mauritius</td></tr><tr><td>MX</td><td>Mexico</td></tr><tr><td>MD</td><td>Moldova</td></tr><tr><td>MC</td><td>Monaco</td></tr><tr><td>MN</td><td>Mongolia</td></tr><tr><td>ME</td><td>Montenegro</td></tr><tr><td>MA</td><td>Morocco</td></tr><tr><td>MZ</td><td>Mozambique</td></tr><tr><td>MM</td><td>Myanmar</td></tr><tr><td>NA</td><td>Namibia</td></tr><tr><td>NP</td><td>Nepal</td></tr><tr><td>NL</td><td>Netherlands</td></tr><tr><td>NC</td><td>New Caledonia</td></tr><tr><td>NZ</td><td>New Zealand</td></tr><tr><td>NI</td><td>Nicaragua</td></tr><tr><td>NE</td><td>Niger</td></tr><tr><td>NG</td><td>Nigeria</td></tr><tr><td>KP</td><td>North Korea</td></tr><tr><td>NO</td><td>Norway</td></tr><tr><td>OM</td><td>Oman</td></tr><tr><td>PK</td><td>Pakistan</td></tr><tr><td>PS</td><td>Palestine</td></tr><tr><td>PA</td><td>Panama</td></tr><tr><td>PG</td><td>Papua New Guinea</td></tr><tr><td>PY</td><td>Paraguay</td></tr><tr><td>PE</td><td>Peru</td></tr><tr><td>PH</td><td>Philippines</td></tr><tr><td>PL</td><td>Poland</td></tr><tr><td>PT</td><td>Portugal</td></tr><tr><td>PR</td><td>Puerto Rico</td></tr><tr><td>QA</td><td>Qatar</td></tr><tr><td>CD</td><td>Republic of the Congo</td></tr><tr><td>RO</td><td>Romania</td></tr><tr><td>RU</td><td>Russia</td></tr><tr><td>RW</td><td>Rwanda</td></tr><tr><td>WS</td><td>Samoa</td></tr><tr><td>SM</td><td>San Marino</td></tr><tr><td>ST</td><td>Sao Tome and Principe</td></tr><tr><td>SA</td><td>Saudi Arabia</td></tr><tr><td>SN</td><td>Senegal</td></tr><tr><td>RS</td><td>Serbia</td></tr><tr><td>SC</td><td>Seychelles</td></tr><tr><td>SL</td><td>Sierra Leone</td></tr><tr><td>SG</td><td>Singapore</td></tr><tr><td>SK</td><td>Slovakia</td></tr><tr><td>SI</td><td>Slovenia</td></tr><tr><td>SB</td><td>Solomon Islands</td></tr><tr><td>SO</td><td>Somalia</td></tr><tr><td>ZA</td><td>South Africa</td></tr><tr><td>KR</td><td>South Korea</td></tr><tr><td>SS</td><td>South Sudan</td></tr><tr><td>ES</td><td>Spain</td></tr><tr><td>LK</td><td>Sri Lanka</td></tr><tr><td>LC</td><td>St Lucia</td></tr><tr><td>VC</td><td>St Vincent and the Grenadines</td></tr><tr><td>SD</td><td>Sudan</td></tr><tr><td>SR</td><td>Suriname</td></tr><tr><td>SZ</td><td>Swaziland</td></tr><tr><td>SE</td><td>Sweden</td></tr><tr><td>CH</td><td>Switzerland</td></tr><tr><td>SY</td><td>Syria</td></tr><tr><td>TW</td><td>Taiwan</td></tr><tr><td>TJ</td><td>Tajikistan</td></tr><tr><td>TZ</td><td>Tanzania</td></tr><tr><td>TH</td><td>Thailand</td></tr><tr><td>TG</td><td>Togo</td></tr><tr><td>TO</td><td>Tonga</td></tr><tr><td>TT</td><td>Trinidad and Tobago</td></tr><tr><td>TN</td><td>Tunisia</td></tr><tr><td>TR</td><td>Turkey</td></tr><tr><td>TM</td><td>Turkmenistan</td></tr><tr><td>UG</td><td>Uganda</td></tr><tr><td>UA</td><td>Ukraine</td></tr><tr><td>AE</td><td>United Arab Emirates</td></tr><tr><td>GB</td><td>United Kingdom</td></tr><tr><td>US</td><td>United States</td></tr><tr><td>UY</td><td>Uruguay</td></tr><tr><td>UZ</td><td>Uzbekistan</td></tr><tr><td>VU</td><td>Vanuatu</td></tr><tr><td>VE</td><td>Venezuela</td></tr><tr><td>VN</td><td>Vietnam</td></tr><tr><td>YE</td><td>Yemen</td></tr><tr><td>ZM</td><td>Zambia</td></tr><tr><td>ZW</td><td>Zimbabwe</td></tr></tbody></table></details>
<h3 class="md-heading" id="field-codes"><a href="#field-codes">Field codes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The table in this section lists the field codes available for use with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a>.
The first column contains the “string” values used as the <code dir="auto">field</code>
argument, and the second column contains names of each metric and links
to our Help Center with additional information, including the
countries/regions they’re available for.</p>
<details open=""><summary><a>Click to show/hide</a></summary>
<table><thead><tr><th><code dir="auto">field</code></th><th>Metric</th></tr></thead><tbody><tr><td>AA</td><td><a href="https://www.tradingview.com/support/solutions/43000650926">Asylum Applications</a></td></tr><tr><td>ACR</td><td><a href="https://www.tradingview.com/support/solutions/43000650920">API Crude Runs</a></td></tr><tr><td>AE</td><td><a href="https://www.tradingview.com/support/solutions/43000650927">Auto Exports</a></td></tr><tr><td>AHE</td><td><a href="https://www.tradingview.com/support/solutions/43000650928">Average Hourly Earnings</a></td></tr><tr><td>AHO</td><td><a href="https://www.tradingview.com/support/solutions/43000650924">API Heating Oil</a></td></tr><tr><td>AWH</td><td><a href="https://www.tradingview.com/support/solutions/43000650929">Average Weekly Hours</a></td></tr><tr><td>BBS</td><td><a href="https://www.tradingview.com/support/solutions/43000650932">Banks Balance Sheet</a></td></tr><tr><td>BCLI</td><td><a href="https://www.tradingview.com/support/solutions/43000650935">Business Climate Indicator</a></td></tr><tr><td>BCOI</td><td><a href="https://www.tradingview.com/support/solutions/43000650936">Business Confidence Index</a></td></tr><tr><td>BI</td><td><a href="https://www.tradingview.com/support/solutions/43000650937">Business Inventories</a></td></tr><tr><td>BLR</td><td><a href="https://www.tradingview.com/support/solutions/43000650933">Bank Lending Rate</a></td></tr><tr><td>BOI</td><td><a href="https://www.tradingview.com/support/solutions/43000651133">NFIB Business Optimism Index</a></td></tr><tr><td>BOT</td><td><a href="https://www.tradingview.com/support/solutions/43000650930">Balance Of Trade</a></td></tr><tr><td>BP</td><td><a href="https://www.tradingview.com/support/solutions/43000650934">Building Permits</a></td></tr><tr><td>BR</td><td><a href="https://www.tradingview.com/support/solutions/43000650931">Bankruptcies</a></td></tr><tr><td>CA</td><td><a href="https://www.tradingview.com/support/solutions/43000650988">Current Account</a></td></tr><tr><td>CAG</td><td><a href="https://www.tradingview.com/support/solutions/43000650987">Current Account To GDP</a></td></tr><tr><td>CAP</td><td><a href="https://www.tradingview.com/support/solutions/43000650945">Car Production</a></td></tr><tr><td>CAR</td><td><a href="https://www.tradingview.com/support/solutions/43000650946">Car Registrations</a></td></tr><tr><td>CBBS</td><td><a href="https://www.tradingview.com/support/solutions/43000650952">Central Bank Balance Sheet</a></td></tr><tr><td>CCC</td><td><a href="https://www.tradingview.com/support/solutions/43000650959">Claimant Count Change</a></td></tr><tr><td>CCI</td><td><a href="https://www.tradingview.com/support/solutions/43000650966">Consumer Confidence Index</a></td></tr><tr><td>CCOS</td><td><a href="https://www.tradingview.com/support/solutions/43000650989">Cushing Crude Oil Stocks</a></td></tr><tr><td>CCP</td><td><a href="https://www.tradingview.com/support/solutions/43000650974">Core Consumer Prices</a></td></tr><tr><td>CCPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650973">Core CPI</a></td></tr><tr><td>CCPT</td><td><a href="https://www.tradingview.com/support/solutions/43000650967">Consumer Confidence Price Trends</a></td></tr><tr><td>CCR</td><td><a href="https://www.tradingview.com/support/solutions/43000650968">Consumer Credit</a></td></tr><tr><td>CCS</td><td><a href="https://www.tradingview.com/support/solutions/43000650982">Credit Card Spending</a></td></tr><tr><td>CEP</td><td><a href="https://www.tradingview.com/support/solutions/43000650951">Cement Production</a></td></tr><tr><td>CF</td><td><a href="https://www.tradingview.com/support/solutions/43000650944">Capital Flows</a></td></tr><tr><td>CFNAI</td><td><a href="https://www.tradingview.com/support/solutions/43000650957">Chicago Fed National Activity Index</a></td></tr><tr><td>CI</td><td><a href="https://www.tradingview.com/support/solutions/43000650918">API Crude Imports</a></td></tr><tr><td>CIND</td><td><a href="https://www.tradingview.com/support/solutions/43000650960">Coincident Index</a></td></tr><tr><td>CIR</td><td><a href="https://www.tradingview.com/support/solutions/43000650975">Core Inflation Rate, YoY</a></td></tr><tr><td>CJC</td><td><a href="https://www.tradingview.com/support/solutions/43000650971">Continuing Jobless Claims</a></td></tr><tr><td>CN</td><td><a href="https://www.tradingview.com/support/solutions/43000650921">API Cushing Number</a></td></tr><tr><td>COI</td><td><a href="https://www.tradingview.com/support/solutions/43000650983">Crude Oil Imports</a></td></tr><tr><td>COIR</td><td><a href="https://www.tradingview.com/support/solutions/43000679670">Crude Oil Imports from Russia</a></td></tr><tr><td>CONSTS</td><td><a href="https://www.tradingview.com/support/solutions/43000650965">Construction Spending</a></td></tr><tr><td>COP</td><td><a href="https://www.tradingview.com/support/solutions/43000650984">Crude Oil Production</a></td></tr><tr><td>COR</td><td><a href="https://www.tradingview.com/support/solutions/43000650985">Crude Oil Rigs</a></td></tr><tr><td>CORD</td><td><a href="https://www.tradingview.com/support/solutions/43000650963">Construction Orders, YoY</a></td></tr><tr><td>CORPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650980">Corruption Index</a></td></tr><tr><td>CORR</td><td><a href="https://www.tradingview.com/support/solutions/43000650981">Corruption Rank</a></td></tr><tr><td>COSC</td><td><a href="https://www.tradingview.com/support/solutions/43000650986">Crude Oil Stocks Change</a></td></tr><tr><td>COUT</td><td><a href="https://www.tradingview.com/support/solutions/43000650964">Construction Output, YoY</a></td></tr><tr><td>CP</td><td><a href="https://www.tradingview.com/support/solutions/43000650972">Copper Production</a></td></tr><tr><td>CPCEPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650976">Core PCE Price Index</a></td></tr><tr><td>CPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650969">Consumer Price Index</a></td></tr><tr><td>CPIHU</td><td><a href="https://www.tradingview.com/support/solutions/43000650939">CPI Housing Utilities</a></td></tr><tr><td>CPIM</td><td><a href="https://www.tradingview.com/support/solutions/43000650940">CPI Median</a></td></tr><tr><td>CPIT</td><td><a href="https://www.tradingview.com/support/solutions/43000650941">CPI Transportation</a></td></tr><tr><td>CPITM</td><td><a href="https://www.tradingview.com/support/solutions/43000650942">CPI Trimmed Mean</a></td></tr><tr><td>CPMI</td><td><a href="https://www.tradingview.com/support/solutions/43000650958">Chicago PMI</a></td></tr><tr><td>CPPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650977">Core Producer Price Index</a></td></tr><tr><td>CPR</td><td><a href="https://www.tradingview.com/support/solutions/43000650978">Corporate Profits</a></td></tr><tr><td>CRLPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679669">Cereals Price Index</a></td></tr><tr><td>CRR</td><td><a href="https://www.tradingview.com/support/solutions/43000650950">Cash Reserve Ratio</a></td></tr><tr><td>CS</td><td><a href="https://www.tradingview.com/support/solutions/43000650970">Consumer Spending</a></td></tr><tr><td>CSC</td><td><a href="https://www.tradingview.com/support/solutions/43000650919">API Crude Oil Stock Change</a></td></tr><tr><td>CSHPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650947">Case Shiller Home Price Index</a></td></tr><tr><td>CSHPIMM</td><td><a href="https://www.tradingview.com/support/solutions/43000650948">Case Shiller Home Price Index, MoM</a></td></tr><tr><td>CSHPIYY</td><td><a href="https://www.tradingview.com/support/solutions/43000650949">Case Shiller Home Price Index, YoY</a></td></tr><tr><td>CSS</td><td><a href="https://www.tradingview.com/support/solutions/43000650954">Chain Store Sales</a></td></tr><tr><td>CTR</td><td><a href="https://www.tradingview.com/support/solutions/43000650979">Corporate Tax Rate</a></td></tr><tr><td>CU</td><td><a href="https://www.tradingview.com/support/solutions/43000650943">Capacity Utilization</a></td></tr><tr><td>DFMI</td><td><a href="https://www.tradingview.com/support/solutions/43000650990">Dallas Fed Manufacturing Index</a></td></tr><tr><td>DFP</td><td><a href="https://www.tradingview.com/support/solutions/43000650996">Distillate Fuel Production</a></td></tr><tr><td>DFS</td><td><a href="https://www.tradingview.com/support/solutions/43000650997">Distillate Stocks</a></td></tr><tr><td>DFSI</td><td><a href="https://www.tradingview.com/support/solutions/43000650991">Dallas Fed Services Index</a></td></tr><tr><td>DFSRI</td><td><a href="https://www.tradingview.com/support/solutions/43000650992">Dallas Fed Services Revenues Index</a></td></tr><tr><td>DG</td><td><a href="https://www.tradingview.com/support/solutions/43000650993">Deposit Growth</a></td></tr><tr><td>DGO</td><td><a href="https://www.tradingview.com/support/solutions/43000651000">Durable Goods Orders</a></td></tr><tr><td>DGOED</td><td><a href="https://www.tradingview.com/support/solutions/43000650998">Durable Goods Orders Excluding Defense</a></td></tr><tr><td>DGOET</td><td><a href="https://www.tradingview.com/support/solutions/43000650999">Durable Goods Orders Excluding Transportation</a></td></tr><tr><td>DIR</td><td><a href="https://www.tradingview.com/support/solutions/43000650994">Deposit Interest Rate</a></td></tr><tr><td>DPI</td><td><a href="https://www.tradingview.com/support/solutions/43000650995">Disposable Personal Income</a></td></tr><tr><td>DRPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679668">Dairy Price Index</a></td></tr><tr><td>DS</td><td><a href="https://www.tradingview.com/support/solutions/43000650922">API Distillate Stocks</a></td></tr><tr><td>DT</td><td><a href="https://www.tradingview.com/support/solutions/43000650938">CBI Distributive Trades</a></td></tr><tr><td>EC</td><td><a href="https://www.tradingview.com/support/solutions/43000650917">ADP Employment Change</a></td></tr><tr><td>ED</td><td><a href="https://www.tradingview.com/support/solutions/43000651012">External Debt</a></td></tr><tr><td>EDBR</td><td><a href="https://www.tradingview.com/support/solutions/43000651001">Ease Of Doing Business Ranking</a></td></tr><tr><td>EHS</td><td><a href="https://www.tradingview.com/support/solutions/43000651009">Existing Home Sales</a></td></tr><tr><td>ELP</td><td><a href="https://www.tradingview.com/support/solutions/43000651004">Electricity Production</a></td></tr><tr><td>EMC</td><td><a href="https://www.tradingview.com/support/solutions/43000651006">Employment Change</a></td></tr><tr><td>EMCI</td><td><a href="https://www.tradingview.com/support/solutions/43000651007">Employment Cost Index</a></td></tr><tr><td>EMP</td><td><a href="https://www.tradingview.com/support/solutions/43000651005">Employed Persons</a></td></tr><tr><td>EMR</td><td><a href="https://www.tradingview.com/support/solutions/43000651008">Employment Rate</a></td></tr><tr><td>EOI</td><td><a href="https://www.tradingview.com/support/solutions/43000651002">Economic Optimism Index</a></td></tr><tr><td>EP</td><td><a href="https://www.tradingview.com/support/solutions/43000651011">Export Prices</a></td></tr><tr><td>ESI</td><td><a href="https://www.tradingview.com/support/solutions/43000651213">ZEW Economic Sentiment Index</a></td></tr><tr><td>EWS</td><td><a href="https://www.tradingview.com/support/solutions/43000651003">Economy Watchers Survey</a></td></tr><tr><td>EXP</td><td><a href="https://www.tradingview.com/support/solutions/43000651010">Exports</a></td></tr><tr><td>EXPYY</td><td><a href="https://www.tradingview.com/support/solutions/43000679671">Exports, YoY</a></td></tr><tr><td>FAI</td><td><a href="https://www.tradingview.com/support/solutions/43000651016">Fixed Asset Investment</a></td></tr><tr><td>FBI</td><td><a href="https://www.tradingview.com/support/solutions/43000651018">Foreign Bond Investment</a></td></tr><tr><td>FDI</td><td><a href="https://www.tradingview.com/support/solutions/43000651019">Foreign Direct Investment</a></td></tr><tr><td>FE</td><td><a href="https://www.tradingview.com/support/solutions/43000651015">Fiscal Expenditure</a></td></tr><tr><td>FER</td><td><a href="https://www.tradingview.com/support/solutions/43000651020">Foreign Exchange Reserves</a></td></tr><tr><td>FI</td><td><a href="https://www.tradingview.com/support/solutions/43000651017">Food Inflation, YoY</a></td></tr><tr><td>FO</td><td><a href="https://www.tradingview.com/support/solutions/43000651014">Factory Orders</a></td></tr><tr><td>FOET</td><td><a href="https://www.tradingview.com/support/solutions/43000651013">Factory Orders Excluding Transportation</a></td></tr><tr><td>FPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679667">Food Price Index</a></td></tr><tr><td>FSI</td><td><a href="https://www.tradingview.com/support/solutions/43000651021">Foreign Stock Investment</a></td></tr><tr><td>FTE</td><td><a href="https://www.tradingview.com/support/solutions/43000651022">Full Time Employment</a></td></tr><tr><td>FYGDPG</td><td><a href="https://www.tradingview.com/support/solutions/43000679672">Full Year GDP Growth</a></td></tr><tr><td>GASP</td><td><a href="https://www.tradingview.com/support/solutions/43000651040">Gasoline Prices</a></td></tr><tr><td>GBP</td><td><a href="https://www.tradingview.com/support/solutions/43000651050">Government Budget</a></td></tr><tr><td>GBV</td><td><a href="https://www.tradingview.com/support/solutions/43000651049">Government Budget Value</a></td></tr><tr><td>GCI</td><td><a href="https://www.tradingview.com/support/solutions/43000650961">Competitiveness Index</a></td></tr><tr><td>GCR</td><td><a href="https://www.tradingview.com/support/solutions/43000650962">Competitiveness Rank</a></td></tr><tr><td>GD</td><td><a href="https://www.tradingview.com/support/solutions/43000651052">Government Debt</a></td></tr><tr><td>GDG</td><td><a href="https://www.tradingview.com/support/solutions/43000651051">Government Debt To GDP</a></td></tr><tr><td>GDP</td><td><a href="https://www.tradingview.com/support/solutions/43000651038">Gross Domestic Product</a></td></tr><tr><td>GDPA</td><td><a href="https://www.tradingview.com/support/solutions/43000651025">GDP From Agriculture</a></td></tr><tr><td>GDPC</td><td><a href="https://www.tradingview.com/support/solutions/43000651026">GDP From Construction</a></td></tr><tr><td>GDPCP</td><td><a href="https://www.tradingview.com/support/solutions/43000651023">GDP Constant Prices</a></td></tr><tr><td>GDPD</td><td><a href="https://www.tradingview.com/support/solutions/43000651024">GDP Deflator</a></td></tr><tr><td>GDPGA</td><td><a href="https://www.tradingview.com/support/solutions/43000651033">GDP Growth Annualized</a></td></tr><tr><td>GDPMAN</td><td><a href="https://www.tradingview.com/support/solutions/43000651027">GDP From Manufacturing</a></td></tr><tr><td>GDPMIN</td><td><a href="https://www.tradingview.com/support/solutions/43000651028">GDP From Mining</a></td></tr><tr><td>GDPPA</td><td><a href="https://www.tradingview.com/support/solutions/43000651029">GDP From Public Administration</a></td></tr><tr><td>GDPPC</td><td><a href="https://www.tradingview.com/support/solutions/43000651035">GDP Per Capita</a></td></tr><tr><td>GDPPCP</td><td><a href="https://www.tradingview.com/support/solutions/43000651036">GDP Per Capita, PPP</a></td></tr><tr><td>GDPQQ</td><td><a href="https://www.tradingview.com/support/solutions/43000651034">GDP Growth Rate</a></td></tr><tr><td>GDPS</td><td><a href="https://www.tradingview.com/support/solutions/43000651030">GDP From Services</a></td></tr><tr><td>GDPSA</td><td><a href="https://www.tradingview.com/support/solutions/43000651037">GDP Sales</a></td></tr><tr><td>GDPT</td><td><a href="https://www.tradingview.com/support/solutions/43000651031">GDP From Transport</a></td></tr><tr><td>GDPU</td><td><a href="https://www.tradingview.com/support/solutions/43000651032">GDP From Utilities</a></td></tr><tr><td>GDPYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651039">GDP, YoY</a></td></tr><tr><td>GDTPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651043">Global Dairy Trade Price Index</a></td></tr><tr><td>GFCF</td><td><a href="https://www.tradingview.com/support/solutions/43000651060">Gross Fixed Capital Formation</a></td></tr><tr><td>GNP</td><td><a href="https://www.tradingview.com/support/solutions/43000651061">Gross National Product</a></td></tr><tr><td>GP</td><td><a href="https://www.tradingview.com/support/solutions/43000651044">Gold Production</a></td></tr><tr><td>GPA</td><td><a href="https://www.tradingview.com/support/solutions/43000651053">Government Payrolls</a></td></tr><tr><td>GPRO</td><td><a href="https://www.tradingview.com/support/solutions/43000651041">Gasoline Production</a></td></tr><tr><td>GR</td><td><a href="https://www.tradingview.com/support/solutions/43000651054">Government Revenues</a></td></tr><tr><td>GRES</td><td><a href="https://www.tradingview.com/support/solutions/43000651045">Gold Reserves</a></td></tr><tr><td>GS</td><td><a href="https://www.tradingview.com/support/solutions/43000650923">API Gasoline Stocks</a></td></tr><tr><td>GSC</td><td><a href="https://www.tradingview.com/support/solutions/43000651057">Grain Stocks Corn</a></td></tr><tr><td>GSCH</td><td><a href="https://www.tradingview.com/support/solutions/43000651042">Gasoline Stocks Change</a></td></tr><tr><td>GSG</td><td><a href="https://www.tradingview.com/support/solutions/43000651055">Government Spending To GDP</a></td></tr><tr><td>GSP</td><td><a href="https://www.tradingview.com/support/solutions/43000651056">Government Spending</a></td></tr><tr><td>GSS</td><td><a href="https://www.tradingview.com/support/solutions/43000651058">Grain Stocks Soy</a></td></tr><tr><td>GSW</td><td><a href="https://www.tradingview.com/support/solutions/43000651059">Grain Stocks Wheat</a></td></tr><tr><td>GTB</td><td><a href="https://www.tradingview.com/support/solutions/43000651046">Goods Trade Balance</a></td></tr><tr><td>HB</td><td><a href="https://www.tradingview.com/support/solutions/43000651067">Hospital Beds</a></td></tr><tr><td>HDG</td><td><a href="https://www.tradingview.com/support/solutions/43000651068">Households Debt To GDP</a></td></tr><tr><td>HDI</td><td><a href="https://www.tradingview.com/support/solutions/43000651069">Households Debt To Income</a></td></tr><tr><td>HICP</td><td><a href="https://www.tradingview.com/support/solutions/43000651062">Harmonised Index of Consumer Prices</a></td></tr><tr><td>HIRMM</td><td><a href="https://www.tradingview.com/support/solutions/43000679673">Harmonised Inflation Rate, MoM</a></td></tr><tr><td>HIRYY</td><td><a href="https://www.tradingview.com/support/solutions/43000679674">Harmonised Inflation Rate, YoY</a></td></tr><tr><td>HMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651132">NAHB Housing Market Index</a></td></tr><tr><td>HOR</td><td><a href="https://www.tradingview.com/support/solutions/43000651065">Home Ownership Rate</a></td></tr><tr><td>HOS</td><td><a href="https://www.tradingview.com/support/solutions/43000651063">Heating Oil Stocks</a></td></tr><tr><td>HOSP</td><td><a href="https://www.tradingview.com/support/solutions/43000651066">Hospitals</a></td></tr><tr><td>HPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651071">House Price Index</a></td></tr><tr><td>HPIMM</td><td><a href="https://www.tradingview.com/support/solutions/43000679678">House Price Index, MoM</a></td></tr><tr><td>HPIYY</td><td><a href="https://www.tradingview.com/support/solutions/43000679679">House Price Index, YoY</a></td></tr><tr><td>HS</td><td><a href="https://www.tradingview.com/support/solutions/43000651064">Home Loans</a></td></tr><tr><td>HSP</td><td><a href="https://www.tradingview.com/support/solutions/43000651070">Household Spending</a></td></tr><tr><td>HST</td><td><a href="https://www.tradingview.com/support/solutions/43000651072">Housing Starts</a></td></tr><tr><td>IC</td><td><a href="https://www.tradingview.com/support/solutions/43000650956">Changes In Inventories</a></td></tr><tr><td>ICUB</td><td><a href="https://www.tradingview.com/support/solutions/43000651073">ICU Beds</a></td></tr><tr><td>IE</td><td><a href="https://www.tradingview.com/support/solutions/43000651081">Inflation Expectations</a></td></tr><tr><td>IFOCC</td><td><a href="https://www.tradingview.com/support/solutions/43000651074">IFO Assessment Of The Business Situation</a></td></tr><tr><td>IFOE</td><td><a href="https://www.tradingview.com/support/solutions/43000651075">IFO Business Developments Expectations</a></td></tr><tr><td>IJC</td><td><a href="https://www.tradingview.com/support/solutions/43000651084">Initial Jobless Claims</a></td></tr><tr><td>IMP</td><td><a href="https://www.tradingview.com/support/solutions/43000651076">Imports</a></td></tr><tr><td>IMPYY</td><td><a href="https://www.tradingview.com/support/solutions/43000679681">Imports, YoY</a></td></tr><tr><td>INBR</td><td><a href="https://www.tradingview.com/support/solutions/43000651085">Interbank Rate</a></td></tr><tr><td>INTR</td><td><a href="https://www.tradingview.com/support/solutions/43000651086">Interest Rate</a></td></tr><tr><td>IPA</td><td><a href="https://www.tradingview.com/support/solutions/43000651088">IP Addresses</a></td></tr><tr><td>IPMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651078">Industrial Production, MoM</a></td></tr><tr><td>IPRI</td><td><a href="https://www.tradingview.com/support/solutions/43000651077">Import Prices</a></td></tr><tr><td>IPYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651079">Industrial Production, YoY</a></td></tr><tr><td>IRMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651082">Inflation Rate, MoM</a></td></tr><tr><td>IRYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651083">Inflation Rate, YoY</a></td></tr><tr><td>IS</td><td><a href="https://www.tradingview.com/support/solutions/43000651080">Industrial Sentiment</a></td></tr><tr><td>ISP</td><td><a href="https://www.tradingview.com/support/solutions/43000651087">Internet Speed</a></td></tr><tr><td>JA</td><td><a href="https://www.tradingview.com/support/solutions/43000651091">Job Advertisements</a></td></tr><tr><td>JAR</td><td><a href="https://www.tradingview.com/support/solutions/43000651090">Jobs To Applications Ratio</a></td></tr><tr><td>JC</td><td><a href="https://www.tradingview.com/support/solutions/43000650955">Challenger Job Cuts</a></td></tr><tr><td>JC4W</td><td><a href="https://www.tradingview.com/support/solutions/43000651089">Jobless Claims, 4-Week Average</a></td></tr><tr><td>JO</td><td><a href="https://www.tradingview.com/support/solutions/43000651092">Job Offers</a></td></tr><tr><td>JV</td><td><a href="https://www.tradingview.com/support/solutions/43000651093">Job Vacancies</a></td></tr><tr><td>KFMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651094">Kansas Fed Manufacturing Index</a></td></tr><tr><td>LB</td><td><a href="https://www.tradingview.com/support/solutions/43000651104">Loans To Banks</a></td></tr><tr><td>LC</td><td><a href="https://www.tradingview.com/support/solutions/43000651101">Labor Costs</a></td></tr><tr><td>LEI</td><td><a href="https://www.tradingview.com/support/solutions/43000651102">Leading Economic Index</a></td></tr><tr><td>LFPR</td><td><a href="https://www.tradingview.com/support/solutions/43000651100">Labor Force Participation Rate</a></td></tr><tr><td>LG</td><td><a href="https://www.tradingview.com/support/solutions/43000651106">Loan Growth, YoY</a></td></tr><tr><td>LIVRR</td><td><a href="https://www.tradingview.com/support/solutions/43000651103">Liquidity Injections Via Reverse Repo</a></td></tr><tr><td>LMIC</td><td><a href="https://www.tradingview.com/support/solutions/43000651096">LMI Logistics Managers Index Current</a></td></tr><tr><td>LMICI</td><td><a href="https://www.tradingview.com/support/solutions/43000651095">LMI Inventory Costs</a></td></tr><tr><td>LMIF</td><td><a href="https://www.tradingview.com/support/solutions/43000651097">LMI Logistics Managers Index Future</a></td></tr><tr><td>LMITP</td><td><a href="https://www.tradingview.com/support/solutions/43000651098">LMI Transportation Prices</a></td></tr><tr><td>LMIWP</td><td><a href="https://www.tradingview.com/support/solutions/43000651099">LMI Warehouse Prices</a></td></tr><tr><td>LPS</td><td><a href="https://www.tradingview.com/support/solutions/43000651105">Loans To Private Sector</a></td></tr><tr><td>LR</td><td><a href="https://www.tradingview.com/support/solutions/43000650953">Central Bank Lending Rate</a></td></tr><tr><td>LTUR</td><td><a href="https://www.tradingview.com/support/solutions/43000651107">Long Term Unemployment Rate</a></td></tr><tr><td>LWF</td><td><a href="https://www.tradingview.com/support/solutions/43000679691">Living Wage Family</a></td></tr><tr><td>LWI</td><td><a href="https://www.tradingview.com/support/solutions/43000679702">Living Wage Individual</a></td></tr><tr><td>M0</td><td><a href="https://www.tradingview.com/support/solutions/43000651125">Money Supply M0</a></td></tr><tr><td>M1</td><td><a href="https://www.tradingview.com/support/solutions/43000651126">Money Supply M1</a></td></tr><tr><td>M2</td><td><a href="https://www.tradingview.com/support/solutions/43000651127">Money Supply M2</a></td></tr><tr><td>M3</td><td><a href="https://www.tradingview.com/support/solutions/43000651128">Money Supply M3</a></td></tr><tr><td>MA</td><td><a href="https://www.tradingview.com/support/solutions/43000651130">Mortgage Approvals</a></td></tr><tr><td>MAPL</td><td><a href="https://www.tradingview.com/support/solutions/43000651129">Mortgage Applications</a></td></tr><tr><td>MCE</td><td><a href="https://www.tradingview.com/support/solutions/43000651119">Michigan Consumer Expectations</a></td></tr><tr><td>MCEC</td><td><a href="https://www.tradingview.com/support/solutions/43000651120">Michigan Current Economic Conditions</a></td></tr><tr><td>MD</td><td><a href="https://www.tradingview.com/support/solutions/43000651117">Medical Doctors</a></td></tr><tr><td>ME</td><td><a href="https://www.tradingview.com/support/solutions/43000651122">Military Expenditure</a></td></tr><tr><td>MGDPYY</td><td><a href="https://www.tradingview.com/support/solutions/43000679714">Monthly GDP, YoY</a></td></tr><tr><td>MIE1Y</td><td><a href="https://www.tradingview.com/support/solutions/43000651121">Michigan Inflation Expectations</a></td></tr><tr><td>MIE5Y</td><td><a href="https://www.tradingview.com/support/solutions/43000651118">Michigan 5 Year Inflation Expectations</a></td></tr><tr><td>MIP</td><td><a href="https://www.tradingview.com/support/solutions/43000651124">Mining Production, YoY</a></td></tr><tr><td>MMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651108">MBA Mortgage Market Index</a></td></tr><tr><td>MO</td><td><a href="https://www.tradingview.com/support/solutions/43000651111">Machinery Orders</a></td></tr><tr><td>MP</td><td><a href="https://www.tradingview.com/support/solutions/43000651113">Manufacturing Payrolls</a></td></tr><tr><td>MPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679666">Meat Price Index</a></td></tr><tr><td>MPRMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651114">Manufacturing Production, MoM</a></td></tr><tr><td>MPRYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651115">Manufacturing Production, YoY</a></td></tr><tr><td>MR</td><td><a href="https://www.tradingview.com/support/solutions/43000651131">Mortgage Rate</a></td></tr><tr><td>MRI</td><td><a href="https://www.tradingview.com/support/solutions/43000651109">MBA Mortgage Refinance Index</a></td></tr><tr><td>MS</td><td><a href="https://www.tradingview.com/support/solutions/43000651116">Manufacturing Sales</a></td></tr><tr><td>MTO</td><td><a href="https://www.tradingview.com/support/solutions/43000651112">Machine Tool Orders</a></td></tr><tr><td>MW</td><td><a href="https://www.tradingview.com/support/solutions/43000651123">Minimum Wages</a></td></tr><tr><td>NDCGOEA</td><td><a href="https://www.tradingview.com/support/solutions/43000651148">Orders For Non-defense Capital Goods Excluding Aircraft</a></td></tr><tr><td>NEGTB</td><td><a href="https://www.tradingview.com/support/solutions/43000651047">Goods Trade Deficit With Non-EU Countries</a></td></tr><tr><td>NFP</td><td><a href="https://www.tradingview.com/support/solutions/43000651141">Nonfarm Payrolls</a></td></tr><tr><td>NGI</td><td><a href="https://www.tradingview.com/support/solutions/43000679719">Natural Gas Imports</a></td></tr><tr><td>NGIR</td><td><a href="https://www.tradingview.com/support/solutions/43000679721">Natural Gas Imports from Russia</a></td></tr><tr><td>NGSC</td><td><a href="https://www.tradingview.com/support/solutions/43000651136">Natural Gas Stocks Change</a></td></tr><tr><td>NHPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651135">Nationwide House Price Index</a></td></tr><tr><td>NHS</td><td><a href="https://www.tradingview.com/support/solutions/43000651137">New Home Sales</a></td></tr><tr><td>NHSMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651138">New Home Sales, MoM</a></td></tr><tr><td>NMPMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651143">Non-Manufacturing PMI</a></td></tr><tr><td>NO</td><td><a href="https://www.tradingview.com/support/solutions/43000651139">New Orders</a></td></tr><tr><td>NODXMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651144">Non-Oil Domestic Exports, MoM</a></td></tr><tr><td>NODXYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651145">Non-Oil Domestic Exports, YoY</a></td></tr><tr><td>NOE</td><td><a href="https://www.tradingview.com/support/solutions/43000651142">Non-Oil Exports</a></td></tr><tr><td>NPP</td><td><a href="https://www.tradingview.com/support/solutions/43000651140">Nonfarm Payrolls Private</a></td></tr><tr><td>NURS</td><td><a href="https://www.tradingview.com/support/solutions/43000651146">Nurses</a></td></tr><tr><td>NYESMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651134">NY Empire State Manufacturing Index</a></td></tr><tr><td>OE</td><td><a href="https://www.tradingview.com/support/solutions/43000651147">Oil Exports</a></td></tr><tr><td>OPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679665">Oils Price Index</a></td></tr><tr><td>PCEPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651149">PCE Price Index</a></td></tr><tr><td>PDG</td><td><a href="https://www.tradingview.com/support/solutions/43000651160">Private Debt To GDP</a></td></tr><tr><td>PFMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651158">Philadelphia Fed Manufacturing Index</a></td></tr><tr><td>PHSIMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651152">Pending Home Sales Index, MoM</a></td></tr><tr><td>PHSIYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651153">Pending Home Sales Index, YoY</a></td></tr><tr><td>PI</td><td><a href="https://www.tradingview.com/support/solutions/43000651155">Personal Income</a></td></tr><tr><td>PIN</td><td><a href="https://www.tradingview.com/support/solutions/43000651161">Private Investment</a></td></tr><tr><td>PIND</td><td><a href="https://www.tradingview.com/support/solutions/43000651110">MBA Purchase Index</a></td></tr><tr><td>PITR</td><td><a href="https://www.tradingview.com/support/solutions/43000651154">Personal Income Tax Rate</a></td></tr><tr><td>POP</td><td><a href="https://www.tradingview.com/support/solutions/43000651159">Population</a></td></tr><tr><td>PPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651165">Producer Price Index</a></td></tr><tr><td>PPII</td><td><a href="https://www.tradingview.com/support/solutions/43000651164">Producer Price Index Input</a></td></tr><tr><td>PPIMM</td><td><a href="https://www.tradingview.com/support/solutions/43000679724">Producer Price Inflation, MoM</a></td></tr><tr><td>PPIYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651163">Producer Prices Index, YoY</a></td></tr><tr><td>PRI</td><td><a href="https://www.tradingview.com/support/solutions/43000650925">API Product Imports</a></td></tr><tr><td>PROD</td><td><a href="https://www.tradingview.com/support/solutions/43000651166">Productivity</a></td></tr><tr><td>PS</td><td><a href="https://www.tradingview.com/support/solutions/43000651156">Personal Savings</a></td></tr><tr><td>PSC</td><td><a href="https://www.tradingview.com/support/solutions/43000651162">Private Sector Credit</a></td></tr><tr><td>PSP</td><td><a href="https://www.tradingview.com/support/solutions/43000651157">Personal Spending</a></td></tr><tr><td>PTE</td><td><a href="https://www.tradingview.com/support/solutions/43000651151">Part Time Employment</a></td></tr><tr><td>PUAC</td><td><a href="https://www.tradingview.com/support/solutions/43000651150">Pandemic Unemployment Assistance Claims</a></td></tr><tr><td>RAM</td><td><a href="https://www.tradingview.com/support/solutions/43000651177">Retirement Age Men</a></td></tr><tr><td>RAW</td><td><a href="https://www.tradingview.com/support/solutions/43000651178">Retirement Age Women</a></td></tr><tr><td>RCR</td><td><a href="https://www.tradingview.com/support/solutions/43000651168">Refinery Crude Runs</a></td></tr><tr><td>REM</td><td><a href="https://www.tradingview.com/support/solutions/43000651169">Remittances</a></td></tr><tr><td>RFMI</td><td><a href="https://www.tradingview.com/support/solutions/43000651181">Richmond Fed Manufacturing Index</a></td></tr><tr><td>RFMSI</td><td><a href="https://www.tradingview.com/support/solutions/43000651182">Richmond Fed Manufacturing Shipments Index</a></td></tr><tr><td>RFSI</td><td><a href="https://www.tradingview.com/support/solutions/43000651183">Richmond Fed Services Index</a></td></tr><tr><td>RI</td><td><a href="https://www.tradingview.com/support/solutions/43000651167">Redbook Index</a></td></tr><tr><td>RIEA</td><td><a href="https://www.tradingview.com/support/solutions/43000651171">Retail Inventories Excluding Autos</a></td></tr><tr><td>RPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651172">Retail Price Index</a></td></tr><tr><td>RR</td><td><a href="https://www.tradingview.com/support/solutions/43000651170">Repo Rate</a></td></tr><tr><td>RRR</td><td><a href="https://www.tradingview.com/support/solutions/43000651180">Reverse Repo Rate</a></td></tr><tr><td>RSEA</td><td><a href="https://www.tradingview.com/support/solutions/43000651173">Retail Sales Excluding Autos</a></td></tr><tr><td>RSEF</td><td><a href="https://www.tradingview.com/support/solutions/43000651174">Retail Sales Excluding Fuel</a></td></tr><tr><td>RSMM</td><td><a href="https://www.tradingview.com/support/solutions/43000651175">Retail Sales, MoM</a></td></tr><tr><td>RSYY</td><td><a href="https://www.tradingview.com/support/solutions/43000651176">Retail Sales, YoY</a></td></tr><tr><td>RTI</td><td><a href="https://www.tradingview.com/support/solutions/43000651179">Reuters Tankan Index</a></td></tr><tr><td>SBSI</td><td><a href="https://www.tradingview.com/support/solutions/43000651187">Small Business Sentiment Index</a></td></tr><tr><td>SFHP</td><td><a href="https://www.tradingview.com/support/solutions/43000651186">Single Family Home Prices</a></td></tr><tr><td>SP</td><td><a href="https://www.tradingview.com/support/solutions/43000651191">Steel Production</a></td></tr><tr><td>SPI</td><td><a href="https://www.tradingview.com/support/solutions/43000679563">Sugar Price Index</a></td></tr><tr><td>SS</td><td><a href="https://www.tradingview.com/support/solutions/43000651185">Services Sentiment</a></td></tr><tr><td>SSR</td><td><a href="https://www.tradingview.com/support/solutions/43000651190">Social Security Rate</a></td></tr><tr><td>SSRC</td><td><a href="https://www.tradingview.com/support/solutions/43000651188">Social Security Rate For Companies</a></td></tr><tr><td>SSRE</td><td><a href="https://www.tradingview.com/support/solutions/43000651189">Social Security Rate For Employees</a></td></tr><tr><td>STR</td><td><a href="https://www.tradingview.com/support/solutions/43000651184">Sales Tax Rate</a></td></tr><tr><td>TA</td><td><a href="https://www.tradingview.com/support/solutions/43000651199">Tourist Arrivals</a></td></tr><tr><td>TAXR</td><td><a href="https://www.tradingview.com/support/solutions/43000651192">Tax Revenue</a></td></tr><tr><td>TCB</td><td><a href="https://www.tradingview.com/support/solutions/43000651200">Treasury Cash Balance</a></td></tr><tr><td>TCPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651196">Tokyo CPI</a></td></tr><tr><td>TI</td><td><a href="https://www.tradingview.com/support/solutions/43000651194">Terrorism Index</a></td></tr><tr><td>TII</td><td><a href="https://www.tradingview.com/support/solutions/43000651195">Tertiary Industry Index</a></td></tr><tr><td>TOT</td><td><a href="https://www.tradingview.com/support/solutions/43000651193">Terms Of Trade</a></td></tr><tr><td>TR</td><td><a href="https://www.tradingview.com/support/solutions/43000651198">Tourism Revenues</a></td></tr><tr><td>TVS</td><td><a href="https://www.tradingview.com/support/solutions/43000651197">Total Vehicle Sales</a></td></tr><tr><td>UC</td><td><a href="https://www.tradingview.com/support/solutions/43000651202">Unemployment Change</a></td></tr><tr><td>UP</td><td><a href="https://www.tradingview.com/support/solutions/43000651201">Unemployed Persons</a></td></tr><tr><td>UR</td><td><a href="https://www.tradingview.com/support/solutions/43000651203">Unemployment Rate</a></td></tr><tr><td>WAG</td><td><a href="https://www.tradingview.com/support/solutions/43000651205">Wages</a></td></tr><tr><td>WES</td><td><a href="https://www.tradingview.com/support/solutions/43000651207">Weapons Sales</a></td></tr><tr><td>WG</td><td><a href="https://www.tradingview.com/support/solutions/43000651206">Wage Growth, YoY</a></td></tr><tr><td>WHS</td><td><a href="https://www.tradingview.com/support/solutions/43000679725">Wages High Skilled</a></td></tr><tr><td>WI</td><td><a href="https://www.tradingview.com/support/solutions/43000651208">Wholesale Inventories</a></td></tr><tr><td>WLS</td><td><a href="https://www.tradingview.com/support/solutions/43000679727">Wages Low Skilled</a></td></tr><tr><td>WM</td><td><a href="https://www.tradingview.com/support/solutions/43000651204">Wages In Manufacturing</a></td></tr><tr><td>WPI</td><td><a href="https://www.tradingview.com/support/solutions/43000651209">Wholesale Price Index</a></td></tr><tr><td>WS</td><td><a href="https://www.tradingview.com/support/solutions/43000651210">Wholesale Sales</a></td></tr><tr><td>YUR</td><td><a href="https://www.tradingview.com/support/solutions/43000651211">Youth Unemployment Rate</a></td></tr><tr><td>ZCC</td><td><a href="https://www.tradingview.com/support/solutions/43000651212">ZEW Current Conditions</a></td></tr></tbody></table></details>
<h2 class="md-heading" id="requestseed"><a href="#requestseed">`request.seed()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView aggregates a vast amount of data from its many providers, including price and volume information on tradable instruments, financials, economic data, and more, which users can retrieve in Pine Script™ using the functions discussed in the sections above, as well as multiple built-in variables.</p>
<p>To further expand the horizons of possible data one can analyze on TradingView, we have <a href="https://github.com/tradingview-pine-seeds/docs" rel="nofollow">Pine Seeds</a>, which allows users to supply custom <em>user-maintained</em> EOD data feeds via GitHub for use on TradingView charts and within Pine Script™ code.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The creation of <em>new</em> Pine Seeds repositories is currently <strong>unavailable</strong>. However, the data feeds from <em>existing</em> repositories are still accessible from charts and Pine scripts. The documentation <a href="https://github.com/tradingview-pine-seeds/docs/blob/main/README.md" rel="nofollow">here</a> provides in-depth information about Pine Seeds functionality and instructions for requesting the return of full Pine Seeds support.</p></div></aside>
<p>To retrieve data from a Pine Seeds data feed within a script, use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a> function. Below is the function’s signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">request.seed(source, symbol, expression, ignore_invalid_symbol, calc_bars_count) → series &lt;type&gt;</span></div></div></code></pre></figure></div>
<p>The <code dir="auto">source</code> parameter specifies the unique name of the user-maintained GitHub repository that contains the data feed.</p>
<p>The <code dir="auto">symbol</code> parameter represents the file name from the “data/” directory of the <code dir="auto">source</code> repository, excluding the “.csv” file extension. See <a href="https://github.com/tradingview-pine-seeds/docs/blob/main/data.md" rel="nofollow">this page</a> for information about the structure of the data stored in repositories.</p>
<p>The <code dir="auto">expression</code> parameter is the series to evaluate using data extracted from the requested context. It is similar to the equivalent in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>. Data feeds stored in user-maintained repos contain <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a> information, meaning the <code dir="auto">expression</code> argument can use the corresponding built-in variables, including variables derived from them (e.g., <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>, etc.) to request their values from the context of the custom data.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>As with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a> duplicates the scopes necessary to evaluate its <code dir="auto">expression</code> in another context, which contributes toward compilation limits and script memory demands. See the <a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page’s section on <a href="/pine-script-docs/v5/writing/limitations/#scope-count">scope count</a> limits for more information.</p></div></aside>
<p>The script below visualizes sample data from the <a href="https://github.com/tradingview-pine-seeds/seed_crypto_santiment" rel="nofollow">seed_crypto_santiment</a> demo repository. It uses two calls to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a> to retrieve the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> values from the repository’s <a href="https://github.com/tradingview-pine-seeds/seed_crypto_santiment/blob/master/data/BTC_SENTIMENT_POSITIVE_TOTAL.csv" rel="nofollow">BTC_SENTIMENT_POSITIVE_TOTAL</a> and <a href="https://github.com/tradingview-pine-seeds/seed_crypto_santiment/blob/master/data/BTC_SENTIMENT_NEGATIVE_TOTAL.csv" rel="nofollow">BTC_SENTIMENT_NEGATIVE_TOTAL</a> data feeds and <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the results on the chart as <a href="https://www.tradingview.com/pine-script-reference/v5/#var_plot.style_stepline">step lines</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/daf605225d05551de7a63d3aa07c3a95.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pine Seeds demo", format=format.volume)

//@variable The total positive sentiment for BTC extracted from the "seed_crypto_santiment" repository.
float positiveTotal = request.seed("seed_crypto_santiment", "BTC_SENTIMENT_POSITIVE_TOTAL", close)
//@variable The total negative sentiment for BTC extracted from the "seed_crypto_santiment" repository.
float negativeTotal = request.seed("seed_crypto_santiment", "BTC_SENTIMENT_NEGATIVE_TOTAL", close)

// Plot the data.
plot(positiveTotal, "Positive sentiment", color.teal, 2, plot.style_stepline)
plot(negativeTotal, "Negative sentiment", color.maroon, 2, plot.style_stepline)</code></div>
<p>Note that:</p>
<ul>
<li>This example requests data from the repository highlighted in the <a href="https://github.com/tradingview-pine-seeds/docs/blob/main/README.md" rel="nofollow">Pine Seeds documentation</a>. It exists solely for example purposes, and its data <em>does not</em> update on a regular basis.</li>
<li>Unlike most other <code dir="auto">request.*()</code> functions, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a> does not have a <code dir="auto">gaps</code> parameter. It always returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values when no new data exists.</li>
<li>Pine Seeds data is searchable from the chart’s symbol search bar. To load a data feed on the chart, enter the <em>“Repo:File” pair</em>, similar to searching for an “Exchange:Symbol” pair.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/non-standard-charts-data"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Non-standard charts data  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/plots"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Plots <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Plots</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-plots"><a href="#plots">Plots<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
function is the most frequently used function used to display
information calculated using Pine scripts. It is versatile and can plot
different styles of lines, histograms, areas, columns (like volume
columns), fills, circles or crosses.</p>
<p>The use of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
to create fills is explained in the page on
<a href="/pine-script-docs/v5/concepts/fills/">Fills</a>.</p>
<p>This script showcases a few different uses of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
in an overlay script:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="800" loading="lazy" src="images/1b0501e763dda6caca27a27638f7855b.webp" width="1770"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`plot()`", "", true)
plot(high, "Blue `high` line")
plot(math.avg(close, open), "Crosses in body center", close &gt; open ? color.lime : color.purple, 6, plot.style_cross)
plot(math.min(open, close), "Navy step line on body low point", color.navy, 3, plot.style_stepline)
plot(low, "Gray dot on `low`", color.gray, 3, plot.style_circles)

color VIOLET = #AA00FF
color GOLD   = #CCCC00
ma = ta.alma(hl2, 40, 0.85, 6)
var almaColor = color.silver
almaColor := ma &gt; ma[2] ? GOLD : ma &lt; ma[2]  ? VIOLET : almaColor
plot(ma, "Two-color ALMA", almaColor, 2)</code></div>
<p>Note that:</p>
<ul>
<li>The first
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call plots a 1-pixel blue line across the bar highs.</li>
<li>The second plots crosses at the mid-point of bodies. The crosses are
colored lime when the bar is up and purple when it is down. The
argument used for <code dir="auto">linewidth</code> is <code dir="auto">6</code> but it is not a pixel value;
just a relative size.</li>
<li>The third call plots a 3-pixel wide step line following the low
point of bodies.</li>
<li>The fourth call plot a gray circle at the bars’
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>.</li>
<li>The last plot requires some preparation. We first define our
bull/bear colors, calculate an <a href="https://www.tradingview.com/support/solutions/43000594683">Arnaud Legoux Moving
Average</a>,
then make our color calculations. We initialize our color variable
on bar zero only, using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>.
We initialize it to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_color%7Bdot%7Dsilver">color.silver</a>,
so on the dataset’s first bars, until one of our conditions causes
the color to change, the line will be silver. The conditions that
change the color of the line require it to be higher/lower than its
value two bars ago. This makes for less noisy color transitions than
if we merely looked for a higher/lower value than the previous one.</li>
</ul>
<p>This script shows other uses of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
in a pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="798" loading="lazy" src="images/2cf62f24352ca5e9b202738aaee543e2.webp" width="1762"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Volume change", format = format.volume)

color GREEN         = #008000
color GREEN_LIGHT   = color.new(GREEN, 50)
color GREEN_LIGHTER = color.new(GREEN, 85)
color PINK          = #FF0080
color PINK_LIGHT    = color.new(PINK, 50)
color PINK_LIGHTER  = color.new(PINK, 90)

bool  barUp = ta.rising(close, 1)
bool  barDn = ta.falling(close, 1)
float volumeChange = ta.change(volume)

volumeColor = barUp ? GREEN_LIGHTER : barDn ? PINK_LIGHTER : color.gray
plot(volume, "Volume columns", volumeColor, style = plot.style_columns)

volumeChangeColor = barUp ? volumeChange &gt; 0 ? GREEN : GREEN_LIGHT : volumeChange &gt; 0 ? PINK : PINK_LIGHT
plot(volumeChange, "Volume change columns", volumeChangeColor, 12, plot.style_histogram)

plot(0, "Zero line", color.gray)</code></div>
<p>Note that:</p>
<ul>
<li>We are plotting normal
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
values as wide columns above the zero line (see the
<code dir="auto">style = plot.style_columns</code> in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call).</li>
<li>Before plotting the columns we calculate our <code dir="auto">volumeColor</code> by using
the values of the <code dir="auto">barUp</code> and <code dir="auto">barDn</code> boolean variables. They become
respectively <code dir="auto">true</code> when the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
is higher/lower than the previous one. Note that the “Volume”
built-in does not use the same condition; it identifies an up bar
with <code dir="auto">close &gt; open</code>. We use the <code dir="auto">GREEN_LIGHTER</code> and <code dir="auto">PINK_LIGHTER</code>
colors for the volume columns.</li>
<li>Because the first plot plots columns, we do not use the <code dir="auto">linewidth</code>
parameter, as it has no effect on columns.</li>
<li>Our script’s second plot is the <strong>change</strong> in volume, which we have
calculated earlier using <code dir="auto">ta.change(volume)</code>. This value is plotted
as a histogram, for which the <code dir="auto">linewidth</code> parameter controls the
width of the column. We make this width <code dir="auto">12</code> so that histogram
elements are thinner than the columns of the first plot.
Positive/negative <code dir="auto">volumeChange</code> values plot above/below the zero
line; no manipulation is required to achieve this effect.</li>
<li>Before plotting the histogram of <code dir="auto">volumeChange</code> values, we calculate
its color value, which can be one of four different colors. We use
the bright <code dir="auto">GREEN</code> or <code dir="auto">PINK</code> colors when the bar is up/down AND the
volume has increased since the last bar (<code dir="auto">volumeChange &gt; 0</code>).
Because <code dir="auto">volumeChange</code> is positive in this case, the histogram’s
element will be plotted above the zero line. We use the bright
<code dir="auto">GREEN_LIGHT</code> or <code dir="auto">PINK_LIGHT</code> colors when the bar is up/down AND the
volume has NOT increased since the last bar. Because <code dir="auto">volumeChange</code>
is negative in this case, the histogram’s element will be plotted
below the zero line.</li>
<li>Finally, we plot a zero line. We could just as well have used
<code dir="auto">hline(0)</code> there.</li>
<li>We use <code dir="auto">format = format.volume</code> in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
call so that large values displayed for this script are abbreviated
like those of the built-in “Volume” indicator.</li>
</ul>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls must always be placed in a line’s first position, which entails
they are always in the script’s global scope. They can’t be placed in
user-defined functions or structures like
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>,
etc. Calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
<strong>can</strong>, however, be designed to plot conditionally in two ways, which
we cover in the
<a href="/pine-script-docs/v5/concepts/plots/#plotting-conditionally">Plotting conditionally</a> section of this page.</p>
<p>A script can only plot in its own visual space, whether it is in a pane
or on the chart as an overlay. Scripts running in a pane can only
<a href="/pine-script-docs/v5/concepts/bar-coloring/">color bars</a> in the
chart area.</p>
<h2 class="md-heading" id="plot-parameters"><a href="#plot-parameters">`plot()` parameters<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
function has the following signature:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plot(series, title, color, linewidth, style, trackprice, histbase, offset, join, editable, show_last, display, force_overlay) → plot</span></div></div></code></pre></figure></link></div>
<p>The parameters of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
are:</p>
<p><code dir="auto">series</code></p>
<p class="spacer-wrapper"><spacer/>It is the only mandatory parameter. Its argument must be of “series
int/float” type. Note that because the auto-casting rules in Pine
Script™ convert in the int 🠆 float 🠆 bool direction, a “bool” type
variable cannot be used as is; it must be converted to an “int” or
a “float” for use as an argument. For example, if <code dir="auto">newDay</code> is of
“bool” type, then <code dir="auto">newDay ? 1 : 0</code> can be used to plot 1 when the
variable is <code dir="auto">true</code>, and zero when it is <code dir="auto">false</code>.</p>
<p><code dir="auto">title</code></p>
<p class="spacer-wrapper"><spacer/>Requires a “const string” argument, so it must be known at compile
time. The string appears:</p>
<ul>
<li>In the script’s scale when the “Chart
settings/Scales/Indicator Name Label” field is checked.</li>
<li>In the Data Window.</li>
<li>In the “Settings/Style” tab.</li>
<li>In the dropdown of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsource">input.source()</a>
fields.</li>
<li>In the “Condition” field of the “Create Alert” dialog box,
when the script is selected.</li>
<li>As the column header when exporting chart data to a CSV file.</li>
</ul>
<p><code dir="auto">color</code></p>
<p class="spacer-wrapper"><spacer/>Accepts “series color”, so can be calculated on the fly, bar by
bar. Plotting with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
as the color, or any color with a transparency of 100, is one way to
hide plots when they are not needed.</p>
<p><code dir="auto">linewidth</code></p>
<p class="spacer-wrapper"><spacer/>Is the plotted element’s size, but it does not apply to all styles.
When a line is plotted, the unit is pixels. It has no impact when
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_columns">plot.style_columns</a>
is used.</p>
<p><code dir="auto">style</code></p>
<p class="spacer-wrapper"><spacer/>The available arguments are:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_line">plot.style_line</a>
(the default): It plots a continous line using the <code dir="auto">linewidth</code>
argument in pixels for its width.
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values will not plot as a line, but they will be bridged when a
value that is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
comes in.
Non-<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values are only bridged if they are visible on the chart.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_linebr">plot.style_linebr</a>:
Allows the plotting of discontinuous lines by not plotting on
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values, and not joining gaps, i.e., bridging over
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_stepline">plot.style_stepline</a>:
Plots using a staircase effect. Transitions between changes in
values are done using a vertical line drawn in middle of bars,
as opposed to a point-to-point diagonal joining the midpoints of
bars. Can also be used to achieve an effect similar to that of
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_linebr">plot.style_linebr</a>,
but only if care is taken to plot no color on
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_area">plot.style_area</a>:
plots a line of <code dir="auto">linewidth</code> width, filling the area between the
line and the <code dir="auto">histbase</code>. The <code dir="auto">color</code> argument is used for both
the line and the fill. You can make the line a different color
by using another
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call. Positive values are plotted above the <code dir="auto">histbase</code>, negative
values below it.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_area">plot.style_areabr</a>:
This is similar to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_area">plot.style_area</a>
but it doesn’t bridge over
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values. Another difference is how the indicator’s scale is
calculated. Only the plotted values serve in the calculation of
the <em>y</em> range of the script’s visual space. If only high values
situated far away from the <code dir="auto">histbase</code> are plotted, for example,
those values will be used to calculate the <em>y</em> scale of the
script’s visual space. Positive values are plotted above the
<code dir="auto">histbase</code>, negative values below it.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_columns">plot.style_columns</a>:
Plots columns similar to those of the “Volume” built-in
indicator. The <code dir="auto">linewidth</code> value does <strong>not</strong> affect the width
of the columns. Positive values are plotted above the
<code dir="auto">histbase</code>, negative values below it. Always includes the value
of <code dir="auto">histbase</code> in the <em>y</em> scale of the script’s visual space.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_histogram">plot.style_histogram</a>:
Plots columns similar to those of the “Volume” built-in
indicator, except that the <code dir="auto">linewidth</code> value is used to
determine the width of the histogram’s bars in pixels. Note
that since <code dir="auto">linewidth</code> requires an “input int” value, the
width of the histogram’s bars cannot vary bar to bar. Positive
values are plotted above the <code dir="auto">histbase</code>, negative values below
it. Always includes the value of <code dir="auto">histbase</code> in the <em>y</em> scale of
the script’s visual space.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_circles">plot.style_circles</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_cross">plot.style_cross</a>:
These plot a shape that is not joined across bars unless
<code dir="auto">join = true</code> is also used. For these styles, the <code dir="auto">linewidth</code>
argument becomes a relative sizing measure — its units are not
pixels.</li>
</ul>
<p><code dir="auto">trackprice</code></p>
<p class="spacer-wrapper"><spacer/>The default value of this is <code dir="auto">false</code>. When it is <code dir="auto">true</code>, a dotted
line made up of small squares will be plotted the full width of the
script’s visual space. It is often used in conjuction with
<code dir="auto">show_last = 1, offset = -99999</code> to hide the actual plot and only
leave the residual dotted line.</p>
<p><code dir="auto">histbase</code></p>
<p class="spacer-wrapper"><spacer/>It is the reference point used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_area">plot.style_area</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_columns">plot.style_columns</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_histogram">plot.style_histogram</a>.
It determines the level separating positive and negative values of
the <code dir="auto">series</code> argument. It cannot be calculated dynamically, as an
“input int/float” is required.</p>
<p><code dir="auto">offset</code></p>
<p class="spacer-wrapper"><spacer/>This allows shifting the plot in the past/future using a
negative/positive offset in bars. The value cannot change during the
script’s execution.</p>
<p><code dir="auto">join</code></p>
<p class="spacer-wrapper"><spacer/>This only affect styles
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_circles">plot.style_circles</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_cross">plot.style_cross</a>.
When <code dir="auto">true</code>, the shapes are joined by a one-pixel line.</p>
<p><code dir="auto">editable</code></p>
<p class="spacer-wrapper"><spacer/>This boolean parameter controls whether or not the plot’s
properties can be edited in the “Settings/Style” tab. Its default
value is <code dir="auto">true</code>.</p>
<p><code dir="auto">show_last</code></p>
<p class="spacer-wrapper"><spacer/>Allows control over how many of the last bars the plotted values are
visible. An “input int” argument is required, so it cannot be
calculated dynamically.</p>
<p><code dir="auto">display</code></p>
<p class="spacer-wrapper"><spacer/>The default is
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_display%7Bdot%7Dall">display.all</a>.
When it is set to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_display%7Bdot%7Dnone">display.none</a>,
plotted values will not affect the scale of the script’s visual
space. The plot will be invisible and will not appear in indicator
values or the Data Window. It can be useful in plots destined for
use as external inputs for other scripts, or for plots used with the
<code dir="auto">{{plot("[plot_title]")}}</code> placeholder in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>
calls, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
r = ta.rsi(close, 14)
xUp = ta.crossover(r, 50)
plot(r, "RSI", display = display.none)
alertcondition(xUp, "xUp alert", message = 'RSI is bullish at: {{plot("RSI")}}')</code></div>
<p><code dir="auto">force_overlay</code></p>
<p class="spacer-wrapper"><spacer/>If <code dir="auto">true</code>, the plotted results will display on the main chart pane, even when the script occupies a separate pane. Optional. The default is <code dir="auto">false</code>.</p>
<h2 class="md-heading" id="plotting-conditionally"><a href="#plotting-conditionally">Plotting conditionally<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls cannot be used in conditional structures such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>, but
they can be controlled by varying their plotted values, or their color.
When no plot is required, you can either plot
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values, or plot values using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> color
or any color with 100 transparency (which also makes it invisible).</p>
<h3 class="md-heading" id="value-control"><a href="#value-control">Value control<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One way to control the display of plots is to plot
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values when no plot is needed. Sometimes, values returned by functions
such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
will return
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values, when <code dir="auto">gaps = barmerge.gaps_on</code> is used, for example. In both
these cases it is sometimes useful to plot discontinuous lines. This
script shows a few ways to do it:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="796" loading="lazy" src="images/fe27c11f744331231cbaa58d71631b17.webp" width="1786"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Discontinuous plots", "", true)
bool plotValues = bar_index % 3 == 0
plot(plotValues ? high : na, color = color.fuchsia, linewidth = 6, style = plot.style_linebr)
plot(plotValues ? high : na)
plot(plotValues ? math.max(open, close) : na, color = color.navy, linewidth = 6, style = plot.style_cross)
plot(plotValues ? math.min(open, close) : na, color = color.navy, linewidth = 6, style = plot.style_circles)
plot(plotValues ? low : na, color = plotValues ? color.green : na, linewidth = 6, style = plot.style_stepline)</code></div>
<p>Note that:</p>
<ul>
<li>We define the condition determining when we plot using
<code dir="auto">bar_index % 3 == 0</code>, which becomes <code dir="auto">true</code> when the remainder of the
division of the bar index by 3 is zero. This will happen every three
bars.</li>
<li>In the first plot, we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_linebr">plot.style_linebr</a>,
which plots the fuchsia line on highs. It is centered on the bar’s
horizontal midpoint.</li>
<li>The second plot shows the result of plotting the same values, but
without using special care to break the line. What’s happening here
is that the thin blue line of the plain
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call is automatically bridged over
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values (or <em>gaps</em>), so the plot does not interrupt.</li>
<li>We then plot navy blue crosses and circles on the body tops and
bottoms. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_circles">plot.style_circles</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_cross">plot.style_cross</a>
style are a simple way to plot discontinuous values, e.g., for stop
or take profit levels, or support &amp; resistance levels.</li>
<li>The last plot in green on the bar lows is done using
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_stepline">plot.style_stepline</a>.
Note how its segments are wider than the fuchsia line segments
plotted with
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_linebr">plot.style_linebr</a>.
Also note how on the last bar, it only plots halfway until the next
bar comes in.</li>
<li>The plotting order of each plot is controlled by their order of
appearance in the script. See</li>
</ul>
<p>This script shows how you can restrict plotting to bars after a
user-defined date. We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dtime">input.time()</a>
function to create an input widget allowing script users to select a
date and time, using Jan 1st 2021 as its default value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
startInput = input.time(timestamp("2021-01-01"))
plot(time &gt; startInput ? close : na)</code></div>
<h3 class="md-heading" id="color-control"><a href="#color-control">Color control<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="/pine-script-docs/v5/concepts/colors/#conditional-coloring">Conditional coloring</a> section of the page on colors discusses color control for
plots. We’ll look here at a few examples.</p>
<p>The value of the <code dir="auto">color</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
can be a constant, such as one of the built-in
<a href="/pine-script-docs/v5/concepts/colors/#constant-colors">constant colors</a> or a
<a href="/pine-script-docs/v5/language/type-system/#color">color literal</a>. In Pine Script™, the qualified type of such colors is
called <strong>“const color”</strong> (see the
<a href="/pine-script-docs/v5/language/type-system/">Type system</a> page). They
are known at compile time:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
plot(close, color = color.gray)</code></div>
<p>The color of a plot can also be determined using information that is
only known when the script begins execution on the first historical bar
of a chart (bar zero, i.e., <code dir="auto">bar_index == 0</code> or
<code dir="auto">barstate.isfirst == true</code>), as will be the case when the information
needed to determine a color depends on the chart the script is running
on. Here, we calculate a plot color using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtype">syminfo.type</a>
built-in variable, which returns the type of the chart’s symbol. The
qualified type of <code dir="auto">plotColor</code> in this case will be <strong>“simple color”</strong>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
plotColor = switch syminfo.type
    "stock"     =&gt; color.purple
    "futures"   =&gt; color.red
    "index"     =&gt; color.gray
    "forex"     =&gt; color.fuchsia
    "crypto"    =&gt; color.lime
    "fund"      =&gt; color.orange
    "dr"        =&gt; color.aqua
    "cfd"       =&gt; color.blue
plot(close, color = plotColor)
printTable(txt) =&gt; var table t = table.new(position.middle_right, 1, 1), table.cell(t, 0, 0, txt, bgcolor = color.yellow)
printTable(syminfo.type)</code></div>
<p>Plot colors can also be chosen through a script’s inputs. In this case,
the <code dir="auto">lineColorInput</code> variable is of the <strong>“input color”</strong> type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
color lineColorInput  = input(#1848CC, "Line color")
plot(close, color = lineColorInput)</code></div>
<p>Finally, plot colors can also be <em>dynamic</em> values, i.e., calculated
values that can change on each bar. These values are of the <strong>“series
color”</strong> type:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
plotColor = close &gt;= open ? color.lime : color.red
plot(close, color = plotColor)</code></div>
<p>When plotting pivot levels, one common requirement is to avoid plotting
level transitions. Using <a href="/pine-script-docs/v5/concepts/lines-and-boxes/">lines</a> is one alternative, but you can also use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
like this:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="790" loading="lazy" src="images/56d5cac4d31facb618637b1b78cf572a.webp" width="1780"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pivot plots", "", true)
pivotHigh = fixnan(ta.pivothigh(3,3))
plot(pivotHigh, "High pivot", ta.change(pivotHigh) ? na : color.olive, 3)
plotchar(ta.change(pivotHigh), "ta.change(pivotHigh)", "•", location.top, size = size.small)</code></div>
<p>Note that:</p>
<ul>
<li>We use <code dir="auto">pivotHigh = fixnan(ta.pivothigh(3,3))</code> to hold our pivot
values. Because
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">ta.pivothigh()</a>
only returns a value when a new pivot is found, we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fixnan">fixnan()</a>
to fill the gaps with the last pivot value returned. The gaps here
refer to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">ta.pivothigh()</a>
returns when no new pivot is found.</li>
<li>Our pivots are detected three bars after they occur because we use
the argument <code dir="auto">3</code> for both the <code dir="auto">leftbars</code> and <code dir="auto">rightbars</code> parameters
in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dpivothigh">ta.pivothigh()</a>
call.</li>
<li>The last plot is plotting a continuous value, but it is setting the
plot’s color to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
when the pivot’s value changes, so the plot isn’t visible then.
Because of this, a visible plot will only appear on the bar
following the one where we plotted using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
color.</li>
<li>The blue dot indicates when a new high pivot is detected and no plot
is drawn between the preceding bar and that one. Note how the pivot
on the bar indicated by the arrow has just been detected in the
realtime bar, three bars later, and how no plot is drawn. The plot
will only appear on the next bar, making the plot visible <strong>four
bars</strong> after the actual pivot.</li>
</ul>
<h2 class="md-heading" id="levels"><a href="#levels">Levels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ has an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
function to plot horizontal lines (see the page on
<a href="/pine-script-docs/v5/concepts/levels/">Levels</a>).
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>
is useful because it has some line styles unavailable with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
but it also has some limitations, namely that it does not accept
“series color”, and that its <code dir="auto">price</code> parameter requires an “input
int/float”, so cannot vary during the script’s execution.</p>
<p>You can plot levels with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
in a few different ways. This shows a
<a href="https://www.tradingview.com/support/solutions/43000502001">CCI</a>
indicator with levels plotted using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="760" loading="lazy" src="images/33f8f151b08b9e2151d43cbb1f4871e7.webp" width="1774"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("CCI levels with `plot()`")
plot(ta.cci(close, 20))
plot(0,  "Zero", color.gray, 1, plot.style_circles)
plot(bar_index % 2 == 0 ?  100 : na,  "100", color.lime, 1, plot.style_linebr)
plot(bar_index % 2 == 0 ? -100 : na, "-100", color.fuchsia, 1, plot.style_linebr)
plot( 200,  "200", color.green, 2, trackprice = true, show_last = 1, offset = -99999)
plot(-200, "-200", color.red,   2, trackprice = true, show_last = 1, offset = -99999)
plot( 300,  "300", color.new(color.green, 50), 1)
plot(-300, "-300", color.new(color.red, 50),   1)</code></div>
<p>Note that:</p>
<ul>
<li>The zero level is plotted using
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_circles">plot.style_circles</a>.</li>
<li>The 100 levels are plotted using a conditional value that only plots
every second bar. In order to prevent the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values from being bridged, we use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot%7Bdot%7Dstyle_linebr">plot.style_linebr</a>
line style.</li>
<li>The 200 levels are plotted using <code dir="auto">trackprice = true</code> to plot a
distinct pattern of small squares that extends the full width of the
script’s visual space. The <code dir="auto">show_last = 1</code> in there displays only
the last plotted value, which would appear as a one-bar straight
line if the next trick wasn’t also used: the <code dir="auto">offset = -99999</code>
pushes that one-bar segment far away in the past so that it is never
visible.</li>
<li>The 300 levels are plotted using a continuous line, but a lighter
transparency is used to make them less prominent.</li>
</ul>
<h2 class="md-heading" id="offsets"><a href="#offsets">Offsets<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">offset</code> parameter specifies the shift used when the line is plotted
(negative values shift in the past, positive values shift into the
future). For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
plot(close, color = color.red, offset = -5)
plot(close, color = color.lime, offset = 5)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="624" loading="lazy" src="images/3f26d569903c645dd252bf82029df0ed.webp" width="1762"/></div></p>
<p>As can be seen in the screenshot, the <em>red</em> series has been shifted to
the left (since the argument’s value is negative), while the <em>green</em>
series has been shifted to the right (its value is positive).</p>
<h2 class="md-heading" id="plot-count-limit"><a href="#plot-count-limit">Plot count limit<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Each script is limited to a maximum plot count of 64. All <code dir="auto">plot*()</code>
calls and
<a href="https://www.tradingview.com/pine-script-reference/v5/#func_alertcondition">alertcondition()</a>
calls count in the plot count of a script. Some types of calls count for
more than one in the total plot count.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls count for one in the total plot count if they use a “const
color” argument for the <code dir="auto">color</code> parameter, which means it is known at
compile time, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(close, color = color.green)</code></div>
<p>When they use another qualified type, such as any one of these, they
will count for two in the total plot count:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(close, color = syminfo.mintick &gt; 0.0001 ? color.green : color.red) //🠆 "simple color"
plot(close, color = input.color(color.purple)) //🠆 "input color"
plot(close, color = close &gt; open ? color.green : color.red) //🠆 "series color"
plot(close, color = color.new(color.silver, close &gt; open ? 40 : 0)) //🠆 "series color"</code></div>
<h2 class="md-heading" id="scale"><a href="#scale">Scale<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Not all values can be plotted everywhere. Your script’s visual space is
always bound by upper and lower limits that are dynamically adjusted
with the values plotted. An
<a href="https://www.tradingview.com/support/solutions/43000502338">RSI</a>
indicator will plot values between 0 and 100, which is why it is usually
displayed in a distinct <em>pane</em> — or area — above or below the chart.
If RSI values were plotted as an overlay on the chart, the effect would
be to distort the symbol’s normal price scale, unless it just hapenned
to be close to RSI’s 0 to 100 range. This shows an RSI signal line and
a centerline at the 50 level, with the script running in a separate
pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="404" loading="lazy" src="images/5d0c9a8c3419e61febb5d41b45a6a7d6.webp" width="1765"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("RSI")
myRSI = ta.rsi(close, 20)
bullColor = color.from_gradient(myRSI, 50, 80, color.new(color.lime, 70), color.new(color.lime, 0))
bearColor = color.from_gradient(myRSI, 20, 50, color.new(color.red,   0), color.new(color.red, 70))
myRSIColor = myRSI &gt; 50 ? bullColor : bearColor
plot(myRSI, "RSI", myRSIColor, 3)
hline(50)</code></div>
<p>Note that the <em>y</em> axis of our script’s visual space is automatically
sized using the range of values plotted, i.e., the values of RSI. See
the page on <a href="/pine-script-docs/v5/concepts/colors/">Colors</a> for more
information on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color%7Bdot%7Dfrom_gradient">color.from_gradient()</a>
function used in the script.</p>
<p>If we try to plot the symbol’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values in the same space by adding the following line to our script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(close)</code></div>
<p>This is what happens:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="364" loading="lazy" src="images/a1d265c6040459ce86f75fa3415d3684.webp" width="1764"/></div></p>
<p>The chart is on the BTCUSD symbol, whose
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices are around 40000 during this period. Plotting values in the 40000
range makes our RSI plots in the 0 to 100 range indiscernible. The same
distorted plots would occur if we placed the
<a href="https://www.tradingview.com/support/solutions/43000502338">RSI</a>
indicator on the chart as an overlay.</p>
<h3 class="md-heading" id="merging-two-indicators"><a href="#merging-two-indicators">Merging two indicators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If you are planning to merge two signals in one script, first consider
the scale of each. It is impossible, for example, to correctly plot an
<a href="https://www.tradingview.com/support/solutions/43000502338">RSI</a> and a
<a href="https://www.tradingview.com/support/solutions/43000502344">MACD</a> in the
same script’s visual space because RSI has a fixed range (0 to 100)
while MACD doesn’t, as it plots moving averages calculated on price._</p>
<p>If both your indicators used fixed ranges, you can shift the values of
one of them so they do not overlap. We could, for example, plot both
<a href="https://www.tradingview.com/support/solutions/43000502338">RSI</a> (0 to
100) and the <a href="https://www.tradingview.com/support/solutions/43000592290">True Strength Indicator
(TSI)</a> (-100
to +100) by displacing one of them. Our strategy here will be to
compress and shift the
<a href="https://www.tradingview.com/support/solutions/43000592290">TSI</a> values
so they plot over
<a href="https://www.tradingview.com/support/solutions/43000502338">RSI</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="512" loading="lazy" src="images/cbfc1b2eeddc18013fab00b26d99fea3.webp" width="1752"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("RSI and TSI")
myRSI = ta.rsi(close, 20)
bullColor = color.from_gradient(myRSI, 50, 80, color.new(color.lime, 70), color.new(color.lime, 0))
bearColor = color.from_gradient(myRSI, 20, 50, color.new(color.red,   0), color.new(color.red, 70))
myRSIColor = myRSI &gt; 50 ? bullColor : bearColor
plot(myRSI, "RSI", myRSIColor, 3)
hline(100)
hline(50)
hline(0)

// 1. Compress TSI's range from -100/100 to -50/50.
// 2. Shift it higher by 150, so its -50 min value becomes 100.
myTSI = 150 + (100 * ta.tsi(close, 13, 25) / 2)
plot(myTSI, "TSI", color.blue, 2)
plot(ta.ema(myTSI, 13), "TSI EMA", #FF006E)
hline(200)
hline(150)</code></div>
<p>Note that:</p>
<ul>
<li>
<p>We have added levels using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline</a>
to situate both signals.</p>
</li>
<li>
<p>In order for both signal lines to oscillate on the same range of
100, we divide the
<a href="https://www.tradingview.com/support/solutions/43000592290">TSI</a>
value by 2 because it has a 200 range (-100 to +100). We then shift
this value up by 150 so it oscillates between 100 and 200, making
150 its centerline.</p>
</li>
<li>
<p>The manipulations we make here are typical of the compromises
required to bring two indicators with different scales in the same
visual space, even when their values, contrary to
<a href="https://www.tradingview.com/support/solutions/43000502344">MACD</a>,
are bounded in a fixed range.</p>
</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/other-timeframes-and-data"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Other timeframes and data  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/repainting"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Repainting <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Repainting</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-repainting"><a href="#repainting">Repainting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We define repainting as: <strong>script behavior causing historical vs
realtime calculations or plots to behave differently</strong>.</p>
<p>Repainting behavior is widespread and many factors can cause it.
Following our definition, our estimate is that more than 95% of
indicators in existence exhibit some form of repainting behavior.
Commony used indicators such as MACD and RSI, for example, show
confirmed values on historical bars, but will fluctuate on a realtime,
unconfirmed chart bar until it closes. Therefore, they behave
<em>differently</em> in historical and realtime states.</p>
<p><strong>Not all repainting behavior is inherently useless or misleading</strong>, nor
does such behavior prevent knowledgeable traders from using indicators
with such behavior. For example, who would think of discrediting a
volume profile indicator solely because it updates its values on
realtime bars?</p>
<p>One may encounter any of the following forms of repainting in the
scripts they use, depending on what a script’s calculations entail:</p>
<ul>
<li><strong>Widespread but often acceptable</strong>: A script may use values that
update with realtime price changes on the unconfirmed bar. For
example, if one uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
variable in calculations performed on an open chart bar, its values
will reflect the most recent price in the bar. However, the script
will only commit a new data point to its historical series once the
bar closes. Another common case is using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to fetch higher-timeframe data on realtime bars, as explained in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#historical-and-realtime-behavior">Historical and realtime behavior</a> section of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page. As with the unconfirmed chart bar in the chart’s
timeframe,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
can track unconfirmed values from a higher-timeframe context on
realtime bars, which can lead to repainting after the script
restarts its execution. There is often nothing wrong with using such
scripts, provided you understand how they work. When electing to use
such scripts to issue alerts or trade orders, however, it’s
important to understand the difference between their realtime and
historical behavior and decide for yourself whether it provides
utility for your needs.</li>
<li><strong>Potentially misleading</strong>: Scripts that plot values into the past,
calculate results on realtime bars that one cannot replicate on
historical bars, or relocate past events are potentially misleading.
For example, Ichimoku, most scripts based on pivots, most strategies
using <code dir="auto">calc_on_every_tick = true</code>, scripts using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
when it behaves differently on realtime bars, many scripts using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>,
many scripts using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>,
and some scripts that use <code dir="auto">barstate.*</code> variables can exhibit
misleading repainting behavior.</li>
<li><strong>Unacceptable</strong>: Scripts that leak future information into the
past, strategies that execute on
<a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard charts</a>, and scripts using realtime intrabars to generate alerts
or orders, are examples that can produce heavily misleading
repainting behavior.</li>
<li><strong>Unavoidable</strong>: Revisions of the data feed from a provider and
variations in the starting bar of the chart’s history can cause
repainting behavior that may be unavoidable in a script.</li>
</ul>
<p>The first two types of repainting can be perfectly acceptable if:</p>
<ol>
<li>You are aware of the behavior.</li>
<li>You can live with it, or</li>
<li>You can circumvent it.</li>
</ol>
<p>It should now be clear that not <strong>all</strong> repainting behavior is wrong and
requires avoiding at all costs. In many situations, some forms of
repainting may be exactly what a script needs. What’s important is to
know when repainting behavior is <strong>not</strong> acceptable for one’s needs. To
avoid repainting that’s not acceptable, it’s important to understand
how a tool works or how you should design the tools you build. If you
<a href="/pine-script-docs/v5/writing/publishing/">publish</a> scripts, ensure
you mention any potentially misleading behavior along with the other
limitations of your script in the publication’s description.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>We will not discuss the perils of using strategies on non-standard
charts, as this problem is not related to repainting. See the
<a href="https://www.tradingview.com/script/q9laJNG9-Backtesting-on-Non-Standard-Charts-Caution-PineCoders-FAQ/">Backtesting on Non-Standard Charts:
Caution!</a>
script for a discussion of the subject.</p></div></aside>
<h3 class="md-heading" id="for-script-users"><a href="#for-script-users">For script users<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One can decide to use repainting indicators if they understand the
behavior, and whether that behavior meets their analysis requirements.
Don’t be one of those newcomers who slap “repaint” sentences on
published scripts in an attempt to discredit them, as doing so reveals a
lack of foundational knowledge on the subject.</p>
<p>Simply asking whether a script repaints is relatively meaningless, given
that there are forms of repainting behavior that are perfectly
acceptable in a script. Therefore, such a question will not beget a
meaningful answer. One should instead ask <em>specific</em> questions about a
script’s potential repainting behavior, such as:</p>
<ul>
<li>Does the script calculate/display in the same way on historical and
realtime bars?</li>
<li>Do alerts from the script wait for the end of a realtime bar before
triggering?</li>
<li>Do signal markers shown by the script wait for the end of a realtime
bar before showing?</li>
<li>Does the script plot/draw values into the past?</li>
<li>Does the strategy use <code dir="auto">calc_on_every_tick = true</code>?</li>
<li>Do the script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
calls leak future information into the past on historical bars?</li>
</ul>
<p>What’s important is that you understand how the tools you use work, and
whether their behavior is compatible with your objectives, repainting or
not. As you will learn if you read this page, repainting is a complex
matter. It has many faces and many causes. Even if you don’t program in
Pine Script™, this page will help you understand the array of causes
that can lead to repainting, and hopefully enable more meaningful
discussions with script authors.</p>
<h3 class="md-heading" id="for-pine-script-programmers"><a href="#for-pine-script-programmers">For Pine Script™ programmers<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>As discussed above, not all forms of repainting behavior must be avoided
at all costs, nor is all potential repainting behavior necessarily
avoidable. We hope this page helps you better understand the dynamics at
play so that you can design your trading tools with these behaviors in
mind. This page’s content should help make you aware of common coding
mistakes that produce misleading repainting results.</p>
<p>Whatever your design decisions are, if you
<a href="/pine-script-docs/v5/writing/publishing/">publish</a> your script,
explain the script to traders so they can understand how it behaves.</p>
<p>This page covers three broad categories of repainting causes:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/repainting/#historical-vs-realtime-calculations">Historical vs realtime calculations</a></li>
<li><a href="/pine-script-docs/v5/concepts/repainting/#plotting-in-the-past">Plotting in the past</a></li>
<li><a href="/pine-script-docs/v5/concepts/repainting/#dataset-variations">Dataset variations</a></li>
</ul>
<h2 class="md-heading" id="historical-vs-realtime-calculations"><a href="#historical-vs-realtime-calculations">Historical vs realtime calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="fluid-data-values"><a href="#fluid-data-values">Fluid data values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Historical data does not include records of intermediary price movements
on bars; only
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values (OHLC).</p>
<p>On realtime bars (bars running when the instrument’s market is open),
however, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values are not fixed; they can change values many times before the
realtime bar closes and its HLC values are fixed. They are <em>fluid</em>. This
leads to a script sometimes working differently on historical data and
in real time, where only the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
price will not change during the bar.</p>
<p>Any script using values like
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
in realtime is subject to producing calculations that may not be
repeatable on historical bars — thus repaint.</p>
<p>Let’s look at this simple script. It detects crosses of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value (in the realtime bar, this corresponds to the current price of the
instrument) over and under an
<a href="https://www.tradingview.com/support/solutions/43000592270">EMA</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="726" loading="lazy" src="images/16e9a0a80e01772f46cb3d79c4fd2c60.webp" width="1748"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting", "", true)
ma = ta.ema(close, 5)
xUp = ta.crossover(close, ma)
xDn = ta.crossunder(close, ma)
plot(ma, "MA", color.black, 2)
bgcolor(xUp ? color.new(color.lime, 80) : xDn ? color.new(color.fuchsia, 80) : na)</code></div>
<p>Note that:</p>
<ul>
<li>The script uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
to color the background green when
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
crosses over the EMA, and red on crosses under the EMA.</li>
<li>The screen snapshot shows the script in realtime on a 30sec
chart. A cross over the EMA has been detected, thus the
background of the realtime bar is green.</li>
<li>The problem here is that nothing guarantees this condition will
hold true until the end of the realtime bar. The arrow points to
the timer showing that 21 seconds remain in the realtime bar,
and anything could happen until then.</li>
<li>We are witnessing a repainting script.</li>
</ul>
<p>To prevent this repainting, we must rewrite our script so that it does
not use values that fluctuate during the realtime bar. This will require
using values from a bar that has elapsed (typically the preceding bar),
or the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
price, which does not vary in realtime.</p>
<p>We can achieve this in many ways. This method adds a
<code dir="auto">and barstate.isconfirmed</code> condition to our cross detections, which
requires the script to be executing on the bar’s last iteration, when
it closes and prices are confirmed. It is a simple way to avoid
repainting:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting", "", true)
ma = ta.ema(close, 5)
xUp = ta.crossover(close, ma) and barstate.isconfirmed
xDn = ta.crossunder(close, ma) and barstate.isconfirmed
plot(ma, "MA", color.black, 2)
bgcolor(xUp ? color.new(color.lime, 80) : xDn ? color.new(color.fuchsia, 80) : na)</code></div>
<p>This uses the crosses detected on the previous bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting", "", true)
ma = ta.ema(close, 5)
xUp = ta.crossover(close, ma)[1]
xDn = ta.crossunder(close, ma)[1]
plot(ma, "MA", color.black, 2)
bgcolor(xUp ? color.new(color.lime, 80) : xDn ? color.new(color.fuchsia, 80) : na)</code></div>
<p>This uses only confirmed
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
and EMA values for its calculations:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting", "", true)
ma = ta.ema(close[1], 5)
xUp = ta.crossover(close[1], ma)
xDn = ta.crossunder(close[1], ma)
plot(ma, "MA", color.black, 2)
bgcolor(xUp ? color.new(color.lime, 80) : xDn ? color.new(color.fuchsia, 80) : na)</code></div>
<p>This detects crosses between the realtime bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
and the value of the EMA from the previous bars. Notice that the EMA is
calculated using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
so it repaints. We must ensure we use a confirmed value to detect
crosses, thus <code dir="auto">ma[1]</code> in the cross detection logic:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting", "", true)
ma = ta.ema(close, 5)
xUp = ta.crossover(open, ma[1])
xDn = ta.crossunder(open, ma[1])
plot(ma, "MA", color.black, 2)
bgcolor(xUp ? color.new(color.lime, 80) : xDn ? color.new(color.fuchsia, 80) : na)</code></div>
<p><strong>All these methods have one thing in common: while they prevent
repainting, they will also trigger signals later than repainting
scripts. This is an inevitable compromise if one wants to avoid
repainting. You can’t have your cake and eat it too.</strong></p>
<h3 class="md-heading" id="repainting-requestsecurity-calls"><a href="#repainting-requestsecurity-calls">Repainting `request.security()` calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
function behaves differently on historical and realtime bars. On
historical bars, it only returns <em>confirmed</em> values from its requested
context, wheras it can return <em>unconfirmed</em> values on realtime bars.
When the script restarts its execution, the bars that had a realtime
state become historical bars, and will therefore only contain the values
it confirmed on those bars. If the values returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
fluctuate on realtime bars without confirmation from the context, the
script will repaint them when it restarts its execution. See the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#historical-and-realtime-behavior">Historical and realtime behavior</a> section of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page for a detailed explanation.</p>
<p>One can ensure higher-timeframe data requests only return confirmed
values on all bars, regardless of bar state, by offsetting the
<code dir="auto">expression</code> argument by at least one bar with the history-referencing
operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>
and using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>
for the <code dir="auto">lookahead</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call, as explained
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#higher-timeframe-data">here</a>.</p>
<p>The script below demonstrates the difference between repainting and
non-repainting HTF data requests. It contains two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
calls. The first function call requests
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
data from the <code dir="auto">higherTimeframe</code> without additional specification, and
the second call requests the same series with an offset and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barmerge.lookahead_on">barmerge.lookahead_on</a>.</p>
<p>As we see on all
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">realtime</a>
bars (the ones with an orange background), the <code dir="auto">repaintingClose</code>
contains values that fluctuate without confirmation from the
<code dir="auto">higherTimeframe</code>, meaning it will <em>repaint</em> when the script restarts
its execution. The <code dir="auto">nonRepaintingClose</code>, on the other hand, behaves the
same on realtime and historical bars, i.e., it only changes its value
when new, confirmed data is available:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/7d51f4680e8e97dd3e7d4f13f11b1e17.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repainting vs non-repainting `request.security()` demo", overlay = true)

//@variable The timeframe to request data from.
string higherTimeframe = input.timeframe("30", "Timeframe")

if timeframe.in_seconds() &gt; timeframe.in_seconds(higherTimeframe)
    runtime.error("The 'Timeframe' input is smaller than the chart's timeframe. Choose a higher timeframe.")

//@variable The current `close` requested from the `higherTimeframe`. Fluctuates without confirmation on realtime bars.
float repaintingClose = request.security(syminfo.tickerid, higherTimeframe, close)
//@variable The last confirmed `close` requested from the `higherTimeframe`. 
// Behaves the same on historical and realtime bars.
float nonRepaintingClose = request.security(
     syminfo.tickerid, higherTimeframe, close[1], lookahead = barmerge.lookahead_on
 )

// Plot the values.
plot(repaintingClose, "Repainting close", color.new(color.purple, 50), 8)
plot(nonRepaintingClose, "Non-repainting close", color.teal, 3)
// Plot a shape when a new `higherTimeframe` starts.
plotshape(timeframe.change(higherTimeframe), "Timeframe change marker", shape.square, location.top, size = size.small)
// Color the background on realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 60) : na, title = "Realtime bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We used the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
function to mark the chart when there’s a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">change</a>
on the <code dir="auto">higherTimeframe</code>.</li>
<li>This script produces a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error">runtime
error</a>
if the <code dir="auto">higherTimeframe</code> is lower than the chart’s timeframe.</li>
<li>On historical bars, the <code dir="auto">repaintingClose</code> has a new value at the
<em>end</em> of each timeframe, and the <code dir="auto">nonRepaintingClose</code> has a new
value at the <em>start</em> of each timeframe.</li>
</ul>
<p>For the sake of easy reusability, below is a simple a
<code dir="auto">noRepaintSecurity()</code> function that one can apply in their scripts to
request non-repainting higher-timeframe values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function Requests non-repainting `expression` values from the context of the `symbol` and `timeframe`.
noRepaintSecurity(symbol, timeframe, expression) =&gt;
    request.security(symbol, timeframe, expression[1], lookahead = barmerge.lookahead_on)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">[1]</code> offset to the series and the use of
<code dir="auto">lookahead = barmerge.lookahead_on</code> are interdependent. One
<strong>cannot</strong> be removed without compromising the integrity of the
function.</li>
<li>Unlike a plain
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call, this wrapper function cannot accept tuple <code dir="auto">expression</code>
arguments. For multi-element use cases, one can pass a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> whose fields contain the desired elements to
request.</li>
</ul>
<h3 class="md-heading" id="using-requestsecurity-at-lower-timeframes"><a href="#using-requestsecurity-at-lower-timeframes">Using `request.security()` at lower timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Some scripts use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
to request data from a timeframe <strong>lower</strong> than the chart’s timeframe.
This can be useful when functions specifically designed to handle
intrabars at lower timeframes are sent down the timeframe. When this
type of user-defined function requires the detection of the intrabars’
first bar, as most do, the technique will only work on historical bars.
This is due to the fact that realtime intrabars are not yet sorted. The
impact of this is that such scripts cannot reproduce in real time their
behavior on historical bars. Any logic generating alerts, for example,
will be flawed, and constant refreshing will be required to recalculate
elapsed realtime bars as historical bars.</p>
<p>When used at lower timeframes than the chart’s without specialized
functions able to distinguish between intrabars,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
will only return the value of the <strong>last</strong> intrabar in the dilation of
the chart’s bar, which is usually not useful, and will also not
reproduce in real time, so lead to repainting.</p>
<p>For all these reasons, unless you understand the subtleties of using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
at lower timeframes than the chart’s, it is best to avoid using the
function at those timeframes. Higher-quality scripts will have logic to
detect such anomalies and prevent the display of results which would be
invalid when a lower timeframe is used.</p>
<p>For more reliable lower-timeframe data requests, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>,
as explained in
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lower-timeframe-data">this</a> section of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page.</p>
<h3 class="md-heading" id="future-leak-with-requestsecurity"><a href="#future-leak-with-requestsecurity">Future leak with `request.security()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
is used with <code dir="auto">lookahead = barmerge.lookahead_on</code> to fetch prices without
offsetting the series by <code dir="auto">[1]</code>, it will return data from the future on
historical bars, which is dangerously misleading.</p>
<p>While historical bars will magically display future prices before they
should be known, no lookahead is possible in realtime because the future
there is unknown, as it should, so no future bars exist.</p>
<p>This is an example:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="850" loading="lazy" src="images/4cafc0e424379dd2fbcb49821310f635.webp" width="1762"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// FUTURE LEAK! DO NOT USE!
//@version=5
indicator("Future leak", "", true)
futureHigh = request.security(syminfo.tickerid, "1D", high, lookahead = barmerge.lookahead_on)
plot(futureHigh)</code></div>
<p>Note how the higher timeframe line is showing the timeframe’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
value before it occurs. The solution to avoid this effect is to use the
function as demonstrated in
<a href="/pine-script-docs/v5/concepts/repainting/#repainting-requestsecurity-calls">this section</a>.</p>
<p>Using lookahead to produce misleading results is not allowed in script
publications, as explained in the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lookahead">lookahead</a> section of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page. Script publications that use this misleading technique
<strong>will be moderated</strong>.</p>
<h3 class="md-heading" id="varip"><a href="#varip">`varip`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
declaration mode for variables (see our section on
<a href="/pine-script-docs/v5/language/variable-declarations/#varip">varip</a>
for more information) save information across realtime updates, which
cannot be reproduced on historical bars where only OHLC information is
available. Such scripts may be useful in realtime, including to generate
alerts, but their logic cannot be backtested, nor can their plots on
historical bars reflect calculations that will be done in realtime.</p>
<h3 class="md-heading" id="bar-state-built-ins"><a href="#bar-state-built-ins">Bar state built-ins<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts using <a href="/pine-script-docs/v5/concepts/bar-states/">bar states</a>
may or may not repaint. As we have seen in the previous section, using
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disconfirmed">barstate.isconfirmed</a>
is actually one way to <strong>avoid</strong> repainting that <strong>will</strong> reproduce on
historical bars, which are always “confirmed”. Uses of other bar
states such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>,
however, will lead to repainting. The reason is that on historical bars,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Disnew">barstate.isnew</a>
is <code dir="auto">true</code> on the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
yet in realtime, it is <code dir="auto">true</code> on the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#open">open</a>.
Using the other bar state variables will usually cause some type of
behavioral discrepancy between historical and realtime bars.</p>
<h3 class="md-heading" id="timenow"><a href="#timenow">`timenow`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>
built-in returns the current time. Scripts using this variable cannot
show consistent historical and realtime behavior, so they necessarily
repaint.</p>
<h3 class="md-heading" id="strategies"><a href="#strategies">Strategies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Strategies using <code dir="auto">calc_on_every_tick = true</code> execute on each realtime
update, while strategies run on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
of historical bars. They will most probably not generate the same order
executions, and so repaint. Note that when this happens, it also
invalidates backtesting results, as they are not representative of the
strategy’s behavior in realtime.</p>
<h2 class="md-heading" id="plotting-in-the-past"><a href="#plotting-in-the-past">Plotting in the past<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts detecting pivots after 5 bars have elapsed will often go back in
the past to plot pivot levels or values on the actual pivot, 5 bars in
the past. This will often cause unsuspecting traders looking at plots on
historical bars to infer that when the pivot happens in realtime, the
same plots will apppear on the pivot when it occurs, as opposed to when
it is detected.</p>
<p>Let’s look at a script showing the price of high pivots by placing the
price in the past, 5 bars after the pivot was detected:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting in the past", "", true)
pHi = ta.pivothigh(5, 5)
if not na(pHi)
    label.new(bar_index[5], na, str.tostring(pHi, format.mintick) + "\n🠇", yloc = yloc.abovebar, style = label.style_none, textcolor = color.black, size = size.normal)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="736" loading="lazy" src="images/a346a46c265022c40defb238c17fa44d.webp" width="1766"/></div></p>
<p>Note that:</p>
<ul>
<li>This script repaints because an elapsed realtime bar showing no
price may get a price placed on it if it is identified as a pivot, 5
bars after the actual pivot occurs.</li>
<li>The display looks great, but it can be misleading.</li>
</ul>
<p>The best solution to this problem when developing script for others is
to plot <strong>without</strong> an offset by default, but give the option for script
users to turn on plotting in the past through inputs, so they are
necessarily aware of what the script is doing, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting in the past", "", true)
plotInThePast = input(false, "Plot in the past")
pHi = ta.pivothigh(5, 5)
if not na(pHi)
    label.new(bar_index[plotInThePast ? 5 : 0], na, str.tostring(pHi, format.mintick) + "\n🠇", yloc = yloc.abovebar, style = label.style_none, textcolor = color.black, size = size.normal)</code></div>
<h2 class="md-heading" id="dataset-variations"><a href="#dataset-variations">Dataset variations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="starting-points"><a href="#starting-points">Starting points<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts begin executing on the chart’s first historical bar, and then
execute on each bar sequentially, as is explained in this manual’s page
on Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a>. If
the first bar changes, then the script will often not calculate the same
way it did when the dataset began at a different point in time.</p>
<p>The following factors have an impact on the quantity of bars you see on
your charts, and their <em>starting point</em>:</p>
<ul>
<li>The type of account you hold</li>
<li>The historical data available from the data supplier</li>
<li>The alignment requirements of the dataset, which determine its
<em>starting point</em></li>
</ul>
<p>These are the account-specific bar limits:</p>
<ul>
<li>40000 historical bars for the Ultimate plan.</li>
<li>30000 historical bars for the Elite plan.</li>
<li>25000 historical bars for the Expert plan.</li>
<li>20000 historical bars for the Premium plan.</li>
<li>10000 historical bars for Essential and Plus plans.</li>
<li>5000 historical bars for other plans.</li>
</ul>
<p>Starting points are determined using the following rules, which depend
on the chart’s timeframe:</p>
<ul>
<li><strong>Tick-based timeframes</strong>: return the exact number of bars based on the plan.</li>
<li><strong>Second-based timeframes</strong>: aligns to the beginning of a day.</li>
<li><strong>1 - 14 minutes</strong>: aligns to the beginning of a week.</li>
<li><strong>15 - 29 minutes</strong>: aligns to the beginning of a month.</li>
<li><strong>30 - 1439 minutes</strong>: aligns to the beginning of a year.</li>
<li><strong>1440 minutes and higher</strong>: aligns to the first available
historical data point.</li>
</ul>
<p>As time goes by, these factors cause your chart’s history to start at
different points in time. This often has an impact on your scripts
calculations, because changes in calculation results in early bars can
ripple through all the other bars in the dataset. Using functions like
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dvaluewhen">ta.valuewhen()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dbarssince">ta.barssince()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dema">ta.ema()</a>,
for example, will yield results that vary with early history.</p>
<h3 class="md-heading" id="revision-of-historical-data"><a href="#revision-of-historical-data">Revision of historical data<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Historical and realtime bars are built using two different data feeds
supplied by exchanges/brokers: historical data, and realtime data. When
realtime bars elapse, exchanges/brokers sometimes make what are usually
small adjustments to bar prices, which are then written to their
historical data. When the chart is refreshed or the script is
re-executed on those elapsed realtime bars, they will then be built and
calculated using the historical data, which will contain those usually
small price revisions, if any have been made.</p>
<p>Historical data may also be revised for other reasons, e.g., for stock
splits.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/plots"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Plots  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/sessions"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Sessions <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Sessions</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-sessions"><a href="#sessions">Sessions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Session information is usable in three different ways in Pine Script™:</p>
<ol>
<li><strong>Session strings</strong> containing from-to start times and day
information that can be used in functions such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a>
to detect when bars are in a particular time period, with the option
of limiting valid sessions to specific days. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsession">input.session()</a>
function provides a way to allow script users to define session
values through a script’s “Inputs” tab (see the
<a href="/pine-script-docs/v5/concepts/inputs/#session-input">Session input</a> section for more information).</li>
<li><strong>Session states</strong> built-in variables such as
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_session%7Bdot%7Dismarket">session.ismarket</a>
can identify which session a bar belongs to.</li>
<li>When fetching data with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
you can also choose to return data from <em>regular</em> sessions only or
<em>extended</em> sessions. In this case, the definition of <strong>regular and
extended sessions</strong> is that of the exchange. It is part of the
instrument’s properties — not user-defined, as in point #1. This
notion of <em>regular</em> and <em>extended</em> sessions is the same one used in
the chart’s interface, in the “Chart Settings/Symbol/Session”
field, for example.</li>
</ol>
<p>The following sections cover both methods of using session information
in Pine Script™.</p>
<p>Note that:</p>
<ul>
<li>Not all user accounts on TradingView have access to extended session
information.</li>
<li>There is no special “session” type in Pine Script™. Instead,
session strings are of “string” type but must conform to the
session string syntax.</li>
</ul>
<h2 class="md-heading" id="session-strings"><a href="#session-strings">Session strings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="session-string-specifications"><a href="#session-string-specifications">Session string specifications<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Session strings used with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a>
must have a specific format. Their syntax is:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;time_period&gt;:&lt;days&gt;</span></div></div></code></pre></figure></link></div>
<p>Where:</p>
<p>- &lt;time_period&gt; uses times in “hhmm” format, with “hh” in 24-hour format, so <code dir="auto">1700</code> for 5PM.</p>
<p>The time periods are in the “hhmm-hhmm” format, and a comma can
separate multiple time periods to specify combinations of discrete
periods.</p>
<p>For example, - &lt;days&gt; is a set of digits from 1 to 7 that specifies on which days the session is valid.</p>
<p>1 is Sunday, 7 is Saturday.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span><strong>The default days are</strong>: <code dir="auto">1234567</code>, which is different in Pine Script™
v5 than in earlier versions where <code dir="auto">23456</code> (weekdays) is used. For v5
code to reproduce the behavior from previous versions, it should
explicitly mention weekdays, as in <code dir="auto">"0930-1700:23456"</code>.</p></div></aside>
<p>These are examples of session strings:</p>
<p><code dir="auto">"24x7"</code></p>
<p class="spacer-wrapper"><spacer/>A 7-day, 24-hour session beginning at midnight.</p>
<p><code dir="auto">"0000-0000:1234567"</code></p>
<p class="spacer-wrapper"><spacer/>Equivalent to the previous example.</p>
<p><code dir="auto">"0000-0000"</code></p>
<p class="spacer-wrapper"><spacer/>Equivalent to the previous two examples because the default days are
<code dir="auto">1234567</code>.</p>
<p><code dir="auto">"0000-0000:23456"</code></p>
<p class="spacer-wrapper"><spacer/>The same as the previous example, but only Monday to Friday.</p>
<p><code dir="auto">"2000-1630:1234567"</code></p>
<p class="spacer-wrapper"><spacer/>An overnight session that begins at 20:00 and ends at 16:30 the next
day. It is valid on all days of the week.</p>
<p><code dir="auto">"0930-1700:146"</code></p>
<p class="spacer-wrapper"><spacer/>A session that begins at 9:30 and ends at 17:00 on Sundays (1),
Wednesdays (4), and Fridays (6).</p>
<p><code dir="auto">"1700-1700:23456"</code></p>
<p class="spacer-wrapper"><spacer/>An <em>overnight session</em>. The Monday session starts Sunday at 17:00
and ends Monday at 17:00. It is valid Monday through Friday.</p>
<p><code dir="auto">"1000-1001:26"</code></p>
<p class="spacer-wrapper"><spacer/>A weird session that lasts only one minute on Mondays (2) and
Fridays (6).</p>
<p><code dir="auto">"0900-1600,1700-2000"</code></p>
<p class="spacer-wrapper"><spacer/>A session that begins at 9:00, breaks from 16:00 to 17:00, and
continues until 20:00. Applies to every day of the week.</p>
<h3 class="md-heading" id="using-session-strings"><a href="#using-session-strings">Using session strings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Session properties defined with session strings are independent of the
exchange-defined sessions determining when an instrument can be traded.
Programmers have complete liberty in creating whatever session
definitions suit their purpose, which is usually to detect when bars
belong to specific time periods. This is accomplished in Pine Script™ by
using one of the following two signatures of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
function:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">time(timeframe, session, timezone) → series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">time(timeframe, session) → series int</span></div></div></code></pre></figure></div>
<p>Here, we use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
with a <code dir="auto">session</code> argument to display the market’s opening
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
values on an intraday chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="626" loading="lazy" src="images/94b1e69e0b630f3289c64d05b07bd118.webp" width="1748"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Opening high/low", overlay = true)

sessionInput = input.session("0930-0935")

sessionBegins(sess) =&gt;
    t = time("", sess)
    timeframe.isintraday and (not barstate.isfirst) and na(t[1]) and not na(t)

var float hi = na
var float lo = na
if sessionBegins(sessionInput)
    hi := high
    lo := low

plot(lo, "lo", color.fuchsia, 2, plot.style_circles)
plot(hi, "hi", color.lime,    2, plot.style_circles)</code></div>
<p>Note that:</p>
<ul>
<li>We use a session input to allow users to specify the time they want
to detect. We are only looking for the session’s beginning time on
bars, so we use a five-minute gap between the beginning and end time
of our <code dir="auto">"0930-0935"</code> default value.</li>
<li>We create a <code dir="auto">sessionBegins()</code> function to detect the beginning of a
session. Its <code dir="auto">time("", sess)</code> call uses an empty string for the
function’s <code dir="auto">timeframe</code> parameter, which means it uses the chart’s
timeframe, whatever that is. The function returns <code dir="auto">true</code> when:
<ul>
<li>The chart uses an intraday timeframe (seconds or minutes).</li>
<li>The script isn’t on the chart’s first bar, which we ensure with
<code dir="auto">(not barstate.isfirst)</code>. This check prevents the code from always
detecting a session beginning on the first bar because
<code dir="auto">na(t[1]) and not na(t)</code> is always <code dir="auto">true</code> there.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
call has returned <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
on the previous bar because it wasn’t in the session’s time
period, and it has returned a value that is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
on the current bar, which means the bar is <strong>in</strong> the session’s
time period.</li>
</ul>
</li>
</ul>
<h2 class="md-heading" id="session-states"><a href="#session-states">Session states<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Three built-in variables allow you to distinguish the type of session
the current bar belongs to. They are only helpful on intraday
timeframes:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_session%7Bdot%7Dismarket">session.ismarket</a>
returns <code dir="auto">true</code> when the bar belongs to regular trading hours.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_session%7Bdot%7Dispremarket">session.ispremarket</a>
returns <code dir="auto">true</code> when the bar belongs to the extended session
preceding regular trading hours.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_session%7Bdot%7Dispostmarket">session.ispostmarket</a>
returns <code dir="auto">true</code> when the bar belongs to the extended session
following regular trading hours.</li>
</ul>
<h2 class="md-heading" id="using-sessions-with-requestsecurity"><a href="#using-sessions-with-requestsecurity">Using sessions with `request.security()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When your TradingView account provides access to extended sessions, you
can choose to see their bars with the “Settings/Symbol/Session” field.
There are two types of sessions:</p>
<ul>
<li><strong>regular</strong> (which does not include pre- and post-market data), and</li>
<li><strong>extended</strong> (which includes pre- and post-market data).</li>
</ul>
<p>Scripts using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
function to access data can return extended session data or not. This is
an example where only regular session data is fetched:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="630" loading="lazy" src="images/d5c63cc20ebdeed5634c58c5909ef182.webp" width="1750"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 1: Regular Session Data")
regularSessionData = request.security("NASDAQ:AAPL", timeframe.period, close, barmerge.gaps_on)
plot(regularSessionData, style = plot.style_linebr)</code></div>
<p>If you want the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
call to return extended session data, you must first use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>
function to build the first argument of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="626" loading="lazy" src="images/b0004b4d33b458717aaf1be5002695a8.webp" width="1750"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 2: Extended Session Data")
t = ticker.new("NASDAQ", "AAPL", session.extended)
extendedSessionData = request.security(t, timeframe.period, close, barmerge.gaps_on)
plot(extendedSessionData, style = plot.style_linebr)</code></div>
<p>Note that the previous chart’s gaps in the script’s plot are now
filled. Also, keep in mind that our example scripts do not produce the
background coloring on the chart; it is due to the chart’s settings
showing extended hours.</p>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>
function has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">ticker.new(prefix, ticker, session, adjustment) → simple string</span></div></div></code></pre></figure></div>
<p>Where:</p>
<ul>
<li><code dir="auto">prefix</code> is the exchange prefix, e.g., <code dir="auto">"NASDAQ"</code></li>
<li><code dir="auto">ticker</code> is a symbol name, e.g., <code dir="auto">"AAPL"</code></li>
<li><code dir="auto">session</code> can be <code dir="auto">session.extended</code> or <code dir="auto">session.regular</code>. Note that
this is <strong>not</strong> a session string.</li>
<li><code dir="auto">adjustment</code> adjusts prices using different criteria:
<code dir="auto">adjustment.none</code>, <code dir="auto">adjustment.splits</code>, <code dir="auto">adjustment.dividends</code>.</li>
</ul>
<p>Our first example could be rewritten as:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 1: Regular Session Data")
t = ticker.new("NASDAQ", "AAPL", session.regular)
regularSessionData = request.security(t, timeframe.period, close, barmerge.gaps_on)
plot(regularSessionData, style = plot.style_linebr)</code></div>
<p>If you want to use the same session specifications used for the chart’s
main symbol, omit the third argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker%7Bdot%7Dnew">ticker.new()</a>;
it is optional. If you want your code to declare your intention
explicitly, use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dsession">syminfo.session</a>
built-in variable. It holds the session type of the chart’s main
symbol:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example 1: Regular Session Data")
t = ticker.new("NASDAQ", "AAPL", syminfo.session)
regularSessionData = request.security(t, timeframe.period, close, barmerge.gaps_on)
plot(regularSessionData, style = plot.style_linebr)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/repainting"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Repainting  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/strategies"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Strategies <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Strategies</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-strategies"><a href="#strategies">Strategies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ Strategies are specialized scripts that simulate trades across historical and realtime bars, allowing users to backtest and forward test their trading systems. Strategy scripts have many of the same capabilities as <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator</a> scripts, and they provide the ability to place, modify, and cancel hypothetical orders and analyze performance results.</p>
<p>When a script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function as its declaration statement, it gains access to the <code dir="auto">strategy.*</code> namespace, which features numerous functions and variables for simulating orders and retrieving essential strategy information. It also displays relevant information and simulated performance results in the dedicated <a href="/pine-script-docs/v5/concepts/strategies/#strategy-tester">Strategy Tester</a> tab.</p>
<h2 class="md-heading" id="a-simple-strategy-example"><a href="#a-simple-strategy-example">A simple strategy example<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The following script is a simple strategy that simulates entering a long or short position when two moving averages cross. When the <code dir="auto">fastMA</code> crosses above the <code dir="auto">slowMA</code>, it places a “buy” market order to enter a long position. When the <code dir="auto">fastMA</code> crosses below the <code dir="auto">slowMA</code>, it places a “sell” market order to enter a short position:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Simple strategy demo", overlay = true, margin_long = 100, margin_short = 100)

//@variable The length of the `fastMA` and half the length of the `slowMA`.
int lengthInput = input.int(14, "Base length", 2)

// Calculate two moving averages with different lengths.
float fastMA = ta.sma(close, lengthInput)
float slowMA = ta.sma(close, lengthInput * 2)

// Place an order to enter a long position when `fastMA` crosses over `slowMA`.
if ta.crossover(fastMA, slowMA)
    strategy.entry("buy", strategy.long)

// Place an order to enter a short position when `fastMA` crosses under `slowMA`.
if ta.crossunder(fastMA, slowMA)
    strategy.entry("sell", strategy.short)

// Plot the moving averages.
plot(fastMA, "Fast MA", color.aqua)
plot(slowMA, "Slow MA", color.orange)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function call declares that the script is a strategy named “Simple strategy demo” that displays visuals on the main chart pane.</li>
<li>The <code dir="auto">margin_long</code> and <code dir="auto">margin_short</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> call specify that the strategy must have 100% of a long or short trade’s amount available to allow the trade. See <a href="/pine-script-docs/v5/concepts/strategies/#margin">this section</a> for more information.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> function is the command that the script uses to create entry orders and reverse positions. The “buy” entry order closes any short position and opens a new long position. The “sell” entry order closes any long position and opens a new short position.</li>
</ul>
<h2 class="md-heading" id="applying-a-strategy-to-a-chart"><a href="#applying-a-strategy-to-a-chart">Applying a strategy to a chart<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To test a strategy, add it to the chart. Select a built-in or published strategy from the “Indicators, Metrics &amp; Strategies” menu, or write a custom strategy in the Pine Editor and click the “Add to chart” option in the top-right corner:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="356" loading="lazy" src="images/9da819acee5d25445d3b9aaa28ac9b59.webp" width="1052"/></div></p>
<p>The script plots trade markers on the main chart pane and displays simulated performance results inside the <a href="/pine-script-docs/v5/concepts/strategies/#strategy-tester">Strategy Tester</a> tab:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="764" loading="lazy" src="images/b4980afcd32e683fff0155e3c976f09f.webp" width="1336"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span></p><p>The performance results from a strategy applied to <em>non-standard charts</em> (<a href="https://www.tradingview.com/support/solutions/43000619436">Heikin Ashi</a>, <a href="https://www.tradingview.com/support/solutions/43000502284">Renko</a>, <a href="https://www.tradingview.com/support/solutions/43000502273">Line Break</a>, <a href="https://www.tradingview.com/support/solutions/43000502272">Kagi</a>, <a href="https://www.tradingview.com/support/solutions/43000502276">Point &amp; Figure</a>, and <a href="https://www.tradingview.com/support/solutions/43000474007">Range</a>) <strong>do not</strong> reflect actual market conditions by default. The strategy uses the chart’s <strong>synthetic</strong> prices in its simulation, which do not typically represent real-world market prices, leading to unrealistic strategy results.</p><p>Therefore, we strongly recommend using <strong>standard</strong> chart types when testing strategies. Alternatively, on Heikin Ashi charts, users can simulate order fills using actual prices by enabling the <em>“Fill orders on standard OHLC”</em> option in the strategy’s <a href="https://www.tradingview.com/support/solutions/43000628599">properties</a> or including <code dir="auto">fill_orders_on_standard_ohlc = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement.</p><p></p></div></aside>
<h2 class="md-heading" id="strategy-tester"><a href="#strategy-tester">Strategy Tester<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <em>Strategy Tester</em> visualizes the hypothetical performance of a strategy script and displays its properties. To use it, add a script declared with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function to the chart, then open the “Strategy Tester” tab. If two or more strategies are on the chart, specify which one to analyze by selecting its name in the top-left corner.</p>
<p>After the selected script executes across the chart’s data, the Strategy Tester populates the following four tabs with relevant strategy information:</p>
<ul>
<li><a href="/pine-script-docs/v5/concepts/strategies/#overview">Overview</a></li>
<li><a href="/pine-script-docs/v5/concepts/strategies/#performance-summary">Performance Summary</a></li>
<li><a href="/pine-script-docs/v5/concepts/strategies/#list-of-trades">List of Trades</a></li>
<li><a href="/pine-script-docs/v5/concepts/strategies/#properties">Properties</a></li>
</ul>
<h3 class="md-heading" id="overview"><a href="#overview">Overview<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/support/solutions/43000681733">Overview</a> tab provides a quick look into a strategy’s performance over a sequence of simulated trades. This tab displays essential performance metrics and a chart with three helpful plots:</p>
<ul>
<li>The <a href="https://www.tradingview.com/support/solutions/43000681735">Equity</a> baseline plot visualizes the strategy’s simulated equity across closed trades.</li>
<li>The <a href="https://www.tradingview.com/support/solutions/43000681734">Drawdown</a> column plot shows how far the strategy’s equity fell below its peak across trades.</li>
<li>The <a href="https://www.tradingview.com/support/solutions/43000681736">Buy &amp; hold equity</a> plot shows the equity growth of a strategy that enters a single long position and holds that position throughout the testing range.</li>
</ul>
<p><div class="image-container"><img alt="image" decoding="async" height="760" loading="lazy" src="images/078a2a53d7e666a94cd4cae90c3c2b7f.webp" width="1336"/></div></p>
<p>Note that:</p>
<ul>
<li>The chart has two separate vertical scales. The “Equity” and “Buy &amp; hold equity” plots use the scale on the left, and the “Drawdown” plot uses the scale on the right. Users can toggle the plots and choose between absolute or percentage scales using the options at the bottom.</li>
<li>When a user clicks on a point in this chart, the main chart scrolls to the corresponding bar where the trade closed and displays a tooltip containing the closing time.</li>
</ul>
<h3 class="md-heading" id="performance-summary"><a href="#performance-summary">Performance Summary<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/support/solutions/43000681683">Performance Summary</a> tab presents an in-depth summary of a strategy’s key performance metrics, organized into separate columns. The “All” column shows performance information for all simulated trades, and the “Long” and “Short” columns show relevant metrics separately for long and short trades. This view provides more detailed insights into a strategy’s overall and directional trading performance:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="768" loading="lazy" src="images/2523b7971c695c36146132451775290a.webp" width="1336"/></div></p>
<h3 class="md-heading" id="list-of-trades"><a href="#list-of-trades">List of Trades<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/support/solutions/43000681737">List of Trades</a> tab chronologically lists a strategy’s simulated trades. Each item in the list displays vital information about a trade, including the dates and times of entry and exit orders, the names of the orders, the order prices, and the number of contracts/shares/lots/units. In addition, each item shows the trade’s profit or loss and the strategy’s cumulative profit, run-up, and drawdown:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="764" loading="lazy" src="images/c730b91c5ef2fa301e1deffc1d022c95.webp" width="1336"/></div></p>
<p>Note that:</p>
<ul>
<li>Hovering the mouse over a list item’s entry or exit information reveals a “Scroll to bar” button. Clicking that button navigates the main chart to the bar where the entry or exit occurred.</li>
<li>The list shows each trade in <em>descending</em> order by default, with the latest trade at the top. Users can reverse this order by clicking the “Trade #” button above the list.</li>
</ul>
<h3 class="md-heading" id="properties"><a href="#properties">Properties<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The “Properties” tab provides detailed information about a strategy’s configuration and the dataset that it executes across, organized into four collapsible sections:</p>
<ul>
<li>The “Date Range” section shows the range of dates that had simulated trades, and the overall available backtesting range.</li>
<li>The “Symbol Info” section displays the chart’s symbol, timeframe, type, point value, currency, and tick size. It also includes the chart’s specified precision setting.</li>
<li>The “Strategy Inputs” section lists the names and values of all the inputs available in the strategy’s “Settings/Inputs” tab. This section only appears if the script includes <code dir="auto">input*()</code> calls or specifies a nonzero <code dir="auto">calc_bars_count</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement.</li>
<li>The “Strategy Properties” section provides an overview of the strategy’s <a href="https://www.tradingview.com/support/solutions/43000628599-strategy-properties/">properties</a>, including the initial capital, account currency, order size, margin, pyramiding, commission, slippage, and other settings.</li>
</ul>
<p><div class="image-container"><img alt="image" decoding="async" height="340" loading="lazy" src="images/f4c7fc7b011c74a87504b7023b160fd2.webp" width="1336"/></div></p>
<h2 class="md-heading" id="broker-emulator"><a href="#broker-emulator">Broker emulator<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView uses a <em>broker emulator</em> to simulate trades while running a strategy script. Unlike in real-world trading, the emulator fills a strategy’s orders exclusively using available <em>chart data</em> by default. Consequently, it executes orders on historical bars <em>after a bar closes</em>. Similarly, the earliest point that it can fill orders on realtime bars is after a new price tick. For more information about this behavior, see the <a href="/pine-script-docs/v5/language/execution-model/">Execution model</a> page.</p>
<p>Because the broker emulator only uses price data from the chart by default, it makes <em>assumptions</em> about intrabar price movement when filling orders. The emulator analyzes the opening, high, low, and closing prices of chart bars to infer intrabar activity using the following logic:</p>
<ul>
<li>If the opening price of a bar is closer to the high than the low, the emulator assumes that the market price moved in this order: <strong>open → high → low → close</strong>.</li>
<li>If the opening price of a bar is closer to the low than the high, the emulator assumes that the market price moved in this order: <strong>open → low → high → close</strong>.</li>
<li>The emulator assumes <em>no gaps</em> exist between intrabars inside each chart bar, meaning it considers <em>any</em> value within a bar’s high-low range as a valid price for order execution.</li>
<li>When filling <em>price-based orders</em> (all orders except <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a>), the emulator assumes intrabars <strong>do not</strong> exist within the gap between the previous bar’s close and the current bar’s open. If the market price crosses an order’s price during the gap between two bars, the emulator fills the order at the current bar’s <em>open</em> and not at the specified price.</li>
</ul>
<p><div class="image-container"><img alt="image" decoding="async" height="528" loading="lazy" src="images/f58ca46c50c5932f722e08de6040e7a8.webp" width="1306"/></div></p>
<h3 class="md-heading" id="bar-magnifier"><a href="#bar-magnifier">Bar magnifier<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users with Premium and higher-tier <a href="https://www.tradingview.com/pricing/">plans</a> can override the broker emulator’s default assumptions about intrabar prices by enabling the <a href="https://www.tradingview.com/support/solutions/43000669285">Bar Magnifier</a> backtesting mode. In this mode, the emulator uses data from <em>lower timeframes</em> to obtain more granular information about price action within bars, allowing more precise order fills in the strategy’s simulation.</p>
<p>To enable the <a href="https://www.tradingview.com/support/solutions/43000669285">Bar Magnifier</a> mode, include <code dir="auto">use_bar_magnifier = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, or select the “Using bar magnifier” option in the “Fill orders” section of the strategy’s “Settings/Properties” tab.</p>
<p>The following example script illustrates how the Bar Magnifier can enhance order-fill behavior. When the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value crosses the defined <code dir="auto">orderTime</code>, it creates “Buy” and “Exit” <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit orders</a> at the calculated <code dir="auto">entryPrice</code> and <code dir="auto">exitPrice</code>. For visual reference, the script colors the background orange when it places the orders, and it draws two horizontal <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> at the order prices:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="690" loading="lazy" src="images/cfc0e2aee737019f6556e80deb21c489.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Bar Magnifier Demo", overlay = true, use_bar_magnifier = false)

//@variable The UNIX timestamp to place the order at.
int orderTime = timestamp("UTC", 2023, 3, 22, 18)

//@variable Is `color.orange` when `time` crosses the `orderTime`, false otherwise.
color orderColor = na

// Entry and exit prices.
float entryPrice = hl2 - (high - low)
float exitPrice  = entryPrice + (high - low) * 0.25

// Entry and exit lines.
var line entryLine = na
var line exitLine  = na

if ta.cross(time, orderTime)
    // Draw new entry and exit lines.
    entryLine := line.new(bar_index, entryPrice, bar_index + 1, entryPrice, color = color.green, width = 2)
    exitLine  := line.new(bar_index, exitPrice, bar_index + 1, exitPrice, color = color.red, width = 2)

    // Update order highlight color.
    orderColor := color.new(color.orange, 80)

    // Place limit orders at the `entryPrice` and `exitPrice`.
    strategy.entry("Buy", strategy.long, limit = entryPrice)
    strategy.exit("Exit", "Buy", limit = exitPrice)

// Update lines while the position is open.
else if strategy.position_size &gt; 0.0
    entryLine.set_x2(bar_index + 1)
    exitLine.set_x2(bar_index + 1)

bgcolor(orderColor)</code></div>
<p>Because the script does not include a <code dir="auto">use_bar_magnifier</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function, the broker emulator uses the default <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">assumptions</a> when filling the orders: that the bar’s price moved from open to high, high to low, and then low to close. Therefore, after filling the “Buy” order at the price indicated by the green line, the broker emulator inferred that the market price did not go back up to touch the red line and trigger the “Exit” order. In other words, the strategy <em>could not</em> enter and exit the position on the same bar according to the broker emulator’s assumptions.</p>
<p>After we enable the <a href="https://www.tradingview.com/support/solutions/43000669285">Bar Magnifier</a> mode, the broker emulator can access <em>10-minute</em> data on the 60-minute chart instead of relying on its assumptions about hourly bars. On this timeframe, the market price <em>did</em> move back up to the “Exit” order’s price after reaching the “Buy” order’s price in the same hour. Therefore, with the Bar Magnifier enabled in this scenario, both orders execute on the same hourly bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="688" loading="lazy" src="images/e08c1ee6a43d31b87046caad8f94dc86.webp" width="1342"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Scripts can request a maximum of 200,000 bars from a lower timeframe. Due to this limitation, some symbols with lengthier history might <em>not</em> have intrabar coverage for their initial chart bars. Enabling the Bar Magnifier mode <strong>does not</strong> affect the trades on chart bars that do not have available intrabar data.</p></div></aside>
<h2 class="md-heading" id="orders-and-trades"><a href="#orders-and-trades">Orders and trades<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ strategies use orders to make trades and manage positions, similar to real-world trading. In this context, an <em>order</em> is an instruction that a strategy sends to the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> to perform a market action, and a <em>trade</em> is the resulting transaction after the emulator fills an order.</p>
<p>Let’s take a closer look at how strategy orders work and how they become trades. Every 20 bars, the following script creates a long <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> and draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>. It calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> on each bar from the global scope to generate a market order to close any open position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="678" loading="lazy" src="images/d1d3d2b63571e20fbee07576191f044f.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Order execution demo", "My strategy", true, margin_long = 100, margin_short = 100)

//@function Displays the specified `txt` in a label at the `high` of the current bar. 
debugLabel(string txt) =&gt; 
    label.new(
         bar_index, high, text = txt, color=color.lime, style = label.style_label_lower_right, 
         textcolor = color.black, size = size.large
     )

//@variable Is `true` on every 20th bar, `false` otherwise.
bool longCondition = bar_index % 20 == 0

// Draw a label and place a long market order when `longCondition` occurs.
if longCondition
    debugLabel("Long entry order created")
    strategy.entry("My Long Entry Id", strategy.long)

// Place a closing market order whenever there is an open position.
strategy.close_all()</code></div>
<p>Note that:</p>
<ul>
<li>Although the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> on every bar, the function only creates a new exit order when the strategy has an <em>open position</em>. If there is no open position, the function call has no effect.</li>
</ul>
<p>The blue arrows on the above chart show where the strategy entered a long position, and the purple arrows mark the bars where the strategy closed the position. Notice that the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> drawings appear one bar <em>before</em> the entry markers, and the entry markers appear one bar <em>before</em> the closing markers. This sequence illustrates order creation and execution in action.</p>
<p>By default, the earliest point the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills an order is on the next available price tick, because creating and filling an order on the same tick is unrealistic. Since strategies recalculate after each bar closes by default, the next available tick where the emulator fills a generated order is at the <em>open</em> of the <em>following bar</em>. For example, when the <code dir="auto">longCondition</code> occurs on bar 20, the script places an entry order to fill on the next tick, which is at the open of bar 21. When the strategy recalculates its values after bar 21 closes, it places an order to close the current position on the next tick, which is at the open of bar 22.</p>
<h2 class="md-heading" id="order-types"><a href="#order-types">Order types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ strategies can simulate different order types to suit specific trading system needs. The main notable order types include <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market</a>, <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit</a>, <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop</a>, and <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop-limit</a>.</p>
<h3 class="md-heading" id="market-orders"><a href="#market-orders">Market orders<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A <em>market order</em> is the simplest type of order, which most <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement commands</a> generate by default. A market order is an instruction to buy or sell a security as soon as possible, irrespective of the price. As such, the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> always executes a market order on the next available tick.</p>
<p>The example below alternates between placing a long and short market order once every <code dir="auto">lengthInput</code> bars. When the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a> is divisible by <code dir="auto">2 * lengthInput</code>, the strategy generates a long market order. Otherwise, it places a short market order when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a> is divisible by the <code dir="auto">lengthInput</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/c531b8f7a0c65f906dd39c7fc9cd3371.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Market order demo", overlay = true, margin_long = 100, margin_short = 100)

//@variable Number of bars between long and short entries.
int lengthInput = input.int(10, "Cycle length", 1)

//@function Displays the specified `txt` in a label on the current bar.
debugLabel(string txt, color lblColor) =&gt; label.new(
     bar_index, high, text = txt, color = lblColor, textcolor = color.white, 
     style = label.style_label_lower_right, size = size.large
 )

//@variable Is `true` every `2 * lengthInput` bars, `false` otherwise.
longCondition = bar_index % (2 * lengthInput) == 0
//@variable Is `true` every `lengthInput` bars, `false` otherwise.
shortCondition = bar_index % lengthInput == 0

// Generate a long market order with a `color.green` label on `longCondition`.
if longCondition
    debugLabel("Long market order created", color.green)
    strategy.entry("My Long Entry Id", strategy.long)
// Otherwise, generate a short market order with a `color.red` label on `shortCondition`.
else if shortCondition
    debugLabel("Short market order created", color.red)
    strategy.entry("My Short Entry Id", strategy.short)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> indicate the bars where the script generates the market orders. The broker emulator fills each order at the open of the following bar.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command can automatically <em>reverse</em> an open position in the opposite direction. See <a href="/pine-script-docs/v5/concepts/strategies/#reversing-positions">this section</a> below for more information.</li>
</ul>
<h3 class="md-heading" id="limit-orders"><a href="#limit-orders">Limit orders<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A <em>limit order</em> is an instruction to buy or sell a security at a specific price or better (lower than specified for long orders, and higher than specified for short orders), irrespective of the time. To simulate a limit order in a strategy script, pass a <em>price</em> value to the <code dir="auto">limit</code> parameter of an applicable <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement command</a>.</p>
<p>When the market price reaches a limit order’s value, or crosses it in the favorable direction, the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills the order at that value or a better price. When a strategy generates a limit order at a <em>worse</em> value than the current market price (higher for long orders and lower for short orders), the emulator fills the order without waiting for the market price to reach that value.</p>
<p>For example, the following script generates a long limit order 800 ticks below the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> of the bar 100 bars before the last chart bar using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command. It draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> to signify the bar where the strategy created the order and a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> to visualize the order’s price:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/a8b3b30a8634e3ea96466fdb072286cf.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Limit order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` and a horizontal line at `price` when called.
debugLabel(float price, string txt) =&gt;
    label.new(
         bar_index, price, text = txt, color = color.teal, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    line.new(
         bar_index, price, bar_index + 1, price, color = color.teal, extend = extend.right, 
         style = line.style_dashed
     )

// Generate a long limit order with a label and line 100 bars before the `last_bar_index`.
if last_bar_index - bar_index == 100
    limitPrice = close - syminfo.mintick * 800
    debugLabel(limitPrice, "Long Limit order created")
    strategy.entry("Long", strategy.long, limit = limitPrice)</code></div>
<p>Notice that in the chart above, the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> and the start of the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> occurred several bars before the “Long” entry marker. The <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> could not fill the order while the market price remained <em>above</em> the <code dir="auto">limitPrice</code> because such a price is a <em>worse</em> value for the long trade. After the price fell and reached the <code dir="auto">limitPrice</code>, the emulator filled the order mid-bar at that value.</p>
<p>If we set the <code dir="auto">limitPrice</code> to a value <em>above</em> the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> rather than <em>below</em>, the broker emulator fills the order at the open of the following bar because the closing price is already a more <em>favorable</em> value for the long trade. Here, we set the <code dir="auto">limitPrice</code> in the script to 800 ticks above the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> to demonstrate this effect:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/17fd21b21e9af5a9a4066e35dc525bbc.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Limit order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` and a horizontal line at `price` when called.
debugLabel(float price, string txt) =&gt;
    label.new(
         bar_index, price, text = txt, color = color.teal, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    line.new(
         bar_index, price, bar_index + 1, price, color = color.teal, extend = extend.right, 
         style = line.style_dashed
     )

// Generate a long limit order with a label and line 100 bars before the `last_bar_index`.
if last_bar_index - bar_index == 100
    limitPrice = close + syminfo.mintick * 800
    debugLabel(limitPrice, "Long Limit order created")
    strategy.entry("Long", strategy.long, limit = limitPrice)</code></div>
<h3 class="md-heading" id="stop-and-stop-limit-orders"><a href="#stop-and-stop-limit-orders">Stop and stop-limit orders<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A <em>stop order</em> is an instruction to activate a new <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market</a> or <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit</a> order when the market price reaches a specific price or a worse value (higher than specified for long orders and lower than specified for short orders). To simulate a stop order, pass a price value to the <code dir="auto">stop</code> parameter of an applicable <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement command</a>.</p>
<p>When a strategy generates a stop order at a <em>better</em> value than the current market price, it activates the subsequent order without waiting for the market price to reach that value.</p>
<p>The following example calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place a stop order 800 ticks above the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> 100 bars before the last historical chart bar. It also draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> on the bar where it created the order and a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> to display the stop price. As we see in the chart below, the strategy entered a long position immediately after the price crossed the stop level:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/42136829b5240ee7d546ec53b0fc79ac.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Stop order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` when called and shows the `price` level on the chart.
debugLabel(price, txt) =&gt;
    label.new(
         bar_index, high, text = txt, color = color.teal, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    line.new(bar_index, high, bar_index, price, style = line.style_dotted, color = color.teal)
    line.new(
         bar_index, price, bar_index + 1, price, color = color.teal, extend = extend.right, 
         style = line.style_dashed
     )

// Generate a long stop order with a label and lines 100 bars before the last bar.
if last_bar_index - bar_index == 100
    stopPrice = close + syminfo.mintick * 800
    debugLabel(stopPrice, "Long Stop order created")
    strategy.entry("Long", strategy.long, stop = stopPrice)</code></div>
<p>Note that:</p>
<ul>
<li>A basic stop order is essentially the opposite of a <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit order</a> in terms of its execution based on the market price. If we use a limit order instead of a stop order in this scenario, the order executes immediately on the next bar. See the <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">previous section</a> for an example.</li>
</ul>
<p>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> call includes a <code dir="auto">stop</code> <em>and</em> <code dir="auto">limit</code> argument, it creates a <em>stop-limit order</em>. Unlike a basic stop order, which triggers a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> when the current price is at the <code dir="auto">stop</code> level or a worse value, a stop-limit order creates a subsequent <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit order</a> to fill at the specified <code dir="auto">limit</code> price.</p>
<p>Below, we modified the previous script to simulate and visualize a stop-limit order. This script version includes the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> as the <code dir="auto">limit</code> price in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command. It also includes additional drawings to show where the strategy activated the subsequent limit order and to visualize the limit price.</p>
<p>In this example chart, notice how the market price reached the limit level on the next bar after the stop-limit order was created, but the strategy did not enter a position because the limit order was not yet active. After price later reached the stop level, the strategy placed the limit order, and then the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> filled it after the market price dropped back down to the limit level:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/e3a86d648826d8a5c569a4d33593f3c2.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Stop-Limit order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` when called and shows the `price` level on the chart.
debugLabel(price, txt, lblColor, lineWidth = 1) =&gt;
    label.new(
         bar_index, high, text = txt, color = lblColor, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    line.new(bar_index, close, bar_index, price, style = line.style_dotted, color = lblColor, width = lineWidth)
    line.new(
         bar_index, price, bar_index + 1, price, color = lblColor, extend = extend.right, 
         style = line.style_dashed, width = lineWidth
     )

var float stopPrice  = na
var float limitPrice = na

// Generate a long stop-limit order with a label and lines 100 bars before the last bar.
if last_bar_index - bar_index == 100
    stopPrice  := close + syminfo.mintick * 800
    limitPrice := low
    debugLabel(limitPrice, "", color.gray)
    debugLabel(stopPrice, "Long Stop-Limit order created", color.teal)
    strategy.entry("Long", strategy.long, stop = stopPrice, limit = limitPrice)

// Draw a line and label when the strategy activates the limit order.
if high &gt;= stopPrice
    debugLabel(limitPrice, "Limit order activated", color.green, 2)
    stopPrice := na</code></div>
<h2 class="md-heading" id="order-placement-and-cancellation"><a href="#order-placement-and-cancellation">Order placement and cancellation<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">strategy.*</code> namespace features the following five functions that simulate the placement of orders, known as <em>order placement commands</em>: <a href="/pine-script-docs/v5/concepts/strategies/#strategyentry">strategy.entry()</a>, <a href="/pine-script-docs/v5/concepts/strategies/#strategyorder">strategy.order()</a>, <a href="/pine-script-docs/v5/concepts/strategies/#strategyexit">strategy.exit()</a>, <a href="/pine-script-docs/v5/concepts/strategies/#strategyclose-and-strategyclose_all">strategy.close()</a>, and <a href="/pine-script-docs/v5/concepts/strategies/#strategyclose-and-strategyclose_all">strategy.close_all()</a>.</p>
<p>Additionally, the namespace includes the following two functions that cancel pending orders, known as <em>order cancellation commands</em>: <a href="/pine-script-docs/v5/concepts/strategies/#strategycancel-and-strategycancel_all">strategy.cancel()</a> and <a href="/pine-script-docs/v5/concepts/strategies/#strategycancel-and-strategycancel_all">strategy.cancel_all()</a>.</p>
<p>The segments below explain these commands, their unique characteristics, and how to use them.</p>
<h3 class="md-heading" id="strategyentry"><a href="#strategyentry">`strategy.entry()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command generates <em>entry orders</em>. Its unique features help simplify opening and managing positions. This order placement command generates <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a> by default. It can also create <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit</a>, <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop</a>, and <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop-limit</a> orders with the <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters, as explained in the <a href="/pine-script-docs/v5/concepts/strategies/#order-types">Order types</a> section above.</p>
<h4 class="md-heading" id="reversing-positions"><a href="#reversing-positions">Reversing positions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>One of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command’s unique features is its ability to <em>reverse</em> an open position automatically. By default, when an order from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> executes while there is an open position in the opposite direction, the command automatically <em>adds</em> the position’s size to the new order’s size. The added quantity allows the order to close the current position and open a new position for the specified number of contracts/lots/shares/units in the new direction.</p>
<p>For instance, if a strategy has an open position of 15 shares in the <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.long">strategy.long</a> direction and calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place a new <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.short">strategy.short</a> direction, the size of the resulting transaction is the specified entry size <strong>plus</strong> 15 shares.</p>
<p>The example below demonstrates this behavior in action. When the <code dir="auto">buyCondition</code> occurs once every 100 bars, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> with <code dir="auto">qty = 15</code> to open a long position of 15 shares. Otherwise, when the <code dir="auto">sellCondition</code> occurs on every 50th bar, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> with <code dir="auto">qty = 5</code> to enter a new short position of five shares. The script also highlights the chart’s background on the bars where the <code dir="auto">buyCondition</code> and <code dir="auto">sellCondition</code> occurs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="548" loading="lazy" src="images/ae56b5061cfec5d7f3a69546df6b79c7.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Reversing positions demo", overlay = true)

//@variable Is `true` on every 100th bar, `false` otherwise.
bool buyCondition = bar_index % 100 == 0
//@variable Is `true` on every 50th bar, `false` otherwise.
bool sellCondition = bar_index % 50 == 0
 
if buyCondition
    // Place a "buy" market order to close the short position and enter a long position of 15 shares.
    strategy.entry("buy", strategy.long, qty = 15)
else if sellCondition
    // Place a "sell" market order to close the long position and enter a short position of 5 shares.
    strategy.entry("sell", strategy.short, qty = 5)

// Highlight the background when the `buyCondition` or `sellCondition` occurs.
bgcolor(buyCondition  ? color.new(color.blue, 90) : sellCondition ? color.new(color.red, 90) : na)</code></div>
<p>The trade markers on the chart show the <em>transaction size</em>, not the size of the resulting position. The markers above show that the transaction size was <em>20 shares</em> on each order fill rather than 15 for long orders and five for short orders. Since <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> reverses a position in the opposite direction by default, each call <em>adds</em> the open position’s size (e.g., 15 for long entries) to the new order’s size (e.g., 5 for short entries), resulting in a quantity of 20 shares on each entry after the first. Although each of these <em>transactions</em> is 20 shares in size, the resulting positions are 5 shares for each short entry and 15 for each long entry.</p>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.risk.allow_entry_in">strategy.risk.allow_entry_in()</a> function <em>overrides</em> the allowed direction for the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command. When a script specifies a trade direction with this <a href="/pine-script-docs/v5/concepts/strategies/#risk-management">risk management</a> command, orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> in the opposite direction <em>close</em> the open position without allowing a reversal.</li>
</ul>
<h4 class="md-heading" id="pyramiding"><a href="#pyramiding">Pyramiding<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Another unique characteristic of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command is its connection to a strategy’s <em>pyramiding</em> property. Pyramiding specifies the maximum number of <em>successive entries</em> a strategy allows in the same direction. Users can set this property by including a <code dir="auto">pyramiding</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement or by adjusting the “Pyramiding” input in the script’s “Settings/Properties” tab. The default value is 1, meaning the strategy can open new positions but cannot add to them using orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls.</p>
<p>The following example uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> when the <code dir="auto">entryCondition</code> occurs on every 25th bar. The direction of the orders changes once every 100 bars, meaning every 100-bar cycle includes <em>four</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls with the same direction. For visual reference of the conditions, the script highlights the chart’s background based on the current direction each time the <code dir="auto">entryCondition</code> occurs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="546" loading="lazy" src="images/1a5df42b44a2681dbb261ed974bd1ec2.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Pyramiding demo", overlay = true)

//@variable Represents the direction of the entry orders. A value of 1 means long, and -1 means short.
var int direction = 1
//@variable Is `true` once every 25 bars, `false` otherwise.
bool entryCondition = bar_index % 25 == 0

// Change the `direction` on every 100th bar.
if bar_index % 100 == 0
    direction *= -1

// Place a market order based on the current `direction` when the `entryCondition` occurs.
if entryCondition
    strategy.entry("Entry", direction == 1 ? strategy.long : strategy.short)

//@variable When the `entryCondition` occurs, is a blue color if the `direction` is 1 and a red color otherwise.
color bgColor = entryCondition ? (direction == 1 ? color.new(color.blue, 80) : color.new(color.red, 80)) : na
// Highlight the chart's background using the `bgColor`. 
bgcolor(bgColor, title = "Background highlight")</code></div>
<p>Notice that although the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> with the same direction four times within each 100-bar cycle, the strategy <em>does not</em> execute an order after every call. It cannot open more than one trade per position with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> because it uses the default pyramiding value of 1.</p>
<p>Below, we modified the script by including <code dir="auto">pyramiding = 4</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement to allow up to four successive trades in the same direction. Now, an order fill occurs after every <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="548" loading="lazy" src="images/6e0f9050001cd5fa90070e1fa7d367f6.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Pyramiding demo", overlay = true, pyramiding = 4)

//@variable Represents the direction of the entry orders. A value of 1 means long, and -1 means short.
var int direction = 1
//@variable Is `true` once every 25 bars, `false` otherwise.
bool entryCondition = bar_index % 25 == 0

// Change the `direction` on every 100th bar.
if bar_index % 100 == 0
    direction *= -1

// Place a market order based on the current `direction` when the `entryCondition` occurs.
if entryCondition
    strategy.entry("Entry", direction == 1 ? strategy.long : strategy.short)

//@variable When the `entryCondition` occurs, is a blue color if the `direction` is 1 and a red color otherwise.
color bgColor = entryCondition ? (direction == 1 ? color.new(color.blue, 80) : color.new(color.red, 80)) : na
// Highlight the chart's background using the `bgColor`. 
bgcolor(bgColor, title = "Background highlight")</code></div>
<h3 class="md-heading" id="strategyorder"><a href="#strategyorder">`strategy.order()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> command generates a <em>basic order</em>. Unlike other order placement commands, which can behave differently based on a strategy’s properties and open trades, this command <em>ignores</em> most properties, such as <a href="/pine-script-docs/v5/concepts/strategies/#pyramiding">pyramiding</a>, and simply creates orders with the specified parameters. This command generates <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a> by default. It can also create <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit</a>, <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop</a>, and <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop-limit</a> orders with the <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters. Orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> can open new positions and modify or close existing ones. When a strategy executes an order from this command, the resulting market position is the <em>net sum</em> of the open position and the filled order quantity.</p>
<p>The following script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls to enter and exit positions. The strategy places a long <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> for 15 units once every 100 bars. On every 25th bar that is not a multiple of 100, it places a short market order for five units. The script highlights the background to signify where the strategy places a “buy” or “sell” order:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/a7a3433ded18c893e41c0200eb654df0.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("`strategy.order()` demo", overlay = true)

//@variable Is `true` on every 100th bar, `false` otherwise.
bool buyCondition = bar_index % 100 == 0
//@variable Is `true` on every 25th bar, `false` otherwise.
bool sellCondition = bar_index % 25 == 0

if buyCondition
    // Place a "buy" market order to trade 15 units in the long direction. 
    strategy.order("buy", strategy.long, qty = 15)
else if sellCondition
    // Place a "sell" market order to trade 5 units in the short direction.
    strategy.order("sell", strategy.short, qty = 5)

// Highlight the background when the `buyCondition` or `sellCondition` occurs.
bgcolor(buyCondition ? color.new(color.blue, 90) : sellCondition ? color.new(color.red, 90) : na)</code></div>
<p>This particular strategy never simulates a <em>short position</em>. Unlike the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> <em>does not</em> automatically <a href="/pine-script-docs/v5/concepts/strategies/#reversing-positions">reverse</a> open positions. After filling a “buy” order, the strategy has an open long position of 15 units. The three subsequent “sell” orders <em>reduce</em> the position by five units each, and 15 - 5 * 3 = 0. In other words, the strategy opens a long position on every 100th bar and gradually reduces the size to 0 using three successive short orders. If we used <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> instead of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> command in this example, the strategy would alternate between entering long and short positions of 15 and five units, respectively.</p>
<h3 class="md-heading" id="strategyexit"><a href="#strategyexit">`strategy.exit()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command generates <em>exit orders</em>. It features several unique behaviors that link to open trades, helping to simplify closing market positions and creating multi-level exits with <em>take-profit</em>, <em>stop-loss</em>, and <em>trailing stop</em> orders.</p>
<p>Unlike other order placement commands, which can generate a <em>single order</em> per call, each call to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> can produce <em>more than one</em> type of exit order, depending on its arguments. Additionally, a single call to this command can generate exit orders for <em>multiple entries</em>, depending on the specified <code dir="auto">from_entry</code> value and the strategy’s open trades.</p>
<h4 class="md-heading" id="take-profit-and-stop-loss"><a href="#take-profit-and-stop-loss">Take-profit and stop-loss<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The most basic use of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command is the placement of <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit orders</a> to trigger exits after earning enough money (take-profit), <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop orders</a> to trigger exits after losing too much money (stop-loss), or both (bracket).</p>
<p>Four parameters determine the prices of the command’s take-profit and stop-loss orders:</p>
<ul>
<li>The <code dir="auto">profit</code> and <code dir="auto">loss</code> parameters accept <em>relative</em> values representing the number of <em>ticks</em> the market price must move away from the entry price to trigger an exit.</li>
<li>The <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters accept <em>absolute</em> values representing the specific <em>prices</em> that trigger an exit when the market price reaches them.</li>
</ul>
<p>The absolute parameters of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command <em>supersede</em> the relative ones. If a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call contains <code dir="auto">profit</code> and <code dir="auto">limit</code> arguments, it creates a take-profit order at the <code dir="auto">limit</code> price and ignores the <code dir="auto">profit</code> value. Likewise, if the call includes <code dir="auto">loss</code> and <code dir="auto">stop</code> arguments, the command ignores the <code dir="auto">loss</code> value and places a stop-loss order at the <code dir="auto">stop</code> price.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command’s <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters <strong>do not</strong> behave the same as the <code dir="auto">limit</code> and <code dir="auto">stop</code> parameters of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> commands. Calling <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> with <code dir="auto">limit</code> and <code dir="auto">stop</code> arguments creates a single <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop-limit order</a>. In contrast, calling <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> with both arguments creates <strong>two exit orders</strong>: a take-profit order at the <code dir="auto">limit</code> price and a stop-loss order at the <code dir="auto">stop</code> price.</p></div></aside>
<p>The following example creates exit bracket (take-profit and stop-loss) orders with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command. When the <code dir="auto">buyCondition</code> occurs, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place a “buy” <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a>. It also calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> with <code dir="auto">limit</code> and <code dir="auto">stop</code> arguments to create a take-profit order at the <code dir="auto">limitPrice</code> and a stop-loss order at the <code dir="auto">stopPrice</code>. The script plots the <code dir="auto">limitPrice</code> and <code dir="auto">stopPrice</code> values on the chart to visualize the exit order prices:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="514" loading="lazy" src="images/de016b19a1ea15b58d5ebe3e9d9ab184.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Take-profit and stop-loss demo", overlay = true)

//@variable Is `true` on every 100th bar.
bool buyCondition = bar_index % 100 == 0

//@variable The current take-profit order price. 
var float takeProfit = na
//@variable The current stop-loss order price.
var float stopLoss = na

if buyCondition
    // Update the `takeProfit` and `stopLoss` values.
    if strategy.opentrades == 0
        takeProfit := close * 1.01
        stopLoss   := close * 0.99
    // Place a long market order. 
    strategy.entry("buy", strategy.long)
    // Place a take-profit order at the `takeProfit` price and a stop-loss order at the `stopLoss` price.
    strategy.exit("exit", "buy", limit = takeProfit, stop = stopLoss)

// Set `takeProfit` and `stopLoss` to `na` when the position closes.
if ta.change(strategy.closedtrades) &gt; 0
    takeProfit := na
    stopLoss   := na

// Plot the `takeProfit` and `stopLoss` values.
plot(takeProfit, "TP", color.green, style = plot.style_circles)
plot(stopLoss, "SL", color.red, style = plot.style_circles)</code></div>
<p>Note that:</p>
<ul>
<li>We did not specify a <code dir="auto">qty</code> or <code dir="auto">qty_percent</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call, meaning it creates orders to exit 100% of the “buy” order’s size.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command’s exit orders <em>do not</em> necessarily execute at the specified prices. Strategies can fill <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit orders</a> at <em>better</em> prices and <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop orders</a> at <em>worse</em> prices, depending on the range of values available to the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a>.</li>
</ul>
<p>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call includes a <code dir="auto">from_entry</code> argument, the resulting exit orders only apply to existing entry orders that have a matching ID. If the specified <code dir="auto">from_entry</code> value does not match the ID of any entry in the current position, the command <em>does not</em> create any exit orders.</p>
<p>Below, we changed the <code dir="auto">from_entry</code> argument of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call in our previous script to “buy2”, which means it creates exit orders only for open trades with the “buy2” entry ID. This version does not place <em>any</em> exit orders because it does not create any entry orders with the “buy2” ID:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Invalid `from_entry` ID demo", overlay = true)

//@variable Is `true` on every 100th bar.
bool buyCondition = bar_index % 100 == 0

//@variable The current take-profit order price. 
var float takeProfit = na
//@variable The current stop-loss order price.
var float stopLoss = na

if buyCondition
    // Update the `takeProfit` and `stopLoss` values before entering the trade.
    if strategy.opentrades == 0
        takeProfit := close * 1.01
        stopLoss   := close * 0.99
    // Place a long market order. 
    strategy.entry("buy", strategy.long)
    // Attempt to place an exit bracket for "buy2" entries.
    // This call has no effect because the strategy does not create entry orders with the "buy2" ID.
    strategy.exit("exit", "buy2", limit = takeProfit, stop = stopLoss)

// Set `takeProfit` and `stopLoss` to `na` when the position closes.
if ta.change(strategy.closedtrades) &gt; 0
    takeProfit := na
    stopLoss   := na

// Plot the `takeProfit` and `stopLoss` values.
plot(takeProfit, "TP", color.green, style = plot.style_circles)
plot(stopLoss, "SL", color.red, style = plot.style_circles)</code></div>
<p>Note that:</p>
<ul>
<li>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call <em>does not</em> include a <code dir="auto">from_entry</code> argument, it creates exit orders for <em>all</em> the position’s open trades, regardless of their entry IDs. See the <a href="/pine-script-docs/v5/concepts/strategies/#exits-for-multiple-entries">Exits for multiple entries</a> section below to learn more.</li>
</ul>
<h4 class="md-heading" id="partial-and-multi-level-exits"><a href="#partial-and-multi-level-exits">Partial and multi-level exits<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Strategies can use more than one call to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> to create successive <em>partial</em> exit orders for the same entry ID, helping to simplify the formation of multi-level exit strategies. To use multiple <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> calls to exit from an open trade, include a <code dir="auto">qty</code> or <code dir="auto">qty_percent</code> argument in each call to specify how much of the traded quantity to close. If the sum of the exit order sizes exceeds the open position, the strategy automatically <em>reduces</em> their sizes to match the position.</p>
<p>Note that:</p>
<ul>
<li>When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call includes <em>both</em> <code dir="auto">qty</code> and <code dir="auto">qty_percent</code> arguments, the command uses the <code dir="auto">qty</code> value to size the order and ignores the <code dir="auto">qty_percent</code> value.</li>
</ul>
<p>This example demonstrates a simple strategy that creates two partial exit order brackets for an entry ID. When the <code dir="auto">buyCondition</code> occurs, the script places a “buy” <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> for two shares with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a>, and it creates “exit1” and “exit2” brackets using two calls to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>. The first call uses a <code dir="auto">qty</code> of 1, and the second uses a <code dir="auto">qty</code> of 3:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/f0ed7a6fe2d255f2fbaa155176d17801.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Multi-level exit demo", "test", overlay = true)

//@variable Is `true` on every 100th bar.
bool buyCondition = bar_index % 100 == 0

//@variable The take-profit price for "exit1" orders.
var float takeProfit1 = na
//@variable The take-profit price for "exit2" orders.
var float takeProfit2 = na
//@variable The stop-loss price for "exit1" orders.
var float stopLoss1 = na
//@variable The stop-loss price for "exit2" orders.
var float stopLoss2 = na

if buyCondition
    // Update the `takeProfit*` and `stopLoss*` values before entering the trade.
    if strategy.opentrades == 0
        takeProfit1 := close * 1.01
        takeProfit2 := close * 1.02
        stopLoss1   := close * 0.99
        stopLoss2   := close * 0.98
    // Place a long market order with a `qty` of 2.
    strategy.entry("buy", strategy.long, qty = 2)
    // Place an "exit1" bracket with a `qty` of 1 at the `takeProfit1` and `stopLoss1` prices.
    strategy.exit("exit1", "buy", limit = takeProfit1, stop = stopLoss1, qty = 1)
    // Place an "exit2" bracket with a `qty` of 3 at the `takeProfit1` and `stopLoss1` prices.
    // The size of the resulting orders decreases to match the open position. 
    strategy.exit("exit2", "buy", limit = takeProfit2, stop = stopLoss2, qty = 3)

// Set `takeProfit1` and `stopLoss1` to `na` when the price touches either value. 
if high &gt;= takeProfit1 or low &lt;= stopLoss1
    takeProfit1 := na
    stopLoss1   := na
// Set `takeProfit2` and `stopLoss2` to `na` when the price touches either value. 
if high &gt;= takeProfit2 or low &lt;= stopLoss2
    takeProfit2 := na
    stopLoss2   := na

// Plot the `takeProfit*` and `stopLoss*` values.
plot(takeProfit1, "TP1", color.green, style = plot.style_circles)
plot(takeProfit2, "TP2", color.green, style = plot.style_circles)
plot(stopLoss1, "SL1", color.red, style = plot.style_circles)
plot(stopLoss2, "SL2", color.red, style = plot.style_circles)</code></div>
<p>As we can see from the trade markers on the chart above, the strategy first executes the “exit1” take-profit or stop-loss order to reduce the open position by one share, leaving one remaining share in the position. However, we specified a size of <em>three shares</em> for the “exit2” order bracket, which exceeds the remaining position. Rather than using this specified quantity, the strategy automatically <em>reduces</em> the “exit2” orders to one share, allowing it to close the position successfully.</p>
<p>Note that:</p>
<ul>
<li>This strategy only fills <strong>one</strong> exit order from the “exit1” bracket, <strong>not both</strong>. When a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call generates more than one exit order type for an entry ID, the strategy fills the only the <em>first</em> triggered one and automatically cancels the others.</li>
<li>The strategy reduced the “exit2” orders because all orders from the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> calls automatically belong to the same <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.reduce">strategy.oca.reduce</a> group by default. Learn more about <a href="/pine-script-docs/v5/concepts/strategies/#oca-groups">OCA groups</a> below.</li>
</ul>
<p>When creating multiple exit orders with <em>different</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> calls, it’s crucial to note that the orders from each call <em>reserve</em> a portion of the open position. The orders from one <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call <em>cannot</em> exit the portion of a position that a previous call already reserved.</p>
<p>For example, this script generates a “buy” entry order for 20 shares with a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> call and “limit” and “stop” exit orders with two separate calls to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> 100 bars before the last chart bar. We specified a quantity of 19 shares for the “limit” order and 20 for the “stop” order:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Reserved exit demo", "test", overlay = true)

//@variable The price of the "limit" exit order.
var float limitPrice = na
//@variable The price of the "stop" exit order.
var float stopPrice = na
//@variable Is `true` 100 bars before the last chart bar. 
bool longCondition = last_bar_index - bar_index == 100

if longCondition
    // Update the `limitPrice` and `stopPrice`. 
    limitPrice := close * 1.01
    stopPrice  := close * 0.99
    // Place a long market order for 20 shares.
    strategy.entry("buy", strategy.long, 20)
    // Create a take-profit order for 19 shares at the `limitPrice`.
    strategy.exit("limit", limit = limitPrice, qty = 19)
    // Create a stop-loss order at the `stopPrice`. Although this call specifies a `qty` of 20, the previous 
    // `strategy.exit()` call reserved 19, meaning this call creates an exit order for only 1 share. 
    strategy.exit("stop", stop = stopPrice, qty = 20)

//@variable Is `true` when the strategy has an open position, `false` otherwise.
bool showPlot = strategy.opentrades == 1

// Plot the `limitPrice` and `stopPrice` when `showPlot` is `true`.
plot(showPlot ? limitPrice : na, "Limit (take-profit) price", color.green, 2, plot.style_linebr)
plot(showPlot ? stopPrice : na, "Stop (stop-loss) price", color.red, 2, plot.style_linebr)</code></div>
<p>Users unfamiliar with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command’s unique behaviors might expect this strategy to close the entire market position if it fills the “stop” order before the “limit” order. However, the trade markers in the chart below show that the “stop” order only reduces the position by <strong>one share</strong>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call for the “limit” order executes first in the code, reserving 19 shares of the open position for closure with that order. This reservation leaves only one share available for the “stop” order to close, regardless of when the strategy fills it:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/7c8e6859751ad3cc614c5fa86c362c81.webp" width="1342"/></div></p>
<h4 class="md-heading" id="trailing-stops"><a href="#trailing-stops">Trailing stops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>One of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command’s key features is its ability to create <em>trailing stops</em>, i.e., stop-loss orders that trail behind the market price by a specified amount whenever it moves to a better value in the favorable direction (upward for long positions and downward for short positions).</p>
<p>This type of exit order has two components: an <em>activation level</em> and a <em>trail offset</em>. The activation level is the value the market price must cross to activate the trailing stop calculation, and the trail offset is the distance the activated stop follows behind the price as it reaches successively better values.</p>
<p>Three <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> parameters determine the activation level and trail offset of a trailing stop order:</p>
<ul>
<li>The <code dir="auto">trail_price</code> parameter accepts an <em>absolute price value</em> for the trailing stop’s activation level.</li>
<li>The <code dir="auto">trail_points</code> parameter is an alternative way to specify the activation level. Its value represents the <em>tick distance</em> from the entry price required to activate the trailing stop.</li>
<li>The <code dir="auto">trail_offset</code> parameter accepts a value representing the order’s trail offset as a specified number of ticks.</li>
</ul>
<p>To create and activate a trailing stop order, a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call must include a <code dir="auto">trail_offset</code> argument and either a <code dir="auto">trail_price</code> or <code dir="auto">trail_points</code> argument. If the call contains both <code dir="auto">trail_price</code> and <code dir="auto">trail_points</code> arguments, the command uses the <code dir="auto">trail_price</code> for the activation level and ignores the <code dir="auto">trail_points</code> value.</p>
<p>The example below demonstrates how a trailing stop order works. The strategy places a “Long” <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command 100 bars before the last chart bar, and it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> with <code dir="auto">trail_price</code> and <code dir="auto">trail_offset</code> arguments on the following bar to create a trailing stop. The script uses <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>, <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>, and a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a> to visualize the trailing stop’s behavior.</p>
<p>The green <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> on the chart shows the level the market price must reach to activate the trailing stop order. After the price crosses this level, the script uses a blue <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot</a> to display the trailing stop’s price. Each time the market price reaches a new high after activating the trailing stop, the stop’s price <em>increases</em> to maintain a distance of <code dir="auto">trailOffsetInput</code> ticks from the best value. The exit order <em>does not</em> change its price level when the market price decreases or does not reach a new high. Eventually, the market price crosses below the trailing stop, triggering an exit:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/b3e6162f69ed4c9cc259df808829e677.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Trailing stop order demo", overlay = true, margin_long = 100, margin_short = 100)

//@variable The distance from the entry price required to activate the trailing stop.
int activationOffsetInput = input.int(1000, "Activation level offset (in ticks)", 0)
//@variable The distance the stop follows behind the highest `high` after activation.
int trailOffsetInput = input.int(2000, "Trailing stop offset (in ticks)", 0)

//@variable Draws a label and an optional line at the specified `price`.
debugDrawings(float price, string txt, color drawingColor, bool drawLine = false) =&gt;
    // Draw a label showing the `txt` at the `price` on the current bar.
    label.new(
         bar_index, price, text = txt, color = drawingColor, textcolor = color.white,
         style = label.style_label_lower_right, size = size.large
     )
    // Draw a horizontal line at the `price` starting from the current bar when `drawLine` is `true`.
    line.new(
         bar_index, price, bar_index + 1, price, color = drawingColor, extend = extend.right,
         style = line.style_dashed
     )

//@variable The level required to activate the trailing stop.
var float activationLevel = na
//@variable The price of the trailing stop.
var float trailingStop = na
//@variable The value that the trailing stop would have if it was currently active. 
float theoreticalStopPrice = high - trailOffsetInput * syminfo.mintick

// Place a long market order 100 bars before the last historical bar.
if last_bar_index - bar_index == 100
    strategy.entry("Long", strategy.long)

// Create and visualize the exit order on the next bar.
if last_bar_index - bar_index == 99
    // Update the `activationLevel`.
    activationLevel := open + syminfo.mintick * activationOffsetInput
    // Create the trailing stop order that activates at the `activationLevel` and trails behind the `high` by 
    // `trailOffsetInput` ticks. 
    strategy.exit(
         "Trailing Stop", from_entry = "Long", trail_price = activationLevel, 
         trail_offset = trailOffsetInput
     )
    // Create drawings to signify the activation level.
    debugDrawings(activationLevel, "Trailing Stop Activation Level", color.green, true)

// Visualize the trailing stop's levels while the position is open.
if strategy.opentrades == 1
    // Create drawings when the `high` is above the `activationLevel` for the first time to show when the 
    // stop activates. 
    if na(trailingStop) and high &gt; activationLevel
        debugDrawings(activationLevel, "Activation level crossed", color.green)
        trailingStop := theoreticalStopPrice
        debugDrawings(trailingStop, "Trailing Stop Activated", color.blue)
    // Otherwise, update the `trailingStop` value when the `theoreticalStopPrice` reaches a new high.
    else if theoreticalStopPrice &gt; trailingStop
        trailingStop := theoreticalStopPrice

// Plot the `trailingStop` value to visualize the trailing price movement. 
plot(trailingStop, "Trailing Stop")</code></div>
<h4 class="md-heading" id="exits-for-multiple-entries"><a href="#exits-for-multiple-entries">Exits for multiple entries<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>A single call to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> command can generate exit orders for <em>more than one</em> entry in an open position, depending on the call’s <code dir="auto">from_entry</code> value.</p>
<p>If an open position consists of two or more entries with the same ID, a single call to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> with that ID as the <code dir="auto">from_entry</code> argument places exit orders for each corresponding entry created before or on the bar where the call occurs.</p>
<p>For example, this script periodically calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> on two consecutive bars to enter and add to a long position. Both calls use “buy” as the <code dir="auto">id</code> argument. After creating the second entry, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> once with “buy” as its <code dir="auto">from_entry</code> argument to generate separate exit orders for each entry with that ID. When the market price reaches the <code dir="auto">takeProfit</code> or <code dir="auto">stopLoss</code> value, the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills <em>two</em> exit orders and closes the position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="500" loading="lazy" src="images/cd18c65c8b09ffb410d31199cf3a3526.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exits for entries with the same ID demo", overlay = true, pyramiding = 2)

//@variable Take-profit price for exit commands.
var float takeProfit = na
//@variable Stop-loss price for exit commands.
var float stopLoss   = na

//@variable Is `true` on two consecutive bars in 100-bar cycles. 
bool buyCondition = math.min(bar_index % 100, math.max(bar_index - 1, 0) % 100) == 0

if buyCondition
    // Place a "buy" market order to enter a trade. 
    strategy.entry("buy", strategy.long)
    // Calculate exits on the second order.
    if strategy.opentrades == 1
        // Update the `takeProfit` and `stopLoss`.
        takeProfit := close * 1.01
        stopLoss   := close * 0.99
        // Place exit orders for both "buy" entries.
        strategy.exit("exit", "buy", limit = takeProfit, stop = stopLoss)

// Set `takeProfit` and `stopLoss` to `na` when both trades close.
if ta.change(strategy.closedtrades) == 2
    takeProfit := na
    stopLoss   := na

// Plot the `takeProfit` and `stopLoss` values.
plot(takeProfit, "TP", color.green, style = plot.style_circles)
plot(stopLoss, "SL", color.red, style = plot.style_circles)</code></div>
<p>A single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call can also generate exit orders for <em>all</em> entries in an open position, irrespective of entry ID, when it does not include a <code dir="auto">from_entry</code> argument.</p>
<p>Here, we changed the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> instance in the above script to create an entry order with a distinct ID on each call, and we removed the <code dir="auto">from_entry</code> argument from the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call. Since this version does not specify which entries the exit orders apply to, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call creates orders for <em>every</em> entry in the position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="500" loading="lazy" src="images/e18c58438a85d01291c038d35fe7a1d8.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exits for entries with different IDs demo", overlay = true, pyramiding = 2)

//@variable Take-profit price for exit commands.
var float takeProfit = na
//@variable Stop-loss price for exit commands.
var float stopLoss   = na

//@variable Is `true` on two consecutive bars in 100-bar cycles. 
bool buyCondition = math.min(bar_index % 100, math.max(bar_index - 1, 0) % 100) == 0

if buyCondition
    // Place a long market order with a unique ID. 
    strategy.entry("buy" + str.tostring(strategy.opentrades + strategy.closedtrades), strategy.long)
    // Calculate exits on the second order.
    if strategy.opentrades == 1
        // Update the `takeProfit` and `stopLoss`.
        takeProfit := close * 1.01
        stopLoss   := close * 0.99
        // Place exit orders for ALL entries in the position, irrespective of ID.
        strategy.exit("exit", limit = takeProfit, stop = stopLoss)

// Set `takeProfit` and `stopLoss` to `na` when both trades close.
if ta.change(strategy.closedtrades) == 2
    takeProfit := na
    stopLoss   := na

// Plot the `takeProfit` and `stopLoss` values.
plot(takeProfit, "TP", color.green, style = plot.style_circles)
plot(stopLoss, "SL", color.red, style = plot.style_circles)</code></div>
<p>It’s crucial to note that a call to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> without a <code dir="auto">from_entry</code> argument <em>persists</em> and creates exit orders for all open trades in a position, regardless of <em>when</em> the entries occur. This behavior can affect strategies that manage positions with multiple entries or exits. When a strategy has an open position and calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> on any bar without specifying a <code dir="auto">from_entry</code> ID, it generates exit orders for each entry created <em>before</em> or on that bar, and it continues to generate exit orders for subsequent entries <em>after</em> that bar until the position closes.</p>
<p>Let’s explore this behavior and how it works. The script below creates a long entry order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> on each bar within a user-specified time range, and it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> without a <code dir="auto">from_entry</code> argument on <em>one bar</em> within that range to generate exit orders for <em>every</em> entry in the open position. The exit command uses a <code dir="auto">loss</code> value of 0, which means an exit order fills each time the market price is not above an entry order’s price.</p>
<p>The script prompts users to select three points before it starts its calculations. The first point specifies when order creation begins, the second determines when the single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call occurs, and the third specifies when order creation stops:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="530" loading="lazy" src="images/f11584a11bb9805770bfb82a3804af71.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exit persist demo", overlay = true, margin_long = 100, margin_short = 100, pyramiding = 100)

//@variable The time when order creation starts. 
int entryStartTime = input.time(0, "Start time for entries", confirm = true)
//@variable The time when the `strategy.exit()` call occurs.
int exitCallTime = input.time(0, "Exit call time", confirm = true)
//@variable The time when order creation stops.
int entryEndTime = input.time(0, "End time for entries", confirm = true)

// Raise a runtime error if incorrect timestamps are chosen.
if exitCallTime &lt;= entryStartTime or entryEndTime &lt;= exitCallTime or entryEndTime &lt;= entryStartTime
    runtime.error("The input timestamps must follow this condition: entryStartTime &lt; exitCallTime &lt; entryEndTime.")

// Create variables to track entry and exit conditions. 
bool entriesStart = time == entryStartTime
bool callExit     = time == exitCallTime
bool entriesEnd   = time == entryEndTime
bool callEntry    = time &gt;= entryStartTime and time &lt; entryEndTime

// Place a long entry order when `callEntry` is `true`.
if callEntry
    strategy.entry("Entry", strategy.long)

// Call `strategy.exit()` when `callExit` is `true`, which occurs only once.
// This single call persists and creates exit orders for EVERY entry in the position because it does not 
// specify a `from_entry` ID.
if callExit
    strategy.exit("Exit", loss = 0)

// Draw labels to signify when entries start, when the `strategy.exit()` call occurs, and when order placement stops.
switch 
    entriesStart =&gt; label.new(
         bar_index, high, "Start placing entry orders.", color = color.green, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    callExit =&gt; label.new(
         bar_index, high, "Call `strategy.exit()` once.", color = color.blue, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    entriesEnd =&gt; label.new(
         bar_index, high, "Stop placing orders.", color = color.red, textcolor = color.white, 
         style = label.style_label_lower_left, size = size.large
     )

// Create a line and label to visualize the lowest entry price, i.e., the price required to close the position.
var line lowestLine = line.new(
     entryStartTime + 1000, na, entryEndTime, na, xloc.bar_time, extend.right, color.orange, width = 2
 )
var lowestLabel = label.new(
     entryStartTime + 1000, na, "Lowest entry price", color = color.orange, 
     style = label.style_label_upper_right, xloc = xloc.bar_time
 )

// Update the price values of the `lowestLine` and `lowestLabel` after each new entry.
if callEntry[1]
    var float lowestPrice = strategy.opentrades.entry_price(0)
    float entryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)
    if not na(entryPrice)
        lowestPrice := math.min(lowestPrice, entryPrice)
        lowestLine.set_y1(lowestPrice)
        lowestLine.set_y2(lowestPrice)
        lowestLabel.set_y(lowestPrice)

// Highlight the background when `entriesStart`, `callExit`, and `entriesEnd` occurs.
bgcolor(entriesStart ? color.new(color.green, 80) : na, title = "Entries start highlight")
bgcolor(callExit ? color.new(color.blue, 80) : na, title = "Exit call highlight")
bgcolor(entriesEnd ? color.new(color.red, 80) : na, title = "Entries end highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We included <code dir="auto">pyramiding = 100</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, which allows the position to have up to 100 open entries from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a>.</li>
<li>The script uses <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a> to signify when order placement starts and stops and when the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call occurs.</li>
<li>The script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> and a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> at the lowest <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_price">entry price</a> to show the value the market price must reach to close the position.</li>
</ul>
<p>We can observe the unique <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> behavior in this example by comparing the code itself with the script’s chart outputs. The script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> <em>one time</em>, only on the bar with the blue <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>. However, this single call placed exit orders for every entry <strong>before</strong> or on that bar and continued placing exit orders for all entries <strong>after</strong> that bar. This behavior occurs because <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> has no way to determine when to stop placing orders if it does not link to entries with a specific ID. In this case, the command only ceases to create new exit orders after the position fully closes.</p>
<p>The above script would exhibit different behavior if we included a <code dir="auto">from_entry</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call. When a call to this command specifies a <code dir="auto">from_entry</code> ID, it only applies to entries with that ID which the strategy created <em>before</em> or <em>on</em> the bar of the call. The command does not place exit orders for subsequent entries created <em>after</em> that bar in that case, even ones with the same ID.</p>
<p>Here, we added <code dir="auto">from_entry = "Entry"</code> to our script’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call, meaning it only produces exit orders for entries with the “Entry” ID. Only 17 exits occur this time, each corresponding to an entry order created before or on the bar with the blue <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>. The call does not affect any entries that the strategy creates <em>after</em> that bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="530" loading="lazy" src="images/295a9c484e5de4e2a5b404cbcc81b539.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exit persist demo", overlay = true, margin_long = 100, margin_short = 100, pyramiding = 100)

//@variable The time when order creation starts. 
int entryStartTime = input.time(0, "Start time for entries", confirm = true)
//@variable The time when the `strategy.exit()` call occurs.
int exitCallTime = input.time(0, "Exit call time", confirm = true)
//@variable The time when order creation stops.
int entryEndTime = input.time(0, "End time for entries", confirm = true)

// Raise a runtime error if incorrect timestamps are chosen.
if exitCallTime &lt;= entryStartTime or entryEndTime &lt;= exitCallTime or entryEndTime &lt;= entryStartTime
    runtime.error("The input timestamps must follow this condition: entryStartTime &lt; exitCallTime &lt; entryEndTime.")

// Create variables to track entry and exit conditions. 
bool entriesStart = time == entryStartTime
bool callExit     = time == exitCallTime
bool entriesEnd   = time == entryEndTime
bool callEntry    = time &gt;= entryStartTime and time &lt; entryEndTime

// Place a long entry order when `callEntry` is `true`.
if callEntry
    strategy.entry("Entry", strategy.long)

// Call `strategy.exit()` when `callExit` is `true`, which occurs only once.
// This single call only places exit orders for all entries with the "Entry" ID created before or on the bar where 
// `callExit` occurs. It DOES NOT affect any subsequent entries created after that bar.
if callExit
    strategy.exit("Exit", from_entry = "Entry", loss = 0)

// Draw labels to signify when entries start, when the `strategy.exit()` call occurs, and when order placement stops.
switch 
    entriesStart =&gt; label.new(
         bar_index, high, "Start placing entry orders.", color = color.green, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    callExit =&gt; label.new(
         bar_index, high, "Call `strategy.exit()` once.", color = color.blue, textcolor = color.white, 
         style = label.style_label_lower_right, size = size.large
     )
    entriesEnd =&gt; label.new(
         bar_index, high, "Stop placing orders.", color = color.red, textcolor = color.white, 
         style = label.style_label_lower_left, size = size.large
     )

// Create a line and label to visualize the lowest entry price, i.e., the price required to close the position.
var line lowestLine = line.new(
     entryStartTime + 1000, na, entryEndTime, na, xloc.bar_time, extend.right, color.orange, width = 2
 )
var lowestLabel = label.new(
     entryStartTime + 1000, na, "Lowest entry price", color = color.orange, 
     style = label.style_label_upper_right, xloc = xloc.bar_time
 )

// Update the price values of the `lowestLine` and `lowestLabel` after each new entry.
if callEntry[1]
    var float lowestPrice = strategy.opentrades.entry_price(0)
    float entryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)
    if not na(entryPrice)
        lowestPrice := math.min(lowestPrice, entryPrice)
        lowestLine.set_y1(lowestPrice)
        lowestLine.set_y2(lowestPrice)
        lowestLabel.set_y(lowestPrice)

// Highlight the background when `entriesStart`, `callExit`, and `entriesEnd` occurs.
bgcolor(entriesStart ? color.new(color.green, 80) : na, title = "Entries start highlight")
bgcolor(callExit ? color.new(color.blue, 80) : na, title = "Exit call highlight")
bgcolor(entriesEnd ? color.new(color.red, 80) : na, title = "Entries end highlight")</code></div>
<h3 class="md-heading" id="strategyclose-and-strategyclose_all"><a href="#strategyclose-and-strategyclose_all">`strategy.close()` and `strategy.close_all()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> commands generate orders to exit from an open position. Unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>, which creates <em>price-based</em> exit orders (e.g., <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a>), these commands generate <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a> that the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills on the next available tick, irrespective of the price.</p>
<p>The example below demonstrates a simple strategy that places a “buy” entry order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> once every 50 bars and a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> to close the long position with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> 25 bars afterward:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/265351ef0ebb61e2b05d38322881e116.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Close demo", "test", overlay = true)

//@variable Is `true` on every 50th bar.
buyCond = bar_index % 50 == 0
//@variable Is `true` on every 25th bar except for those that are divisible by 50.
sellCond = bar_index % 25 == 0 and not buyCond

if buyCond
    strategy.entry("buy", strategy.long)
if sellCond
    strategy.close("buy")

bgcolor(buyCond  ? color.new(color.blue, 90) : na)
bgcolor(sellCond ? color.new(color.red, 90) : na)</code></div>
<p>Notice that the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> call in this script uses “buy” as its required <code dir="auto">id</code> argument. Unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>, this command’s <code dir="auto">id</code> parameter specifies the <em>entry ID</em> of an open trade. It <strong>does not</strong> represent the ID of the resulting exit order. If a market position consists of multiple open trades with the same entry ID, a single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> call with that ID as its <code dir="auto">id</code> argument generates a single <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> to exit from all of them.</p>
<p>The following script creates a “buy” order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> once every 25 bars, and it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> with “buy” as its <code dir="auto">id</code> argument to close all open trades with that entry ID once every 100 bars. The market order from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> closes the entire position in this case because every open trade has the same “buy” entry ID:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/62f5de685891e107b7978e49abf88302.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Multiple close demo", "test", overlay = true, pyramiding = 3)

//@variable Is `true` on every 100th bar.
sellCond = bar_index % 100 == 0
//@variable Is `true` on every 25th bar except for those that are divisible by 100.
buyCond = bar_index % 25 == 0 and not sellCond

if buyCond
    strategy.entry("buy", strategy.long)
if sellCond
    strategy.close("buy")

bgcolor(buyCond  ? color.new(color.blue, 90) : na)
bgcolor(sellCond ? color.new(color.red, 90) : na)</code></div>
<p>Note that:</p>
<ul>
<li>We included <code dir="auto">pyramiding = 3</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, allowing the script to generate up to three entries per position with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls.</li>
</ul>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> command generates a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> to exit from the open position that <em>does not</em> link to any specific entry ID. This command is helpful when a strategy needs to exit as soon as possible from a position consisting of multiple open trades with different entry IDs.</p>
<p>The script below places “A”, “B”, and “C” entry orders sequentially based on the number of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades">open trades</a>, and then it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> to create a single order that closes the entire position on the next bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/203e098daaa4edfd7fd07f92f9a81fa4.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Close multiple ID demo", "test", overlay = true, pyramiding = 3)

switch strategy.opentrades
    0 =&gt; strategy.entry("A", strategy.long)
    1 =&gt; strategy.entry("B", strategy.long)
    2 =&gt; strategy.entry("C", strategy.long)
    3 =&gt; strategy.close_all()</code></div>
<h3 class="md-heading" id="strategycancel-and-strategycancel_all"><a href="#strategycancel-and-strategycancel_all">`strategy.cancel()` and `strategy.cancel_all()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel_all">strategy.cancel_all()</a> commands allow strategies to cancel <em>unfilled</em> orders before the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> processes them. These order cancellation commands are most helpful when working with <em>price-based orders</em>, including all orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> calls and the orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls that use <code dir="auto">limit</code> or <code dir="auto">stop</code> arguments.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a> command has a required <code dir="auto">id</code> parameter, which specifies the ID of the entry or exit orders to cancel. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel_all">strategy.cancel_all()</a> command does not have such a parameter because it cancels <em>all</em> unfilled orders, regardless of ID.</p>
<p>The following strategy places a “buy” <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit order</a> 500 ticks below the closing price 100 bars before the last chart bar with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a>, and it cancels the order on the next bar with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a>. The script highlights the chart’s background to signify when it places and cancels the “buy” order, and it draws a horizontal <a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a> at the order’s price. As we see below, our example chart shows no entry marker when the market price crosses the horizontal line because the strategy already cancels the order (when the chart’s background is orange) before it reaches that level:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/02cc068549e89e20c6c1f4ca95675332.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Cancel demo", "test", overlay = true)

//@variable Draws a horizontal line at the `limit` price of the "buy" order.
var line limitLine = na

//@variable Is `color.green` when the strategy places the "buy" order, `color.orange` when it cancels the order.
color bgColor = na

if last_bar_index - bar_index == 100
    float limitPrice = close - syminfo.mintick * 500
    strategy.entry("buy", strategy.long, limit = limitPrice)
    limitLine := line.new(bar_index, limitPrice, bar_index + 1, limitPrice, extend = extend.right)
    bgColor := color.new(color.green, 50)

if last_bar_index - bar_index == 99
    strategy.cancel("buy")
    bgColor := color.new(color.orange, 50)

bgcolor(bgColor)</code></div>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a> command affects <em>all</em> unfilled orders with a specified ID. It does nothing if the specified <code dir="auto">id</code> represents the ID of an order that does not exist. When there is more than one unfilled order with the specified ID, the command cancels <em>all</em> of them at once.</p>
<p>Below, we’ve modified the previous script to place a “buy” limit order on three consecutive bars, starting 100 bars before the last chart bar. After placing all three orders, the strategy cancels them using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a> with “buy” as the <code dir="auto">id</code> argument, resulting in nothing happening when the market price reaches any of the order prices (horizontal <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/941af3016dab1fcc1791125e77046941.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Multiple cancel demo", "test", overlay = true, pyramiding = 3)

//@variable Draws a horizontal line at the `limit` price of the "buy" order.
var line limitLine = na

//@variable Is `color.green` when the strategy places the "buy" order, `color.orange` when it cancels the order.
color bgColor = na

if last_bar_index - bar_index &lt;= 100 and last_bar_index - bar_index &gt;= 98
    float limitPrice = close - syminfo.mintick * 500
    strategy.entry("buy", strategy.long, limit = limitPrice)
    limitLine := line.new(bar_index, limitPrice, bar_index + 1, limitPrice, extend = extend.right)
    bgColor := color.new(color.green, 50)

if last_bar_index - bar_index == 97
    strategy.cancel("buy")
    bgColor := color.new(color.orange, 50)

bgcolor(bgColor)</code></div>
<p>Note that:</p>
<ul>
<li>We included <code dir="auto">pyramiding = 3</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, allowing three successive entries from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> per position. The script would also achieve the same result without this setting if it called <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> instead because <a href="/pine-script-docs/v5/concepts/strategies/#pyramiding">pyramiding</a> <em>does not</em> affect orders from that command.</li>
</ul>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel">strategy.cancel()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel_all">strategy.cancel_all()</a> commands can cancel orders of any type, including <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a>. However, it is important to note that either command can cancel a market order only if its call occurs on the <em>same</em> script execution as the order placement command. If the call happens after that point, it has <em>no effect</em> because the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills market orders on the <em>next available tick</em>.</p>
<p>This example places a “buy” market order 100 bars before the last chart bar with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a>, then it attempts to cancel the order on the next bar with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel_all">strategy.cancel_all()</a>. The cancellation command <em>does not</em> affect the “buy” order because the broker emulator fills the order on the next bar’s <em>opening tick</em>, which occurs <em>before</em> the script evaluates the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.cancel_all">strategy.cancel_all()</a> call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="544" loading="lazy" src="images/bb25338d359a538ae62f77de8d5d1258.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Cancel market demo", "test", overlay = true)

//@variable Is `color.green` when the strategy places the "buy" order, `color.orange` when it tries to cancel the order.
color bgColor = na

if last_bar_index - bar_index == 100
    strategy.entry("buy", strategy.long)
    bgColor := color.new(color.green, 50)

if last_bar_index - bar_index == 99
    strategy.cancel_all()
    bgColor := color.new(color.orange, 50)

bgcolor(bgColor)</code></div>
<h2 class="md-heading" id="position-sizing"><a href="#position-sizing">Position sizing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ strategies feature two ways to control the sizes of the orders that open and manage positions:</p>
<ul>
<li>Set a default <em>fixed</em> quantity type and value for the orders. Programmers can specify defaults for these properties by including <code dir="auto">default_qty_type</code> and <code dir="auto">default_qty_value</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement. Script users can adjust these values with the “Order size” inputs in the “Settings/Properties” tab.</li>
<li>Include a <em>non-na</em> <code dir="auto">qty</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> call. When a call to either of these commands specifies a non-na <code dir="auto">qty</code> value, that call ignores the strategy’s default quantity type and value and places an order for <code dir="auto">qty</code> contracts/shares/lots/units instead.</li>
</ul>
<p>The following example uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls with different <code dir="auto">qty</code> values for long and short trades. When the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> equals the <code dir="auto">lowest</code> value, the script places a “Buy” order to enter a long position of <code dir="auto">longAmount</code> units. Otherwise, when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> equals the <code dir="auto">highest</code> value, it places a “Sell” order to enter a short position of <code dir="auto">shortAmount</code> units:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="740" loading="lazy" src="images/b032d31aa63acffc2a5b44c9000dd193.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Buy low, sell high", overlay = true, default_qty_type = strategy.cash, default_qty_value = 5000)

int   length      = input.int(20, "Length", 1)
float longAmount  = input.float(4.0, "Long Amount", 0.0)
float shortAmount = input.float(2.0, "Short Amount", 0.0)

float highest = ta.highest(length)
float lowest  = ta.lowest(length)

switch
    low == lowest   =&gt; strategy.entry("Buy", strategy.long, longAmount)
    high == highest =&gt; strategy.entry("Sell", strategy.short, shortAmount)</code></div>
<p>Notice that although we’ve included <code dir="auto">default_qty_type</code> and <code dir="auto">default_qty_value</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, the strategy <em>does not</em> use this default setting to size its orders because the specified <code dir="auto">qty</code> in the entry commands takes precedence. If we want to use the default size, we must <em>remove</em> the <code dir="auto">qty</code> arguments from the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls or set their values to <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<p>Here, we edited the previous script by including <a href="/pine-script-docs/v5/language/operators/#-ternary-operator">ternary</a> expressions for the <code dir="auto">qty</code> arguments in both <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls that replace input values of 0 with <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>. If the specified <code dir="auto">longAmount</code> or <code dir="auto">shortAmount</code> is 0, which is what we set as the new default, the corresponding entry orders use the strategy’s default order size instead, as we see below:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="740" loading="lazy" src="images/d0b3477ce9d5b499074aa024491f0fd7.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Buy low, sell high", overlay = true, default_qty_type = strategy.cash, default_qty_value = 5000)

int   length      = input.int(20, "Length", 1)
float longAmount  = input.float(0.0, "Long Amount", 0.0)
float shortAmount = input.float(0.0, "Short Amount", 0.0)

float highest = ta.highest(length)
float lowest  = ta.lowest(length)

switch
    low == lowest   =&gt; strategy.entry("Buy", strategy.long, longAmount == 0.0 ? na : longAmount)
    high == highest =&gt; strategy.entry("Sell", strategy.short, shortAmount == 0.0 ? na : shortAmount)</code></div>
<h2 class="md-heading" id="closing-a-market-position"><a href="#closing-a-market-position">Closing a market position<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>By default, strategies close a market position using the <em>First In, First Out (FIFO)</em> method, which means that any exit order closes or reduces the position starting with the <em>first</em> open trade, even if the exit command specifies the entry ID of a <em>different</em> open trade. To override this default behavior, include <code dir="auto">close_entries_rule = "ANY"</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement.</p>
<p>The following example places “Buy1” and “Buy2” entry orders sequentially, starting 100 bars before the latest chart bar. When the position size is 0, it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place the “Buy1” order for five units. After the strategy’s position size matches the size of that order, it uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place the “Buy2” order for ten units. The strategy then creates “bracket” exit orders <a href="/pine-script-docs/v5/concepts/strategies/#exits-for-multiple-entries">for both entries</a> using a single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call without a <code dir="auto">from_entry</code> argument. For visual reference, the script plots the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a> value in a separate pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="686" loading="lazy" src="images/eaeccc7e2521362aedf8b5315a7a440d.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exit Demo", pyramiding = 2)

float positionSize = strategy.position_size

if positionSize == 0 and last_bar_index - bar_index &lt;= 100
    strategy.entry("Buy1", strategy.long, 5)
else if positionSize == 5
    strategy.entry("Buy2", strategy.long, 10)
else if positionSize == 15
    strategy.exit("bracket", loss = 10, profit = 10)

plot(positionSize == 0 ? na : positionSize, "Position Size", color.lime, 4, plot.style_histogram)</code></div>
<p>Note that:</p>
<ul>
<li>We included <code dir="auto">pyramiding = 2</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, allowing two successive entries from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> per position.</li>
</ul>
<p>Each time the market price triggers an exit order, the above script exits from the open position, starting with the <em>oldest</em> open trade. This FIFO behavior applies even if we explicitly specify an exit from “Buy2” before “Buy1” in the code.</p>
<p>The script version below calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> with “Buy2” as its <code dir="auto">id</code> argument, and it includes “Buy1” as the <code dir="auto">from_entry</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call. The <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> executes on the next available tick, meaning the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills it <em>before</em> the <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">take-profit</a> and <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Exit Demo", pyramiding = 2)

float positionSize = strategy.position_size

if positionSize == 0 and last_bar_index - bar_index &lt;= 100
    strategy.entry("Buy1", strategy.long, 5)
else if positionSize == 5
    strategy.entry("Buy2", strategy.long, 10)
else if positionSize == 15
    strategy.close("Buy2")
    strategy.exit("bracket", "Buy1", loss = 10, profit = 10)

plot(positionSize == 0 ? na : positionSize, "Position Size", color.lime, 4, plot.style_histogram)</code></div>
<p>The market order from the script’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> call is for 10 units because it links to the open trade with the “Buy2” entry ID. A user might expect this strategy to close that trade completely when the order executes. However, the “List of Trades” tab shows that five units of the order go toward closing the “Buy1” trade <em>first</em> because it is the oldest, and the remaining five units close <em>half</em> of the “Buy2” trade. After that, the “bracket” orders from the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call close the rest of the position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="518" loading="lazy" src="images/eb4e34a2e8fb8c6858292e43744330b9.webp" width="1342"/></div></p>
<p>Note that:</p>
<ul>
<li>If we included <code dir="auto">close_entries_rule = "ANY"</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, the market order from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> would close the open trade with the “Buy2” entry ID <em>first</em>, and then the “bracket” orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> would close the trade with the “Buy1” entry ID.</li>
</ul>
<h2 class="md-heading" id="oca-groups"><a href="#oca-groups">OCA groups<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>One-Cancels-All (OCA)</em> groups allow a strategy to fully or partially <em>cancel</em> specific orders when the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> executes another order from the same group. To assign an order to an OCA group, include an <code dir="auto">oca_name</code> argument in the call to the <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement command</a>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> commands also allow programmers to specify an <em>OCA type</em>, which defines whether a strategy <a href="/pine-script-docs/v5/concepts/strategies/#strategyocacancel">cancels</a>, <a href="/pine-script-docs/v5/concepts/strategies#strategyocareduce">reduces</a>, or <a href="/pine-script-docs/v5/concepts/strategies#strategyocanone">does not modify</a> the order after executing other orders.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>All order placement commands that issue orders for the same OCA group must specify the same group name <strong>and</strong> OCA type. If two commands have the same <code dir="auto">oca_name</code> but <em>different</em> <code dir="auto">oca_type</code> values, the strategy considers them to be from <strong>two distinct groups</strong>. In other words, an OCA group <strong>cannot</strong> mix the <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.cancel">strategy.oca.cancel</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.reduce">strategy.oca.reduce</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.none">strategy.oca.none</a> OCA types.</p></div></aside>
<h3 class="md-heading" id="strategyocacancel"><a href="#strategyocacancel">`strategy.oca.cancel`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When an order placement command uses <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.cancel">strategy.oca.cancel</a> as its <code dir="auto">oca_type</code> argument, the strategy completely <em>cancels</em> the resulting order if another order from the same OCA group executes first.</p>
<p>To demonstrate how this OCA type impacts a strategy’s orders, consider the following script, which places orders when the <code dir="auto">ma1</code> value crosses the <code dir="auto">ma2</code> value. If the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a> is 0 when the cross occurs, the strategy places two <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop orders</a> with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls. The first is a long order at the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, and the second is a short order at the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>. If the strategy already has an open position during the cross, it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> to close the position with a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("OCA Cancel Demo", overlay=true)

float ma1 = ta.sma(close, 5)
float ma2 = ta.sma(close, 9)

if ta.cross(ma1, ma2)
    if strategy.position_size == 0
        strategy.order("Long",  strategy.long, stop = high)
        strategy.order("Short", strategy.short, stop = low)
    else
        strategy.close_all()

plot(ma1, "Fast MA", color.aqua)
plot(ma2, "Slow MA", color.orange)</code></div>
<p>Depending on the price action, the strategy might fill <em>both</em> stop orders before creating the closing market order. In that case, the strategy exits the position without evaluating <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> because both orders have the same size. We see this behavior in the chart below, where the strategy alternated between executing “Long” and “Short” orders a few times without executing an order from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="550" loading="lazy" src="images/fe4906f6fb8b08ed3189b4f80d6566c3.webp" width="1816"/></div></p>
<p>To eliminate scenarios where the strategy fills the “Long” and “Short” orders before evaluating the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> call, we can instruct it to <em>cancel</em> one of the orders after it executes the other. Below, we included “Entry” as the <code dir="auto">oca_name</code> argument and <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.cancel">strategy.oca.cancel</a> as the <code dir="auto">oca_type</code> argument in both <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls. Now, after the strategy executes either the “Long” or “Short” order, it cancels the other order and waits for <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> to close the position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="550" loading="lazy" src="images/b35b6fd12d44bd49e12de31c2c114b16.webp" width="1816"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("OCA Cancel Demo", overlay=true)

float ma1 = ta.sma(close, 5)
float ma2 = ta.sma(close, 9)

if ta.cross(ma1, ma2)
    if strategy.position_size == 0
        strategy.order("Long",  strategy.long, stop = high, oca_name = "Entry", oca_type = strategy.oca.cancel)
        strategy.order("Short", strategy.short, stop = low, oca_name = "Entry", oca_type = strategy.oca.cancel)
    else
        strategy.close_all()

plot(ma1, "Fast MA", color.aqua)
plot(ma2, "Slow MA", color.orange)</code></div>
<h3 class="md-heading" id="strategyocareduce"><a href="#strategyocareduce">`strategy.oca.reduce`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When an order placement command uses <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.reduce">strategy.oca.reduce</a> as its OCA type, the strategy <em>does not</em> cancel the resulting order entirely if another order with the same OCA name executes first. Instead, it <em>reduces</em> the order’s size by the filled number of contracts/shares/lots/units, which is particularly useful for custom exit strategies.</p>
<p>The following example demonstrates a <em>long-only</em> strategy that generates a single stop-loss order and two take-profit orders for each new entry. When a faster moving average crosses over a slower one, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> with <code dir="auto">qty = 6</code> to create an entry order, and then it uses three <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls to create a <a href="/pine-script-docs/v5/concepts/strategies/#stop-and-stop-limit-orders">stop order</a> at the <code dir="auto">stop</code> price and two <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit orders</a> at the <code dir="auto">limit1</code> and <code dir="auto">limit2</code> prices. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> call for the “Stop” order uses <code dir="auto">qty = 6</code>, and the two calls for the “Limit 1” and “Limit 2” orders both use <code dir="auto">qty = 3</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Multiple TP Demo", overlay = true)

var float stop   = na
var float limit1 = na
var float limit2 = na

bool longCondition = ta.crossover(ta.sma(close, 5), ta.sma(close, 9))
if longCondition and strategy.position_size == 0
    stop   := close * 0.99
    limit1 := close * 1.01
    limit2 := close * 1.02
    strategy.entry("Long",  strategy.long, 6)
    strategy.order("Stop",  strategy.short, stop = stop, qty = 6)
    strategy.order("Limit 1", strategy.short, limit = limit1, qty = 3)
    strategy.order("Limit 2", strategy.short, limit = limit2, qty = 3)

bool showPlot = strategy.position_size != 0
plot(showPlot ? stop   : na, "Stop",    color.red,   style = plot.style_linebr)
plot(showPlot ? limit1 : na, "Limit 1", color.green, style = plot.style_linebr)
plot(showPlot ? limit2 : na, "Limit 2", color.green, style = plot.style_linebr)</code></div>
<p>After adding this strategy to the chart, we see it does not work as initially intended. The problem with this script is that the orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> <strong>do not</strong> belong to an OCA group by default (unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>, whose orders automatically belong to a <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.reduce">strategy.oca.reduce</a> OCA group). Since the strategy does not assign the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls to any OCA group, it does not reduce any unfilled stop or limit orders after executing an order. Consequently, if the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills the stop order and at least one of the limit orders, the traded quantity <strong>exceeds</strong> the open long position, resulting in an open <em>short</em> position:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="830" loading="lazy" src="images/7e5876005400c7faea13944a93f98a8f.webp" width="1818"/></div></p>
<p>For our long-only strategy to work as we intended, we must instruct it to <em>reduce</em> the sizes of the unfilled stop/limit orders after one of them executes to prevent selling a larger quantity than the open long position.</p>
<p>Below, we specified “Bracket” as the <code dir="auto">oca_name</code> and <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.reduce">strategy.oca.reduce</a> as the <code dir="auto">oca_type</code> in all the script’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> calls. These changes tell the strategy to reduce the sizes of the orders in the “Bracket” group each time the broker emulator fills one of them. This version of the strategy never simulates a short position because the total size of its filled stop and limit orders never <em>exceeds</em> the long position’s size:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/bd4a86f15d88a16dfe233dccd1e1b2df.webp" width="1818"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Multiple TP Demo", overlay = true)

var float stop   = na
var float limit1 = na
var float limit2 = na

bool longCondition = ta.crossover(ta.sma(close, 5), ta.sma(close, 9))
if longCondition and strategy.position_size == 0
    stop   := close * 0.99
    limit1 := close * 1.01
    limit2 := close * 1.02
    strategy.entry("Long",  strategy.long, 6)
    strategy.order("Stop",  strategy.short, stop = stop, qty = 6, oca_name = "Bracket", oca_type = strategy.oca.reduce)
    strategy.order("Limit 1", strategy.short, limit = limit1, qty = 3, oca_name = "Bracket", oca_type = strategy.oca.reduce)
    strategy.order("Limit 2", strategy.short, limit = limit2, qty = 6, oca_name = "Bracket", oca_type = strategy.oca.reduce)

bool showPlot = strategy.position_size != 0
plot(showPlot ? stop   : na, "Stop",    color.red,   style = plot.style_linebr)
plot(showPlot ? limit1 : na, "Limit 1", color.green, style = plot.style_linebr)
plot(showPlot ? limit2 : na, "Limit 2", color.green, style = plot.style_linebr)</code></div>
<p>Note that:</p>
<ul>
<li>We also changed the <code dir="auto">qty</code> value of the “Limit 2” order to 6 instead of 3 because the strategy reduces its amount by three units when it executes the “Limit 1” order. Keeping the <code dir="auto">qty</code> value of 3 would cause the second limit order’s size to drop to 0 after the strategy fills the first limit order, meaning it would never execute.</li>
</ul>
<h3 class="md-heading" id="strategyocanone"><a href="#strategyocanone">`strategy.oca.none`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When an order placement command uses <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.oca.none">strategy.oca.none</a> as its <code dir="auto">oca_type</code> value, all orders from that command execute <em>independently</em> of any OCA group. This value is the default <code dir="auto">oca_type</code> for the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.order">strategy.order()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> commands.</p>
<h2 class="md-heading" id="currency"><a href="#currency">Currency<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ strategies can use different currencies in their calculations than the instruments they simulate trades on. Programmers can specify a strategy’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.account_currency">account currency</a> by including a <code dir="auto">currency.*</code> variable as the <code dir="auto">currency</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement. The default value is <a href="https://www.tradingview.com/pine-script-reference/v5/#const_currency.NONE">currency.NONE</a>, meaning the strategy uses the same currency as the current chart (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a>). Script users can change the account currency using the “Base currency” input in the script’s “Settings/Properties” tab.</p>
<p>When a strategy script uses an account currency that differs from the chart’s currency, it uses the <em>previous daily value</em> of a corresponding currency pair from the most popular exchange to determine the conversion rate. If no exchange provides the rate directly, it derives the rate using a <a href="https://www.tradingview.com/support/solutions/43000502298-spread-charts/">spread symbol</a>. The strategy multiplies all monetary values, including simulated profits/losses, by the determined cross rate to express them in the account currency. To retrieve the rate that a strategy uses to convert monetary values, call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a> with <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a> as the <code dir="auto">from</code> argument and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.account_currency">strategy.account_currency</a> as the <code dir="auto">to</code> argument.</p>
<p>Note that:</p>
<ul>
<li>Programmers can directly convert values expressed in a strategy’s account currency to the chart’s currency and vice versa via the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.convert_to_symbol">strategy.convert_to_symbol()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.convert_to_account">strategy.convert_to_account()</a> functions.</li>
</ul>
<p>The following example demonstrates how currency conversion affects a strategy’s monetary values and how a strategy’s cross-rate calculations match those that <code dir="auto">request.*()</code> functions use.</p>
<p>On each of the latest 500 bars, the strategy places an entry order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a>, and it places a <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">take-profit</a> and <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> order one tick away from the entry price with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a>. The size of each entry order is <code dir="auto">1.0 / syminfo.mintick</code>, rounded to the nearest tick, which means that the profit/loss of each closed trade is equal to <em>one point</em> in the chart’s <em>quote currency</em>. We specified <a href="https://www.tradingview.com/pine-script-reference/v5/#const_currency.EUR">currency.EUR</a> as the account currency in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, meaning the strategy multiplies all monetary values by a cross rate to express them in Euros.</p>
<p>The script calculates the absolute change in the ratio of the strategy’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.netprofit">net profit</a> to the symbol’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.pointvalue">point value</a> to determine the value of <em>one unit</em> of the chart’s currency in Euros. It plots this value alongside the result from a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a> call that uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.currency">syminfo.currency</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.account_currency">strategy.account_currency</a> as the <code dir="auto">from</code> and <code dir="auto">to</code> arguments. As we see below, both plots align, confirming that strategies and <code dir="auto">request.*()</code> functions use the <em>same</em> daily cross-rate calculations:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="718" loading="lazy" src="images/f11475302c03183f3b09755779a47ab1.webp" width="1820"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Currency Test", currency = currency.EUR)

if last_bar_index - bar_index &lt; 500
    // Place an entry order with a size that results in a P/L of `syminfo.pointvalue` units of chart currency per tick. 
    strategy.entry("LE", strategy.long, math.round_to_mintick(1.0 / syminfo.mintick))
    // Place exit orders one tick above and below the "LE" entry price, 
    // meaning each trade closes with one point of profit or loss in the chart's currency.
    strategy.exit("LX", "LE", profit = 1, loss = 1)

// Plot the absolute change in `strategy.netprofit / syminfo.pointvalue`, which represents 1 chart unit of profit/loss. 
plot(
     math.abs(ta.change(strategy.netprofit / syminfo.pointvalue)), "1 chart unit of profit/loss in EUR", 
     color = color.fuchsia, linewidth = 4
 )
// Plot the requested currency rate.
plot(request.currency_rate(syminfo.currency, strategy.account_currency), "Requested conversion rate", color.lime)</code></div>
<p>Note that:</p>
<ul>
<li>When a strategy executes on a chart with a timeframe higher than “1D”, it uses the data from <em>one day before</em> each <em>historical</em> bar’s closing time for its cross-rate calculations. For example, on a “1W” chart, the strategy bases its cross rate on the previous Thursday’s closing values. However, it still uses the latest confirmed daily rate on <em>realtime</em> bars.</li>
</ul>
<h2 class="md-heading" id="altering-calculation-behavior"><a href="#altering-calculation-behavior">Altering calculation behavior<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Strategy scripts execute across all available historical chart bars and continue to execute on realtime bars as new data comes in. However, by default, strategies only recalculate their values after a bar <em>closes</em>, even on realtime bars, and the earliest point that the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills the orders a strategy places on the close one bar is at the <em>open</em> of the following bar.</p>
<p>Users can change these behaviors with the <code dir="auto">calc_on_every_tick</code>, <code dir="auto">calc_on_order_fills</code>, and <code dir="auto">process_orders_on_close</code> parameters of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement or the corresponding inputs in the “Recalculate” and “Fill orders” sections of the script’s “Settings/Properties” tab. The sections below explain how these settings affect a strategy’s calculations.</p>
<h3 class="md-heading" id="calc_on_every_tick"><a href="#calc_on_every_tick">`calc_on_every_tick`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">calc_on_every_tick</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function determines the frequency of a strategy’s calculations on <em>realtime bars</em>. When this parameter’s value is <code dir="auto">true</code>, the script recalculates on each <em>new tick</em> in the realtime data feed. Its default value is <code dir="auto">false</code>, meaning the script only executes on a realtime bar after it closes. Users can also toggle this recalculation behavior with the “On every tick” input in the script’s “Settings/Properties” tab.</p>
<p>Enabling this setting can be useful in forward testing because it allows a strategy to use realtime price updates in its calculations. However, it <em>does not</em> affect the calculations on historical bars because historical data feeds <em>do not</em> contain complete tick data: the broker emulator considers each historical bar to have only four ticks (open, high, low, and close). Therefore, users should exercise caution and understand the limitations of this setting. If enabling calculation on every tick causes a strategy to behave <em>differently</em> on historical and realtime bars, the strategy will <strong><a href="/pine-script-docs/v5/concepts/repainting/">repaint</a></strong> after the user reloads it.</p>
<p>The following example demonstrates how recalculation on every tick can cause strategy repainting. The script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> calls to place a long entry order each time the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> reaches its <code dir="auto">highest</code> value and a short entry order each time the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> reaches its <code dir="auto">lowest</code> value. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement includes <code dir="auto">calc_on_every_tick = true</code>, meaning that on realtime bars, it can recalculate and place orders on new price updates <em>before</em> a bar closes:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Donchian Channel Break", overlay = true, calc_on_every_tick = true, pyramiding = 20)

int length = input.int(15, "Length")

float highest = ta.highest(close, length)
float lowest  = ta.lowest(close, length)

if close == highest
    strategy.entry("Buy", strategy.long)
if close == lowest
    strategy.entry("Sell", strategy.short)

// Highlight the background of realtime bars.
bgcolor(barstate.isrealtime ? color.new(color.orange, 80) : na)

plot(highest, "Highest", color = color.lime)
plot(lowest, "Lowest", color = color.red)</code></div>
<p>Note that:</p>
<ul>
<li>The script uses a <a href="/pine-script-docs/v5/concepts/strategies/#pyramiding">pyramiding</a> value of 20, allowing it to simulate up to 20 entries per position with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> command.</li>
<li>The script highlights the chart’s background orange when <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">barstate.isrealtime</a> is <code dir="auto">true</code> to indicate realtime bars.</li>
</ul>
<p>After applying the script to our chart and letting it run on several realtime bars, we see the following output:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="842" loading="lazy" src="images/0a25921cf5195e690ab6238794c040c9.webp" width="1820"/></div></p>
<p>The script placed a “Buy” order on <em>each tick</em> where the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> was at the <code dir="auto">highest</code> value, which happened <em>more than once</em> on each realtime bar. Additionally, the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> filled each <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> at the current realtime price rather than strictly at the open of the following chart bar.</p>
<p>After we reload the chart, we see that the strategy <em>changed</em> its behavior and <em>repainted</em> its results on those bars. This time, the strategy placed only <em>one</em> “Buy” order for each <em>closed bar</em> where the condition was valid, and the broker emulator filled each order at the open of the following bar. It did not generate multiple entries per bar because what were previously realtime bars became <em>historical</em> bars, which <strong>do not</strong> hold complete tick data:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="842" loading="lazy" src="images/5ffa9470e7b34ad80639ecba6a277697.webp" width="1820"/></div></p>
<h3 class="md-heading" id="calc_on_order_fills"><a href="#calc_on_order_fills">`calc_on_order_fills`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">calc_on_order_fills</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function enables a strategy to recalculate immediately after an <em>order fills</em>, allowing it to use more granular information and place additional orders without waiting for a bar to close. Its default value is <code dir="auto">false</code>, meaning the strategy does not allow recalculation immediately after every order fill. Users can also toggle this behavior with the “After order is filled” input in the script’s “Settings/Properties” tab.</p>
<p>Enabling this setting can provide a strategy script with additional data that would otherwise not be available until after a bar closes, such as the current average price of a simulated position on an open bar.</p>
<p>The example below shows a simple strategy that creates a “Buy” order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> whenever the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a> is 0. The script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_avg_price">strategy.position_avg_price</a> to calculate price levels for the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> call’s stop-loss and take-profit orders that close the position.</p>
<p>We’ve included <code dir="auto">calc_on_order_fills = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, meaning that the strategy recalculates each time the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills a “Buy” or “Exit” order. Each time an “Exit” order fills, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a> reverts to 0, triggering a new “Buy” order. The broker emulator fills the “Buy” order on the next tick at one of the bar’s OHLC values, and then the strategy uses the recalculated <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_avg_price">strategy.position_avg_price</a> value to determine new “Exit” order prices:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="842" loading="lazy" src="images/748c5757da5115ee61430198a1507f37.webp" width="1820"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Intrabar exit", overlay = true, calc_on_order_fills = true)

float stopSize   = input.float(5.0, "SL %", minval = 0.0) / 100.0
float profitSize = input.float(5.0, "TP %", minval = 0.0) / 100.0

if strategy.position_size == 0.0
    strategy.entry("Buy", strategy.long)

float stopLoss   = strategy.position_avg_price * (1.0 - stopSize)
float takeProfit = strategy.position_avg_price * (1.0 + profitSize)

strategy.exit("Exit", stop = stopLoss, limit = takeProfit)</code></div>
<p>Note that:</p>
<ul>
<li>Without enabling recalculation on order fills, this strategy would not place new orders <em>before</em> a bar closes. After an exit, the strategy would wait for the bar to close before placing a new “Buy” order, which the broker emulator would fill on the <em>next tick</em> after that, i.e., the open of the following bar.</li>
</ul>
<p>It’s important to note that enabling <code dir="auto">calc_on_order_fills</code> can produce unrealistic strategy results in some cases because the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> may assume order-fill prices that are <em>not</em> obtainable in real-world trading. Therefore, users should exercise caution and carefully examine their strategy logic when allowing recalculation on order fills.</p>
<p>For example, the following script places a “Buy” order after each new order fill and bar close over the most recent 25 historical bars. The strategy simulates <em>four</em> entries per bar because the broker emulator considers each historical bar to have <em>four ticks</em> (open, high, low, and close). This behavior is unrealistic because it is not typically possible to fill an order at a bar’s <em>exact</em> high or low price:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="506" loading="lazy" src="images/e1ca391441a7a77e16c561e3807864db.webp" width="1818"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("buy on every fill", overlay = true, calc_on_order_fills = true, pyramiding = 100)

if last_bar_index - bar_index &lt;= 25
    strategy.entry("Buy", strategy.long)</code></div>
<h3 class="md-heading" id="process_orders_on_close"><a href="#process_orders_on_close">`process_orders_on_close`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>By default, strategies simulate orders at the close of each bar, meaning that the earliest opportunity to fill the orders and execute strategy calculations and alerts is on the opening of the following bar. Programmers can change this behavior to process orders on the <em>closing tick</em> of each bar by setting <code dir="auto">process_orders_on_close</code> to <code dir="auto">true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement. Users can set this behavior by changing the “Fill Orders/On Bar Close” setting in the “Settings/Properties” tab.</p>
<p>This behavior is most useful when backtesting manual strategies in which traders exit from a position before a bar closes, or in scenarios where algorithmic traders in non-24x7 markets set up after-hours trading capability so that alerts sent after close still have hope of filling before the following day.</p>
<p>Note that:</p>
<ul>
<li>Using strategies with <code dir="auto">process_orders_on_close</code> enabled to send alerts to a third-party service might cause unintended results. Alerts on the close of a bar still occur after the market closes, and real-world orders based on such alerts might not fill until after the market opens again.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a> commands feature an <code dir="auto">immediately</code> parameter that, if <code dir="auto">true</code>, allows the resulting market order to fill on the same tick where the strategy created it. This parameter provides an alternative way for programmers to selectively apply <code dir="auto">process_orders_on_close</code> behavior to closing market orders without affecting the behavior of other order placement commands.</li>
</ul>
<h2 class="md-heading" id="simulating-trading-costs"><a href="#simulating-trading-costs">Simulating trading costs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Strategy performance reports are more relevant and meaningful when they include potential real-world trading costs. Without modeling the potential costs associated with their trades, traders may overestimate a strategy’s historical profitability, potentially leading to suboptimal decisions in live trading. Pine Script™ strategies include inputs and parameters for simulating trading costs in performance results.</p>
<h3 class="md-heading" id="commission"><a href="#commission">Commission<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Commission is the fee a broker/exchange charges when executing trades. Commission can be a flat fee per trade or contract/share/lot/unit, or a percentage of the total transaction value. Users can set the commission properties of their strategies by including <code dir="auto">commission_type</code> and <code dir="auto">commission_value</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function, or by setting the “Commission” inputs in the “Properties” tab of the strategy settings.</p>
<p>The following script is a simple strategy that simulates a “Long” position of 2% of equity when <code dir="auto">close</code> equals the <code dir="auto">highest</code> value over the <code dir="auto">length</code>, and closes the trade when it equals the <code dir="auto">lowest</code> value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="726" loading="lazy" src="images/bbaf3349cf79512ae37b45d248836362.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy("Commission Demo", overlay=true, default_qty_value = 2, default_qty_type = strategy.percent_of_equity)

length = input.int(10, "Length")

float highest = ta.highest(close, length)
float lowest  = ta.lowest(close, length)

switch close
    highest =&gt; strategy.entry("Long", strategy.long)
    lowest  =&gt; strategy.close("Long")

plot(highest, color = color.new(color.lime, 50))
plot(lowest, color = color.new(color.red, 50))</code></div>
<p>The results in the <a href="/pine-script-docs/v5/concepts/strategies/#strategy-tester">Strategy Tester</a> show that the strategy had a positive equity growth of 17.61% over the testing range. However, the backtest results do not account for fees the broker/exchange may charge. Let’s see what happens to these results when we include a small commission on every trade in the strategy simulation. In this example, we’ve included <code dir="auto">commission_type = strategy.commission.percent</code> and <code dir="auto">commission_value = 1</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration, meaning it will simulate a commission of 1% on all executed orders:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="726" loading="lazy" src="images/8fe2156f113bca238b4b498c3a2c9299.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Commission Demo", overlay=true, default_qty_value = 2, default_qty_type = strategy.percent_of_equity,
     commission_type = strategy.commission.percent, commission_value = 1
 )

length = input.int(10, "Length")

float highest = ta.highest(close, length)
float lowest  = ta.lowest(close, length)

switch close
    highest =&gt; strategy.entry("Long", strategy.long)
    lowest  =&gt; strategy.close("Long")

plot(highest, color = color.new(color.lime, 50))
plot(lowest, color = color.new(color.red, 50))</code></div>
<p>As we can see in the example above, after applying a 1% commission to the backtest, the strategy simulated a significantly reduced net profit of only 1.42% and a more volatile equity curve with an elevated max drawdown. These results highlight the impact that commission can have on a strategy’s hypothetical performance.</p>
<h3 class="md-heading" id="slippage-and-unfilled-limits"><a href="#slippage-and-unfilled-limits">Slippage and unfilled limits<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>In real-life trading, a broker/exchange may fill orders at slightly different prices than a trader intended, due to volatility, liquidity, order size, and other market factors, which can profoundly impact a strategy’s performance. The disparity between expected prices and the actual prices at which the broker/exchange executes trades is what we refer to as <em>slippage</em>. Slippage is dynamic and unpredictable, making it impossible to simulate precisely. However, factoring in a small amount of slippage on each trade during a backtest or forward test might help the results better align with reality. Users can model slippage in their strategy results, sized as a fixed number of <em>ticks</em>, by including a <code dir="auto">slippage</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement or by setting the “Slippage” input in the “Settings/Properties” tab.</p>
<p>The following example demonstrates how simulating slippage affects the fill prices of <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a> in a strategy test. The script below places a “Buy” market order of 2% equity when the market price is above a rising EMA and closes the position when the price dips below the EMA while it’s falling. We’ve included <code dir="auto">slippage = 20</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function, which declares that the price of each simulated order will slip 20 ticks in the direction of the trade.</p>
<p>The script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_bar_index">strategy.opentrades.entry_bar_index()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_bar_index">strategy.closedtrades.exit_bar_index()</a> to get the <code dir="auto">entryIndex</code> and <code dir="auto">exitIndex</code>, which it uses to obtain the <code dir="auto">fillPrice</code> of the order. When the bar index is at the <code dir="auto">entryIndex</code>, the <code dir="auto">fillPrice</code> is the first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dopentrades%7Bdot%7Dentry_price">strategy.opentrades.entry_price()</a> value. At the <code dir="auto">exitIndex</code>, <code dir="auto">fillPrice</code> is the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dclosedtrades%7Bdot%7Dexit_price">strategy.closedtrades.exit_price()</a> value from the last closed trade. The script plots the expected fill price along with the simulated fill price after slippage to visually compare the difference:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/7b7bbd5da6fa24a94ba25512b005582d.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Slippage Demo", overlay = true, slippage = 20,
     default_qty_value = 2, default_qty_type = strategy.percent_of_equity
 )

int length = input.int(5, "Length")

//@variable Exponential moving average with an input `length`.
float ma = ta.ema(close, length)

//@variable Is `true` when `ma` has increased and `close` is above it, `false` otherwise.
bool longCondition = close &gt; ma and ma &gt; ma[1]
//@variable Is `true` when `ma` has decreased and `close` is below it, `false` otherwise.
bool shortCondition = close &lt; ma and ma &lt; ma[1]

// Enter a long market position on `longCondition` and close the position on `shortCondition`. 
if longCondition    
    strategy.entry("Buy", strategy.long)
if shortCondition
    strategy.close("Buy")

//@variable The `bar_index` of the position's entry order fill.
int entryIndex = strategy.opentrades.entry_bar_index(0)
//@variable The `bar_index` of the position's close order fill.
int exitIndex  = strategy.closedtrades.exit_bar_index(strategy.closedtrades - 1)

//@variable The fill price simulated by the strategy.
float fillPrice = switch bar_index
    entryIndex =&gt; strategy.opentrades.entry_price(0)
    exitIndex  =&gt; strategy.closedtrades.exit_price(strategy.closedtrades - 1)

//@variable The expected fill price of the open market position.
float expectedPrice = fillPrice ? open : na

color expectedColor = na
color filledColor   = na

if bar_index == entryIndex
    expectedColor := color.green
    filledColor   := color.blue
else if bar_index == exitIndex
    expectedColor := color.red
    filledColor   := color.fuchsia

plot(ma, color = color.new(color.orange, 50))

plotchar(fillPrice ? open : na, "Expected fill price", "—", location.absolute, expectedColor)
plotchar(fillPrice, "Fill price after slippage", "—", location.absolute, filledColor)</code></div>
<p>Note that:</p>
<ul>
<li>Since the strategy applies constant slippage to all order fills, some orders can fill <em>outside</em> the candle range in the simulation. Exercise caution with this setting, as adding excessive simulated slippage can produce unrealistically worse testing results.</li>
</ul>
<p>Some traders might assume that they can avoid the adverse effects of slippage by using <a href="/pine-script-docs/v5/concepts/strategies/#limit-orders">limit orders</a>, as unlike <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market orders</a>, they cannot execute at a worse price than the specified value. However, even if the market price reaches an order’s price, there’s a chance that a limit order might not fill, depending on the state of the real-life market, because limit orders can only fill if a security has sufficient liquidity and price action around their values. To account for the possibility of <em>unfilled</em> orders in a backtest, users can specify the <code dir="auto">backtest_fill_limits_assumption</code> value in the declaration statement or use the “Verify price for limit orders” input in the “Settings/Properties” tab. This setting instructs the strategy to fill limit orders only after the market price moves a defined number of ticks past the order prices.</p>
<p>The following example places a limit order of 2% equity at a bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlcc4">hlcc4</a> price when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> is the <code dir="auto">highest</code> value over the past <code dir="auto">length</code> bars and there are no pending entries. The strategy closes the market position and cancels all orders after the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> is the <code dir="auto">lowest</code> value. Each time the strategy triggers an order, it draws a horizontal line at the <code dir="auto">limitPrice</code>, which it updates on each bar until closing the position or canceling the order:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/d96e3aa863fb01e0bacbb0f97a161e5e.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Verify price for limits example", overlay = true,
     default_qty_type = strategy.percent_of_equity, default_qty_value = 2
 )

int length = input.int(25, title = "Length")

//@variable Draws a line at the limit price of the most recent entry order.
var line limitLine = na

// Highest high and lowest low
highest = ta.highest(length)
lowest  = ta.lowest(length)

// Place an entry order and draw a new line when the the `high` equals the `highest` value and `limitLine` is `na`.
if high == highest and na(limitLine)
    float limitPrice = hlcc4
    strategy.entry("Long", strategy.long, limit = limitPrice)
    limitLine := line.new(bar_index, limitPrice, bar_index + 1, limitPrice)

// Close the open market position, cancel orders, and set `limitLine` to `na` when the `low` equals the `lowest` value.
if low == lowest
    strategy.cancel_all()
    limitLine := na
    strategy.close_all()

// Update the `x2` value of `limitLine` if it isn't `na`.
if not na(limitLine)
    limitLine.set_x2(bar_index + 1) 

plot(highest, "Highest High", color = color.new(color.green, 50))
plot(lowest, "Lowest Low", color = color.new(color.red, 50))</code></div>
<p>By default, the script assumes that all limit orders are guaranteed to fill when the market price reaches their values, which is often not the case in real-life trading. Let’s add price verification to our limit orders to account for potentially unfilled ones. In this example, we’ve included <code dir="auto">backtest_fill_limits_assumption = 3</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> function call. As we can see, using limit verification omits some simulated order fills and changes the times of others, because the entry orders can now only fill after the price exceeds the limit price by <em>three ticks</em>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="680" loading="lazy" src="images/63e6c1c2df3e8b05c93c88ba4a3295a4.webp" width="1342"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Limit verification can change the <em>times</em> of some order fills. However, strategies still execute verified limit orders at the same <em>prices</em>. This “time-warping” effect is a compromise that preserves the prices of limit orders, but it can cause a strategy to fill the orders at times that wouldn’t necessarily be possible in the real world. Therefore, users should exercise caution with this setting and understand its limitations when analyzing strategy results.</p></div></aside>
<h2 class="md-heading" id="risk-management"><a href="#risk-management">Risk management<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Designing a strategy that performs well, especially in a broad class of markets, is a challenging task. Most strategies are designed for specific market patterns/conditions and can produce uncontrolled losses when applied to other data. Therefore, a strategy’s risk management behavior can be critical to its performance. Programmers can set risk management criteria in their strategy scripts using the <code dir="auto">strategy.risk.*()</code> commands.</p>
<p>Strategies can incorporate any number of risk management criteria in any combination. All risk management commands execute <em>on every tick and order execution event</em>, regardless of any changes to the strategy’s calculation behavior. There is no way to deactivate any of these commands on specific script executions. Irrespective of a risk management command’s location, it <em>always</em> applies to the strategy unless the programmer removes the call from the code.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dallow_entry_in">strategy.risk.allow_entry_in()</a></p>
<p class="spacer-wrapper"><spacer/>This command overrides the market direction allowed for all <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a> commands in the script. When a user specifies the trade direction with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dallow_entry_in">strategy.risk.allow_entry_in()</a> function (e.g., <a href="https://www.tradingview.com/pine-script-reference/v5/#const_strategy.direction.long">long</a>) the strategy enters trades only in that direction. If a script calls an entry command in the opposite direction while there’s an open market position, the strategy simulates a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> to <em>close</em> the position.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_cons_loss_days">strategy.risk.max_cons_loss_days()</a></p>
<p class="spacer-wrapper"><spacer/>This command cancels all pending orders, closes any open market position, and stops all additional trade actions after the strategy simulates a defined number of trading days with consecutive losses.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_drawdown">strategy.risk.max_drawdown()</a></p>
<p class="spacer-wrapper"><spacer/>This command cancels all pending orders, closes any open market position, and stops all additional trade actions after the strategy’s drawdown reaches the amount specified in the function call.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_intraday_filled_orders">strategy.risk.max_intraday_filled_orders()</a></p>
<p class="spacer-wrapper"><spacer/>This command specifies the maximum number of filled orders per trading day (or per chart bar if the timeframe is higher than daily). If the strategy creates more orders than  the maximum, the command cancels all pending orders, closes any open market position, and halts trading activity until the end of the current session.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_intraday_loss">strategy.risk.max_intraday_loss()</a></p>
<p class="spacer-wrapper"><spacer/>This command controls the maximum loss the strategy tolerates per trading day (or per chart bar if the timeframe is higher than daily). When the strategy’s losses reach this threshold, it cancels all pending orders, closes the open market position, and stops all trading activity until the end of the current session.</p>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Drisk%7Bdot%7Dmax_position_size">strategy.risk.max_position_size()</a></p>
<p class="spacer-wrapper"><spacer/>This command specifies the maximum possible position size when using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy%7Bdot%7Dentry">strategy.entry()</a> commands. If the quantity of an entry command results in a market position that exceeds this threshold, the strategy reduces the order quantity so that the resulting position does not exceed the limit.</p>
<h2 class="md-heading" id="margin"><a href="#margin">Margin<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Margin</em> is the minimum percentage of a market position that a trader must hold in their account as collateral to receive and sustain a loan from their broker to achieve their desired <em>leverage</em>. The <code dir="auto">margin_long</code> and <code dir="auto">margin_short</code> parameters of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement and the “Margin for long/short positions” inputs in the “Properties” tab of the script settings specify margin percentages for long and short positions. For example, if a trader sets the margin for long positions to 25%, they must have enough funds to cover 25% of an open long position. This margin percentage also means the trader can potentially spend up to 400% of their equity on their trades.</p>
<p>If a strategy’s simulated funds cannot cover the losses from a margin trade, the broker emulator triggers a <em>margin call</em>, which forcibly liquidates all or part of the open position. The exact number of contracts/shares/lots/units that the emulator liquidates is <em>four times</em> the amount required to cover the loss, which helps prevent constant margin calls on subsequent bars. The emulator determines liquidated quantity using the following algorithm:</p>
<ol>
<li>Calculate the amount of capital spent on the position: <code dir="auto">Money Spent = Quantity * Entry Price</code></li>
<li>Calculate the Market Value of Security (MVS): <code dir="auto">MVS = Position Size * Current Price</code></li>
<li>Calculate the Open Profit as the difference between <code dir="auto">MVS</code> and <code dir="auto">Money Spent</code>. If the position is short, multiply this value by -1.</li>
<li>Calculate the strategy’s equity value: <code dir="auto">Equity = Initial Capital + Net Profit + Open Profit</code></li>
<li>Calculate the margin ratio: <code dir="auto">Margin Ratio = Margin Percent / 100</code></li>
<li>Calculate the margin value, which is the cash required to cover the hypothetical account’s portion of the position: <code dir="auto">Margin = MVS * Margin Ratio</code></li>
<li>Calculate the strategy’s available funds: <code dir="auto">Available Funds = Equity - Margin</code></li>
<li>Calculate the total amount of money lost: <code dir="auto">Loss = Available Funds / Margin Ratio</code></li>
<li>Calculate the number of contracts/shares/lots/units the account must liquidate to cover the loss, truncated to the same decimal precision as the minimum position size for the current symbol: <code dir="auto">Cover Amount = TRUNCATE(Loss / Current Price).</code></li>
<li>Multiply the quantity required to cover the loss by four to determine the margin call size: <code dir="auto">Margin Call Size = Cover Amount * 4</code></li>
</ol>
<p>To examine this calculation in detail, let’s add the built-in Supertrend Strategy to the NASDAQ:TSLA
 chart on the “1D” timeframe and set the “Order size” to 300% of equity and the “Margin for long positions” to 25% in the “Properties” tab of the strategy settings:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1200" loading="lazy" src="images/9aa5b3ab7fe466d644dc49271b2f6bc6.webp" width="2356"/></div></p>
<p>The first entry happened at the bar’s opening price on 16 Sep 2010. The strategy bought 682,438 shares (Position Size) at 4.43 USD (Entry Price). Then, on 23 Sep 2010, when the price dipped to 3.9 (Current Price), the emulator forcibly liquidated 111,052 shares with a margin call. The calculations below show how the broker emulator determined this amount for the margin call event:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Money spent: 682438 * 4.43 = 3023200.34</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">MVS: 682438 * 3.9 = 2661508.2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Open Profit: −361692.14</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Equity: 1000000 + 0 − 361692.14 = 638307.86</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin Ratio: 25 / 100 = 0.25</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin: 2661508.2 * 0.25 = 665377.05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Available Funds: 638307.86 - 665377.05 = -27069.19</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Money Lost: -27069.19 / 0.25 = -108276.76</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Cover Amount: TRUNCATE(-108276.76 / 3.9) = TRUNCATE(-27763.27) = -27763</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Margin Call Size: -27763 * 4 = - 111052</span></div></div></code></pre></figure></link></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.margin_liquidation_price">strategy.margin_liquidation_price</a> variable’s value represents the price level that will cause a margin call if the market price reaches it. For more information about how margin works and the formula for calculating a position’s margin call price, see <a href="https://www.tradingview.com/support/solutions/43000717375-how-do-i-simulate-trading-with-leverage/">this page</a> in our Help Center.</li>
</ul>
<h2 class="md-heading" id="using-strategy-information-in-scripts"><a href="#using-strategy-information-in-scripts">Using strategy information in scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Numerous built-ins within the <code dir="auto">strategy.*</code> namespace and its <em>sub-namespaces</em> provide convenient solutions for programmers to use a strategy’s trade and performance information, including data shown in the <a href="/pine-script-docs/v5/concepts/strategies/#strategy-tester">Strategy Tester</a>, directly within their code’s logic and calculations.</p>
<p>Several <code dir="auto">strategy.*</code> variables hold fundamental information about a strategy, including its starting capital, equity, profits and losses, run-up and drawdown, and open position:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.account_currency">strategy.account_currency</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.initial_capital">strategy.initial_capital</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.equity">strategy.equity</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.netprofit">strategy.netprofit</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.netprofit_percent">strategy.netprofit_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossprofit">strategy.grossprofit</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossprofit_percent">strategy.grossprofit_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossloss">strategy.grossloss</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossloss_percent">strategy.grossloss_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.openprofit">strategy.openprofit</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.openprofit_percent">strategy.openprofit_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_runup">strategy.max_runup</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_runup_percent">strategy.max_runup_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_drawdown">strategy.max_drawdown</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_drawdown_percent">strategy.max_drawdown_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_size">strategy.position_size</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_avg_price">strategy.position_avg_price</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_entry_name">strategy.position_entry_name</a></li>
</ul>
<p>Additionally, the namespace features multiple variables that hold general trade information, such as the number of open and closed trades, the number of winning and losing trades, average trade profits, and maximum trade sizes:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades">strategy.opentrades</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.closedtrades">strategy.closedtrades</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.wintrades">strategy.wintrades</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.losstrades">strategy.losstrades</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.eventrades">strategy.eventrades</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_trade">strategy.avg_trade</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_trade_percent">strategy.avg_trade_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_winning_trade">strategy.avg_winning_trade</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_winning_trade_percent">strategy.avg_winning_trade_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_losing_trade">strategy.avg_losing_trade</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_losing_trade_percent">strategy.avg_losing_trade_percent</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_contracts_held_all">strategy.max_contracts_held_all</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_contracts_held_long">strategy.max_contracts_held_long</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.max_contracts_held_short">strategy.max_contracts_held_short</a></li>
</ul>
<p>Programmers can use these variables to display relevant strategy information on their charts, create customized trading logic based on strategy data, calculate custom performance metrics, and more.</p>
<p>The following example demonstrates a few simple use cases for these <code dir="auto">strategy.*</code> variables. The script uses them in its order placement and display calculations. When the calculated <code dir="auto">rank</code> crosses above 10 and the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades">strategy.opentrades</a> value is 0, the script calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> to place a “Buy” <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a>. On the following bar, where that order fills, it calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> to create a <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> order at a user-specified percentage below the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_avg_price">strategy.position_avg_price</a>. If the <code dir="auto">rank</code> crosses above 80 during the open trade, the script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close">strategy.close()</a> to exit the position on the next bar.</p>
<p>The script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the main chart pane displaying formatted strings containing the strategy’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.netprofit">net profit</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.netprofit_percent">net profit percentage</a>, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.account_currency">account currency</a>, the number of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.wintrades">winning trades</a> and the win percentage, the ratio of the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_winning_trade">average profit</a> to the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.avg_losing_trade">average loss</a>, and the profit factor (the ratio of the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossprofit">gross profit</a> to the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.grossloss">gross loss</a>). It also plots the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.equity">total equity</a> in a separate pane and highlights the pane’s background based on the strategy’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.openprofit">open profit</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/20cc2b755cd6211b3978fd43d93aeebf.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Using strategy information demo", default_qty_type = strategy.percent_of_equity, default_qty_value = 5, 
     margin_long = 100, margin_short = 100
 )

//@variable The number of bars in the `rank` calculation.
int lengthInput = input.int(50, "Length", 1)
//@variable The stop-loss percentage.
float slPercentInput = input.float(4.0, "SL %", 0.0, 100.0) / 100.0

//@variable The percent rank of `close` prices over `lengthInput` bars.
float rank = ta.percentrank(close, lengthInput)
// Entry and exit signals.  
bool entrySignal = ta.crossover(rank, 10) and strategy.opentrades == 0
bool exitSignal  = ta.crossover(rank, 80) and strategy.opentrades == 1

// Place orders based on the `entrySignal` and `exitSignal` occurrences. 
switch
    entrySignal    =&gt; strategy.entry("Buy", strategy.long)
    entrySignal[1] =&gt; strategy.exit("SL", "Buy", stop = strategy.position_avg_price * (1.0 - slPercentInput))
    exitSignal     =&gt; strategy.close("Buy")

if barstate.islastconfirmedhistory or barstate.isrealtime
    //@variable A table displaying strategy information on the main chart pane. 
    var table dashboard = table.new(
         position.top_right, 2, 10, border_color = chart.fg_color, border_width = 1, force_overlay = true
     )
    //@variable The strategy's currency.
    string currency = strategy.account_currency
    // Display the net profit as a currency amount and percentage.
    dashboard.cell(0, 1, "Net P/L")
    dashboard.cell(
         1, 1, str.format("{0, number, 0.00} {1} ({2}%)", strategy.netprofit, currency, strategy.netprofit_percent), 
         text_color = chart.fg_color, bgcolor = strategy.netprofit &gt; 0 ? color.lime : color.red
     )
    // Display the number of winning trades as an absolute value and percentage of all completed trades. 
    dashboard.cell(0, 2, "Winning trades")
    dashboard.cell(
         1, 2, str.format("{0} ({1, number, #.##%})", strategy.wintrades, strategy.wintrades / strategy.closedtrades), 
         text_color = chart.fg_color, bgcolor = strategy.wintrades &gt; strategy.losstrades ? color.lime : color.red
     )
    // Display the ratio of average trade profit to average trade loss. 
    dashboard.cell(0, 3, "Avg. win / Avg. loss")
    dashboard.cell(
         1, 3, str.format("{0, number, #.###}", strategy.avg_winning_trade / strategy.avg_losing_trade), 
         text_color = chart.fg_color, 
         bgcolor = strategy.avg_winning_trade &gt; strategy.avg_losing_trade ? color.lime : color.red
     )
    // Display the profit factor, i.e., the ratio of gross profit to gross loss. 
    dashboard.cell(0, 4, "Profit factor")
    dashboard.cell(
         1, 4, str.format("{0, number, #.###}", strategy.grossprofit / strategy.grossloss), text_color = chart.fg_color, 
         bgcolor = strategy.grossprofit &gt; strategy.grossloss ? color.lime : color.red
     )

// Plot the current equity in a separate pane and highlight the pane's background while there is an open position.
plot(strategy.equity, "Total equity", strategy.equity &gt; strategy.initial_capital ? color.teal : color.maroon, 3)
bgcolor(
     strategy.openprofit &gt; 0 ? color.new(color.teal, 80) : strategy.openprofit &lt; 0 ? color.new(color.maroon, 80) : na, 
     title = "Open position highlight"
 )</code></div>
<p>Note that:</p>
<ul>
<li>This script creates a <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> order one bar after the entry order because it uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.position_avg_price">strategy.position_avg_price</a> to determine the price level. This variable has a non-na value only when the strategy has an <em>open position</em>.</li>
<li>The script only draws the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the last historical bar and all realtime bars because the historical states of <a href="/pine-script-docs/v5/concepts/tables/">tables</a> are <strong>never visible</strong>. See the <a href="/pine-script-docs/v5/writing/profiling-and-optimization/#reducing-drawing-updates">Reducing drawing updates</a> section of the <a href="/pine-script-docs/v5/writing/profiling-and-optimization/">Profiling and optimization</a> page for more information.</li>
<li>We included <code dir="auto">force_overlay = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.new">table.new()</a> call to display the table on the main chart pane.</li>
</ul>
<h3 class="md-heading" id="individual-trade-information"><a href="#individual-trade-information">Individual trade information<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">strategy.*</code> namespace features two sub-namespaces that provide access to <em>individual trade</em> information: <code dir="auto">strategy.opentrades.*</code> and <code dir="auto">strategy.closedtrades.*</code>. The <code dir="auto">strategy.opentrades.*</code> built-ins return data for <em>incomplete</em> (open) trades, and the <code dir="auto">strategy.closedtrades.*</code> built-ins return data for <em>completed</em> (closed) trades. With these built-ins, programmers can use granular trade data in their scripts, allowing for more detailed strategy analysis and advanced calculations.</p>
<p>Both sub-namespaces contain several similar functions that return information about a trade’s orders, simulated costs, and profit/loss, including:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_id">strategy.opentrades.entry_id()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_id">strategy.closedtrades.entry_id()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_price">strategy.opentrades.entry_price()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_price">strategy.closedtrades.entry_price()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_bar_index">strategy.opentrades.entry_bar_index()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_bar_index">strategy.closedtrades.entry_bar_index()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_time">strategy.opentrades.entry_time()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_time">strategy.closedtrades.entry_time()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.entry_comment">strategy.opentrades.entry_comment()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_comment">strategy.closedtrades.entry_comment()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.size">strategy.opentrades.size()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.size">strategy.closedtrades.size()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.profit">strategy.opentrades.profit()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.profit">strategy.closedtrades.profit()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.profit_percent">strategy.opentrades.profit_percent()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.profit_percent">strategy.closedtrades.profit_percent()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.commission">strategy.opentrades.commission()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.commission">strategy.closedtrades.commission()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.max_runup">strategy.opentrades.max_runup()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.max_runup">strategy.closedtrades.max_runup()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.max_runup_percent">strategy.opentrades.max_runup_percent()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.max_runup_percent">strategy.closedtrades.max_runup_percent()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.max_drawdown">strategy.opentrades.max_drawdown()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.max_drawdown">strategy.closedtrades.max_drawdown()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.opentrades.max_drawdown_percent">strategy.opentrades.max_drawdown_percent()</a> / <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.max_drawdown_percent">strategy.closedtrades.max_drawdown_percent()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_id">strategy.closedtrades.exit_id()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_price">strategy.closedtrades.exit_price()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_time">strategy.closedtrades.exit_time()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_bar_index">strategy.closedtrades.exit_bar_index()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_comment">strategy.closedtrades.exit_comment()</a></li>
</ul>
<p>Note that:</p>
<ul>
<li>Most built-ins within these namespaces are <em>functions</em>. However, the <code dir="auto">strategy.opentrades.*</code> namespace also features a unique <em>variable</em>: <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades.capital_held">strategy.opentrades.capital_held</a>. Its value represents the amount of capital reserved by <em>all</em> open trades.</li>
<li>Only the <code dir="auto">strategy.closedtrades.*</code> namespace has <code dir="auto">.exit_*()</code> functions that return information about <em>exit orders</em>.</li>
</ul>
<p>All <code dir="auto">strategy.opentrades.*()</code> and <code dir="auto">strategy.closedtrades.*()</code> functions have a <code dir="auto">trade_num</code> parameter, which accepts an “int” value representing the index of the open or closed trade. The index of the first open/closed trade is 0, and the last trade’s index is <em>one less</em> than the value of the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades">strategy.opentrades</a>/<a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.closedtrades">strategy.closedtrades</a> variable.</p>
<p>The following example places up to five long entry orders per position, each with a unique ID, and it calculates metrics for specific closed trades.</p>
<p>The strategy places a new entry order when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> crosses above its <code dir="auto">median</code> without reaching the <code dir="auto">highest</code> value, but only if the number of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_strategy.opentrades">open trades</a> is less than five. It exits each position using <a href="/pine-script-docs/v5/concepts/strategies/#take-profit-and-stop-loss">stop-loss</a> orders from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> or a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.close_all">strategy.close_all()</a>. Each successive entry order’s ID depends on the number of open trades. The first entry ID in each position is “Buy0”, and the last possible entry ID is “Buy4”.</p>
<p>The script calls <code dir="auto">strategy.closedtrades.*()</code> functions within a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop to access closed trade <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_id">entry IDs</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.profit">profits</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.entry_bar_index">entry bar indices</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.closedtrades.exit_bar_index">exit bar indices</a>. It uses this information to calculate the total number of closed trades with the specified entry ID, the number of winning trades, the average number of bars per trade, and the total profit from all the trades. The script then organizes this information in a formatted string and displays it in a single-cell <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="500" loading="lazy" src="images/213dddfd306e2f9eabfeba23ab275304.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
strategy(
     "Individual trade information demo", pyramiding = 5, default_qty_type = strategy.percent_of_equity, 
     default_qty_value = 1, margin_long = 100, margin_short = 100
 )

//@variable The number of bars in the `highest` and `lowest` calculation. 
int lengthInput = input.int(50, "Length", 1)
string idInput = input.string("Buy0", "Entry ID to analyze", ["Buy0", "Buy1", "Buy2", "Buy3", "Buy4"])

// Calculate the highest, lowest, and median `close` values over `lengthInput` bars.
float highest = ta.highest(close, lengthInput)
float lowest  = ta.lowest(close, lengthInput)
float median  = 0.5 * (highest + lowest)

// Define entry and stop-loss orders when the `close` crosses above the `median` without touching the `highest` value.
if ta.crossover(close, median) and close != highest and strategy.opentrades &lt; 5
    strategy.entry("Buy" + str.tostring(strategy.opentrades), strategy.long) 
    if strategy.opentrades == 0
        strategy.exit("SL", stop = lowest)
// Close the entire position when the `close` reaches the `lowest` value.
if close == lowest
    strategy.close_all()

// The total number of closed trades with the `idInput` entry, the number of wins, the average number of bars, 
// and the total profit.
int   trades  = 0
int   wins    = 0
float avgBars = 0
float totalPL = 0.0

if barstate.islastconfirmedhistory or barstate.isrealtime
    //@variable A single-cell table displaying information about closed trades with the `idInput` entry ID. 
    var table infoTable = table.new(position.middle_center, 1, 1, color.purple)
    // Iterate over closed trade indices.
    for tradeNum = 0 to strategy.closedtrades - 1
        // Skip the rest of the current iteration if the `tradeNum` closed trade didn't open with an `idInput` entry.
        if strategy.closedtrades.entry_id(tradeNum) != idInput
            continue
        // Accumulate `trades`, `wins`, `avgBars`, and `totalPL` values.
        float profit = strategy.closedtrades.profit(tradeNum)
        trades  += 1
        wins    += profit &gt; 0 ? 1 : 0
        avgBars += strategy.closedtrades.exit_bar_index(tradeNum) - strategy.closedtrades.entry_bar_index(tradeNum) + 1
        totalPL += profit
    avgBars /= trades

    //@variable A formatted string containing the calculated closed trade information. 
    string displayText = str.format(
         "ID: {0}\n\nTotal trades: {1}\nWin trades: {2}\nAvg. bars: {3}\nTotal P/L: {4} {5}",
         idInput, trades, wins, avgBars, totalPL, strategy.account_currency
     )
    // Populate the table's cell with `displayText`. 
    infoTable.cell(0, 0, displayText, text_color = color.white, text_halign = text.align_left, text_size = size.large)

// Plot the highest, median, and lowest values on the main chart pane. 
plot(highest, "Highest close", force_overlay = true)
plot(median, "Median close", force_overlay = true)
plot(lowest, "Lowest close", force_overlay = true)</code></div>
<p>Note that:</p>
<ul>
<li>This strategy can open up to five long trades per position because we included <code dir="auto">pyramiding = 5</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement. See the <a href="/pine-script-docs/v5/concepts/strategies/#pyramiding">pyramiding</a> section for more information.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> instance in this script persists and generates exit orders for every entry in the open position because we did not specify a <code dir="auto">from_entry</code> ID. See the <a href="/pine-script-docs/v5/concepts/strategies/#exits-for-multiple-entries">Exits for multiple entries</a> section to learn more about this behavior.</li>
</ul>
<h2 class="md-heading" id="strategy-alerts"><a href="#strategy-alerts">Strategy alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ indicators (not strategies) have two different mechanisms to set up custom alert conditions: the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function, which tracks one specific condition per function call, and the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function, which tracks all its calls simultaneously, but provides greater flexibility in the number of calls, alert messages, etc.</p>
<p>Pine Script™ strategies cannot create alert triggers using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function, but they can create triggers with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function. Additionally, each <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement command</a> comes with its own built-in alert functionality that does not require any additional code to implement. As such, any strategy that uses an order placement command can issue alerts upon order execution. The precise mechanics of such built-in strategy alerts are described in the <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">Order Fill events</a> section of the <a href="/pine-script-docs/v5/concepts/alerts/">Alerts</a> page.</p>
<p>When a strategy uses both the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function and functions that create orders in the same script, the “Create Alert” dialog box provides a choice between the conditions to use as a trigger: <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> events, order fill events, or both.</p>
<p>For many trading strategies, the delay between a triggered alert and a live trade can be a critical performance factor. By default, strategy scripts can only execute <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function calls on the close of realtime bars, as if they used <a href="https://www.tradingview.com/pine-script-reference/v5/#const_alert%7Bdot%7Dfreq_once_per_bar_close">alert.freq_once_per_bar_close</a>, regardless of the <code dir="auto">freq</code> argument in the call. Users can change the alert frequency by including  <code dir="auto">calc_on_every_tick = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> call or selecting the “Recalculate/On every tick” option in the “Settings/Properties” tab before creating the alert. However, depending on the script, this setting can adversely impact the strategy’s behavior. See the <a href="/pine-script-docs/v5/concepts/strategies/#calc_on_every_tick">`calc_on_every_tick`</a> section for more information.</p>
<p>Order fill alert triggers do not suffer the same limitations as the triggers from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> calls, which makes them more suitable for sending alerts to third parties for automation. Alerts from order fill events execute <em>immediately</em>, unaffected by a script’s <code dir="auto">calc_on_every_tick</code> setting. Users can set the default message for order fill alerts via the <code dir="auto">//@strategy_alert_message</code> compiler annotation. The text provided with this annotation populates the “Message” field in the “Create Alert” dialog box.</p>
<p>The following script shows a simple example of a default order fill alert message. Above the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> declaration statement, the script includes <code dir="auto">@strategy_alert_message</code> with <a href="https://www.tradingview.com/support/solutions/43000531021-how-to-use-a-variable-value-in-alert/"><em>placeholders</em></a> for the trade action, current position size, ticker name, and fill price values in the message text:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
//@strategy_alert_message {{strategy.order.action}} {{strategy.position_size}} {{ticker}} @ {{strategy.order.price}}
strategy("Alert Message Demo", overlay = true)
float fastMa = ta.sma(close, 5)
float slowMa = ta.sma(close, 10)

if ta.crossover(fastMa, slowMa)
    strategy.entry("buy", strategy.long)

if ta.crossunder(fastMa, slowMa)
    strategy.entry("sell", strategy.short)

plot(fastMa, "Fast MA", color.aqua)
plot(slowMa, "Slow MA", color.orange)</code></div>
<p>This script populates the “Create Alert” dialog box with its default message when the user selects its name from the “Condition” dropdown tab:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="578" loading="lazy" src="images/3376e23183ce1f1dc4c2dcf4f237862c.webp" width="902"/></div></p>
<p>When the alert fires, the strategy populates the placeholders in the alert message with their corresponding values. For example:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="360" loading="lazy" src="images/f6534a9021f1ec7e5537ee1fb2ef17bf.webp" width="634"/></div></p>
<h2 class="md-heading" id="notes-on-testing-strategies"><a href="#notes-on-testing-strategies">Notes on testing strategies<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Testing and tuning strategies in historical and live market conditions can provide insight into a strategy’s characteristics, potential weaknesses, and <em>possibly</em> its future potential. However, traders should always be aware of the biases and limitations of simulated strategy results, especially when using the results to support live trading decisions. This section outlines some caveats associated with strategy validation and tuning and possible solutions to mitigate their effects.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Although testing strategies on existing data might give traders helpful information about a strategy’s qualities, it’s important to note that neither the past nor the present guarantees the future. Financial markets can change rapidly and unpredictably, which can cause a strategy to sustain uncontrollable losses. Additionally, simulated results may not fully account for other real-world factors that can impact trading performance. Therefore, we recommend that traders thoroughly understand the limitations and risks of backtests and forward tests and consider them “parts of the whole” in their validation processes rather than basing decisions solely on the results.</p></div></aside>
<h3 class="md-heading" id="backtesting-and-forward-testing"><a href="#backtesting-and-forward-testing">Backtesting and forward testing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><em>Backtesting</em> is a technique to evaluate the historical performance of a trading strategy or model by simulating and analyzing its past results on historical market data. This technique assumes that a strategy’s results on past data can provide insight into its strengths and weaknesses. When backtesting, many traders adjust the parameters of a strategy in an attempt to optimize its results. Analysis and optimization of historical results can help traders to gain a deeper understanding of a strategy. However, traders should always understand the risks and limitations when basing their decisions on optimized backtest results.</p>
<p>It is prudent to also use realtime analysis as a tool for evaluating a trading system on a forward-looking basis. <em>Forward testing</em> aims to gauge the performance of a strategy in live market conditions, where factors such as trading costs, slippage, and liquidity can meaningfully affect its performance. While forward testing has the distinct advantage of not being affected by certain types of biases (e.g., lookahead bias or “future data leakage”), it does carry the disadvantage of being limited in the quantity of data to test. Therefore, although it can provide helpful insights into a strategy’s performance in current market conditions, forward testing is not typically used on its own.</p>
<h3 class="md-heading" id="lookahead-bias"><a href="#lookahead-bias">Lookahead bias<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One typical issue in backtesting strategies that request alternate timeframe data, use repainting variables such as <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>, or alter calculation behavior for intrabar order fills, is the leakage of future data into the past during evaluation, which is known as <em>lookahead bias</em>. Not only is this bias a common cause of unrealistic strategy results, since the future is never actually knowable beforehand, but it is also one of the typical causes of strategy repainting.</p>
<p>Traders can often confirm whether a strategy has lookahead bias by forward testing it on realtime data, where no known data exists beyond the latest bar. Since there is no future data to leak into the past on realtime bars, the strategy will behave differently on historical and realtime bars if its results have lookahead bias.</p>
<p>To eliminate lookahead bias in a strategy:</p>
<ul>
<li>Do not use repainting variables that leak future values into the past in the order placement or cancellation logic.</li>
<li>Do not include <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge%7Bdot%7Dlookahead_on">barmerge.lookahead_on</a> in <code dir="auto">request.*()</code> calls without offsetting the data series, as described in <a href="/pine-script-docs/v5/concepts/repainting/#future-leak-with-requestsecurity">this</a> section of the <a href="/pine-script-docs/v5/concepts/repainting/">Repainting</a> page.</li>
<li>Use realistic strategy calculation behavior.</li>
</ul>
<h3 class="md-heading" id="selection-bias"><a href="#selection-bias">Selection bias<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Selection bias occurs when a trader analyzes only results on specific instruments or timeframes while ignoring others. This bias can distort the perspective of the strategy’s robustness, which can impact trading decisions and performance optimizations. Traders can reduce the effects of selection bias by evaluating their strategies on multiple, ideally diverse, symbols and timeframes, and ensuring not to ignore poor performance results or “cherry-pick” testing ranges.</p>
<h3 class="md-heading" id="overfitting"><a href="#overfitting">Overfitting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A common problem when optimizing a strategy based on backtest results is overfitting (“curve fitting”), which means tailoring the strategy for specific data. An overfitted strategy often fails to generalize well on new, unseen data. One widely-used approach to help reduce the potential for overfitting and promote better generalization is to split an instrument’s data into two or more parts to test the strategy outside the sample used for optimization, otherwise known as “in-sample” (IS) and “out-of-sample” (OOS) backtesting.</p>
<p>In this approach, traders optimize strategy parameters on the IS data, and they test the optimized configuration on the OOS data without additional fine-tuning. Although this and other, more robust approaches might provide a glimpse into how a strategy might fare after optimization, traders should still exercise caution. No trading strategy can guarantee future performance, regardless of the data used for optimization and testing, because the future is inherently unknowable.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/sessions"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Sessions  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/tables"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Tables <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Tables</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-tables"><a href="#tables">Tables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Tables are objects that can be used to position information in specific
and fixed locations in a script’s visual space. Contrary to all other
plots or objects drawn in Pine Script™, tables are not anchored to
specific bars; they <em>float</em> in a script’s space, whether in overlay or
pane mode, in studies or strategies, independently of the chart bars
being viewed or the zoom factor used.</p>
<p>Tables contain cells arranged in columns and rows, much like a
spreadsheet. They are created and populated in two distincts steps:</p>
<ol>
<li>A table’s structure and key attributes are defined using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>,
which returns a table ID that acts like a pointer to the table, just
like label, line, or array IDs do. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>
call will create the table object but does not display it.</li>
<li>Once created, and for it to display, the table must be populated
using one
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
call for each cell. Table cells can contain text, or not. This
second step is when the width and height of cells are defined.</li>
</ol>
<p>Most attributes of a previously created table can be changed using
<code dir="auto">table.set_*()</code> setter functions. Attributes of previously populated
cells can be modified using <code dir="auto">table.cell_set_*()</code> functions.</p>
<p>A table is positioned in an indicator’s space by anchoring it to one of
nine references: the four corners or midpoints, including the center.
Tables are positioned by expanding the table from its anchor, so a table
anchored to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dmiddle_right">position.middle_right</a>
reference will be drawn by expanding up, down and left from that anchor.</p>
<p>Two modes are available to determine the width/height of table cells:</p>
<ul>
<li>A default automatic mode calculates the width/height of cells in a
column/row using the widest/highest text in them.</li>
<li>An explicit mode allows programmers to define the width/height of
cells using a percentage of the indicator’s available x/y space.</li>
</ul>
<p>Displayed table contents always represent the last state of the table,
as it was drawn on the script’s last execution, on the dataset’s last
bar. Contrary to values displayed in the Data Window or in indicator
values, variable contents displayed in tables will thus not change as a
script user moves his cursor over specific chart bars. For this reason,
it is strongly recommended to always restrict execution of all
<code dir="auto">table.*()</code> calls to either the first or last bars of the dataset.
Accordingly:</p>
<ul>
<li>Use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to declare tables.</li>
<li>Enclose all other calls inside an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
block.</li>
</ul>
<p><strong>Multiple tables can be used in one script, as long as they are each
anchored to a different position. Each table object is identified by its
own ID. Limits on the quantity of cells in all tables are determined by
the total number of cells used in one script.</strong></p>
<h2 class="md-heading" id="creating-tables"><a href="#creating-tables">Creating tables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When creating a table using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>,
three parameters are mandatory: the table’s position and its number of
columns and rows. Five other parameters are optional: the table’s
background color, the color and width of the table’s outer frame, and
the color and width of the borders around all cells, excluding the outer
frame. All table attributes except its number of columns and rows can be
modified using setter functions:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_position">table.set_position()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_bgcolor">table.set_bgcolor()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_frame_color">table.set_frame_color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_frame_width">table.set_frame_width()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_border_color">table.set_border_color()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dset_border_width">table.set_border_width()</a>.</p>
<p>Tables can be deleted using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Ddelete">table.delete()</a>,
and their content can be selectively removed using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dclear">table.clear()</a>.</p>
<p>When populating cells using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>,
you must supply an argument for four mandatory parameters: the table id
the cell belongs to, its column and row index using indices that start
at zero, and the text string the cell contains, which can be null. Seven
other parameters are optional: the width and height of the cell, the
text’s attributes (color, horizontal and vertical alignment, size), and
the cell’s background color. All cell attributes can be modified using
setter functions:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_text">table.cell_set_text()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_width">table.cell_set_width()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_height">table.cell_set_height()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_text_color">table.cell_set_text_color()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_text_halign">table.cell_set_text_halign()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_text_valign">table.cell_set_text_valign()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_text_size">table.cell_set_text_size()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell_set_bgcolor">table.cell_set_bgcolor()</a>.</p>
<p>Keep in mind that each successive call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
redefines <strong>all</strong> the cell’s properties, deleting any properties set by
previous
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
calls on the same cell.</p>
<h3 class="md-heading" id="placing-a-single-value-in-a-fixed-position"><a href="#placing-a-single-value-in-a-fixed-position">Placing a single value in a fixed position<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Let’s create our first table, which will place the value of ATR in the
upper-right corner of the chart. We first create a one-cell table, then
populate that cell:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("ATR", "", true)
// We use `var` to only initialize the table on the first bar.
var table atrDisplay = table.new(position.top_right, 1, 1)
// We call `ta.atr()` outside the `if` block so it executes on each bar.
myAtr = ta.atr(14)
if barstate.islast
    // We only populate the table on the last bar.
    table.cell(atrDisplay, 0, 0, str.tostring(myAtr))</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="366" loading="lazy" src="images/ca3b898f5b8edd1c70be232ddaafdae9.webp" width="1480"/></div></p>
<p>Note that:</p>
<ul>
<li>We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword when creating the table with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>.</li>
<li>We populate the cell inside an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
block using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>.</li>
<li>When populating the cell, we do not specify the <code dir="auto">width</code> or <code dir="auto">height</code>.
The width and height of our cell will thus adjust automatically to
the text it contains.</li>
<li>We call <code dir="auto">ta.atr(14)</code> prior to entry in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
block so that it evaluates on each bar. Had we used
<code dir="auto">str.tostring(ta.atr(14))</code> inside the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
block, the function would not have evaluated correctly because it
would be called on the dataset’s last bar without having calculated
the necessary values from the previous bars.</li>
</ul>
<p>Let’s improve the usability and aesthethics of our script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("ATR", "", true)
atrPeriodInput = input.int(14,  "ATR period", minval = 1, tooltip = "Using a period of 1 yields True Range.")

var table atrDisplay = table.new(position.top_right, 1, 1, bgcolor = color.gray, frame_width = 2, frame_color = color.black)
myAtr = ta.atr(atrPeriodInput)
if barstate.islast
    table.cell(atrDisplay, 0, 0, str.tostring(myAtr, format.mintick), text_color = color.white)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="368" loading="lazy" src="images/12cdd8c3bde4e1e3e9ff408aeee8fb35.webp" width="1480"/></div></p>
<p>Note that:</p>
<ul>
<li>We used
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>
to define a background color, a frame color and its width.</li>
<li>When populating the cell with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>,
we set the text to display in white.</li>
<li>We pass
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_format%7Bdot%7Dmintick">format.mintick</a>
as a second argument to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>
function to restrict the precision of ATR to the chart’s tick
precision.</li>
<li>We now use an input to allow the script user to specify the period
of ATR. The input also includes a tooltip, which the user can see
when he hovers over the “i” icon in the script’s
“Settings/Inputs” tab.</li>
</ul>
<h3 class="md-heading" id="coloring-the-charts-background"><a href="#coloring-the-charts-background">Coloring the chart’s background<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This example uses a one-cell table to color the chart’s background on
the bull/bear state of RSI:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Chart background", "", true)
bullColorInput = input.color(color.new(color.green, 95), "Bull", inline = "1")
bearColorInput = input.color(color.new(color.red, 95), "Bear", inline = "1")
// ————— Function colors chart bg on RSI bull/bear state.
colorChartBg(bullColor, bearColor) =&gt;
    var table bgTable = table.new(position.middle_center, 1, 1)
    float r = ta.rsi(close, 20)
    color bgColor = r &gt; 50 ? bullColor : r &lt; 50 ? bearColor : na
    if barstate.islast
        table.cell(bgTable, 0, 0, width = 100, height = 100, bgcolor = bgColor)

colorChartBg(bullColorInput, bearColorInput)</code></div>
<p>Note that:</p>
<ul>
<li>We provide users with inputs allowing them to specify the bull/bear
colors to use for the background, and send those input colors as
arguments to our <code dir="auto">colorChartBg()</code> function.</li>
<li>We create a new table only once, using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to declare the table.</li>
<li>We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
on the last bar only, to specify the cell’s properties. We make the
cell the width and height of the indicator’s space, so it covers
the whole chart.</li>
</ul>
<h3 class="md-heading" id="creating-a-display-panel"><a href="#creating-a-display-panel">Creating a display panel<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Tables are ideal to create sophisticated display panels. Not only do
they make it possible for display panels to always be visible in a
constant position, they provide more flexible formatting because each
cell’s properties are controlled separately: background, text color,
size and alignment, etc.</p>
<p>Here, we create a basic display panel showing a user-selected quantity
of MAs values. We display their period in the first column, then their
value with a green/red/gray background that varies with price’s
position with regards to each MA. When price is above/below the MA, the
cell’s background is colored with the bull/bear color. When the MA
falls between the current bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
the cell’s background is of the neutral color:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1108" loading="lazy" src="images/22597a6c6abaae4ba55e818d89970a7b.webp" width="1770"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Price vs MA", "", true)

var string GP1 = "Moving averages"
int     masQtyInput    = input.int(20, "Quantity", minval = 1, maxval = 40, group = GP1, tooltip = "1-40")
int     masStartInput  = input.int(20, "Periods begin at", minval = 2, maxval = 200, group = GP1, tooltip = "2-200")
int     masStepInput   = input.int(20, "Periods increase by", minval = 1, maxval = 100, group = GP1, tooltip = "1-100")

var string GP2 = "Display"
string  tableYposInput = input.string("top", "Panel position", inline = "11", options = ["top", "middle", "bottom"], group = GP2)
string  tableXposInput = input.string("right", "", inline = "11", options = ["left", "center", "right"], group = GP2)
color   bullColorInput = input.color(color.new(color.green, 30), "Bull", inline = "12", group = GP2)
color   bearColorInput = input.color(color.new(color.red, 30), "Bear", inline = "12", group = GP2)
color   neutColorInput = input.color(color.new(color.gray, 30), "Neutral", inline = "12", group = GP2)

var table panel = table.new(tableYposInput + "_" + tableXposInput, 2, masQtyInput + 1)
if barstate.islast
    // Table header.
    table.cell(panel, 0, 0, "MA", bgcolor = neutColorInput)
    table.cell(panel, 1, 0, "Value", bgcolor = neutColorInput)

int period = masStartInput
for i = 1 to masQtyInput
    // ————— Call MAs on each bar.
    float ma = ta.sma(close, period)
    // ————— Only execute table code on last bar.
    if barstate.islast
        // Period in left column.
        table.cell(panel, 0, i, str.tostring(period), bgcolor = neutColorInput)
        // If MA is between the open and close, use neutral color. If close is lower/higher than MA, use bull/bear color.
        bgColor = close &gt; ma ? open &lt; ma ? neutColorInput : bullColorInput : open &gt; ma ? neutColorInput : bearColorInput
        // MA value in right column.
        table.cell(panel, 1, i, str.tostring(ma, format.mintick), text_color = color.black, bgcolor = bgColor)
    period += masStepInput</code></div>
<p>Note that:</p>
<ul>
<li>Users can select the table’s position from the inputs, as well as
the bull/bear/neutral colors to be used for the background of the
right column’s cells.</li>
<li>The table’s quantity of rows is determined using the number of MAs
the user chooses to display. We add one row for the column headers.</li>
<li>Even though we populate the table cells on the last bar only, we
need to execute the calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dsma">ta.sma()</a>
on every bar so they produce the correct results. The compiler
warning that appears when you compile the code can be safely
ignored.</li>
<li>We separate our inputs in two sections using <code dir="auto">group</code>, and join the
relevant ones on the same line using <code dir="auto">inline</code>. We supply tooltips to
document the limits of certain fields using <code dir="auto">tooltip</code>.</li>
</ul>
<h3 class="md-heading" id="displaying-a-heatmap"><a href="#displaying-a-heatmap">Displaying a heatmap<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Our next project is a heatmap, which will indicate the bull/bear
relationship of the current price relative to its past values. To do so,
we will use a table positioned at the bottom of the chart. We will
display colors only, so our table will contain no text; we will simply
color the background of its cells to produce our heatmap. The heatmap
uses a user-selectable lookback period. It loops across that period to
determine if price is above/below each bar in that past, and displays a
progressively lighter intensity of the bull/bear color as we go further
in the past:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="576" loading="lazy" src="images/82558f5cea39abcd432d529dcd22e8b8.webp" width="1794"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Price vs Past", "", true)

var int MAX_LOOKBACK = 300

int     lookBackInput  = input.int(150, minval = 1, maxval = MAX_LOOKBACK, step = 10)
color   bullColorInput = input.color(#00FF00ff, "Bull", inline = "11")
color   bearColorInput = input.color(#FF0080ff, "Bear", inline = "11")

// ————— Function draws a heatmap showing the position of the current `_src` relative to its past `_lookBack` values.
drawHeatmap(src, lookBack) =&gt;
    // float src     : evaluated price series.
    // int   lookBack: number of past bars evaluated.
    // Dependency: MAX_LOOKBACK

    // Force historical buffer to a sufficient size.
    max_bars_back(src, MAX_LOOKBACK)
    // Only run table code on last bar.
    if barstate.islast
        var heatmap = table.new(position.bottom_center, lookBack, 1)
        for i = 1 to lookBackInput
            float transp = 100. * i / lookBack
            if src &gt; src[i]
                table.cell(heatmap, lookBack - i, 0, bgcolor = color.new(bullColorInput, transp))
            else
                table.cell(heatmap, lookBack - i, 0, bgcolor = color.new(bearColorInput, transp))

drawHeatmap(high, lookBackInput)</code></div>
<p>Note that:</p>
<ul>
<li>We define a maximum lookback period as a <code dir="auto">MAX_LOOKBACK</code> constant.
This is an important value and we use it for two purposes: to
specify the number of columns we will create in our one-row table,
and to specify the lookback period required for the <code dir="auto">_src</code> argument
in our function, so that we force Pine Script™ to create a
historical buffer size that will allow us to refer to the required
quantity of past values of <code dir="auto">_src</code> in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop.</li>
<li>We offer users the possibility of configuring the bull/bear colors
in the inputs and we use <code dir="auto">inline</code> to place the color selections on
the same line.</li>
<li>Inside our function, we enclose our table-creation code in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
construct so that it only runs on the last bar of the chart.</li>
<li>The initialization of the table is done inside the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
statement. Because of that, and the fact that it uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword, initialization only occurs the first time the script
executes on a last bar. Note that this behavior is different from
the usual
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
declarations in the script’s global scope, where initialization
occurs on the first bar of the dataset, at
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
zero.</li>
<li>We do not specify an argument to the <code dir="auto">text</code> parameter in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
calls, so an empty string is used.</li>
<li>We calculate our transparency in such a way that the intensity of
the colors decreases as we go further in history.</li>
<li>We use dynamic color generation to create different transparencies
of our base colors as needed.</li>
<li>Contrary to other objects displayed in Pine scripts, this heatmap’s
cells are not linked to chart bars. The configured lookback period
determines how many table cells the heatmap contains, and the
heatmap will not change as the chart is panned horizontally, or
scaled.</li>
<li>The maximum number of cells that can be displayed in the scritp’s
visual space will depend on your viewing device’s resolution and
the portion of the display used by your chart. Higher resolution
screens and wider windows will allow more table cells to be
displayed.</li>
</ul>
<h2 class="md-heading" id="tips"><a href="#tips">Tips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<ul>
<li>When creating tables in strategy scripts, keep in mind that unless
the strategy uses <code dir="auto">calc_on_every_tick = true</code>, table code enclosed
in <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate%7Bdot%7Dislast">barstate.islast</a>
blocks will not execute on each realtime update, so the table will
not display as you expect.</li>
<li>Keep in mind that successive calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
overwrite the cell’s properties specified by previous
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dcell">table.cell()</a>
calls. Use the setter functions to modify a cell’s properties.</li>
<li>Remember to control the execution of your table code wisely by
restricting it to the necessary bars only. This saves server
resources and your charts will display faster, so everybody wins.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/strategies"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Strategies  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/text-and-shapes"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Text and shapes <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Text and shapes</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-text-and-shapes"><a href="#text-and-shapes">Text and shapes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>You may display text or shapes using five different ways with Pine
Script™:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a></li>
<li>Labels created with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a></li>
<li>Tables created with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a>
(see <a href="/pine-script-docs/v5/concepts/tables/">Tables</a>)</li>
</ul>
<p>Which one to use depends on your needs:</p>
<ul>
<li>Tables can display text in various relative positions on charts that
will not move as users scroll of zoom the chart horizontally. Their
content is not tethered to bars. In contrast, text displayed with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
is always tethered to a specific bar, so it will move with the
bar’s position on the chart. See the page on
<a href="/pine-script-docs/v5/concepts/tables/">Tables</a> for more
information on them.</li>
<li>Three function include are able to display pre-defined shapes:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
and Labels created with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
cannot display text, only up or down arrows.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
can display non-dynamic text on any bar or all bars of the chart.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
can only display one character while
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
can display strings, including line breaks.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
can display a maximum of 500 labels on the chart. Its text <strong>can</strong>
contain dynamic text, or “series strings”. Line breaks are also
supported in label text.</li>
<li>While
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
can display text at a fixed offset in the past or the future, which
cannot change during the script’s execution, each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
call can use a “series” offset that can be calculated on the fly.</li>
</ul>
<p>These are a few things to keep in mind concerning Pine Script™ strings:</p>
<ul>
<li>Since the <code dir="auto">text</code> parameter in both
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
require a “const string” argument, it cannot contain values such
as prices that can only be known on the bar (“series string”).</li>
<li>To include “series” values in text displayed using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>,
they will first need to be converted to strings using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>.</li>
<li>The concatenation operator for strings in Pine is <code dir="auto">+</code>. It is used to
join string components into one string, e.g.,
<code dir="auto">msg = "Chart symbol: " + syminfo.tickerid</code> (where
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo%7Bdot%7Dtickerid">syminfo.tickerid</a>
is a built-in variable that returns the chart’s exchange and symbol
information in string format).</li>
<li>Characters displayed by all these functions can be Unicode
characters, which may include Unicode symbols. See this <a href="https://www.tradingview.com/script/0rFQOCKf-Exploring-Unicode/">Exploring
Unicode</a>
script to get an idea of what can be done with Unicode characters.</li>
<li>The color or size of text can sometimes be controlled using function
parameters, but no inline formatting (bold, italics, monospace,
etc.) is possible.</li>
<li>Text from Pine scripts always displays on the chart in the Trebuchet
MS font, which is used in many TradingView texts, including this
one.</li>
</ul>
<p>This script displays text using the four methods available in Pine
Script™:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Four displays of text", overlay = true)
plotchar(ta.rising(close, 5), "`plotchar()`", "🠅", location.belowbar, color.lime, size = size.small)
plotshape(ta.falling(close, 5), "`plotchar()`", location = location.abovebar, color = na, text = "•`plotshape()•`\n🠇", textcolor = color.fuchsia, size = size.huge)

if bar_index % 25 == 0
    label.new(bar_index, na, "•LABEL•\nHigh = " + str.tostring(high, format.mintick) + "\n🠇", yloc = yloc.abovebar, style = label.style_none, textcolor = color.black, size = size.normal)

printTable(txt) =&gt; var table t = table.new(position.middle_right, 1, 1), table.cell(t, 0, 0, txt, bgcolor = color.yellow)
printTable("•TABLE•\n" + str.tostring(bar_index + 1) + " bars\nin the dataset")</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="566" loading="lazy" src="images/5cdf93932ce5af0c3891e1a086bec748.webp" width="1348"/></div></p>
<p>Note that:</p>
<ul>
<li>The method used to display each text string is shown with the text,
except for the lime up arrows displayed using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
as it can only display one character.</li>
<li>Label and table calls can be inserted in conditional structures to
control when their are executed, whereas
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
cannot. Their conditional plotting must be controlled using their
first argument, which is a “series bool” whose <code dir="auto">true</code> or <code dir="auto">false</code>
value determines when the text is displayed.</li>
<li>Numeric values displayed in the table and labels is first converted
to a string using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str%7Bdot%7Dtostring">str.tostring()</a>.</li>
<li>We use the <code dir="auto">+</code> operator to concatenate string components.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
is designed to display a shape with accompanying text. Its <code dir="auto">size</code>
parameter controls the size of the shape, not of the text. We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
for its <code dir="auto">color</code> argument so that the shape is not visible.</li>
<li>Contrary to other texts, the table text will not move as you scroll
or scale the chart.</li>
<li>Some text strings contain the 🠇 Unicode arrow (U+1F807).</li>
<li>Some text strings contain the <code dir="auto">\n</code> sequence that represents a new
line.</li>
</ul>
<h2 class="md-heading" id="plotchar"><a href="#plotchar">`plotchar()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This function is useful to display a single character on bars. It has
the following syntax:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plotchar(series, title, char, location, color, offset, text, textcolor, editable, size, show_last, display, force_overlay) → void</span></div></div></code></pre></figure></link></div>
<p>See the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">Reference Manual entry for
plotchar()</a>
for details on its parameters.</p>
<p>As explained in the
<a href="/pine-script-docs/v5/writing/debugging/#without-affecting-the-scale">Without affecting the scale</a> section of our page on
<a href="/pine-script-docs/v5/writing/debugging/">Debugging</a>, the function
can be used to display and inspect values in the Data Window or in the
indicator values displayed to the right of the script’s name on the
chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
plotchar(bar_index, "Bar index", "", location.top)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="532" loading="lazy" src="images/d8d479225709b13db1f4e51513d3f4df.webp" width="1842"/></div></p>
<p>Note that:</p>
<ul>
<li>The cursor is on the chart’s last bar.</li>
<li>The value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
on <strong>that</strong> bar is displayed in indicator values (1) and in the Data
Window (2).</li>
<li>We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location%7Bdot%7Dtop">location.top</a>
because the default
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location%7Bdot%7Dabovebar">location.abovebar</a>
will put the price into play in the script’s scale, which will
often interfere with other plots.</li>
</ul>
<p><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
also works well to identify specific points on the chart or to validate
that conditions are <code dir="auto">true</code> when we expect them to be. This example
displays an up arrow under bars where
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
have all been rising for two bars:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
bool longSignal = ta.rising(close, 2) and ta.rising(high, 2) and (na(volume) or ta.rising(volume, 2))
plotchar(longSignal, "Long", "▲", location.belowbar, color = na(volume) ? color.gray : color.blue, size = size.tiny)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="480" loading="lazy" src="images/b20187a2402aaffff51aae2e653e7551.webp" width="1770"/></div></p>
<p>Note that:</p>
<ul>
<li>We use <code dir="auto">(na(volume) or ta.rising(volume, 2))</code> so our script will
work on symbols without
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
data. If we did not make provisions for when there is no
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
data, which is what <code dir="auto">na(volume)</code> does by being <code dir="auto">true</code> when there is
no volume, the <code dir="auto">longSignal</code> variable’s value would never be <code dir="auto">true</code>
because <code dir="auto">ta.rising(volume, 2)</code> yields <code dir="auto">false</code> in those cases.</li>
<li>We display the arrow in gray when there is no volume, to remind us
that all three base conditions are not being met.</li>
<li>Because
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
is now displaying a character on the chart, we use
<code dir="auto">size = size.tiny</code> to control its size.</li>
<li>We have adapted the <code dir="auto">location</code> argument to display the character
under bars.</li>
</ul>
<p>If you don’t mind plotting only circles, you could also use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
to achieve a similar effect:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
longSignal = ta.rising(close, 2) and ta.rising(high, 2) and (na(volume) or ta.rising(volume, 2))
plot(longSignal ? low - ta.tr : na, "Long", color.blue, 2, plot.style_circles)</code></div>
<p>This method has the inconvenience that, since there is no relative
positioning mechanism with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
one must shift the circles down using something like
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ta%7Bdot%7Dtr">ta.tr</a>
(the bar’s “True Range”):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="534" loading="lazy" src="images/247b16da9ee29e1b7d17a9ce071282a3.webp" width="1408"/></div></p>
<h2 class="md-heading" id="plotshape"><a href="#plotshape">`plotshape()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This function is useful to display pre-defined shapes and/or text on
bars. It has the following syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plotshape(series, title, style, location, color, offset, text, textcolor, editable, size, show_last, display, force_overlay) → void</span></div></div></code></pre></figure></div>
<p>See the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">Reference Manual entry for
plotshape()</a>
for details on its parameters.</p>
<p>Let’s use the function to achieve more or less the same result as with
our second example of the previous section:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
longSignal = ta.rising(close, 2) and ta.rising(high, 2) and (na(volume) or ta.rising(volume, 2))
plotshape(longSignal, "Long", shape.arrowup, location.belowbar)</code></div>
<p>Note that here, rather than using an arrow character, we are using the
<code dir="auto">shape.arrowup</code> argument for the <code dir="auto">style</code> parameter.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="484" loading="lazy" src="images/eece0f1be4e84b3d14ea51e87871f292.webp" width="1416"/></div></p>
<p>It is possible to use different
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
calls to superimpose text on bars. You will need to use <code dir="auto">\n</code> followed by
a special non-printing character that doesn’t get stripped out to
preserve the newline’s functionality. Here we’re using a Unicode
Zero-width space (U+200E). While you don’t see it in the following
code’s strings, it is there and can be copy/pasted. The special Unicode
character needs to be the <strong>last</strong> one in the string for text going up,
and the <strong>first</strong> one when you are plotting under the bar and text is
going down:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Lift text", "", true)
plotshape(true, "", shape.arrowup,   location.abovebar, color.green,  text = "A")
plotshape(true, "", shape.arrowup,   location.abovebar, color.lime,   text = "B\n​")
plotshape(true, "", shape.arrowdown, location.belowbar, color.red,    text = "C")
plotshape(true, "", shape.arrowdown, location.belowbar, color.maroon, text = "​\nD")</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="618" loading="lazy" src="images/631133c8191011d8968c7c72b3a08d46.webp" width="1410"/></div></p>
<p>The available shapes you can use with the <code dir="auto">style</code> parameter are:</p>
<table><thead><tr><th>Argument</th><th>Shape</th><th>With Text</th><th>Argument</th><th>Shape</th><th>With Text</th></tr></thead><tbody><tr><td><code dir="auto">shape.xcross</code></td><td><div class="image-container"><img alt="Plotshape_xcross" decoding="async" height="23" loading="lazy" src="images/5df3afce349f4307b87778761765aeba.webp" width="23"/></div></td><td><div class="image-container"><img alt="Xcross_with_text" decoding="async" height="64" loading="lazy" src="images/1b4233557f0575a3622759ced7cdd071.webp" width="64"/></div></td><td><code dir="auto">shape.arrowup</code></td><td><div class="image-container"><img alt="Plotshape_arrowup" decoding="async" height="26" loading="lazy" src="images/28d04de4f1d35b039e42607207b2a56e.webp" width="27"/></div></td><td><div class="image-container"><img alt="Arrowup_with_text" decoding="async" height="64" loading="lazy" src="images/2a8b48f93c6eeb2db89088f76aa768b4.webp" width="64"/></div></td></tr><tr><td><code dir="auto">shape.cross</code></td><td><div class="image-container"><img alt="Plotshape_cross" decoding="async" height="23" loading="lazy" src="images/552d07ebe96751e8597ef60f660a992c.webp" width="23"/></div></td><td><div class="image-container"><img alt="Cross_with_text" decoding="async" height="64" loading="lazy" src="images/2f4f8584e8173a41d6ec4fedda920056.webp" width="64"/></div></td><td><code dir="auto">shape.arrowdown</code></td><td><div class="image-container"><img alt="Plotshape_arrowdown" decoding="async" height="26" loading="lazy" src="images/ccce99b376db3846853115ae86565aa0.webp" width="27"/></div></td><td><div class="image-container"><img alt="Arrowdown_with_text" decoding="async" height="64" loading="lazy" src="images/50c49c24e2a1ffba1eddd68082e7c974.webp" width="64"/></div></td></tr><tr><td><code dir="auto">shape.circle</code></td><td><div class="image-container"><img alt="Plotshape_circle" decoding="async" height="23" loading="lazy" src="images/6504940d7284c8d446589bdd61803835.webp" width="23"/></div></td><td><div class="image-container"><img alt="Circle_with_text" decoding="async" height="64" loading="lazy" src="images/b273394876814066a29c96f87e87fe17.webp" width="64"/></div></td><td><code dir="auto">shape.square</code></td><td><div class="image-container"><img alt="Plotshape_square" decoding="async" height="26" loading="lazy" src="images/c2bf312930ebd9ee79032980316b3347.webp" width="26"/></div></td><td><div class="image-container"><img alt="Square_with_text" decoding="async" height="64" loading="lazy" src="images/59067dd42528c554a3f148119a522211.webp" width="64"/></div></td></tr><tr><td><code dir="auto">shape.triangleup</code></td><td><div class="image-container"><img alt="Plotshape_triangleup" decoding="async" height="23" loading="lazy" src="images/4e3a4b5f3b1f42d6387feef5b538030c.webp" width="23"/></div></td><td><div class="image-container"><img alt="Triangleup_with_text" decoding="async" height="64" loading="lazy" src="images/45e22d9aa4e6821da5da49e64fd3d847.webp" width="64"/></div></td><td><code dir="auto">shape.diamond</code></td><td><div class="image-container"><img alt="Plotshape_diamond" decoding="async" height="27" loading="lazy" src="images/05c8c3a4855813ac4854a22ce472a44d.webp" width="27"/></div></td><td><div class="image-container"><img alt="Diamond_with_text" decoding="async" height="64" loading="lazy" src="images/b3ecef190d356874b2af1902114f0f9d.webp" width="64"/></div></td></tr><tr><td><code dir="auto">shape.triangledown</code></td><td><div class="image-container"><img alt="Plotshape_triangledown" decoding="async" height="22" loading="lazy" src="images/f9604e07b0475ef6eac22f793abc0dfa.webp" width="23"/></div></td><td><div class="image-container"><img alt="Triangledown_with_text" decoding="async" height="64" loading="lazy" src="images/5775cf8187fab3567b65f995de76e90c.webp" width="64"/></div></td><td><code dir="auto">shape.labelup</code></td><td><div class="image-container"><img alt="Plotshape_labelup" decoding="async" height="34" loading="lazy" src="images/ed282b65878b875e8f103778d8627bf1.webp" width="18"/></div></td><td><div class="image-container"><img alt="Labelup_with_text" decoding="async" height="64" loading="lazy" src="images/6c7edca37612572832da76c2faf58ecb.webp" width="64"/></div></td></tr><tr><td><code dir="auto">shape.flag</code></td><td><div class="image-container"><img alt="Plotshape_flag" decoding="async" height="23" loading="lazy" src="images/bd45b75449ba40ad144cf6736f875c7c.webp" width="23"/></div></td><td><div class="image-container"><img alt="Flag_with_text" decoding="async" height="64" loading="lazy" src="images/92e58f31d9162ad8cc637966ecd51754.webp" width="64"/></div></td><td><code dir="auto">shape.labeldown</code></td><td><div class="image-container"><img alt="Plotshape_labeldown" decoding="async" height="34" loading="lazy" src="images/e1ab84aebde65ae1c5a89428e405900d.webp" width="18"/></div></td><td><div class="image-container"><img alt="Labeldown_with_text" decoding="async" height="64" loading="lazy" src="images/20b5510559823f3c38c893b22cc3d7c4.webp" width="64"/></div></td></tr></tbody></table>
<h2 class="md-heading" id="plotarrow"><a href="#plotarrow">`plotarrow()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow</a>
function displays up or down arrows of variable length, based on the
relative value of the series used in the function’s first argument. It
has the following syntax:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">plotarrow(series, title, colorup, colordown, offset, minheight, maxheight, editable, show_last, display, force_overlay) → void</span></div></div></code></pre></figure></div>
<p>See the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">Reference Manual entry for
plotarrow()</a>
for details on its parameters.</p>
<p>The <code dir="auto">series</code> parameter in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
is not a “series bool” as in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>;
it is a “series int/float” and there’s more to it than a simple
<code dir="auto">true</code> or <code dir="auto">false</code> value determining when the arrows are plotted. This is
the logic governing how the argument supplied to <code dir="auto">series</code> affects the
behavior of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>:</p>
<ul>
<li><code dir="auto">series &gt; 0</code>: An up arrow is displayed, the length of which will be
proportional to the relative value of the series on that bar in
relation to other series values.</li>
<li><code dir="auto">series &lt; 0</code>: A down arrow is displayed, proportionally-sized using
the same rules.</li>
<li><code dir="auto">series == 0 or na(series)</code>: No arrow is displayed.</li>
</ul>
<p>The maximum and minimum possible sizes for the arrows (in pixels) can be
controlled using the <code dir="auto">minheight</code> and <code dir="auto">maxheight</code> parameters.</p>
<p>Here is a simple script illustrating how
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
works:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
body = close - open
plotarrow(body, colorup = color.teal, colordown = color.orange)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="592" loading="lazy" src="images/d5d193e3000a29c2eabeb58245951eb2.webp" width="1405"/></div></p>
<p>Note how the heigth of arrows is proportional to the relative size of
the bar bodies.</p>
<p>You can use any series to plot the arrows. Here we use the value of the
“Chaikin Oscillator” to control the location and size of the arrows:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Chaikin Oscillator Arrows", overlay = true)
fastLengthInput = input.int(3,  minval = 1)
slowLengthInput = input.int(10, minval = 1)
osc = ta.ema(ta.accdist, fastLengthInput) - ta.ema(ta.accdist, slowLengthInput)
plotarrow(osc)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="684" loading="lazy" src="images/2133526688a1cbff7af18a6ec07a85b7.webp" width="1412"/></div></p>
<p>Note that we display the actual “Chaikin Oscillator” in a pane below
the chart, so you can see what values are used to determine the position
and size of the arrows.</p>
<h2 class="md-heading" id="labels"><a href="#labels">Labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Labels are only available in v4 and higher versions of Pine Script™.
They work very differently than
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>.</p>
<p>Labels are objects, like
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/">lines and boxes</a>, or
<a href="/pine-script-docs/v5/concepts/tables/">tables</a>. Like them, they are
referred to using an ID, which acts like a pointer. Label IDs are of
“label” type. As with other objects, labels IDs are “time series”
and all the functions used to manage them accept “series” arguments,
which makes them very flexible.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>On TradingView charts, a complete set of <em>Drawing Tools</em> allows users to
create and modify drawings using mouse actions. While they may sometimes
look similar to drawing objects created with Pine Script™ code, they are
unrelated entities. Drawing objects created using Pine code cannot be
modified with mouse actions, and hand-drawn drawings from the chart user
interface are not visible from Pine scripts.</p></div></aside>
<p>Labels are advantageous because:</p>
<ul>
<li>They allow “series” values to be converted to text and placed on
charts. This means they are ideal to display values that cannot be
known before time, such as price values, support and resistance
levels, of any other values that your script calculates.</li>
<li>Their positioning options are more flexible that those of the
<code dir="auto">plot*()</code> functions.</li>
<li>They offer more display modes.</li>
<li>Contrary to <code dir="auto">plot*()</code> functions, label-handling functions can be
inserted in conditional or loop structures, making it easier to
control their behavior.</li>
<li>You can add tooltips to labels.</li>
</ul>
<p>One drawback to using labels versus
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
is that you can only draw a limited quantity of them on the chart. The
default is ~50, but you can use the <code dir="auto">max_labels_count</code> parameter in
your
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement to specify up to 500. Labels, like
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/">lines and boxes</a>, are
managed using a garbage collection mechanism which deletes the oldest
ones on the chart, such that only the most recently drawn labels are
visible.</p>
<p>Your toolbox of built-ins to manage labels are all in the <code dir="auto">label</code>
namespace. They include:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
to create labels.</li>
<li><code dir="auto">label.set_*()</code> functions to modify the properties of an existing
label.</li>
<li><code dir="auto">label.get_*()</code> functions to read the properties of an existing
label.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Ddelete">label.delete()</a>
to delete labels</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_label%7Bdot%7Dall">label.all</a>
array which always contains the IDs of all the visible labels on the
chart. The array’s size will depend on the maximum label count for
your script and how many of those you have drawn.
<code dir="auto">aray.size(label.all)</code> will return the array’s size.</li>
</ul>
<h3 class="md-heading" id="creating-and-modifying-labels"><a href="#creating-and-modifying-labels">Creating and modifying labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
function creates a new label. It has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">label.new(x, y, text, xloc, yloc, color, style, textcolor, size, textalign, tooltip, force_overylay) → series label</span></div></div></code></pre></figure></div>
<p>The <em>setter</em> functions allowing you to change a label’s properties are:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_x">label.set_x()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_y">label.set_y()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xy">label.set_xy()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_text">label.set_text()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xloc">label.set_xloc()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_yloc">label.set_yloc()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_color">label.set_color()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_style">label.set_style()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_textcolor">label.set_textcolor()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_size">label.set_size()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_set_textalign">label.set_textalign()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_tooltip">label.set_tooltip()</a></li>
</ul>
<p>They all have a similar signature. The one for
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_color">label.set_color()</a>
is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">label.set_color(id, color) → void</span></div></div></code></pre></figure></div>
<p>where:</p>
<ul>
<li><code dir="auto">id</code> is the ID of the label whose property is to be modified.</li>
<li>The next parameter is the property of the label to modify. It
depends on the setter function used.
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xy">label.set_xy()</a>
changes two properties, so it has two such parameters.</li>
</ul>
<p>This is how you can create labels in their simplest form:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
label.new(bar_index, high)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="530" loading="lazy" src="images/22b45965179559e71b6ec484a49aa933.webp" width="1764"/></div></p>
<p>Note that:</p>
<ul>
<li>The label is created with the parameters <code dir="auto">x = bar_index</code> (the index
of the current bar,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>)
and <code dir="auto">y = high</code> (the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
value).</li>
<li>We do not supply an argument for the function’s <code dir="auto">text</code> parameter.
Its default value being an empty string, no text is displayed.</li>
<li>No logic controls our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
call, so labels are created on every bar.</li>
<li>Only the last 54 labels are displayed because our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
call does not use the <code dir="auto">max_labels_count</code> parameter to specify a
value other than the ~50 default.</li>
<li>Labels persist on bars until your script deletes them using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Ddelete">label.delete()</a>,
or garbage collection removes them.</li>
</ul>
<p>In the next example we display a label on the bar with the highest
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
value in the last 50 bars:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)

// Find the highest `high` in last 50 bars and its offset. Change it's sign so it is positive.
LOOKBACK = 50
hi = ta.highest(LOOKBACK)
highestBarOffset = - ta.highestbars(LOOKBACK)

// Create label on bar zero only.
var lbl = label.new(na, na, "", color = color.orange, style = label.style_label_lower_left)
// When a new high is found, move the label there and update its text and tooltip.
if ta.change(hi)
    // Build label and tooltip strings.
    labelText = "High: " + str.tostring(hi, format.mintick)
    tooltipText = "Offest in bars: " + str.tostring(highestBarOffset) + "\nLow: " + str.tostring(low[highestBarOffset], format.mintick)
    // Update the label's position, text and tooltip.
    label.set_xy(lbl, bar_index[highestBarOffset], hi)
    label.set_text(lbl, labelText)
    label.set_tooltip(lbl, tooltipText)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="644" loading="lazy" src="images/edf2a5db8d4ef69515f9b22867fef6f7.webp" width="1766"/></div></p>
<p>Note that:</p>
<ul>
<li>We create the label on the first bar only by using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to declare the <code dir="auto">lbl</code> variable that contains the label’s ID.
The <code dir="auto">x</code>, <code dir="auto">y</code> and <code dir="auto">text</code> arguments in that
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
call are irrelevant, as the label will be updated on further bars.
We do, however, take care to use the <code dir="auto">color</code> and <code dir="auto">style</code> we want for
the labels, so they don’t need updating later.</li>
<li>On every bar, we detect if a new high was found by testing for
changes in the value of <code dir="auto">hi</code></li>
<li>When a change in the high value occurs, we update our label with new
information. To do this, we use three <code dir="auto">label.set*()</code> calls to change
the label’s relevant information. We refer to our label using the
<code dir="auto">lbl</code> variable, which contains our label’s ID. The script is thus
maintaining the same label throughout all bars, but moving it and
updating its information when a new high is detected.</li>
</ul>
<p>Here we create a label on each bar, but we set its properties
conditionally, depending on the bar’s polarity:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
lbl = label.new(bar_index, na)
if close &gt;= open
    label.set_text( lbl, "green")
    label.set_color(lbl, color.green)
    label.set_yloc( lbl, yloc.belowbar)
    label.set_style(lbl, label.style_label_up)
else
    label.set_text( lbl, "red")
    label.set_color(lbl, color.red)
    label.set_yloc( lbl, yloc.abovebar)
    label.set_style(lbl, label.style_label_down)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="642" loading="lazy" src="images/99d015c2c6185f5ea3e065d4aec1f3d9.webp" width="1766"/></div></p>
<h3 class="md-heading" id="positioning-labels"><a href="#positioning-labels">Positioning labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Labels are positioned on the chart according to <em>x</em> (bars) and <em>y</em>
(price) coordinates. Five parameters affect this behavior: <code dir="auto">x</code>, <code dir="auto">y</code>,
<code dir="auto">xloc</code>, <code dir="auto">yloc</code> and <code dir="auto">style</code>:</p>
<p><code dir="auto">x</code></p>
<p>Is either a bar index or a time value. When a bar index is used, the
value can be offset in the past or in the future (maximum of 500
bars in the future). Past or future offsets can also be calculated
when using time values. The <code dir="auto">x</code> value of an existing label can be
modified using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_x">label.set_x()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xy">label.set_xy()</a>.</p>
<p><code dir="auto">xloc</code></p>
<p>Is either
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_index">xloc.bar_index</a>
(the default) or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>.
It determines which type of argument must be used with <code dir="auto">x</code>. With
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_index">xloc.bar_index</a>,
<code dir="auto">x</code> must be an absolute bar index. With
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>,
<code dir="auto">x</code> must be a UNIX time in milliseconds corresponding to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
value of a bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>.
The <code dir="auto">xloc</code> value of an existing label can be modified using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xloc">label.set_xloc()</a>.</p>
<p><code dir="auto">y</code></p>
<p>Is the price level where the label is positioned. It is only taken
into account with the default <code dir="auto">yloc</code> value of <code dir="auto">yloc.price</code>. If
<code dir="auto">yloc</code> is
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dabovebar">yloc.abovebar</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dbelowbar">yloc.belowbar</a>
then the <code dir="auto">y</code> argument is ignored. The <code dir="auto">y</code> value of an existing label
can be modified using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_y">label.set_y()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_xy">label.set_xy()</a>.</p>
<p><code dir="auto">yloc</code></p>
<p>Can be
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dprice">yloc.price</a>
(the default),
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dabovebar">yloc.abovebar</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dbelowbar">yloc.belowbar</a>.
The argument used for <code dir="auto">y</code> is only taken into account with
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dprice">yloc.price</a>.
The <code dir="auto">yloc</code> value of an existing label can be modified using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_yloc">label.set_yloc()</a>.</p>
<p><code dir="auto">style</code></p>
<p>The argument used has an impact on the visual appearance of the
label and on its position relative to the reference point determined
by either the <code dir="auto">y</code> value or the top/bottom of the bar when
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dabovebar">yloc.abovebar</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_yloc%7Bdot%7Dbelowbar">yloc.belowbar</a>
are used. The <code dir="auto">style</code> of an existing label can be modified using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dset_style">label.set_style()</a>.</p>
<p>These are the available <code dir="auto">style</code> arguments:</p>
<table><thead><tr><th>Argument</th><th>Label</th><th>Label with text</th><th>Argument</th><th>Label</th><th>Label with text</th></tr></thead><tbody><tr><td><code dir="auto">label.style_xcross</code></td><td><div class="image-container"><img alt="label_style_xcross" decoding="async" height="43" loading="lazy" src="images/b97f504c0b13932495fd98aac57de178.webp" width="45"/></div></td><td><div class="image-container"><img alt="label_style_xcross_t" decoding="async" height="58" loading="lazy" src="images/9169d7a4e0fc416efaff6eb9cab37cde.webp" width="39"/></div></td><td><code dir="auto">label.style_label_up</code></td><td><div class="image-container"><img alt="label_style_label_up" decoding="async" height="32" loading="lazy" src="images/e5cd09775ed0d7d7b1cee1687caa7b1f.webp" width="26"/></div></td><td><div class="image-container"><img alt="label_style_label_up_t" decoding="async" height="39" loading="lazy" src="images/c2a556e7e2cb302f38004b8ccd2fa20f.webp" width="55"/></div></td></tr><tr><td><code dir="auto">label.style_cross</code></td><td><div class="image-container"><img alt="label_style_cross" decoding="async" height="33" loading="lazy" src="images/e9ea429ded0bf48b8f7e99e1c658e4eb.webp" width="38"/></div></td><td><div class="image-container"><img alt="label_style_cross_t" decoding="async" height="57" loading="lazy" src="images/7cd345a0d2fb418767c7fc3d2ffff726.webp" width="41"/></div></td><td><code dir="auto">label.style_label_down</code></td><td><div class="image-container"><img alt="label_style_label_down" decoding="async" height="31" loading="lazy" src="images/adeee0efe52aa2e09831e676fca7f841.webp" width="26"/></div></td><td><div class="image-container"><img alt="label_style_label_down_t" decoding="async" height="40" loading="lazy" src="images/ec5a0bc757ba52f90bb02329866b6373.webp" width="49"/></div></td></tr><tr><td><code dir="auto">label.style_flag</code></td><td><div class="image-container"><img alt="label_style_flag" decoding="async" height="41" loading="lazy" src="images/9b01632ce5714f0512ef98bf17dac586.webp" width="43"/></div></td><td><div class="image-container"><img alt="label_style_flag_t" decoding="async" height="60" loading="lazy" src="images/8ffc9ff834fb5195796207bdbd3a3261.webp" width="40"/></div></td><td><code dir="auto">label.style_label_left</code></td><td><div class="image-container"><img alt="label_style_label_left" decoding="async" height="35" loading="lazy" src="images/c28aa566928ca403b6603997d9811cfd.webp" width="34"/></div></td><td><div class="image-container"><img alt="label_style_label_left_t" decoding="async" height="57" loading="lazy" src="images/8e33cf17c6f95768eabe3a0c736787f2.webp" width="70"/></div></td></tr><tr><td><code dir="auto">label.style_circle</code></td><td><div class="image-container"><img alt="label_style_circle" decoding="async" height="40" loading="lazy" src="images/225cf2ee58eadf77e844eef797662202.webp" width="40"/></div></td><td><div class="image-container"><img alt="label_style_circle_t" decoding="async" height="61" loading="lazy" src="images/a76e6d75a21122955aaebb726939733c.webp" width="38"/></div></td><td><code dir="auto">label.style_label_right</code></td><td><div class="image-container"><img alt="label_style_label_right" decoding="async" height="36" loading="lazy" src="images/2e4027118fd054efe66f3227c887aad9.webp" width="33"/></div></td><td><div class="image-container"><img alt="label_style_label_right_t" decoding="async" height="55" loading="lazy" src="images/139360a05d71ea13406a5cd3a5efdcb2.webp" width="65"/></div></td></tr><tr><td><code dir="auto">label.style_square</code></td><td><div class="image-container"><img alt="label_style_square" decoding="async" height="34" loading="lazy" src="images/c098ee6d75cc4c089b4e4ad8ffe35860.webp" width="36"/></div></td><td><div class="image-container"><img alt="label_style_square_t" decoding="async" height="61" loading="lazy" src="images/709743d6c5d97f6b68c90ce361e45c09.webp" width="36"/></div></td><td><code dir="auto">label.style_label_lower_left</code></td><td><div class="image-container"><img alt="label_style_label_lower_left" decoding="async" height="37" loading="lazy" src="images/7b67a43a224297e24338725ea09c8528.webp" width="33"/></div></td><td><div class="image-container"><img alt="label_style_label_lower_left_t" decoding="async" height="54" loading="lazy" src="images/f5ee00bac0a8ba575a054a8097507e0b.webp" width="67"/></div></td></tr><tr><td><code dir="auto">label.style_diamond</code></td><td><div class="image-container"><img alt="label_style_diamond" decoding="async" height="38" loading="lazy" src="images/a7d18033de81f808853d938b7b667b0f.webp" width="36"/></div></td><td><div class="image-container"><img alt="label_style_diamond_t" decoding="async" height="60" loading="lazy" src="images/6b49f894dd2ab44630ab512c6b90f589.webp" width="40"/></div></td><td><code dir="auto">label.style_label_lower_right</code></td><td><div class="image-container"><img alt="label_style_label_lower_right" decoding="async" height="40" loading="lazy" src="images/ddab429feb3475f0564a191cb41a9d4c.webp" width="35"/></div></td><td><div class="image-container"><img alt="label_style_label_lower_right_t" decoding="async" height="56" loading="lazy" src="images/d00d052d5b02b7903b8488bc0112a5f9.webp" width="68"/></div></td></tr><tr><td><code dir="auto">label.style_triangleup</code></td><td><div class="image-container"><img alt="label_style_triangleup" decoding="async" height="39" loading="lazy" src="images/92779d564680d1b1071ff7b9179c574a.webp" width="36"/></div></td><td><div class="image-container"><img alt="label_style_triangleup_t" decoding="async" height="54" loading="lazy" src="images/ae0aaeb8df3f4a5fc1e0df990acfc10a.webp" width="42"/></div></td><td><code dir="auto">label.style_label_upper_left</code></td><td><div class="image-container"><img alt="label_style_label_upper_left" decoding="async" height="37" loading="lazy" src="images/cd55abb6889d95bf1e587d957f06745c.webp" width="30"/></div></td><td><div class="image-container"><img alt="label_style_label_upper_left_t" decoding="async" height="50" loading="lazy" src="images/90d4942831d470004269128055f5f8b4.webp" width="64"/></div></td></tr><tr><td><code dir="auto">label.style_triangledown</code></td><td><div class="image-container"><img alt="label_style_triangledown" decoding="async" height="34" loading="lazy" src="images/2b552811defe598eff93e0b29efc6aee.webp" width="40"/></div></td><td><div class="image-container"><img alt="label_style_triangledown_t" decoding="async" height="61" loading="lazy" src="images/8ad8060dd8196a49707f43a64c14e9a3.webp" width="42"/></div></td><td><code dir="auto">label.style_label_upper_right</code></td><td><div class="image-container"><img alt="label_style_label_upper_right" decoding="async" height="37" loading="lazy" src="images/7e5a8a953684fca6e77b2a1d7709adba.webp" width="28"/></div></td><td><div class="image-container"><img alt="label_style_label_upper_right_t" decoding="async" height="50" loading="lazy" src="images/29f7751cb6676f9e8f072837b473f62b.webp" width="63"/></div></td></tr><tr><td><code dir="auto">label.style_arrowup</code></td><td><div class="image-container"><img alt="label_style_arrowup" decoding="async" height="36" loading="lazy" src="images/ff2e68bd0fc8fc779a01ec193d533c26.webp" width="35"/></div></td><td><div class="image-container"><img alt="label_style_arrowup_t" decoding="async" height="54" loading="lazy" src="images/f0d151910acea9f04b5083ea6ef736d9.webp" width="40"/></div></td><td><code dir="auto">label.style_label_center</code></td><td><div class="image-container"><img alt="label_style_label_center" decoding="async" height="38" loading="lazy" src="images/cb8112ef259ff70c25403e0c3ee020aa.webp" width="34"/></div></td><td><div class="image-container"><img alt="label_style_label_center_t" decoding="async" height="51" loading="lazy" src="images/86c7c4cf55fc10d3f72d6297e55295ca.webp" width="65"/></div></td></tr><tr><td><code dir="auto">label.style_arrowdown</code></td><td><div class="image-container"><img alt="label_style_arrowdown" decoding="async" height="35" loading="lazy" src="images/45cc05f0494174d9de5135bc95d90f42.webp" width="35"/></div></td><td><div class="image-container"><img alt="label_style_arrowdown_t" decoding="async" height="56" loading="lazy" src="images/f4c1fd3b0dcfe50b538bcffd4e8e7884.webp" width="37"/></div></td><td><code dir="auto">label.style_none</code></td><td></td><td><div class="image-container"><img alt="label_style_none_t" decoding="async" height="15" loading="lazy" src="images/b4ab0494132870cd362d21f2809ed170.webp" width="32"/></div></td></tr></tbody></table>
<p>When using
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc%7Bdot%7Dbar_time">xloc.bar_time</a>,
the <code dir="auto">x</code> value must be a UNIX timestamp in milliseconds. See the page on
<a href="/pine-script-docs/v5/concepts/time/">Time</a> for more information.
The start time of the current bar can be obtained from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
built-in variable. The bar time of previous bars is <code dir="auto">time[1]</code>, <code dir="auto">time[2]</code>
and so on. Time can also be set to an absolute value with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp</a>
function. You may add or subtract periods of time to achieve relative
time offset.</p>
<p>Let’s position a label one day ago from the date on the last bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("")
daysAgoInput = input.int(1, tooltip = "Use negative values to offset in the future")
if barstate.islast
    MS_IN_ONE_DAY = 24 * 60 * 60 * 1000
    oneDayAgo = time - (daysAgoInput * MS_IN_ONE_DAY)
    label.new(oneDayAgo, high, xloc = xloc.bar_time, style = label.style_label_right)</code></div>
<p>Note that because of varying time gaps and missing bars when markets are
closed, the positioning of the label may not always be exact. Time
offsets of the sort tend to be more reliable on 24x7 markets.</p>
<p>You can also offset using a bar index for the <code dir="auto">x</code> value, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">label.new(bar_index + 10, high)
label.new(bar_index - 10, high[10])
label.new(bar_index[10], high[10])</code></div>
<h3 class="md-heading" id="reading-label-properties"><a href="#reading-label-properties">Reading label properties<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The following <em>getter</em> functions are available for labels:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dget_x">label.get_x()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dget_y">label.get_y()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dget_text">label.get_text()</a></li>
</ul>
<p>They all have a similar signature. The one for
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dget_text">label.get_text()</a>
is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">label.get_text(id) → series string</span></div></div></code></pre></figure></div>
<p>where <code dir="auto">id</code> is the label whose text is to be retrieved.</p>
<h3 class="md-heading" id="cloning-labels"><a href="#cloning-labels">Cloning labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dcopy">label.copy()</a>
function is used to clone labels. Its syntax is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">label.copy(id) → void</span></div></div></code></pre></figure></div>
<h3 class="md-heading" id="deleting-labels"><a href="#deleting-labels">Deleting labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Ddelete">label.delete()</a>
function is used to delete labels. Its syntax is:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">label.delete(id) → void</span></div></div></code></pre></figure></div>
<p>To keep only a user-defined quantity of labels on the chart, one could
use code like this:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
MAX_LABELS = 500
indicator("", max_labels_count = MAX_LABELS)
qtyLabelsInput = input.int(5, "Labels to keep", minval = 0, maxval = MAX_LABELS)
myRSI = ta.rsi(close, 20)
if myRSI &gt; ta.highest(myRSI, 20)[1]
    label.new(bar_index, myRSI, str.tostring(myRSI, "#.00"), style = label.style_none)
    if array.size(label.all) &gt; qtyLabelsInput
        label.delete(array.get(label.all, 0))
plot(myRSI)</code></div>
<p><div class="image-container"><img alt="image" decoding="async" height="644" loading="lazy" src="images/b88bd5dc7713905396f14d3383015b96.webp" width="1764"/></div></p>
<p>Note that:</p>
<ul>
<li>We define a <code dir="auto">MAX_LABELS</code> constant to hold the maximum quantity of
labels a script can accommodate. We use that value to set the
<code dir="auto">max_labels_count</code> parameter’s value in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
call, and also as the <code dir="auto">maxval</code> value in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dint">input.int()</a>
call to cap the user value.</li>
<li>We create a new label when our RSI breaches its highest value of the
last 20 bars. Note the offset of <code dir="auto">[1]</code> we use in
<code dir="auto">if myRSI &gt; ta.highest(myRSI, 20)[1]</code>. This is necessary. Without
it, the value returned by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta%7Bdot%7Dhighest">ta.highest()</a>
would always include the current value of <code dir="auto">myRSI</code>, so <code dir="auto">myRSI</code> would
never be higher than the function’s return value.</li>
<li>After that, we delete the oldest label in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_label%7Bdot%7Dall">label.all</a>
array that is automatically maintained by the Pine Script™ runtime
and contains the ID of all the visible labels drawn by our script.
We use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dget">array.get()</a>
function to retrieve the array element at index zero (the oldest
visible label ID). We then use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Ddelete">label.delete()</a>
to delete the label linked with that ID.</li>
</ul>
<p>Note that if one wants to position a label on the last bar only, it is
unnecessary and inefficent to create and delete the label as the script
executes on all bars, so that only the last label remains:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// INEFFICENT!
//@version=5
indicator("", "", true)
lbl = label.new(bar_index, high, str.tostring(high, format.mintick))
label.delete(lbl[1])</code></div>
<p>This is the efficient way to realize the same task:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
if barstate.islast
    // Create the label once, the first time the block executes on the last bar.
    var lbl = label.new(na, na)
    // On all iterations of the script on the last bar, update the label's information.
    label.set_xy(lbl, bar_index, high)
    label.set_text(lbl, str.tostring(high, format.mintick))</code></div>
<h3 class="md-heading" id="realtime-behavior"><a href="#realtime-behavior">Realtime behavior<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Labels are subject to both <em>commit</em> and <em>rollback</em> actions, which affect
the behavior of a script when it executes in the realtime bar. See the
page on Pine Script™‘s
<a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>.</p>
<p>This script demonstrates the effect of rollback when running in the
realtime bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("", "", true)
label.new(bar_index, high)</code></div>
<p>On realtime bars,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a>
creates a new label on every script update, but because of the rollback
process, the label created on the previous update on the same bar is
deleted. Only the last label created before the realtime bar’s close
will be committed, and thus persist.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/tables"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Tables  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/time"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Time <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Time</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-time"><a href="#time">Time<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In Pine Script™, the following key aspects apply when working with date and time values:</p>
<ul>
<li><strong>UNIX timestamp</strong>: The native format for time values in Pine, representing the absolute number of <em>milliseconds</em> elapsed since midnight <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" rel="nofollow">UTC</a> on 1970-01-01. Several built-ins return UNIX timestamps directly, which users can <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">format</a> into readable dates and times. See the <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> section below for more information.</li>
<li><strong>Exchange time zone</strong>: The <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a> of the instrument’s exchange. All <a href="/pine-script-docs/v5/concepts/time/#calendar-based-variables">calendar-based variables</a> hold values expressed in the exchange time zone, and all built-in function overloads that have a <code dir="auto">timezone</code> parameter use this time zone by default.</li>
<li><strong>Chart time zone</strong>: The time zone the chart and <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> message prefixes use to express time values. Users can set the chart time zone using the “Timezone” input in the “Symbol” tab of the chart’s settings. This setting only changes the <em>display</em> of dates and times on the chart and the times that prefix logged messages. It does <strong>not</strong> affect the behavior of Pine scripts because they cannot access a chart’s time zone information.</li>
<li><strong><code dir="auto">timezone</code> parameter</strong>: A “string” parameter of time-related functions that specifies the time zone used in their calculations. For <a href="/pine-script-docs/v5/concepts/time/#calendar-based-functions">calendar-based functions</a>, such as <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a>, the <code dir="auto">timezone</code> parameter determines the time zone of the returned value. For functions that return UNIX timestamps, such as <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>, the specified <code dir="auto">timezone</code> defines the time zone of other applicable parameters, e.g., <code dir="auto">session</code>. See the <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">Time zone strings</a> section to learn more.</li>
</ul>
<h2 class="md-heading" id="unix-timestamps"><a href="#unix-timestamps">UNIX timestamps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="https://en.wikipedia.org/wiki/Unix_time" rel="nofollow">UNIX time</a> is a standardized date and time representation that measures the number of <em>non-leap seconds</em> elapsed since January 1, 1970 at 00:00:00 <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" rel="nofollow">UTC</a> (the <em>UNIX Epoch</em>), typically expressed in seconds or smaller time units. A UNIX time value in Pine Script™ is an “int” <em>timestamp</em> representing the number of <em>milliseconds</em> from the UNIX Epoch to a specific point in time.</p>
<p>Because a UNIX timestamp represents the number of consistent time units elapsed from a fixed historical point (epoch), its value is <strong>time zone-agnostic</strong>. A UNIX timestamp in Pine always corresponds to the same distinct point in time, accurate to the millisecond, regardless of a user’s location.</p>
<p>For example, the UNIX timestamp <code dir="auto">1723472500000</code> always represents the time 1,723,472,500,000 milliseconds (1,723,472,500 seconds) after the UNIX Epoch. This timestamp’s meaning does <strong>not</strong> change relative to any <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>.</p>
<p>To <em>format</em> an “int” UNIX timestamp into a readable date/time “string” expressed in a specific time zone, use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function. The function does not <em>modify</em> UNIX timestamps. It simply <em>represents</em> timestamps in a desired human-readable format.</p>
<p>For instance, the function can represent the UNIX timestamp <code dir="auto">1723472500000</code> as a “string” in several ways, depending on its <code dir="auto">format</code> and <code dir="auto">timezone</code> arguments, without changing the <em>absolute</em> point in time that it refers to. The simple script below calculates three valid representations of this timestamp and displays them in the <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="316" loading="lazy" src="images/a25fe277d368731de7a934205316707e.webp" width="1040"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("UNIX timestamps demo")

//@variable A UNIX time value representing the specific point 1,723,472,500,000 ms after the UNIX Epoch. 
int unixTimestamp = 1723472500000

// These are a few different ways to express the `unixTimestamp` in a relative, human-readable format.
// Despite their format and time zone differences, all the calculated strings represent the SAME distinct point: 
string isoExchange  = str.format_time(unixTimestamp)
string utcDateTime  = str.format_time(unixTimestamp, "MM/dd/yyyy HH:mm:ss.S", "UTC+0")
string utc4TimeDate = str.format_time(unixTimestamp, "hh:mm:ss a, MMMM dd, yyyy z", "UTC+4")

// Log the `unixTimestamp` and the custom "string" representations on the first bar.
if barstate.isfirst
    log.info(
         "\nUNIX time (ms): {0, number, #}\n
         ISO 8601 representation (Exchange time zone): {1}\n
         Custom date and time representation (UTC+0 time zone): {2}\n
         Custom time and date representation (UTC+4 time zone): {3}",
         unixTimestamp, isoExchange, utcDateTime, utc4TimeDate
     )</code></div>
<p>Note that:</p>
<ul>
<li>The value enclosed within square brackets in the logged message is an <em>automatic</em> prefix representing the historical time of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a> call in <a href="https://en.wikipedia.org/wiki/ISO_8601" rel="nofollow">ISO 8601</a> format, expressed in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">chart time zone</a>.</li>
</ul>
<p>See the <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">Formatting dates and times</a> section to learn more about representing UNIX timestamps with formatted strings.</p>
<h2 class="md-heading" id="time-zones"><a href="#time-zones">Time zones<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A <a href="https://en.wikipedia.org/wiki/Time_zone" rel="nofollow">time zone</a> is a geographic region with an assigned <em>local time</em>. The specific time within a time zone is consistent throughout the region. Time zone boundaries typically relate to a location’s longitude. However, in practice, they tend to align with administrative boundaries rather than strictly following longitudinal lines.</p>
<p>The local time within a time zone depends on its defined <em>offset</em> from <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" rel="nofollow">Coordinated Universal Time (UTC)</a>, which can range from UTC-12:00 (12 hours <em>behind</em> UTC) to UTC+14:00 (14 hours <em>ahead</em> of UTC). Some regions maintain a consistent offset from UTC, and others have an offset that changes over time due to <a href="https://en.wikipedia.org/wiki/Daylight_saving_time" rel="nofollow">daylight saving time (DST)</a> and other factors.</p>
<p>Two primary time zones apply to data feeds and TradingView charts: the <em>exchange time zone</em> and the <em>chart time zone</em>.</p>
<p>The exchange time zone represents the time zone of the current symbol’s <em>exchange</em>, which Pine scripts can access with the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> variable. <a href="/pine-script-docs/v5/concepts/time/#calendar-based-variables">Calendar-based variables</a>, such as <a href="https://www.tradingview.com/pine-script-reference/v5/#var_month">month</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofweek">dayofweek</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hour">hour</a>, always hold values expressed in the exchange time zone, and all time function overloads that have a <code dir="auto">timezone</code> parameter use this time zone by default.</p>
<p>The chart time zone is a <em>visual preference</em> that defines how the chart and the time prefixes of <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> represent time values. To set the chart time zone, use the “Timezone” input in the “Symbol” tab of the chart’s settings or click on the current time shown below the chart. The specified time zone does <strong>not</strong> affect time calculations in Pine scripts because they cannot access this chart information. Although scripts cannot access a chart’s time zone, programmers can provide <a href="/pine-script-docs/v5/concepts/inputs/">inputs</a> that users can adjust to match the time zone.</p>
<p>For example, the script below uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> to represent the <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> of the last historical bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">opening time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">closing time</a> as date-time strings, expressed in the function’s default time zone, the exchange time zone, UTC-0, and a user-specified time zone. It displays all four representations for comparison within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> in the bottom-right corner of the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="506" loading="lazy" src="images/b0d3097af698a907236ab98b9d83114e.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Time zone comparison demo", overlay = true) 

//@variable The time zone of the time values in the last table row. 
//          The "string" can contain either UTC offset notation or an IANA time zone identifier. 
string timezoneInput = input.string("UTC+4:00", "Time zone")

//@variable A `table` showing strings representing bar times in three preset time zones and a custom time zone. 
var table displayTable = table.new(
     position.bottom_right, columns = 3, rows = 5, border_color = chart.fg_color, border_width = 2
 )

//@function Initializes three `displayTable` cells on the `row` that show the `title`, `text1`, and `text2` strings. 
tableRow(int row, string title, string text1, string text2, color titleColor = #9b27b066, color infoColor = na) =&gt;
    displayTable.cell(0, row, title, bgcolor = titleColor, text_color = chart.fg_color)
    displayTable.cell(1, row, text1, bgcolor = infoColor,  text_color = chart.fg_color)
    displayTable.cell(2, row, text2, bgcolor = infoColor,  text_color = chart.fg_color)

if barstate.islastconfirmedhistory
    // Draw an empty label to signify the bar that the displayed time strings represent.
    label.new(bar_index, high, color = #9b27b066, size = size.huge)

    //@variable The formatting string for all `str.format_time()` calls. Sets the format of the date-time strings. 
    var string formatString = "yyyy-MM-dd  HH:mm:ss"
    // Initialize a header row at the top of the `displayTable`.
    tableRow(0, "", "OPEN time", "CLOSE time", na, #9b27b066)
    // Initialize a row showing the bar's times in the default time zone (no specified `timezone` arguments).
    tableRow(1, "Default", str.format_time(time, formatString), str.format_time(time_close, formatString))
    // Initialize a row showing the bar's times in the exchange time zone (`syminfo.timezone`).
    tableRow(2, "Exchange: " + syminfo.timezone, 
         str.format_time(time, formatString, syminfo.timezone),
         str.format_time(time_close, formatString, syminfo.timezone)
     )  
    // Initialize a row showing the bar's times in the UTC-0 time zone (using "UTC" as the `timezone` arguments).
    tableRow(3, "UTC-0", str.format_time(time, formatString, "UTC"), str.format_time(time_close, formatString, "UTC"))
    
    // Initialize a row showing the bar's times in the custom time zone (`timezoneInput`).
    tableRow(
         4, "Custom: " + timezoneInput, 
         str.format_time(time, formatString, timezoneInput), 
         str.format_time(time_close, formatString, timezoneInput)
     )</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> on the chart signifies which bar’s times the displayed strings represent.</li>
<li>The “Default” and “Exchange” rows in the table show identical results because <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> is the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function’s default <code dir="auto">timezone</code> argument.</li>
<li>The exchange time zone on our example chart appears as <code dir="auto">"America/New_York"</code>, the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" rel="nofollow">IANA identifier</a> for the NASDAQ exchange’s time zone. It represents UTC-4 <em>or</em> UTC-5, depending on the time of year. See the <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">next section</a> to learn more about time zone strings.</li>
</ul>
<h3 class="md-heading" id="time-zone-strings"><a href="#time-zone-strings">Time zone strings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>All built-in functions with a <code dir="auto">timezone</code> parameter accept a “string” argument specifying the <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a> they use in their calculations. These functions can accept time zone strings in either of the following formats:</p>
<ul>
<li><strong>UTC</strong> (or <em>GMT</em>) offset notation, e.g., <code dir="auto">"UTC-5"</code>, <code dir="auto">"UTC+05:30"</code>, <code dir="auto">"GMT+0100"</code></li>
<li><strong>IANA database</strong> notation, e.g., <code dir="auto">"America/New_York"</code>, <code dir="auto">"Asia/Calcutta"</code>, <code dir="auto">"Europe/Paris"</code></li>
</ul>
<p>The <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" rel="nofollow">IANA time zone database</a> reference page lists possible time zone identifiers and their respective UTC offsets. The listed identifiers are valid as <code dir="auto">timezone</code> arguments.</p>
<p>Note that various time zone strings expressed in UTC or IANA notation can represent the <em>same</em> offset from Coordinated Universal Time. For instance, these strings all represent a local time three hours ahead of UTC:</p>
<ul>
<li><code dir="auto">"UTC+3"</code></li>
<li><code dir="auto">"GMT+03:00"</code></li>
<li><code dir="auto">"Asia/Kuwait"</code></li>
<li><code dir="auto">"Europe/Moscow"</code></li>
<li><code dir="auto">"Africa/Nairobi"</code></li>
</ul>
<p>For the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function and the functions that calculate calendar-based values from a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a>, including <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a>, the “string” passed to the <code dir="auto">timezone</code> parameter changes the returned value’s calculation to express the result in the specified time zone. See the <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">Formatting dates and times</a> and <a href="/pine-script-docs/v5/concepts/time/#calendar-based-functions">Calendar-based functions</a> sections for more information.</p>
<p>The example below shows how time zone strings affect the returned values of calendar-based functions. This script uses three <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a> function calls to calculate “int” values representing the opening hour of each bar in the exchange time zone, UTC-0, and a user-specified UTC offset. It plots all three calculated hours in a separate pane for comparison:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/bcfad32c2a8107a463089cd81b0c0c42.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Time zone strings in calendar functions demo")

//@variable An "int" representing the user-specified hourly offset from UTC. 
int utcOffsetInput = input.int(defval = 4, title ="Timezone offset UTC (+/-)", minval = -12, maxval = 14)

//@variable A valid time zone string based on the `utcOffsetInput`, in UTC offset notation (e.g., "UTC-4").
string customOffset = "UTC" + (utcOffsetInput &gt; 0 ? "+" : "") + str.tostring(utcOffsetInput)

//@variable The bar's opening hour in the exchange time zone (default). Equivalent to the `hour` variable.
int exchangeHour = hour(time)
//@variable The bar's opening hour in the "UTC-0" time zone. 
int utcHour = hour(time, "UTC-0")
//@variable The bar's opening hour in the `customOffset` time zone.
int customOffsetHour = hour(time, customOffset)

// Plot the `exchangeHour`, `utcHour`, and `customOffsetHour` for comparison.
plot(exchangeHour,     "Exchange hour",      #E100FF5B,    8)
plot(utcHour,          "UTC-0 hour",         color.blue,   3)
plot(customOffsetHour, "Custom offset hour", color.orange, 3)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">exchangeHour</code> value is four <em>or</em> five hours behind the <code dir="auto">utcHour</code> because the NASDAQ exchange is in the “America/New_York” time zone. This time zone has a UTC offset that <em>changes</em> during the year due to daylight saving time (DST). The script’s default <code dir="auto">customOffsetHour</code> is consistently four hours ahead of the <code dir="auto">utcHour</code> because its time zone is UTC+4.</li>
<li>The call to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a> function without a specified <code dir="auto">timezone</code> argument returns the same value that the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hour">hour</a> <em>variable</em> holds because both represent the bar’s opening hour in the exchange time zone (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a>).</li>
</ul>
<p>For functions that return <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> directly, such as <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a>, the <code dir="auto">timezone</code> parameter defines the time zone of the function’s calendar-based <em>parameters</em>, including <code dir="auto">session</code>, <code dir="auto">year</code>, <code dir="auto">month</code>, <code dir="auto">day</code>, <code dir="auto">hour</code>, <code dir="auto">minute</code>, and <code dir="auto">second</code>. The parameter does <em>not</em> determine the time zone of the returned value, as UNIX timestamps are <em>time zone-agnostic</em>. See the <a href="/pine-script-docs/v5/concepts/time/#testing-for-sessions">Testing for sessions</a> and <a href="/pine-script-docs/v5/concepts/time/#timestamp">`timestamp()`</a> sections to learn more.</p>
<p>The following script calls the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function to calculate the UNIX timestamp of a specific date and time, and it draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> at the timestamp’s corresponding bar location. The user-selected <code dir="auto">timezone</code> argument (<code dir="auto">timezoneInput</code>) determines the time zone of the call’s calendar-based arguments. Consequently, the calculated timestamp varies with the <code dir="auto">timezoneInput</code> value because identical local times in various time zones correspond to <em>different</em> amounts of time elapsed since the <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX Epoch</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="500" loading="lazy" src="images/68bd68ead38f9fbd5c3373af45c7792d.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Time zone strings in UNIX timestamp functions demo", overlay = true)

//@variable The `timezone` argument of the `timestamp()` call, which sets the time zone of all date and time parameters.
string timezoneInput = input.string("Etc/UTC", "Time zone")

//@variable The UNIX timestamp corresponding to a specific calendar date and time.
//          The specified `year`, `month`, `day`, `hour`, `minute`, and `second` represent calendar values in the 
//          `timezoneInput` time zone. 
//          Different `timezone` arguments produce different UNIX timestamps because an identical date in another 
//          time zone does NOT represent the same absolute point in time.
int unixTimestamp = timestamp(
     timezone = timezoneInput, year = 2024, month = 10, day = 31, hour = 0, minute = 0, second = 0
 )

//@variable The `close` value when the bar's opening time crosses the `unixTimestamp`.
float labelPrice = ta.valuewhen(ta.cross(time, unixTimestamp), close, 0)

// On the last historical bar, draw a label showing the `unixTimestamp` value at the corresponding bar location.
if barstate.islastconfirmedhistory
    label.new(
         unixTimestamp, nz(labelPrice, close), "UNIX timestamp: " + str.tostring(unixTimestamp), 
         xloc.bar_time, yloc.price, chart.fg_color, label.style_label_down, chart.bg_color, size.large
     )</code></div>
<p>Note that:</p>
<ul>
<li><code dir="auto">"Etc/UTC"</code> is the <em>IANA identifier</em> for the UTC+0 time zone.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> call uses <a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc.bar_time">xloc.bar_time</a> as its <code dir="auto">xloc</code> argument, which is required to anchor the drawing to an absolute time value. Without this argument, the function treats the <code dir="auto">unixTimestamp</code> as a relative bar index, leading to an incorrect location.</li>
<li>The label’s <code dir="auto">y</code> value is the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> of the bar where the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">opening time</a> crosses the <code dir="auto">unixTimestamp</code>. If the timestamp represents a future time, the label uses the last historical bar’s price.</li>
</ul>
<p>Although time zone strings can use either UTC or IANA notation, we recommend using <em>IANA notation</em> for <code dir="auto">timezone</code> arguments in most cases, especially if a script’s time calculations must align with the observed time offset in a specific country or subdivision. When a time function call uses an <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" rel="nofollow">IANA time zone identifier</a> for its <code dir="auto">timezone</code> argument, its calculations adjust automatically for historical and future changes to the specified region’s observed time, such as daylight saving time (DST) and updates to time zone boundaries, instead of using a fixed offset from UTC.</p>
<p>The following script demonstrates how UTC and IANA time zone strings can affect time calculations differently. It uses two calls to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a> function to calculate the hour from the current bar’s opening timestamp using <code dir="auto">"UTC-4"</code> and <code dir="auto">"America/New_York"</code> as <code dir="auto">timezone</code> arguments. The script plots the results of both calls for comparison and colors the main pane’s background when the returned values do not match. Although these two <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a> calls may seem similar because UTC-4 is an observed UTC offset in New York, they <em>do not</em> always return the same results, as shown below:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="602" loading="lazy" src="images/4602e0f5295df95714c06002d8513fb8.webp" width="1422"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("UTC vs IANA time zone strings demo")

//@variable The hour of the current `time` in the "UTC-4" time zone. 
//          This variable's value represents the hour in New York only during DST. It is one hour ahead otherwise.
int hourUTC = hour(time, "UTC-4")
//@variable The hour of the current `time` in the "America/New_York" time zone. 
//          This form adjusts to UTC offset changes automatically, so the value always represents the hour in New York. 
int hourIANA = hour(time, "America/New_York")

//@variable Is translucent blue when `hourUTC` does not equal `hourIANA`, `na` otherwise.
color bgColor = hourUTC != hourIANA ? color.rgb(33, 149, 243, 80) : na

// Plot the values of `hourUTC` and `hourIANA` for comparison.
plot(hourUTC,  "UTC-4",            color.blue,   linewidth = 6)
plot(hourIANA, "America/New_York", color.orange, linewidth = 3)
// Highlight the main chart pane with the `bgColor`.
bgcolor(bgColor, title = "Unequal result highlight", force_overlay = true)</code></div>
<p>The plots in the chart above diverge periodically because New York observes daylight saving time, meaning its UTC offset <em>changes</em> at specific points in a year. During DST, New York’s local time follows UTC-4. Otherwise, it follows UTC-5. Because the script’s first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a> call uses <code dir="auto">"UTC-4"</code> as its <code dir="auto">timezone</code> argument, it returns the correct hour in New York <em>only</em> during DST. In contrast, the call that uses the <code dir="auto">"America/New_York"</code> time zone string adjusts its UTC offset automatically to return the correct hour in New York at <em>any</em> time of the year.</p>
<h2 class="md-heading" id="time-variables"><a href="#time-variables">Time variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ has several built-in variables that provide scripts access to different forms of time information:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> variables hold <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> representing the current bar’s opening and closing times, respectively.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> variable holds a UNIX timestamp representing the starting time of the last UTC calendar day in a session.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> variable holds a UNIX timestamp representing the current time when the script executes.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_month">month</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_weekofyear">weekofyear</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofweek">dayofweek</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hour">hour</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_minute">minute</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_second">second</a> variables reference calendar values based on the current bar’s opening time, expressed in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">exchange time zone</a>.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> variable holds a UNIX timestamp representing the last available bar’s opening time.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> variables hold UNIX timestamps representing the opening times of the leftmost and rightmost visible chart bars.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> variable holds a “string” value representing the <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a> of the current symbol’s exchange in <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">IANA database notation</a>. All time-related function overloads with a <code dir="auto">timezone</code> parameter use this variable as the default argument.</li>
</ul>
<h3 class="md-heading" id="time-and-time_close-variables"><a href="#time-and-time_close-variables">`time` and `time_close` variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> variable holds the <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> of the current bar’s <em>opening time</em>, and the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> variable holds the UNIX timestamp of the bar’s <em>closing time</em>.</p>
<p>These timestamps are unique, time zone-agnostic “int” values, which programmers can use to anchor <a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing objects</a> to specific bar times, calculate and inspect bar time differences, construct readable date/time strings with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function, and more.</p>
<p>The script below displays bar opening and closing times in different ways. On each bar, it <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formats</a> the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> timestamps into strings containing the hour, minute, and second in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">exchange time zone</a>, and it draws <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> displaying the formatted strings at the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> prices. Additionally, the script displays strings containing the unformatted UNIX timestamps of the last chart bar within a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> in the bottom-right corner:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="576" loading="lazy" src="images/df2d5d85b4ae40edb8040adb3e827b34.webp" width="1280"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`time` and `time_close` demo", overlay = true, max_labels_count = 500)

//@variable A "string" representing the hour, minute, and second of the bar's opening time in the exchange time zone. 
string openTimeString = str.format_time(time, "HH:mm:ss")
//@variable A "string" representing the hour, minute, and second of the bar's closing time in the exchange time zone.
string closeTimeString = str.format_time(time_close, "HH:mm:ss")

//@variable Is `label.style_label_down` when the `open` is higher than `close`, `label.style_label_up` otherwise.
string openLabelStyle  = open &gt; close ? label.style_label_down : label.style_label_up
//@variable Is `label.style_label_down` when the `close` is higher than `open`, `label.style_label_up` otherwise.
string closeLabelStyle = close &gt; open ? label.style_label_down : label.style_label_up

// Draw labels anchored to the bar's `time` to display the `openTimeString` and `closeTimeString`.
label.new(time, open,  openTimeString,  xloc.bar_time, yloc.price, color.orange, openLabelStyle,  color.white)
label.new(time, close, closeTimeString, xloc.bar_time, yloc.price, color.blue,   closeLabelStyle, color.white)
 
if barstate.islast
    //@variable A `table` displaying the last bar's *unformatted* UNIX timestamps. 
    var table t = table.new(position.bottom_right, 2, 2, bgcolor = #ffe70d)
    // Populate the `t` table with "string" representations of the the "int" `time` and `time_close` values. 
    t.cell(0, 0, "`time`")
    t.cell(1, 0, str.tostring(time))
    t.cell(0, 1, "`time_close`")
    t.cell(1, 1, str.tostring(time_close))</code></div>
<p>Note that:</p>
<ul>
<li>This script’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a> calls include <a href="https://www.tradingview.com/pine-script-reference/v5/#const_xloc.bar_time">xloc.bar_time</a> as the <code dir="auto">xloc</code> argument and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> as the <code dir="auto">x</code> argument to anchor the drawings to bar opening times.</li>
<li>The formatted strings express time in the exchange time zone because we did not specify <code dir="auto">timezone</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> calls. NYSE, our chart symbol’s exchange, is in the “America/New_York” time zone (UTC-4/-5).</li>
<li>Although our example chart uses an <em>hourly</em> timeframe, the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> and the <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> at the end of the chart show that the last bar closes only <em>30 minutes</em> (1,800,000 milliseconds) after opening. This behavior occurs because the chart aligns bars with <a href="/pine-script-docs/v5/concepts/sessions/">session</a> opening and closing times. A session’s final bar closes when the session ends, and a new bar opens when a new session starts. A typical session on our 60-minute chart with regular trading hours (RTH) spans from 09:30 to 16:00 (6.5 hours). The chart divides this interval into as many 60-minute bars as possible, starting from the session’s opening time, which leaves only 30 minutes for the final bar to cover.</li>
</ul>
<p>It’s crucial to note that unlike the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> variable, which has consistent behavior across chart types, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> behaves differently on <em>time-based</em> and <em>non-time-based</em> charts.</p>
<p>Time-based charts have bars that typically open and close at regular, <em>predictable</em> times within a session. Thanks to this predictability, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> can accurately represent the <em>expected</em> closing time of an open bar on a time-based chart, as shown on the last bar in the example above.</p>
<p>In contrast, the bars on <a href="https://www.tradingview.com/support/solutions/43000709225/">tick charts</a> and <em>price-based</em> charts (all <a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard charts</a> excluding <a href="https://www.tradingview.com/support/solutions/43000619436/">Heikin Ashi</a>) cover <em>irregular</em> time intervals. Tick charts construct bars based on successive ticks in the data feed, and price-based charts construct bars based on significant price movements. The time it takes for new ticks or price changes to occur is <em>unpredictable</em>. As such, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> value is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> on the <em>realtime bars</em> of these charts.</p>
<p>The following script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> variables with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> to create strings containing bar opening and closing <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> and <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> date-time representations, which it displays in <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> at each bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> prices.</p>
<p>When applied to a <a href="https://www.tradingview.com/support/solutions/43000502284/">Renko</a> chart, which forms new bars based on <em>price movements</em>, the labels show correct results on all historical bars. However, the last bar has a <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> value of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> because the future closing time is unpredictable. Consequently, the bar’s closing time label shows a timestamp of <code dir="auto">"NaN"</code> and an <em>incorrect</em> date and time:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="610" loading="lazy" src="images/5059d70ae25443ea165af8a962f765cb.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`time_close` on non-time-based chart demo", overlay = true)

//@variable A formatted "string" containing the date and time that `time_close` represents in the exchange time zone.
string formattedCloseTime = str.format_time(time_close, format = "'Date and time:' yyyy-MM-dd HH:mm:ss")
//@variable A formatted "string" containing the date and time that `time` represents in the exchange time zone.
string formattedOpenTime = str.format_time(time, format = "'Date and time:' yyyy-MM-dd HH:mm:ss")

//@variable A "string" containing the `time_close` UNIX timestamp and the `formattedCloseTime`.
string closeTimeText = str.format("Close timestamp: {0,number,#}\n{1}", time_close, formattedCloseTime)
//@variable A "string" containing the `time` UNIX timestamp and the `formattedOpenTime`.
string openTimeText = str.format("Open timestamp: {0,number,#}\n{1}", time, formattedOpenTime)

// Define label colors for historical and realtime bars. 
color closeLabelColor = barstate.islast ? color.purple : color.aqua
color openLabelColor  = barstate.islast ? color.green  : color.orange

// Draw a label at the `high` to display the `closeTimeText` and a label at the `low` to display the `openTimeText`, 
// both anchored to the bar's `time`. 
label.new(
      time, high, closeTimeText, xloc.bar_time, color = closeLabelColor, textcolor = color.white, 
      size = size.large, textalign = text.align_left
 )
label.new(
      time, low, openTimeText, xloc.bar_time, color = openLabelColor, style = label.style_label_up, 
      size = size.large, textcolor = color.white, textalign = text.align_left
 )

// Highlight the background yellow on the latest bar. 
bgcolor(barstate.islast ? #f3de22cb : na, title = "Latest bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The script draws up to 50 <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> because we did not specify a <code dir="auto">max_labels_count</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration statement.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function replaces <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values with 0 in its calculations, which is why it returns an incorrect date-time “string” on the last bar. A timestamp of 0 corresponds to the <em>UNIX Epoch</em> (00:00:00 UTC on January 1, 1970). However, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> call does not specify a <code dir="auto">timezone</code> argument, so it expresses the epoch’s date and time in the <em>exchange time zone</em>, which was five hours behind UTC at that point in time.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> function, which returns the closing timestamp of a bar on a specified timeframe within a given session, also returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> on the realtime bars of tick-based and price-based charts.</li>
</ul>
<h3 class="md-heading" id="time_tradingday"><a href="#time_tradingday">`time_tradingday`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> variable holds a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> representing the starting time (00:00 UTC) of the last trading day in the current bar’s final session. It is helpful primarily for date and time calculations on <em>time-based</em> charts for symbols with overnight sessions that start and end on <em>different</em> calendar days.</p>
<p>On “1D” and lower timeframes, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> timestamp corresponds to the beginning of the day when the current session <em>ends</em>, even for bars that open and close on the previous day. For example, the “Monday” session for “EURUSD” starts on Sunday at 17:00 and ends on Monday at 17:00 in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">exchange time zone</a>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> values of <em>all</em> intraday bars within the session represent Monday at 00:00 UTC.</p>
<p>On timeframes higher than “1D”, which can cover <em>multiple</em> sessions, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> holds the timestamp representing the beginning of the last calendar day of the bar’s <em>final</em> trading session. For example, on a “EURUSD, 1W” chart, the timestamp represents the start of the last trading day in the week, which is typically Friday at 00:00 UTC.</p>
<p>The script below demonstrates how the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> variables differ on Forex symbols. On each bar, it draws <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> to display strings containing the variables’ <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> and <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted dates and times</a>. It also uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> function to calculate the UTC calendar day from both timestamps, highlighting the background when the calculated days do not match.</p>
<p>When applied to the “FXCM:EURUSD” chart with the “3h” (“180”) timeframe, the script highlights the background of the <em>first bar</em> in each session, as each session opens on the <em>previous</em> calendar day. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> call that uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> calculates the opening day on the session’s first bar, whereas the call that uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> calculates the day when the session <em>ends</em>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="612" loading="lazy" src="images/e1b5264229e447d14a5367dd03bd557a.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`time_tradingday` demo", overlay = true)

//@variable A concatenated "string" containing the `time_tradingday` timestamp and a formatted representation in UTC.
string tradingDayText = "`time_tradingday`: " + str.tostring(time_tradingday) + "\n"
     + "Date and time: " + str.format_time(time_tradingday, "dd MMM yyyy, HH:mm (z)", "UTC+0")
//@variable A concatenated "string" containing the `time` timestamp and a formatted representation in UTC.
string barOpenText = "`time`: " + str.tostring(time) + "\n"
     + "Date and time: " + str.format_time(time, "dd MMM yyyy, HH:mm (z)", "UTC+0")

//@variable Is `true` on every even bar, `false` otherwise. This condition determines the appearance of the labels. 
bool isEven = bar_index % 2 == 0

// The `yloc` and `style` properties of the labels. They alternate on every other bar for visibility. 
labelYloc  = isEven ? yloc.abovebar : yloc.belowbar
labelStyle = isEven ? label.style_label_down : label.style_label_up
// Draw alternating labels anchored to the bar's `time` to display the `tradingDayText` and `barOpenText`.
if isEven
    label.new(time, 0, tradingDayText + "\n\n\n", xloc.bar_time, labelYloc, color.teal, labelStyle, color.white)
    label.new(time, 0, barOpenText, xloc.bar_time, labelYloc, color.maroon, labelStyle, color.white)
else
    label.new(time, 0, "\n\n\n" + barOpenText, xloc.bar_time, labelYloc, color.maroon, labelStyle, color.white)
    label.new(time, 0, tradingDayText, xloc.bar_time, labelYloc, color.teal, labelStyle, color.white)

//@variable The day of the month, in UTC, that the `time_tradingday` timestamp corresponds to. 
int tradingDayOfMonth = dayofmonth(time_tradingday, "UTC+0")
//@variable The day of the month, in UTC, that the `time` timestamp corresponds to. 
int openingDayOfMonth = dayofmonth(time, "UTC+0")

// Highlight the background when the `tradingDayOfMonth` does not equal the `openingDayOfMonth`. 
bgcolor(tradingDayOfMonth != openingDayOfMonth ? color.rgb(174, 89, 243, 85) : na, title = "Different day highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> calls use <code dir="auto">"UTC+0"</code> as the <code dir="auto">timezone</code> argument, meaning the results represent calendar time values with no offset from UTC. In the screenshot, the first bar opens at 21:00 UTC, 17:00 in the exchange time zone (“America/New_York”).</li>
<li>The formatted strings show <code dir="auto">"GMT"</code> as the acronym of the time zone, which is equivalent to <code dir="auto">"UTC+0"</code> in this context.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_tradingday">time_tradingday</a> value is the same for <em>all</em> three-hour bars within each session, even for the initial bar that opens on the previous UTC calendar day. The assigned timestamp changes only when a new session starts.</li>
</ul>
<h3 class="md-heading" id="timenow"><a href="#timenow">`timenow`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> variable holds a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> representing the script’s <em>current time</em>. Unlike the values of other variables that hold UNIX timestamps, the values in the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> series correspond to times when the script <em>executes</em>, not the times of specific bars or trading days.</p>
<p>A Pine script executes only <em>once</em> per historical bar, and all historical executions occur when the script first <em>loads</em> on the chart. As such, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> value is relatively consistent on historical bars, with only occasional millisecond changes across the series. In contrast, on realtime bars, a script executes once for <em>each new update</em> in the data feed, which can happen several times per bar. With each new execution, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> value updates on the latest bar to represent the current time.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Because <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> only updates after script executions, its value does <strong>not</strong> always correspond to the <em>continuous</em> time displayed below the chart. When no new updates are available in the realtime data feed, a script on the chart remains <em>idle</em>, in which case the variable’s timestamp does not change.</p></div></aside>
<p>This variable is most useful on realtime bars, where programmers can apply it to track the times of the latest script executions, count the time elapsed within open bars, control drawings based on bar updates, and more.</p>
<p>The script below inspects the value of <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> on the latest chart bars and uses it to analyze realtime bar updates. When the script first reaches the last chart bar, it declares three variables with the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a> keyword to hold the latest <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> value, the total time elapsed between the bar’s updates, and the total number of updates. It uses these values to calculate the average number of milliseconds between updates, which it displays in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> along with the current execution’s timestamp, a <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> time and date in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">exchange time zone</a>, and the current number of bar updates:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="678" loading="lazy" src="images/dae3a0949538bdb40c7389d29bd7ef6e.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`timenow` demo", overlay = true, max_labels_count = 500)

if barstate.islast
    //@variable Holds the UNIX timestamp of the latest script execution for timing updates in the data feed. 
    varip int lastUpdateTimestamp = timenow
    //@variable The total number of milliseconds elapsed across the bar's data updates.
    varip int totalUpdateTime = 0
    //@variable The number of updates that have occurred on the current bar.
    varip int numUpdates = 0

    // Add the time elapsed from the `lastUpdateTimestamp` to `totalUpdateTime`, increase the `numUpdates` counter, and 
    // update the `lastUpdateTimestamp` when the `timenow` value changes.
    if timenow != lastUpdateTimestamp
        totalUpdateTime     += timenow - lastUpdateTimestamp
        numUpdates          += 1
        lastUpdateTimestamp := timenow
    
    //@variable The average number of milliseconds elapsed between the bar's updates.
    float avgUpdateTime = nz(totalUpdateTime / numUpdates)
    
    //@variable Contains the `timenow` value, a custom representation, and the `numUpdates` and `avgUpdateTime` values.
    string displayText = "`timenow`: " + str.tostring(timenow)
                         + "\nTime and date (exchange): " + str.format_time(timenow, "HH:mm:ss MM/dd/yy")
                         + "\nNumber of updates: " + str.tostring(numUpdates)
                         + "\nAvg. time between updates: " + str.tostring(avgUpdateTime, "#.###") + " ms"

    //@variable The color of the label. Is blue when the bar is open, and gray after it closes. 
    color labelColor = barstate.isconfirmed ? color.gray : color.blue 
    //@variable The label's y-coordinate. Alternates between `high` and `low` on every other bar. 
    float labelPrice = bar_index % 2 == 0 ? high : low
    //@variable The label's style. Alternates between "lower-right" and "upper-right" styles.
    labelStyle = bar_index % 2 == 0 ? label.style_label_lower_right : label.style_label_upper_right  
    // Draw a `labelColor` label anchored to the bar's `time` to show the `displayText`.
    label.new(
         time, labelPrice, displayText, xloc.bar_time, color = labelColor, style = labelStyle, 
         textcolor = color.white, size = size.large
     ) 

    // Reset the `totalUpdateTime` and `numUpdates` counters when the bar is confirmed (closes). 
    if barstate.isconfirmed
        totalUpdateTime := 0
        numUpdates      := 0</code></div>
<p>Note that:</p>
<ul>
<li>When a bar is unconfirmed (open), the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> is blue to signify that additional updates can occur. After the bar is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed">confirmed</a> (closed), the label turns gray.</li>
<li>Although we’ve set the chart <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a> to match the exchange time zone, the formatted time in the open bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> and the time shown below the chart <em>do not</em> always align. The script records a new timestamp <em>only</em> when a new execution occurs, whereas the time below the chart updates <em>continuously</em>.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a> keyword specifies that a variable does not revert to the last committed value in its series when new updates occur. This behavior allows the script to use variables to track changes in <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> on an open bar.</li>
<li>Updates to <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> on open realtime bars do not affect the recorded timestamps on confirmed bars as the script executes. However, the historical series changes (<em>repaints</em>) after reloading the chart because <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> references the script’s <em>current time</em>, not the times of specific bars.</li>
</ul>
<h3 class="md-heading" id="calendar-based-variables"><a href="#calendar-based-variables">Calendar-based variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_month">month</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_weekofyear">weekofyear</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofweek">dayofweek</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hour">hour</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_minute">minute</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_second">second</a> variables hold <em>calendar-based</em> “int” values calculated from the current bar’s <em>opening time</em>, expressed in the <a href="/pine-script-docs/v5/concepts/time/#time-zones">exchange time zone</a>. These variables reference the same values that <a href="/pine-script-docs/v5/concepts/time/#calendar-based-functions">calendar-based functions</a> return when they use the default <code dir="auto">timezone</code> argument and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> as the <code dir="auto">time</code> argument. For instance, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a> variable holds the same value that a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_year">year(time)</a> call returns.</p>
<p>Programmers can use these calendar-based variables for several purposes, such as:</p>
<ul>
<li>Identifying a bar’s opening date and time.</li>
<li>Passing the variables to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function to calculate <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a>.</li>
<li>Testing when date/time values or ranges occur in a data feed.</li>
</ul>
<p>One of the most common use cases for these variables is checking for date or time ranges to control when a script displays visuals or executes calculations. This simple example inspects the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a> variable to determine when to plot a visible value. If the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_year">year</a> is 2022 or higher, the script plots the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>. Otherwise, it plots <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="550" loading="lazy" src="images/23ad32cf5cbdfcba34baec518a78f3e5.webp" width="1376"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`year` demo", overlay = true)

// Plot the `close` price on bars that open in the `year` 2022 onward. Otherwise, plot `na` to display nothing.
plot(year &gt;= 2022 ? close : na, "`close` price (year 2022 and later)", linewidth = 3)</code></div>
<p>When using these variables in conditions that isolate specific dates or times rather than ranges, it’s crucial to consider that certain conditions might not detect some occurrences of the values due to a chart’s timeframe, the opening times of chart bars, or the symbol’s active session.</p>
<p>For instance, suppose we want to detect when the first calendar day of each month occurs on the chart. Intuitively, one might consider simply checking when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a> value equals 1. However, this condition only identifies when a bar <em>opens</em> on a month’s first day. The bars on some charts can open and close in <em>different</em> months. Additionally, a chart bar might not contain the first day of a month if the market is <em>closed</em> on that day. Therefore, we must create extra conditions that work in these scenarios to identify the first day in <em>any</em> month on the chart.</p>
<p>The script below uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_month">month</a> variables, and the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a> function, to create three conditions that detect the first day of the month in different ways. The first condition detects if the bar opens on the first day, the second checks if the bar opens in one month and closes in another, and the third checks if the chart skips the date entirely. The script draws <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> showing bar opening dates and highlights the background with different colors to visualize when each condition occurs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="636" loading="lazy" src="images/9305267f588918f07ef0e742dd295cc7.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Detecting the first day of the month demo", overlay = true, max_labels_count = 500)

//@variable Is `true` only if the current bar opens on the first day of the month in exchange time, `false` otherwise. 
bool opensOnFirst = dayofmonth == 1
//@variable Is `true` if the bar opens in one month and closes in another, meaning its time span includes the first day.
bool containsFirst = month != month(time_close) 
//@variable Is `true` only if the bar opens in a new month and the current or previous bar does not cover the first day.
bool skipsFirst = month != month[1] and not (opensOnFirst or containsFirst[1])

//@variable The name of the current bar's opening weekday.
string weekdayName = switch dayofweek
    dayofweek.sunday    =&gt; "Sunday"
    dayofweek.monday    =&gt; "Monday"
    dayofweek.tuesday   =&gt; "Tuesday"
    dayofweek.wednesday =&gt; "Wednesday"
    dayofweek.thursday  =&gt; "Thursday"
    dayofweek.friday    =&gt; "Friday"
    dayofweek.saturday  =&gt; "Saturday"

//@variable A custom "string" representing the bar's opening date, including the weekday name. 
string openDateText = weekdayName + str.format_time(time, ", MMM d, yyyy")

// Draw a green label when the bar opens on the first day of the month. 
if opensOnFirst
    string labelText = "Bar opened on\n" + openDateText
    label.new(time, open, labelText, xloc.bar_time, color = color.green, textcolor = color.white, size = size.large)
// Draw a blue label when the bar opens and closes in different months. 
if containsFirst
    string labelText = "Bar includes the first day,\nbut opened on\n" + openDateText
    label.new(time, open, labelText, xloc.bar_time, color = color.blue, textcolor = color.white, size = size.large)
// Draw a red label when the chart skips the first day of the month. 
if skipsFirst
    string labelText = "Chart doesn't include the first day.\nBar opened on\n" + openDateText
    label.new(time, open, labelText, xloc.bar_time, color = color.red, textcolor = color.white, size = size.large)

// Highlight the background when the conditions occur.
bgcolor(opensOnFirst ? color.new(color.green, 70) : na, title = "`opensOnFirst` condition highlight")
bgcolor(containsFirst ? color.new(color.blue, 70) : na, title = "`containsFirst` condition highlight")
bgcolor(skipsFirst ? color.new(color.red, 70) : na, title = "`skipsFirst` condition highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The script calls the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a> function with <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> as the <code dir="auto">time</code> argument to calculate each bar’s <em>closing</em> month for the <code dir="auto">containsFirst</code> condition.</li>
<li>The <code dir="auto">dayofweek.*</code> namespace contains variables that hold each possible <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofweek">dayofweek</a> value, e.g., <a href="https://www.tradingview.com/pine-script-reference/v5/#const_dayofweek.sunday">dayofweek.sunday</a> has a constant value of 1 and <a href="https://www.tradingview.com/pine-script-reference/v5/#const_dayofweek.saturday">dayofweek.saturday</a> has a constant value of 7. The script compares <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofweek">dayofweek</a> to these variables in a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a> structure to determine the weekday name shown inside each <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>.</li>
<li>To detect the <em>first opening time</em> in a monthly timeframe, not strictly the first day in a calendar month, use <code dir="auto">ta.change(time("1M")) &gt; 0</code> or <code dir="auto">timeframe.change("1M")</code> instead of conditions based on these variables. See the <a href="/pine-script-docs/v5/concepts/time/#testing-for-changes-in-higher-timeframes">Testing for changes in higher timeframes</a> section to learn more.</li>
</ul>
<h3 class="md-heading" id="last_bar_time"><a href="#last_bar_time">`last_bar_time`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> variable holds a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> representing the <em>last</em> available bar’s opening time. It is similar to <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_index">last_bar_index</a>, which references the latest bar index. On historical bars, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> consistently references the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value of the last bar available when the script first <em>loads</em> on the chart. The only time the variable’s value updates across script executions is when a new realtime bar opens.</p>
<p>The following script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> variable to get the opening timestamp of the last chart bar during its execution on the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isfirst">first bar</a>. It displays the UNIX timestamp and a <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> date and time in a single-cell <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> created only on that bar. When the script executes on the last available bar, it draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> showing the bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value and its formatted representation for visual comparison.</p>
<p>As the chart below shows, both drawings display <em>identical</em> times, verifying that <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> correctly references the last bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value on previous historical bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="540" loading="lazy" src="images/c89264bcb243bdc6f7baf20478d54ae0.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`last_bar_time` demo", overlay = true)

if barstate.isfirst
    //@variable A single-cell `table`, created only on the *first* bar, showing the *last* available bar's opening time.
    table displayTable = table.new(position.bottom_right, 1, 1, color.aqua)
    //@variable A "string" containing the `last_bar_time` UNIX timestamp and a custom date and time representation. 
    string lastBarTimeText = "`last_bar_time`: "              + str.tostring(last_bar_time) 
                             + "\nDate and time (exchange): " + str.format_time(last_bar_time, "dd/MM/yy HH:mm:ss")
    // Initialize the `displayTable` cell with the `lastBarTimeText`.
    displayTable.cell(
         0, 0, lastBarTimeText, 
         text_color = color.white, text_size = size.large, text_halign = text.align_left
     )

//@variable Is `true` only on the first occurrence of `barstate.islast`, `false` otherwise.
//          This condition occurs on the bar whose `time` the `last_bar_time` variable refers to on historical bars.
bool isInitialLastBar = barstate.islast and not barstate.islast[1]

if isInitialLastBar
    //@variable A "string" containing the last available bar's `time` value and a custom date and time representation.
    //          Matches the `lastBarTimeText` from the first bar because `last_bar_time` equals this bar's `time`.
    string openTimeText = "`time`: "                       + str.tostring(time)
                          + "\nDate and time (exchange): " + str.format_time(time, "dd/MM/yy HH:mm:ss") 
    // Draw a label anchored to the bar's `time` to display the `openTimeText`. 
    label.new(
         time, high, openTimeText, xloc.bar_time,
         color = color.purple, textcolor = color.white, size = size.large, textalign = text.align_left
     )

// Highlight the background when `isInitialLastBar` is `true` for visual reference. 
bgcolor(barstate.islast ? color.rgb(155, 39, 176, 80) : na, title = "Initial last bar highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The script creates the <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a> only on the <em>first</em> bar with the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">barstate.islast</a> state because that bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value is what <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> equals on all historical bars. On subsequent bars, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> value <em>updates</em> to represent the latest realtime bar’s opening time.</li>
<li>Updates to <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> on realtime bars do not affect the values on historical bars as the script executes. However, the variable’s series <em>repaints</em> when the script restarts because <a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a> always references the latest available bar’s opening time.</li>
<li>This script expresses dates using the <code dir="auto">"dd/MM/yy"</code> format, meaning the two-digit day appears before the two-digit month, and the month appears before the two-digit representation of the year. See <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">this section</a> below for more information.</li>
</ul>
<h3 class="md-heading" id="visible-bar-times"><a href="#visible-bar-times">Visible bar times<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> variables reference the opening <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> of the chart’s leftmost (first) and rightmost (last) <em>visible bars</em> on every script execution. When a script uses these variables, it responds dynamically to visible chart changes, such as users scrolling across bars or zooming in/out. Each time the visible window changes, the script <em>re-executes</em> automatically to update the variables’ values on all available bars.</p>
<p>The example below demonstrates how the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> variables work across script executions. The script draws <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> anchored to the visible bars’ times to display the UNIX timestamps. In addition, it draws two single-cell <a href="/pine-script-docs/v5/concepts/tables/">tables</a> showing corresponding dates and times in the standard <a href="https://en.wikipedia.org/wiki/ISO_8601" rel="nofollow">ISO 8601</a> format. The script creates these drawings only when it executes on the first bar. As the script continues to execute on subsequent bars, it identifies each bar whose <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value equals either visible bars’ timestamp and colors it on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="642" loading="lazy" src="images/204ba485b050f073dccb8e4ee8c85de5.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Visible bar times demo", overlay = true)

// Create strings on the first chart bar that contain the first and last visible bars' UNIX timestamps.
var string leftTimestampText  = str.format("UNIX timestamp: {0,number,#}", chart.left_visible_bar_time)
var string rightTimestampText = str.format("UNIX timestamp: {0,number,#}", chart.right_visible_bar_time)
// Create strings on the first bar that contain the exchange date and time of the visible bars in ISO 8601 format.
var string leftDateTimeText  = "Date and time: " + str.format_time(chart.left_visible_bar_time)
var string rightDateTimeText = "Date and time: " + str.format_time(chart.right_visible_bar_time)

//@variable A `label` object anchored to the first visible bar's time. Shows the `leftTimestampText`.
var label leftTimeLabel = label.new(
     chart.left_visible_bar_time, 0, leftTimestampText, xloc.bar_time, yloc.abovebar, color.purple, 
     label.style_label_lower_left, color.white, size.large
 )
//@variable A `label` object anchored to the last visible bar's time. Shows the `rightTimestampText`.
var label rightTimeLabel = label.new(
     chart.right_visible_bar_time, 0, rightTimestampText, xloc.bar_time, yloc.abovebar, color.teal, 
     label.style_label_lower_right, color.white, size.large
 )

//@variable A single-cell `table` object showing the `leftDateTimeText`.
var table leftTimeTable = table.new(position.middle_left, 1, 1, color.purple)
//@variable A single-cell `table` object showing the `rightDateTimeText`.
var table rightTimeTable = table.new(position.middle_right, 1, 1, color.teal)
// On the first bar, initialize the `leftTimeTable` and `rightTimeTable` with the corresponding date-time text.
if barstate.isfirst
    leftTimeTable.cell(0, 0, leftDateTimeText, text_color = color.white, text_size = size.large)
    rightTimeTable.cell(0, 0, rightDateTimeText, text_color = color.white, text_size = size.large)

//@variable Is purple at the left visible bar's opening time, teal at the right bar's opening time, `na` otherwise. 
color barColor = switch time
    chart.left_visible_bar_time  =&gt; color.purple
    chart.right_visible_bar_time =&gt; color.teal

// Color the leftmost and rightmost visible bars using the `barColor`.
barcolor(barColor, title = "Leftmost and rightmost visible bar color")</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> values are consistent across all executions, which allows the script to identify the visible bars’ timestamps on the <em>first</em> bar and check when the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> value equals them. The script restarts on any chart window changes, updating the variables’ series to reference the new timestamps on every bar.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function uses ISO 8601 format by default when the call does not include a <code dir="auto">format</code> argument because it is the <em>international standard</em> for expressing dates and times. See the <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">Formatting dates and times</a> section to learn more about time string formats.</li>
</ul>
<h3 class="md-heading" id="syminfotimezone"><a href="#syminfotimezone">`syminfo.timezone`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> variable holds a <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> representing the current symbol’s <em>exchange</em> time zone. The “string” value expresses the time zone as an <em>IANA identifier</em> (e.g., <code dir="auto">"America/New_York"</code>). The overloads of <a href="/pine-script-docs/v5/concepts/time/#time-functions">time functions</a> that include a <code dir="auto">timezone</code> parameter use <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> as the default argument.</p>
<p>Because this variable is the default <code dir="auto">timezone</code> argument for all applicable time function overloads, it is unnecessary to use as an explicit argument, except for stylistic purposes. However, programmers can use the variable in other ways, such as:</p>
<ul>
<li>Displaying the “string” in <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> or <a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawings</a> to inspect the exchange time zone’s IANA identifier.</li>
<li>Comparing the value to other time zone strings to create time zone-based conditional logic.</li>
<li>Requesting the exchange time zones of other symbols with <code dir="auto">request.*()</code> function calls.</li>
</ul>
<p>The following script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> variable to retrieve the <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> of its latest execution. It <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formats</a> the timestamp into date-time strings expressed in the main symbol’s exchange time zone and a requested symbol’s exchange time zone, which it displays along with the IANA identifiers in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the last chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="580" loading="lazy" src="images/8fd07474cb0563f5c0042819db486eeb.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`syminfo.timezone` demo", overlay = true, dynamic_requests = true)

//@variable The symbol to request exchange time zone information for. 
string symbolInput = input.symbol("NSE:BANKNIFTY", "Requested symbol")

//@variable A `table` object displaying the exchange time zone and the time of the script's execution.
var table t = table.new(position.bottom_right, 2, 3, color.yellow, border_color = color.black, border_width = 1)

//@variable The IANA identifier of the exchange time zone requested for the `symbolInput` symbol.
var string requestedTimezone = na

if barstate.islastconfirmedhistory
    // Retrieve the time zone of the user-specified symbol's exchange.
    requestedTimezone := request.security(symbolInput, "", syminfo.timezone, calc_bars_count = 2)
    // Initialize the `t` table's header cells.
    t.cell(0, 0, "Exchange prefix and time zone string", text_size = size.large)
    t.cell(1, 0, "Last execution date and time", text_size = size.large)
    t.cell(0, 1, syminfo.prefix(syminfo.tickerid) + " (" + syminfo.timezone + ")", text_size = size.large)
    t.cell(0, 2, syminfo.prefix(symbolInput) + " (" + requestedTimezone + ")", text_size = size.large)

if barstate.islast
    //@variable The formatting string for all `str.format_time()` calls. 
    var string formatString = "HH:mm:ss 'on' MMM dd, YYYY"
    // Initialize table cells to display the formatted text.
    t.cell(1, 1, str.format_time(timenow, formatString), text_size = size.large)
    t.cell(1, 2, str.format_time(timenow, formatString, requestedTimezone), text_size = size.large)</code></div>
<p>Note that:</p>
<ul>
<li>Pine scripts execute on realtime bars only when new updates occur in the data feed, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> updates only on script executions. As such, when no realtime updates are available, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> timestamp does not change. See <a href="/pine-script-docs/v5/concepts/time/#timenow">this section</a> above for more information.</li>
<li>The default <code dir="auto">symbolInput</code> value is <code dir="auto">"NSE:BANKNIFTY"</code>. NSE is in the “Asia/Kolkata” <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>, which is 9.5 hours ahead of the main symbol’s exchange time zone (“America/New_York”) at the time of the screenshot. Although the <em>local</em> time representations differ, both refer to the same <em>absolute</em> time that the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a> timestamp represents.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration statement includes <code dir="auto">dynamic_requests = true</code>, which allows the script to call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> dynamically inside the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> structure’s <em>local scope</em>. See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#dynamic-requests">Dynamic requests</a> section of the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page to learn more.</li>
</ul>
<h2 class="md-heading" id="time-functions"><a href="#time-functions">Time functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ features several built-in functions that scripts can use to retrieve, calculate, and express time values:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> functions allow scripts to retrieve <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> for the opening and closing times of bars within a session on a specified timeframe, without requiring <code dir="auto">request.*()</code> function calls.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_year">year()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_weekofyear">weekofyear()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_minute">minute()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_second">second()</a> functions calculate calendar-based values, expressed in a specified <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>, from a UNIX timestamp.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function calculates a UNIX timestamp from a specified calendar date and time.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function formats a UNIX timestamp into a human-readable date/time “string”, expressed in a specified time zone. The <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">Formatting dates and times</a> section below provides detailed information about formatting timestamps with this function.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a> function returns a UNIX timestamp corresponding to the user-specified date and time, and the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.session">input.session()</a> function returns a valid <a href="/pine-script-docs/v5/concepts/sessions/#session-strings">session string</a> corresponding to the user-specified start and end times. See the <a href="/pine-script-docs/v5/concepts/inputs/#time-input">Time input</a> and <a href="/pine-script-docs/v5/concepts/inputs/#session-input">Session input</a> sections of the <a href="/pine-script-docs/v5/concepts/inputs/">Inputs</a> page to learn more about these functions.</li>
</ul>
<h3 class="md-heading" id="time-and-time_close-functions"><a href="#time-and-time_close-functions">`time()` and `time_close()` functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> functions return <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> representing the opening and closing times of bars on a specified timeframe. Both functions can <em>filter</em> their returned values based on a given <a href="/pine-script-docs/v5/concepts/sessions/">session</a> in a specific <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>. They each have the following signatures:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">functionName(timeframe, bars_back) → series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">functionName(timeframe, session, bars_back) → series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">functionName(timeframe, session, timezone, bars_back) → series int</span></div></div></code></pre></figure></link></div>
<p>Where:</p>
<ul>
<li><code dir="auto">functionName</code> is the function’s identifier.</li>
<li>The <code dir="auto">timeframe</code> parameter accepts a <a href="/pine-script-docs/v5/concepts/timeframes/#timeframe-string-specifications">timeframe string</a>. The function uses the script’s main timeframe if the argument is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a> or an empty “string”.</li>
<li>The <code dir="auto">session</code> parameter accepts a <a href="/pine-script-docs/v5/concepts/sessions/#session-strings">session string</a> defining the session’s start and end times (e.g., <code dir="auto">"0930-1600"</code>) and the days for which it applies (e.g., <code dir="auto">":23456"</code> means Monday - Friday). If the value does not specify the days, the session applies to <em>all</em> weekdays automatically. The function returns UNIX timestamps only for the bars <em>within</em> the session. It returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if a bar’s time is <em>outside</em> the session. If the <code dir="auto">session</code> argument is an empty “string” or not specified, The function uses the symbol’s session information.</li>
<li>The <code dir="auto">timezone</code> parameter accepts a valid <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> that defines the time zone of the specified <code dir="auto">session</code>. It does <strong>not</strong> change the meaning of returned UNIX timestamps, as they are <em>time zone-agnostic</em>. If the <code dir="auto">timezone</code> argument is not specified, the function uses the exchange time zone (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a>).</li>
<li>The <code dir="auto">bars_back</code> parameter accepts an “int” value specifying which bar’s time the returned timestamp represents. If the value is positive, the function returns the timestamp from that number of bars back relative to the current bar. If the value is negative and greater than or equal to -500, the function returns the <em>expected</em> timestamp of a future bar. The default value is 0.</li>
</ul>
<p>Similar to the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> variables, these functions behave differently on <em>time-based</em> and <em>non-time-based</em> charts.</p>
<p>Time-based charts have bars that open and close at <em>predictable</em> times, whereas the bars on <a href="https://www.tradingview.com/support/solutions/43000709225/">tick charts</a> and all <a href="/pine-script-docs/v5/concepts/non-standard-charts-data/">non-standard charts</a>, excluding <a href="https://www.tradingview.com/support/solutions/43000619436/">Heikin Ashi</a>, open and close at irregular, <em>unpredictable</em> times. Consequently, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> cannot calculate the expected closing times of realtime bars on non-time-based charts, so it returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> on those bars. Similarly, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> function with a negative <code dir="auto">bars_back</code> value cannot accurately calculate the expected opening time of a future realtime bar on these charts. See the <em>second example</em> in <a href="/pine-script-docs/v5/concepts/time/#time-and-time_close-variables">this section</a> above. That example script exhibits the same behavior on a price-based chart if it uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close("")</a> call instead of the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> variable.</p>
<p>Typical use cases for the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> functions include:</p>
<ul>
<li>Testing for bars that open or close in <a href="/pine-script-docs/v5/concepts/time/#testing-for-sessions">specific sessions</a> defined by the <code dir="auto">session</code> and <code dir="auto">timezone</code> parameters.</li>
<li><a href="/pine-script-docs/v5/concepts/time/#testing-for-changes-in-higher-timeframes">Testing for changes</a> or measuring time differences on specified higher timeframes.</li>
</ul>
<h4 class="md-heading" id="testing-for-sessions"><a href="#testing-for-sessions">Testing for sessions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> functions’ <code dir="auto">session</code> and <code dir="auto">timezone</code> parameters define the <a href="/pine-script-docs/v5/concepts/sessions/">sessions</a> for which they can return <em>non-na</em> values. If a call to either function references a bar that opens/closes within the defined session in a given <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>, it returns a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> for that bar. Otherwise, it returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>. Programmers can pass the returned values to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_na">na()</a> function to identify which bars open or close within specified intervals, which is helpful for session-based calculations and logic.</p>
<p>This simple script identifies when a bar on the chart’s timeframe opens at or after 11:00 and before 13:00 in the exchange time zone on any trading day. It calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> with <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a> as the <code dir="auto">timeframe</code> argument and the <code dir="auto">"1100-1300"</code> <a href="/pine-script-docs/v5/concepts/sessions/#session-strings">session string</a> as the <code dir="auto">session</code> argument, and then verifies whether the returned value is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_na">na()</a> function. When the value is <strong>not</strong> <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, the script highlights the chart’s background to indicate that the bar opened in the session:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="534" loading="lazy" src="images/d61b36675180e1c53dceaeb0b0e9033b.webp" width="1458"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Testing for session bars demo", overlay = true)

//@variable Checks if the bar opens between 11:00 and 13:00. Is `true` if the `time()` function does not return `na`. 
bool inSession = not na(time(timeframe.period, "1100-1300"))

// Highlight the background of the bars that are in the session "11:00-13:00". 
bgcolor(inSession ? color.rgb(155, 39, 176, 80) : na)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">session</code> argument in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> call represents an interval in the <em>exchange</em> time zone because <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> is the default <code dir="auto">timezone</code> argument.</li>
<li>The session string expresses the start and end times in the <code dir="auto">"HHmm-HHmm"</code> format, where <code dir="auto">"HH"</code> is the two-digit <em>hour</em> and <code dir="auto">"mm"</code> is the two-digit <em>minute</em>. Session strings can also specify the <em>weekdays</em> a session applies to. However, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> call’s <code dir="auto">session</code> argument (<code dir="auto">"1100-1300"</code>) does not include this information, which is why it considers the session valid for <em>every</em> day. See the <a href="/pine-script-docs/v5/concepts/sessions/">Sessions</a> page to learn more.</li>
</ul>
<p>When using session strings in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> calls, it’s crucial to understand that such strings define start and end times in a <em>specific</em> <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>. The local hour and minute in one region may not correspond to the same point in UNIX time as that same hour and minute in another region. Therefore, calls to these functions with different <code dir="auto">timezone</code> arguments can return non-na timestamps at <em>different</em> times, as the specified <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> changes the meaning of the local times represented in the <code dir="auto">session</code> argument.</p>
<p>This example demonstrates how the <code dir="auto">timezone</code> parameter affects the <code dir="auto">session</code> parameter in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> function call. The script calculates an <code dir="auto">opensInSession</code> condition that uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> call with arguments based on <a href="/pine-script-docs/v5/concepts/inputs/">inputs</a>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.session">session input</a> for the <code dir="auto">session</code> argument includes four preset options: <code dir="auto">"0000-0400"</code>, <code dir="auto">"0930-1400"</code>, <code dir="auto">"1300-1700"</code>, and <code dir="auto">"1700-2100"</code>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.string">string input</a> that defines the <code dir="auto">timezone</code> argument includes four IANA time zone options representing different offsets from UTC: <code dir="auto">"America/Vancouver"</code> (UTC-7/-8), <code dir="auto">"America/New_York"</code> (UTC-4/-5), <code dir="auto">"Asia/Dubai"</code> (UTC+4), and <code dir="auto">"Austrailia/Sydney"</code> (UTC+10/+11).</p>
<p>For any chosen <code dir="auto">sessionInput</code> value, changing the <code dir="auto">timezoneInput</code> value changes the specified session’s time zone. The script highlights <em>different bars</em> with each time zone choice because, unlike <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a>, the <em>absolute</em> times that local hour and minute values correspond to <em>varies</em> across time zones:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="570" loading="lazy" src="images/9ef91f0b7c2a95cba15ecb75bb0c953c.webp" width="1566"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Testing session time zones demo", overlay = true)

//@variable The timeframe of the analyzed bars. 
string timeframeInput = input.timeframe("60", "Timeframe")
//@variable The session to check. Features four interval options. 
string sessionInput = input.session("1300-1700", "Session", ["0000-0400", "0930-1400", "1300-1700", "1700-2100"])
//@variable An IANA identifier representing the time zone of the `sessionInput`. Fetures four preset options. 
string timezoneInput = input.string("America/New_York", "Time zone", 
     ["America/Vancouver", "America/New_York", "Asia/Dubai", "Australia/Sydney"]
 )

//@variable Is `true` if a `timeframeInput` bar opens within the `sessionInput` session in the `timezoneInput` time zone.
//          The condition detects the session on different bars, depending on the chosesn time zone, because identical 
//          local times in different time zones refer to different absolute points in UNIX time.  
bool opensInSession = not na(time(timeframeInput, sessionInput, timezoneInput))

// Highlight the background when `opensInSession` is `true`. 
bgcolor(opensInSession ? color.rgb(33, 149, 243, 80) : na, title = "Open in session highlight")</code></div>
<p>Note that:</p>
<ul>
<li>This script uses <em>IANA notation</em> for all <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone strings</a> because it is the recommended format. Using an IANA identifier allows the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> call to automatically adjust the session’s UTC offset based on a region’s local time policies, such as daylight saving time.</li>
</ul>
<h4 class="md-heading" id="testing-for-changes-in-higher-timeframes"><a href="#testing-for-changes-in-higher-timeframes">Testing for changes in higher timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <code dir="auto">timeframe</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> functions specifies the timeframe of the bars in the calculation, allowing scripts to retrieve opening/closing <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> from <em>higher timeframes</em> than the current chart’s timeframe without requiring <code dir="auto">request.*()</code> function calls.</p>
<p>Programmers can use the opening/closing timestamps from higher-timeframe (HTF) bars to detect timeframe changes. One common approach is to call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> with a consistent <code dir="auto">timeframe</code> argument across all executions on a time-based chart and measure the one-bar change in the returned value with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.change">ta.change()</a> function. The result is a <em>nonzero</em> value only when an HTF bar opens. One can also check whether the data has a time gap at that point by comparing the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> value to the previous bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> value. A gap is present when the opening timestamp on the current bar is greater than the closing timestamp on the previous bar.</p>
<p>The script below calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time(“1M”)</a> to get the opening UNIX timestamp of the current bar on the “1M” timeframe. It detects when bars on that timeframe open by checking when the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.change">ta.change()</a> of the timestamp returns a value greater than 0. On each occurrence of the condition, the script detects whether the HTF bar opened after a gap by checking if the opening time is greater than the previous bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close(“1M”)</a> value.</p>
<p>The script draws <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> containing <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> “1M” opening times to indicate the chart bars that mark the start of monthly bars. If a monthly bar opens without a gap from the previous closing time, the script draws a blue label. If a monthly bar starts after a gap, it draws a red label. Additionally, if the “1M” opening time does not match the opening time of the chart bar, the script displays that bar’s formatted time in the label for comparison:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="640" loading="lazy" src="images/c17f9db5c340a9ced2020cf93433b7aa.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Detecting changes in higher timeframes demo", overlay = true)

//@variable The opening UNIX timestamp of the current bar on the "1M" timeframe.
int currMonthlyOpenTime = time("1M")
//@variable The closing timestamp on the "1M" timeframe as of the previous chart bar. 
int prevMonthlyCloseTime = time_close("1M")[1]

//@variable Is `true` when the opening time on the "1M" timeframe changes, indicating a new monthly bar. 
bool isNewTf = ta.change(currMonthlyOpenTime) &gt; 0

if isNewTf
    // Initialize variables for the `text` and `color` properties of the label drawing.
    string lblText  = "New '1M' opening time:\n" + str.format_time(currMonthlyOpenTime)
    color  lblColor = color.blue

    //@variable Is `true` when the `currMonthlyOpenTime` exceeds the `prevMonthlyCloseTime`, indicating a time gap.
    bool hasGap = currMonthlyOpenTime &gt; prevMonthlyCloseTime
    
    // Modify the `lblText` and `lblColor` based on the `hasGap` value.
    if hasGap
        lblText := "Gap from previous '1M' close.\n\n" + lblText
        lblColor := color.red
    // Include the formatted `time` value if the `currMonthlyOpenTime` is before the first available chart bar's `time`.
    if time &gt; currMonthlyOpenTime
        lblText += "\nFirst chart bar has a later time:\n" + str.format_time(time)
    
    // Draw a `lblColor` label anchored to the `time` to display the `lblText`. 
    label.new(
         time, high, lblText, xloc.bar_time, color = lblColor, style = label.style_label_lower_right, 
         textcolor = color.white, size = size.large
     )</code></div>
<p>Note that:</p>
<ul>
<li>Using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.change">ta.change()</a> on a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> call’s result is not the <em>only</em> way to detect changes in a higher timeframe. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">timeframe.change()</a> function is an equivalent, more convenient option for scripts that do not need to <em>use</em> the UNIX timestamps from HTF bars in other calculations, as it returns a “bool” value directly without extra code.</li>
<li>The detected monthly opening times do not always correspond to the first calendar day of the month. Instead, they correspond to the first time assigned to a “1M” bar, which can be <em>after</em> the first calendar day. For symbols with overnight sessions, such as “USDJPY” in our example chart, a “1M” bar can also open <em>before</em> the first calendar day.</li>
<li>Sometimes, the opening time assigned to an HTF bar might <em>not</em> equal the opening time of any chart bar, which is why other conditions such as <code dir="auto">time == time("1M")</code> cannot detect new monthly bars consistently. For example, on our “USDJPY” chart, the “1M” opening time <code dir="auto">2023-12-31T17:00:00-0500</code> does not match an opening time on the “1D” timeframe. The first available “1D” bar after that point opened at <code dir="auto">2024-01-01T17:00:00-0500</code>.</li>
</ul>
<h3 class="md-heading" id="calendar-based-functions"><a href="#calendar-based-functions">Calendar-based functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_year">year()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_weekofyear">weekofyear()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hour">hour()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_minute">minute()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_second">second()</a> functions calculate <em>calendar-based</em> “int” values from a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a>. Unlike the <a href="/pine-script-docs/v5/concepts/time/#calendar-based-variables">calendar-based variables</a>, which always hold exchange calendar values based on the current bar’s opening timestamp, these functions can return calendar values for any valid timestamp and express them in a chosen <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>.</p>
<p>Each of these calendar-based functions has the following two signatures:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">functionName(time) → series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">functionName(time, timezone) → series int</span></div></div></code></pre></figure></div>
<p>Where:</p>
<ul>
<li><code dir="auto">functionName</code> is the function’s identifier.</li>
<li>The <code dir="auto">time</code> parameter accepts an “int” UNIX timestamp for which the function calculates a corresponding calendar value.</li>
<li>The <code dir="auto">timezone</code> parameter accepts a <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> specifying the returned value’s time zone. If the <code dir="auto">timezone</code> argument is not specified, the function uses the exchange time zone (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a>).</li>
</ul>
<p>In contrast to the functions that return UNIX timestamps, a calendar-based function returns different “int” results for various time zones, as calendar values represent parts of a <em>local time</em> in a <em>specific region</em>.</p>
<p>For instance, the simple script below uses two calls to <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> to calculate each bar’s opening day in the exchange time zone and the “Australia/Sydney” time zone. It plots the results of the two calls in a separate pane for comparison:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="736" loading="lazy" src="images/98bf155f5e34024ed813a5722b7e310a.webp" width="1792"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`dayofmonth()` demo", overlay = false)

//@variable An "int" representing the current bar's opening calendar day in the exchange time zone. 
//          Equivalent to the `dayofmonth` variable. 
int openingDay = dayofmonth(time)

//@variable An "int" representing the current bar's opening calendar day in the "Australia/Sydney" time zone.
int openingDaySydney = dayofmonth(time, "Australia/Sydney")

// Plot the calendar day values.
plot(openingDay,       "Day of Month (Exchange)", linewidth = 6, color = color.blue)
plot(openingDaySydney, "Day of Month (Sydney)",   linewidth = 3, color = color.orange)</code></div>
<p>Note that:</p>
<ul>
<li>The first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> call calculates the bar’s opening day in the exchange time zone because it does not include a <code dir="auto">timezone</code> argument. This call returns the same value that the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_dayofmonth">dayofmonth</a> variable references.</li>
<li>Our example symbol’s exchange time zone is “America/New_York”, which follows UTC-5 during standard time and UTC-4 during daylight saving time (DST). The “Australia/Sydney” time zone follows UTC+10 during standard time and UTC+11 during DST. However, Sydney observes DST at <em>different</em> times of the year than New York. As such, its time zone is 14, 15, or 16 hours ahead of the exchange time zone, depending on the time of year. The plots on our “1D” chart diverge when the difference is at least 15 hours because the bars open at 09:30 in exchange time, and 15 hours ahead is 00:30 on the <em>next</em> calendar day.</li>
</ul>
<p>It’s important to understand that although the <code dir="auto">time</code> argument in a calendar-based function call represents a single, absolute point in time, each function returns only <em>part</em> of the date and time information available from the timestamp. Consequently, a calendar-based function’s returned value does <strong>not</strong> directly correspond to a <em>unique</em> time point, and conditions based on individual calendar values can apply to <em>multiple</em> bars.</p>
<p>For example, this script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function to calculate a UNIX timestamp from a date “string”, and it calculates the calendar day from that timestamp, in the exchange time zone, with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> function. The script compares each bar’s opening day to the calculated day and highlights the background when the two are equal:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="494" loading="lazy" src="images/ba453b12606015ba9e907d2299c4369e.webp" width="1468"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`dayofmonth()` demo", overlay = false)

//@variable The UNIX timestamp corresponding to August 29, 2024 at 00:00:00 UTC.
const int fixedTimestamp = timestamp("29 Aug 2024")
//@variable The day of the month calculated from the `fixedTimestamp`, expressed in the exchange time zone. 
//          If the exchange time zone has a negative UTC offset, this variable's value is 28 instead of 29.
int dayFromTimestamp = dayofmonth(fixedTimestamp)

//@variable An "int" representing the current bar's opening calendar day in the exchange time zone. 
//          Equivalent to the `dayofmonth` variable. 
int openingDay = dayofmonth(time)

// Plot the `openingDay`.
plot(openingDay, "Opening day of month", linewidth = 3)
// Highlight the background when the `openingDay` equals the `dayFromTimestamp`.
bgcolor(openingDay == dayFromTimestamp ? color.orange : na, title = "Day detected highlight")</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call treats its argument as a <em>UTC</em> calendar date because its <code dir="auto">dateString</code> argument does not specify time zone information. However, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> call calculates the day in the <em>exchange time zone</em>. Our example symbol’s exchange time zone is “America/New_York” (UTC-4/-5). Therefore, the returned value on this chart is 28 instead of 29.</li>
<li>The script highlights <em>any</em> bar on our chart that opens on the 28th day of <em>any</em> month instead of only a specific bar because the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofmonth">dayofmonth()</a> function’s returned value does <strong>not</strong> represent a specific point in time on its own.</li>
<li>This script highlights the bars that <em>open</em> on the day of the month calculated from the timestamp. However, some months on our chart have no trading activity on that day. For example, the script does not highlight when the July 28, 2024 occurs on our chart because NASDAQ is closed on Sundays.</li>
</ul>
<p>Similar to <a href="/pine-script-docs/v5/concepts/time/#calendar-based-variables">calendar-based variables</a>, these functions are also helpful when testing for dates/times and detecting calendar changes on the chart. The example below uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_year">year()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_month">month()</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_weekofyear">weekofyear()</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a> functions on the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> timestamp to create conditions that test if the current bar is the first bar that closes in a new year, quarter, month, week, and day. The script uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotted shapes</a>, <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">background colors</a> to visualize the conditions on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="640" loading="lazy" src="images/5cf76ff56dea5057660df3e1e230ac22.webp" width="1336"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Calendar changes demo", overlay = true, max_labels_count = 500)

// Calculate the year, month, week of year, and day of week corresponding to the `time_close` UNIX timestamp.
// All values are expressed in the exchange time zone. 
int closeYear       = year(time_close)
int closeMonth      = month(time_close)
int closeWeekOfYear = weekofyear(time_close)
int closeDayOfWeek  = dayofweek(time_close)

//@variable Is `true` when the change in `closeYear` exceeds 0, marking the first bar that closes in a new year.  
bool closeInNewYear = ta.change(closeYear) &gt; 0
//@variable Is `true` when the difference in `closeMonth` is not 0, marking the first bar that closes in a new month. 
bool closeInNewMonth = closeMonth - closeMonth[1] != 0
//@variable Is `true` when `closeMonth - 1` becomes divisible by 3, marking the first bar that closes in a new quarter. 
bool closeInNewQuarter = (closeMonth[1] - 1) % 3 != 0 and (closeMonth - 1) % 3 == 0
//@variable Is `true` when the change in `closeWeekOfYear` is not 0, marking the first bar that closes in a new week.
bool closeInNewWeek = ta.change(closeWeekOfYear) != 0
//@variable Is `true` when the `closeDayOfWeek` changes, marking the first bar that closes in the new day.
bool closeInNewDay = closeDayOfWeek != closeDayOfWeek[1]

//@variable Switches between `true` and `false` after every `closeInNewDay` occurrence for background color calculation.
var bool alternateDay = true
if closeInNewDay
    alternateDay := not alternateDay

// Draw a label above the bar to display the `closeWeekOfYear` when `closeInNewWeek` is `true`. 
if closeInNewWeek
    label.new(
         time, 0, "W" + str.tostring(closeWeekOfYear), xloc.bar_time, yloc.abovebar, color.purple, 
         textcolor = color.white, size = size.normal
     )
// Plot label shapes at the bottom and top of the chart for the `closeInNewYear` and `closeInNewMonth` conditions. 
plotshape(
     closeInNewYear, "Close in new year", shape.labelup, location.bottom, color.teal, text = "New year", 
     textcolor = color.white, size = size.huge
 )
plotshape(
     closeInNewMonth, "Close in new month", shape.labeldown, location.top, text = "New month", 
     textcolor = color.white, size = size.large
 )
// Plot a triangle below the chart bar when `closeInNewQuarter` occurs. 
plotshape(
     closeInNewQuarter, "Close in new quarter", shape.triangleup, location.belowbar, color.maroon, 
     text = "New quarter", textcolor = color.maroon, size = size.large
 )
// Highlight the background in alternating colors based on occurrences of `closeInNewDay`.
bgcolor(alternateDay ? color.new(color.aqua, 80) : color.new(color.fuchsia, 80), title = "Closing day change")</code></div>
<p>Note that:</p>
<ul>
<li>This script’s conditions check for the first bar that closes after each calendar unit changes its value. The bar where each condition is <code dir="auto">true</code> varies with the data available on the chart. For example, the <code dir="auto">closeInNewMonth</code> condition can be <code dir="auto">true</code> <em>after</em> the first calendar day of the month if a chart bar did not close on that day.</li>
<li>To detect when new bars start on a specific <em>timeframe</em> rather than strictly calendar changes, check when the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.change">ta.change()</a> of a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a> call’s returned value is nonzero, or use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">timeframe.change()</a> function. See <a href="/pine-script-docs/v5/concepts/time/#testing-for-changes-in-higher-timeframes">this section</a> above for more information.</li>
</ul>
<h3 class="md-heading" id="timestamp"><a href="#timestamp">`timestamp()`<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function calculates a <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> from a specified calendar date and time. It has the following three signatures:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">timestamp(year, month, day, hour, minute, second) → simple/series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">timestamp(timezone, year, month, day, hour, minute, second) → simple/series int</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">timestamp(dateString) → const int</span></div></div></code></pre></figure></div>
<p>The first two signatures listed include <code dir="auto">year</code>, <code dir="auto">month</code>, <code dir="auto">day</code>, <code dir="auto">hour</code>, <code dir="auto">minute</code>, and <code dir="auto">second</code> parameters that accept “int” values defining the calendar date and time. A <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call with either signature must include <code dir="auto">year</code>, <code dir="auto">month</code>, and <code dir="auto">day</code> arguments. The other parameters are optional, each with a default value of 0. Both signatures can return either <em>“simple”</em> or <em>“series”</em> values, depending on the <a href="/pine-script-docs/v5/language/type-system/#qualifiers">qualified types</a> of the specified arguments.</p>
<p>The primary difference between the first two signatures is the <code dir="auto">timezone</code> parameter, which accepts a <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> that determines the <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a> of the <em>date and time</em> specified by the other parameters. If a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call with “int” calendar arguments does not include a <code dir="auto">timezone</code> argument, it uses the exchange time zone (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a>) by default.</p>
<p>The third signature listed has only <em>one</em> parameter, <code dir="auto">dateString</code>, which accepts a “string” representing a valid calendar date (e.g., <code dir="auto">"20 Aug 2024"</code>). The value can also include the time of day and time zone (e.g., <code dir="auto">"20 Aug 2024 00:00:00 UTC+0"</code>). If the <code dir="auto">dateString</code> argument does not specify the time of day, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call considers the time 00:00 (midnight).</p>
<p>Unlike the other two signatures, the default time zone for the third signature is <strong>GMT+0</strong>. It does <strong>not</strong> use the exchange time zone by default because it interprets time zone information from the <code dir="auto">dateString</code> directly. Additionally, the third signature is the only one that returns a <em>“const int”</em> value. As shown in the <a href="/pine-script-docs/v5/concepts/inputs/#time-input">Time input</a> section of the <a href="/pine-script-docs/v5/concepts/inputs/">Inputs</a> page, programmers can use this overload’s returned value as the <code dir="auto">defval</code> argument in an <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a> function call.</p>
<p>When using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> function, it’s crucial to understand how time zone information affects its calculations. The <em>absolute</em> point in time represented by a specific calendar date <em>depends</em> on its time zone, as an identical date and time in various time zones can refer to <strong>different</strong> amounts of time elapsed since the <em>UNIX Epoch</em>. Therefore, changing the time zone of the calendar date and time in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call <em>can change</em> its returned <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a>.</p>
<p>The following script compares the results of four different <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> calls that evaluate the date 2021-01-01 in different time zones. The first <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call does not specify time zone information in its <code dir="auto">dateString</code> argument, so it treats the value as a <em>UTC</em> calendar date. The fourth call also evaluates the calendar date in UTC because it includes <code dir="auto">"UTC0"</code> as the <code dir="auto">timezone</code> argument. The second <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call uses the first signature listed above, meaning it uses the exchange time zone, and the third call uses the second signature with <code dir="auto">"America/New_York"</code> as the <code dir="auto">timezone</code> argument.</p>
<p>The script draws a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> with rows displaying each <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> call, its assigned variable, the calculated UNIX timestamp, and a <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> representation of the time. As we see on the “NASDAQ:MSFT” chart below, the first and fourth table rows show <em>different</em> timestamps than the first and third, leading to different formatted strings in the last column:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="472" loading="lazy" src="images/7558df648f05c40c1c5e6f68b277725c.webp" width="1378"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`timestamp()` demo", overlay = false)

//@variable A `table` that displays the different `timestamp()` calls, their returned timestamps, and formatted results.
var table displayTable = table.new(
     position.middle_center, 4, 5, color.white, border_color = color.black, border_width = 2
 )

//@function Initializes a `displayTable` cell showing the `displayText` with an optional `specialFormat`.
printCell(int colID, int rowID, string displayText, string specialFormat = "") =&gt; 
    displayTable.cell(colID, rowID, displayText, text_size = size.large)
    switch specialFormat 
        "header"  =&gt; displayTable.cell_set_bgcolor(colID, rowID, color.rgb(76, 175, 79, 70))
        "code"    =&gt; 
            displayTable.cell_set_text_font_family(colID, rowID, font.family_monospace)
            displayTable.cell_set_text_size(colID, rowID, size.normal)
            displayTable.cell_set_text_halign(colID, rowID, text.align_left)

if barstate.islastconfirmedhistory
    //@variable The UNIX timestamp corresponding to January 1, 2021 in the UTC+0 time zone. 
    int dateTimestamp1 = timestamp("2021-01-01")
    //@variable The UNIX timestamp corresponding to January 1, 2021 in the exchange time zone. 
    int dateTimestamp2 = timestamp(2021, 1, 1, 0, 0)
    //@variable The UNIX timestamp corresponding to January 1, 2021 in the "America/New_York" time zone. 
    int dateTimestamp3 = timestamp("America/New_York", 2021, 1, 1, 0, 0)
    //@variable The UNIX timestamp corresponding to January 1, 2021 in the "UTC0" (UTC+0) time zone. 
    int dateTimestamp4 = timestamp("UTC0", 2021, 1, 1, 0, 0)

    // Initialize the top header cells in the `displayTable`. 
    printCell(0, 0, "Variable",            "header")
    printCell(1, 0, "Function call",       "header")
    printCell(2, 0, "Timestamp returned",  "header")
    printCell(3, 0, "Formatted date/time", "header")
    // Initialize a table row for `dateTimestamp1` results. 
    printCell(0, 1, "`dateTimestamp1`", "header")
    printCell(1, 1, "`timestamp(\"2021-01-01\")`", "code")
    printCell(2, 1, str.tostring(dateTimestamp1))
    printCell(3, 1, str.format_time(dateTimestamp1, "yyyy.MM.dd  HH:mm (Z)"))
    // Initialize a table row for `dateTimestamp2` results. 
    printCell(0, 2, "`dateTimestamp2`", "header")
    printCell(1, 2, "`timestamp(2021, 1, 1, 0, 0)`", "code")
    printCell(2, 2, str.tostring(dateTimestamp2))
    printCell(3, 2, str.format_time(dateTimestamp2, "yyyy.MM.dd  HH:mm (Z)"))
    // Initialize a table row for `dateTimestamp3` results. 
    printCell(0, 3, "`dateTimestamp3`", "header")
    printCell(1, 3, "`timestamp(\"America/New_York\", 2021, 1, 1, 0, 0)`", "code")
    printCell(2, 3, str.tostring(dateTimestamp3))
    printCell(3, 3, str.format_time(dateTimestamp3, "yyyy.MM.dd  HH:mm (Z)"))
    // Initialize a table row for `dateTimestamp4` results. 
    printCell(0, 4, "`dateTimestamp4`", "header")
    printCell(1, 4, "`timestamp(\"UTC0\", 2021, 1, 1, 0, 0)`", "code")
    printCell(2, 4, str.tostring(dateTimestamp4))
    printCell(3, 4, str.format_time(dateTimestamp4, "yyyy.MM.dd  HH:mm (Z)"))</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> date-time strings express results in the exchange time zone because the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function uses <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> as the default <code dir="auto">timezone</code> argument. The formatted values on our example chart show the offset string <code dir="auto">"-0500"</code> because NASDAQ’s time zone (“America/New_York”) follows UTC-5 during <em>standard time</em>.</li>
<li>The formatted strings on the first and fourth rows show the date and time five hours <em>before</em> January 1, 2021, because the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> calls evaluated the date in <em>UTC</em> and the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> calls used a time zone five hours <em>behind</em> UTC.</li>
<li>On our chart, the second and third rows have matching timestamps because both corresponding <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timestamp">timestamp()</a> calls evaluated the date in the “America/New_York” time zone. The two rows would show different results if we applied the script to a symbol with a different exchange time zone.</li>
</ul>
<h2 class="md-heading" id="formatting-dates-and-times"><a href="#formatting-dates-and-times">Formatting dates and times<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Programmers can format <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a> into human-readable dates and times, expressed in specific <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zones</a>, using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function. The function has the following signature:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">str.format_time(time, format, timezone) → series string</span></div></div></code></pre></figure></div>
<p>Where:</p>
<ul>
<li>The <code dir="auto">time</code> parameter specifies the “int” UNIX timestamp to express as a readable time.</li>
<li>The <code dir="auto">format</code> parameter accepts a “string” consisting of <em>formatting tokens</em> that determine the returned information. If the function call does not include a <code dir="auto">format</code> argument, it uses the <a href="https://en.wikipedia.org/wiki/ISO_8601" rel="nofollow">ISO 8601</a> standard format: <code dir="auto">"yyyy-MM-dd'T'HH:mm:ssZ"</code>. See the table below for a list of valid tokens and the information they represent.</li>
<li>The <code dir="auto">timezone</code> parameter determines the time zone of the formatted result. It accepts a <a href="/pine-script-docs/v5/concepts/time/#time-zone-strings">time zone string</a> in UTC or IANA notation. If the call does not specify a <code dir="auto">timezone</code>, it uses the exchange time zone (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a>).</li>
</ul>
<p>The general-purpose <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a> function can also format UNIX timestamps into readable dates and times. However, the function <strong>cannot</strong> express time information in <em>different</em> time zones. It always expresses dates and times in <strong>UTC+0</strong>. In turn, using this function to format timestamps often results in <em>erroneous</em> practices, such as mathematically modifying a timestamp to try and represent the time in another time zone. However, a UNIX timestamp is a unique, <strong>time zone-agnostic</strong> representation of a specific point in time. As such, modifying a UNIX timestamp changes the <em>absolute time</em> it represents rather than expressing the same time in a different time zone.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function does not have this limitation, as it can calculate dates and times in <em>any</em> time zone correctly without changing the meaning of a UNIX timestamp. In addition, unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>, it is optimized specifically for processing time values. Therefore, we recommend that programmers use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> instead of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a> to format UNIX timestamps into readable dates and times.</p>
<p>A <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> call’s <code dir="auto">format</code> argument determines the time information its returned value contains. The function treats characters and sequences in the argument as <em>formatting tokens</em>, which act as <em>placeholders</em> for values in the returned date/time “string”. The following table outlines valid formatting tokens and explains what each represents:</p>
<table><thead><tr><th style="text-align:center">Token</th><th style="text-align:center">Represents</th><th style="text-align:left">Remarks and examples</th></tr></thead><tbody><tr><td style="text-align:center"><code dir="auto">"y"</code></td><td style="text-align:center">Year</td><td style="text-align:left">Use <code dir="auto">"yy"</code> to include the last two digits of the year (e.g., <code dir="auto">"00"</code>), or <code dir="auto">"yyyy"</code> to include the complete year number (e.g., <code dir="auto">"2000"</code>).</td></tr><tr><td style="text-align:center"><code dir="auto">"M"</code></td><td style="text-align:center">Month</td><td style="text-align:left">Uppercase <code dir="auto">"M"</code> for the month, not to be confused with <em>lowercase</em> <code dir="auto">"m"</code> for the minute. <br/>Use <code dir="auto">"MM"</code> to include the two-digit month number with a leading zero for single-digit values (e.g., <code dir="auto">"01"</code>), <code dir="auto">"MMM"</code> to include the three-letter abbreviation of month (e.g., <code dir="auto">"Jan"</code>), or <code dir="auto">"MMMM"</code> for the full month name (e.g., <code dir="auto">"January"</code>).</td></tr><tr><td style="text-align:center"><code dir="auto">"d"</code></td><td style="text-align:center">Day of the <strong>month</strong></td><td style="text-align:left">Lowercase <code dir="auto">"d"</code>. <br/>Includes the numeric day of the month (<code dir="auto">"1"</code> to <code dir="auto">"31"</code>). <br/> Use <code dir="auto">"dd"</code> for the two-digit day number with a leading zero for single-digit values. <br/>It is <em>not</em> a placeholder for the day number of the <em>week</em> (1-7). Use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_dayofweek">dayofweek()</a> to calculate that value.</td></tr><tr><td style="text-align:center"><code dir="auto">"D"</code></td><td style="text-align:center">Day of the <strong>year</strong></td><td style="text-align:left">Uppercase <code dir="auto">"D"</code>. <br/> Includes the numeric day of the year (<code dir="auto">"1"</code> to <code dir="auto">"366"</code>). <br/> Use <code dir="auto">"DD"</code> or <code dir="auto">"DDD"</code> for the two-digit or three-digit day number with leading zeros.</td></tr><tr><td style="text-align:center"><code dir="auto">"w"</code></td><td style="text-align:center">Week of the <strong>year</strong></td><td style="text-align:left">Lowercase <code dir="auto">"w"</code>. <br/>Includes the week number of the year (<code dir="auto">"1"</code> to <code dir="auto">"53"</code>). <br/>Use <code dir="auto">"ww"</code> for the two-digit week number with a leading zero for single-digit values.</td></tr><tr><td style="text-align:center"><code dir="auto">"W"</code></td><td style="text-align:center">Week of the <strong>month</strong></td><td style="text-align:left">Uppercase <code dir="auto">"W"</code>. <br/>Includes the week number of the month (<code dir="auto">"1"</code> to <code dir="auto">"5"</code>).</td></tr><tr><td style="text-align:center"><code dir="auto">"a"</code></td><td style="text-align:center">AM/PM postfix</td><td style="text-align:left">Lowercase <code dir="auto">"a"</code>. <br/>Includes <code dir="auto">"AM"</code> if the time of day is before noon, <code dir="auto">"PM"</code> otherwise.</td></tr><tr><td style="text-align:center"><code dir="auto">"h"</code></td><td style="text-align:center">Hour in the <strong>12-hour</strong> format</td><td style="text-align:left">Lowercase <code dir="auto">"h"</code>. <br/>The included hour number from this token ranges from <code dir="auto">"0"</code> to <code dir="auto">"11"</code>. <br/>Use <code dir="auto">"hh"</code> for the two-digit hour with a leading zero for single-digit values.</td></tr><tr><td style="text-align:center"><code dir="auto">"H"</code></td><td style="text-align:center">Hour in the <strong>24-hour</strong> format</td><td style="text-align:left">Uppercase <code dir="auto">"H"</code>. <br/>The included hour number from this token ranges from <code dir="auto">"0"</code> to <code dir="auto">"23"</code>. <br/>Use <code dir="auto">"HH"</code> for the two-digit hour with a leading zero for single-digit values.</td></tr><tr><td style="text-align:center"><code dir="auto">"m"</code></td><td style="text-align:center">Minute</td><td style="text-align:left">Lowercase <code dir="auto">"m"</code> for the minute, not to be confused with <em>uppercase</em> <code dir="auto">"M"</code> for the month. <br/>Use <code dir="auto">"mm"</code> for the two-digit minute with a leading zero for single-digit values.</td></tr><tr><td style="text-align:center"><code dir="auto">"s"</code></td><td style="text-align:center">Second</td><td style="text-align:left">Lowercase <code dir="auto">"s"</code> for the second, not to be confused with <em>uppercase</em> <code dir="auto">"S"</code> for fractions of a second. <br/>Use <code dir="auto">"ss"</code> for the two-digit second with a leading zero for single-digit values.</td></tr><tr><td style="text-align:center"><code dir="auto">"S"</code></td><td style="text-align:center">Fractions of a second</td><td style="text-align:left">Uppercase <code dir="auto">"S"</code>. <br/> Includes the number of milliseconds in the fractional second (<code dir="auto">"0"</code> to <code dir="auto">"999"</code>). <br/> Use <code dir="auto">"SS"</code> or <code dir="auto">"SSS"</code> for the two-digit or three-digit millisecond number with leading zeros.</td></tr><tr><td style="text-align:center"><code dir="auto">"Z"</code></td><td style="text-align:center">Time zone (<strong>UTC offset</strong>)</td><td style="text-align:left">Uppercase <code dir="auto">"Z"</code>. <br/> Includes the hour and minute UTC offset value in <code dir="auto">"HHmm"</code> format, preceded by its sign (e.g., <code dir="auto">"-0400"</code>).</td></tr><tr><td style="text-align:center"><code dir="auto">"z"</code></td><td style="text-align:center">Time zone (<strong>acronym or name</strong>)</td><td style="text-align:left">Lowercase <code dir="auto">"z"</code>. <br/> A single <code dir="auto">"z"</code> includes the abbreviation of the time zone (e.g., <code dir="auto">"EDT"</code>). <br/> Use <code dir="auto">"zzzz"</code> for the time zone’s name (e.g., <code dir="auto">"Eastern Daylight Time"</code>). <br/>It is not a placeholder for the <em>IANA identifier</em>. Use <a href="https://www.tradingview.com/pine-script-reference/v5/#var_syminfo.timezone">syminfo.timezone</a> to retrieve the exchange time zone’s IANA representation.</td></tr><tr><td style="text-align:center"><code dir="auto">":"</code>, <code dir="auto">"/"</code>, <code dir="auto">"-"</code>, <code dir="auto">"."</code>, <code dir="auto">","</code>, <code dir="auto">"("</code>, <code dir="auto">")"</code>, <code dir="auto">" "</code></td><td style="text-align:center">Separators</td><td style="text-align:left">These characters are separators for formatting tokens. <br/>They appear as they are in the formatted text. (e.g., <code dir="auto">"01/01/24"</code>, <code dir="auto">"12:30:00"</code>, <code dir="auto">"Jan 1, 2024"</code>). <br/> Some other characters can also act as separators. However, the ones listed are the most common.</td></tr><tr><td style="text-align:center"><code dir="auto">"'"</code></td><td style="text-align:center">Escape character</td><td style="text-align:left">Characters enclosed within <em>two single quotes</em> appear as they are in the result, even if they otherwise act as formatting tokens. For example, <code dir="auto">" 'Day' "</code> appears as-is in the resulting “string” instead of listing the day of the year, AM/PM postfix, and year.</td></tr></tbody></table>
<p>The following example demonstrates how various formatting tokens affect the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function’s result. The script calls the function with different <code dir="auto">format</code> arguments to create date/time strings from <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_time_close">time_close</a> timestamps. It displays each <code dir="auto">format</code> value and the corresponding formatted result in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> on the last bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="528" loading="lazy" src="images/b6044b4e60a508c6b85a544625b77f10.webp" width="1338"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Formatting dates and times demo", overlay = false)

//@variable A `table` that displays different date/time `format` strings and their results.
var table displayTable = table.new(
     position.middle_center, 2, 15, bgcolor = color.white, 
     frame_color = color.black, frame_width = 1, border_width = 1
 )

//@function Initializes a `displayTable` row showing a `formatString` and its formatted result for a specified 
//          `timeValue` and `timezoneValue`.
displayText(rowID, formatString, timeValue = time, timezoneValue = syminfo.timezone) =&gt;
    //@variable Is light blue if the `rowID` is even, white otherwise. Used to set alternating table row colors.
    color rowColor = rowID % 2 == 0 ? color.rgb(33, 149, 243, 75) : color.white
    // Display the `formatString` in the row's first cell.
    displayTable.cell(
         0, rowID, formatString,
         text_color = color.black, text_halign = text.align_left, bgcolor = rowColor
     )
    // Show the result of formatting the `timeValue` based on the `formatString` and `timezoneValue` in the second cell.
    displayTable.cell(
         1, rowID, str.format_time(timeValue, formatString, timezoneValue), 
         text_color = color.black, text_halign = text.align_right, bgcolor = rowColor
     )

if barstate.islast
    // Initialize the table's header cells.
    displayTable.cell(0, 0, "FORMAT STRINGS")
    displayTable.cell(1, 0, "FORMATTED DATE/TIME OUTPUT")
    // Initialize a row to show the default date-time "string" format and its result for `time`. 
    displayTable.cell(
         0, 1, "(Default `str.format_time()` format)", 
         text_color = color.black, text_halign = text.align_left, bgcolor = color.yellow)
    displayTable.cell(
         1, 1, str.format_time(time), 
         text_color = color.black, text_halign = text.align_right, bgcolor = color.yellow)

    // Initialize rows to show different formatting strings and their results for `time`, `time_close`, and `timenow`.
    displayText(2, "dd/MM/yy")
    displayText(3, "MMMM dd, yyyy")
    displayText(4, "hh:mm:ss.SS a", timenow)
    displayText(5, "HH:mm 'UTC'Z")
    displayText(6, "H:mm a (zzzz)")
    displayText(7, "my day / 'my day' ('escaped')")
    displayText(8, "'Month' M, 'Week' w, 'Day' DDD")
    displayText(9, "'Bar expected closing time': ha", time_close)
    displayText(10, "'Current date/time': MMM-d-y HH:mm:ss z", timenow)
    displayText(11, "'New Time zone': zzzz", timezoneValue = "Australia/Sydney")
    displayText(12, "'Time zone change': MMM-d-y HH:mm:ss z", timenow, "Australia/Sydney")</code></div>
<h2 class="md-heading" id="expressing-time-differences"><a href="#expressing-time-differences">Expressing time differences<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Every <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamp</a> represents a specific point in time as the absolute <em>time difference</em> from a fixed historical point (epoch). The specific epoch all UNIX timestamps reference is <em>midnight UTC on January 1, 1970</em>. Programmers can <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">format</a> UNIX timestamps into readable date-time strings with the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function because it uses the time difference from the UNIX Epoch in its date and time calculations.</p>
<p>In contrast, the difference between two nonzero UNIX timestamps represents the number of milliseconds elapsed from one absolute point to another. The difference does not directly refer to a specific point in UNIX time if neither timestamp in the operation has a value of 0 (corresponding to the UNIX Epoch).</p>
<p>Programmers may want to express the millisecond difference between two UNIX timestamps in <em>other time units</em>, such as seconds, days, etc. Some might assume they can use the difference as the <code dir="auto">time</code> argument in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> call to achieve this result. However, the function always treats its <code dir="auto">time</code> argument as the time elapsed from the <em>UNIX Epoch</em> to derive a <em>calendar date/time</em> representation in a specific <a href="/pine-script-docs/v5/concepts/time/#time-zones">time zone</a>. It <strong>does not</strong> express time differences directly. Therefore, attempting to format timestamp <em>differences</em> rather than timestamps with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> leads to unintended results.</p>
<p>For example, the following script calculates the millisecond difference between the current execution time (<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timenow">timenow</a>) and the “1M” bar’s closing time (<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close(“1M”)</a>) for a monthly countdown timer display. It attempts to express the time difference in another format using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a>. It displays the function call’s result in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>, along with the original millisecond difference (<code dir="auto">timeLeft</code>) and <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> date-time representations of the timestamps.</p>
<p>As we see below, the table shows correct results for the formatted timestamps and the <code dir="auto">timeLeft</code> value. However, the formatted time difference appears as <code dir="auto">"1970-01-12T16:47:10-0500"</code>. Although the <code dir="auto">timeLeft</code> value is supposed to represent a difference between timestamps rather than a specific point in time, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a> function still treats the value as a <strong>UNIX timestamp</strong>. Consequently, it creates a “string” expressing the value as a <em>date and time</em> in the UTC-5 time zone:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/3fe967f5d66943905f6f114f7a111f47.webp" width="1666"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Incorrectly formatting time difference demo", overlay = true)

//@variable A table that displays monthly close countdown information.
var table displayTable = table.new(position.top_right, 1, 4, color.rgb(0, 188, 212, 60))

if barstate.islast
    //@variable A UNIX timestamp representing the current time as of the script's latest execution. 
    int currentTime = timenow
    //@variable A UNIX timestamp representing the expected closing time of the current "1M" bar. 
    int monthCloseTime = time_close("1M")

    //@variable The number of milliseconds between the `currentTime` and the `monthCloseTime`. 
    //          This value is NOT intended as a UNIX timestamp.
    int timeLeft = monthCloseTime - currentTime
    //@variable A "string" representing the `timeLeft` as a date and time in the exchange time zone, in ISO 8601 format.
    //          This format is INCORRECT for the `timeLeft` value because it's supposed to represent the time between 
    //          two nonzero UNIX timestamps, NOT a specific point in time.
    string incorrectTimeFormat = str.format_time(timeLeft)

    // Initialize `displayTable` cells to initialize the `currentTime` and `monthCloseTime`.
    displayTable.cell(
         0, 0, "Current time: " + str.format_time(currentTime, "HH:mm:ss.S dd/MM/yy (z)"), 
         text_size = size.large, text_halign = text.align_right
     )
    displayTable.cell(
         0, 1, "`1M` Bar closing time: " + str.format_time(monthCloseTime, "HH:mm:ss.SS dd/MM/yy (z)"), 
         text_size = size.large, text_halign = text.align_right
     )
    // Initialize a cell to display the `timeLeft` millisecond difference.
    displayTable.cell(
         0, 2, "`timeLeft` value: " + str.tostring(timeLeft), 
         text_size = size.large, bgcolor = color.yellow
     )
    // Initialize a cell to display the `incorrectTimeFormat` representation.
    displayTable.cell(
         0, 3, "Time left (incorrect format): " + incorrectTimeFormat, 
         text_size = size.large, bgcolor = color.maroon, text_color = color.white
     )</code></div>
<p>To express the difference between timestamps in other time units correctly, programmers must write code that <em>calculates</em> the number of units elapsed instead of erroneously formatting the difference as a specific date or time.</p>
<p>The calculations required to express time differences depend on the chosen time units. The sections below explain how to express millisecond differences in <a href="/pine-script-docs/v5/concepts/time/#weekly-and-smaller-units">weekly and smaller units</a>, and <a href="/pine-script-docs/v5/concepts/time/#monthly-and-larger-units">monthly and larger units</a>.</p>
<h3 class="md-heading" id="weekly-and-smaller-units"><a href="#weekly-and-smaller-units">Weekly and smaller units<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Weeks and smaller time units (days, hours, minutes, seconds, and milliseconds) cover <em>consistent</em> blocks of time. These units have the following relationship:</p>
<ul>
<li>One week equals seven days.</li>
<li>One day equals 24 hours.</li>
<li>One hour equals 60 minutes.</li>
<li>One minute equals 60 seconds.</li>
<li>One second equals 1000 milliseconds.</li>
</ul>
<p>Using this relationship, programmers can define the span of these units by the number of <em>milliseconds</em> they contain. For example, since every hour has 60 minutes, every minute has 60 seconds, and every second has 1000 milliseconds, the number of milliseconds per hour is <code dir="auto">60 * 60 * 1000</code>, which equals <code dir="auto">3600000</code>.</p>
<p>Programmers can use <em>modular arithmetic</em> based on the milliseconds in each unit to calculate the total number of weeks, days, and smaller spans covered by the difference between two <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a>. The process is as follows, starting from the <em>largest</em> time unit in the calculation:</p>
<ol>
<li>Calculate the number of milliseconds in the time unit.</li>
<li>Divide the remaining millisecond difference by the calculated value and round down to the nearest whole number. The result represents the number of <em>complete</em> time units within the interval.</li>
<li>Use the <em>remainder</em> from the division as the new remaining millisecond difference.</li>
<li>Repeat steps 1-3 for each time unit in the calculation, in <em>descending</em> order based on size.</li>
</ol>
<p>The following script implements this process in a custom <code dir="auto">formatTimeSpan()</code> function. The function accepts two UNIX timestamps defining a start and end point, and its “bool” parameters control whether it calculates the number of weeks or smaller units covered by the time range. The function calculates the millisecond distance between the two timestamps. It then calculates the numbers of complete units covered by that distance and formats the results into a “string”.</p>
<p>The script calls <code dir="auto">formatTimeSpan()</code> to express the difference between two separate <a href="/pine-script-docs/v5/concepts/inputs/#time-input">time input</a> values in selected time units. It then displays the resulting “string” in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a> alongside <a href="/pine-script-docs/v5/concepts/time/#formatting-dates-and-times">formatted</a> representations of the start and end times:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="412" loading="lazy" src="images/28c2a8716ea04079439164a524a6b88a.webp" width="1256"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Calculating time span demo")

// Assign the number of milliseconds in weekly and smaller units to "const" variables for convenience.
const int ONE_WEEK   = 604800000
const int ONE_DAY    =  86400000 
const int ONE_HOUR   =   3600000
const int ONE_MINUTE =     60000
const int ONE_SECOND =      1000

//@variable A UNIX timestamp calculated from the user-input start date and time. 
int startTimeInput = input.time(timestamp("1 May 2022 00:00 -0400"), "Start date and time", group = "Time between")
//@variable A UNIX timestamp calculated from the user-input end date and time. 
int endTimeInput =   input.time(timestamp("7 Sep 2024 20:37 -0400"), "End date and time", group = "Time between")
// Create "bool" inputs to toggle weeks, days, hours, minutes, seconds, and milliseconds in the calculation.
bool weeksInput        = input.bool(true, "Weeks",        group = "Time units", inline = "A")
bool daysInput         = input.bool(true, "Days",         group = "Time units", inline = "A")
bool hoursInput        = input.bool(true, "Hours",        group = "Time units", inline = "B")
bool minutesInput      = input.bool(true, "Minutes",      group = "Time units", inline = "B")
bool secondsInput      = input.bool(true, "Seconds",      group = "Time units", inline = "B")
bool millisecondsInput = input.bool(true, "Milliseconds", group = "Time units", inline = "B")

//@function Calculates the difference between two UNIX timestamps as the number of complete time units in 
//          descending order of size, formatting the results into a "string". The "int" parameters accept timestamps, 
//          and the "bool" parameters determine which units the function uses in its calculations. 
formatTimeSpan(
      int startTimestamp, int endTimestamp, bool calculateWeeks, bool calculateDays, bool calculateHours, 
      bool calculateMinutes, bool calculateSeconds, bool calculateMilliseconds
 ) =&gt;
    //@variable The milliseconds between the `startTimestamp` and `endTimestamp`.
    int timeDifference = math.abs(endTimestamp - startTimestamp) 
    //@variable A "string" representation of the interval in mixed time units. 
    string formattedString = na
    // Calculate complete units within the interval for each toggled unit, reducing the `timeDifference` by those sizes.
    if calculateWeeks
        int totalWeeks = math.floor(timeDifference / ONE_WEEK)
        timeDifference %= ONE_WEEK
        formattedString += str.tostring(totalWeeks) + (totalWeeks == 1 ? " week " : " weeks ") 
    if calculateDays
        int totalDays = math.floor(timeDifference / ONE_DAY)
        timeDifference %= ONE_DAY
        formattedString += str.tostring(totalDays) + (totalDays == 1 ? " day " : " days ")
    if calculateHours
        int totalHours = math.floor(timeDifference / ONE_HOUR)
        timeDifference %= ONE_HOUR
        formattedString += str.tostring(totalHours) + (totalHours == 1 ? " hour " : " hours ")
    if calculateMinutes
        int totalMinutes = math.floor(timeDifference / ONE_MINUTE)
        timeDifference %= ONE_MINUTE
        formattedString += str.tostring(totalMinutes) + (totalMinutes == 1 ? " minute " : " minutes ")
    if calculateSeconds
        int totalSeconds = math.floor(timeDifference / ONE_SECOND)
        timeDifference %= ONE_SECOND
        formattedString += str.tostring(totalSeconds) + (totalSeconds == 1 ? " second " : " seconds ")  
    if calculateMilliseconds
        // `timeDifference` is in milliseconds already, so add it to the `formattedString` directly.
        formattedString += str.tostring(timeDifference) + (timeDifference == 1 ? " millisecond" : " milliseconds")
    // Return the `formattedString`.
    formattedString

if barstate.islastconfirmedhistory
    //@variable A table that that displays formatted start and end times and their custom-formatted time difference. 
    var table displayTable = table.new(position.middle_center, 1, 2, color.aqua)
    //@variable A "string" containing formatted `startTimeInput` and `endTimeInput` values. 
    string timeText = "Start date and time: "    + str.format_time(startTimeInput, "dd/MM/yy HH:mm:ss (z)")
                     + "\n  End date and time: " + str.format_time(endTimeInput, "dd/MM/yy HH:mm:ss (z)")
    //@variable A "string" representing the span between `startTimeInput` and `endTimeInput` in mixed time units.
    string userTimeSpan = formatTimeSpan(
         startTimeInput, endTimeInput, weeksInput, daysInput, hoursInput, minutesInput, secondsInput, millisecondsInput
      )
    // Display the `timeText` in the table.
    displayTable.cell(0, 0, timeText, 
         text_color = color.white, text_size = size.large, text_halign = text.align_left)
    // Display the `userTimeSpan` in the table.
    displayTable.cell(0, 1, "Time span: " + userTimeSpan, 
          text_color = color.white, text_size = size.large, text_halign = text.align_left, bgcolor = color.navy)</code></div>
<p>Note that:</p>
<ul>
<li>The <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.floor">math.floor()</a> to round each divided result down to the nearest “int” value to get the number of <em>complete</em> units in the interval. After division, it uses the modulo assignment operator (<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%25=">%=</a>) to get the <em>remainder</em> and assign that value to the <code dir="auto">timeDifference</code> variable. This process repeats for each selected unit.</li>
</ul>
<p>The image above shows the calculated time difference in mixed time units. By toggling the “bool” inputs, users can also isolate specific units in the calculation. For example, this image shows the result after enabling only the “Milliseconds” input:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="338" loading="lazy" src="images/87f24b46093a5770fa465fa1aeeedc4d.webp" width="988"/></div></p>
<h3 class="md-heading" id="monthly-and-larger-units"><a href="#monthly-and-larger-units">Monthly and larger units<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Unlike weeks and smaller units, months and larger units <em>vary</em> in length based on calendar rules. For example, a month can contain 28, 29, 30, or 31 days, and a year can contain 365 or 366 days.</p>
<p>Some programmers prefer to use the modular arithmetic outlined in the <a href="/pine-script-docs/v5/concepts/time/#weekly-and-smaller-units">previous section</a>, with <em>approximate lengths</em> for these irregular units, to calculate large-unit durations between <a href="/pine-script-docs/v5/concepts/time/#unix-timestamps">UNIX timestamps</a>. With this process, programmers usually define the units in either of the following ways:</p>
<ul>
<li>Using <em>common</em> lengths, e.g., a common year equals 365 days, and a common month equals 30 days.</li>
<li>Using the <em>average</em> lengths, e.g., an average year equals 365.25 days, and an average month equals 30.4375 days.</li>
</ul>
<p>Calculations involving approximate units produce <em>rough estimates</em> of the elapsed time. Such estimates are often practical when expressing relatively short durations. However, their precision diminishes with the size of the difference, drifting further away from the actual time elapsed.</p>
<p>Therefore, expressing time differences in monthly and larger units with precision requires a different calculation than the process outlined above. For a more precise estimate of months, years, and larger units elapsed, the calculations should use the <em>actual</em> span of each individual unit rather than approximations, meaning it must account for <em>leap years</em> and <em>variations</em> in month sizes.</p>
<p>The advanced example below contains a custom <code dir="auto">formatTimeDifference()</code> function that calculates the years and months, in addition to days and smaller units, elapsed between two UNIX timestamps.</p>
<p>The function uses the process outlined in the <a href="/pine-script-docs/v5/concepts/time/#weekly-and-smaller-units">previous section</a> to calculate the daily and smaller units within the interval. For the monthly and yearly units, which have <em>irregular</em> lengths, the function uses a <a href="/pine-script-docs/v5/language/loops/#while-loops">while</a> loop to iterate across calendar months. On each iteration, it increments monthly and yearly counters and subtracts the number of days in the added month from the day counter. After the loop ends, the function adjusts the year, month, and day counters to account for partial months elapsed between the timestamps. Finally, it uses the counters in a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a> call to create a formatted “string” containing the calculated values.</p>
<p>The script calls this <code dir="auto">formatTimeDifference()</code> function to calculate the years, months, days, hours, minutes, seconds, and milliseconds elapsed between two separate <a href="/pine-script-docs/v5/concepts/inputs/#time-input">time input</a> values and displays the result in a <a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="428" loading="lazy" src="images/9f599143b08923e7ffa985dd48ffd06e.webp" width="1060"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Calculating time span for larger units demo")

//@variable The starting date and time of the time span, input by the user.
int startTimeInput = input.time(timestamp("3 Apr 2022 20:00 -0400"), "Start date", group = "Time between")
//@variable The ending date and time of the time span, input by the user.
int endTimeInput =   input.time(timestamp("3 Sep 2024 15:45 -0400"), "End date",   group = "Time between")

//@function Returns the number of days in the `monthNumber` month of the `yearNumber` year.
daysPerMonth(int yearNumber, int monthNumber) =&gt;
    //@variable Is `true` if the `yearNumber` represents a leap year.
    bool leapYear = (yearNumber % 4 == 0 and yearNumber % 100 != 0) or (yearNumber % 400 == 0)
    //@variable The number of days calculated for the month.
    int result = switch
        monthNumber == 2 =&gt; leapYear ? 29 : 28
        =&gt;                  31 - (monthNumber - 1) % 7 % 2

//@function Calculates the relative time difference between two timestamps, covering monthly and larger units.
formatTimeDifference(int timestamp1, int timestamp2) =&gt;
    // The starting time and ending time.
    int startTime = math.min(timestamp1, timestamp2), int endTime = math.max(timestamp1, timestamp2)
    // The year, month, and day of the `startTime` and `endTime`.
    int startYear = year(startTime), int startMonth = month(startTime), int startDay = dayofmonth(startTime)
    int endYear   = year(endTime),   int endMonth   = month(endTime),   int endDay   = dayofmonth(endTime)
    // Calculate the total number of days, hours, minutes, seconds, and milliseconds in the interval.
    int milliseconds = endTime - startTime
    int days         = math.floor(milliseconds / 86400000), milliseconds %= 86400000
    int hours        = math.floor(milliseconds / 3600000),  milliseconds %= 3600000
    int minutes      = math.floor(milliseconds / 60000),    milliseconds %= 60000
    int seconds      = math.floor(milliseconds / 1000),     milliseconds %= 1000
    // Calculate the number of days in the `startMonth` and `endMonth`.
    int daysInStartMonth = daysPerMonth(startYear, startMonth), int daysInEndMonth = daysPerMonth(endYear, endMonth)
    //@variable The number of days remaining in the `startMonth`. 
    int remainingInMonth = daysInStartMonth - startDay + 1
    // Subtract `remainingInMonth` from the `days`, and offset the `startDay` and `startMonth`.
    days -= remainingInMonth, startDay := 1, startMonth += 1
    // Set `startMonth` to 1, and increase the `startYear` if the `startMonth` exceeds 12.
    if startMonth &gt; 12
        startMonth := 1, startYear += 1
    // Initialize variables to count the total number of months and years in the interval.
    int months = 0, int years  = 0
    // Loop to increment `months` and `years` values based on the `days`.
    while days &gt; 0
        //@variable The number of days in the current `startMonth`.
        int daysInMonth = daysPerMonth(startYear, startMonth)
        // Break the loop if the number of remaining days is less than the `daysInMonth`.
        if days &lt; daysInMonth
            break
        // Reduce the `days` by the `daysInMonth` and increment the `months`.
        days -= daysInMonth, months += 1
        // Increase the `years` and reset the `months` to 0 when `months` is 12.
        if months == 12
            months := 0, years += 1
        // Increase the `startMonth` and adjust the `startMonth` and `startYear` if its value exceeds 12.
        startMonth += 1
        if startMonth &gt; 12
            startMonth := 1, startYear += 1
    // Re-add the `remainingInMonth` value to the number of `days`. Adjust the `days`, `months`, and `years` if the 
    // new value exceeds the `daysInStartMonth` or `daysInEndMonth`, depending on the `startDay`.
    days += remainingInMonth
    if days &gt;= (startDay &lt; daysInStartMonth / 2 ? daysInStartMonth : daysInEndMonth) 
        months += 1
        if months == 12
            months := 0, years += 1
        days -= remainingInMonth
    // Format the calculated values into a "string" and return the result.
    str.format(
         " Years:   {0}\n Months: {1}\n Days:    {2}\n Hours:    {3}\n Minutes:  {4}\n Seconds: {5}
         \n Milliseconds: {6}", years, months, days, hours, minutes, seconds, milliseconds
     )

if barstate.islastconfirmedhistory
    //@variable A "string" representing the time between the `startTimeInput` and `endTimeInput` in mixed units. 
    string userTimeSpan = formatTimeDifference(startTimeInput, endTimeInput)
    //@variable Text shown in the label.
    string labelText = "Start time: " + str.format_time(startTimeInput, "dd/MM/yy HH:mm:ss (z)") + "\n  End time: "
         +  str.format_time(endTimeInput, "dd/MM/yy HH:mm:ss (z)") + "\n---------\nTime difference:\n" + userTimeSpan
    label.new(
         bar_index, high, labelText, color = #FF946E, size = size.large, 
         textalign = text.align_left, style = label.style_label_center
     )</code></div>
<p>Note that:</p>
<ul>
<li>The script determines the number of days in each month with the user-defined <code dir="auto">daysPerMonth()</code> function. The function identifies whether a month has 28, 29, 30, or 31 days based on its month number and the year it belongs to. Its calculation accounts for leap years. A leap year occurs when the year is divisible by 4 or 400 but not by 100.</li>
<li>Before the <a href="/pine-script-docs/v5/language/loops/#while-loops">while</a> loop, the function subtracts the number of days in a partial starting month from the initial day count, aligning the counters with the beginning of a new month. It re-adds the subtracted days after the loop to adjust the counters for partial months. It adjusts the month and year counters based on the days in the <code dir="auto">startMonth</code> if the <code dir="auto">startDay</code> is less than halfway through that month. Otherwise, it adjusts the values based on the days in the <code dir="auto">endMonth</code>.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/text-and-shapes"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Text and shapes  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/timeframes"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Timeframes <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/concepts/alerts">Concepts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Timeframes</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="concepts-timeframes"><a href="#timeframes">Timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <em>timeframe</em> of a chart is sometimes also referred to as its
<em>interval</em> or <em>resolution</em>. It is the unit of time represented by one
bar on the chart. All standard chart types use a timeframe: “Bars”,
“Candles”, “Hollow Candles”, “Line”, “Area” and “Baseline”.
One non-standard chart type also uses timeframes: “Heikin Ashi”.</p>
<p>Programmers interested in accessing data from multiple timeframes will
need to become familiar with how timeframes are expressed in Pine
Script™, and how to use them.</p>
<p><strong>Timeframe strings</strong> come into play in different contexts:</p>
<ul>
<li>They must be used in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>
when requesting data from another symbol and/or timeframe. See the
page on
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> to explore the use of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>.</li>
<li>They can be used as an argument to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time">time()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_time_close">time_close()</a>
functions, to return the time of a higher timeframe bar. This, in
turn, can be used to detect changes in higher timeframes from the
chart’s timeframe without using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>.
See the
<a href="/pine-script-docs/v5/concepts/time/#testing-for-changes-in-higher-timeframes">Testing for changes in higher timeframes</a> section to see how to do this.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsession">input.timeframe()</a>
function provides a way to allow script users to define a timeframe
through a script’s “Inputs” tab (see the
<a href="/pine-script-docs/v5/concepts/inputs/#timeframe-input">Timeframe input</a> section for more information).</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
declaration statement has an optional <code dir="auto">timeframe</code> parameter that can
be used to provide multi-timeframe capabilities to simple scripts
without using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request%7Bdot%7Dsecurity">request.security()</a>.</li>
<li>Many built-in variables provide information on the timeframe used by
the chart the script is running on. See the
<a href="/pine-script-docs/v5/concepts/chart-information/#chart-timeframe">Chart timeframe</a> section for more information on them, including
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe%7Bdot%7Dperiod">timeframe.period</a>
which returns a string in Pine Script™‘s timeframe specification
format.</li>
</ul>
<h2 class="md-heading" id="timeframe-string-specifications"><a href="#timeframe-string-specifications">Timeframe string specifications<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Timeframe strings follow these rules:</p>
<ul>
<li>
<p>They are composed of the multiplier and the timeframe unit, e.g.,
“1S”, “30” (30 minutes), “1D” (one day), “3M” (three
months).</p>
</li>
<li>
<p>The unit is represented by a single letter, with no letter used for
minutes: “T” for ticks, “S” for seconds, “D” for days, “W” for weeks, and
“M” for months.</p>
</li>
<li>
<p>When no multiplier is used, 1 is assumed: “S” is equivalent to
“1S”, “D” to “1D”, etc. If only “1” is used, it is interpreted
as 1 minute, since no unit letter identifier is used for minutes.</p>
</li>
<li>
<p>There is no “hour” unit; “1H” is <strong>not</strong> valid. The correct
format for one hour is “60” (remember no unit letter is specified
for minutes).</p>
</li>
<li>
<p>The valid multipliers vary for each timeframe unit:</p>
<ul>
<li>For ticks, only the discrete 1, 10, 100, and 1000 multipliers are valid.</li>
<li>For seconds, only the discrete 1, 5, 10, 15, 30, and 45 multipliers are valid.</li>
<li>For minutes, 1 to 1440.</li>
<li>For days, 1 to 365.</li>
<li>For weeks, 1 to 52.</li>
<li>For months, 1 to 12.</li>
</ul>
</li>
</ul>
<h2 class="md-heading" id="comparing-timeframes"><a href="#comparing-timeframes">Comparing timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>It can be useful to compare different timeframe strings to determine,
for example, if the timeframe used on the chart is lower than the higher
timeframes used in the script.</p>
<p>Converting timeframe strings to a representation in fractional minutes
provides a way to compare them using a universal unit. This script uses
the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe%7Bdot%7Din_seconds">timeframe.in_seconds()</a>
function to convert a timeframe into float seconds and then converts the
result into minutes:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Timeframe in minutes example", "", true)
string tfInput = input.timeframe(defval = "", title = "Input TF")

float chartTFInMinutes = timeframe.in_seconds() / 60
float inputTFInMinutes = timeframe.in_seconds(tfInput) / 60

var table t = table.new(position.top_right, 1, 1)
string txt = "Chart TF: "    + str.tostring(chartTFInMinutes, "#.##### minutes") + 
"\nInput TF: " + str.tostring(inputTFInMinutes, "#.##### minutes")
if barstate.isfirst
    table.cell(t, 0, 0, txt, bgcolor = color.yellow)
else if barstate.islast
    table.cell_set_text(t, 0, 0, txt)

if chartTFInMinutes &gt; inputTFInMinutes
    runtime.error("The chart's timeframe must not be higher than the input's timeframe.")</code></div>
<p>Note that:</p>
<ul>
<li>We use the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe%7Bdot%7Din_seconds">timeframe.in_seconds()</a>
function to convert the chart and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsession">input.timeframe()</a>
function into seconds, then divide by 60 to convert into minutes.</li>
<li>We use two calls to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe%7Bdot%7Din_seconds">timeframe.in_seconds()</a>
function in the initialization of the <code dir="auto">chartTFInMinutes</code> and
<code dir="auto">inputTFInMinutes</code> variables. In the first instance, we do not
supply an argument for its <code dir="auto">timeframe</code> parameter, so the function
returns the chart’s timeframe in seconds. In the second call, we
supply the timeframe selected by the script’s user through the call
to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dsession">input.timeframe()</a>.</li>
<li>Next, we validate the timeframes to ensure that the input timeframe
is equal to or higher than the chart’s timeframe. If it is not, we
generate a runtime error.</li>
<li>We finally print the two timeframe values converted to minutes.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/concepts/time"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Time  </h4> </a> <span data-astro-cid-xgirumru=""></span> </div> </main><h1>Writing Scripts</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/writing/style-guide">Writing scripts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Style guide</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="writing-scripts-style-guide"><a href="#style-guide">Style guide<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This style guide provides recommendations on how to name variables and
organize your Pine scripts in a standard way that works well. Scripts
that follow our best practices will be easier to read, understand and
maintain.</p>
<p>You can see scripts using these guidelines published from the
<a href="https://www.tradingview.com/u/TradingView/#published-scripts">TradingView</a>
and
<a href="https://www.tradingview.com/u/PineCoders/#published-scripts">PineCoders</a>
accounts on the platform.</p>
<h2 class="md-heading" id="naming-conventions"><a href="#naming-conventions">Naming Conventions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We recommend the use of:</p>
<ul>
<li><code dir="auto">camelCase</code> for all identifiers, i.e., variable or function names:
<code dir="auto">ma</code>, <code dir="auto">maFast</code>, <code dir="auto">maLengthInput</code>, <code dir="auto">maColor</code>, <code dir="auto">roundedOHLC()</code>,
<code dir="auto">pivotHi()</code>.</li>
<li>All caps <code dir="auto">SNAKE_CASE</code> for constants: <code dir="auto">BULL_COLOR</code>, <code dir="auto">BEAR_COLOR</code>,
<code dir="auto">MAX_LOOKBACK</code>.</li>
<li>The use of qualifying suffixes when it provides valuable clues about
the type or provenance of a variable: <code dir="auto">maShowInput</code>, <code dir="auto">bearColor</code>,
<code dir="auto">bearColorInput</code>, <code dir="auto">volumesArray</code>, <code dir="auto">maPlotID</code>, <code dir="auto">resultsTable</code>,
<code dir="auto">levelsColorArray</code>.</li>
</ul>
<h2 class="md-heading" id="script-organization"><a href="#script-organization">Script organization<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The Pine Script™ compiler is quite forgiving of the positioning of
specific statements or the version
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation</a> in the script. While other arrangements are syntactically
correct, this is how we recommend organizing scripts:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;license&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;version&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;declaration_statement&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;import_statements&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;constant_declarations&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;inputs&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;function_declarations&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;calculations&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;strategy_calls&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;visuals&gt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&lt;alerts&gt;</span></div></div></code></pre></figure></link></div>
<h3 class="md-heading" id="license"><a href="#license">&lt;license&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If you publish your open-source scripts publicly on TradingView (scripts
can also be published privately), your open-source code is by default
protected by the Mozilla license. You may choose any other license you
prefer.</p>
<p>The reuse of code from those scripts is governed by our <a href="https://www.tradingview.com/support/solutions/43000590599">House Rules on
Script
Publishing</a>
which preempt the author’s license.</p>
<p>The standard license comments appearing at the beginning of scripts are:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © username</code></div>
<h3 class="md-heading" id="version"><a href="#version">&lt;version&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This is the
<a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation</a> defining the version of Pine Script™ the script will use. If
none is present, v1 is used. For v5, use:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5</code></div>
<h3 class="md-heading" id="declaration_statement"><a href="#declaration_statement">&lt;declaration_statement&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This is the mandatory declaration statement which defines the type of
your script. It must be a call to either
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>.</p>
<h3 class="md-heading" id="import_statements"><a href="#import_statements">&lt;import_statements&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If your script uses one or more Pine Script™
<a href="/pine-script-docs/v5/concepts/libraries/">libraries</a>, your
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_import">import</a>
statements belong here.</p>
<h3 class="md-heading" id="constant_declarations"><a href="#constant_declarations">&lt;constant_declarations&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can declare variables qualified as “const”, i.e., ones
referencing a constant value.</p>
<p>We refer to variables as “constants” when they meet these criteria:</p>
<ul>
<li>Their declaration uses the optional <code dir="auto">const</code> keyword (see our User
Manual’s section on
<a href="/pine-script-docs/v5/language/type-system/#qualifiers">type qualifiers</a> for more information).</li>
<li>They are initialized using a literal (e.g., <code dir="auto">100</code> or <code dir="auto">"AAPL"</code>) or a
built-in qualified as “const” (e.g., <code dir="auto">color.green</code>).</li>
<li>Their value does not change during the script’s execution.</li>
</ul>
<p>We use <code dir="auto">SNAKE_CASE</code> to name these variables and group their declaration
near the top of the script. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// ————— Constants
int     MS_IN_MIN   = 60 * 1000
int     MS_IN_HOUR  = MS_IN_MIN  * 60
int     MS_IN_DAY   = MS_IN_HOUR * 24

color   GRAY        = #808080ff
color   LIME        = #00FF00ff
color   MAROON      = #800000ff
color   ORANGE      = #FF8000ff
color   PINK        = #FF0080ff
color   TEAL        = #008080ff
color   BG_DIV      = color.new(ORANGE, 90)
color   BG_RESETS   = color.new(GRAY, 90)

string  RST1        = "No reset; cumulate since the beginning of the chart"
string  RST2        = "On a stepped higher timeframe (HTF)"
string  RST3        = "On a fixed HTF"
string  RST4        = "At a fixed time"
string  RST5        = "At the beginning of the regular session"
string  RST6        = "At the first visible chart bar"
string  RST7        = "Fixed rolling period"

string  LTF1        = "Least precise, covering many chart bars"
string  LTF2        = "Less precise, covering some chart bars"
string  LTF3        = "More precise, covering less chart bars"
string  LTF4        = "Most precise, 1min intrabars"

string  TT_TOTVOL     = "The 'Bodies' value is the transparency of the total volume candle bodies. Zero is opaque, 100 is transparent."
string  TT_RST_HTF    = "This value is used when '" + RST3 +"' is selected."
string  TT_RST_TIME   = "These values are used when '" + RST4 +"' is selected.
  A reset will occur when the time is greater or equal to the bar's open time, and less than its close time.\nHour: 0-23\nMinute: 0-59"
string  TT_RST_PERIOD = "This value is used when '" + RST7 +"' is selected."</code></div>
<p>In this example:</p>
<ul>
<li>The <code dir="auto">RST*</code> and <code dir="auto">LTF*</code> constants will be used as tuple elements in
the <code dir="auto">options</code> argument of <code dir="auto">input.*()</code> calls.</li>
<li>The <code dir="auto">TT_*</code> constants will be used as <code dir="auto">tooltip</code> arguments in
<code dir="auto">input.*()</code> calls. Note how we use a line continuation for long
string literals.</li>
<li>We do not use
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
to initialize constants. The Pine Script™ runtime is optimized to
handle declarations on each bar, but using
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
to initialize a variable only the first time it is declared incurs a
minor penalty on script performance because of the maintenance that
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
variables require on further bars.</li>
</ul>
<p>Note that:</p>
<ul>
<li>Literals used in more than one place in a script should always be
declared as a constant. Using the constant rather than the literal
makes it more readable if it is given a meaningful name, and the
practice makes code easier to maintain. Even though the quantity of
milliseconds in a day is unlikely to change in the future,
<code dir="auto">MS_IN_DAY</code> is more meaningful than <code dir="auto">1000 * 60 * 60 * 24</code>.</li>
<li>Constants only used in the local block of a function or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>,
etc., statement for example, can be declared in that local block.</li>
</ul>
<h3 class="md-heading" id="inputs"><a href="#inputs">&lt;inputs&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>It is <strong>much</strong> easier to read scripts when all their inputs are in the
same code section. Placing that section at the beginning of the script
also reflects how they are processed at runtime, i.e., before the rest
of the script is executed.</p>
<p>Suffixing input variable names with <code dir="auto">input</code> makes them more readily
identifiable when they are used later in the script: <code dir="auto">maLengthInput</code>,
<code dir="auto">bearColorInput</code>, <code dir="auto">showAvgInput</code>, etc.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// ————— Inputs
string  resetInput              = input.string(RST2,        "CVD Resets",                       inline = "00", options = [RST1, RST2, RST3, RST4, RST5, RST6, RST7])
string  fixedTfInput            = input.timeframe("D",      "  Fixed HTF:  ",                   tooltip = TT_RST_HTF)
int     hourInput               = input.int(9,              "  Fixed time hour:  ",             inline = "01", minval = 0, maxval = 23)
int     minuteInput             = input.int(30,             "minute",                           inline = "01", minval = 0, maxval = 59, tooltip = TT_RST_TIME)
int     fixedPeriodInput        = input.int(20,             "  Fixed period:  ",                inline = "02", minval = 1, tooltip = TT_RST_PERIOD)
string  ltfModeInput            = input.string(LTF3,        "Intrabar precision",               inline = "03", options = [LTF1, LTF2, LTF3, LTF4])</code></div>
<h3 class="md-heading" id="function_declarations"><a href="#function_declarations">&lt;function_declarations&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>All user-defined functions must be defined in the script’s global
scope; nested function definitions are not allowed in Pine Script™.</p>
<p>Optimal function design should minimize the use of global variables in
the function’s scope, as they undermine function portability. When it
can’t be avoided, those functions must follow the global variable
declarations in the code, which entails they can’t always be placed in
the &lt;function_declarations&gt; section. Such dependencies on global
variables should ideally be documented in the function’s comments.</p>
<p>It will also help readers if you document the function’s objective,
parameters and result. The same syntax used in
<a href="/pine-script-docs/v5/concepts/libraries/">libraries</a> can be used to
document your functions. This can make it easier to port your functions
to a library should you ever decide to do so:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("&lt;function_declarations&gt;", "", true)

string SIZE_LARGE  = "Large"
string SIZE_NORMAL = "Normal"
string SIZE_SMALL  = "Small"

string sizeInput = input.string(SIZE_NORMAL, "Size", options = [SIZE_LARGE, SIZE_NORMAL, SIZE_SMALL])

// @function        Used to produce an argument for the `size` parameter in built-in functions.
// @param userSize  (simple string) User-selected size.
// @returns         One of the `size.*` built-in constants.
// Dependencies     SIZE_LARGE, SIZE_NORMAL, SIZE_SMALL
getSize(simple string userSize) =&gt;
    result = 
      switch userSize
        SIZE_LARGE  =&gt; size.large
        SIZE_NORMAL =&gt; size.normal
        SIZE_SMALL  =&gt; size.small
        =&gt; size.auto

if ta.rising(close, 3)
    label.new(bar_index, na, yloc = yloc.abovebar, style = label.style_arrowup, size = getSize(sizeInput))</code></div>
<h3 class="md-heading" id="calculations"><a href="#calculations">&lt;calculations&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This is where the script’s core calculations and logic should be
placed. Code can be easier to read when variable declarations are placed
near the code segment using the variables. Some programmers prefer to
place all their non-constant variable declarations at the beginning of
this section, which is not always possible for all variables, as some
may require some calculations to have been executed before their
declaration.</p>
<h3 class="md-heading" id="strategy_calls"><a href="#strategy_calls">&lt;strategy_calls&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Strategies are easier to read when strategy calls are grouped in the
same section of the script.</p>
<h3 class="md-heading" id="visuals"><a href="#visuals">&lt;visuals&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This section should ideally include all the statements producing the
script’s visuals, whether they be plots, drawings, background colors,
candle-plotting, etc. See the Pine Script™ user manual’s section on
<a href="/pine-script-docs/v5/concepts/colors/#z-index">here</a> for more
information on how the relative depth of visuals is determined.</p>
<h3 class="md-heading" id="alerts"><a href="#alerts">&lt;alerts&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Alert code will usually require the script’s calculations to have
executed before it, so it makes sense to put it at the end of the
script.</p>
<h2 class="md-heading" id="spacing"><a href="#spacing">Spacing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>A space should be used on both sides of all operators, except unary
operators (<code dir="auto">-1</code>). A space is also recommended after all commas and when
using named function arguments, as in <code dir="auto">plot(series = close)</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">int a = close &gt; open ? 1 : -1
var int newLen = 2
newLen := min(20, newlen + 1)
float a = -b
float c = d &gt; e ? d - e : d
int index = bar_index % 2 == 0 ? 1 : 2
plot(close, color = color.red)</code></div>
<h2 class="md-heading" id="line-wrapping"><a href="#line-wrapping">Line wrapping<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Line wrapping can make long lines easier to read. Line wraps are defined
by using an indentation level that is not a multiple of four, as four
spaces or a tab are used to define local blocks. Here we use two spaces:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(
   series = close,
   title = "Close",
   color = color.blue,
   show_last = 10
 )</code></div>
<h2 class="md-heading" id="vertical-alignment"><a href="#vertical-alignment">Vertical alignment<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Vertical alignment using tabs or spaces can be useful in code sections
containing many similar lines such as constant declarations or inputs.
They can make mass edits much easier using the Pine Editor’s
multi-cursor feature (<code dir="auto">ctrl</code> +
<code dir="auto">alt</code> + <code dir="auto">🠅</code>):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// Colors used as defaults in inputs.
color COLOR_AQUA  = #0080FFff
color COLOR_BLACK = #000000ff
color COLOR_BLUE  = #013BCAff
color COLOR_CORAL = #FF8080ff
color COLOR_GOLD  = #CCCC00ff</code></div>
<h2 class="md-heading" id="explicit-typing"><a href="#explicit-typing">Explicit typing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Including the type of variables when declaring them is not required.
However, it helps make scripts easier to read, navigate, and understand.
It can help clarify the expected types at each point in a script’s
execution and distinguish a variable’s declaration (using <code dir="auto">=</code>) from its
reassignments (using <code dir="auto">:=</code>). Using explicit typing can also make scripts
easier to <a href="/pine-script-docs/v5/writing/debugging/">debug</a>.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/debugging"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Debugging <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/writing/style-guide">Writing scripts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Debugging</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="writing-scripts-debugging"><a href="#debugging">Debugging<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>TradingView’s close integration between the Pine Editor and the chart
interface facilitates efficient, interactive debugging of Pine Script™
code, as scripts can produce dynamic results in multiple locations, on
and off the chart. Programmers can utilize such results to refine their
script’s behaviors and ensure everything works as expected.</p>
<p>When a programmer understands the appropriate techniques for inspecting
the variety of behaviors one may encounter while writing a script, they
can quickly and thoroughly identify and resolve potential problems in
their code, which allows for a more seamless overall coding experience.
This page demonstrates some of the handiest ways to debug code when
working with Pine Script™.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Before venturing further on this page, we recommend familiarizing
yourself with Pine’s
<a href="/pine-script-docs/v5/language/execution-model/">Execution model</a> and
<a href="/pine-script-docs/v5/language/type-system/">Type system</a>, as it’s
crucial to understand these details when debugging in the Pine Script™
environment.</p></div></aside>
<h2 class="md-heading" id="the-lay-of-the-land"><a href="#the-lay-of-the-land">The lay of the land<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine scripts can output their results in multiple different ways, any of
which programmers can utilize for debugging.</p>
<p>The <code dir="auto">plot*()</code> functions can display results in a chart pane, the
script’s status line, the price (y-axis) scale, and the Data Window,
providing simple, convenient ways to debug numeric and conditional
values:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="590" loading="lazy" src="images/2ccdc96413c47ccec08bacee446fe4b6.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("The lay of the land - Plots")

// Plot the `bar_index` in all available locations.
plot(bar_index, "bar_index", color.teal, 3)</code></div>
<p>Note that:</p>
<ul>
<li>A script’s status line outputs will only show when enabling the
“Values” checkbox within the “Indicators” section of the
chart’s “Status line” settings.</li>
<li>Price scales will only show plot values or names when enabling
the options from the “Indicators and financials” dropdown in
the chart’s “Scales and lines” settings.</li>
</ul>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
function displays colors in the script pane’s background, and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>
function changes the colors of the main chart’s bars or candles. Both
of these functions provide a simple way to visualize conditions:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="556" loading="lazy" src="images/57661c55cafe1b08dd599abe30cfff30.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("The lay of the land - Background and bar colors")

//@variable Is `true` if the `close` is rising over 2 bars.
bool risingPrice = ta.rising(close, 2)

// Highlight the chart background and color the main chart bars based on `risingPrice`.
bgcolor(risingPrice ? color.new(color.green, 70) : na, title= "`risingPrice` highlight")
barcolor(risingPrice ? color.aqua : chart.bg_color, title = "`risingPrice` bar color")</code></div>
<p>Pine’s
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> (<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">line</a>, <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">box</a>, <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polyline</a>, <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">label</a>)
produce drawings in the script’s pane. While they don’t return results
in other locations, such as the status line or Data Window, they provide
alternative, flexible solutions for inspecting numeric values,
conditions, and strings directly on the chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="562" loading="lazy" src="images/e303c4c15c05599235b40615fef0a305.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("The lay of the land - Drawings", overlay = true)

//@variable Is `true` when the time changes on the "1D" timeframe.
bool newDailyBar = timeframe.change("1D")
//@variable The previous bar's `bar_index` from when `newDailyBar` last occurred.
int closedIndex = ta.valuewhen(newDailyBar, bar_index - 1, 0)
//@variable The previous bar's `close` from when `newDailyBar` last occurred.
float closedPrice = ta.valuewhen(newDailyBar, close[1], 0)

if newDailyBar
    //@variable Draws a line from the previous `closedIndex` and `closedPrice` to the current values.
    line debugLine = line.new(closedIndex[1], closedPrice[1], closedIndex, closedPrice, width = 2)
    //@variable Variable info to display in a label.
    string debugText = "'1D' bar closed at: \n(" + str.tostring(closedIndex) + ", " + str.tostring(closedPrice) + ")"
    //@variable Draws a label at the current `closedIndex` and `closedPrice`.
    label.new(closedIndex, closedPrice, debugText, color = color.purple, textcolor = color.white)</code></div>
<p>The <code dir="auto">log.*()</code> functions produce
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>
results. Every time a script calls any of these functions, the script
logs a message in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane,
along with a timestamp and navigation options to identify the specific
times, chart bars, and lines of code that triggered a log:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="666" loading="lazy" src="images/14db861c23f9bf098f83903c81cd9f4a.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("The lay of the land - Pine Logs")

//@variable The natural logarithm of the current `high - low` range.
float logRange = math.log(high - low)

// Plot the `logRange`.
plot(logRange, "logRange")

if barstate.isconfirmed
    // Generate an "error" or "info" message on the confirmed bar, depending on whether `logRange` is defined.
    switch 
        na(logRange) =&gt; log.error("Undefined `logRange` value.")
        =&gt;              log.info("`logRange` value: " + str.tostring(logRange))
else
    // Generate a "warning" message for unconfirmed values.
    log.warning("Unconfirmed `logRange` value: " + str.tostring(logRange))</code></div>
<p>One can apply any of the above, or a combination, to establish debugging
routines to fit their needs and preferences, depending on the data types
and structures they’re working with. See the sections below for
detailed explanations of various debugging techniques.</p>
<h2 class="md-heading" id="numeric-values"><a href="#numeric-values">Numeric values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When creating code in Pine Script™, working with numbers is inevitable.
Therefore, to ensure a script works as intended, it’s crucial to
understand how to inspect the numeric
(<a href="/pine-script-docs/v5/language/type-system/#int">int</a> and
<a href="/pine-script-docs/v5/language/type-system/#float">float</a>)
values it receives and calculates.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This section discusses fundamental <em>chart-based</em> approaches for
debugging numbers. Scripts can also convert numbers to
<a href="/pine-script-docs/v5/language/type-system/#string">strings</a>,
allowing one to inspect numbers using string-related techniques. For
more information, see the
<a href="/pine-script-docs/v5/writing/debugging/#strings">Strings</a> and
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>
sections.</p></div></aside>
<h3 class="md-heading" id="plotting-numbers"><a href="#plotting-numbers">Plotting numbers<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One of the most straightforward ways to inspect a script’s numeric
values is to use <code dir="auto">plot*()</code> functions, which can display results
graphically on the chart and show formatted numbers in the script’s
status line, the price scale, and the Data Window. The locations where a
<code dir="auto">plot*()</code> function displays its results depend on the <code dir="auto">display</code>
parameter. By default, its value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.all">display.all</a>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Only a script’s <em>global scope</em> can contain <code dir="auto">plot*()</code> calls, meaning
these functions can only accept global variables and literals. They
cannot use variables declared from the local scopes of
<a href="/pine-script-docs/v5/language/loops/">loops</a>,
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>, or
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>.</p></div></aside>
<p>The following example uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
function to display the 1-bar change in the value of the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
variable measured in chart timeframes (e.g., a plotted value of 1 on the
“1D” chart means there is a one-day difference between the opening
times of the current and previous bars). Inspecting this series can help
to identify time gaps in a chart’s data, which is helpful information
when designing time-based indicators.</p>
<p>Since we have not specified a <code dir="auto">display</code> argument, the function uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.all">display.all</a>,
meaning it will show data in <em>all</em> possible locations, as we see below:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="590" loading="lazy" src="images/692594411c39e500fea0d9c06fcbfeea.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting numbers demo", "Time changes")

//@variable The one-bar change in the chart symbol's `time` value, measured in units of the chart timeframe.
float timeChange = ta.change(time) / (1000.0 * timeframe.in_seconds())

// Display the `timeChange` in all possible locations.
plot(timeChange, "Time difference (in chart bar units)", color.purple, 3)</code></div>
<p>Note that:</p>
<ul>
<li>The numbers displayed in the script’s status line and the Data
Window reflect the plotted values at the location of the
chart’s cursor. These areas will show the latest bar’s value
when the mouse pointer isn’t on the chart.</li>
<li>The number in the price scale reflects the latest available
value on the visible chart.</li>
</ul>
<h4 class="md-heading" id="without-affecting-the-scale"><a href="#without-affecting-the-scale">Without affecting the scale<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When debugging multiple numeric values in a script, programmers may wish
to inspect them without interfering with the price scales or cluttering
the visual outputs in the chart’s pane, as distorted scales and
overlapping plots may make it harder to evaluate the results.</p>
<p>A simple way to inspect numbers without adding more visuals to the
chart’s pane is to change the <code dir="auto">display</code> values in the script’s
<code dir="auto">plot*()</code> calls to other <code dir="auto">display.*</code> variables or expressions using
them.</p>
<p>Let’s look at a practical example. Here, we’ve drafted the following
script that calculates a custom-weighted moving average by dividing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sum">sum</a>
of <code dir="auto">weight * close</code> values by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sum">sum</a>
of the <code dir="auto">weight</code> series:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/c1489a2edf158c16f7716da06b029d68.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting without affecting the scale demo", "Weighted Average", true)

//@variable The number of bars in the average.
int lengthInput = input.int(20, "Length", 1)

//@variable The weight applied to the price on each bar.
float weight = math.pow(close - open, 2)

//@variable The numerator of the average.
float numerator = math.sum(weight * close, lengthInput)
//@variable The denominator of the average.
float denominator = math.sum(weight, lengthInput)

//@variable The `lengthInput`-bar weighted average.
float average = numerator / denominator

// Plot the `average`.
plot(average, "Weighted Average", linewidth = 3)</code></div>
<p>Suppose we’d like to inspect the variables used in the <code dir="auto">average</code>
calculation to understand and fine-tune the result. If we were to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
to display the script’s <code dir="auto">weight</code>, <code dir="auto">numerator</code>, and <code dir="auto">denominator</code> in all
locations, we can no longer easily identify our <code dir="auto">average</code> line on the
chart since each variable has a radically different scale:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/6014c5d4aaf8310e0135dbf73b1b8d5e.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting without affecting the scale demo", "Weighted Average", true)

//@variable The number of bars in the average.
int lengthInput = input.int(20, "Length", 1)

//@variable The weight applied to the price on each bar.
float weight = math.pow(close - open, 2)

//@variable The numerator of the average.
float numerator = math.sum(close * weight, lengthInput)
//@variable The denominator of the average.
float denominator = math.sum(weight, lengthInput)

//@variable The `lengthInput`-bar weighted average.
float average = numerator / denominator

// Plot the `average`.
plot(average, "Weighted Average", linewidth = 3)

// Create debug plots for the `weight`, `numerator`, and `denominator`.
plot(weight, "weight", color.purple)
plot(numerator, "numerator", color.teal)
plot(denominator, "denominator", color.maroon)</code></div>
<p>While we could hide individual plots from the “Style” tab of the
script’s settings, doing so also prevents us from inspecting the
results in any other location. To simultaneously view the variables’
values and preserve the scale of our chart, we can change the <code dir="auto">display</code>
values in our debug plots.</p>
<p>The version below includes a <code dir="auto">debugLocations</code> variable in the debug
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
calls with a value of <code dir="auto">display.all - display.pane</code> to specify that all
locations <em>except</em> the chart pane will show the results. Now we can
inspect the calculation’s values without the extra clutter:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="558" loading="lazy" src="images/77f7d5f0a0b51755e222264cf69e5469.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting without affecting the scale demo", "Weighted Average", true)

//@variable The number of bars in the average.
int lengthInput = input.int(20, "Length", 1)

//@variable The weight applied to the price on each bar.
float weight = math.pow(close - open, 2)

//@variable The numerator of the average.
float numerator = math.sum(close * weight, lengthInput)
//@variable The denominator of the average.
float denominator = math.sum(weight, lengthInput)

//@variable The `lengthInput`-bar weighted average.
float average = numerator / denominator

// Plot the `average`.
plot(average, "Weighted Average", linewidth = 3)

//@variable The display locations of all debug plots.
debugLocations = display.all - display.pane
// Create debug plots for the `weight`, `numerator`, and `denominator`.
plot(weight, "weight", color.purple, display = debugLocations)
plot(numerator, "numerator", color.teal, display = debugLocations)
plot(denominator, "denominator", color.maroon, display = debugLocations)</code></div>
<h4 class="md-heading" id="from-local-scopes"><a href="#from-local-scopes">From local scopes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>A script’s <em>local scopes</em> are sections of indented code within
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>,
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a>,
and <a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>. When working with variables declared within these scopes,
using the <code dir="auto">plot*()</code> functions to display their values directly <em>will
not</em> work, as plots only work with literals and <em>global</em> variables.</p>
<p>To display a local variable’s values using plots, one can assign its
results to a global variable and pass that variable to the <code dir="auto">plot*()</code>
call.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The approach described below works for local variables declared within
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a>.
Employing a similar process for
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
requires
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>,
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>, or other built-in reference types. See the
<a href="/pine-script-docs/v5/writing/debugging/#debugging-functions">Debugging functions</a> section for more information.</p></div></aside>
<p>For example, this script calculates the all-time maximum and minimum
change in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price over a <code dir="auto">lengthInput</code> period. It uses an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure to declare a local <code dir="auto">change</code> variable and update the global
<code dir="auto">maxChange</code> and <code dir="auto">minChange</code> once every <code dir="auto">lengthInput</code> bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="554" loading="lazy" src="images/d137bddbe9948fe09ebf1c18fcc7c564.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting numbers from local scopes demo", "Periodic changes")

//@variable The number of chart bars in each period.
int lengthInput = input.int(20, "Period length", 1)

//@variable The maximum `close` change over each `lengthInput` period on the chart.
var float maxChange = na
//@variable The minimum `close` change over each `lengthInput` period on the chart.
var float minChange = na

//@variable Is `true` once every `lengthInput` bars.
bool periodClose = bar_index % lengthInput == 0

if periodClose
    //@variable The change in `close` prices over `lengthInput` bars.
    float change = close - close[lengthInput]
    // Update the global `maxChange` and `minChange`.
    maxChange := math.max(nz(maxChange, change), change)
    minChange := math.min(nz(minChange, change), change)

// Plot the `maxChange` and `minChange`.
plot(maxChange, "Max periodic change", color.teal, 3)
plot(minChange, "Min periodic change", color.maroon, 3)
hline(0.0, color = color.gray, linestyle = hline.style_solid)</code></div>
<p>Suppose we want to inspect the history of the <code dir="auto">change</code> variable using a
plot. While we cannot plot the variable directly since the script
declares it in a local scope, we can assign its value to another
<em>global</em> variable for use in a <code dir="auto">plot*()</code> function.</p>
<p>Below, we’ve added a <code dir="auto">debugChange</code> variable with an initial value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> to
the global scope, and the script reassigns its value within the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure using the local <code dir="auto">change</code> variable. Now, we can use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
with the <code dir="auto">debugChange</code> variable to view the history of available
<code dir="auto">change</code> values:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="554" loading="lazy" src="images/6b03d9a199e00507990ee70123c21f09.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plotting numbers from local scopes demo", "Periodic changes")

//@variable The number of chart bars in each period.
int lengthInput = input.int(20, "Period length", 1)

//@variable The maximum `close` change over each `lengthInput` period on the chart.
var float maxChange = na
//@variable The minimum `close` change over each `lengthInput` period on the chart.
var float minChange = na

//@variable Is `true` once every `lengthInput` bars.
bool periodClose = bar_index % lengthInput == 0

//@variable Tracks the history of the local `change` variable.
float debugChange = na

if periodClose
    //@variable The change in `close` prices over `lengthInput` bars.
    float change = close - close[lengthInput]
    // Update the global `maxChange` and `minChange`.
    maxChange := math.max(nz(maxChange, change), change)
    minChange := math.min(nz(minChange, change), change)
    // Assign the `change` value to the `debugChange` variable.
    debugChange := change

// Plot the `maxChange` and `minChange`.
plot(maxChange, "Max periodic change", color.teal, 3)
plot(minChange, "Min periodic change", color.maroon, 3)
hline(0.0, color = color.gray, linestyle = hline.style_solid)

// Create a debug plot to visualize the `change` history.
plot(debugChange, "Extracted change", color.purple, 15, plot.style_areabr)</code></div>
<p>Note that:</p>
<ul>
<li>The script uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_plot.style_areabr">plot.style_areabr</a>
in the debug plot, which doesn’t bridge over
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values as the default style does.</li>
<li>When the rightmost visible bar’s plotted value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
the number in the price scale represents the latest <em>non-na</em>
value before that bar, if one exists.</li>
</ul>
<h3 class="md-heading" id="with-drawings"><a href="#with-drawings">With drawings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>An alternative approach to graphically inspecting the history of a
script’s numeric values is to use Pine’s
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a>, including
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>.</p>
<p>While Pine drawings don’t display results anywhere other than the chart
pane, scripts can create them from within <em>local scopes</em>, including the
scopes of <a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
(see the
<a href="/pine-script-docs/v5/writing/debugging/#debugging-functions">Debugging functions</a> section to learn more). Additionally, scripts can position
drawings at <em>any</em> available chart location, irrespective of the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.</p>
<p>For example, let’s revisit the “Periodic changes” script from the
<a href="/pine-script-docs/v5/writing/debugging/#from-local-scopes">previous section</a>. Suppose we’d like to inspect the history of the local
<code dir="auto">change</code> variable <em>without</em> using a plot. In this case, we can avoid
declaring a separate global variable and instead create drawing objects
directly from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s local scope.</p>
<p>The script below is a modification of the previous script that uses
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> to
visualize the <code dir="auto">change</code> variable’s behavior. Inside the scope of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure, it calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
to create a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
that spans from the bar <code dir="auto">lengthInput</code> bars ago to the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="554" loading="lazy" src="images/8f9f152271eef6104bbbd51478356929.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Drawing numbers from local scopes demo", "Periodic changes", max_boxes_count = 500)

//@variable The number of chart bars in each period.
int lengthInput = input.int(20, "Period length", 1)

//@variable The maximum `close` change over each `lengthInput` period on the chart.
var float maxChange = na
//@variable The minimum `close` change over each `lengthInput` period on the chart.
var float minChange = na

//@variable Is `true` once every `lengthInput` bars.
bool periodClose = bar_index % lengthInput == 0

if periodClose
    //@variable The change in `close` prices over `lengthInput` bars.
    float change = close - close[lengthInput]
    // Update the global `maxChange` and `minChange`.
    maxChange := math.max(nz(maxChange, change), change)
    minChange := math.min(nz(minChange, change), change)
    //@variable Draws a box on the chart to visualize the `change` value.
    box debugBox = box.new(
         bar_index - lengthInput, math.max(change, 0.0), bar_index, math.min(change, 0.0),
         color.purple, bgcolor = color.new(color.purple, 80), text = str.tostring(change)
     )

// Plot the `maxChange` and `minChange`.
plot(maxChange, "Max periodic change", color.teal, 3)
plot(minChange, "Min periodic change", color.maroon, 3)
hline(0.0, color = color.gray, linestyle = hline.style_solid)</code></div>
<p>Note that:</p>
<ul>
<li>The script includes <code dir="auto">max_boxes_count = 500</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function, which allows it to show up to 500
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>
on the chart.</li>
<li>We used <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max">math.max(change,
0.0)</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.min">math.min(change,
0.0)</a>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
function as the <code dir="auto">top</code> and <code dir="auto">bottom</code> values.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
call includes
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring(change)</a>
as its <code dir="auto">text</code> argument to display a <em>“string” representation</em>
of the <code dir="auto">change</code> variable’s “float” value in each
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
drawing. See
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">this</a> portion of the
<a href="/pine-script-docs/v5/writing/debugging/#strings">Strings</a>
section below to learn more about representing data with
strings.</li>
</ul>
<p>For more information about using
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> and
other related
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a>, see our User Manual’s
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/">Lines and boxes</a>
page.</p>
<h2 class="md-heading" id="conditions"><a href="#conditions">Conditions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Many scripts one will create in Pine involve declaring and evaluating
<em>conditions</em> to dictate specific script actions, such as triggering
different calculation patterns, visuals, signals, alerts, strategy
orders, etc. As such, it’s imperative to understand how to inspect the
conditions a script uses to ensure proper execution.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This section discusses debugging techniques based on chart visuals. To
learn about <em>logging</em> conditions, see the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>
section below.</p></div></aside>
<h3 class="md-heading" id="as-numbers"><a href="#as-numbers">As numbers<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>One possible way to debug a script’s conditions is to define <em>numeric
values</em> based on them, which allows programmers to inspect them using
numeric approaches, such as those outlined in the
<a href="/pine-script-docs/v5/writing/debugging/#numeric-values">previous section</a>.</p>
<p>Let’s look at a simple example. This script calculates the ratio
between the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>
price and the <code dir="auto">lengthInput</code>-bar <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">moving
average</a>.
It assigns a condition to the <code dir="auto">priceAbove</code> variable that returns <code dir="auto">true</code>
whenever the value of the ratio exceeds 1 (i.e., the price is above the
average).</p>
<p>To inspect the occurrences of the condition, we created a <code dir="auto">debugValue</code>
variable assigned to the result of an expression that uses the ternary
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:">?:</a>
operator to return 1 when <code dir="auto">priceAbove</code> is <code dir="auto">true</code> and 0 otherwise. The
script plots the variable’s value in all available locations:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="498" loading="lazy" src="images/28a3e267905ae745d8b02ffefc2f67cb.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditions as numbers demo", "MA signal")

//@variable The number of bars in the moving average calculation.
int lengthInput = input.int(20, "Length", 1)

//@variable The ratio of the `ohlc4` price to its `lengthInput`-bar moving average.
float ratio = ohlc4 / ta.sma(ohlc4, lengthInput)

//@variable The condition to inspect. Is `true` when `ohlc4` is above its moving average, `false` otherwise.
bool priceAbove = ratio &gt; 1.0
//@variable Returns 1 when the `priceAbove` condition is `true`, 0 otherwise.
int debugValue = priceAbove ? 1 : 0

// Plot the `debugValue.
plot(debugValue, "Conditional number", color.teal, 3)</code></div>
<p>Note that:</p>
<ul>
<li>Representing “bool” values using numbers also allows scripts
to display conditional shapes or characters at specific y-axis
locations with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
and it facilitates conditional debugging with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>.
See the
<a href="/pine-script-docs/v5/writing/debugging/#plotting-conditional-shapes">next section</a> to learn more.</li>
</ul>
<h3 class="md-heading" id="plotting-conditional-shapes"><a href="#plotting-conditional-shapes">Plotting conditional shapes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
functions provide utility for debugging conditions, as they can plot
shapes or characters at absolute or relative chart locations whenever
they contain a <code dir="auto">true</code> or non-na <code dir="auto">series</code> argument.</p>
<p>These functions can also display <em>numeric</em> representations of the
<code dir="auto">series</code> in the script’s status line and the Data Window, meaning
they’re also helpful for debugging
<a href="/pine-script-docs/v5/writing/debugging/#numeric-values">numbers</a>.
We show a simple, practical way to debug numbers with these functions in
the <a href="/pine-script-docs/v5/writing/debugging/#tips">Tips</a> section.</p>
<p>The chart locations of the plots depend on the <code dir="auto">location</code> parameter,
which is
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.abovebar">location.abovebar</a>
by default.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>When using
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.abovebar">location.abovebar</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.belowbar">location.belowbar</a>,
the function positions the shapes/characters relative to the <em>main
chart</em> prices. If the script plots its values in a separate chart pane,
we recommend debugging with other <code dir="auto">location</code> options to avoid affecting
the pane’s scale.</p></div></aside>
<p>Let’s inspect a condition using these functions. The following script
calculates an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi">RSI</a>
with a <code dir="auto">lengthInput</code> length and a <code dir="auto">crossBelow</code> variable whose value is
the result of a condition that returns <code dir="auto">true</code> when the RSI crosses below
30. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
to display a circle near the top of the pane each time the condition
occurs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/4e563201ea61f5866ff54e23cb854681.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional shapes demo", "RSI cross under 30")

//@variable The length of the RSI.
int lengthInput = input.int(14, "Length", 1)

//@variable The calculated RSI value.
float rsi = ta.rsi(close, lengthInput)

//@variable Is `true` when the `rsi` crosses below 30, `false` otherwise.
bool crossBelow = ta.crossunder(rsi, 30.0)

// Plot the `rsi`.
plot(rsi, "RSI", color.rgb(136, 76, 146), linewidth = 3)
// Plot the `crossBelow` condition as circles near the top of the pane.
plotshape(crossBelow, "RSI crossed below 30", shape.circle, location.top, color.red, size = size.small)</code></div>
<p>Note that:</p>
<ul>
<li>The status line and Data Window show a value of 1 when
<code dir="auto">crossBelow</code> is <code dir="auto">true</code> and 0 when it’s <code dir="auto">false</code>.</li>
</ul>
<p>Suppose we’d like to display the shapes at <em>precise</em> locations rather
than relative to the chart pane. We can achieve this by using
<a href="/pine-script-docs/v5/writing/debugging/#as-numbers">conditional numbers</a> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute">location.absolute</a>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
call.</p>
<p>In this example, we’ve modified the previous script by creating a
<code dir="auto">debugNumber</code> variable that returns the <code dir="auto">rsi</code> value when <code dir="auto">crossBelow</code> is
<code dir="auto">true</code> and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
otherwise. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
function uses this new variable as its <code dir="auto">series</code> argument and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute">location.absolute</a>
as its <code dir="auto">location</code> argument:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/882f8aa9207fadba15500f65fd56d11b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional shapes demo", "RSI cross under 30")

//@variable The length of the RSI.
int lengthInput = input.int(14, "Length", 1)

//@variable The calculated RSI value.
float rsi = ta.rsi(close, lengthInput)

//@variable Is `true` when the `rsi` crosses below 30, `false` otherwise.
bool crossBelow = ta.crossunder(rsi, 30.0)
//@variable Returns the `rsi` when `crossBelow` is `true`, `na` otherwise.
float debugNumber = crossBelow ? rsi : na

// Plot the `rsi`.
plot(rsi, "RSI", color.rgb(136, 76, 146), linewidth = 3)
// Plot circles at the `debugNumber`.
plotshape(debugNumber, "RSI when it crossed below 30", shape.circle, location.absolute, color.red, size = size.small)</code></div>
<p>Note that:</p>
<ul>
<li>Since we passed a <em>numeric</em> series to the function, our
conditional plot now shows the values of the <code dir="auto">debugNumber</code> in
the status line and Data Window instead of 1 or 0.</li>
</ul>
<p>Another handy way to debug conditions is to use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>.
This function plots an arrow with a location relative to the <em>main chart
prices</em> whenever the <code dir="auto">series</code> argument is nonzero and not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>. The
length of each arrow varies with the <code dir="auto">series</code> value supplied. As with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
can also display numeric results in the status line and the Data Window.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Since this function always positions arrows relative to the main chart
prices, we recommend only using it if the script occupies the main chart
pane to avoid otherwise interfering with the scale.</p></div></aside>
<p>This example shows an alternative way to inspect our <code dir="auto">crossBelow</code>
condition using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>.
In this version, we’ve set <code dir="auto">overlay</code> to <code dir="auto">true</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function and added a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>
call to visualize the conditional values. The <code dir="auto">debugNumber</code> in this
example measures how far the <code dir="auto">rsi</code> dropped below 30 each time the
condition occurs:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/47b0060b85bb23f4e28f94c8ffbce9df.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional shapes demo", "RSI cross under 30", true)

//@variable The length of the RSI.
int lengthInput = input.int(14, "Length", 1)

//@variable The calculated RSI value.
float rsi = ta.rsi(close, lengthInput)

//@variable Is `true` when the `rsi` crosses below 30, `false` otherwise.
bool crossBelow = ta.crossunder(rsi, 30.0)
//@variable Returns `rsi - 30.0` when `crossBelow` is `true`, `na` otherwise.
float debugNumber = crossBelow ? rsi - 30.0 : na

// Plot the `rsi`.
plot(rsi, "RSI", color.rgb(136, 76, 146), display = display.data_window)
// Plot circles at the `debugNumber`.
plotarrow(debugNumber, "RSI cross below 30 distnce")</code></div>
<p>Note that:</p>
<ul>
<li>We set the <code dir="auto">display</code> value in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
of the <code dir="auto">rsi</code> to
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_display.data_window">display.data_window</a>
to
<a href="/pine-script-docs/v5/writing/debugging/#without-affecting-the-scale">preserve the chart’s scale</a>.</li>
</ul>
<p>To learn more about
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a>,
see this manual’s
<a href="/pine-script-docs/v5/concepts/text-and-shapes/">Text and shapes</a>
page.</p>
<h3 class="md-heading" id="conditional-colors"><a href="#conditional-colors">Conditional colors<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>An elegant way to visually represent conditions in Pine is to create
expressions that return
<a href="/pine-script-docs/v5/language/type-system/#color">color</a>
values based on <code dir="auto">true</code> or <code dir="auto">false</code> states, as scripts can use them to
control the appearance of
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing objects</a> or the results of <code dir="auto">plot*()</code>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>
calls.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>As with <code dir="auto">plot*()</code> functions, scripts can only call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>
from the <em>global scope</em>, and the functions cannot accept any local
variables.</p></div></aside>
<p>For example, this script calculates the change in
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices over <code dir="auto">lengthInput</code> bars and declares two “bool” variables to
identify when the price change is positive or negative.</p>
<p>The script uses these “bool” values as conditions in
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:">ternary</a>
expressions to assign the values of three “color” variables, then uses
those variables as the <code dir="auto">color</code> arguments in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>
to debug the results:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/8758499ff310bc074f3f55275ad4bfc7.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional colors demo", "Price change colors")

//@variable The number of bars in the price change calculation.
int lengthInput = input.int(10, "Length", 1)

//@variable The change in `close` prices over `lengthInput` bars.
float priceChange = ta.change(close, lengthInput)

//@variable Is `true` when the `priceChange` is a positive value, `false` otherwise.
bool isPositive = priceChange &gt; 0
//@variable Is `true` when the `priceChange` is a negative value, `false` otherwise.
bool isNegative = priceChange &lt; 0

//@variable Returns a color for the `priceChange` plot to show when `isPositive`, `isNegative`, or neither occurs.
color plotColor = isPositive ? color.teal : isNegative ? color.maroon : chart.fg_color
//@variable Returns an 80% transparent color for the background when `isPositive` or `isNegative`, `na` otherwise.
color bgColor = isPositive ? color.new(color.aqua, 80) : isNegative ? color.new(color.fuchsia, 80) : na
//@variable Returns a color to emphasize chart bars when `isPositive` occurs. Otherwise, returns the `chart.bg_color`.
color barColor = isPositive ? color.orange : chart.bg_color

// Plot the `priceChange` and color it with the `plotColor`.
plot(priceChange, "Price change", plotColor, style = plot.style_area)
// Highlight the pane's background with the `bgColor`.
bgcolor(bgColor, title = "Background highlight")
// Emphasize the chart bars with positive price change using the `barColor`.
barcolor(barColor, title = "Positive change bars")</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>
function always colors the main chart’s bars, regardless of
whether the script occupies another chart pane, and the chart
will only display the results if the bars are visible.</li>
</ul>
<p>See the <a href="/pine-script-docs/v5/concepts/colors/">Colors</a>,
<a href="/pine-script-docs/v5/concepts/fills/">Fills</a>,
<a href="/pine-script-docs/v5/concepts/backgrounds/">Backgrounds</a>, and
<a href="/pine-script-docs/v5/concepts/bar-coloring/">Bar coloring</a> pages for
more information about working with colors, filling plots, highlighting
backgrounds, and coloring bars.</p>
<h3 class="md-heading" id="using-drawings"><a href="#using-drawings">Using drawings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™‘s
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> provide flexible ways to visualize conditions on the chart,
especially when the conditions are within local scopes.</p>
<p>Consider the following script, which calculates a custom <code dir="auto">filter</code> with a
smoothing parameter (<code dir="auto">alpha</code>) that changes its value within an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure based on recent
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>
conditions:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/7680c2fcc36e7d578dda3aeea3cfcb14.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional drawings demo", "Volume-based filter", true)

//@variable The number of bars in the volume average.
int lengthInput = input.int(20, "Volume average length", 1)

//@variable The average `volume` over `lengthInput` bars.
float avgVolume = ta.sma(volume, lengthInput)

//@variable A custom price filter based on volume activity.
float filter = close
//@variable The smoothing parameter of the filter calculation. Its value depends on multiple volume conditions.
float alpha = na

// Set the `alpha` to 1 if `volume` exceeds its `lengthInput`-bar moving average.
if volume &gt; avgVolume
    alpha := 1.0
// Set the `alpha` to 0.5 if `volume` exceeds its previous value.
else if volume &gt; volume[1]
    alpha := 0.5
// Set the `alpha` to 0.01 otherwise.
else
    alpha := 0.01

// Calculate the new `filter` value.
filter := (1.0 - alpha) * nz(filter[1], filter) + alpha * close

// Plot the `filter`.
plot(filter, "Filter", linewidth = 3)</code></div>
<p>Suppose we’d like to inspect the conditions that control the <code dir="auto">alpha</code>
value. There are several ways we could approach the task with chart
visuals. However, some approaches will involve more code and careful
handling.</p>
<p>For example, to visualize the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure’s conditions using
<a href="/pine-script-docs/v5/writing/debugging/#plotting-conditional-shapes">plotted shapes</a> or
<a href="/pine-script-docs/v5/writing/debugging/#conditional-colors">background colors</a>, we’d have to create additional variables or expressions in
the global scope for the <code dir="auto">plot*()</code> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
functions to access.</p>
<p>Alternatively, we can use
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> to visualize the conditions concisely without those extra
steps.</p>
<p>The following is a modification of the previous script that calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
within specific branches of the
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structure</a> to draw
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on the
chart whenever those branches execute. These simple changes allow us to
identify those conditions on the chart without much extra code:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/2c31ccae072dc4b3c6a0a4693d4c0e75.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Conditional drawings demo", "Volume-based filter", true, max_labels_count = 500)

//@variable The number of bars in the volume average.
int lengthInput = input.int(20, "Volume average length", 1)

//@variable The average `volume` over `lengthInput` bars.
float avgVolume = ta.sma(volume, lengthInput)

//@variable A custom price filter based on volume activity.
float filter = close
//@variable The smoothing parameter of the filter calculation. Its value depends on multiple volume conditions.
float alpha = na

// Set the `alpha` to 1 if `volume` exceeds its `lengthInput`-bar moving average.
if volume &gt; avgVolume
    // Add debug label.
    label.new(chart.point.now(high), "alpha = 1", color = color.teal, textcolor = color.white)
    alpha := 1.0
// Set the `alpha` to 0.5 if `volume` exceeds its previous value.
else if volume &gt; volume[1]
    // Add debug label.
    label.new(chart.point.now(high), "alpha = 0.5", color = color.green, textcolor = color.white)
    alpha := 0.5
// Set the `alpha` to 0.01 otherwise.
else
    alpha := 0.01

// Calculate the new `filter` value.
filter := (1.0 - alpha) * nz(filter[1], filter) + alpha * close

// Plot the `filter`.
plot(filter, "Filter", linewidth = 3)</code></div>
<p>Note that:</p>
<ul>
<li>We added the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
calls <em>above</em> the <code dir="auto">alpha</code> reassignment expressions, as the
returned types of each branch in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure must match.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function includes <code dir="auto">max_labels_count = 500</code> to specify that the
script can show up to 500
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on the chart.</li>
</ul>
<h3 class="md-heading" id="compound-and-nested-conditions"><a href="#compound-and-nested-conditions">Compound and nested conditions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a programmer needs to identify situations where more than one
condition can occur, they may construct <em>compound conditions</em> by
aggregating individual conditions with logical operators
(<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_and">and</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_or">or</a>).</p>
<p>For example, this line of code shows a <code dir="auto">compoundCondition</code> variable that
only returns <code dir="auto">true</code> if <code dir="auto">condition1</code> and either <code dir="auto">condition2</code> or
<code dir="auto">condition3</code> occurs:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">bool compoundCondition = condition1 and (condition2 or condition3)</code></div>
<p>One may alternatively create <em>nested conditions</em> using
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:">ternary
expressions</a>.
For example, this
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure assigns <code dir="auto">true</code> to the <code dir="auto">nestedCondition</code> variable if
<code dir="auto">condition1</code> and <code dir="auto">condition2</code> or <code dir="auto">condition3</code> occurs. However, unlike
the logical expression above, the branches of this structure also allow
the script to execute additional code before assigning the “bool”
value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">bool nestedCondition = false

if condition1
    // [additional_code]
    if condition2
        // [additional_code]
        nestedCondition := true
    else if condition3
        // [additional_code]
        nestedCondition := true</code></div>
<p>In either case, whether working with compound or nested conditions in
code, one will save many headaches and ensure they work as expected by
validating the behaviors of the <em>individual conditions</em> that compose
them.</p>
<p>For example, this script calculates an <code dir="auto">rsi</code> and the <code dir="auto">median</code> of the
<code dir="auto">rsi</code> over <code dir="auto">lengthInput</code> bars. Then, it creates five variables to
represent different singular conditions. The script uses these variables
in a logical expression to assign a “bool” value to the
<code dir="auto">compoundCondition</code> variable, and it displays the results of the
<code dir="auto">compoundCondition</code> using a
<a href="/pine-script-docs/v5/writing/debugging/#conditional-colors">conditional background color</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/fd8efc99dfae5f57da59797e7358e1ac.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Compound conditions demo")

//@variable The length of the RSI and median RSI calculations.
int lengthInput = input.int(14, "Length", 2)

//@variable The `lengthInput`-bar RSI.
float rsi = ta.rsi(close, lengthInput)
//@variable The `lengthInput`-bar median of the `rsi`.
float median = ta.median(rsi, lengthInput)

//@variable Condition #1: Is `true` when the 1-bar `rsi` change switches from 1 to -1.
bool changeNegative = ta.change(math.sign(ta.change(rsi))) == -2
//@variable Condition #2: Is `true` when the previous bar's `rsi` is greater than 70.
bool prevAbove70 = rsi[1] &gt; 70.0
//@variable Condition #3: Is `true` when the current `close` is lower than the previous bar's `open`.
bool closeBelow = close &lt; open[1]
//@variable Condition #4: Is `true` when the `rsi` is between 60 and 70.
bool betweenLevels = bool(math.max(70.0 - rsi, 0.0) * math.max(rsi - 60.0, 0.0))
//@variable Condition #5: Is `true` when the `rsi` is above the `median`.
bool aboveMedian = rsi &gt; median

//@variable Is `true` when the first condition occurs alongside conditions 2 and 3 or 4 and 5.
bool compundCondition = changeNegative and ((prevAbove70 and closeBelow) or (betweenLevels and aboveMedian))

//Plot the `rsi` and the `median`.
plot(rsi, "RSI", color.rgb(201, 109, 34), 3)
plot(median, "RSI Median", color.rgb(180, 160, 102), 2)

// Highlight the background red when the `compundCondition` occurs.
bgcolor(compundCondition ? color.new(color.red, 60) : na, title = "compundCondition")</code></div>
<p>As we see above, it’s not necessarily easy to understand the behavior
of the <code dir="auto">compoundCondition</code> by only visualizing its end result, as five
underlying singular conditions determine the final value. To effectively
debug the <code dir="auto">compoundCondition</code> in this case, we must also inspect the
conditions that compose it.</p>
<p>In the example below, we’ve added five
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
calls to display
<a href="/pine-script-docs/v5/writing/debugging/#plotting-conditional-shapes">characters</a> on the chart and numeric values in the status line and Data
Window when each singular condition occurs. Inspecting each of these
results provides us with more complete information about the
<code dir="auto">compoundCondition</code>’s behavior:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="590" loading="lazy" src="images/2b3c1e1c3999f3b871fc713061c43ec3.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Compound conditions demo")

//@variable The length of the RSI and median RSI calculations.
int lengthInput = input.int(14, "Length", 2)

//@variable The `lengthInput`-bar RSI.
float rsi = ta.rsi(close, lengthInput)
//@variable The `lengthInput`-bar median of the `rsi`.
float median = ta.median(rsi, lengthInput)

//@variable Condition #1: Is `true` when the 1-bar `rsi` change switches from 1 to -1.
bool changeNegative = ta.change(math.sign(ta.change(rsi))) == -2
//@variable Condition #2: Is `true` when the previous bar's `rsi` is greater than 70.
bool prevAbove70 = rsi[1] &gt; 70.0
//@variable Condition #3: Is `true` when the current `close` is lower than the previous bar's `open`.
bool closeBelow = close &lt; open[1]
//@variable Condition #4: Is `true` when the `rsi` is between 60 and 70.
bool betweenLevels = bool(math.max(70.0 - rsi, 0.0) * math.max(rsi - 60.0, 0.0))
//@variable Condition #5: Is `true` when the `rsi` is above the `median`.
bool aboveMedian = rsi &gt; median

//@variable Is `true` when the first condition occurs alongside conditions 2 and 3 or 4 and 5.
bool compundCondition = changeNegative and ((prevAbove70 and closeBelow) or (betweenLevels and aboveMedian))

//Plot the `rsi` and the `median`.
plot(rsi, "RSI", color.rgb(201, 109, 34), 3)
plot(median, "RSI Median", color.rgb(180, 160, 102), 2)

// Highlight the background red when the `compundCondition` occurs.
bgcolor(compundCondition ? color.new(color.red, 60) : na, title = "compundCondition")

// Plot characters on the chart when conditions 1-5 occur.
plotchar(changeNegative ? rsi : na, "changeNegative (1)", "1", location.absolute, chart.fg_color)
plotchar(prevAbove70 ? 70.0 : na, "prevAbove70 (2)", "2", location.absolute, chart.fg_color)
plotchar(closeBelow ? close : na, "closeBelow (3)", "3", location.bottom, chart.fg_color)
plotchar(betweenLevels ? 60 : na, "betweenLevels (4)", "4", location.absolute, chart.fg_color)
plotchar(aboveMedian ? median : na, "aboveMedian (5)", "5", location.absolute, chart.fg_color)</code></div>
<p>Note that:</p>
<ul>
<li>Each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
call uses a
<a href="/pine-script-docs/v5/writing/debugging/#as-numbers">conditional number</a> as the <code dir="auto">series</code> argument. The functions display the
numeric values in the status line and Data Window.</li>
<li>All the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
calls, excluding the one for the <code dir="auto">closeBelow</code> condition, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.absolute">location.absolute</a>
as the <code dir="auto">location</code> argument to display characters at precise
locations whenever their <code dir="auto">series</code> is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
(i.e., the condition occurs). The call for <code dir="auto">closeBelow</code> uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_location.bottom">location.bottom</a>
to display its characters near the bottom of the pane.</li>
<li>In this section’s examples, we assigned individual conditions
to separate variables with straightforward names and
annotations. While this format isn’t required to create a
compound condition since one can combine conditions directly
within a logical expression, it makes for more readable code
that’s easier to debug, as explained in the
<a href="/pine-script-docs/v5/writing/debugging/#tips">Tips</a>
section.</li>
</ul>
<h2 class="md-heading" id="strings"><a href="#strings">Strings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="/pine-script-docs/v5/language/type-system/#string">Strings</a>
are sequences of alphanumeric, control, and other characters (e.g.,
Unicode). They provide utility when debugging scripts, as programmers
can use them to represent a script’s data types as human-readable text
and inspect them with
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> that have text-related properties, or by using
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This section discusses “string” conversions and inspecting strings via
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> and
<a href="/pine-script-docs/v5/concepts/tables/">tables</a>.
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">Boxes</a> can also
display text. However, their utility for debugging strings is more
limited than the techniques covered in this section and the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>
section below.</p></div></aside>
<h3 class="md-heading" id="representing-other-types"><a href="#representing-other-types">Representing other types<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Users can create “string” representations of virtually any data type,
facilitating effective debugging when other approaches may not suffice.
Before exploring “string” inspection techniques, let’s briefly review
ways to <em>represent</em> a script’s data using strings.</p>
<p>Pine Script™ includes predefined logic to construct “string”
representations of several other built-in types, such as
<a href="/pine-script-docs/v5/language/type-system/#int">int</a>,
<a href="/pine-script-docs/v5/language/type-system/#float">float</a>,
<a href="/pine-script-docs/v5/language/type-system/#bool">bool</a>,
<a href="/pine-script-docs/v5/language/arrays/">array</a>, and
<a href="/pine-script-docs/v5/language/matrices/">matrix</a>. Scripts can
conveniently represent such types as strings via the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
functions.</p>
<p>For example, this snippet creates strings to represent multiple values
using these functions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable Returns: "1.25"
string floatRepr = str.tostring(1.25)
//@variable Returns: "1"
string rounded0 = str.tostring(1.25, "#")
//@variable Returns: "1.3"
string rounded1 = str.tostring(1.25, "#.#")
//@variable Returns: "1.2500"
string trailingZeros = str.tostring(1.25, "#.0000")
//@variable Returns: "true"
string trueRepr = str.tostring(true)
//@variable Returns: "false"
string falseRepr = str.tostring(5 == 3)
//@variable Returns: "[1, 2, -3.14]"
string floatArrayRepr = str.tostring(array.from(1, 2.0, -3.14))
//@variable Returns: "[2, 20, 0]"
string roundedArrayRepr = str.tostring(array.from(2.22, 19.6, -0.43), "#")
//@variable Returns: "[Hello, World, !]"
string stringArrayRepr = str.tostring(array.from("Hello", "World", "!"))
//@variable Returns: "Test: 2.718 ^ 2 &gt; 5: true"
string mixedTypeRepr = str.format("{0}{1, number, #.###} ^ 2 &gt; {2}: {3}", "Test: ", math.e, 5, math.e * math.e &gt; 5)

//@variable Combines all the above strings into a multi-line string.
string combined = str.format(
     "{0}\n{1}\n{2}\n{3}\n{4}\n{5}\n{6}\n{7}\n{8}\n{9}",
     floatRepr, rounded0, rounded1, trailingZeros, trueRepr,
     falseRepr, floatArrayRepr, roundedArrayRepr, stringArrayRepr,
     mixedTypeRepr
 )</code></div>
<p>When working with “int” values that symbolize UNIX timestamps, such as
those returned from time-related functions and variables, one can also
use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format_time">str.format_time()</a>
to convert them to human-readable date strings. This code block
demonstrates multiple ways to convert a timestamp using these functions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable A UNIX timestamp, in milliseconds.
int unixTime = 1279411200000

//@variable Returns: "2010-07-18T00:00:00+0000"
string default = str.format_time(unixTime)
//@variable Returns: "2010-07-18"
string ymdRepr = str.format_time(unixTime, "yyyy-MM-dd")
//@variable Returns: "07-18-2010"
string mdyRepr = str.format_time(unixTime, "MM-dd-yyyy")
//@variable Returns: "20:00:00, 2010-07-17"
string hmsymdRepr = str.format_time(unixTime, "HH:mm:ss, yyyy-MM-dd", "America/New_York")
//@variable Returns: "Year: 2010, Month: 07, Day: 18, Time: 12:00:00"
string customFormat = str.format(
     "Year: {0, time, yyyy}, Month: {1, time, MM}, Day: {2, time, dd}, Time: {3, time, hh:mm:ss}",
     unixTime, unixTime, unixTime, unixTime
 )</code></div>
<p>When working with types that <em>don’t</em> have built-in “string”
representations, e.g.,
<a href="/pine-script-docs/v5/language/type-system/#color">color</a>,
<a href="/pine-script-docs/v5/language/maps/">map</a>,
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>, etc., programmers can use custom logic or formatting to
construct representations. For example, this code calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
to represent a “color” value using its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.r">r</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.g">g</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.b">b</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_color.t">t</a>
components:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable The built-in `color.maroon` value with 17% transparency.
color myColor = color.new(color.maroon, 17)

// Get the red, green, blue, and transparency components from `myColor`.
float r = color.r(myColor)
float g = color.g(myColor)
float b = color.b(myColor)
float t = color.t(myColor)

//@variable Returns: "color (r = 136, g = 14, b = 79, t = 17)"
string customRepr = str.format("color (r = {0}, g = {1}, b = {2}, t = {3})", r, g, b, t)</code></div>
<p>There are countless ways one can represent data using strings. When
choosing string formats for debugging, ensure the results are
<strong>readable</strong> and provide enough information for proper inspection. The
following segments explain ways to validate strings by displaying them
on the chart using <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>, and
the section after these segments explains how to display strings as
messages in the <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane.</p>
<h3 class="md-heading" id="using-labels"><a href="#using-labels">Using labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">Labels</a> allow
scripts to display dynamic text (“series strings”) at any available
location on the chart. Where to display such text on the chart depends
on the information the programmer wants to inspect and their debugging
preferences.</p>
<h4 class="md-heading" id="on-successive-bars"><a href="#on-successive-bars">On successive bars<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When inspecting the history of values that affect the chart’s scale or
working with multiple series that have different types, a simple, handy
debugging approach is to draw
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> that
display
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representations</a> on successive bars.</p>
<p>For example, this script calculates four series: <code dir="auto">highestClose</code>,
<code dir="auto">percentRank</code>, <code dir="auto">barsSinceHigh</code>, and <code dir="auto">isLow</code>. It uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
to create a formatted “string” representing the series values and a
timestamp, then it calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
to draw a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
that display the results at the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
on each bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="506" loading="lazy" src="images/deea6eeab54757452255f4c20cc1a668.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Labels on successive bars demo", "Inspecting multiple series", true, max_labels_count = 500)

//@variable The number of bars in the calculation window.
int lengthInput = input.int(50, "Length", 1)

//@variable The highest `close` over `lengthInput` bars.
float highestClose = ta.highest(close, lengthInput)
//@variable The percent rank of the current `close` compared to previous values over `lengthInput` bars.
float percentRank = ta.percentrank(close, lengthInput)
//@variable The number of bars since the `close` was equal to the `highestClose`.
int barsSinceHigh = ta.barssince(close == highestClose)
//@variable Is `true` when the `percentRank` is 0, i.e., when the `close` is the lowest.
bool isLow = percentRank == 0.0

//@variable A multi-line string representing the `time`, `highestClose`, `percentRank`, `barsSinceHigh`, and `isLow`.
string debugString = str.format(
     "time (GMT): {0, time, yyyy-MM-dd'T'HH:mm:ss}\nhighestClose: {1, number, #.####}
     \npercentRank: {2, number, #.##}%\nbarsSinceHigh: {3, number, integer}\nisLow: {4}",
     time, highestClose, percentRank, barsSinceHigh, isLow
 )

//@variable Draws a label showing the `debugString` at each bar's `high`.
label debugLabel = label.new(chart.point.now(high), debugString, textcolor = color.white)</code></div>
<p>While the above example allows one to inspect the results of the
script’s series on any bar with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
drawing, consecutive drawings like these can clutter the chart,
especially when viewing longer strings.</p>
<p>An alternative, more visually compact way to inspect successive bars’
values with <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> is to utilize the <code dir="auto">tooltip</code> property instead of the <code dir="auto">text</code>
property, as a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
will only show its tooltip when the cursor <em>hovers</em> over it.</p>
<p>Below, we’ve modified the previous script by using the <code dir="auto">debugString</code> as
the <code dir="auto">tooltip</code> argument instead of the <code dir="auto">text</code> argument in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
call. Now, we can view the results on specific bars without the extra
noise:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="528" loading="lazy" src="images/eee7f21de0b22204e65e65c090a10f06.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Tooltips on successive bars demo", "Inspecting multiple series", true, max_labels_count = 500)

//@variable The number of bars in the calculation window.
int lengthInput = input.int(50, "Length", 1)

//@variable The highest `close` over `lengthInput` bars.
float highestClose = ta.highest(close, lengthInput)
//@variable The percent rank of the current `close` compared to previous values over `lengthInput` bars.
float percentRank = ta.percentrank(close, lengthInput)
//@variable The number of bars since the `close` was equal to the `highestClose`.
int barsSinceHigh = ta.barssince(close == highestClose)
//@variable Is `true` when the `percentRank` is 0, i.e., when the `close` is the lowest.
bool isLow = percentRank == 0.0

//@variable A multi-line string representing the `time`, `highestClose`, `percentRank`, `barsSinceHigh`, and `isLow`.
string debugString = str.format(
     "time (GMT): {0, time, yyyy-MM-dd'T'HH:mm:ss}\nhighestClose: {1, number, #.####}
     \npercentRank: {2, number, #.##}%\nbarsSinceHigh: {3, number, integer}\nisLow: {4}",
     time, highestClose, percentRank, barsSinceHigh, isLow
 )

//@variable Draws a label showing the `debugString` in a tooltip at each bar's `high`.
label debugLabel = label.new(chart.point.now(high), tooltip = debugString)</code></div>
<p>It’s important to note that a script can display up to 500
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
drawings, meaning the above examples will only allow users to inspect
the strings from the most recent 500 chart bars.</p>
<p>If a programmer wants to see the results from <em>earlier</em> chart bars, one
approach is to create conditional logic that only allows drawings within
a specific time range, e.g.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if time &gt;= startTime and time &lt;= endTime
    &lt;create_drawing_id&gt;</code></div>
<p>If we use this structure in our previous example with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a>
as the <code dir="auto">startTime</code> and <code dir="auto">endTime</code> values, the script will only create
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on
<strong>visible chart bars</strong> and avoid drawing on others. With this logic, we
can scroll to view labels on <em>any</em> chart bar, as long as there are up to
<code dir="auto">max_labels_count</code> bars in the visible range:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/69dd5f9253d96461125001338d4136a9.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Tooltips on visible bars demo", "Inspecting multiple series", true, max_labels_count = 500)

//@variable The number of bars in the calculation window.
int lengthInput = input.int(50, "Length", 1)

//@variable The highest `close` over `lengthInput` bars.
float highestClose = ta.highest(close, lengthInput)
//@variable The percent rank of the current `close` compared to previous values over `lengthInput` bars.
float percentRank = ta.percentrank(close, lengthInput)
//@variable The number of bars since the `close` was equal to the `highestClose`.
int barsSinceHigh = ta.barssince(close == highestClose)
//@variable Is `true` when the `percentRank` is 0, i.e., when the `close` is the lowest.
bool isLow = percentRank == 0.0

//@variable A multi-line string representing the `time`, `highestClose`, `percentRank`, `barsSinceHigh`, and `isLow`.
string debugString = str.format(
     "time (GMT): {0, time, yyyy-MM-dd'T'HH:mm:ss}\nhighestClose: {1, number, #.####}
     \npercentRank: {2, number, #.##}%\nbarsSinceHigh: {3, number, integer}\nisLow: {4}",
     time, highestClose, percentRank, barsSinceHigh, isLow
 )

if time &gt;= chart.left_visible_bar_time and time &lt;= chart.right_visible_bar_time
    //@variable Draws a label showing the `debugString` in a tooltip at each visible bar's `high`.
    label debugLabel = label.new(chart.point.now(high), tooltip = debugString)</code></div>
<p>Note that:</p>
<ul>
<li>If the visible chart contains more bars than allowed drawings,
the script will only show results on the latest bars in the
visible range. For best results with this technique, zoom on the
chart to keep the visible range limited to the allowed number of
drawings.</li>
</ul>
<h4 class="md-heading" id="at-the-end-of-the-chart"><a href="#at-the-end-of-the-chart">At the end of the chart<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>A frequent approach to debugging a script’s strings with
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> is to
display them at the <em>end</em> of the chart, namely when the strings do not
change or when only a specific bar’s values require analysis.</p>
<p>The script below contains a user-defined <code dir="auto">printLabel()</code> function that
draws a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
at the last available time on the chart, regardless of when the script
calls it. We’ve used the function in this example to display a “Hello
world!” string, some basic chart information, and the data feed’s
current OHLCV values:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/32a4eb5902d689fd2851596bef3e9805.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Labels at the end of the chart demo", "Chart info", true)

//@function     Draws a label to print the `txt` at the last available time on the chart.
//              When called from the global scope, the label updates its text using the specified `txt` on every bar.
//@param txt    The string to display on the chart.
//@param price  The optional y-axis location of the label. If not specified, draws the label above the last chart bar.
//@returns      The resulting label ID.
printLabel(string txt, float price = na) =&gt;
    int labelTime = math.max(last_bar_time, chart.right_visible_bar_time)
    var label result = label.new(
         labelTime, na, txt, xloc.bar_time, na(price) ? yloc.abovebar : yloc.price, na,
         label.style_none, chart.fg_color, size.large
     )
    label.set_text(result, txt)
    label.set_y(result, price)
    result

//@variable A formatted string containing information about the current chart.
string chartInfo = str.format(
     "Symbol: {0}:{1}\nTimeframe: {2}\nStandard chart: {3}\nReplay active: {4}",
     syminfo.prefix, syminfo.ticker, timeframe.period, chart.is_standard,
     str.contains(syminfo.tickerid, "replay")
 )

//@variable A formatted string containing OHLCV values.
string ohlcvInfo = str.format(
     "O: {0, number, #.#####}, H: {1, number, #.#####}, L: {2, number, #.#####}, C: {3, number, #.#####}, V: {4}",
     open, high, low, close, str.tostring(volume, format.volume)
 )

// Print "Hello world!" and the `chartInfo` at the end of the chart on the first bar.
if barstate.isfirst
    printLabel("Hello world!" + "\n\n\n\n\n\n\n")
    printLabel(chartInfo + "\n\n")

// Print current `ohlcvInfo` at the end of the chart, updating the displayed text as new data comes in.
printLabel(ohlcvInfo)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">printLabel()</code> function sets the x-coordinate of the drawn
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.max">max</a>
of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_last_bar_time">last_bar_time</a>
and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a>
to ensure it always shows the results at the last available bar.</li>
<li>When called from the <em>global scope</em>, the function creates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
with <code dir="auto">text</code> and <code dir="auto">y</code> properties that update on every bar.</li>
<li>We’ve made three calls to the function and added linefeed
characters (<code dir="auto">\n</code>) to demonstrate that users can superimpose the
results from multiple
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> at the end of the chart if the strings have adequate
line spacing.</li>
</ul>
<h3 class="md-heading" id="using-tables"><a href="#using-tables">Using tables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/concepts/tables/">Tables</a> display strings
within cells arranged in columns and rows at fixed locations relative to
a chart pane’s visual space. They can serve as versatile chart-based
debugging tools, as unlike
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a>, they
allow programmers to inspect one or <em>more</em> “series strings” in an
organized visual structure agnostic to the chart’s scale or bar index.</p>
<p>For example, this script calculates a custom <code dir="auto">filter</code> whose result is
the ratio of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema">EMA</a>
of weighted
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.ema">EMA</a>
of the <code dir="auto">weight</code> series. For inspection of the variables used in the
calculation, it creates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
instance on the first bar, initializes the table’s cells on the last
historical bar, then updates necessary cells with “string”
representations of the values from <code dir="auto">barsBack</code> bars ago on the latest
chart bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/272b1a121186fa65a571100a8da06093.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debugging with tables demo", "History inspection", true)

//@variable The number of bars back in the chart's history to inspect.
int barsBack = input.int(10, "Bars back", 0, 4999)

//@variable The percent rank of `volume` over 10 bars.
float weight = ta.percentrank(volume, 10)
//@variable The 10-bar EMA of `weight * close` values.
float numerator = ta.ema(weight * close, 10)
//@variable The 10-bar EMA of `weight` values.
float denominator = ta.ema(weight, 10)
//@variable The ratio of the `numerator` to the `denominator`.
float filter = numerator / denominator

// Plot the `filter`.
plot(filter, "Custom filter")

//@variable The color of the frame, border, and text in the `debugTable`.
color tableColor = chart.fg_color

//@variable A table that contains "string" representations of variable names and values on the latest chart bar.
var table debugTable = table.new(
     position.top_right, 2, 5, frame_color = tableColor, frame_width = 1, border_color = tableColor, border_width = 1
 )

// Initialize cells on the last confirmed historical bar.
if barstate.islastconfirmedhistory
    table.cell(debugTable, 0, 0, "Variable", text_color = tableColor)
    table.cell(debugTable, 1, 0, str.format("Value {0, number, integer} bars ago", barsBack), text_color = tableColor)
    table.cell(debugTable, 0, 1, "weight", text_color = tableColor)
    table.cell(debugTable, 1, 1, "", text_color = tableColor)
    table.cell(debugTable, 0, 2, "numerator", text_color = tableColor)
    table.cell(debugTable, 1, 2, "", text_color = tableColor)
    table.cell(debugTable, 0, 3, "denominator", text_color = tableColor)
    table.cell(debugTable, 1, 3, "", text_color = tableColor)
    table.cell(debugTable, 0, 4, "filter", text_color = tableColor)
    table.cell(debugTable, 1, 4, "", text_color = tableColor)

// Update value cells on the last available bar.
if barstate.islast
    table.cell_set_text(debugTable, 1, 1, str.tostring(weight[barsBack], format.percent))
    table.cell_set_text(debugTable, 1, 2, str.tostring(numerator[barsBack]))
    table.cell_set_text(debugTable, 1, 3, str.tostring(denominator[barsBack]))
    table.cell_set_text(debugTable, 1, 4, str.tostring(filter[barsBack]))</code></div>
<p>Note that:</p>
<ul>
<li>The script uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to specify that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
assigned to the <code dir="auto">debugTable</code> variable on the first bar persists
throughout the script’s execution.</li>
<li>This script modifies the table within two
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structures. The first structure initializes the cells with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell">table.cell()</a>
only on the last confirmed historical bar
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islastconfirmedhistory">barstate.islastconfirmedhistory</a>).
The second structure updates the <code dir="auto">text</code> properties of relevant
cells with
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representations</a> of our variables’ values using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table.cell_set_text">table.cell_set_text()</a>
calls on the latest available bar
(<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">barstate.islast</a>).</li>
</ul>
<p>It’s important to note that although tables can provide debugging
utility, namely when working with multiple series or creating on-chart
logs, they carry a higher computational cost than other techniques
discussed on this page and may require <em>more code</em>. Additionally, unlike
<a href="/pine-script-docs/v5/writing/debugging/#using-labels">labels</a>, one can only view a table’s state from the latest script
execution. We therefore recommend using them <em>wisely</em> and <em>sparingly</em>
while debugging, opting for <em>simplified</em> approaches where possible. For
more information about using
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
objects, see the <a href="/pine-script-docs/v5/concepts/tables/">Tables</a>
page.</p>
<h2 class="md-heading" id="pine-logs"><a href="#pine-logs">Pine Logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Logs are <em>interactive messages</em> that scripts can output at specific
points in their execution. They provide a powerful way for programmers
to inspect a script’s data, conditions, and execution flow with minimal
code.</p>
<p>Unlike the other tools discussed on this page, Pine Logs have a
deliberate design for in-depth script debugging. Scripts do not display
Pine Logs on the chart or in the Data Window. Instead, they print
messages with timestamps in the dedicated <em>Pine Logs pane</em>, which
provides specialized navigation features and filtering options.</p>
<p>To access the Pine Logs pane, select “Pine Logs…” from the
Editor’s “More” menu or from the “More” menu of a script loaded on
the chart that uses <code dir="auto">log.*()</code> functions:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="296" loading="lazy" src="images/fff06556745a174f500f2469915156e6.webp" width="720"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Only <strong>personal scripts</strong> can generate Pine Logs. A published script
<em>cannot</em> create logs, even if it has <code dir="auto">log.*()</code> function calls in its
code. One must consider alternative approaches, such as those outlined
in the sections above, when
<a href="/pine-script-docs/v5/writing/publishing/">publishing scripts</a> with
debugging functionality.</p></div></aside>
<h3 class="md-heading" id="creating-logs"><a href="#creating-logs">Creating logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can create logs by calling the functions in the <code dir="auto">log.*()</code>
namespace.</p>
<p>All <code dir="auto">log.*()</code> functions have the following signatures:</p>
<div class="expressive-code not-content"><link href="/pine-script-docs/_astro/ec.dtidy.css" rel="stylesheet"><script src="/pine-script-docs/_astro/ec.qopfj.js" type="module"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">log.*(message) → void</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">log.*(formatString, arg0, arg1, ...) → void</span></div></div></code></pre></figure></link></div>
<p>The first overload logs a specified <code dir="auto">message</code> in the Pine Logs pane. The
second overload is similar to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>,
as it logs a formatted message based on the <code dir="auto">formatString</code> and the
additional arguments supplied in the call.</p>
<p>Each <code dir="auto">log.*()</code> function has a different <em>debug level</em>, allowing
programmers to categorize and
<a href="/pine-script-docs/v5/writing/debugging/#filtering-logs">filter</a> results shown in the pane:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
function logs an entry with the <em>“info”</em> level that appears in the
pane with gray text.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning">log.warning()</a>
function logs an entry with the <em>“warning”</em> level that appears in
the pane with orange text.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error">log.error()</a>
function logs an entry with the <em>“error”</em> level that appears in
the pane with red text.</li>
</ul>
<p>This code demonstrates the difference between all three <code dir="auto">log.*()</code>
functions. It calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning">log.warning()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error">log.error()</a>
on the first available bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="428" loading="lazy" src="images/95dd3ab732b4441d4a1c261d6779321f.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debug levels demo", overlay = true)

if barstate.isfirst
    log.info("This is an 'info' message.")
    log.warning("This is a 'warning' message.")
    log.error("This is an 'error' message.")</code></div>
<p>Pine Logs can execute anywhere within a script’s execution. They allow
programmers to track information from historical bars and monitor how
their scripts behave on realtime, <em>unconfirmed</em> bars. When executing on
historical bars, scripts generate a new message once for each <code dir="auto">log.*()</code>
call on a bar. On realtime bars, calls to <code dir="auto">log.*()</code> functions can create
new entries on <em>each new tick</em>.</p>
<p>For example, this script calculates the average ratio between each
bar’s <code dir="auto">close - open</code> value to its <code dir="auto">high - low</code> range. When the
<code dir="auto">denominator</code> is nonzero, the script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
to print the values of the calculation’s variables on confirmed bars
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.warning">log.warning()</a>
to print the values on unconfirmed bars. Otherwise, it uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.error">log.error()</a>
to indicate that division by zero occurred, as such cases can affect the
<code dir="auto">average</code> result:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="666" loading="lazy" src="images/2a1ff6dd22a7bf6b6ab049c2104cc51b.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Logging historical and realtime data demo", "Average bar ratio")

//@variable The current bar's change from the `open` to `close`.
float numerator = close - open
//@variable The current bar's `low` to `high` range.
float denominator = high - low
//@variable The ratio of the bar's open-to-close range to its full range.
float ratio = numerator / denominator
//@variable The average `ratio` over 10 non-na values.
float average = ta.sma(ratio, 10)

// Plot the `average`.
plot(average, "average", color.purple, 3)

if barstate.isconfirmed
    // Log a division by zero error if the `denominator` is 0.
    if denominator == 0.0
        log.error("Division by 0 in confirmed results!")
    // Otherwise, log the confirmed values.
    else
        log.info(
             "Values (confirmed):\nnumerator: {1, number, #.########}\ndenominator: {2, number, #.########}
             \nratio: {0, number, #.########}\naverage: {3, number, #.########}",
             ratio, numerator, denominator, average
         )
else
    // Log a division by zero error if the `denominator` is 0.
    if denominator == 0.0
        log.error("Division by 0 on unconfirmed bar.")
    // Otherwise, log the unconfirmed values.
    else
        log.warning(
             "Values (unconfirmed):\nnumerator: {1, number, #.########}\ndenominator: {2, number, #.########}
             \nratio: {0, number, #.########}\naverage: {3, number, #.########}",
             ratio, numerator, denominator, average
         )</code></div>
<p>Note that:</p>
<ul>
<li>Pine Logs <em>do not roll back</em> on each tick in an unconfirmed bar,
meaning the results for those ticks show in the pane until the
script restarts its execution. To only log messages on
<em>confirmed</em> bars, use
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed">barstate.isconfirmed</a>
in the conditions that trigger a <code dir="auto">log.*()</code> call.</li>
<li>When logging on unconfirmed bars, we recommend ensuring those
logs contain <em>unique information</em> or use different <em>debug
levels</em> so you can
<a href="/pine-script-docs/v5/writing/debugging/#filtering-logs">filter</a> the results as needed.</li>
<li>The Pine Logs pane will show up to the most recent 10,000
entries for historical bars. If a script generates more than
10,000 logs on historical bars and a programmer needs to view
earlier entries, they can use conditional logic to limit
<code dir="auto">log.*()</code> calls to specific occurrences. See
<a href="/pine-script-docs/v5/writing/debugging/#using-inputs">this</a> section for an example that limits log generation to
a user-specified time range.</li>
</ul>
<h3 class="md-heading" id="inspecting-logs"><a href="#inspecting-logs">Inspecting logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Logs include some helpful features that simplify the inspection
process. Whenever a script generates a log, it automatically prefixes
the message with a granular timestamp to signify where the log event
occurred in the time series. Additionally, each entry contains
<strong>“Source code”</strong> and <strong>“Scroll to bar”</strong> icons, which appear when
hovering over it in the Pine Logs pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="470" loading="lazy" src="images/fdde1080ace4b78c2a66e1128b00145c.webp" width="1342"/></div></p>
<p>Clicking an entry’s “Source code” icon opens the script in the Pine
Editor and highlights the specific line of code that triggered the log:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="434" loading="lazy" src="images/32e4109c6693c729a03c2bb297970b17.webp" width="1342"/></div></p>
<p>Clicking an entry’s “Scroll to bar” icon navigates the chart to the
specific bar where the log occurred, then temporarily displays a tooltip
containing time information for that bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="560" loading="lazy" src="images/94cf3e6b7b587dbc5241cabdc487fdd0.webp" width="1342"/></div></p>
<p>Note that:</p>
<ul>
<li>The time information in the tooltip depends on the chart’s
timeframe, just like the x-axis label linked to the chart’s
cursor and drawing tools. For example, the tooltip on an EOD
chart will only show the weekday and the date, whereas the
tooltip on a 10-second chart will also contain the time of day,
including seconds.</li>
</ul>
<p>When a chart includes more than one script that generates logs, it’s
important to note that each script maintains its own <em>independent</em>
message history. To inspect the messages from a specific script when
multiple are on the chart, select its title from the dropdown at the top
of the Pine Logs pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="374" loading="lazy" src="images/e98f372ef97b10cf23cfe1d8f2858b68.webp" width="1342"/></div></p>
<h3 class="md-heading" id="filtering-logs"><a href="#filtering-logs">Filtering logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A single script can generate numerous logs, depending on the conditions
that trigger its <code dir="auto">log.*()</code> calls. While directly scrolling through the
log history to find specific entries may suffice when a script only
generates a few, it can become unwieldy when searching through hundreds
or thousands of messages.</p>
<p>The Pine Logs pane includes multiple options for filtering messages,
which allows one to simplify their results by isolating specific
<em>character sequences</em>, <em>start times</em>, and <em>debug levels</em>.</p>
<p>Clicking the “Search” icon at the top of the pane opens a search bar,
which matches text to filter logged messages. The search filter also
highlights the matched portion of each message in blue for visual
reference. For example, here, we entered “confirmed” to match all
results generated by our previous script with the word somewhere in
their text:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/e6f2ebe476289e4cd7b1553a01e72f10.webp" width="1342"/></div></p>
<p>Notice that the results from this search also considered messages with
<em>“unconfirmed”</em> as matches since the word contains our query. We can
omit these matches by selecting the “Whole Word” checkbox in the
options at the right of the search bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/f45ae14e3ca4b86141408720bd39d043.webp" width="1342"/></div></p>
<p>This filter also supports <a href="https://en.wikipedia.org/wiki/Regular_expression" rel="nofollow">regular expressions
(regex)</a>, which allow
users to perform advanced searches that match custom <em>character
patterns</em> when selecting the “Regex” checkbox in the search options.
For example, this regex matches all entries that contain “average”
followed by a sequence representing a number greater than 0.5 and less
than or equal to 1:</p>
<p><code dir="auto">average:\s*(0\.[6-9]\d*|0\.5\d*[1-9]\d*|1\.0*)</code></p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/ee6d84920fe62d36877cae7120784d24.webp" width="1342"/></div></p>
<p>Clicking the “Start date” icon opens a dialog that allows users to
specify the date and time of the first log shown in the results:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="566" loading="lazy" src="images/276a10c645302f85d9c2404c43887dea.webp" width="1342"/></div></p>
<p>After specifying the starting point, a tag containing the starting time
will appear above the log history:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="388" loading="lazy" src="images/24380048004374f793da152b14d28e71.webp" width="1342"/></div></p>
<p>Users can filter results by <em>debug level</em> using the checkboxes available
when selecting the rightmost icon in the filtering options. Here, we’ve
deactivated the “info” and “warning” levels so the results will only
contain “error” messages:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/31a03af548874b4458388ed65067e781.webp" width="1342"/></div></p>
<h4 class="md-heading" id="using-inputs"><a href="#using-inputs">Using inputs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Another, more involved way to interactively filter a script’s logged
results is to create <a href="/pine-script-docs/v5/concepts/inputs/">inputs</a>
linked to conditional logic that activates specific <code dir="auto">log.*()</code> calls in
the code.</p>
<p>Let’s look at an example. This code calculates an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rma">RMA</a>
of
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices and declares a few unique conditions to form a
<a href="/pine-script-docs/v5/writing/debugging/#compound-and-nested-conditions">compound condition</a>. The script uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
to display important debugging information in the Pine Logs pane,
including the values of the <code dir="auto">compoundCondition</code> variable and the
“bool” variables that determine its result.</p>
<p>We declared the <code dir="auto">filterLogsInput</code>, <code dir="auto">logStartInput</code>, and <code dir="auto">logEndInput</code>
variables respectively assigned to an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.bool">input.bool()</a>
and two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a>
calls for custom log filtering. When <code dir="auto">filterLogsInput</code> is <code dir="auto">true</code>, the
script will only generate a new log if the bar’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_time">time</a>
is between the <code dir="auto">logStartInput</code> and <code dir="auto">logEndInput</code> values, allowing us to
interactively isolate the entries that occurred within a specific time
range:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="524" loading="lazy" src="images/d63ef03465bc77c5abd526244c88e6bb.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Filtering logs using inputs demo", "Compound condition in input range", true)

//@variable The length for moving average calculations.
int lengthInput = input.int(20, "Length", 2)

//@variable If `true`, only allows logs within the input time range.
bool filterLogsInput = input.bool(true, "Only log in time range", group = "Log filter")
//@variable The starting time for logs if `filterLogsInput` is `true`.
int logStartInput = input.time(0, "Start time", group = "Log filter", confirm = true)
//@variable The ending time for logs if `filterLogsInput` is `true`.
int logEndInput = input.time(0, "End time", group = "Log filter", confirm = true)

//@variable The RMA of `close` prices.
float rma = ta.rma(close, lengthInput)

//@variable Is `true` when `close` exceeds the `rma`.
bool priceBelow = close &lt;= rma
//@variable Is `true` when the current `close` is greater than the max of the previous `hl2` and `close`.
bool priceRising = close &gt; math.max(hl2[1], close[1])
//@variable Is `true` when the `rma` is positively accelerating.
bool rmaAccelerating = rma - 2.0 * rma[1] + rma[2] &gt; 0.0
//@variable Is `true` when the difference between `rma` and `close` exceeds 2 times the current ATR.
bool closeAtThreshold = rma - close &gt; ta.atr(lengthInput) * 2.0
//@variable Is `true` when all the above conditions occur.
bool compoundCondition = priceBelow and priceRising and rmaAccelerating and closeAtThreshold

// Plot the `rma`.
plot(rma, "RMA", color.teal, 3)
// Highlight the chart background when the `compoundCondition` occurs.
bgcolor(compoundCondition ? color.new(color.aqua, 80) : na, title = "Compound condition highlight")

//@variable If `filterLogsInput` is `true`, is only `true` in the input time range. Otherwise, always `true`.
bool showLog = filterLogsInput ? time &gt;= logStartInput and time &lt;= logEndInput : true

// Log results for a confirmed bar when `showLog` is `true`.
if barstate.isconfirmed and showLog
    log.info(
         "\nclose: {0, number, #.#####}\nrma: {1, number, #.#####}\npriceBelow: {2}\npriceRising: {3}
         \nrmaAccelerating: {4}\ncloseAtThreshold: {5}\n\ncompoundCondition: {6}",
         close, rma, priceBelow, priceRising, rmaAccelerating, closeAtThreshold, compoundCondition
     )</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">input.*()</code> functions assigned to the <code dir="auto">filterLogsInput</code>,
<code dir="auto">logStartInput</code>, and <code dir="auto">logEndInput</code> variables include a <code dir="auto">group</code>
argument to oragnize and distinguish them in the script’s
settings.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.time">input.time()</a>
calls include <code dir="auto">confirm = true</code> so that we can interactively set
the start and end times directly on the chart. To reset the
inputs, select “Reset points…” from the options in the
script’s “More” menu.</li>
<li>The condition that triggers each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
call includes
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed">barstate.isconfirmed</a>
to limit log generation to <em>confirmed</em> bars.</li>
</ul>
<h2 class="md-heading" id="debugging-functions"><a href="#debugging-functions">Debugging functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="/pine-script-docs/v5/language/user-defined-functions/">User-defined functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
are custom functions written by users. They encapsulate sequences of
operations that a script can invoke later in its execution.</p>
<p>Every
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
has a <em>local scope</em> that embeds into the script’s global scope. The
parameters in a function’s signature and the variables declared within
the function body belong to that function’s local scope, and they are
<em>not</em> directly accessible to a script’s outer scope or the scopes of
other functions.</p>
<p>The segments below explain a few ways programmers can debug the values
from a function’s local scope. We will use this script as the starting
point for our subsequent examples. It contains a <code dir="auto">customMA()</code> function
that returns an exponential moving average whose smoothing parameter
varies based on the <code dir="auto">source</code> distance outside the 25th and 75th
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentile_linear_interpolation">percentiles</a>
over <code dir="auto">length</code> bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/6443f594e26ece24f9a7096bc910d692.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debugging functions demo", "Custom MA", true)

//@variable The number of bars in the `customMA()` calculation.
int lengthInput = input.int(50, "Length", 2)

//@function      Calculates a moving average that only responds to values outside the first and third quartiles.
//@param source  The series of values to process.
//@param length  The number of bars in the calculation.
//@returns       The moving average value.
customMA(float source, int length) =&gt;
    //@variable The custom moving average.
    var float result = na
    // Calculate the 25th and 75th `source` percentiles.
    float q1 = ta.percentile_linear_interpolation(source, length, 25)
    float q3 = ta.percentile_linear_interpolation(source, length, 75)
    // Calculate the range values.
    float outerRange = math.max(source - q3, q1 - source, 0.0)
    float totalRange = ta.range(source, length)
    //@variable Half the ratio of the `outerRange` to the `totalRange`.
    float alpha = 0.5 * outerRange / totalRange
    // Mix the `source` with the `result` based on the `alpha` value.
    result := (1.0 - alpha) * nz(result, source) + alpha * source
    // Return the `result`.
    result

//@variable The `customMA()` result over `lengthInput` bars.
float maValue = customMA(close, lengthInput)

// Plot the `maValue`.
plot(maValue, "Custom MA", color.blue, 3)</code></div>
<h3 class="md-heading" id="extracting-local-variables"><a href="#extracting-local-variables">Extracting local variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a programmer wants to inspect a
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function’s</a> local variables by
<a href="/pine-script-docs/v5/writing/debugging/#plotting-numbers">plotting</a> its values,
<a href="/pine-script-docs/v5/writing/debugging/#conditional-colors">coloring</a> the background or chart bars, etc., they must <em>extract</em> the
values to the <em>global scope</em>, as the built-in functions that produce
such outputs can only accept global variables and literals.</p>
<p>Since the values returned by a function are available to the scope where
a call occurs, one straightforward extraction approach is to have the
function return a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> containing all the values that need inspection.</p>
<p>Here, we’ve modified the <code dir="auto">customMA()</code> function to return a
<a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> containing
all the function’s calculated variables. Now, we can call the function
with a <em>tuple declaration</em> to make the values available in the global
scope and inspect them with
<a href="/pine-script-docs/v5/writing/debugging/#plotting-numbers">plots</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/19921d87fa774e0787d57b05f33080ca.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Extracting local variables with tuples demo", "Custom MA", true)

//@variable The number of bars in the `customMA()` calculation.
int lengthInput = input.int(50, "Length", 2)

//@function      Calculates a moving average that only responds to values outside the first and third quartiles.
//@param source  The series of values to process.
//@param length  The number of bars in the calculation.
//@returns       The moving average value.
customMA(float source, int length) =&gt;
    //@variable The custom moving average.
    var float result = na
    // Calculate the 25th and 75th `source` percentiles.
    float q1 = ta.percentile_linear_interpolation(source, length, 25)
    float q3 = ta.percentile_linear_interpolation(source, length, 75)
    // Calculate the range values.
    float outerRange = math.max(source - q3, q1 - source, 0.0)
    float totalRange = ta.range(source, length)
    //@variable Half the ratio of the `outerRange` to the `totalRange`.
    float alpha = 0.5 * outerRange / totalRange
    // Mix the `source` with the `result` based on the `alpha` value.
    result := (1.0 - alpha) * nz(result, source) + alpha * source
    // Return a tuple containing the `result` and other local variables.
    [result, q1, q3, outerRange, totalRange, alpha]

// Declare a tuple containing all values returned by `customMA()`.
[maValue, q1Debug, q3Debug, outerRangeDebug, totalRangeDebug, alphaDebug] = customMA(close, lengthInput)

// Plot the `maValue`.
plot(maValue, "Custom MA", color.blue, 3)

//@variable Display location for plots with different scale.
notOnPane = display.all - display.pane

// Display the extracted `q1` and `q3` values in all plot locations.
plot(q1Debug, "q1", color.new(color.maroon, 50))
plot(q3Debug, "q3", color.new(color.teal, 50))
// Display the other extracted values in the status line and Data Window to avoid impacting the scale.
plot(outerRangeDebug, "outerRange", chart.fg_color, display = notOnPane)
plot(totalRangeDebug, "totalRange", chart.fg_color, display = notOnPane)
plot(alphaDebug, "alpha", chart.fg_color, display = notOnPane)
// Highlight the chart when `alphaDebug` is 0, i.e., when the `maValue` does not change.
bgcolor(alphaDebug == 0.0 ? color.new(color.orange, 90) : na, title = "`alpha == 0.0` highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We used <code dir="auto">display.all - display.pane</code> for the plots of the
<code dir="auto">outerRangeDebug</code>, <code dir="auto">totalRangeDebug</code>, and <code dir="auto">alphaDebug</code> variables
to
<a href="/pine-script-docs/v5/writing/debugging/#without-affecting-the-scale">avoid impacting the chart’s scale</a>.</li>
<li>The script also uses a
<a href="/pine-script-docs/v5/writing/debugging/#conditional-colors">conditional color</a> to highlight the chart pane’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">background</a>
when <code dir="auto">debugAlpha</code> is 0, indicating the <code dir="auto">maValue</code> does not
change.</li>
</ul>
<p>Another, more <em>advanced</em> way to extract the values of a function’s
local variables is to pass them to a <em>reference type</em> variable declared
in the global scope.</p>
<p>Function scopes can access global variables for their calculations.
While a script cannot directly reassign the values of global variables
from within a function’s scope, it can update the <em>elements or
properties</em> of those values if they are reference types, such as
<a href="/pine-script-docs/v5/language/arrays/">arrays</a>,
<a href="/pine-script-docs/v5/language/matrices/">matrices</a>,
<a href="/pine-script-docs/v5/language/maps/">maps</a>, and
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>.</p>
<p>This version declares a <code dir="auto">debugData</code> variable in the global scope that
references a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_map">map</a>
with “string” keys and “float” values. Within the local scope of the
<code dir="auto">customMA()</code> function, the script puts <em>key-value pairs</em> containing each
local variable’s name and value into the map. After calling the
function, the script plots the stored <code dir="auto">debugData</code> values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Extracting local variables with reference types demo", "Custom MA", true)

//@variable The number of bars in the `customMA()` calculation.
int lengthInput = input.int(50, "Length", 2)

//@variable A map with "string" keys and "float" values for debugging the `customMA()`.
map&lt;string, float&gt; debugData = map.new&lt;string, float&gt;()

//@function      Calculates a moving average that only responds to values outside the first and third quartiles.
//@param source  The series of values to process.
//@param length  The number of bars in the calculation.
//@returns       The moving average value.
customMA(float source, int length) =&gt;
    //@variable The custom moving average.
    var float result = na
    // Calculate the 25th and 75th `source` percentiles.
    float q1 = ta.percentile_linear_interpolation(source, length, 25),    map.put(debugData, "q1", q1)
    float q3 = ta.percentile_linear_interpolation(source, length, 75),    map.put(debugData, "q3", q3)
    // Calculate the range values.
    float outerRange = math.max(source - q3, q1 - source, 0.0),           map.put(debugData, "outerRange", outerRange)
    float totalRange = ta.range(source, length),                          map.put(debugData, "totalRange", totalRange)
    //@variable Half the ratio of the `outerRange` to the `totalRange`.
    float alpha = 0.5 * outerRange / totalRange,                          map.put(debugData, "alpha", alpha)
    // Mix the `source` with the `result` based on the `alpha` value.
    result := (1.0 - alpha) * nz(result, source) + alpha * source
    // Return the `result`.
    result

//@variable The `customMA()` result over `lengthInput` bars.
float maValue = customMA(close, lengthInput)

// Plot the `maValue`.
plot(maValue, "Custom MA", color.blue, 3)

//@variable Display location for plots with different scale.
notOnPane = display.all - display.pane

// Display the extracted `q1` and `q3` values in all plot locations.
plot(map.get(debugData, "q1"), "q1", color.new(color.maroon, 50))
plot(map.get(debugData, "q3"), "q3", color.new(color.teal, 50))
// Display the other extracted values in the status line and Data Window to avoid impacting the scale.
plot(map.get(debugData, "outerRange"), "outerRange", chart.fg_color, display = notOnPane)
plot(map.get(debugData, "totalRange"), "totalRange", chart.fg_color, display = notOnPane)
plot(map.get(debugData, "alpha"), "alpha", chart.fg_color, display = notOnPane)
// Highlight the chart when the extracted `alpha` is 0, i.e., when the `maValue` does not change.
bgcolor(map.get(debugData, "alpha") == 0.0 ? color.new(color.orange, 90) : na, title = "`alpha == 0.0` highlight")</code></div>
<p>Note that:</p>
<ul>
<li>We placed each
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.put">map.put()</a>
call on the same line as each variable declaration, separated by
a comma, to keep things concise and avoid adding extra lines to
the <code dir="auto">customMA()</code> code.</li>
<li>We used
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_map.get">map.get()</a>
to retrieve each value for the debug
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
calls.</li>
</ul>
<h3 class="md-heading" id="local-drawings-and-logs"><a href="#local-drawings-and-logs">Local drawings and logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Unlike <code dir="auto">plot.*()</code> functions and others that require values accessible to
the global scope, scripts can generate
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing objects</a> and <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> from directly within a function, allowing programmers to
flexibly debug its local variables <em>without</em> extracting values to the
outer scope.</p>
<p>In this example, we used
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> and
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> to
display
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representations</a> of the values within the <code dir="auto">customMA()</code> scope. Inside the
function, the script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.format">str.format()</a>
to create a formatted string representing the local scope’s data, then
calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
to respectively display the text on the chart in a tooltip and log an
“info” message containing the text in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="528" loading="lazy" src="images/87d1cc983c56cec375abef37adb33032.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Local drawings and logs demo", "Custom MA", true, max_labels_count = 500)

//@variable The number of bars in the `customMA()` calculation.
int lengthInput = input.int(50, "Length", 2)

//@function      Calculates a moving average that only responds to values outside the first and third quartiles.
//@param source  The series of values to process.
//@param length  The number of bars in the calculation.
//@returns       The moving average value.
customMA(float source, int length) =&gt;
    //@variable The custom moving average.
    var float result = na
    // Calculate the 25th and 75th `source` percentiles.
    float q1 = ta.percentile_linear_interpolation(source, length, 25)
    float q3 = ta.percentile_linear_interpolation(source, length, 75)
    // Calculate the range values.
    float outerRange = math.max(source - q3, q1 - source, 0.0)
    float totalRange = ta.range(source, length)
    //@variable Half the ratio of the `outerRange` to the `totalRange`.
    float alpha = 0.5 * outerRange / totalRange
    // Mix the `source` with the `result` based on the `alpha` value.
    result := (1.0 - alpha) * nz(result, source) + alpha * source

    //@variable A formatted string containing representations of all local variables.
    string debugText = str.format(
         "\n`customMA()` data\n----------\nsource: {0, number, #.########}\nlength: {1}\nq1: {2, number, #.########}
         \nq3: {3, number, #.########}\nouterRange: {4, number, #.########}\ntotalRange: {5, number, #.########}
         \nalpha{6, number, #.########}\nresult: {7, number, #.########}",
         source, length, q1, q3, outerRange, totalRange, alpha, result
     )
    // Draw a label with a tooltip displaying the `debugText`.
    label.new(bar_index, high, color = color.new(chart.fg_color, 80), tooltip = debugText)
    // Print an "info" message in the Pine Logs pane when the bar is confirmed.
    if barstate.isconfirmed
        log.info(debugText)

    // Return the `result`.
    result

//@variable The `customMA()` result over `lengthInput` bars.
float maValue = customMA(close, lengthInput)

// Plot the `maValue`.
plot(maValue, "Custom MA", color.blue, 3)</code></div>
<p>Note that:</p>
<ul>
<li>We included <code dir="auto">max_labels_count = 500</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function to display
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> for the most recent 500 <code dir="auto">customMA()</code> calls.</li>
<li>The function uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed">barstate.isconfirmed</a>
in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
statement to only call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
on <em>confirmed</em> bars. It does not log a new message on each
realtime tick.</li>
</ul>
<h2 class="md-heading" id="debugging-loops"><a href="#debugging-loops">Debugging loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="/pine-script-docs/v5/language/loops/">Loops</a> are structures that
repeatedly execute a code block based on a <em>counter</em>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>),
the contents of a
<a href="/pine-script-docs/v5/language/type-system/#collections">collection</a>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>),
or a <em>condition</em>
(<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>).
They allow scripts to perform repetitive tasks without the need for
redundant lines of code.</p>
<p>Each loop instance maintains a separate local scope, which all outer
scopes cannot access. All variables declared within a loop’s scope are
specific to that loop, meaning one cannot use them in an outer scope.</p>
<p>As with other structures in Pine, there are numerous possible ways to
debug loops. This section explores a few helpful techniques, including
extracting local values for <a href="/pine-script-docs/v5/concepts/plots/">plots</a>, inspecting values with
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawings</a>, and tracing a loop’s execution with
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>.</p>
<p>We will use this script as a starting point for the examples in the
following segments. It aggregates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value’s rates of change over 1 - <code dir="auto">lookbackInput</code> bars and accumulates
them in a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop, then divides the result by the <code dir="auto">lookbackInput</code> to calculate a
final average value:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="504" loading="lazy" src="images/2192c6e4b825c0cac1d17f8ddd0593c6.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debugging loops demo", "Aggregate ROC")

//@variable The number of bars in the calculation.
int lookbackInput = input.int(20, "Lookback", 1)

//@variable The average ROC of `close` prices over each length from 1 to `lookbackInput` bars.
float aroc = 0.0

// Calculation loop.
for length = 1 to lookbackInput
    //@variable The `close` value `length` bars ago.
    float pastClose = close[length]
    //@variable The `close` rate of change over `length` bars.
    float roc = (close - pastClose) / pastClose
    // Add the `roc` to `aroc`.
    aroc += roc

// Divide `aroc` by the `lookbackInput`.
aroc /= lookbackInput

// Plot the `aroc`.
plot(aroc, "aroc", color.blue, 3)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">aroc</code> is a <em>global</em> variable modified within the loop,
whereas <code dir="auto">pastClose</code> and <code dir="auto">roc</code> are <em>local</em> variables inaccessible
to the outer scope.</li>
</ul>
<h3 class="md-heading" id="inspecting-a-single-iteration"><a href="#inspecting-a-single-iteration">Inspecting a single iteration<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a programmer needs to focus on a specific loop iteration, there are
multiple techniques they can use, most of which entail using a
<em>condition</em> inside the loop to trigger debugging actions, such as
extracting values to outer variables, creating
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawings</a>, <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">logging</a> messages, etc.</p>
<p>This example inspects the local <code dir="auto">roc</code> value from a single iteration of
the loop in three different ways. When the loop counter’s value equals
the <code dir="auto">debugCounterInput</code>, the script assigns the <code dir="auto">roc</code> to an <code dir="auto">rocDebug</code>
variable from the global scope for
<a href="/pine-script-docs/v5/writing/debugging/#plotting-numbers">plotting</a>, draws a vertical
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>
from 0 to the <code dir="auto">roc</code> value using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.new">line.new()</a>,
and logs a message in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane
using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="664" loading="lazy" src="images/a42756be79e5ab6469005eba46fd7c49.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inspecting a single iteration demo", "Aggregate ROC", max_lines_count = 500)

//@variable The number of bars in the calculation.
int lookbackInput = input.int(20, "Lookback", 1)
//@variable The `length` value in the loop's execution where value extraction occurs.
int debugCounterInput = input.int(1, "Loop counter value", 1, group = "Debugging")

//@variable The `roc` value extracted from the loop.
float rocDebug = na

//@variable The average ROC of `close` over lags from 1 to `lookbackInput` bars.
float aroc = 0.0

// Calculation loop.
for length = 1 to lookbackInput
    //@variable The `close` value `length` bars ago.
    float pastClose = close[length]
    //@variable The `close` rate of change over `length` bars.
    float roc = (close - pastClose) / pastClose
    // Add the `roc` to `aroc`.
    aroc += roc

    // Trigger debug actions when the `length` equals the `debugCounterInput`.
    if length == debugCounterInput
        // Assign `roc` to `rocDebug` so the script can plot its value.
        rocDebug := roc
        // Draw a vertical line from 0 to the `roc` at the `bar_index`.
        line.new(bar_index, 0.0, bar_index, roc, color = color.new(color.gray, 50), width = 4)
        // Log an "info" message in the Pine Logs pane.
        log.info("{0}-bar `roc`{1}: {2, number, #.########}", length, barstate.isconfirmed ? " (confirmed)" : "", roc)

// Divide `aroc` by the `lookbackInput`.
aroc /= lookbackInput

// Plot the `aroc`.
plot(aroc, "aroc", color.blue, 3)

// Plot the `rocDebug`.
plot(rocDebug, "Extracted roc", color.new(color.rgb(206, 55, 136), 40), 2)</code></div>
<p>Note that:</p>
<ul>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
call assigned to the <code dir="auto">debugCounterInput</code> includes a <code dir="auto">group</code>
argument to distinguish it in the script’s settings.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
call includes “(confirmed)” in the formatted message whenever
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isconfirmed">barstate.isconfirmed</a>
is <code dir="auto">true</code>. Searching this text in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane will filter out the entries from unconfirmed
bars. See the
<a href="/pine-script-docs/v5/writing/debugging/#filtering-logs">Filtering logs</a> section above.</li>
</ul>
<h3 class="md-heading" id="inspecting-multiple-iterations"><a href="#inspecting-multiple-iterations">Inspecting multiple iterations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When inspecting the values from several loop iterations, it’s often
helpful to utilize
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> or strings to gather the results for use in output functions
after the loop terminates.</p>
<p>This version demonstrates a few ways to collect and display the loop’s
values from all iterations. It declares a <code dir="auto">logText</code> string and a
<code dir="auto">debugValues</code> array in the global scope. Inside the local scope of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop, the script <em>concatenates</em> a
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representation</a> of the <code dir="auto">length</code> and <code dir="auto">roc</code> with the <code dir="auto">logText</code> and calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
to push the iteration’s <code dir="auto">roc</code> value into the <code dir="auto">debugValues</code> array.</p>
<p>After the loop ends, the script
<a href="/pine-script-docs/v5/writing/debugging/#plotting-numbers">plots</a> the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.first">first</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.last">last</a>
value from the <code dir="auto">debugValues</code> array, draws a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
with a <em>tooltip</em> showing a
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representation</a> of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
and displays the <code dir="auto">logText</code> in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane
upon the bar’s confirmation:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/50ff6a65cdf176251cfda577dd4168f8.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inspecting multiple iterations demo", "Aggregate ROC", max_labels_count = 500)

//@variable The number of bars in the calculation.
int lookbackInput = input.int(20, "Lookback", 1)

//@variable An array containing the `roc` value from each loop iteration.
array&lt;float&gt; debugValues = array.new&lt;float&gt;()
//@variable A "string" containing information about the `roc` on each iteration.
string logText = ""

//@variable The average ROC of `close` over lags from 1 to `lookbackInput` bars.
float aroc = 0.0

// Calculation loop.
for length = 1 to lookbackInput
    //@variable The `close` value `length` bars ago.
    float pastClose = close[length]
    //@variable The `close` rate of change over `length` bars.
    float roc = (close - pastClose) / pastClose
    // Add the `roc` to `aroc`.
    aroc += roc

    // Concatenate a new "string" representation with the `debugText`.
    logText += "\nlength: " + str.tostring(length) + ", roc: " + str.tostring(roc)
    // Push the `roc` value into the `debugValues` array.
    array.push(debugValues, roc)

// Divide `aroc` by the `lookbackInput`.
aroc /= lookbackInput

// Plot the `aroc`.
plot(aroc, "aroc", color.blue, 3)

// Plot the `roc` values from the first and last iteration.
plot(array.first(debugValues), "First iteration roc", color.new(color.rgb(166, 84, 233), 50), 2)
plot(array.last(debugValues), "Last iteration roc", color.new(color.rgb(115, 86, 218), 50), 2)
// Draw a label with a tooltip containing a "string" representation of the `debugValues` array.
label.new(bar_index, aroc, color = color.new(color.rgb(206, 55, 136), 70), tooltip = str.tostring(debugValues))
// Log the `logText` in the Pine Logs pane when the bar is confirmed.
if barstate.isconfirmed
    log.info(logText)</code></div>
<p>Another way to inspect a loop over several iterations is to generate
sequential <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> or create/modify
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing objects</a> within the loop’s scope to trace its execution pattern with
granular detail.</p>
<p>This example uses <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> to trace the execution flow of our script’s loop. It
generates a new “info” message on each iteration to track the local
scope’s calculations as the loop progresses on each confirmed bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="662" loading="lazy" src="images/4407c141cc26e593e6f62c3de8474caa.webp" width="1342"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Inspecting multiple iterations demo", "Aggregate ROC")

//@variable The number of bars in the calculation.
int lookbackInput = input.int(20, "Lookback", 1)

//@variable The average ROC of `close` over lags from 1 to `lookbackInput` bars.
float aroc = 0.0

// Calculation loop.
for length = 1 to lookbackInput
    //@variable The `close` value `length` bars ago.
    float pastClose = close[length]
    //@variable The `close` rate of change over `length` bars.
    float roc = (close - pastClose) / pastClose
    // Add the `roc` to `aroc`.
    aroc += roc
    if barstate.isconfirmed
        log.info(
             "{0}\nlength (counter): {1}\npastClose: {2, number, #.#####}\n
             distance to pastClose: {3, number, #.########}\nroc: {4, number, #.########}\n
             aroc (before division): {5, number, #.########}\n{6}",
             length == 1 ? "LOOP START" : "",
             length, pastClose, close - pastClose, roc, aroc,
             length == lookbackInput ? "LOOP END" : ""
         )

// Divide `aroc` by the `lookbackInput`.
aroc /= lookbackInput

// Plot the `aroc`.
plot(aroc, "aroc", color.blue, 3)</code></div>
<p>Note that:</p>
<ul>
<li>When iteratively generating
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">logs</a> or
drawings from inside a loop, make it a point to avoid
unnecessary clutter and strive for easy navigation. More is not
always better for debugging, especially when working within
loops.</li>
</ul>
<h2 class="md-heading" id="tips"><a href="#tips">Tips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="organization-and-readability"><a href="#organization-and-readability">Organization and readability<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When writing scripts, it’s wise to prioritize organized, readable
source codes. Code that’s organized and easy to read helps streamline
the debugging process. Additionally, well-written code is easier to
maintain over time.</p>
<p>Here are a few quick tips based on our
<a href="/pine-script-docs/v5/writing/style-guide/">Style guide</a> and the
examples on this page:</p>
<ul>
<li>Aim to follow the general
<a href="/pine-script-docs/v5/writing/style-guide/#script-organization">script organization</a> recommendations. Organizing scripts using this structure
makes things easier to locate and inspect.</li>
<li>Choose variable and function names that make them easy to <em>identify</em>
and <em>understand</em>. See the
<a href="/pine-script-docs/v5/writing/style-guide/#naming-conventions">Naming conventions</a> section for some examples.</li>
<li>It’s often helpful to temporarily assign important parts of
expressions to variables with informative names while debugging.
Breaking expressions down into reusable parts helps simplify
inspection processes.</li>
<li>Use <em>comments</em> and <em>annotations</em> (<code dir="auto">//@function</code>, <code dir="auto">//@variable</code>,
etc.) to document your code. Annotations are particularly helpful,
as the Pine Editor’s autosuggest displays variable and function
descriptions in a pop-up when hovering over their identifiers
anywhere in the code.</li>
<li>Remember that <em>less is more</em> in many cases. Don’t overwhelm
yourself with excessive script outputs or unnecessary information
while debugging. Keep things simple, and only include as much
information as you need.</li>
</ul>
<h3 class="md-heading" id="speeding-up-repetitive-tasks"><a href="#speeding-up-repetitive-tasks">Speeding up repetitive tasks<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>There are a few handy techniques we often utilize when debugging our
code:</p>
<ul>
<li>We use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>
to quickly display the results of “int”, “float”, or “bool”
variables and expressions in the script’s status line and the Data
Window.</li>
<li>We often use
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
to visualize the history of certain
<a href="/pine-script-docs/v5/writing/debugging/#conditions">conditions</a> on the chart.</li>
<li>We use a one-line version of our <code dir="auto">printLabel()</code> function from
<a href="/pine-script-docs/v5/writing/debugging/#at-the-end-of-the-chart">this section</a> to print strings at the end of the chart.</li>
<li>We use a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
call with a <code dir="auto">tooltip</code> argument to display strings in tooltips
<a href="/pine-script-docs/v5/writing/debugging/#on-successive-bars">on successive bars</a>.</li>
<li>We use the <code dir="auto">log.*()</code> functions to quickly display data with
<a href="/pine-script-docs/v5/writing/debugging/#representing-other-types">string representations</a> in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a>
pane.</li>
</ul>
<p>When one establishes their typical debugging processes, it’s often
helpful to create <em>keyboard macros</em> to speed up repetitive tasks and
spend less time setting up debug outputs in each code.</p>
<p>The following is a simple <em>AutoHotkey</em> script (<strong>not</strong> Pine Script™
code) that includes hotstrings for the above five techniques. The script
generates code snippets by entering a specified character sequence
followed by a whitespace:</p>
<div class="expressive-code not-content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="txt"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">; ————— This is AHK code, not Pine Script™. —————</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">; Specify that hotstrings trigger when they end with space, tab, linefeed, or carriage return.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">#Hotstring EndChars `t `n `r</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,show::SendInput, plotchar(%Clipboard%, "%Clipboard%", "", color = chart.fg_color, display = display.all - display.pane){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,highlight::SendInput, bgcolor(bool(%Clipboard%) ? color.new(color.orange, 80) : na, title = "%Clipboard% highlight"){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,print::SendInput, printLabel(string txt, float price = na) =&gt; int labelTime = math.max(last_bar_time, chart.right_visible_bar_time), var label result = label.new(labelTime, na, txt, xloc.bar_time, na(price) ? yloc.abovebar : yloc.price, na, label.style_none, chart.fg_color, size.large), label.set_text(result, txt), label.set_y(result, price), result`nprintLabel(){Left}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,tooltip::SendInput, label.new(bar_index, high, color = color.new(chart.fg_color, 70), tooltip = str.tostring(%Clipboard%)){Enter}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">:X:,,log::SendInput, log.info(str.tostring(%Clipboard%)){Enter}</span></div></div></code></pre></figure></div>
<p>The “,,show” macro generates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>
call that uses the clipboard’s contents for the <code dir="auto">series</code> and <code dir="auto">title</code>
arguments. Copying a <code dir="auto">variableName</code> variable or the <code dir="auto">close &gt; open</code>
expression and typing “,,show” followed by a space will respectively
yield:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plotchar(variableName, "variableName", "", color = chart.fg_color, display = display.all - display.pane)
plotchar(close &gt; open, "close &gt; open", "", color = chart.fg_color, display = display.all - display.pane)</code></div>
<p>The “,,highlight” macro generates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a>
call that highlights the chart pane’s background with a
<a href="/pine-script-docs/v5/writing/debugging/#conditional-colors">conditional color</a> based on the variable or expression copied to the clipboard.
For example, copying the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isrealtime">barstate.isrealtime</a>
variable and typing “,,highlight” followed by a space will yield:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">bgcolor(bool(barstate.isrealtime) ? color.new(color.orange, 80) : na, title = "barstate.isrealtime highlight")</code></div>
<p>The “,,print” macro generates the one-line <code dir="auto">printLabel()</code> function and
creates an empty <code dir="auto">printLabel()</code> call with the cursor placed inside it.
All you need to do after typing “,,print” followed by a space is enter
the text you want to display:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">printLabel(string txt, float price = na) =&gt; int labelTime = math.max(last_bar_time, chart.right_visible_bar_time), var label result = label.new(labelTime, na, txt, xloc.bar_time, na(price) ? yloc.abovebar : yloc.price, na, label.style_none, chart.fg_color, size.large), label.set_text(result, txt), label.set_y(result, price), result
printLabel()</code></div>
<p>The “,,tooltip” macro generates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.new">label.new()</a>
call with a <code dir="auto">tooltip</code> argument that uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
on the clipboard’s contents. Copying the <code dir="auto">variableName</code> variable and
typing “,,tooltip” followed by a space yields:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">label.new(bar_index, high, color = color.new(chart.fg_color, 70), tooltip = str.tostring(variableName))</code></div>
<p>The “,,log” macro generates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_log.info">log.info()</a>
call with a <code dir="auto">message</code> argument that uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_str.tostring">str.tostring()</a>
on the clipboard’s contents to display string representations of
variables and expressions in the
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> pane.
Copying the expression <code dir="auto">bar_index % 2 == 0</code> and typing “,,log”
followed by a space yields:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">log.info(str.tostring(bar_index % 2 == 0))</code></div>
<p>Note that:</p>
<ul>
<li>AHK is available for <em>Windows</em> devices. Research other software
to employ a similar process if your machine uses a different
operating system.</li>
</ul> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/style-guide"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Style guide  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/profiling-and-optimization"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Profiling and optimization <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/writing/style-guide">Writing scripts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Profiling and optimization</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="writing-scripts-profiling-and-optimization"><a href="#profiling-and-optimization">Profiling and optimization<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ is a cloud-based compiled language geared toward efficient
repeated script execution. When a user adds a Pine script to a chart, it
executes <em>numerous</em> times, once for each available bar or tick in the
data feeds it accesses, as explained in this manual’s
<a href="/pine-script-docs/v5/language/execution-model/">Execution model</a>
page.</p>
<p>The Pine Script™ compiler automatically performs several internal
optimizations to accommodate scripts of various sizes and help them run
smoothly. However, such optimizations <em>do not</em> prevent performance
bottlenecks in script executions. As such, it’s up to programmers to
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">profile</a> a script’s runtime performance and identify ways to modify
critical code blocks and lines when they need to improve execution
times.</p>
<p>This page covers how to profile and monitor a script’s runtime and
executions with the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a> and explains some ways programmers can modify their code to
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#optimization">optimize</a> runtime performance.</p>
<p>For a quick introduction, see the following video, where we profile an example script and optimize it step-by-step, examining several common script inefficiencies and explaining how to avoid them along the way:</p>
<lite-youtube style="background-image: url('https://i.ytimg.com/vi/dQ7sbzWL0Dk/hqdefault.jpg');" videoid="dQ7sbzWL0Dk"> <a class="lty-playbtn" href="https://youtube.com/watch?v=dQ7sbzWL0Dk"> <span class="lyt-visually-hidden"></span> </a> </lite-youtube>
<h2 class="md-heading" id="pine-profiler"><a href="#pine-profiler">Pine Profiler<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Before diving into
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#optimization">optimization</a>, it’s prudent to evaluate a script’s runtime and pinpoint
<em>bottlenecks</em>, i.e., areas in the code that substantially impact overall
performance. With these insights, programmers can ensure they focus on
optimizing where it truly matters instead of spending time and effort on
low-impact code.</p>
<p>Enter the <em>Pine Profiler</em>, a powerful utility that analyzes the
executions of all significant code lines and blocks in a script and
displays helpful performance information next to the lines inside the
Pine Editor. By inspecting the Profiler’s results, programmers can gain
a clearer perspective on a script’s overall runtime, the distribution
of runtime across its significant code regions, and the critical
portions that may need extra attention and optimization.</p>
<h3 class="md-heading" id="profiling-a-script"><a href="#profiling-a-script">Profiling a script<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The Pine Profiler can analyze the runtime performance of any <em>editable</em>
script coded in Pine Script™ v5. To profile a script, add it to the
chart, open the source code in the Pine Editor, and select “Enable
profiler mode” from the dropdown next to the “Add to chart/Update on
chart” option in the top-right corner:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="286" loading="lazy" src="images/577af95bbb24fa34c0850e4b4c8ce9dc.webp" width="666"/></div></p>
<p>We will use the script below for our initial profiling example, which
calculates a custom <code dir="auto">oscillator</code> based on average distances from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price to upper and lower
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentile_linear_interpolation">percentiles</a>
over <code dir="auto">lengthInput</code> bars. It includes a few different types of
<em>significant</em> code regions, which come with some differences in
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">interpretation</a> while profiling:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pine Profiler demo")

//@variable The number of bars in the calculations.
int lengthInput = input.int(100, "Length", 2)
//@variable The percentage for upper percentile calculation.
float upperPercentInput = input.float(75.0, "Upper percentile", 50.0, 100.0)
//@variable The percentage for lower percentile calculation.
float lowerPercentInput = input.float(25.0, "Lower percentile", 0.0, 50.0)

// Calculate percentiles using the linear interpolation method.
float upperPercentile = ta.percentile_linear_interpolation(close, lengthInput, upperPercentInput)
float lowerPercentile = ta.percentile_linear_interpolation(close, lengthInput, lowerPercentInput)

// Declare arrays for upper and lower deviations from the percentiles on the same line.
var upperDistances = array.new&lt;float&gt;(lengthInput), var lowerDistances = array.new&lt;float&gt;(lengthInput)

// Queue distance values through the `upperDistances` and `lowerDistances` arrays based on excessive price deviations.
if math.abs(close - 0.5 * (upperPercentile + lowerPercentile)) &gt; 0.5 * (upperPercentile - lowerPercentile)
    array.push(upperDistances, math.max(close - upperPercentile, 0.0))
    array.shift(upperDistances)
    array.push(lowerDistances, math.max(lowerPercentile - close, 0.0))
    array.shift(lowerDistances)

//@variable The average distance from the `upperDistances` array.
float upperAvg = upperDistances.avg()
//@variable The average distance from the `lowerDistances` array.
float lowerAvg = lowerDistances.avg()
//@variable The ratio of the difference between the `upperAvg` and `lowerAvg` to their sum.
float oscillator = (upperAvg - lowerAvg) / (upperAvg + lowerAvg)
//@variable The color of the plot. A green-based gradient if `oscillator` is positive, a red-based gradient otherwise.
color oscColor = oscillator &gt; 0 ?
     color.from_gradient(oscillator, 0.0, 1.0, color.gray, color.green) :
     color.from_gradient(oscillator, -1.0, 0.0, color.red, color.gray)

// Plot the `oscillator` with the `oscColor`.
plot(oscillator, "Oscillator", oscColor, style = plot.style_area)</code></div>
<p>Once enabled, the Profiler collects information from all executions of
the script’s significant code lines and blocks, then displays bars and
approximate runtime percentages to the left of the code lines inside the
Pine Editor:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="670" loading="lazy" src="images/9e3182cdf295eb0c82ca6a3f810a411d.webp" width="1342"/></div></p>
<p>Note that:</p>
<ul>
<li>The Profiler tracks every execution of a significant code
region, including the executions on <em>realtime ticks</em>. Its
information updates over time as new executions occur.</li>
<li>Profiler results <strong>do not</strong> appear for script declaration
statements, type declarations, other <em>insignificant</em> code lines
such as variable declarations with no tangible impact, <em>unused
code</em> that the script’s outputs do not depend on, or
<em>repetitive code</em> that the compiler optimizes during
translation. See
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#insignificant-unused-and-redundant-code">this section</a> for more information.</li>
</ul>
<p>When a script contains at least <em>four</em> significant lines of code, the
Profiler will include “flame” icons next to the <em>top three</em> code
regions with the highest performance impact. If one or more of the
highest-impact code regions are <em>outside</em> the lines visible inside the
Pine Editor, a “flame” icon and a number indicating how many critical
lines are outside the view will appear at the top or bottom of the left
margin. Clicking the icon will vertically scroll the Editor’s window to
show the nearest critical line:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="346" loading="lazy" src="images/6ffdebe97a2e421c028ab49d83ce5b89.webp" width="1342"/></div></p>
<p>Hovering the mouse pointer over the space next to a line highlights the
analyzed code and exposes a tooltip with additional information,
including the time spent and the number of executions. The information
shown next to each line and in the corresponding tooltip depends on the
profiled code region. The
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">section below</a> explains different types of code the Profiler analyzes and
how to interpret their performance results.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="588" loading="lazy" src="images/052939cc039b9fbcf2eb588123e1ebb6.webp" width="1342"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span></p><p>As with profiling tools for other languages, the Pine Profiler <em>wraps</em> a
script and its significant code with
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#a-look-into-the-profilers-inner-workings">extra calculations</a> required to collect performance data. As such, a script’s
resource usage <strong>increases</strong> while profiling, and the Profiler’s
results reflect the script’s runtime with those calculations included.
Therefore, one should interpret the results as <strong>estimates</strong> rather than
precise performance measurements.</p><p>Furthermore, the Profiler cannot collect and display individual
performance data for the <em>internal calculations</em> that also affect
runtime, including the calculations required to track performance,
meaning the time values shown for all a script’s code regions <strong>will
not</strong> add up to exactly 100% of its overall runtime.</p><p></p></div></aside>
<h3 class="md-heading" id="interpreting-profiled-results"><a href="#interpreting-profiled-results">Interpreting profiled results<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<h4 class="md-heading" id="single-line-results"><a href="#single-line-results">Single-line results<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>For a code line containing single-line expressions, the Profiler bar and
displayed percentage represent the relative portion of the script’s
total runtime spent on that line. The corresponding tooltip displays
three fields:</p>
<ul>
<li>The “Line number” field indicates the analyzed code line.</li>
<li>The “Time” field shows the runtime percentage for the line of
code, the runtime spent on that line, and the script’s total
runtime.</li>
<li>The “Executions” field shows the number of times that specific
line executed while running the script.</li>
</ul>
<p>Here, we hovered the pointer over the space next to line 12 of our
profiled code to view its tooltip:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/90089262c5cffa13a9bd6003051d6498.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float upperPercentile = ta.percentile_linear_interpolation(close, lengthInput, upperPercentInput)</code></div>
<p>Note that:</p>
<ul>
<li>The time information for the line represents the time spent
completing <em>all</em> executions, <strong>not</strong> the time spent on a single
execution.</li>
<li>To estimate the <em>average</em> time spent per execution, divide the
line’s time by the number of executions. In this case, the
tooltip shows that line 12 took about 14.1 milliseconds to
execute 20,685 times, meaning the average time per execution was
approximately 14.1 ms / 20685 = 0.0006816534 milliseconds
(0.6816534 microseconds).</li>
</ul>
<p>When a line of code consists of more than one expression separated by
commas, the number of executions shown in the tooltip represents the
<em>sum</em> of each expression’s total executions, and the time value
displayed represents the total time spent evaluating all the line’s
expressions.</p>
<p>For instance, this global line from our initial example includes two
<a href="/pine-script-docs/v5/language/variable-declarations/">variable declarations</a> separated by commas. Each uses the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword, meaning the script only executes them once on the first
available bar. As we see in the Profiler tooltip for the line, it
counted <em>two</em> executions (one for each expression), and the time value
shown is the <em>combined</em> result from both expressions on the line:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/7026699f49eae06df6ae8a82d3645437.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">var upperDistances = array.new&lt;float&gt;(lengthInput), var lowerDistances = array.new&lt;float&gt;(lengthInput)</code></div>
<p>Note that:</p>
<ul>
<li>When analyzing scripts with more than one expression on the same
line, we recommend moving each expression to a <em>separate line</em>
for more detailed insights while profiling, namely if they may
contain <em>higher-impact</em> calculations.</li>
</ul>
<p>When using
<a href="/pine-script-docs/v5/writing/style-guide/#line-wrapping">line wrapping</a> for readability or stylistic purposes, the Profiler
considers all portions of a wrapped line as part of the <em>first line</em>
where it starts in the Pine Editor.</p>
<p>For example, although this code from our initial script occupies more
than one line in the Pine Editor, it’s still treated as a <em>single</em> line
of code, and the Profiler tooltip displays single-line results, with the
“Line number” field showing the <em>first</em> line in the Editor that the
wrapped line occupies:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/64d70a8394eaa00011ccd56a71b46f2c.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">color oscColor = oscillator &gt; 0 ?
     color.from_gradient(oscillator, 0.0, 1.0, color.gray, color.green) :
     color.from_gradient(oscillator, -1.0, 0.0, color.red, color.gray)</code></div>
<h4 class="md-heading" id="code-block-results"><a href="#code-block-results">Code block results<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>For a line at the start of a <a href="/pine-script-docs/v5/language/loops/">loop</a> or
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structure</a>, the Profiler bar and percentage represent the relative
portion of the script’s runtime spent on the <strong>entire code block</strong>, not
just the single line. The corresponding tooltip displays four fields:</p>
<ul>
<li>The “Code block range” field indicates the range of lines included
in the structure.</li>
<li>The “Time” field shows the code block’s runtime percentage, the
time spent on all block executions, and the script’s total runtime.</li>
<li>The “Line time” field shows the runtime percentage for the
block’s initial line, the time spent on that line, and the
script’s total runtime. The interpretation differs for
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
blocks or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
blocks <em>with</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">else
if</a>
statements, as the values represent the total time spent on <strong>all</strong>
the structure’s conditional statements. See below for more
information.</li>
<li>The “Executions” field shows the number of times the code block
executed while running the script.</li>
</ul>
<p>Here, we hovered over the space next to line 19 in our initial script,
the beginning of a simple
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure <em>without</em> <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">else
if</a>
statements. As we see below, the tooltip shows performance information
for the entire code block and the current line:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/c1708f33a3445ebd049e4abd59ed9ae5.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if math.abs(close - 0.5 * (upperPercentile + lowerPercentile)) &gt; 0.5 * (upperPercentile - lowerPercentile)
    array.push(upperDistances, math.max(close - upperPercentile, 0.0))
    array.shift(upperDistances)
    array.push(lowerDistances, math.max(lowerPercentile - close, 0.0))
    array.shift(lowerDistances)</code></div>
<p>Note that:</p>
<ul>
<li>The “Time” field shows that the total time spent evaluating
the structure 20,685 times was 7.2 milliseconds.</li>
<li>The “Line time” field indicates that the runtime spent on the
<em>first line</em> of this
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure was about three milliseconds.</li>
</ul>
<p>Users can also inspect the results from lines and nested blocks within a
code block’s range to gain more granular performance insights. Here, we
hovered over the space next to line 20 within the code block to view its
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#single-line-results">single-line result</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/86286b034ba14f574af01fe341e3d6c1.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>The number of executions shown is <em>less than</em> the result for the
entire code block, as the condition that controls the execution
of this line does not return <code dir="auto">true</code> all the time. The opposite
applies to the code inside <a href="/pine-script-docs/v5/language/loops/">loops</a> since each execution of a loop statement can trigger
<strong>several</strong> executions of the loop’s local block.</li>
</ul>
<p>When profiling a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure or an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure that includes <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">else
if</a>
statements, the “Line time” field will show the time spent executing
<strong>all</strong> the structure’s conditional expressions, <strong>not</strong> just the
block’s first line. The results for the lines inside the code block
range will show runtime and executions for each <strong>local block</strong>. This
format is necessary for these structures due to the Profiler’s
calculation and display constraints. See
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#a-look-into-the-profilers-inner-workings">this section</a> for more information.</p>
<p>For example, the “Line time” for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure in this script represents the time spent evaluating <em>all four</em>
conditional statements within its body, as the Profiler <em>cannot</em> track
them separately. The results for each line in the code block’s range
represent the performance information for each <em>local block</em>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/a256cb0e93ae54bff3ef8dfbd2e3e4d8.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`switch` and `if...else if` results demo")

//@variable The upper band for oscillator calculation.
var float upperBand = close
//@variable The lower band for oscillator calculation.
var float lowerBand = close

// Update the `upperBand` and `lowerBand` based on the proximity of the `close` to the current band values.
// The "Line time" field on line 11 represents the time spent on all 4 conditional expressions in the structure.
switch
    close &gt; upperBand                     =&gt; upperBand := close
    close &lt; lowerBand                     =&gt; lowerBand := close
    upperBand - close &gt; close - lowerBand =&gt; upperBand := 0.9 * upperBand + 0.1 * close
    close - lowerBand &gt; upperBand - close =&gt; lowerBand := 0.9 * lowerBand + 0.1 * close

//@variable The ratio of the difference between `close` and `lowerBand` to the band range.
float oscillator = 100.0 * (close - lowerBand) / (upperBand - lowerBand)

// Plot the `oscillator` as columns with a dynamic color.
plot(
     oscillator, "Oscillator", oscillator &gt; 50.0 ? color.teal : color.maroon,
     style = plot.style_columns, histbase = 50.0
 )</code></div>
<p>When the conditional logic in such structures involves significant
calculations, programmers may require more granular performance
information for each calculated condition. An effective way to achieve
this analysis is to use <em>nested</em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> blocks
instead of the more compact
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
or <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if…else
if</a>
structures. For example, instead of:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">switch
    &lt;expression1&gt; =&gt; &lt;localBlock1&gt;
    &lt;expression2&gt; =&gt; &lt;localBlock2&gt;
    =&gt;               &lt;localBlock3&gt;</code></div>
<p>or:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if &lt;expression1&gt;
    &lt;localBlock1&gt;
else if &lt;expression2&gt;
    &lt;localBlock2&gt;
else
    &lt;localBlock3&gt;</code></div>
<p>one can use nested
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> blocks
for more in-depth profiling while maintaining the same logical flow:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">if &lt;expression1&gt;
    &lt;localBlock1&gt;
else
    if &lt;expression2&gt;
        &lt;localBlock2&gt;
    else
        &lt;localBlock3&gt;</code></div>
<p>Below, we changed the previous
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
example to an equivalent nested
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure. Now, we can view the runtime and executions for each
significant part of the conditional pattern individually:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="338" loading="lazy" src="images/0a26913f781f5cbc8d55c12829ab894f.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`switch` and `if...else if` results demo")

//@variable The upper band for oscillator calculation.
var float upperBand = close
//@variable The lower band for oscillator calculation.
var float lowerBand = close

// Update the `upperBand` and `lowerBand` based on the proximity of the `close` to the current band values.
if close &gt; upperBand
    upperBand := close
else
    if close &lt; lowerBand
        lowerBand := close
    else
        if upperBand - close &gt; close - lowerBand
            upperBand := 0.9 * upperBand + 0.1 * close
        else
            if close - lowerBand &gt; upperBand - close
                lowerBand := 0.9 * lowerBand + 0.1 * close

//@variable The ratio of the difference between `close` and `lowerBand` to the band range.
float oscillator = 100.0 * (close - lowerBand) / (upperBand - lowerBand)

// Plot the `oscillator` as columns with a dynamic color.
plot(
     oscillator, "Oscillator", oscillator &gt; 50.0 ? color.teal : color.maroon,
     style = plot.style_columns, histbase = 50.0
 )</code></div>
<p>Note that:</p>
<ul>
<li>This same process can also apply to <a href="https://www.tradingview.com/pine-script-reference/v5/#op_?:">ternary
expressions</a>.
When a complex ternary expression’s operands contain
significant calculations, reorganizing the logic into a nested
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure allows more detailed Profiler results, making it
easier to spot critical parts.</li>
</ul>
<h4 class="md-heading" id="user-defined-function-calls"><a href="#user-defined-function-calls">User-defined function calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/user-defined-functions/">User-defined functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
are functions written by users. They encapsulate code sequences that a
script may execute several times. Users often write functions and
methods for improved code modularity, reusability, and maintainability.</p>
<p>The indented lines of code within a function represent its <em>local
scope</em>, i.e., the sequence that executes <em>each time</em> the script calls
it. Unlike code in a script’s global scope, which a script evaluates
once on each execution, the code inside a function may activate zero,
one, or <em>multiple times</em> on each script execution, depending on the
conditions that trigger the calls, the number of calls that occur, and
the function’s logic.</p>
<p>This distinction is crucial to consider while interpreting Profiler
results. When a profiled code contains
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
calls:</p>
<ul>
<li>The results for each <em>function call</em> reflect the runtime allocated
toward it and the total number of times the script activated that
specific call.</li>
<li>The time and execution information for all local code <em>inside</em> a
function’s scope reflects the combined results from <strong>all</strong> calls
to the function.</li>
</ul>
<p>This example contains a user-defined <code dir="auto">similarity()</code> function that
estimates the similarity of two series, which the script calls only
<em>once</em> from the global scope on each execution. In this case, the
Profiler’s results for the code inside the function’s body correspond
to that specific call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="328" loading="lazy" src="images/8b13967a4ce0aadbc2505e694636eacd.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("User-defined function calls demo")

//@function Estimates the similarity between two standardized series over `length` bars.
//          Each individual call to this function activates its local scope.
similarity(float sourceA, float sourceB, int length) =&gt;
    // Standardize `sourceA` and `sourceB` for comparison.
    float normA = (sourceA - ta.sma(sourceA, length)) / ta.stdev(sourceA, length)
    float normB = (sourceB - ta.sma(sourceB, length)) / ta.stdev(sourceB, length)
    // Calculate and return the estimated similarity of `normA` and `normB`.
    float abSum = math.sum(normA * normB, length)
    float a2Sum = math.sum(normA * normA, length)
    float b2Sum = math.sum(normB * normB, length)
    abSum / math.sqrt(a2Sum * b2Sum)

// Plot the similarity between the `close` and an offset `close` series.
plot(similarity(close, close[1], 100), "Similarity 1", color.red)</code></div>
<p>Let’s increase the number of times the script calls the function each
time it executes. Here, we changed the script to call our
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> <em>five times</em>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("User-defined function calls demo")

//@function Estimates the similarity between two standardized series over `length` bars.
//          Each individual call to this function activates its local scope.
similarity(float sourceA, float sourceB, int length) =&gt;
    // Standardize `sourceA` and `sourceB` for comparison.
    float normA = (sourceA - ta.sma(sourceA, length)) / ta.stdev(sourceA, length)
    float normB = (sourceB - ta.sma(sourceB, length)) / ta.stdev(sourceB, length)
    // Calculate and return the estimated similarity of `normA` and `normB`.
    float abSum = math.sum(normA * normB, length)
    float a2Sum = math.sum(normA * normA, length)
    float b2Sum = math.sum(normB * normB, length)
    abSum / math.sqrt(a2Sum * b2Sum)

// Plot the similarity between the `close` and several offset `close` series.
plot(similarity(close, close[1], 100), "Similarity 1", color.red)
plot(similarity(close, close[2], 100), "Similarity 2", color.orange)
plot(similarity(close, close[4], 100), "Similarity 3", color.green)
plot(similarity(close, close[8], 100), "Similarity 4", color.blue)
plot(similarity(close, close[16], 100), "Similarity 5", color.purple)</code></div>
<p>In this case, the local code results no longer correspond to a <em>single</em>
evaluation per script execution. Instead, they represent the <em>combined</em>
runtime and executions of the local code from <strong>all five</strong> calls. As we
see below, the results after running this version of the script across
the same data show 137,905 executions of the local code, <em>five times</em>
the number from when the script only contained one <code dir="auto">similarity()</code>
function call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="386" loading="lazy" src="images/cea65d425e07d679253eb55118695b36.webp" width="1072"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>When the local scopes of a script’s
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
contain calls to <code dir="auto">request.*()</code> functions, the <em>translated form</em> of the
script extracts such calls <strong>outside</strong> the functions’ scopes and
evaluates them <strong>separately</strong>. Consequently, the Profiler’s results for
lines with calls to those
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> <strong>will not</strong> include the time spent on the <code dir="auto">request.*()</code>
calls. See the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#when-requesting-other-contexts">section below</a> to learn more.</p></div></aside>
<h4 class="md-heading" id="when-requesting-other-contexts"><a href="#when-requesting-other-contexts">When requesting other contexts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Pine scripts can request data from other <em>contexts</em>, i.e., different
symbols, timeframes, or data modifications than what the chart’s data
uses by calling the <code dir="auto">request.*()</code> family of functions or specifying an
alternate <code dir="auto">timeframe</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
declaration statement.</p>
<p>When a script requests data from another context, it evaluates all
required scopes and calculations within that context, as explained in
the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page. This behavior can affect the runtime of a script’s
code regions and the number of times they execute.</p>
<p>The Profiler information for any code
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#single-line-results">line</a> or
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">block</a> represents the results from executing the code in <em>all
necessary contexts</em>, which may or may not include the chart’s data.
Pine Script™ determines which contexts to execute code within based on
the calculations required by a script’s data requests and outputs.</p>
<p>Let’s look at a simple example. This initial script only uses the
chart’s data for its calculations. It declares a <code dir="auto">pricesArray</code> variable
with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keyword, meaning the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
assigned to it persists across the data’s history and all available
realtime ticks. On each execution, the script calls
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
to push a new
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
value into the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
and it <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array’s
size</a>.</p>
<p>After profiling the script across all the bars on an intraday chart, we
see that the number of elements in the <code dir="auto">pricesArray</code> corresponds to the
number of executions the Profiler shows for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
call on line 8:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="384" loading="lazy" src="images/109b9efc5da8ad4477b25078758b8efc.webp" width="1250"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("When requesting other contexts demo")

//@variable An array containing the `close` value from every available price update.
varip array&lt;float&gt; pricesArray = array.new&lt;float&gt;()

// Push a new `close` value into the `pricesArray` on each update.
array.push(pricesArray, close)

// Plot the size of the `pricesArray`.
plot(array.size(pricesArray), "Total number of chart price updates")</code></div>
<p>Now, let’s try evaluating the size of the <code dir="auto">pricesArray</code> from <em>another
context</em> instead of using the chart’s data. Below, we’ve added a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size(pricesArray)</a>
as its <code dir="auto">expression</code> argument to retrieve the value calculated on the
“1D” timeframe and plotted that result instead.</p>
<p>In this case, the number of executions the Profiler shows on line 8
still corresponds to the number of elements in the <code dir="auto">pricesArray</code>.
However, it did not execute the same number of times since the script
did not require the <em>chart’s data</em> in the calculations. It only needed
to initialize the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
and evaluate
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
across all the requested <em>daily data</em>, which has a different number of
price updates than our current intraday chart:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="384" loading="lazy" src="images/bd33154587e82066613825b972820a1d.webp" width="1250"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("When requesting other contexts demo")

//@variable An array containing the `close` value from every available price update.
varip array&lt;float&gt; pricesArray = array.new&lt;float&gt;()

// Push a new `close` value into the `pricesArray` on each update.
array.push(pricesArray, close)

// Plot the size of the `pricesArray` requested from the daily timeframe.
plot(request.security(syminfo.tickerid, "1D", array.size(pricesArray)), "Total number of daily price updates")</code></div>
<p>Note that:</p>
<ul>
<li>The requested EOD data in this example had fewer data points
than our intraday chart, so the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
call required fewer executions in this case. However, EOD feeds
<em>do not</em> have history limitations, meaning it’s also possible
for requested HTF data to span <strong>more</strong> bars than a user’s
chart, depending on the timeframe, the data provider, and the
user’s <a href="https://www.tradingview.com/pricing/">plan</a>.</li>
</ul>
<p>If this script were to plot the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.size">array.size()</a>
value directly in addition to the requested daily value, it would then
require the creation of <em>two</em> <a href="/pine-script-docs/v5/language/arrays/">arrays</a> (one for each context) and the execution of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
across both the chart’s data <em>and</em> the data from the daily timeframe.
As such, the declaration on line 5 will execute <em>twice</em>, and the results
on line 8 will reflect the time and executions accumulated from
evaluating the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a>
call across <strong>both separate datasets</strong>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="384" loading="lazy" src="images/a220cf16654bf399ebcc7a0733b396bc.webp" width="1250"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("When requesting other contexts demo")

//@variable An array containing the `close` value from every available price update.
varip array&lt;float&gt; pricesArray = array.new&lt;float&gt;()

// Push a new `close` value into the `pricesArray` on each update.
array.push(pricesArray, close)

// Plot the size of the `pricesArray` from the daily timeframe and the chart's context.
// Including both in the outputs requires executing line 5 and line 8 across BOTH datasets.  
plot(request.security(syminfo.tickerid, "1D", array.size(pricesArray)), "Total number of daily price updates")
plot(array.size(pricesArray), "Total number of chart price updates")</code></div>
<p>It’s important to note that when a script calls a
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
that contains <code dir="auto">request.*()</code> calls in its local scope, the script’s
<em>translated form</em> extracts the <code dir="auto">request.*()</code> calls <strong>outside</strong> the scope
and encapsulates the expressions they depend on within <strong>separate
functions</strong>. When the script executes, it evaluates the required
<code dir="auto">request.*()</code> calls first, then <em>passes</em> the requested data to a
<em>modified form</em> of the
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a>.</p>
<p>Since the translated script executes a
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function’s</a> data requests separately <strong>before</strong> evaluating non-requested
calculations in its local scope, the Profiler’s results for lines
containing calls to the function <strong>will not</strong> include the time spent on
its <code dir="auto">request.*()</code> calls or their required expressions.</p>
<p>As an example, the following script contains a user-defined
<code dir="auto">getCompositeAvg()</code> function with a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call that requests the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.avg">math.avg()</a>
of 10
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.wma">ta.wma()</a>
calls with different <code dir="auto">length</code> arguments from a specified <code dir="auto">symbol</code>. The
script uses the function to request the average result using a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ticker.heikinashi">Heikin
Ashi</a>
ticker ID:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("User-defined functions with `request.*()` calls demo", overlay = true)

int multInput = input.int(10, "Length multiplier", 1)

string tickerID = ticker.heikinashi(syminfo.tickerid)

getCompositeAvg(string symbol, int lengthMult) =&gt;
    request.security(
         symbol, timeframe.period, math.avg(
             ta.wma(close, lengthMult), ta.wma(close, 2 * lengthMult), ta.wma(close, 3 * lengthMult), 
             ta.wma(close, 4 * lengthMult), ta.wma(close, 5 * lengthMult), ta.wma(close, 6 * lengthMult),
             ta.wma(close, 7 * lengthMult), ta.wma(close, 8 * lengthMult), ta.wma(close, 9 * lengthMult), 
             ta.wma(close, 10 * lengthMult)
         )
     )

plot(getCompositeAvg(tickerID, multInput), "Composite average", linewidth = 3)</code></div>
<p>After profiling the script, users might be surprised to see that the
runtime results shown inside the function’s body heavily <strong>exceed</strong> the
results shown for the <em>single</em> <code dir="auto">getCompositeAvg()</code> call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="342" loading="lazy" src="images/fef8b72dfd7a9da06d838eadacba4286.webp" width="1072"/></div></p>
<p>The results appear this way since the translated script includes
internal modifications that <em>moved</em> the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call and its expression <strong>outside</strong> the function’s scope, and the
Profiler has no way to represent the results from those calculations
other than displaying them next to the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
line in this scenario. The code below roughly illustrates how the
translated script looks:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("User-defined functions with `request.*()` calls demo", overlay = true)

int multInput = input.int(10, "Length multiplier")

string tickerID = ticker.heikinashi(syminfo.tickerid)

secExpr(int lengthMult)=&gt;
    math.avg(
         ta.wma(close, lengthMult), ta.wma(close, 2 * lengthMult), ta.wma(close, 3 * lengthMult),
         ta.wma(close, 4 * lengthMult), ta.wma(close, 5 * lengthMult), ta.wma(close, 6 * lengthMult),
         ta.wma(close, 7 * lengthMult), ta.wma(close, 8 * lengthMult), ta.wma(close, 9 * lengthMult),
         ta.wma(close, 10 * lengthMult)
     )

float sec = request.security(tickerID, timeframe.period, secExpr(multInput))

getCompositeAvg(float s) =&gt;
    s

plot(getCompositeAvg(sec), "Composite average", linewidth = 3)</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">secExpr()</code> code represents the <em>separate function</em> used by
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to calculate the required expression in the requested context.</li>
<li>The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call takes place in the <strong>outer scope</strong>, outside the
<code dir="auto">getCompositeAvg()</code> function.</li>
<li>The translation substantially reduced the local code of
<code dir="auto">getCompositeAvg()</code>. It now solely returns a value passed into
it, as all the function’s required calculations take place
<strong>outside</strong> its scope. Due to this reduction, the function
call’s performance results <strong>will not</strong> reflect any of the time
spent on the data request’s required calculations.</li>
</ul>
<h4 class="md-heading" id="insignificant-unused-and-redundant-code"><a href="#insignificant-unused-and-redundant-code">Insignificant, unused, and redundant code<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When inspecting a profiled script’s results, it’s crucial to
understand that <em>not all</em> code in a script necessarily impacts runtime
performance. Some code has no direct performance impact, such as a
script’s declaration statement and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a>
declarations. Other code regions with insignificant expressions, such as
most <code dir="auto">input.*()</code> calls, variable references, or
<a href="/pine-script-docs/v5/language/variable-declarations/">variable declarations</a> without significant calculations, have little to <em>no effect</em>
on a script’s runtime. Therefore, the Profiler will <strong>not</strong> display
performance results for these types of code.</p>
<p>Additionally, Pine scripts do not execute code regions that their
<em>outputs</em> (<a href="/pine-script-docs/v5/concepts/plots/">plots</a>,
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawings</a>,
<a href="/pine-script-docs/v5/writing/debugging/#pine-logs">logs</a>, etc.) do
not depend on, as the compiler automatically <strong>removes</strong> them during
translation. Since unused code regions have <em>zero</em> impact on a script’s
performance, the Profiler will <strong>not</strong> display any results for them.</p>
<p>The following example contains a <code dir="auto">barsInRange</code> variable and a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
that adds 1 to the variable’s value for each historical
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price between the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>
over <code dir="auto">lengthInput</code> bars. However, the script <strong>does not use</strong> these
calculations in its outputs, as it only
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price. Consequently, the script’s compiled form <strong>discards</strong> that
unused code and only considers the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot(close)</a>
call.</p>
<p>The Profiler does not display <strong>any</strong> results for this script since it
does not execute any <strong>significant</strong> calculations:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="350" loading="lazy" src="images/8c7e4336f5825492653b48d3361be4ce.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Unused code demo")

//@variable The number of historical bars in the calculation.
int lengthInput = input.int(100, "Length", 1)

//@variable The number of closes over `lengthInput` bars between the current bar's `high` and `low`.
int barsInRange = 0

for i = 1 to lengthInput
    //@variable The `close` price from `i` bars ago.
    float pastClose = close[i]
    // Add 1 to `barsInRange` if the `pastClose` is between the current bar's `high` and `low`.
    if pastClose &gt; low and pastClose &lt; high
        barsInRange += 1

// Plot the `close` price. This is the only output. 
// Since the outputs do not require any of the above calculations, the compiled script will not execute them.
plot(close)</code></div>
<p>Note that:</p>
<ul>
<li>Although this script does not use the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
from line 5 and discards all its associated calculations, the
“Length” input <em>will</em> still appear in the script’s settings,
as the compiler <strong>does not</strong> completely remove unused
<a href="/pine-script-docs/v5/concepts/inputs/">inputs</a>.</li>
</ul>
<p>If we change the script to plot the <code dir="auto">barsInRange</code> value instead, the
declared variables and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
are no longer unused since the output depends on them, and the Profiler
will now display performance information for that code:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="334" loading="lazy" src="images/542ac76bd64d78745211b725ea05f504.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Unused code demo")

//@variable The number of historical bars in the calculation.
int lengthInput = input.int(100, "Length", 1)

//@variable The number of closes over `lengthInput` bars between the current bar's `high` and `low`.
int barsInRange = 0

for i = 1 to lengthInput
    //@variable The `close` price from `i` bars ago.
    float pastClose = close[i]
    // Add 1 to `barsInRange` if the `pastClose` is between the current bar's `high` and `low`.
    if pastClose &gt; low and pastClose &lt; high
        barsInRange += 1

// Plot the `barsInRange` value. The above calculations will execute since the output requires them.
plot(barsInRange, "Bars in range")</code></div>
<p>Note that:</p>
<ul>
<li>The Profiler does not show performance information for the
<code dir="auto">lengthInput</code> declaration on line 5 or the <code dir="auto">barsInRange</code>
declaration on line 8 since the expressions on these lines do
not impact the script’s performance.</li>
</ul>
<p>When possible, the compiler also simplifies certain instances of
<em>redundant code</em> in a script, such as some forms of identical
expressions with the same
<a href="/pine-script-docs/v5/language/type-system/#types">fundamental type</a>
values. This optimization allows the compiled script to only execute
such calculations <em>once</em>, on the first occurrence, and <em>reuse</em> the
calculated result for each repeated instance that the outputs depend on.</p>
<p>If a script contains repetitive code and the compiler simplifies it, the
Profiler will only show results for the <strong>first occurrence</strong> of the code
since that’s the only time the script requires the calculation.</p>
<p>For example, this script contains a code line that plots the value of
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(close,
100)</a>
and 12 code lines that plot the value of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(close,
500)</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Redundant calculations demo", overlay = true)

// Plot the 100-bar SMA of `close` values one time.
plot(ta.sma(close, 100), "100-bar SMA", color.teal, 3)

// Plot the 500-bar SMA of `close` values 12 times. After compiler optimizations, only the first `ta.sma(close, 500)`
// call on line 9 requires calculation in this case.
plot(ta.sma(close, 500), "500-bar SMA", #001aff, 12)
plot(ta.sma(close, 500), "500-bar SMA", #4d0bff, 11)
plot(ta.sma(close, 500), "500-bar SMA", #7306f7, 10)
plot(ta.sma(close, 500), "500-bar SMA", #920be9, 9)
plot(ta.sma(close, 500), "500-bar SMA", #ae11d5, 8)
plot(ta.sma(close, 500), "500-bar SMA", #c618be, 7)
plot(ta.sma(close, 500), "500-bar SMA", #db20a4, 6)
plot(ta.sma(close, 500), "500-bar SMA", #eb2c8a, 5)
plot(ta.sma(close, 500), "500-bar SMA", #f73d6f, 4)
plot(ta.sma(close, 500), "500-bar SMA", #fe5053, 3)
plot(ta.sma(close, 500), "500-bar SMA", #ff6534, 2)
plot(ta.sma(close, 500), "500-bar SMA", #ff7a00, 1)</code></div>
<p>Since the last 12 lines all contain identical
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
calls, the compiler can automatically simplify the script so that it
only needs to evaluate <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(close,
500)</a>
<em>once</em> per execution rather than repeating the calculation 11 more
times.</p>
<p>As we see below, the Profiler only shows results for lines 5 and 9.
These are the only parts of the code requiring significant calculations
since the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma()</a>
calls on lines 10-20 are redundant in this case:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="368" loading="lazy" src="images/9f242e9342d56c438e42f94fc9fbbaa1.webp" width="1072"/></div></p>
<p>Another type of repetitive code optimization occurs when a script
contains two or more
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> or
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>
with identical compiled forms. In such a case, the compiler simplifies
the script by <strong>removing</strong> the redundant functions, and the script will
treat all calls to the redundant functions as calls to the <strong>first</strong>
defined version. Therefore, the Profiler will only show local code
performance results for the <em>first</em> function since the discarded
“clones” will never execute.</p>
<p>For instance, the script below contains two
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a>, <code dir="auto">metallicRatio()</code> and <code dir="auto">calcMetallic()</code>, that calculate a
<a href="https://en.wikipedia.org/wiki/Metallic_mean" rel="nofollow">metallic ratio</a> of a given
order raised to a specified exponent:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Redundant functions demo")

//@variable Controls the base ratio for the `calcMetallic()` call.
int order1Input = input.int(1, "Order 1", 1)
//@variable Controls the base ratio for the `metallicRatio()` call.
int order2Input = input.int(2, "Order 2", 1)

//@function       Calculates the value of a metallic ratio with a given `order`, raised to a specified `exponent`.
//@param order    Determines the base ratio used. 1 = Golden Ratio, 2 = Silver Ratio, 3 = Bronze Ratio, and so on.
//@param exponent The exponent applied to the ratio.
metallicRatio(int order, float exponent) =&gt;
    math.pow((order + math.sqrt(4.0 + order * order)) * 0.5, exponent)

//@function       A function with the same signature and body as `metallicRatio()`.
//                The script discards this function and treats `calcMetallic()` as an alias for `metallicRatio()`.
calcMetallic(int ord, float exp) =&gt;
    math.pow((ord + math.sqrt(4.0 + ord * ord)) * 0.5, exp)

// Plot the results from a `calcMetallic()` and `metallicRatio()` call.
plot(calcMetallic(order1Input, bar_index % 5), "Ratio 1", color.orange, 3)
plot(metallicRatio(order2Input, bar_index % 5), "Ratio 2", color.maroon)</code></div>
<p>Despite the differences in the function and parameter names, the two
functions are otherwise identical, which the compiler detects while
translating the script. In this case, it <strong>discards</strong> the redundant
<code dir="auto">calcMetallic()</code> function, and the compiled script treats the
<code dir="auto">calcMetallic()</code> call as a <code dir="auto">metallicRatio()</code> call.</p>
<p>As we see here, the Profiler shows performance information for the
<code dir="auto">calcMetallic()</code> and <code dir="auto">metallicRatio()</code> calls on lines 21 and 22, but it
does <strong>not</strong> show any results for the local code of the <code dir="auto">calcMetallic()</code>
function on line 18. Instead, the Profiler’s information on line 13
within the <code dir="auto">metallicRatio()</code> function reflects the local code results
from <strong>both</strong>
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#user-defined-function-calls">function calls</a>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="416" loading="lazy" src="images/c93744f9037ec6691f8be3eff1cdb109.webp" width="1072"/></div></p>
<h3 class="md-heading" id="a-look-into-the-profilers-inner-workings"><a href="#a-look-into-the-profilers-inner-workings">A look into the Profiler’s inner workings<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The Pine Profiler wraps all necessary code regions with specialized
<em>internal functions</em> to track and collect required information across
script executions. It then passes the information to additional
calculations that organize and display the performance results inside
the Pine Editor. This section gives users a peek into how the Profiler
applies internal functions to wrap Pine code and collect performance
data.</p>
<p>There are two main internal <strong>(non-Pine)</strong> functions the Profiler wraps
significant code with to facilitate runtime analysis. The first function
retrieves the current system time at specific points in the script’s
execution, and the second maps cumulative elapsed time and execution
data to specific code regions. We represent these functions in this
explanation as <code dir="auto">System.timeNow()</code> and <code dir="auto">registerPerf()</code> respectively.</p>
<p>When the Profiler detects code that requires analysis, it adds
<code dir="auto">System.timeNow()</code> above the code to get the initial time before
execution. Then, it adds <code dir="auto">registerPerf()</code> below the code to map and
accumulate the elapsed time and number of executions. The elapsed time
added on each <code dir="auto">registerPerf()</code> call is the <code dir="auto">System.timeNow()</code> value
<em>after</em> the execution minus the value <em>before</em> the execution.</p>
<p>The following <em>pseudocode</em> outlines this process for a
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#single-line-results">single line</a> of code, where <code dir="auto">_startX</code> represents the starting time for
the <code dir="auto">lineX</code> line:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">long _startX = System.timeNow()
&lt;code_line_to_analyze&gt;
registerPerf(System.timeNow() - _startX, lineX)</code></div>
<p>The process is similar for
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">code blocks</a>. The difference is that the <code dir="auto">registerPerf()</code> call maps the
data to a <em>range of lines</em> rather than a single line. Here, <code dir="auto">lineX</code>
represents the <em>first</em> line in the code block, and <code dir="auto">lineY</code> represents
the block’s <em>last</em> line:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">long _startX = System.timeNow()
&lt;code_block_to_analyze&gt;
registerPerf(System.timeNow() - _startX, lineX, lineY)</code></div>
<p>Note that:</p>
<ul>
<li>In the above snippets, <code dir="auto">long</code>, <code dir="auto">System.timeNow()</code>, and
<code dir="auto">registerPerf()</code> represent <em>internal code</em>, <strong>not</strong> Pine Script™
code.</li>
</ul>
<p>Let’s now look at how the Profiler wraps a full script and all its
significant code. We will start with this script, which calculates three
pseudorandom series and displays their
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.avg">average</a>
result. The script utilizes an <a href="/pine-script-docs/v5/language/objects/">object</a> of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> to store a pseudorandom state, a
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
to calculate new values and update the state, and an <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if…else
if</a>
structure to update each series based on generated values:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Profiler's inner workings demo")

int seedInput = input.int(12345, "Seed")

type LCG
    float state

method generate(LCG this, int generations = 1) =&gt;
    float result = 0.0
    for i = 1 to generations
        this.state := 16807 * this.state % 2147483647
        result += this.state / 2147483647
    result / generations

var lcg = LCG.new(seedInput)

var float val0 = 1.0
var float val1 = 1.0
var float val2 = 1.0

if lcg.generate(10) &lt; 0.5
    val0 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
else if lcg.generate(10) &lt; 0.5
    val1 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
else if lcg.generate(10) &lt; 0.5
    val2 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1

plot(math.avg(val0, val1, val2), "Average pseudorandom result", color.purple)</code></div>
<p>The Profiler will wrap the entire script and all necessary code regions,
excluding any
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#insignificant-unused-and-redundant-code">insignificant, unused, or redundant code</a>, with the aforementioned <strong>internal</strong> functions to collect
performance data. The <em>pseudocode</em> below demonstrates how this process
applies to the above script:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">long _startMain = System.timeNow() // Start time for the script's overall execution.

// &lt;Additional internal code executes here&gt;

//@version=5
indicator("Profiler's inner workings demo") // Declaration statements do not require profiling.

int seedInput = input.int(12345, "Seed") // Variable declaration without significant calculation.

type LCG        // Type declarations do not require profiling.
    float state

method generate(LCG this, int generations = 1) =&gt; // Function signature does not affect runtime.
    float result = 0.0 // Variable declaration without significant calculation.

    long _start11 = System.timeNow() // Start time for the loop block that begins on line 11.
    for i = 1 to generations // Loop header calculations are not independently wrapped.

        long _start12 = System.timeNow() // Start time for line 12.
        this.state := 16807 * this.state % 2147483647
        registerPerf(System.timeNow() - _start12, line12) // Register performance info for line 12.

        long _start13 = System.timeNow() // Start time for line 13.
        result += this.state / 2147483647
        registerPerf(System.timeNow() - _start13, line13) // Register performance info for line 13.

    registerPerf(System.timeNow() - _start11, line11, line13) // Register performance info for the block (line 11 - 13).    

    long _start14 = System.timeNow() // Start time for line 14.
    result / generations
    registerPerf(System.timeNow() - _start14, line14) // Register performance info for line 14.

long _start16 = System.timeNow() // Start time for line 16.
var lcg = LCG.new(seedInput)
registerPerf(System.timeNow() - _start16, line16) // Register performance info for line 16.

var float val0 = 1.0 // Variable declarations without significant calculations.
var float val1 = 1.0
var float val2 = 1.0

long _start22 = System.timeNow() // Start time for the `if` block that begins on line 22.
if lcg.generate(10) &lt; 0.5 // `if` statement is not independently wrapped.

    long _start23 = System.timeNow() // Start time for line 23.
    val0 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start23, line23) // Register performance info for line 23.

else if lcg.generate(10) &lt; 0.5 // `else if` statement is not independently wrapped.

    long _start25 = System.timeNow() // Start time for line 25.
    val1 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start25, line25) // Register performance info for line 25.

else if lcg.generate(10) &lt; 0.5 // `else if` statement is not independently wrapped.

    long _start27 = System.timeNow() // Start time for line 27.
    val2 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start27, line27) // Register performance info for line 27.

registerPerf(System.timeNow() - _start22, line22, line28) // Register performance info for the block (line 22 - 28).

long _start29 = System.timeNow() // Start time for line 29.
plot(math.avg(val0, val1, val2), "Average pseudorandom result", color.purple)
registerPerf(System.timeNow() - _start29, line29) // Register performance info for line 29.

// &lt;Additional internal code executes here&gt;

registerPerf(System.timeNow() - _startMain, total) // Register the script's overall performance info.</code></div>
<p>Note that:</p>
<ul>
<li>This example is <strong>pseudocode</strong> that provides a basic outline of
the <strong>internal calculations</strong> the Profiler applies to collect
performance data. Saving this example in the Pine Editor will
result in a compilation error since <code dir="auto">long</code>, <code dir="auto">System.timeNow()</code>,
and <code dir="auto">registerPerf()</code> <strong>do not</strong> represent Pine Script™ code.</li>
<li>These internal calculations that the Profiler wraps a script
with require <strong>additional</strong> computational resources, which is
why a script’s runtime <strong>increases</strong> while profiling.
Programmers should always interpret the results as <strong>estimates</strong>
since they reflect a script’s performance with the extra
calculations included.</li>
</ul>
<p>After running the wrapped script to collect performance data,
<em>additional</em> internal calculations organize the results and display
relevant information inside the Pine Editor:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="526" loading="lazy" src="images/01909611318a23af6b234e897e33e8d8.webp" width="1072"/></div></p>
<p>The <em>“Line time”</em> calculation for
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">code blocks</a> also occurs at this stage, as the Profiler cannot
individually wrap <a href="/pine-script-docs/v5/language/loops/">loop</a>
headers or the conditional statements in
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structures. This field’s value represents the <em>difference</em> between a
block’s total time and the sum of its local code times, which is why
the “Line time” value for a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
block or an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> block
with <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">else
if</a>
expressions represents the time spent on <strong>all</strong> the structure’s
conditional statements, not just the block’s <em>initial line</em> of code. If
a programmer requires more granular information for each conditional
expression in such a block, they can reorganize the logic into a
<em>nested</em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure, as explained
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">here</a>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The Profiler <strong>cannot</strong> collect individual performance data for any
required <em>internal</em> calculations and display their results inside the
Pine Editor. Consequently, the time values the Profiler displays for all
code regions in a script <strong>will not</strong> add up to 100% of its total
runtime.</p></div></aside>
<h3 class="md-heading" id="profiling-across-configurations"><a href="#profiling-across-configurations">Profiling across configurations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a code’s <a href="https://en.wikipedia.org/wiki/Time_complexity" rel="nofollow">time
complexity</a> is not
constant or its execution pattern varies with its inputs, function
arguments, or available data, it’s often wise to profile the code
across <em>different configurations</em> and data feeds for a more well-rounded
perspective on its general performance.</p>
<p>For example, this simple script uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
to calculate the sum of squared distances between the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price and <code dir="auto">lengthInput</code> previous prices, then plots the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sqrt">square
root</a>
of that sum on each bar. In this case, the <code dir="auto">lengthInput</code> directly
impacts the calculation’s runtime since it determines the number of
times the loop executes its local code:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Profiling across configurations demo")

//@variable The number of previous bars in the calculation. Directly affects the number of loop iterations.
int lengthInput = input.int(25, "Length", 1)

//@variable The sum of squared distances from the current `close` to `lengthInput` past `close` values.
float total = 0.0

// Look back across `lengthInput` bars and accumulate squared distances.
for i = 1 to lengthInput
    float distance = close - close[i]
    total += distance * distance

// Plot the square root of the `total`.
plot(math.sqrt(total))</code></div>
<p>Let’s try profiling this script with different <code dir="auto">lengthInput</code> values.
First, we’ll use the default value of 25. The Profiler’s results for
this specific run show that the script completed 20,685 executions in
about 96.7 milliseconds:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/52ae45bf072c8b4ac20fff74560e82dc.webp" width="1072"/></div></p>
<p>Here, we’ve increased the input’s value to 50 in the script’s
settings. The results for this run show that the script’s total runtime
was 194.3 milliseconds, close to <em>twice</em> the time from the previous run:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/9ced81b4e824abca9dab83379676068b.webp" width="1072"/></div></p>
<p>In the next run, we changed the input’s value to 200. This time, the
Profiler’s results show that the script finished all executions in
approximately 0.8 seconds, around <em>four times</em> the previous run’s time:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/c76f5359e317698382c5324fc5d39bff.webp" width="1072"/></div></p>
<p>We can see from these observations that the script’s runtime appears to
scale <em>linearly</em> with the <code dir="auto">lengthInput</code> value, excluding other factors
that may affect performance, as one might expect since the bulk of the
script’s calculations occur within the loop and the input’s value
controls how many times the loop must execute.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>It’s often wise to profile each configuration <em>more than once</em> to
reduce the impact of outliers while assessing how a script’s
performance varies with its inputs or data. See the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#repetitive-profiling">section below</a> for more information.</p></div></aside>
<h3 class="md-heading" id="repetitive-profiling"><a href="#repetitive-profiling">Repetitive profiling<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The runtime resources available to a script <em>vary</em> over time.
Consequently, the time it takes to evaluate a code region, even one with
constant <a href="https://en.wikipedia.org/wiki/Time_complexity" rel="nofollow">complexity</a>,
<em>fluctuates</em> across executions, and the cumulative performance results
shown by the Profiler <strong>will vary</strong> with each independent script run.</p>
<p>Users can enhance their analysis by <em>restarting</em> a script several times
and profiling each independent run. Averaging the results from each
profiled run and evaluating the dispersion of runtime results can help
users establish more robust performance benchmarks and reduce the impact
of <em>outliers</em> (abnormally long or short runtimes) in their conclusions.</p>
<p>Incorporating a <em>dummy input</em> (i.e., an input that does nothing) into a
script’s code is a simple technique that enables users to <em>restart</em> it
while profiling. The input will not directly affect any calculations or
outputs. However, as the user changes its value in the script’s
settings, the script restarts and the Profiler re-analyzes the executed
code.</p>
<p>For example, this script
<a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queues</a> pseudorandom values with a constant seed through an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
with a fixed size, and it calculates and plots the array’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">average</a>
value on each bar. For profiling purposes, the script includes a
<code dir="auto">dummyInput</code> variable with an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.int">input.int()</a>
value assigned to it. The input does nothing in the code aside from
allowing us to <em>restart</em> the script each time we change its value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Repetitive profiling demo")

//@variable An input not connected to script calculations. Changing its value in the "Inputs" tab restarts the script.
int dummyInput = input.int(0, "Dummy input")

//@variable An array of pseudorandom values.
var array&lt;float&gt; randValues = array.new&lt;float&gt;(2500, 0.0)

// Push a new `math.random()` value with a fixed `seed` into the `randValues` array and remove the oldest value.
array.push(randValues, math.random(seed = 12345))
array.shift(randValues)

// Plot the average of all elements in the `randValues` array.
plot(array.avg(randValues), "Pseudorandom average")</code></div>
<p>After the first script run, the Profiler shows that it took 308.6
milliseconds to execute across all of the chart’s data:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/dd169b360de129efc64b1da1a456fee8.webp" width="1072"/></div></p>
<p>Now, let’s change the dummy input’s value in the script’s settings to
restart it without changing the calculations. This time, it completed
the same code executions in 424.6 milliseconds, 116 milliseconds longer
than the previous run:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/eae70045c2c77228e931e57607f65b7d.webp" width="1072"/></div></p>
<p>Restarting the script again yields another new result. On the third run,
the script finished all code executions in 227.4 milliseconds, the
shortest time so far:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/3555826b9fb80dcc67eb35ad3625e225.webp" width="1072"/></div></p>
<p>After repeating this process several times and documenting the results
from each run, one can manually calculate their <em>average</em> to estimate
the script’s expected total runtime:</p>
<p><code dir="auto">AverageTime = (time1 + time2 + ... + timeN) / N</code></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Whether profiling a script over a single run or multiple, it’s crucial
to understand that <strong>results will vary</strong>. While averaging results across
several profiled script runs can help derive more stable performance
estimates, such estimates are <strong>not</strong> impervious to variance.</p></div></aside>
<h2 class="md-heading" id="optimization"><a href="#optimization">Optimization<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><em>Code optimization</em>, not to be confused with indicator or strategy
optimization, involves modifying a script’s source code for improved
execution time, resource efficiency, and scalability. Programmers may
use various approaches to optimize a script when they need enhanced
runtime performance, depending on what a script’s calculations entail.</p>
<p>Fundamentally, most techniques one will use to optimize Pine code
involve <em>reducing</em> the number of times critical calculations occur or
<em>replacing</em> significant calculations with simplified formulas or
built-ins. Both of these paradigms often overlap.</p>
<p>The following sections explain several straightforward concepts
programmers can apply to optimize their Pine Script™ code.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Before looking for ways to optimize a script,
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profile it</a> to gauge its performance and identify the <strong>critical code
regions</strong> that will benefit the most from optimization.</p></div></aside>
<h3 class="md-heading" id="using-built-ins"><a href="#using-built-ins">Using built-ins<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™ features a variety of <em>built-in</em> functions and variables
that help streamline script creation. Many of Pine’s built-ins feature
internal optimizations to help maximize efficiency and minimize
execution time. As such, one of the simplest ways to optimize Pine code
is to utilize these efficient built-ins in a script’s calculations when
possible.</p>
<p>Let’s look at an example where one can replace user-defined
calculations with a concise built-in call to substantially improve
performance. Suppose a programmer wants to calculate the highest value
of a series over a specified number of bars. Someone not familiar with
all of Pine’s built-ins might approach the task using a code like the
following, which uses a <a href="/pine-script-docs/v5/language/loops/">loop</a>
on each bar to compare <code dir="auto">length</code> historical values of a <code dir="auto">source</code> series:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable A user-defined function to calculate the highest `source` value over `length` bars.
pineHighest(float source, int length) =&gt;
    float result = na
    if bar_index + 1 &gt;= length
        result := source
        if length &gt; 1
            for i = 1 to length - 1
                result := math.max(result, source[i])
    result</code></div>
<p>Alternatively, one might devise a more optimized Pine function by
reducing the number of times the loop executes, as iterating over the
history of the <code dir="auto">source</code> to achieve the result is only necessary when
specific conditions occur:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@variable A faster user-defined function to calculate the highest `source` value over `length` bars.
//          This version only requires a loop when the highest value is removed from the window, the `length` 
//          changes, or when the number of bars first becomes sufficient to calculate the result. 
fasterPineHighest(float source, int length) =&gt;
    var float result = na
    if source[length] == result or length != length[1] or bar_index + 1 == length
        result := source
        if length &gt; 1
            for i = 1 to length - 1
                result := math.max(result, source[i])
    else
        result := math.max(result, source)
    result</code></div>
<p>The built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
function will outperform <strong>both</strong> of these implementations, as its
internal calculations are highly optimized for efficient execution.
Below, we created a script that plots the results of calling
<code dir="auto">pineHighest()</code>, <code dir="auto">fasterPineHighest()</code>, and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
to compare their performance using the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Profiler</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5 
indicator("Using built-ins demo")

//@variable A user-defined function to calculate the highest `source` value over `length` bars.
pineHighest(float source, int length) =&gt;
    float result = na
    if bar_index + 1 &gt;= length
        result := source
        if length &gt; 1
            for i = 1 to length - 1
                result := math.max(result, source[i])
    result

//@variable A faster user-defined function to calculate the highest `source` value over `length` bars.
//          This version only requires a loop when the highest value is removed from the window, the `length` 
//          changes, or when the number of bars first becomes sufficient to calculate the result. 
fasterPineHighest(float source, int length) =&gt;
    var float result = na
    if source[length] == result or length != length[1] or bar_index + 1 == length
        result := source
        if length &gt; 1
            for i = 1 to length - 1
                result := math.max(result, source[i])
    else
        result := math.max(result, source)
    result

plot(pineHighest(close, 20))
plot(fasterPineHighest(close, 20))
plot(ta.highest(close, 20))</code></div>
<p>The
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> over 20,735 script executions show the call to
<code dir="auto">pineHighest()</code> took the most time to execute, with a runtime of 57.9
milliseconds, about 69.3% of the script’s total runtime. The
<code dir="auto">fasterPineHighest()</code> call performed much more efficiently, as it only
took about 16.9 milliseconds, approximately 20.2% of the total runtime,
to calculate the same values.</p>
<p>The most efficient <em>by far</em>, however, was the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
call, which only required 3.2 milliseconds (~3.8% of the total runtime)
to execute across all the chart’s data and compute the same values in
this run:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="564" loading="lazy" src="images/407f8a009e27aa4e964b8699c1cb5344.webp" width="1072"/></div></p>
<p>While these results effectively demonstrate that the built-in function
outperforms our
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> with a small <code dir="auto">length</code> argument of 20, it’s crucial to
consider that the calculations required by the functions <em>will vary</em>
with the argument’s value. Therefore, we can profile the code while
using
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-across-configurations">different arguments</a> to gauge how its runtime scales.</p>
<p>Here, we changed the <code dir="auto">length</code> argument in each function call from 20 to
200 and
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiled the script</a> again to observe the changes in performance. The time spent
on the <code dir="auto">pineHighest()</code> function in this run increased to about 0.6
seconds (~86% of the total runtime), and the time spent on the
<code dir="auto">fasterPineHighest()</code> function increased to about 75 milliseconds. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
function, on the other hand, <em>did not</em> experience a substantial runtime
change. It took about 5.8 milliseconds this time, only a couple of
milliseconds more than the previous run.</p>
<p>In other words, while our
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a> experienced significant runtime growth with a higher
<code dir="auto">length</code> argument in this run, the change in the built-in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
function’s runtime was relatively marginal in this case, thus further
emphasizing its performance benefits:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="564" loading="lazy" src="images/2e45611bbfbefefc059bc06bee8997b0.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>In many scenarios, a script’s runtime can benefit from using
built-ins where applicable. However, the relative performance
edge achieved from using built-ins depends on a script’s
<em>high-impact code</em> and the specific built-ins used. In any case,
one should always
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profile their scripts</a>, preferably
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#repetitive-profiling">several times</a>, when exploring optimized solutions.</li>
<li>The calculations performed by the functions in this example also
depend on the sequence of the chart’s data. Therefore,
programmers can gain further insight into their general
performance by profiling the script across
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-across-configurations">different datasets</a> as well.</li>
</ul>
<h3 class="md-heading" id="reducing-repetition"><a href="#reducing-repetition">Reducing repetition<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The Pine Script™ compiler can automatically simplify some types of
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#insignificant-unused-and-redundant-code">repetitive code</a> without a programmer’s intervention. However, this
automatic process has its limitations. If a script contains repetitive
calculations that the compiler <em>cannot</em> reduce, programmers can reduce
the repetition <em>manually</em> to improve their script’s performance.</p>
<p>For example, this script contains a <code dir="auto">valuesAbove()</code>
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method</a>
that counts the number of elements in an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
above the element at a specified index. The script plots the number of
values above the element at the last index of a <code dir="auto">data</code> array with a
calculated <code dir="auto">plotColor</code>. It calculates the <code dir="auto">plotColor</code> within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
structure that calls <code dir="auto">valuesAbove()</code> in all 10 of its conditional
expressions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing repetition demo")

//@function Counts the number of elements in `this` array above the element at a specified `index`.
method valuesAbove(array&lt;float&gt; this, int index) =&gt;
    int result = 0
    float reference = this.get(index)
    for [i, value] in this
        if i == index
            continue
        if value &gt; reference
            result += 1
    result

//@variable An array containing the most recent 100 `close` prices.
var array&lt;float&gt; data = array.new&lt;float&gt;(100)
data.push(close)
data.shift()

//@variable Returns `color.purple` with a varying transparency based on the `valuesAbove()`.
color plotColor = switch
    data.valuesAbove(99) &lt;= 10  =&gt; color.new(color.purple, 90)
    data.valuesAbove(99) &lt;= 20  =&gt; color.new(color.purple, 80)
    data.valuesAbove(99) &lt;= 30  =&gt; color.new(color.purple, 70)
    data.valuesAbove(99) &lt;= 40  =&gt; color.new(color.purple, 60)
    data.valuesAbove(99) &lt;= 50  =&gt; color.new(color.purple, 50)
    data.valuesAbove(99) &lt;= 60  =&gt; color.new(color.purple, 40)
    data.valuesAbove(99) &lt;= 70  =&gt; color.new(color.purple, 30)
    data.valuesAbove(99) &lt;= 80  =&gt; color.new(color.purple, 20)
    data.valuesAbove(99) &lt;= 90  =&gt; color.new(color.purple, 10)
    data.valuesAbove(99) &lt;= 100 =&gt; color.new(color.purple, 0)

// Plot the number values in the `data` array above the value at its last index. 
plot(data.valuesAbove(99), color = plotColor, style = plot.style_area)</code></div>
<p>The
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> for this script show that it spent about 2.5 seconds
executing 21,201 times. The code regions with the highest impact on the
script’s runtime are the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
within the <code dir="auto">valuesAbove()</code> local scope starting on line 8 and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>
block that starts on line 21:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="616" loading="lazy" src="images/b097896912c63a57cf881a62ab9493e3.webp" width="1072"/></div></p>
<p>Notice that the number of executions shown for the local code within
<code dir="auto">valuesAbove()</code> is substantially <em>greater</em> than the number shown for the
code in the script’s global scope, as the script calls the method up to
11 times per execution, and the results for a
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#user-defined-function-calls">function’s local code</a> reflect the <em>combined</em> time and executions from each
separate call:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/1784cc6a4a26f90a00b4adb38a53d0c1.webp" width="1072"/></div></p>
<p>Although each <code dir="auto">valuesAbove()</code> call uses the <em>same</em> arguments and returns
the <em>same</em> result, the compiler cannot automatically reduce this code
for us during translation. We will need to do the job ourselves. We can
optimize this script by assigning the value of <code dir="auto">data.valuesAbove(99)</code> to
a <em>variable</em> and <em>reusing</em> the value in all other areas requiring the
result.</p>
<p>In the version below, we modified the script by adding a <code dir="auto">count</code>
variable to reference the <code dir="auto">data.valuesAbove(99)</code> value. The script uses
this variable in the <code dir="auto">plotColor</code> calculation and the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>
call:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing repetition demo")

//@function Counts the number of elements in `this` array above the element at a specified `index`.
method valuesAbove(array&lt;float&gt; this, int index) =&gt;
    int result = 0
    float reference = this.get(index)
    for [i, value] in this
        if i == index
            continue
        if value &gt; reference
            result += 1
    result

//@variable An array containing the most recent 100 `close` prices.
var array&lt;float&gt; data = array.new&lt;float&gt;(100)
data.push(close)
data.shift()

//@variable The number values in the `data` array above the value at its last index.
int count = data.valuesAbove(99)

//@variable Returns `color.purple` with a varying transparency based on the `valuesAbove()`.
color plotColor = switch
    count &lt;= 10  =&gt; color.new(color.purple, 90)
    count &lt;= 20  =&gt; color.new(color.purple, 80)
    count &lt;= 30  =&gt; color.new(color.purple, 70)
    count &lt;= 40  =&gt; color.new(color.purple, 60)
    count &lt;= 50  =&gt; color.new(color.purple, 50)
    count &lt;= 60  =&gt; color.new(color.purple, 40)
    count &lt;= 70  =&gt; color.new(color.purple, 30)
    count &lt;= 80  =&gt; color.new(color.purple, 20)
    count &lt;= 90  =&gt; color.new(color.purple, 10)
    count &lt;= 100 =&gt; color.new(color.purple, 0)

// Plot the `count`.
plot(count, color = plotColor, style = plot.style_area)</code></div>
<p>With this modification, the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> show a significant improvement in performance, as the script
now only needs to evaluate the <code dir="auto">valuesAbove()</code> call <strong>once</strong> per
execution rather than up to 11 separate times:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="672" loading="lazy" src="images/975518da49c196665cc1838964905a4e.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>Since this script only calls <code dir="auto">valuesAbove()</code> once, the
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">method’s</a> local code will now reflect the results from that
specific call. See
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#user-defined-function-calls">this section</a> to learn more about interpreting profiled function
and method call results.</li>
</ul>
<h3 class="md-heading" id="minimizing-request-calls"><a href="#minimizing-request-calls">Minimizing `request.*()` calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The built-in functions in the <code dir="auto">request.*()</code> namespace allow scripts to
retrieve data from
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">other contexts</a>. While these functions provide utility in many applications,
it’s important to consider that each call to these functions can have a
significant impact on a script’s resource usage.</p>
<p>A single script can contain up to 40 calls to the <code dir="auto">request.*()</code> family
of functions. However, users should strive to keep their scripts’
<code dir="auto">request.*()</code> calls well <em>below</em> this limit to keep the performance
impact of their data requests as low as possible.</p>
<p>When a script requests the values of several expressions from the <em>same</em>
context with multiple
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>
calls, one effective way to optimize such requests is to <em>condense</em> them
into a single <code dir="auto">request.*()</code> call that uses a
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">tuple</a> as its <code dir="auto">expression</code> argument. This optimization not only
helps improve the runtime of the requests; it also helps reduce the
script’s <em>memory usage</em> and compiled size.</p>
<p>As a simple example, the following script requests nine
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.percentrank">ta.percentrank()</a>
values with different lengths from a specified symbol using nine
separate calls to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.
It then <a href="/pine-script-docs/v5/concepts/plots/">plots</a> all nine
requested values on the chart to utilize them in the outputs:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Minimizing `request.*()` calls demo")

//@variable The symbol to request data from.
string symbolInput = input.symbol("BINANCE:BTCUSDT", "Symbol")

// Request 9 `ta.percentrank()` values from the `symbolInput` context using 9 `request.security()` calls.
float reqRank1 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 10))
float reqRank2 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 20))
float reqRank3 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 30))
float reqRank4 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 40))
float reqRank5 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 50))
float reqRank6 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 60))
float reqRank7 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 70))
float reqRank8 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 80))
float reqRank9 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 90))

// Plot the `reqRank*` values.
plot(reqRank1)
plot(reqRank2)
plot(reqRank3)
plot(reqRank4)
plot(reqRank5)
plot(reqRank6)
plot(reqRank7)
plot(reqRank8)
plot(reqRank9)</code></div>
<p>The results from
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiling the script</a> show that it took the script 340.8 milliseconds to complete
its requests and plot the values in this run:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="502" loading="lazy" src="images/83bda965e58d7adb4ba486f0dde10aee.webp" width="1072"/></div></p>
<p>Since all the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
calls request data from the <strong>same context</strong>, we can optimize the
code’s resource usage by merging all of them into a single
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call that uses a
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#tuples">tuple</a> as its <code dir="auto">expression</code> argument:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Minimizing `request.*()` calls demo")

//@variable The symbol to request data from.
string symbolInput = input.symbol("BINANCE:BTCUSDT", "Symbol")

// Request 9 `ta.percentrank()` values from the `symbolInput` context using a single `request.security()` call.
[reqRank1, reqRank2, reqRank3, reqRank4, reqRank5, reqRank6, reqRank7, reqRank8, reqRank9] = 
 request.security(
     symbolInput, timeframe.period, [
             ta.percentrank(close, 10), ta.percentrank(close, 20), ta.percentrank(close, 30), 
             ta.percentrank(close, 40), ta.percentrank(close, 50), ta.percentrank(close, 60), 
             ta.percentrank(close, 70), ta.percentrank(close, 80), ta.percentrank(close, 90)
         ]
 )

// Plot the `reqRank*` values.
plot(reqRank1)
plot(reqRank2)
plot(reqRank3)
plot(reqRank4)
plot(reqRank5)
plot(reqRank6)
plot(reqRank7)
plot(reqRank8)
plot(reqRank9)</code></div>
<p>As we see below, the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> from running this version of the script show that it took
228.3 milliseconds this time, a decent improvement over the previous
run:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="486" loading="lazy" src="images/9f564e5ee80e4c4f32e0827782846e75.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>The computational resources available to a script <strong>fluctuate</strong>
over time. As such, it’s typically a good idea to profile a
script
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#repetitive-profiling">multiple times</a> to help solidify performance conclusions.</li>
<li>Another way to request multiple values from the same context
with a single <code dir="auto">request.*()</code> call is to pass an
<a href="/pine-script-docs/v5/language/objects/">object</a> of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type (UDT)</a> as the <code dir="auto">expression</code> argument. See
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#user-defined-types">this section</a> of the
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page to learn more about requesting
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDTs</a>.</li>
<li>Programmers can also reduce the total runtime of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a>
call by passing an argument to the function’s <code dir="auto">calc_bars_count</code>
parameter, which <em>restricts</em> the number of <em>historical</em> data
points it can access from a context and execute required
calculations on. In general, if calls to these <code dir="auto">request.*()</code>
functions retrieve <em>more</em> historical data than what a script
<em>needs</em>, limiting the requests with <code dir="auto">calc_bars_count</code> can help
improve the script’s performance.</li>
</ul>
<h3 class="md-heading" id="avoiding-redrawing"><a href="#avoiding-redrawing">Avoiding redrawing<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™‘s
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> allow scripts to draw custom visuals on a chart that one
cannot achieve through other outputs such as
<a href="/pine-script-docs/v5/concepts/plots/">plots</a>. While these types
provide greater visual flexibility, they also have a <em>higher</em> runtime
and memory cost, especially when a script unnecessarily <em>recreates</em>
drawings instead of directly updating their properties to change their
appearance.</p>
<p>Most
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a>, excluding
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
feature built-in <em>setter functions</em> in their namespaces that allow
scripts to modify a drawing <em>without</em> deleting and recreating it.
Utilizing these setters is typically less computationally expensive than
creating a new drawing object when only <em>specific properties</em> require
modification.</p>
<p>For example, the script below compares deleting and redrawing
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> to using
<code dir="auto">box.set*()</code> functions. On the first bar, it declares the <code dir="auto">redrawnBoxes</code>
and <a href="/pine-script-docs/v5/language/arrays/">updatedBoxes<code dir="auto"> </code>arrays</a>
and executes a <a href="/pine-script-docs/v5/language/loops/">loop</a> to push
25 <a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>
elements into them.</p>
<p>The script uses a separate
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
to iterate across the <a href="/pine-script-docs/v5/language/arrays/">arrays</a> and update the drawings on each execution. It <em>recreates</em>
the <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> in
the <code dir="auto">redrawnBoxes</code> array using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.delete">box.delete()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>,
whereas it <em>directly modifies</em> the properties of the
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a> in the
<code dir="auto">updatedBoxes</code> array using
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_lefttop">box.set_lefttop()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_rightbottom">box.set_rightbottom()</a>.
Both approaches achieve the same visual result. However, the latter is
more efficient:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Avoiding redrawing demo")

//@variable An array of `box` IDs deleted with `box.delete()` and redrawn with `box.new()` on each execution.
var array&lt;box&gt; redrawnBoxes = array.new&lt;box&gt;()
//@variable An array of `box` IDs with properties that update across executions update via `box.set*()` functions.
var array&lt;box&gt; updatedBoxes = array.new&lt;box&gt;()

// Populate both arrays with 25 elements on the first bar. 
if barstate.isfirst
    for i = 1 to 25
        array.push(redrawnBoxes, box(na))
        array.push(updatedBoxes, box.new(na, na, na, na))

for i = 0 to 24
    // Calculate coordinates.
    int x = bar_index - i
    float y = close[i + 1] - close
    // Get the `box` ID from each array at the `i` index.
    box redrawnBox = redrawnBoxes.get(i)
    box updatedBox = updatedBoxes.get(i)
    // Delete the `redrawnBox`, create a new `box` ID, and replace that element in the `redrawnboxes` array.
    box.delete(redrawnBox)
    redrawnBox := box.new(x - 1, y, x, 0.0)
    array.set(redrawnBoxes, i, redrawnBox)
    // Update the properties of the `updatedBox` rather than redrawing it. 
    box.set_lefttop(updatedBox, x - 1, y)
    box.set_rightbottom(updatedBox, x, 0.0)</code></div>
<p>The results from
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiling this script</a> show that line 24, which contains the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.new">box.new()</a>
call, is the <em>heaviest</em> line in the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">code block</a> that executes on each bar, with a runtime close to
<strong>double</strong> the combined time spent on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_lefttop">box.set_lefttop()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box.set_rightbottom">box.set_rightbottom()</a>
calls on lines 27 and 28:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="514" loading="lazy" src="images/398cd5ed79a8324edf92a4b5bf4d96a6.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>The number of executions shown for the loop’s <em>local code</em> is
25 times the number shown for the code in the script’s <em>global
scope</em>, as each execution of the loop statement triggers 25
executions of the local block.</li>
<li>This script updates its drawings over <em>all bars</em> in the chart’s
history for <strong>testing</strong> purposes. However, it does <strong>not</strong>
actually need to execute all these historical updates since
users will only see the <strong>final</strong> result from the <em>last
historical bar</em> and the changes across <em>realtime bars</em>. See the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#reducing-drawing-updates">next section</a> to learn more.</li>
</ul>
<h3 class="md-heading" id="reducing-drawing-updates"><a href="#reducing-drawing-updates">Reducing drawing updates<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a script produces
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing objects</a> that change across <em>historical bars</em>, users will only ever
see their <strong>final results</strong> on those bars since the script completes its
historical executions when it first loads on the chart. The only time
one will see such drawings <em>evolve</em> across executions is during
<em>realtime bars</em>, as new data flows in.</p>
<p>Since the evolving outputs from dynamic
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawings</a> on historical bars are <strong>never visible</strong> to a user, one can
often improve a script’s performance by <em>eliminating</em> the historical
updates that don’t impact the final results.</p>
<p>For example, this script creates a
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
with two columns and 21 rows to visualize the history of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rsi">RSI</a>
in a paginated, tabular format. The script initializes the cells of the
<code dir="auto">infoTable</code> on the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isfirst">first
bar</a>,
and it references the history of the calculated <code dir="auto">rsi</code> to update the
<code dir="auto">text</code> and <code dir="auto">bgcolor</code> of the cells in the second column within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
on each bar:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing drawing updates demo")

//@variable The first offset shown in the paginated table.
int offsetInput = input.int(0, "Page", 0, 249) * 20

//@variable A table that shows the history of RSI values.
var table infoTable = table.new(position.top_right, 2, 21, border_color = chart.fg_color, border_width = 1)
// Initialize the table's cells on the first bar.
if barstate.isfirst
    table.cell(infoTable, 0, 0, "Offset", text_color = chart.fg_color)
    table.cell(infoTable, 1, 0, "RSI", text_color = chart.fg_color)
    for i = 0 to 19
        table.cell(infoTable, 0, i + 1, str.tostring(offsetInput + i))
        table.cell(infoTable, 1, i + 1)

float rsi = ta.rsi(close, 14)

// Update the history shown in the `infoTable` on each bar. 
for i = 0 to 19
    float historicalRSI = rsi[offsetInput + i]
    table.cell_set_text(infoTable, 1, i + 1, str.tostring(historicalRSI))
    table.cell_set_bgcolor(
         infoTable, 1, i + 1, color.from_gradient(historicalRSI, 30, 70, color.red, color.green)
     )

plot(rsi, "RSI")</code></div>
<p>After
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiling</a> the script, we see that the code with the highest impact on
performance is the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
that starts on line 20, i.e., the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">code block</a> that updates the table’s cells:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="494" loading="lazy" src="images/9a33d363c33d7dc6b3a72eb631e52406.webp" width="1072"/></div></p>
<p>This critical code region executes <strong>excessively</strong> across the chart’s
history, as users will only see the
<a href="/pine-script-docs/v5/concepts/tables/">table’s</a> <strong>final</strong>
historical result. The only time that users will see the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
update is on the <strong>last historical bar</strong> and across all subsequent
<strong>realtime bars</strong>. Therefore, we can optimize this script’s resource
usage by restricting the executions of this code to only the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">last
available
bar</a>.</p>
<p>In this script version, we placed the
<a href="/pine-script-docs/v5/language/loops/">loop</a> that updates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_table">table</a>
cells within an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure that uses
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">barstate.islast</a>
as its condition, effectively restricting the code block’s executions
to only the last historical bar and all realtime bars. Now, the script
<em>loads</em> more efficiently since all the table’s calculations only
require <strong>one</strong> historical execution:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="520" loading="lazy" src="images/446e2e612f5a33e39f870f4350b6790e.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing drawing updates demo")

//@variable The first offset shown in the paginated table.
int offsetInput = input.int(0, "Page", 0, 249) * 20

//@variable A table that shows the history of RSI values.
var table infoTable = table.new(position.top_right, 2, 21, border_color = chart.fg_color, border_width = 1)
// Initialize the table's cells on the first bar.
if barstate.isfirst
    table.cell(infoTable, 0, 0, "Offset", text_color = chart.fg_color)
    table.cell(infoTable, 1, 0, "RSI", text_color = chart.fg_color)
    for i = 0 to 19
        table.cell(infoTable, 0, i + 1, str.tostring(offsetInput + i))
        table.cell(infoTable, 1, i + 1)

float rsi = ta.rsi(close, 14)

// Update the history shown in the `infoTable` on the last available bar.
if barstate.islast
    for i = 0 to 19
        float historicalRSI = rsi[offsetInput + i]
        table.cell_set_text(infoTable, 1, i + 1, str.tostring(historicalRSI))
        table.cell_set_bgcolor(
             infoTable, 1, i + 1, color.from_gradient(historicalRSI, 30, 70, color.red, color.green)
         )

plot(rsi, "RSI")</code></div>
<p>Note that:</p>
<ul>
<li>The script will still update the cells when new <strong>realtime</strong>
updates come in, as users can observe those changes on the
chart, unlike the changes that the script used to execute across
historical bars.</li>
</ul>
<h3 class="md-heading" id="storing-calculated-values"><a href="#storing-calculated-values">Storing calculated values<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When a script performs a critical calculation that changes
<em>infrequently</em> throughout all executions, one can reduce its runtime by
<strong>saving the result</strong> to a variable declared with the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> or
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a>
keywords and <strong>only</strong> updating the value if the calculation changes. If
the script calculates <em>multiple</em> values excessively, one can store them
within
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a>,
<a href="/pine-script-docs/v5/language/matrices/">matrices</a>, and
<a href="/pine-script-docs/v5/language/maps/">maps</a> or
<a href="/pine-script-docs/v5/language/objects/">objects</a> of
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a>.</p>
<p>Let’s look at an example. This script calculates a weighted moving
average with custom weights based on a generalized <a href="https://en.wikipedia.org/wiki/Window_function" rel="nofollow">window
function</a>. The
<code dir="auto">numerator</code> is the sum of weighted
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values, and the <code dir="auto">denominator</code> is the sum of the calculated weights. The
script uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
that iterates <code dir="auto">lengthInput</code> times to calculate these sums, then it plots
their ratio, i.e., the resulting average:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Storing calculated values demo", overlay = true)

//@variable The number of bars in the weighted average calculation.
int lengthInput = input.int(50, "Length", 1, 5000)
//@variable Window coefficient. 
float coefInput = input.float(0.5, "Window coefficient", 0.0, 1.0, 0.01)

//@variable The sum of weighted `close` prices.
float numerator = 0.0
//@variable The sum of weights.
float denominator = 0.0

//@variable The angular step in the cosine calculation.
float step = 2.0 * math.pi / lengthInput
// Accumulate weighted sums.
for i = 0 to lengthInput - 1
    float weight = coefInput - (1 - coefInput) * math.cos(step * i)
    numerator += close[i] * weight
    denominator += weight

// Plot the weighted average result.
plot(numerator / denominator, "Weighted average", color.purple, 3)</code></div>
<p>After
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiling</a> the script’s performance over our chart’s data, we see
that it took about 241.3 milliseconds to calculate the default 50-bar
average across 20,155 chart updates, and the critical code with the
<em>highest impact</em> on the script’s performance is the loop
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#code-block-results">block</a> that starts on line 17:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="424" loading="lazy" src="images/42d646cc1b8003ba8c69a5cacc1fa81e.webp" width="1072"/></div></p>
<p>Since the number of loop iterations <em>depends</em> on the <code dir="auto">lengthInput</code>
value, let’s test how its runtime scales with
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-across-configurations">another configuration</a> requiring heavier looping. Here, we set the value to 2500.
This time, the script took about 12 seconds to complete all of its
executions:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="424" loading="lazy" src="images/0427f87d05dcd7f171b6e96b663354cb.webp" width="1072"/></div></p>
<p>Now that we’ve pinpointed the script’s <em>high-impact</em> code and
established a benchmark to improve, we can inspect the critical code
block to identify optimization opportunities. After examining the
calculations, we can observe the following:</p>
<ul>
<li>The only value that causes the <code dir="auto">weight</code> calculation on line 18 to
vary across loop iterations is the <em>loop index</em>. All other values in
its calculation remain consistent. Consequently, the <code dir="auto">weight</code>
calculated on each loop iteration <strong>does not vary</strong> across chart
bars. Therefore, rather than calculating the weights on <strong>every
update</strong>, we can calculate them <strong>once</strong>, on the first bar, and
<strong>store them</strong> in a
<a href="/pine-script-docs/v5/language/type-system/#collections">collection</a> for future access across subsequent script executions.</li>
<li>Since the weights never change, the resulting <code dir="auto">denominator</code> never
changes. Therefore, we can add the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword to the
<a href="/pine-script-docs/v5/language/variable-declarations/">variable declaration</a> and only calculate its value <strong>once</strong> to reduce the
number of executed <a href="https://www.tradingview.com/pine-script-reference/v5/#op_+=">addition
assignment</a>
operations.</li>
<li>Unlike the <code dir="auto">denominator</code>, we <strong>cannot</strong> store the <code dir="auto">numerator</code> value
to simplify its calculation since it consistently <em>changes</em> over
time.</li>
</ul>
<p>In the modified script below, we’ve added a <code dir="auto">weights</code> variable to
reference an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
that stores each calculated <code dir="auto">weight</code>. This variable and the
<code dir="auto">denominator</code> both include the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a>
keyword in their declarations, meaning the values assigned to them will
<em>persist</em> throughout all script executions until explicitly reassigned.
The script calculates their values using a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
that only executes on the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.isfirst">first chart
bar</a>.
Across all other bars, it calculates the <code dir="auto">numerator</code> using a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop that references the <em>saved values</em> from the <code dir="auto">weights</code> array:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Storing calculated values demo", overlay = true)

//@variable The number of bars in the weighted average calculation.
int lengthInput = input.int(50, "Length", 1, 5000)
//@variable Window coefficient. 
float coefInput = input.float(0.5, "Window coefficient", 0.0, 1.0, 0.01)

//@variable An array that stores the `weight` values calculated on the first chart bar. 
var array&lt;float&gt; weights = array.new&lt;float&gt;()

//@variable The sum of weighted `close` prices.
float numerator = 0.0
//@variable The sum of weights. The script now only calculates this value on the first bar. 
var float denominator = 0.0

//@variable The angular step in the cosine calculation.
float step = 2.0 * math.pi / lengthInput

// Populate the `weights` array and calculate the `denominator` only on the first bar.
if barstate.isfirst
    for i = 0 to lengthInput - 1
        float weight = coefInput - (1 - coefInput) * math.cos(step * i)
        array.push(weights, weight)
        denominator += weight
// Calculate the `numerator` on each bar using the stored `weights`. 
for [i, w] in weights
    numerator += close[i] * w

// Plot the weighted average result.
plot(numerator / denominator, "Weighted average", color.purple, 3)</code></div>
<p>With this optimized structure, the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> show that our modified script with a high <code dir="auto">lengthInput</code>
value of 2500 took about 5.9 seconds to calculate across the same data,
about <em>half</em> the time of our previous version:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="566" loading="lazy" src="images/6d904c2f66603cb81cd2657cdae8ede5.webp" width="1072"/></div></p>
<p>Note that:</p>
<ul>
<li>Although we’ve significantly improved this script’s
performance by saving its <em>execution-invariant</em> values to
variables, it does still involve a higher computational cost
with <strong>large</strong> <code dir="auto">lengthInput</code> values due to the remaining loop
calculations that execute on each bar.</li>
<li>Another, more <em>advanced</em> way one can further enhance this
script’s performance is by storing the weights in a
<em>single-row</em>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_matrix">matrix</a>
on the first bar, using an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
as a
<a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queue</a> to hold recent
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
values, then replacing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop with a call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.mult">matrix.mult()</a>.
See the <a href="/pine-script-docs/v5/language/matrices/">Matrices</a>
page to learn more about working with <code dir="auto">matrix.*()</code> functions.</li>
</ul>
<h3 class="md-heading" id="eliminating-loops"><a href="#eliminating-loops">Eliminating loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/language/loops/">Loops</a> allow Pine scripts to
perform <em>iterative</em> calculations on each execution. Each time a loop
activates, its local code may execute <em>several times</em>, often leading to
a <em>substantial increase</em> in resource usage.</p>
<p>Pine loops are necessary for <em>some</em> calculations, such as manipulating
elements within
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> or looking backward through a dataset’s history to
calculate values <em>only</em> obtainable on the current bar. However, in many
other cases, programmers use loops when they <strong>don’t need to</strong>, leading
to suboptimal runtime performance. In such cases, one may eliminate
unnecessary loops in any of the following ways, depending on what their
calculations entail:</p>
<ul>
<li>Identifying simplified, <strong>loop-free expressions</strong> that achieve the
same result without iteration</li>
<li>Replacing a loop with optimized
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#using-built-ins">built-ins</a> where possible</li>
<li>Distributing a loop’s iterations <em>across bars</em> when feasible rather
than evaluating them all at once</li>
</ul>
<p>This simple example contains an <code dir="auto">avgDifference()</code> function that
calculates the average difference between the current bar’s <code dir="auto">source</code>
value and all the values from <code dir="auto">length</code> previous bars. The script calls
this function to calculate the average difference between the current
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price and <code dir="auto">lengthInput</code> previous prices, then it
<a href="/pine-script-docs/v5/concepts/plots/">plots</a> the result on the
chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Eliminating loops demo")

//@variable The number of bars in the calculation.
int lengthInput = input.int(20, "Length", 1)

//@function Calculates the average difference between the current `source` and `length` previous `source` values.
avgDifference(float source, int length) =&gt;
    float diffSum = 0.0
    for i = 1 to length
        diffSum += source - source[i]
    diffSum / length

plot(avgDifference(close, lengthInput))</code></div>
<p>After inspecting the script’s
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> with the default settings, we see that it took about 64
milliseconds to execute 20,157 times:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/5ac8877a361874d8a5d5bbd92087da70.webp" width="1072"/></div></p>
<p>Since we use the <code dir="auto">lengthInput</code> as the <code dir="auto">length</code> argument in the
<code dir="auto">avgDifference()</code> call and that argument controls how many times the
loop inside the function must iterate, our script’s runtime will
<strong>grow</strong> with the <code dir="auto">lengthInput</code> value. Here, we set the input’s value
to 2000 in the script’s settings. This time, the script completed its
executions in about 3.8 seconds:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="304" loading="lazy" src="images/9979f6e746e42034169c58c3b9e26164.webp" width="1072"/></div></p>
<p>As we see from these results, the <code dir="auto">avgDifference()</code> function can be
costly to call, depending on the specified <code dir="auto">lengthInput</code> value, due to
its <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>
loop that executes on each bar. However,
<a href="/pine-script-docs/v5/language/loops/">loops</a> are <strong>not</strong> necessary
to achieve the output. To understand why, let’s take a closer look at
the loop’s calculations. We can represent them with the following
expression:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">(source - source[1]) + (source - source[2]) + ... + (source - source[length])</code></div>
<p>Notice that it adds the <em>current</em> <code dir="auto">source</code> value <code dir="auto">length</code> times. These
iterative additions are not necessary. We can simplify that part of the
expression to <code dir="auto">source * length</code>, which reduces it to the following:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">source * length - source[1] - source[2] - ... - source[length]</code></div>
<p>or equivalently:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">source * length - (source[1] + source[2] + ... + source[length])</code></div>
<p>After simplifying and rearranging this representation of the loop’s
calculations, we see that we can compute the result in a simpler way and
<strong>eliminate</strong> the loop by subtracting the previous bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.sum">rolling
sum</a>
of <code dir="auto">source</code> values from the <code dir="auto">source * length</code> value, i.e.:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">source * length - math.sum(source, length)[1]</code></div>
<p>The <code dir="auto">fastAvgDifference()</code> function below is a <strong>loop-free</strong> alternative
to the original <code dir="auto">avgDifference()</code> function that uses the above
expression to calculate the sum of <code dir="auto">source</code> differences, then divides
the expression by the <code dir="auto">length</code> to return the average difference:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@function A faster way to calculate the `avgDifference()` result. 
//          Eliminates the `for` loop using the relationship: 
//          `(x - x[1]) + (x - x[2]) + ... + (x - x[n]) = x * n - math.sum(x, n)[1]`.
fastAvgDifference(float source, int length) =&gt;
    (source * length - math.sum(source, length)[1]) / length</code></div>
<p>Now that we’ve identified a potential optimized solution, we can
compare the performance of <code dir="auto">fastAvgDifference()</code> to the original
<code dir="auto">avgDifference()</code> function. The script below is a modified form of the
previous version that plots the results from calling both functions with
the <code dir="auto">lengthInput</code> as the <code dir="auto">length</code> argument:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Eliminating loops demo")

//@variable The number of bars in the calculation.
int lengthInput = input.int(20, "Length", 1)

//@function Calculates the average difference between the current `source` and `length` previous `source` values.
avgDifference(float source, int length) =&gt;
    float diffSum = 0.0
    for i = 1 to length
        diffSum += source - source[i]
    diffSum / length

//@function A faster way to calculate the `avgDifference()` result. 
//          Eliminates the `for` loop using the relationship: 
//          `(x - x[1]) + (x - x[2]) + ... + (x - x[n]) = x * n - math.sum(x, n)[1]`.
fastAvgDifference(float source, int length) =&gt;
    (source * length - math.sum(source, length)[1]) / length

plot(avgDifference(close, lengthInput))
plot(fastAvgDifference(close, lengthInput))</code></div>
<p>The
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> for the script with the default <code dir="auto">lengthInput</code> of 20 show a
substantial difference in runtime spent on the two function calls. The
call to the original function took about 47.3 milliseconds to execute
20,157 times on this run, whereas our optimized function only took 4.5
milliseconds:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="410" loading="lazy" src="images/cab6806548aa14878e42529bcb6ae907.webp" width="1072"/></div></p>
<p>Now, let’s compare the performance with the <em>heavier</em> <code dir="auto">lengthInput</code>
value of 2000. As before, the runtime spent on the <code dir="auto">avgDifference()</code>
function increased significantly. However, the time spent executing the
<code dir="auto">fastAvgDifference()</code> call remained very close to the result from the
previous
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-across-configurations">configuration</a>. In other words, while our original function’s runtime
scales directly with its <code dir="auto">length</code> argument, our optimized function
demonstrates relatively <em>consistent</em> performance since it does not
require a loop:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="410" loading="lazy" src="images/d7af5390caaf5499399c11e01d69ea0d.webp" width="1072"/></div></p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Not all iterative calculations will necessarily have loop-free
alternatives. In the case where a script can <strong>only</strong> achieve its
results through iteration, programmers can identify possible ways to
optimize loops to improve performance. See the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#optimizing-loops">next section</a> for more information.</p></div></aside>
<h3 class="md-heading" id="optimizing-loops"><a href="#optimizing-loops">Optimizing loops<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Although Pine’s
<a href="/pine-script-docs/v5/language/execution-model/">execution model</a> and
the available built-ins often <em>eliminate</em> the need for
<a href="/pine-script-docs/v5/language/loops/">loops</a> in many cases, there
are still instances where a script <strong>will</strong> require
<a href="/pine-script-docs/v5/language/loops/">loops</a> for some types of
tasks, including:</p>
<ul>
<li>Manipulating
<a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> or executing calculations over a collection’s elements
when the available built-ins <strong>will not</strong> suffice</li>
<li>Performing calculations across historical bars that one <strong>cannot</strong>
achieve with simplified <em>loop-free</em> expressions or optimized
<em>built-ins</em></li>
<li>Calculating values that are <strong>only</strong> obtainable through iteration</li>
</ul>
<p>When a script uses <a href="/pine-script-docs/v5/language/loops/">loops</a>
that a programmer cannot
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#eliminating-loops">eliminate</a>, there are <a href="https://en.wikipedia.org/wiki/Loop_optimization" rel="nofollow">several
techniques</a> one can use
to reduce their performance impact. This section explains two of the
most common, useful techniques that can help improve a required loop’s
efficiency.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Before identifying ways to <em>optimize</em> a loop, we recommend searching for
ways to
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#eliminating-loops">eliminate</a> it first. If <strong>no solution</strong> exists that makes the loop
unnecessary, then proceed with attempting to reduce its overhead.</p></div></aside>
<h4 class="md-heading" id="reducing-loop-calculations"><a href="#reducing-loop-calculations">Reducing loop calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The code executed within a <a href="/pine-script-docs/v5/language/loops/">loop’s</a> local scope can have a <strong>multiplicative</strong> impact on its
overall runtime, as each time a loop statement executes, it will
typically trigger <em>several</em> iterations of the local code. Therefore,
programmers should strive to keep a loop’s calculations as simple as
possible by eliminating unnecessary structures, function calls, and
operations to minimize the performance impact, especially when the
script must evaluate its loops <em>numerous times</em> throughout all its
executions.</p>
<p>For example, this script contains a <code dir="auto">filteredMA()</code> function that
calculates a moving average of up to <code dir="auto">length</code> unique <code dir="auto">source</code> values,
depending on the <code dir="auto">true</code> elements in a specified <code dir="auto">mask</code>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.
The function queues the unique <code dir="auto">source</code> values into a <code dir="auto">data</code>
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>,
uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop to iterate over the <code dir="auto">data</code> and calculate the <code dir="auto">numerator</code> and
<code dir="auto">denominator</code> sums, then returns the ratio of those sums. Within the
loop, it only adds values to the sums when the <code dir="auto">data</code> element is not
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> and
the <code dir="auto">mask</code> element at the <code dir="auto">index</code> is <code dir="auto">true</code>. The script utilizes this
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> to calculate the average of up to 100 unique
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
prices filtered by a <code dir="auto">randMask</code> and plots the result on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing loop calculations demo", overlay = true)

//@function Calculates a moving average of up to `length` unique `source` values filtered by a `mask` array.
filteredMA(float source, int length, array&lt;bool&gt; mask) =&gt;
    // Raise a runtime error if the size of the `mask` doesn't equal the `length`.
    if mask.size() != length
        runtime.error("The size of the `mask` array used in the `filteredMA()` call must match the `length`.")
    //@variable An array containing `length` unique `source` values.
    var array&lt;float&gt; data = array.new&lt;float&gt;(length)
    // Queue unique `source` values into the `data` array.
    if not data.includes(source)
        data.push(source)
        data.shift()
    // The numerator and denominator of the average.
    float numerator   = 0.0
    float denominator = 0.0
    // Loop to calculate sums.
    for item in data
        if na(item)
            continue
        int index = array.indexof(data, item)
        if mask.get(index)
            numerator   += item
            denominator += 1.0
    // Return the average, or the last non-`na` average value if the current value is `na`.
    fixnan(numerator / denominator)

//@variable An array of 100 pseudorandom "bool" values.
var array&lt;bool&gt; randMask = array.new&lt;bool&gt;(100, true)
// Push the first element from `randMask` to the end and queue a new pseudorandom value.
randMask.push(randMask.shift())
randMask.push(math.random(seed = 12345) &lt; 0.5)
randMask.shift()

// Plot the `filteredMA()` of up to 100 unique `close` values filtered by the `randMask`.
plot(filteredMA(close, 100, randMask))</code></div>
<p>After
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profiling the script</a>, we see it took about two seconds to execute 21,778 times.
The code with the highest performance impact is the expression on line
37, which calls the <code dir="auto">filteredMA()</code> function. Within the <code dir="auto">filteredMA()</code>
function’s scope, the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop has the highest impact, with the <code dir="auto">index</code> calculation in the loop’s
scope (line 22) contributing the most to the loop’s runtime:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="684" loading="lazy" src="images/04b58847d753f31b835deeebf8f057fa.webp" width="1070"/></div></p>
<p>The above code demonstrates suboptimal usage of a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop, as we <strong>do not</strong> need to call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a>
to retrieve the <code dir="auto">index</code> in this case. The
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a>
function can be <em>costly</em> to call within a loop since it must search
through the <a href="/pine-script-docs/v5/language/arrays/">array’s</a>
contents and locate the corresponding element’s index <em>each time</em> the
script calls it.</p>
<p>To eliminate this costly call from our
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop, we can use the <em>second form</em> of the structure, which produces a
<em>tuple</em> containing the <strong>index</strong> and the element’s value on each
iteration:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">for [index, item] in data</code></div>
<p>In this version of the script, we removed the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a>
call on line 22 since it is <strong>not</strong> necessary to achieve the intended
result, and we changed the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop to use the alternative form:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Reducing loop calculations demo", overlay = true)

//@function Calculates a moving average of up to `length` unique `source` values filtered by a `mask` array.
filteredMA(float source, int length, array&lt;bool&gt; mask) =&gt;
    // Raise a runtime error if the size of the `mask` doesn't equal the `length`.
    if mask.size() != length
        runtime.error("The size of the `mask` array used in the `filteredMA()` call must match the `length`.")
    //@variable An array containing `length` unique `source` values.
    var array&lt;float&gt; data = array.new&lt;float&gt;(length)
    // Queue unique `source` values into the `data` array.
    if not data.includes(source)
        data.push(source)
        data.shift()
    // The numerator and denominator of the average.
    float numerator   = 0.0
    float denominator = 0.0
    // Loop to calculate sums.
    for [index, item] in data
        if na(item)
            continue
        if mask.get(index)
            numerator   += item
            denominator += 1.0
    // Return the average, or the last non-`na` average value if the current value is `na`.
    fixnan(numerator / denominator)

//@variable An array of 100 pseudorandom "bool" values.
var array&lt;bool&gt; randMask = array.new&lt;bool&gt;(100, true)
// Push the first element from `randMask` to the end and queue a new pseudorandom value.
randMask.push(randMask.shift())
randMask.push(math.random(seed = 12345) &lt; 0.5)
randMask.shift()

// Plot the `filteredMA()` of up to 100 unique `close` values filtered by the `randMask`. 
plot(filteredMA(close, 100, randMask))</code></div>
<p>With this simple change, our loop is much more efficient, as it no
longer needs to redundantly search through the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>
on each iteration to keep track of the index. The
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> from this script run show that it took only 0.6 seconds to
complete its executions, a significant improvement over the previous
version’s result:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="668" loading="lazy" src="images/2d695e99451dc36b7b4b01a9cd24f3c7.webp" width="1070"/></div></p>
<h4 class="md-heading" id="loop-invariant-code-motion"><a href="#loop-invariant-code-motion">Loop-invariant code motion<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><em>Loop-invariant code</em> is any code region within a
<a href="/pine-script-docs/v5/language/loops/">loop’s</a> scope that produces
an <strong>unchanging</strong> result on each iteration. When a script’s
<a href="/pine-script-docs/v5/language/loops/">loops</a> contain loop-invariant
code, it can substantially impact performance in some cases due to
excessive, <strong>unnecessary</strong> calculations.</p>
<p>Programmers can optimize a loop with invariant code by <em>moving</em> the
unchanging calculations <strong>outside</strong> the loop’s scope so the script only
needs to evaluate them once per execution rather than repetitively.</p>
<p>The following example contains a <code dir="auto">featureScale()</code> function that creates
a rescaled version of an
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a>.
Within the function’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop, it scales each element by calculating its distance from the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">array.min()</a>
and dividing the value by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.range">array.range()</a>.
The script uses this function to create a <code dir="auto">rescaled</code> version of a
<code dir="auto">prices</code> array and <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the
difference between the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.first">rescaled.first()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">rescaled.avg()</a>
values on the chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop-invariant code motion demo")

//@function Returns a feature scaled version of `this` array.
featureScale(array&lt;float&gt; this) =&gt;
    array&lt;float&gt; result = array.new&lt;float&gt;()
    for item in this
        result.push((item - array.min(this)) / array.range(this))
    result

//@variable An array containing the most recent 100 `close` prices.
var array&lt;float&gt; prices = array.new&lt;float&gt;(100, close)
// Queue the `close` through the `prices` array.
prices.unshift(close)
prices.pop()

//@variable A feature scaled version of the `prices` array.
array&lt;float&gt; rescaled = featureScale(prices)

// Plot the difference between the first element and the average value in the `rescaled` array.
plot(rescaled.first() - rescaled.avg())</code></div>
<p>As we see below, the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> for this script after 20,187 executions show it completed
its run in about 3.3 seconds. The code with the highest impact on
performance is the line containing the <code dir="auto">featureScale()</code> function call,
and the function’s critical code is the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop block starting on line 7:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="404" loading="lazy" src="images/7b5523741c05ceb5a2c565d6bd71ac65.webp" width="1072"/></div></p>
<p>Upon examining the loop’s calculations, we can see that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">array.min()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.range">array.range()</a>
calls on line 8 are <strong>loop-invariant</strong>, as they will always produce the
<strong>same result</strong> across each iteration. We can make our loop much more
efficient by assigning the results from these calls to variables
<strong>outside</strong> its scope and referencing them as needed.</p>
<p>The <code dir="auto">featureScale()</code> function in the script below assigns the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.min">array.min()</a>
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.range">array.range()</a>
values to <code dir="auto">minValue</code> and <code dir="auto">rangeValue</code> variables <em>before</em> executing the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>
loop. Inside the loop’s local scope, it <em>references</em> the variables
across its iterations rather than repetitively calling these <code dir="auto">array.*()</code>
functions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop-invariant code motion demo")

//@function Returns a feature scaled version of `this` array.
featureScale(array&lt;float&gt; this) =&gt;
    array&lt;float&gt; result = array.new&lt;float&gt;()
    float minValue      = array.min(this)
    float rangeValue    = array.range(this)
    for item in this
        result.push((item - minValue) / rangeValue)
    result

//@variable An array containing the most recent 100 `close` prices.
var array&lt;float&gt; prices = array.new&lt;float&gt;(100, close)
// Queue the `close` through the `prices` array.
prices.unshift(close)
prices.pop()

//@variable A feature scaled version of the `prices` array.
array&lt;float&gt; rescaled = featureScale(prices)

// Plot the difference between the first element and the average value in the `rescaled` array.
plot(rescaled.first() - rescaled.avg())</code></div>
<p>As we see from the script’s
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a>, moving the <em>loop-invariant</em> calculations outside the loop
leads to a substantial performance improvement. This time, the script
completed its executions in only 289.3 milliseconds:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="438" loading="lazy" src="images/3045b4c07f335ee7f9b3815e19f56b85.webp" width="1072"/></div></p>
<h3 class="md-heading" id="minimizing-historical-buffer-calculations"><a href="#minimizing-historical-buffer-calculations">Minimizing historical buffer calculations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine scripts create <em>historical buffers</em> for all variables and function
calls their outputs depend on. Each buffer contains information about
the range of historical values the script can access with the
history-referencing operator
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%5B%5D">[]</a>.</p>
<p>A script <em>automatically</em> determines the required buffer size for all its
variables and function calls by analyzing the historical references
executed during the <strong>first 244 bars</strong> in a dataset. When a script only
references the history of a calculated value <em>after</em> those initial bars,
it will <strong>restart</strong> its executions repetitively across previous bars
with successively larger historical buffers until it either determines
the appropriate size or raises a runtime error. Those repetitive
executions can significantly increase a script’s runtime in some cases.</p>
<p>When a script <em>excessively</em> executes across a dataset to calculate
historical buffers, one effective way to improve its performance is
<em>explicitly</em> defining suitable buffer sizes using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a>
function. With appropriate buffer sizes declared explicitly, the script
does not need to re-execute across past data to determine the sizes.</p>
<p>For example, the script below uses a
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polyline</a>
to draw a basic histogram representing the distribution of calculated
<code dir="auto">source</code> values over 500 bars. On the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">last available
bar</a>,
the script uses a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop
to look back through historical values of the calculated <code dir="auto">source</code> series
and determine the
<a href="/pine-script-docs/v5/language/type-system/#chart-points">chart points</a> used by the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
drawing. It also <a href="/pine-script-docs/v5/concepts/plots/">plots</a> the
value of <code dir="auto">bar_index + 1</code> to verify the number of bars it executed
across:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Minimizing historical buffer calculations demo", overlay = true)

//@variable A polyline with points that form a histogram of `source` values.
var polyline display = na
//@variable The difference Q3 of `high` prices and Q1 of `low` prices over 500 bars.
float innerRange = ta.percentile_nearest_rank(high, 500, 75) - ta.percentile_nearest_rank(low, 500, 25)
// Calculate the highest and lowest prices, and the total price range, over 500 bars.
float highest    = ta.highest(500)
float lowest     = ta.lowest(500)
float totalRange = highest - lowest

//@variable The source series for histogram calculation. Its value is the midpoint between the `open` and `close`.
float source = math.avg(open, close)

if barstate.islast
    polyline.delete(display)
    // Calculate the number of histogram bins and their size.
    int   bins    = int(math.round(5 * totalRange / innerRange))
    float binSize = totalRange / bins
    //@variable An array of chart points for the polyline.
    array&lt;chart.point&gt; points = array.new&lt;chart.point&gt;(bins, chart.point.new(na, na, na))
    // Loop to build the histogram.
    for i = 0 to 499
        //@variable The histogram bin number. Uses past values of the `source` for its calculation.
        //          The script must execute across all previous bars AGAIN to determine the historical buffer for 
        //          `source`, as initial references to the calculated series occur AFTER the first 244 bars. 
        int index = int((source[i] - lowest) / binSize)
        if na(index)
            continue
        chart.point currentPoint = points.get(index)
        if na(currentPoint.index)
            points.set(index, chart.point.from_index(bar_index + 1, (index + 0.5) * binSize + lowest))
            continue
        currentPoint.index += 1
    // Add final points to the `points` array and draw the new `display` polyline.
    points.unshift(chart.point.now(lowest))
    points.push(chart.point.now(highest))
    display := polyline.new(points, closed = true)

plot(bar_index + 1, "Number of bars", display = display.data_window)</code></div>
<p>Since the script <em>only</em> references past <code dir="auto">source</code> values on the <em>last
bar</em>, it will <strong>not</strong> construct a suitable historical buffer for the
series within the first 244 bars on a larger dataset. Consequently, it
will <strong>re-execute</strong> across all historical bars to identify the
appropriate buffer size.</p>
<p>As we see from the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> after running the script across 20,320 bars, the number of
<em>global</em> code executions was 162,560, which is <strong>eight times</strong> the
number of chart bars. In other words, the script had to <em>repeat</em> the
historical executions <strong>seven more times</strong> to determine the appropriate
buffer for the <code dir="auto">source</code> series in this case:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="532" loading="lazy" src="images/313b4e78d298851e21ce7d4375be16a5.webp" width="1318"/></div></p>
<p>This script will only reference the most recent 500 <code dir="auto">source</code> values on
the last historical bar and all realtime bars. Therefore, we can help it
establish the correct buffer <em>without</em> re-execution by defining a
500-bar referencing length with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a>.</p>
<p>In the following script version, we added <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back(source,
500)</a>
after the variable declaration to explicitly specify that the script
will access up to 500 historical <code dir="auto">source</code> values throughout its
executions:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Minimizing historical buffer calculations demo", overlay = true)

//@variable A polyline with points that form a histogram of `source` values.
var polyline display = na
//@variable The difference Q3 of `high` prices and Q1 of `low` prices over 500 bars.
float innerRange = ta.percentile_nearest_rank(high, 500, 75) - ta.percentile_nearest_rank(low, 500, 25)
// Calculate the highest and lowest prices, and the total price range, over 500 bars.
float highest    = ta.highest(500)
float lowest     = ta.lowest(500)
float totalRange = highest - lowest

//@variable The source series for histogram calculation. Its value is the midpoint between the `open` and `close`.
float source = math.avg(open, close)
// Explicitly define a 500-bar historical buffer for the `source` to prevent recalculation.
max_bars_back(source, 500)

if barstate.islast
    polyline.delete(display)
    // Calculate the number of histogram bins and their size.
    int   bins    = int(math.round(5 * totalRange / innerRange))
    float binSize = totalRange / bins
    //@variable An array of chart points for the polyline.
    array&lt;chart.point&gt; points = array.new&lt;chart.point&gt;(bins, chart.point.new(na, na, na))
    // Loop to build the histogram.
    for i = 0 to 499
        //@variable The histogram bin number. Uses past values of the `source` for its calculation.
        //          Since the `source` now has an appropriate predefined buffer, the script no longer needs 
        //          to recalculate across previous bars to determine the referencing length. 
        int index = int((source[i] - lowest) / binSize)
        if na(index)
            continue
        chart.point currentPoint = points.get(index)
        if na(currentPoint.index)
            points.set(index, chart.point.from_index(bar_index + 1, (index + 0.5) * binSize + lowest))
            continue
        currentPoint.index += 1
    // Add final points to the `points` array and draw the new `display` polyline.
    points.unshift(chart.point.now(lowest))
    points.push(chart.point.now(highest))
    display := polyline.new(points, closed = true)

plot(bar_index + 1, "Number of bars", display = display.data_window)</code></div>
<p>With this change, our script no longer needs to re-execute across all
the historical data to determine the buffer size. As we see in the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#interpreting-profiled-results">profiled results</a> below, the number of global code executions now aligns with
the number of chart bars, and the script took substantially less time to
complete all of its historical executions:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="532" loading="lazy" src="images/40ce825f88896f952d2b704214a6201c.webp" width="1318"/></div></p>
<p>Note that:</p>
<ul>
<li>This script only requires up to the most recent 501 historical
bars to calculate its drawing output. In this case, another way
to optimize resource usage is to include <code dir="auto">calc_bars_count = 501</code>
in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function, which reduces unnecessary script executions by
restricting the historical data the script can calculate across
to 501 bars.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span></p><p>When explicitly defining a buffer size for a problematic historical
reference with
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a>,
it’s imperative to ensure that the script <strong>will not</strong> use more data
than specified later in its executions, as the script will still
re-execute on historical bars and try to calculate the buffer if the
user-specified size is insufficient.</p><p>Another consideration when explicitly defining buffer sizes is that the
larger the buffer, the larger the <em>memory cost</em>. As such, programmers
should aim to keep the explicit buffer length limited to <strong>only</strong> the
maximum number of historical values the script will reference and <strong>not
more</strong>. For example, defining a 5000-bar buffer when a script only
requires 500 historical values will result in an unnecessary waste of
memory.</p><p></p></div></aside>
<h2 class="md-heading" id="tips"><a href="#tips">Tips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="working-around-profiler-overhead"><a href="#working-around-profiler-overhead">Working around Profiler overhead<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Since the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Pine Profiler</a> must perform <em>extra calculations</em> to collect performance
data, as explained in
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#a-look-into-the-profilers-inner-workings">this section</a>, the time it takes to execute a script <strong>increases</strong> while
profiling.</p>
<p>Most scripts will run as expected with the Profiler’s overhead
included. However, when a complex script’s runtime approaches a
<a href="https://www.tradingview.com/support/solutions/43000579793/">plan’s
limit</a>,
using the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Profiler</a> on it may cause its runtime to <em>exceed</em> the limit. Such a
case indicates that the script likely needs
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#optimization">optimization</a>, but it can be challenging to know where to start without
being able to
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#profiling-a-script">profile the code</a>. The most effective workaround in this scenario is reducing
the number of bars the script must execute on. Users can achieve this
reduction in any of the following ways:</p>
<ul>
<li>Selecting a dataset that has fewer data points in its history, e.g.,
a higher timeframe or a symbol with limited data</li>
<li>Using conditional logic to limit code executions to a specific time
or bar range</li>
<li>Including a <code dir="auto">calc_bars_count</code> argument in the script’s declaration
statement to specify how many recent historical bars it can use</li>
</ul>
<p>Reducing the number of data points works in most cases because it
directly decreases the number of times the script must execute,
typically resulting in less accumulated runtime.</p>
<p>As a demonstration, this script contains a <code dir="auto">gcd()</code> function that uses a
<em>naive</em> algorithm to calculate the <a href="https://en.wikipedia.org/wiki/Greatest_common_divisor" rel="nofollow">greatest common
divisor</a> of two
integers. The function initializes its <code dir="auto">result</code> using the smallest
absolute value of the two numbers. Then, it reduces the value of the
<code dir="auto">result</code> by one within a
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
loop until it can divide both numbers without remainders. This structure
entails that the loop will iterate up to <em>N</em> times, where <em>N</em> is the
smallest of the two arguments.</p>
<p>In this example, the script plots the value of
<code dir="auto">gcd(10000, 10000 + bar_index)</code>. The smallest of the two arguments is
always 10,000 in this case, meaning the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
loop within the function will require up to 10,000 iterations per script
execution, depending on the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>
value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Script takes too long while profiling demo")

//@function Calculates the greatest common divisor of `a` and `b` using a naive algorithm.
gcd(int a, int b) =&gt;
    //@variable The greatest common divisor.
    int result = math.max(math.min(math.abs(a), math.abs(b)), 1)
    // Reduce the `result` by 1 until it divides `a` and `b` without remainders. 
    while result &gt; 0
        if a % result == 0 and b % result == 0
            break
        result -= 1
    // Return the `result`.
    result

plot(gcd(10000, 10000 + bar_index), "GCD")</code></div>
<p>When we add the script to our chart, it takes a while to execute across
our chart’s data, but it does not raise an error. However, <em>after</em>
enabling the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Profiler</a>, the script raises a runtime error stating that it exceeded
the Premium plan’s <a href="https://www.tradingview.com/support/solutions/43000579793/">runtime
limit</a> (40
seconds):</p>
<p><div class="image-container"><img alt="image" decoding="async" height="590" loading="lazy" src="images/c5bb34edac43bbc2cf59e82f42b1a7e4.webp" width="1072"/></div></p>
<p>Our current chart has over 20,000 historical bars, which may be too many
for the script to handle within the alloted time while the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Profiler</a> is active. We can try limiting the number of historical
executions to work around the issue in this case.</p>
<p>Below, we included <code dir="auto">calc_bars_count = 10000</code> in the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
function, which limits the script’s available history to the most
recent 10,000 historical bars. After restricting the script’s
historical executions, it no longer exceeds the Premium plan’s limit
while profiling, so we can now inspect its performance results:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="590" loading="lazy" src="images/cae3dc2750ed6e4d8b5d5348a9f3280d.webp" width="1072"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Script takes too long while profiling demo", calc_bars_count = 10000)

//@function Calculates the greatest common divisor of `a` and `b` using a naive algorithm.
gcd(int a, int b) =&gt;
    //@variable The greatest common divisor.
    int result = math.max(math.min(math.abs(a), math.abs(b)), 1)
    // Reduce the `result` by 1 until it divides `a` and `b` without remainders.
    while result &gt; 0
        if a % result == 0 and b % result == 0
            break
        result -= 1
    // Return the `result`.
    result

plot(gcd(10000, 10000 + bar_index), "GCD")</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This process may require trial and error, as determining the number of
executions that a computationally heavy script can handle before timing
out is not necessarily straightforward. If a script takes too long to
execute after enabling the
<a href="/pine-script-docs/v5/writing/profiling-and-optimization/#pine-profiler">Profiler</a>, experiment with different ways to limit its executions
until you can profile it successfully.</p></div></aside> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/debugging"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Debugging  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/publishing"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Publishing scripts <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/writing/style-guide">Writing scripts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Publishing scripts</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="writing-scripts-publishing-scripts"><a href="#publishing-scripts">Publishing scripts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<p>Programmers who wish to share their Pine scripts with other traders can
publish them.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>If you write scripts for your personal use, there is no need to publish
them; you can save them in the Pine Editor and use the “Add to Chart”
button to add your script to your chart.</p></div></aside>
<h2 class="md-heading" id="script-visibility-and-access"><a href="#script-visibility-and-access">Script visibility and access<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>When you publish a script, you control its <strong>visibility</strong> and
<strong>access</strong>:</p>
<ul>
<li><strong>Visibility</strong> is controlled by choosing to publish <strong>publicly</strong> or
<strong>privately</strong>. See <a href="https://www.tradingview.com/support/solutions/43000548335">How do private ideas and scripts differ from
public
ones?</a> in
the Help Center for more details. Publish publicly when you have
written a script you think can be useful to TradingViewers. Public
scripts are subject to moderation. To avoid moderation, ensure your
publication complies with our <a href="https://www.tradingview.com/support/solutions/43000591638">House
Rules</a>
and <a href="https://www.tradingview.com/support/solutions/43000590599">Script Publishing
Rules</a>.
Publish privately when you don’t want your script visible to all
other users, but want to share it with a few friends.</li>
<li><strong>Access</strong> determines if users will see your source code, and how
they will be able to use your script. There are three access types:
<em>open</em>, <em>protected</em> (reserved to paid accounts) or <em>invite-only</em>
(reserved to Premium accounts). See <a href="https://www.tradingview.com/support/solutions/43000482573">What are the different types of
published
scripts?</a>
in the Help Center for more details.</li>
</ul>
<h3 class="md-heading" id="when-you-publish-a-script"><a href="#when-you-publish-a-script">When you publish a script<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<ul>
<li>The publication’s title is determined by the argument used for the
<code dir="auto">title</code> parameter in the script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement. That title is also used when TradingViewers
search for script names.</li>
<li>The name of your script on the chart will be the argument used for
the <code dir="auto">shorttitle</code> parameter in the script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement, or the [title] argument in
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>.</li>
<li>Your script must have a description explaining what your script does
and how to use it.</li>
<li>The chart you are using when you publish will become visible in your
publication, including any other scripts or drawings on it. Remove
unrelated scripts or drawings from your chart before publishing your
script.</li>
<li>Your script’s code can later be updated. Each update can include
<em>release notes</em> which will appear, dated, under your original
description.</li>
<li>Scripts can be liked, shared, commented on or reported by other
users.</li>
<li>Your published scripts appear under the “SCRIPTS” tab of your user
profile.</li>
<li>A <em>script widget</em> and a <em>script page</em> are created for your script.
The script widget is your script’s placeholder showing in script
feeds on the platform. It contains your script’s title, chart and
the first few lines of your description. When users click on your
script <strong>widget</strong>, the script’s <strong>page</strong> opens. It contains all the
information relating to your script.</li>
</ul>
<h3 class="md-heading" id="visibility"><a href="#visibility">Visibility<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<h4 class="md-heading" id="public"><a href="#public">Public<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When you publish a public script:</p>
<ul>
<li>Your script will be inluded in our <a href="https://www.tradingview.com/scripts/">Community
Scripts</a> where it becomes
visible to the millions of TradingViewers on all internationalized
versions of the site.</li>
<li>Your publication must comply with <a href="https://www.tradingview.com/support/solutions/43000591638">House
Rules</a>
and <a href="https://www.tradingview.com/support/solutions/43000590599">Script Publishing
Rules</a>.</li>
<li>If your script is an invite-only script, you must comply with our
<a href="https://www.tradingview.com/support/solutions/43000549951">Vendor
Requirements</a>.</li>
<li>It becomes accessible through the search functions for scripts.</li>
<li>You will not be able to edit your original description or its title,
nor change its public/private visibility, nor its access type
(open-source, protected, invite-only).</li>
<li>You will not be able to delete your publication.</li>
</ul>
<h4 class="md-heading" id="private"><a href="#private">Private<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>When you publish a private script:</p>
<ul>
<li>It will not be visible to other users unless you share its url with
them.</li>
<li>It is visible to you from your user profile’s “SCRIPTS” tab.</li>
<li>Private scripts are identifiable by the “X” and “lock” icons in
the top-right of their widget. The “X” is used to delete it.</li>
<li>It is not moderated, unless you sell access to it or make it
available publicly, as it is then no longer “private”.</li>
<li>You can update its original description and title.</li>
<li>You cannot link to or mentioned it from any public TradingView
content (ideas, script descriptions, comments, chats, etc.).</li>
<li>It is not accessible through the search functions for scripts.</li>
</ul>
<h3 class="md-heading" id="access"><a href="#access">Access<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Public or private scripts can be published using one of three access
types: open, protected or invite-only. The access type you can select
from will vary with the type of account you hold.</p>
<h4 class="md-heading" id="open"><a href="#open">Open<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The Pine Script™ code of scripts published <strong>open</strong> is visible to all
users. Open-source scripts on TradingView use the Mozilla license by
default, but you may choose any license you want. You can find
information on licensing at
<a href="https://help.github.com/articles/licensing-a-repository/" rel="nofollow">GitHub</a>.</p>
<h4 class="md-heading" id="protected"><a href="#protected">Protected<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The code of <strong>protected</strong> scripts is hidden from view and no one but its
author can access it. While the script’s code is not accessible,
protected scripts can be used freely by any user. Only accounts with paid plans may publish public protected scripts.</p>
<h4 class="md-heading" id="invite-only"><a href="#invite-only">Invite-only<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <strong>invite-only</strong> access type protects both the script’s code and its
use. The publisher of an invite-only script must explicitly grant access
to individual users. Invite-only scripts are mostly used by script
vendors providing paid access to their scripts. Only Premium accounts
can publish invite-only scripts, and they must comply with our <a href="https://www.tradingview.com/support/solutions/43000549951">Vendor
Requirements</a>.</p>
<p>TradingView does not benefit from script sales. Transactions concerning
invite-only scripts are strictly between users and vendors; they do not
involve TradingView.</p>
<p>Public invite-only scripts are the only scripts for which vendors are
allowed to ask for payment on TradingView.</p>
<p>On their invite-only script’s page, authors will see a “Manage
Access” button. The “Manage Access” window allows authors to control
who has access to their script.</p>
<p><div class="image-container"><img alt="PublishingScripts-Access-1" decoding="async" height="1142" loading="lazy" src="images/acd3fcdfa573129468e8f5c2a3c6b9c4.webp" width="1688"/></div></p>
<h2 class="md-heading" id="preparing-a-publication"><a href="#preparing-a-publication">Preparing a publication<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<ol>
<li>
<p>Even if you intend to publish publicly, it is always best to start
with a private publication because you can use it to validate what
your final publication will look like. You can edit the title,
description, code or chart of private publications, and contrary to
public scripts, you can delete private scripts when you don’t need
them anymore, so they are the perfect way to practice before sharing
a script publicly. You can read more about preparing script
descriptions in the <a href="https://www.tradingview.com/chart/SSP/aOYEvBxw-How-We-Write-and-Format-Script-Descriptions/">How We Write and Format Script
Descriptions</a>
publication.</p>
</li>
<li>
<p>Prepare your chart. Load your script on the chart and remove other
scripts or drawings that won’t help users understand your script.
Your script’s plots should be easy to identify on the chart that
will be published with it.</p>
</li>
<li>
<p>Load your code in the Pine Editor if it isn’t already. In the
Editor, click the “Publish Script” button:</p>
<p><div class="image-container"><img alt="PublishingScripts-PreparingAPublication-1" decoding="async" height="302" loading="lazy" src="images/399568c45bbffbb94d4f3ad7dfcc7261.webp" width="1235"/></div></p>
</li>
<li>
<p>A popup appears to remind you that if you publish publicly, it’s
important that your publication comply with House Rules. Once
you’re through the popup, place your description in the field below
the script’s title. The default title proposed for your publication
is the <code dir="auto">title</code> field from your script’s code. It is always best to
use that title; it makes it easier for users to search for your
script if it is public. Select the visibility of your publication.
We want to publish a private publication, so we check the “Private
Script” checkbox at the bottom-right of the “Publish Script”
window:</p>
<p><div class="image-container"><img alt="PublishingScripts-PreparingAPublication-2" decoding="async" height="1403" loading="lazy" src="images/f68648a2f50021e9b31034d06c3ae454.webp" width="1577"/></div></p>
</li>
<li>
<p>Select the access type you want for your script: Open, Protected or
Invite-only. We have selected “Open” for open-source.</p>
<p><div class="image-container"><img alt="PublishingScripts-PreparingAPublication-3" decoding="async" height="629" loading="lazy" src="images/1cb27c82f0a97d54cee191b2516db10e.webp" width="1576"/></div></p>
</li>
<li>
<p>Select the appropriate categories for your script (at least one is
mandatory) and enter optional custom tags.</p>
<p><div class="image-container"><img alt="PublishingScripts-PreparingAPublication-4" decoding="async" height="794" loading="lazy" src="images/76d360d70aaf661c086723ab0fbe7be5.webp" width="1572"/></div></p>
</li>
<li>
<p>Click the “Publish Private Script” button in the lower-right of
the window. When the publication is complete, your published
script’s page will appear. You are done! You can confirm the
publication by going to your User Profile and viewing your
“SCRIPTS” tab. From there, you will be able to open your script’s
page and edit your private publication by using the “Edit” button
in the top-right of your script’s page. Note that you can also
update private publications, just like you can public ones. If you
want to share your private publication with a friend, privately send
her the url from your script’s page. Remember you are not allowed
to share links to private publications in public TradingView
content.</p>
</li>
</ol>
<h2 class="md-heading" id="publishing-a-script"><a href="#publishing-a-script">Publishing a script<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Whether you intend to publish privately or publicly, first follow the
steps in the previous section. If you intend to publish privately, you
will be done. If you intend to publish publicly and are satisfied with
the preparatory process of validating your private publication, follow
the same steps as above but do not check the “Private Script” checkbox
and click the “Publish Public Script” button at the bottom-right of
the “Publish Script” page.</p>
<p>When you publish a new public script, you have a 15-minute window to
make changes to your description or delete the publication. After that
you will no longer be able to change your publication’s title,
description, visiblity or access type. If you make an error, send a
message to the <a href="https://www.tradingview.com/u/PineCoders/">PineCoders</a>
moderator account; they moderate script publications and will help.</p>
<h2 class="md-heading" id="updating-a-publication"><a href="#updating-a-publication">Updating a publication<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>You can update both public or private script publications. When you
update a script, its code must be different than the previously
published version’s code. You can add release notes with your update.
They will appear after your script’s original description in the
script’s page.</p>
<p>By default, the chart used when you update will replace the previous
chart in your script’s page. You can choose not to update your script
page’s chart, however. Note that while you can update the chart
displayed in the script’s page, the chart from the script’s widget
will not update.</p>
<p>In the same way you can validate a public publication by first
publishing a private script, you can also validate an update on a
private publication before proceeding with it on your public one. The
process of updating a published script is the same for public and
private scripts.</p>
<p>If you intend to update both the code and chart of your published
script, prepare your chart the same way you would for a new publication.
In the following example, we will <strong>not</strong> be updating the publication’s
chart:</p>
<ol>
<li>
<p>As you would for a new publication, load your script in the Editor
and click the “Publish Script” button.</p>
</li>
<li>
<p>Once in the “Publish Script” window, select the “Update Existing
Script” button. Then select the script to update from the “Choose
script” dropdown menu:</p>
<p><div class="image-container"><img alt="PublishingScripts-UpdatingAPublication-1" decoding="async" height="402" loading="lazy" src="images/189f88e7c5001de199e16d61624090b5.webp" width="1577"/></div></p>
</li>
<li>
<p>Enter your release notes in the text field. The differences in your
code are highlighted below your release notes.</p>
</li>
<li>
<p>We do not want to update the publication’s chart, so we check the
“Don’t update the chart” checkbox:</p>
<p><div class="image-container"><img alt="PublishingScripts-UpdatingAPublication-2" decoding="async" height="1404" loading="lazy" src="images/6ba7ab91b2104a3b869c852e4123c49b.webp" width="1579"/></div></p>
</li>
<li>
<p>Click the “Publish New Version” button. You’re done.</p>
</li>
</ol> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/profiling-and-optimization"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Profiling and optimization  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/limitations"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Limitations <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/writing/style-guide">Writing scripts</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Limitations</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="writing-scripts-limitations"><a href="#limitations">Limitations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="introduction"><a href="#introduction">Introduction<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>As is mentioned in our <a href="/pine-script-docs/v5/welcome/">Welcome</a> page:</p>
<blockquote>
<p><em>Because each script uses computational resources in the cloud, we
must impose limits in order to share these resources fairly among our
users. We strive to set as few limits as possible, but will of course
have to implement as many as needed for the platform to run smoothly.
Limitations apply to the amount of data requested from additional
symbols, execution time, memory usage and script size.</em></p>
</blockquote>
<p>If you develop complex scripts using Pine Script™, sooner or later you
will run into some of the limitations we impose. This section provides
you with an overview of the limitations that you may encounter. There
are currently no means for Pine Script™ programmers to get data on the
resources consumed by their scripts. We hope this will change in the
future.</p>
<p>In the meantime, when you are considering large projects, it is safest
to make a proof of concept in order to assess the probability of your
script running into limitations later in your project.</p>
<p>Below, we describe the limits imposed in the Pine Script™ environment.</p>
<h2 class="md-heading" id="time"><a href="#time">Time<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="script-compilation"><a href="#script-compilation">Script compilation<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts must compile before they are executed on charts. Compilation
occurs when you save a script from the Pine Editor or when you add a
script to the chart. A two-minute limit is imposed on compilation time,
which will depend on the size and complexity of your script, and whether
or not a cached version of a previous compilation is available. When a
compile exceeds the two-minute limit, a warning is issued. Heed that
warning by shortening your script because after three consecutives
warnings a one-hour ban on compilation attempts is enforced. The first
thing to consider when optimizing code is to avoid repetitions by using
functions to encapsulate oft-used segments, and call functions instead
of repeating code.</p>
<h3 class="md-heading" id="script-execution"><a href="#script-execution">Script execution<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Once a script is compiled it can be executed. See the
<a href="/pine-script-docs/v5/language/execution-model/#events-triggering-the-execution-of-a-script">Events triggering the execution of a script</a> for a list of the events triggering the execution of a
script. The time allotted for the script to execute on all bars of a
dataset varies with account types. The limit is 20 seconds for basic
accounts, 40 for others.</p>
<h3 class="md-heading" id="loop-execution"><a href="#loop-execution">Loop execution<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The execution time for any loop on any single bar is limited to 500
milliseconds. The outer loop of embedded loops counts as one loop, so it
will time out first. Keep in mind that even though a loop may execute
under the 500 ms time limit on a given bar, the time it takes to execute
on all the dataset’s bars may nonetheless cause your script to exceed
the total execution time limit. For example, the limit on total
execution time will make it impossible for you script to execute a 400
ms loop on each bar of a 20,000-bar dataset because your script would
then need 8000 seconds to execute.</p>
<h2 class="md-heading" id="chart-visuals"><a href="#chart-visuals">Chart visuals<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="plot-limits"><a href="#plot-limits">Plot limits<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A maximum of 64 plot counts are allowed per script. The functions that
generate plot counts are:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotarrow">plotarrow()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_bgcolor">bgcolor()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
but only if its <code dir="auto">color</code> is of the
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_series">series</a>
form.</li>
</ul>
<p>The following functions do not generate plot counts:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line%7Bdot%7Dnew">line.new()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label%7Bdot%7Dnew">label.new()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_table%7Bdot%7Dnew">table.new()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_box%7Bdot%7Dnew">box.new()</a></li>
</ul>
<p>One function call can generate up to seven plot counts, depending on the
function and how it is called. When your script exceeds the maximum of
64 plot counts, the runtime error message will display the plot count
generated by your script. Once you reach that point, you can determine
how many plot counts a function call generates by commenting it out in a
script. As long as your script still throws an error, you will be able
to see how the actual plot count decreases after you have commented out
a line.</p>
<p>The following example shows different function calls and the number of
plot counts each one will generate:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plot count example")

bool isUp = close &gt; open
color isUpColor = isUp ? color.green : color.red
bool isDn = not isUp
color isDnColor = isDn ? color.red : color.green

// Uses one plot count each.
p1 = plot(close, color = color.white)
p2 = plot(open, color = na)

// Uses two plot counts for the `close` and `color` series.
plot(close, color = isUpColor)

// Uses one plot count for the `close` series.
plotarrow(close, colorup = color.green, colordown = color.red)

// Uses two plot counts for the `close` and `colorup` series.
plotarrow(close, colorup = isUpColor)

// Uses three plot counts for the `close`, `colorup`, and the `colordown` series.
plotarrow(close - open, colorup = isUpColor, colordown = isDnColor)

// Uses four plot counts for the `open`, `high`, `low`, and `close` series.
plotbar(open, high, low, close, color = color.white)

// Uses five plot counts for the `open`, `high`, `low`, `close`, and `color` series.
plotbar(open, high, low, close, color = isUpColor)

// Uses four plot counts for the `open`, `high`, `low`, and `close` series.
plotcandle(open, high, low, close, color = color.white, wickcolor = color.white, bordercolor = color.purple)

// Uses five plot counts for the `open`, `high`, `low`, `close`, and `color` series.
plotcandle(open, high, low, close, color = isUpColor, wickcolor = color.white, bordercolor = color.purple)

// Uses six plot counts for the `open`, `high`, `low`, `close`, `color`, and `wickcolor` series.
plotcandle(open, high, low, close, color = isUpColor, wickcolor = isUpColor , bordercolor = color.purple)

// Uses seven plot counts for the `open`, `high`, `low`, `close`, `color`, `wickcolor`, and `bordercolor` series.
plotcandle(open, high, low, close, color = isUpColor, wickcolor = isUpColor , bordercolor = isUp ? color.lime : color.maroon)

// Uses one plot count for the `close` series.
plotchar(close, color = color.white, text = "|", textcolor = color.white)

// Uses two plot counts for the `close`` and `color` series.
plotchar(close, color = isUpColor, text = "—", textcolor = color.white)

// Uses three plot counts for the `close`, `color`, and `textcolor` series.
plotchar(close, color = isUpColor, text = "O", textcolor = isUp ? color.yellow : color.white)

// Uses one plot count for the `close` series.
plotshape(close, color = color.white, textcolor = color.white)

// Uses two plot counts for the `close` and `color` series.
plotshape(close, color = isUpColor, textcolor = color.white)

// Uses three plot counts for the `close`, `color`, and `textcolor` series.
plotshape(close, color = isUpColor, textcolor = isUp ? color.yellow : color.white)

// Uses one plot count.
alertcondition(close &gt; open, "close &gt; open", "Up bar alert")

// Uses one plot count.
bgcolor(isUp ? color.yellow : color.white)

// Uses one plot count for the `color` series.
fill(p1, p2, color = isUpColor)</code></div>
<p>This example generates a plot count of 56. If we were to add two more
instances of the last call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>,
the script would throw an error stating that the script now uses 70 plot
counts, as each additional call to
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>
generates seven plot counts, and 56 + (7 * 2) is 70.</p>
<h3 class="md-heading" id="line-box-polyline-and-label-limits"><a href="#line-box-polyline-and-label-limits">Line, box, polyline, and label limits<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Contrary to <a href="/pine-script-docs/v5/concepts/plots/">plots</a>, which can
cover the chart’s entire dataset, scripts will only show the last 50
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#boxes">boxes</a>,
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#polylines">polylines</a>,
and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on
the chart by default. One can increase the maximum number for each of
these
<a href="/pine-script-docs/v5/language/type-system/#drawing-types">drawing types</a> via the <code dir="auto">max_lines_count</code>, <code dir="auto">max_boxes_count</code>,
<code dir="auto">max_polylines_count</code>, and <code dir="auto">max_labels_count</code> parameters of the
script’s
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement. The maximum number of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_line">line</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_box">box</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
IDs is 500, and the maximum number of
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_polyline">polyline</a>
IDs is 100.</p>
<p>In this example, we set the maximum number of recent labels shown on the
chart to 100:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Label limits example", max_labels_count = 100, overlay = true)
label.new(bar_index, high, str.tostring(high, format.mintick))</code></div>
<p>It’s important to note when setting any of a drawing object’s
properties to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> that
its ID still exists and thus contributes to a script’s drawing totals.
To demonstrate this behavior, the following script draws a “Buy” and
“Sell”
<a href="https://www.tradingview.com/pine-script-reference/v5/#type_label">label</a>
on each bar, with <code dir="auto">x</code> values determined by the <code dir="auto">longCondition</code> and
<code dir="auto">shortCondition</code> variables.</p>
<p>The “Buy” label’s <code dir="auto">x</code> value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> when
the bar index is even, and the “Sell” label’s <code dir="auto">x</code> value is
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> when
the bar index is odd. Although the <code dir="auto">max_labels_count</code> is 10 in this
example, we can see that the script displays fewer than 10
<a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> on the
chart since the ones with
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
values also count toward the total:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="455" loading="lazy" src="images/1019417d770bad212bda897784b180ee.webp" width="1395"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// Approximate maximum number of label drawings
MAX_LABELS = 10

indicator("labels with na", overlay = false, max_labels_count = MAX_LABELS)

// Add background color for the last MAX_LABELS bars.
bgcolor(bar_index &gt; last_bar_index - MAX_LABELS ? color.new(color.green, 80) : na)

longCondition =  bar_index % 2 != 0
shortCondition = bar_index % 2 == 0

// Add "Buy" and "Sell" labels on each new bar.
label.new(longCondition ? bar_index : na,  0, text = "Buy", color = color.new(color.green, 0), style = label.style_label_up)
label.new(shortCondition ? bar_index : na, 0, text = "Sell", color = color.new(color.red, 0), style = label.style_label_down)

plot(longCondition  ? 1 : 0)
plot(shortCondition ? 1 : 0)</code></div>
<p>To display the desired number of labels, we must eliminate label
drawings we don’t want to show rather than setting their properties to
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>. The
example below uses an
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structure to conditionally draw the “Buy” and “Sell” labels,
preventing the script from creating new label IDs when it isn’t
necessary:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="451" loading="lazy" src="images/0ce38a18bea33a9350042b7da6a8b90b.webp" width="1398"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// Approximate maximum number of label drawings
MAX_LABELS = 10

indicator("conditional labels", overlay = false, max_labels_count = MAX_LABELS)

// Add background color for the last MAX_LABELS bars.
bgcolor(bar_index &gt; last_bar_index - MAX_LABELS ? color.new(color.green, 80) : na)

longCondition =  bar_index % 2 != 0
shortCondition = bar_index % 2 == 0

// Add a "Buy" label when `longCondition` is true.
if longCondition
    label.new(bar_index,  0, text = "Buy", color = color.new(color.green, 0), style = label.style_label_up)
// Add a "Sell" label when `shortCondition` is true.
if shortCondition
    label.new(bar_index, 0, text = "Sell", color = color.new(color.red, 0), style = label.style_label_down)

plot(longCondition  ? 1 : 0)
plot(shortCondition ? 1 : 0)</code></div>
<h3 class="md-heading" id="table-limits"><a href="#table-limits">Table limits<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can display a maximum of nine
<a href="/pine-script-docs/v5/concepts/tables/">tables</a> on the chart, one
for each of the possible locations:
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dbottom_center">position.bottom_center</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dbottom_left">position.bottom_left</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dbottom_right">position.bottom_right</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dmiddle_center">position.middle_center</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dmiddle_left">position.middle_left</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dmiddle_right">position.middle_right</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dtop_center">position.top_center</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dtop_left">position.top_left</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#const_position%7Bdot%7Dtop_right">position.top_right</a>.
When attempting to place two tables in the same location, only the
newest instance will show on the chart.</p>
<h2 class="md-heading" id="request-calls"><a href="#request-calls">`request.*()` calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="number-of-calls"><a href="#number-of-calls">Number of calls<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A script can use up to 40 <em>unique</em> calls to the functions in the <code dir="auto">request.*()</code> namespace. A subsequent call to the same <code dir="auto">request.*()</code> function with the same arguments is not unique. This limitation applies when using any <code dir="auto">request.*()</code> functions, including:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.currency_rate">request.currency_rate()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.dividends">request.dividends()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.splits">request.splits()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.quandl">request.quandl()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.financial">request.financial()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.economic">request.economic()</a></li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a></li>
</ul>
<p>When a script executes two or more identical <code dir="auto">request.*()</code> function calls, only the <em>first</em> call counts toward this limit. The repeated calls do not count because they <em>reuse</em> the data from the first call rather than executing a redundant request. Note that when a script imports <a href="/pine-script-docs/v5/concepts/libraries/">library</a> functions containing <code dir="auto">request.*()</code> calls within their scopes, those calls <strong>do</strong> count toward this limit, even if the script already calls the same <code dir="auto">request.*()</code> function with the same arguments in its main scope.</p>
<p>The script below calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> with the same arguments 50 times within a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a> loop. Although the script contains more than 40 <code dir="auto">request.*()</code> calls, it <em>does not</em> raise an error because each call is <strong>identical</strong>. In this case, it reuses the data from the first iteration’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call for the repeated calls on all subsequent iterations:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`request.*()` call limit demo", dynamic_requests = true)

//@variable The sum of values requested from all `request.security()` calls.
float reqSum = 0.0

// Call `request.security()` 50 times within a loop. 
// More than 40 `request.*()` calls occur, but each call is identical. Redundant calls do not count toward the limit. 
for i = 1 to 50
    reqSum += request.security(syminfo.tickerid, "1D", close)

plot(reqSum)</code></div>
<p>Here, we modified the above script to call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> with a different <code dir="auto">timeframe</code> argument on each iteration, meaning all 50 calls are now <strong>unique</strong>. This time, the script will reach the <code dir="auto">request.*()</code> call limit while executing the loop and raise a runtime error because it requests a <em>distinct</em> dataset on each iteration:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`request.*()` call limit demo", dynamic_requests = true)

//@variable The sum of values requested from all `request.security()` calls.
float reqSum = 0.0

// Call `request.security()` 50 times within a loop with different `timeframe` arguments. 
// This loop causes a runtime error when `i == 41` because each iteration executes a unique request.
for i = 1 to 50
    reqSum += request.security(syminfo.tickerid, str.tostring(i), close)

plot(reqSum)</code></div>
<p>Note that:</p>
<ul>
<li>These example scripts can call <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> within a loop and allow “series string” <code dir="auto">timeframe</code> arguments because we included <code dir="auto">dynamic_requests = true</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration statement. See <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#dynamic-requests">this section</a> of the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data">Other timeframes and data</a> page for more information.</li>
</ul>
<h3 class="md-heading" id="intrabars"><a href="#intrabars">Intrabars<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can retrieve up to the most recent 200,000 <em>intrabars</em>
(lower-timeframe bars) via the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> functions, depending on the user’s plan:</p>
<ul>
<li>All non-professional plans — Basic, Essential, Plus, and Premium — can request up to 100K bars of data.</li>
<li>Expert plans have access to 125K bars of data.</li>
<li>Elite plans get 150K bars of data.</li>
<li>Ultimate plans can request 200K lower timeframe bars.</li>
</ul>
<p>The <code dir="auto">request.*()</code> functions limit requested data via the <code dir="auto">calc_bars_count</code> parameter. If this parameter is not specified, the default is used, which is 100,000 bars. If the plan permits more, this limit can be increased by passing a greater value.</p>
<p>The number of bars on the chart’s timeframe covered by 100,000
intrabars varies with the number of intrabars each chart bar contains.
For example, requesting data from the 1-minute timeframe while running
the script on a 60-minute chart means each chart bar can contain up to
60 intrabars. In this case, the minimum number of chart bars covered by
the intrabar request is 1,666, as 100,000 / 60 = 1,666.67. It’s
important to note, however, that a provider may not report data for
<em>every</em> minute within an hour. Therefore, such a request may cover more
chart bars, depending on the available data.</p>
<h3 class="md-heading" id="tuple-element-limit"><a href="#tuple-element-limit">Tuple element limit<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>All the <code dir="auto">request.*()</code> function calls in a script taken together cannot
return more than 127 tuple elements. When the combined tuple size of all
<code dir="auto">request.*()</code> calls will exceed 127 elements, one can instead utilize
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types (UDTs)</a> to request a greater number of values.</p>
<p>The example below outlines this limitation and the way to work around
it. The first
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call represents using a tuple with 128 elements as the <code dir="auto">expression</code>
argument. Since the number of elements is greater than 127, it would
result in an error.</p>
<p>To avoid the error, we can use those same values as <em>fields</em> within an
<a href="/pine-script-docs/v5/language/objects/">object</a> of a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">UDT</a>
and pass its ID to the <code dir="auto">expression</code> instead:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Tuple element limit")

s1 = close
s2 = close * 2
...
s128 = close * 128

// Causes an error. 
[v1, v2, v3, ..., v128] = request.security(syminfo.tickerid, "1D", [s1, s2, s3, ..., s128])

// Works fine:
type myType
    float v1
    float v2
    float v3
    ...
    float v128

myObj = request.security(syminfo.tickerid, "1D", myType.new(s1, s2, s3, ..., s128))</code></div>
<p>Note that:</p>
<ul>
<li>This example outlines a scenario where the script tries to
evaluate 128 tuple elements in a single
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
call. The same limitation applies if we were to split the tuple
request across <em>multiple</em> calls. For example, two
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
calls that each retrieve a tuple with 64 elements will also
cause an error.</li>
</ul>
<h2 class="md-heading" id="script-size-and-memory"><a href="#script-size-and-memory">Script size and memory<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="compiled-tokens"><a href="#compiled-tokens">Compiled tokens<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Before the execution of a script, the compiler translates it into a
tokenized <em>Intermediate Language</em> (IL). Using an IL allows Pine Script™
to accommodate larger scripts by applying various memory and performance
optimizations. The compiler determines the size of a script based on the
<em>number of tokens</em> in its IL form, <strong>not</strong> the number of characters or
lines in the code viewable in the Pine Editor.</p>
<p>The compiled form of each indicator, strategy, and library script is
limited to 80,000 tokens. When a script imports libraries, the total
number of tokens from all imported libraries cannot exceed 1 million.
There is no way to inspect a script’s compiled form, nor its IL token
count. As such, you will only know your script exceeds the size limit
when the compiler reaches it.</p>
<p>In most cases, a script’s compiled size will likely not reach the
limit. However, if a compiled script does reach the token limit, the
most effective ways to decrease compiled tokens are to reduce repetitive
code, encapsulate redundant calls within functions, and utilize
<a href="/pine-script-docs/v5/concepts/libraries/">libraries</a> when possible.</p>
<p>It’s important to note that the compilation process omits any <em>unused</em>
variables, functions, types, etc. from the final IL form, where
“unused” refers to anything that <em>does not</em> affect the script’s
outputs. This optimization prevents superfluous elements in the code
from contributing to the script’s IL token count.</p>
<p>For example, the script below declares a
<a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> and a
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">user-defined method</a> and defines a sequence of calls using them:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
plot(close)

type myType
    float field = 10.0

method m(array&lt;myType&gt; a, myType v) =&gt;
    a.push(v)

var arr = array.new&lt;myType&gt;()
arr.push(myType.new(25))
arr.m(myType.new())</code></div>
<p>Despite the inclusion of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;myType&gt;()</a>,
<code dir="auto">myType.new()</code>, and <code dir="auto">arr.m()</code> calls in the script, the only thing
actually <strong>output</strong> by the script is <code dir="auto">plot(close)</code>. The rest of the code
does not affect the output. Therefore, the compiled form of this script
will have the <em>same</em> number of tokens as:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
plot(close)</code></div>
<h3 class="md-heading" id="variables-per-scope"><a href="#variables-per-scope">Variables per scope<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Scripts can contain up to 1,000 variables in each of its scopes. Pine
scripts always contain one global scope, represented by non-indented
code, and they may contain zero or more local scopes. Local scopes are
sections of indented code representing procedures executed within
<a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>, as well as
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_switch">switch</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for">for</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_while">while</a>
structures, which allow for one or more local blocks. Each local block
counts as one local scope.</p>
<p>The branches of a conditional expression using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_%7Bquestion%7D%7Bcolon%7D">?:</a>
ternary operator do not count as local blocks.</p>
<h3 class="md-heading" id="scope-count"><a href="#scope-count">Scope count<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The total number of scopes in a script, including its global scope and
each local scope from the
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined functions</a>,
<a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>,
<a href="/pine-script-docs/v5/language/conditional-structures/">conditional structures</a> it
uses, cannot exceed 550.</p>
<p>It’s important to note that the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>,
and
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.seed">request.seed()</a>
functions <em>duplicate</em> the scopes required to evaluate the values of
their <code dir="auto">expression</code> argument in another context. The scopes produced by
each call to these <code dir="auto">request.*()</code> functions also count toward the
script’s scope limit.</p>
<p>For example, suppose we created a script with a global variable that
depends on the local scopes of 300
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a>
structures. The total scope count for this script is <em>301</em> (1 global
scope + 300 local scopes):</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scopes demo")

var x = 0

if close &gt; 0
    x += 0
if close &gt; 1
    x += 1
// ... Repeat this `if close &gt; n` pattern until `n = 299`.
if close &gt; 299
    x += 299

plot(x)</code></div>
<p>Since the total number of scopes is within the limit, it will compile
successfully. Now, suppose we call
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>
to evaluate the value of <code dir="auto">x</code> from another context and
<a href="/pine-script-docs/v5/concepts/plots/">plot</a> its value as well. In
this case, it will effectively <em>double</em> the script’s scope count since
the value of <code dir="auto">x</code> depends on <em>all</em> the script’s scopes:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scopes demo")

var x = 0

if close &gt; 0
    x += 0
if close &gt; 1
    x += 1
// ... Repeat this `if close &gt; n` pattern until `n = 299`.
if close &gt; 299
    x += 299

plot(x)
plot(request.security(syminfo.tickerid, "1D", x)) // Causes compilation error since the scope count is now 602.</code></div>
<p>We can resolve this issue by encapsulating the
<a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> blocks
within a
<a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a>, as the scope of a function counts as one embedded scope:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scopes demo")

f() =&gt;
    var x = 0

    if close &gt; 0
        x += 0
    if close &gt; 1
        x += 1
    // ... Repeat this `if close &gt; n` pattern until `n = 299`.
    if close &gt; 299
        x += 299

plot(f())
plot(request.security(syminfo.tickerid, "1D", f())) // No compilation error.</code></div>
<h3 class="md-heading" id="compilation-request-size"><a href="#compilation-request-size">Compilation request size<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The size of the compilation request for a script cannot exceed 5MB. The compilation request is all of the information that is sent to the compiler. This information comprises the script itself and any libraries the script imports.</p>
<p>Unlike the limit for compiled tokens, the request size limit includes unused parts of code. This is because the script is not compiled yet, so any unused code has not yet been optimized out.</p>
<p>To reduce the compilation request size, you can:</p>
<ul>
<li>Reduce the size of the script by optimizing the code.</li>
<li>Reduce the number of script inputs (script inputs are counted separately).</li>
<li>Remove any imported libraries that are not needed.</li>
<li>Use smaller libraries. The entire library is sent for compilation, regardless of which functions are called.</li>
</ul>
<h3 class="md-heading" id="collections"><a href="#collections">Collections<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™ collections (<a href="/pine-script-docs/v5/language/arrays/">arrays</a>, <a href="/pine-script-docs/v5/language/matrices/">matrices</a>,
and <a href="/pine-script-docs/v5/language/maps/">maps</a>) can have a maximum
of 100,000 elements. Each key-value pair in a map contains two elements,
meaning <a href="/pine-script-docs/v5/language/maps/">maps</a> can contain a
maximum of 50,000 key-value pairs.</p>
<h2 class="md-heading" id="other-limitations"><a href="#other-limitations">Other limitations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="maximum-bars-back"><a href="#maximum-bars-back">Maximum bars back<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>References to past values using the
<a href="https://www.tradingview.com/pine-script-reference/v5/#op_op_%5B%5D">[]</a>
history-referencing operator are dependent on the size of the historical
buffer maintained by the Pine Script™ runtime, which is limited to a
maximum of 5000 bars. <a href="https://www.tradingview.com/support/solutions/43000587849">This Help Center
page</a>
discusses the historical buffer and how to change its size using either
the <code dir="auto">max_bars_back</code> parameter or the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a>
function.</p>
<h3 class="md-heading" id="maximum-bars-forward"><a href="#maximum-bars-forward">Maximum bars forward<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>When positioning drawings using <code dir="auto">xloc.bar_index</code>, it is possible to use
bar index values greater than that of the current bar as <em>x</em>
coordinates. A maximum of 500 bars in the future can be referenced.</p>
<p>This example shows how we use the [maxval] parameter in our
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input%7Bdot%7Dint">input.int()</a>
function call to cap the user-defined number of bars forward we draw a
projection line so that it never exceeds the limit:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Max bars forward example", overlay = true)

// This function draws a `line` using bar index x-coordinates.
drawLine(bar1, y1, bar2, y2) =&gt;
    // Only execute this code on the last bar.
    if barstate.islast
        // Create the line only the first time this function is executed on the last bar.
        var line lin = line.new(bar1, y1, bar2, y2, xloc.bar_index)
        // Change the line's properties on all script executions on the last bar.
        line.set_xy1(lin, bar1, y1)
        line.set_xy2(lin, bar2, y2)

// Input determining how many bars forward we draw the `line`.
int forwardBarsInput = input.int(10, "Forward Bars to Display", minval = 1, maxval = 500)

// Calculate the line's left and right points.
int   leftBar  = bar_index[2]
float leftY    = high[2]
int   rightBar = leftBar + forwardBarsInput
float rightY   = leftY + (ta.change(high)[1] * forwardBarsInput)

// This function call is executed on all bars, but it only draws the `line` on the last bar.
drawLine(leftBar, leftY, rightBar, rightY)</code></div>
<h3 class="md-heading" id="chart-bars"><a href="#chart-bars">Chart bars<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The number of bars appearing on charts is dependent on the amount of
historical data available for the chart’s symbol and timeframe, and on
the type of account you hold. When the required historical date is
available, the minimum number of chart bars is:</p>
<ul>
<li>40000 historical bars for the Ultimate plan.</li>
<li>30000 historical bars for the Elite plan.</li>
<li>25000 historical bars for the Expert plan.</li>
<li>20000 historical bars for the Premium plan.</li>
<li>10000 historical bars for Essential and Plus plans.</li>
<li>5000 historical bars for other plans.</li>
</ul>
<h3 class="md-heading" id="trade-orders-in-backtesting"><a href="#trade-orders-in-backtesting">Trade orders in backtesting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A maximum of 9000 orders can be placed when backtesting strategies. When
using Deep Backtesting, the limit is 1,000,000.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/writing/publishing"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Publishing scripts  </h4> </a> <span data-astro-cid-xgirumru=""></span> </div> </main><h1>FAQ</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Alerts</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-alerts"><a href="#alerts">Alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="how-do-i-make-an-alert-available-from-my-script"><a href="#how-do-i-make-an-alert-available-from-my-script">How do I make an alert available from my script?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In indicator scripts, there are two ways to define triggers for <a href="/pine-script-docs/v5/concepts/alerts/">alerts</a>:</p>
<ul>
<li>Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function</li>
<li>Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function</li>
</ul>
<p>In strategy scripts, there are also two ways to define alert triggers:</p>
<ul>
<li>Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function</li>
<li>Using <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">order fill events</a></li>
</ul>
<p>These methods make alert triggers available but do not <em>create</em> alerts directly. Users must create alerts using a script’s alert triggers by selecting the appropriate trigger in the “Condition” dropdown of the “Create Alert” dialog box.</p>
<p>Programmers can define multiple alert triggers of one or more types in a script.</p>
<h2 class="md-heading" id="how-are-the-types-of-alerts-different"><a href="#how-are-the-types-of-alerts-different">How are the types of alerts different?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<h3 class="md-heading" id="usability"><a href="#usability">Usability<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Any script can include calls to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> functions within their code. However, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> calls have no effect unless the script is an <em>indicator</em>. <a href="/pine-script-docs/v5/concepts/libraries">Libraries</a> can <em>export</em> functions containing <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> calls, but they cannot issue alert triggers directly.</p>
<p><a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">Order fill</a> alert triggers are available only from <a href="/pine-script-docs/v5/concepts/strategies/">strategies</a>.</p>
<h3 class="md-heading" id="options-for-creating-alerts"><a href="#options-for-creating-alerts">Options for creating alerts<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Each <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> call in an indicator script defines one distinct trigger and one corresponding option in the “Condition” dropdown menu of the “Create Alert” dialog box. If the user wants multiple alerts, they must create each one <em>separately</em>.</p>
<p>By contrast, if a script includes one or more <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function calls, only <em>one</em> option appears in the “Condition” dropdown menu, titled “Any alert() function call”. Selecting this option creates a <em>single alert</em> that activates based on the occurrences of <em>any</em> executed <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> call.</p>
<p>Similarly, for strategy scripts, the “Order fills and and alert() function calls” or “Order fills only” option in the “Condition” dropdown menu creates an alert that fires when <em>any</em> <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">order fill event</a> occurs.</p>
<h3 class="md-heading" id="how-alerts-activate"><a href="#how-alerts-activate">How alerts activate<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function operates exclusively in an indicator’s <a href="/pine-script-docs/v5/faq/programming/#what-does-scope-mean">global scope</a>. Scripts cannot include calls to this function within any <em>local block</em>, such as the <em>indented</em> code within an <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> structure. The function triggers an alert when its specified <code dir="auto">condition</code> is <code dir="auto">true</code>. Users can set the allowed <em>frequency</em> of the alert trigger using the “Frequency” field in the “Create Alert” dialog box.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function has no <code dir="auto">condition</code> parameter. Scripts trigger the alerts on any <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> call based on each call’s <code dir="auto">freq</code> argument. Therefore, programmers typically include such calls within the local scopes of <a href="/pine-script-docs/v5/language/conditional-structures">conditional structures</a> to control when they execute.</p>
<p>Order fill alert triggers are available from <a href="/pine-script-docs/v5/concepts/strategies/">strategies</a> <em>automatically</em> without requiring extra code. However, programmers can customize the default alert messages. These alerts fire on <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">order fill events</a>, which occur when the <a href="/pine-script-docs/v5/concepts/strategies/#broker-emulator">broker emulator</a> fills a strategy’s <em>orders</em>.</p>
<h3 class="md-heading" id="messages"><a href="#messages">Messages<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <code dir="auto">message</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function populates the “Message” field of the “Create Alert” dialog box with a default message, which script users can customize to suit their alert needs. It accepts a “const string” argument, meaning its value cannot change after compilation. However, the argument can include <a href="https://www.tradingview.com/support/solutions/43000531021-how-to-use-a-variable-value-in-alert/">placeholders</a> to make the message’s information <em>dynamic</em>.</p>
<p>The <code dir="auto">message</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function accepts a “series string” argument, allowing programmers to create <em>dynamic messages</em> that can include “string” representations of a script’s calculated values. Unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>, this function does not populate a “Message” field in the “Create Alert” dialog box, and it does not process placeholders. Programmers can allow users to customize <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> messages by creating <a href="/pine-script-docs/v5/concepts/inputs">inputs</a> in the script’s settings.</p>
<p>Order fill alerts have a default message that describes a strategy’s order fill event. This default message contains strategy-specific <a href="https://www.tradingview.com/support/solutions/43000531021-how-to-use-a-variable-value-in-alert/">placeholders</a>, which the alert replaces with current strategy information each time it fires. Programmers can override the default message using the <code dir="auto">//@strategy_alert_message</code> <a href="/pine-script-docs/v5/language/script-structure/#compiler-annotations">compiler annotation</a>, which allows text and strategy placeholders, but <em>not</em> script variables. Script users can edit the default message from the “Message” field in the “Create Alert” dialog.</p>
<p>The <code dir="auto">alert_message</code> parameter in a strategy’s <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement commands</a> allows programmers to define distinct messages for each order fill event. The parameter accepts “series string” values that can change on each event. To use the values from this parameter in a strategy’s order fill alerts, include the <code dir="auto">{{strategy.order.alert_message}}</code> placeholder in the <code dir="auto">//@strategy_alert_message</code> annotation, or include it in the “Message” field when creating an alert.</p>
<h3 class="md-heading" id="limitations"><a href="#limitations">Limitations<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function has some limitations:</p>
<ul>
<li>Each active alert condition counts toward the total number of alerts the user’s <a href="https://www.tradingview.com/pricing/">plan</a> allows.</li>
<li>Every <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> call contributes to the script’s <a href="/pine-script-docs/v5/writing/limitations/#plot-limits">plot count</a>.</li>
<li>Only indicators can issue alert triggers with this function. Other script types do not raise a compilation error when they include calls to this function in their code, but each call has <strong>no effect</strong>.</li>
</ul>
<p>By contrast, all calls to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function count as <strong>one</strong> alert, regardless of the number of calls in the code. In addition, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> calls <em>do not</em> contribute to a script’s plot count.</p>
<p>Similarly, if a user creates a strategy alert based on <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">order fill events</a>, it counts as <strong>one</strong> alert, even though it can fire multiple times with distinct messages from different order executions.</p>
<h3 class="md-heading" id="example-alertcondition-alert"><a href="#example-alertcondition-alert">Example `alertcondition()` alert<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>The script below demonstrates a simple <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> call that triggers alerts when the current bar’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> is above the value from the previous chart bar. It also uses a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a> call to indicate each bar where the <code dir="auto">triggerCondition</code> occurred:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Simple alert demo", overlay = true)
// Create condition to trigger alert.
bool triggerCondition = close &gt; close[1]
// Use `triggerCondition` for the `condition` parameter. 
// Define a title for the alert in the menu and a message to send with the alert. 
alertcondition(condition = triggerCondition, title = "Example `alertcondition` Alert", 
  message = "The example `alertcondition` alert was triggered.")
// Plot a shape when `triggerCondition` is true to visually mark where alerts occur.
plotshape(triggerCondition, "Trigger Condition", shape.xcross, color = color.fuchsia)</code></div>
<p>See <a href="/pine-script-docs/v5/concepts/alerts/#alertcondition-events">this section</a> of the <a href="/pine-script-docs/v5/concepts/alerts/">Alerts</a> page to learn more.</p>
<h3 class="md-heading" id="example-alert-alert"><a href="#example-alert-alert">Example `alert()` alert<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This example uses the <code dir="auto">vstop()</code> function from our <a href="https://www.tradingview.com/script/BICzyhq0-ta/">ta</a> library to calculate a volatility stop value and trend information based on the Average True Range (<a href="https://www.tradingview.com/support/solutions/43000501823-average-true-range-atr/">ATR</a>). The <code dir="auto">stopValue</code> trails behind the chart’s <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> to form a trend-following system.</p>
<p>The script triggers an alert with an <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> call each time the trend direction changes. The alert’s message is a “series string” that shows the trend’s new direction and the current stop value. An additional alert occurs whenever the <code dir="auto">stopValue</code> moves in the current trend direction, with a message containing the updated value:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Vstop alert demo", overlay = true)

import TradingView/ta/7 as TVta

// Calculate ATR trailing stop and determine trend direction.
[stopValue, trendUp] = TVta.vStop(close, 20, 2)

// Round the stop value to mintick for accuracy in comparison operators.
float stop = math.round_to_mintick(stopValue)

// Check for trend changes.
bool  trendReversal = trendUp != trendUp[1]
bool  trendToDn     = trendReversal and not trendUp
bool  trendToUp     = trendReversal and     trendUp
// Create color variables for the plot display.
color plotColor     = trendUp ? color.green : color.red
color lineColor     = trendReversal ? color(na) : plotColor

// Plot the stop value on the chart. Plot a circle on trend changes.
plot(stop, "V-Stop", lineColor)
plot(trendReversal ? stop : na, "Trend Change Circle", plotColor, 3, plot.style_circles)

// Convert the stop value to string for use in the alert messages.
string stopStr = str.tostring(stop)

// If the trend changed to up, send a long alert with the initial stop value.
if trendToUp
    alert("Long alert. Stop @ " + stopStr, alert.freq_once_per_bar_close)

// If the trend changed to down, send a short alert with the initial stop value.
if trendToDn
    alert("Short alert. Stop @ " + stopStr, alert.freq_once_per_bar_close)

// If the stop value has progressed, send an alert to update the stop value.
if (trendUp and stop &gt; stop[1] or not trendUp and stop &lt; stop[1]) and not trendReversal
    alert('Update stop to ' + stopStr, alert.freq_once_per_bar_close)</code></div>
<p>See <a href="/pine-script-docs/v5/concepts/alerts/#script-alerts">this section</a> of the <a href="/pine-script-docs/v5/concepts/alerts/">Alerts</a> page for more information.</p>
<h3 class="md-heading" id="example-strategy-alert"><a href="#example-strategy-alert">Example strategy alert<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>This example strategy places a <a href="/pine-script-docs/v5/concepts/strategies/#market-orders">market order</a> with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.entry">strategy.entry()</a> and a stop-loss and take-profit (bracket) order with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy.exit">strategy.exit()</a> when a 5-bar moving average crosses over a 10-bar moving average. The stop-loss price is 1% below the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> and the take-profit price is 2% above the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>. Order fill alerts occur when the broker emulator fills an entry or exit order. Both <a href="/pine-script-docs/v5/concepts/strategies/#order-placement-and-cancellation">order placement commands</a> include unique <code dir="auto">alert_message</code> arguments that combine placeholders and “string” representations of the <code dir="auto">limit</code> and <code dir="auto">stop</code> values to output details like the trade action, position size, chart symbol, and order prices:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5

// This annotation auto-populates the alert dialogue with the `alert_message` string.
// @strategy_alert_message {{strategy.order.alert_message}}

strategy("Alert message demo", overlay = true)

// Declare two moving averages to use for the entry condition.
float fastMa = ta.sma(close, 5)
float slowMa = ta.sma(close, 10)
// Declare two persistent variables that will hold our stop-loss and take-profit values.
var float limit = na
var float stop  = na

// If `fastMa` has crossed over `slowMa` and we are not already in a position,
// place an entry and exit order. 
//      • Set the `limit` to 2% above the close and the stop to 1% below.
//      • Use a combination of script variables and placeholders in the alert strings.
//      • The exit alert shows the order direction, position size, ticker, and order price.
//      • The entry alert includes the same values plus the stop and limit price.
if ta.crossover(fastMa, slowMa) and strategy.position_size == 0
    limit := close * 1.02
    stop  := close * 0.99
    string exitString  = "{{strategy.order.action}} {{strategy.position_size}} {{ticker}} @ {{strategy.order.price}}"
    string entryString = exitString + " TP: " + str.tostring(limit, format.mintick) + " SL: " + 
      str.tostring(stop, format.mintick)
    strategy.entry("Buy", strategy.long, alert_message = entryString)
    strategy.exit("Exit", "Buy", stop = stop, limit = limit, alert_message = exitString)

// Plot the moving averages, stop, and limit values on the chart.
plot(fastMa, "Fast Moving Average", color.aqua)
plot(slowMa, "Slow Moving Average", color.orange)
plot(strategy.position_size &gt; 0 ? limit : na, "Limit", color.green, style = plot.style_linebr)
plot(strategy.position_size &gt; 0 ? stop  : na, "Stop",  color.red,   style = plot.style_linebr)</code></div>
<p>For more information about order fill events, see <a href="/pine-script-docs/v5/concepts/alerts/#order-fill-events">this section</a> of the <a href="/pine-script-docs/v5/concepts/alerts/">Alerts</a> page. To learn more about how strategy scripts work, see the <a href="/pine-script-docs/v5/concepts/strategies/">Strategies</a> page.</p>
<h2 class="md-heading" id="if-i-change-my-script-does-my-alert-change"><a href="#if-i-change-my-script-does-my-alert-change">If I change my script, does my alert change?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>No, not without creating a new alert.</p>
<p>When a user creates an alert using the “Create Alert” dialog box, that action saves a “snapshot” of the script, its inputs, and the current chart’s context on TradingView’s servers. This snapshot acts as an independent <em>copy</em> of the script instance and chart. Therefore, any changes to the script, its inputs, or the user’s chart <strong>do not</strong> affect that created alert. To update an alert after making changes, <em>delete</em> the existing alert and <em>create</em> a new one.</p>
<h2 class="md-heading" id="why-arent-my-alerts-working"><a href="#why-arent-my-alerts-working">Why aren’t my alerts working?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Here are some common reasons why alerts might not work as expected, and how to solve them:</p>
<p><strong>Make sure the alert is active and has not expired</strong></p>
<p class="spacer-wrapper"><spacer/>Scripts that include alert triggers <strong>do not</strong> directly create alerts. Users must create alerts in the “Create Alert” dialog box, where they specify the “Condition” that triggers the alert and the “Expiration” time. Created alerts do not fire after they expire. See this Help Center article on <a href="https://www.tradingview.com/support/solutions/43000595315-how-to-set-up-alerts/">Setting up alerts</a>.</p>
<p><strong>Check the alert logs</strong></p>
<p class="spacer-wrapper"><spacer/>An alert can fire without a notification, depending on the alert’s settings. Check the logs in the <a href="https://www.tradingview.com/support/solutions/43000595311-manage-alerts/">alert manager</a> to see whether an alert occurred. To set up notifications for an alert, use the options in the “Notifications” tab of the “Create/Edit Alert” dialog box.</p>
<p><strong>Check for repainting</strong></p>
<p class="spacer-wrapper"><spacer/>If an alert fires at a different time than expected, <em>repainting</em> might be the cause. Refer to the <a href="/pine-script-docs/v5/concepts/repainting/">Repainting</a> page for more information.</p>
<p><strong>Limit the frequency of alerts</strong></p>
<p class="spacer-wrapper"><spacer/>If more than 15 alerts occur within three minutes, the system automatically <em>halts</em> further alerts. This <a href="https://www.tradingview.com/support/solutions/43000690939-alert-was-triggered-too-often-and-stopped/">frequency limit</a> helps prevent excessive notifications and potential server overload.</p>
<p><strong>Debug script errors</strong></p>
<p class="spacer-wrapper"><spacer/>If a script instance raises a <em>runtime error</em> at some point during its executions, alerts from that instance <strong>cannot</strong> fire because the error stops the script from continuing to execute its code. Some common issues that can halt alerts include:</p>
<ul>
<li>Attempting to store more than 100,000 elements within a <a href="/pine-script-docs/v5/language/type-system/#collections">collection</a></li>
<li>Trying to access an item from a collection at an <em>out-of-bounds</em> index</li>
<li>Referencing historical values of a time series outside its allocated <a href="/pine-script-docs/v5/error-messages/#pine-script-cannot-determine-the-referencing-length-of-a-series-try-using-max_bars_back-in-the-indicator-or-strategy-function">memory buffer</a></li>
<li>Using <a href="/pine-script-docs/v5/language/loops/">loops</a> that take longer than 500 ms to complete their iterations</li>
</ul>
<p class="spacer-wrapper"><spacer/>See <a href="/pine-script-docs/v5/error-messages/">this page</a> for additional details about common error messages and troubleshooting tips.</p>
<h2 class="md-heading" id="why-is-my-alert-firing-at-the-wrong-time"><a href="#why-is-my-alert-firing-at-the-wrong-time">Why is my alert firing at the wrong time?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Sometimes, alerts may fire when users do not expect according to what their script displays on the chart. <a href="/pine-script-docs/v5/concepts/repainting/">Repainting</a> is the typical cause of such issues.</p>
<p>A chart’s realtime and historical bars often rely on <em>different</em> <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#data-feeds">data feeds</a>. Data providers may retroactively adjust the reported values on realtime bars, which the displayed data reflects <em>after</em> users refresh their charts or restart their scripts. Such adjustments can cause discrepancies where a triggered alert’s timing may not align with the script’s output after reloading it.</p>
<p>Scripts may also behave differently on historical and realtime bars, which can lead to repainting. On historical bars, scripts execute once per bar close, whereas on realtime bars, where alerts fire, scripts execute once for <em>each new tick</em> from the data feed. Therefore, if a script behaves differently on those bars, users may see differences between its signals and triggered alerts after reloading the chart.</p>
<p>Below are some common repainting issues that can affect a script’s alerts:</p>
<p><strong>Alerts firing before bar close</strong></p>
<p class="spacer-wrapper"><spacer/>Most scripts have <a href="/pine-script-docs/v5/concepts/repainting/#fluid-data-values">fluid data values</a> that update after new ticks during an unconfirmed realtime bar and finalize after the bar closes. Consequently, an alert that fires on an open bar may not reflect the <em>final state</em> of the condition after the bar’s confirmation. Set the alert’s frequency to “Once Per Bar Close” to avoid this issue.</p>
<p><strong>Using `calc_on_every_tick` in strategies</strong></p>
<p class="spacer-wrapper"><spacer/>When a strategy script includes <code dir="auto">calc_on_every_tick = true</code> in its declaration statement or the user selects the “On every tick” option in the “Recalculate” section of the strategy’s <a href="https://www.tradingview.com/support/solutions/43000628599-strategy-properties/">properties</a>, it recalculates on <em>every</em> price update in the realtime data. This behavior can cause strategies to repaint because historical bars do not contain the same information as realtime bars. See <a href="/pine-script-docs/v5/concepts/strategies/#altering-calculation-behavior">this section</a> of the <a href="/pine-script-docs/v5/concepts/strategies/">Strategies</a> page to learn more.</p>
<p><strong>Incorrect usage of `request.security()` calls</strong></p>
<p class="spacer-wrapper"><spacer/>Using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> calls to fetch data from alternative timeframes can cause discrepancies on historical bars that scripts <strong>cannot</strong> reproduce on realtime bars. Ensure you follow the best practices for <em>non-repainting</em> data requests to avoid such discrepancies, especially with higher-timeframe data. See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a> section of the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">Other timeframes and data</a> page and the <a href="https://www.tradingview.com/script/W1YpYcOI-Higher-timeframe-requests/">Higher-timeframe requests</a> publication from PineCoders for more information.</p>
<h2 class="md-heading" id="can-i-use-variable-messages-with-alertcondition"><a href="#can-i-use-variable-messages-with-alertcondition">Can I use variable messages with alertcondition()?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">message</code> parameter of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function requires a “const string” argument, which <strong>cannot change</strong> after compilation. However, the “string” can include <a href="/pine-script-docs/v5/concepts/alerts/#placeholders">placeholders</a>, which an alert substitutes with corresponding dynamic values from a script each time it fires.</p>
<p>The script below demonstrates two <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> calls whose <code dir="auto">message</code> arguments include placeholders for dynamic values. Each time alerts from these triggers occur, the message displays information about the current chart’s exchange, symbol, price, and volume:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Placeholder demo", overlay = false)

[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)
plot(macdLine,   "MACD",   color.blue)
plot(signalLine, "Signal", color.orange)
plot(histLine,   "Hist.",  color.red, style = plot.style_histogram)

bool crossUp = ta.crossover(macdLine,  signalLine)
bool crossDown = ta.crossunder(macdLine, signalLine)

alertcondition(crossUp, "MACD Cross Up",   "MACD cross up on {{exchange}}:{{ticker}}\nprice = {{close}}\nvolume = {{volume}}")
alertcondition(crossDown, "MACD Cross Down", "MACD cross down on {{exchange}}:{{ticker}}\nprice = {{close}}\nvolume = {{volume}}")</code></div>
<h2 class="md-heading" id="how-can-i-include-values-that-change-in-my-alerts"><a href="#how-can-i-include-values-that-change-in-my-alerts">How can I include values that change in my alerts?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The method for including dynamic values in alert messages varies with the type of alert trigger:</p>
<ul>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> function accepts a “const string” <code dir="auto">message</code> argument that can contain placeholders for dynamic values. See <a href="/pine-script-docs/v5/faq/alerts/#can-i-use-variable-messages-with-alertcondition">Can I use variable messages with `alertcondition()`?</a> for more information.</li>
<li>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function accepts “series string” <code dir="auto">message</code> arguments, which allows the convenient creation of dynamic messages that use a script’s calculated values. See <a href="/pine-script-docs/v5/faq/alerts/#example-alert-alert">this section</a> for an example.</li>
<li>Order fill alerts can use “series string” values and placeholders. Refer to the example <a href="/pine-script-docs/v5/faq/alerts/#example-strategy-alert">here</a>.</li>
</ul>
<h2 class="md-heading" id="how-can-i-get-custom-alerts-on-many-symbols"><a href="#how-can-i-get-custom-alerts-on-many-symbols">How can I get custom alerts on many symbols?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To manage alerts across multiple symbols using a custom script, one option is to set an individual alert on each symbol. There is no automated method to set the same alert across many symbols simultaneously in a single action. It’s also important to note that the TradingView <a href="https://www.tradingview.com/screener/">screener</a> uses built-in filters and does not support custom Pine Script™ code.</p>
<p>Scripts can retrieve data from other <em>contexts</em> (symbols, timeframes, and modifiers such as non-standard chart calculations and extended sessions) using the functions in the <code dir="auto">request.*()</code> namespace. With these functions, programmers can design scripts that retrieve data from up to 40 unique contexts. Search for “<a href="https://www.tradingview.com/scripts/search/screener/">screener</a>” in the Community scripts for in-depth examples.</p>
<p>Here is an example incorporating three symbols. The <code dir="auto">checkForAlert()</code> function calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> to fetch data from a specified context and evaluate the user-defined <code dir="auto">checkForRsiConditions()</code> function using that data. Then, the function calls <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> using the result to create an alert trigger. The script calls this function three times, creating distinct alert triggers for each specified symbol:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Screener demo", overlay = true)

// Declare inputs for the alert symbols and the timeframe to run the alerts on. The default is the current chart timeframe.
string tfInput      = input.timeframe("", "Timeframe")
string symbol1Input = input.symbol("BINANCE:ETHUSDT", "Symbol 1")
string symbol2Input = input.symbol("BINANCE:BATUSDT", "Symbol 2")
string symbol3Input = input.symbol("BINANCE:SOLUSDT", "Symbol 3")

// @function    Generates alert messages for RSI crossing over or under 50, and crosses of price and the 50 EMA.
// @returns     (string) Formatted alert messages with values for each crossover and crossunder event.
checkForRsiConditions() =&gt;
    float  rsi = ta.rsi(close, 14)
    float  ema = ta.ema(close, 50)
    string alertMessage = ""
    if ta.crossover(rsi, 50)
        alertMessage += str.format("RSI ({0}) crossed over 50 for {1} on {2} timeframe.\n", rsi, syminfo.ticker, timeframe.period)
    if ta.crossunder(rsi, 50)
        alertMessage += str.format("RSI ({0}) crossed under 50 for {1} on {2} timeframe.\n", rsi, syminfo.ticker, timeframe.period)
    if ta.crossover(close, ema)
        alertMessage += str.format("Crossover of 50 EMA for {0} on {1} timeframe. Price is {2}", syminfo.ticker, timeframe.period, close)
    if ta.crossunder(close, ema)
        alertMessage += str.format("Crossunder of 50 EMA for {0} on {1} timeframe. Price is {2}", syminfo.ticker, timeframe.period, close)

// @function        Calls the `checkForRsiConditions()` function for the provided symbol and timeframe. 
//                      Triggers an alert if the function returns a message.
// @param symbol    (simple string) The symbol to check.
// @param tf        (simple string) The timeframe to check.
// @param freq      (const string) The frequency of the alert. Optional. Default is `alert.freq_once_per_bar`.
// @returns         (void) The function has no explicit return, but triggers an alert with the message if the
//                          conditions defined within the `checkForRsiConditions()` function are met.
checkForAlert(simple string symbol, simple string tf, const string freq = alert.freq_once_per_bar) =&gt;
    string msg = request.security(symbol, tf, checkForRsiConditions())
    if msg != msg[1] and str.length(msg) &gt; 0
        alert(msg, freq)

// Check for alerts on the input symbols and timeframe.
checkForAlert(symbol1Input, tfInput)
checkForAlert(symbol2Input, tfInput)
checkForAlert(symbol3Input, tfInput)
// Continue with additional symbols up to a maximum of 40...</code></div>
<p>Note that:</p>
<ul>
<li>A script can execute up to 40 <em>unique</em> <code dir="auto">request.*()</code> calls. A <code dir="auto">request.*()</code> call is not unique if a script already calls the same function with the same arguments. See <a href="/pine-script-docs/v5/writing/limitations/#number-of-calls">this section</a> of the <a href="/pine-script-docs/v5/writing/limitations/">Limitations</a> page for more information.</li>
<li>This script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function because <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> is not allowed within <em>local scopes</em>.</li>
</ul>
<h2 class="md-heading" id="how-can-i-trigger-an-alert-for-only-the-first-instance-of-a-condition"><a href="#how-can-i-trigger-an-alert-for-only-the-first-instance-of-a-condition">How can I trigger an alert for only the first instance of a condition?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Firing an alert only on its first occurrence can help avoid redundant notifications and isolate specific conditions or state changes, which is beneficial in several use cases. For instance, if a user relies on alerts to automate order placement, restricting redundant alerts to their first occurrence can help avoid accidentally placing excessive orders.</p>
<p>For alerts with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a> triggers, setting them to fire once using the “Only Once” option in the “Create Alert” dialog box is not an optimal solution because it requires <em>manual</em> reactivation each time an alert occurs. Alerts from the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> function do not have an “Only Once” frequency option. The programmer must use conditional logic to ensure the call executes at the appropriate time.</p>
<p>There are two primary ways to code repeating alerts that fire on only the first instance of a condition:</p>
<p><strong>Using more strict criteria</strong></p>
<p class="spacer-wrapper"><spacer/>Rather than relying on a continuous condition like <code dir="auto">close &gt; ma</code>, which may remain <code dir="auto">true</code> for multiple consecutive bars, try using a more strict condition like <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.crossover">ta.crossover(close, ma)</a>. For simple cases, this is the easiest method.</p>
<p><strong>Using state control</strong></p>
<p class="spacer-wrapper"><spacer/>More complex scenarios may require controlling and tracking <em>states</em>, which entails setting flags or specific values to signify certain conditions.</p>
<p>The example script below manages separate bullish and bearish states, and it colors the background to represent each state. When a bullish or bearish state first occurs, an <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_alert">alert()</a> call executes and the script plots a triangle on the chart. It also plots smaller triangles to show where other signals occur within a state, which do not trigger additional alerts:</p>
<p>// <div class="image-container"><img alt="image" decoding="async" height="1276" loading="lazy" src="images/6be4b8123a62c97360585f3acb6b00cd.webp" width="2356"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Single alert demo", overlay = true)

// ————— Calculations: Determine highest/lowest values over last `lengthInput` bars.
int   lengthInput = input.int(20, "Length")
float highest     = ta.highest(lengthInput)
float lowest      = ta.lowest(lengthInput)
// ————— Trigger conditions: Define bull and bear signals. Bull signal is triggered by a new high, and bear by a new low.
bool bullSignal = high == highest
bool bearSignal = low  == lowest
// ————— State change flags: Set true on state transition bars only.
bool changeToBull = false
bool changeToBear = false
// ————— State tracking: `isBull` is set to true for bull state, false for bear. It's set only at the initial switch to the opposite condition.
// This variable's state is retained from bar to bar because we use the `var` keyword to declare it.
var bool isBull = false
// ————— State transitions: Allow a switch from bull to bear or bear to bull; ignore repeated signals in current state.
// Set the state change flags to true only on the first bar where a new signal appears.
if bullSignal and not isBull
    isBull       := true
    changeToBull := true
else if bearSignal and isBull
    isBull       := false
    changeToBear := true

// Plot highest and lowest values.
plot(highest, "Highest", color.new(color.green, 80), 2)
plot(lowest,  "Lowest",  color.new(color.red,   80), 2)
// Background color: Green for bull, none for bear.
bgcolor(isBull ? color.new(color.green, 90) : na)
// State change markers: Display "ALERT" text on bars where a state change occurs and an alert would trigger.
plotchar(changeToBull, "Change to Bull state", "▲", location.belowbar, color.new(color.lime, 30), size = size.small, text = "BULL\nALERT")
plotchar(changeToBear, "Change to Bear state", "▼", location.abovebar, color.new(color.red,  30), size = size.small, text = "BEAR\nALERT")
// Signal markers: Display for repeated signals within the current state.
// These signals would trigger redundant alerts if not for the state tracking flag preventing them.
plotchar(bullSignal and not changeToBull, "Bull signal", "▲", location.belowbar, color.green,  size = size.tiny)
plotchar(bearSignal and not changeToBear, "Bear signal", "▼", location.abovebar, color.maroon, size = size.tiny)

// Alerts: Trigger on state changes only.
if changeToBull
    alert("Change to bull state")
if changeToBear
    alert("Change to bear state")</code></div>
<h2 class="md-heading" id="how-can-i-run-my-alert-on-a-timer-or-delay"><a href="#how-can-i-run-my-alert-on-a-timer-or-delay">How can I run my alert on a timer or delay?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>It is possible to program logic to delay alert triggers so that they occur <em>after</em> the initial condition. However, because Pine scripts execute on realtime bars only after new <em>price updates</em>, and an alert only fires when a script <em>executes</em>, it is difficult to predict the exact time of a delayed alert.</p>
<p>There are no price updates in a closed market, meaning an alert with a delay will not fire until the market opens again. Similarly, thinly traded securities may have very infrequent price updates in unpredictable intervals, which can cause a larger delay than intended.</p>
<p>The Pine script below implements a <em>time-delayed</em> alert, which is subject to the limitations above. When the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> is higher than a moving average, a delay counter starts. After the delay passes, the alert fires once, and another alert <em>cannot</em> fire until the timer resets. Users can specify whether the timer resets on each bar using the script’s <code dir="auto">resetInput</code>:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1276" loading="lazy" src="images/defcfcde41485edf8f659433d9f4c544.webp" width="2356"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Delayed alert demo", overlay = true)

import PineCoders/Time/4 as PCtime

string TIME_TT  = "The delay's duration and units. This specifies the continuous duration for which the condition must be true before triggering the alert."
string RESET_TT = "When checked, the duration will reset every time a new realtime bar begins."

enum TimeUnit
    seconds
    minutes
    hours

int    durationInput = input.int(20,     "Condition must last",     minval  = 1,       inline = "00")
TimeUnit timeUnitInput = input.enum(TimeUnit.seconds, "", inline="00")
bool   resetInput    = input.bool(false, "Reset timing on new bar", tooltip = RESET_TT)
int    maLengthInput = input.int(9,      "MA length")

// Calculate and plot a SMA with `maLengthInput` length.
float ma = ta.sma(close, maLengthInput), plot(ma, "MA")
// Check whether the close is greater than the SMA.
bool cond = close &gt; ma
// Time the duration for which the condition has been true.
int secSince = PCtime.secondsSince(cond, resetInput and barstate.isnew)
// Check if the duration is greater than the input timer.
bool timeAlert = secSince &gt; (PCtime.timeFrom("bar", durationInput, str.tostring(timeUnitInput)) - time) / 1000
// Format a time string for the timer label.
string alertTime = str.format_time(secSince * 1000, "mm:ss")

// Set the contents for the label depending on the stage of the alert timer.
string alertString = switch
    timeAlert =&gt; "Timed Alert Triggered\n\n" + alertTime
    cond      =&gt; "Condition Detected...\n\nTimer count\n" + alertTime
    =&gt;           "Waiting for condition..."

// Display alert timer using a label.  Declare a basic label once and update location, color, and text on the last bar for efficiency.
if barstate.islast
    var label condTime = label.new(na, na, yloc = yloc.abovebar, style = label.style_label_lower_left, textcolor = chart.fg_color)
    label.set_x(condTime, bar_index)
    label.set_text(condTime, alertString)
    label.set_color(condTime, color.new(timeAlert ? color.green : cond ? color.orange : color.red, 50))

// Create a flag to ensure alert is triggered only once each time the delay timer is exceeded.
varip bool isFirstOccurrence = true
// Fire alert if timer is triggered.
if timeAlert and isFirstOccurrence
    alert(str.format("{0} {1} Delayed Alert Triggered", durationInput, str.tostring(timeUnitInput)), alert.freq_all)

// Toggle the flag to `false` when alert triggers, and reset when the condition clears.
isFirstOccurrence := not timeAlert</code></div>
<p>Note that:</p>
<ul>
<li>The <code dir="auto">secondsSince()</code> function from the PineCoders’ <a href="https://www.tradingview.com/script/tyeeNU9I-Time/">time</a> library determines the duration, in seconds, for which a certain condition remains continuously <code dir="auto">true</code>. The duration can be tracked within bars because it uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a> keyword.</li>
<li>The timing starts when the condition first becomes <code dir="auto">true</code>. If the condition becomes <code dir="auto">false</code> or an optional resetting condition occurs, the timer restarts. If “Reset timing on new bar” is enabled in the “Settings/Inputs” tab, the function restarts its timing at the start of a new bar.</li>
<li>A colored label shows what state the script is in:
<ol>
<li><strong>Red</strong> - The condition has not occurred yet.</li>
<li><strong>Orange</strong> - The condition occurred and the delay timer is active.</li>
<li><strong>Green</strong> - The timer has surpassed the set duration, simulating a delayed alert.</li>
</ol>
</li>
</ul>
<p>This script relies on variables declared with the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_varip">varip</a> keyword, which do not revert to their last committed states during realtime bar calculations. See <a href="/pine-script-docs/v5/language/variable-declarations/#varip">this section</a> of the User Manual to learn more about using this keyword. To learn about how <em>rollback</em> works, see the <a href="/pine-script-docs/v5/language/execution-model/">Execution model</a> page.</p>
<h2 class="md-heading" id="how-can-i-create-json-messages-in-my-alerts"><a href="#how-can-i-create-json-messages-in-my-alerts">How can I create JSON messages in my alerts?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Alerts can send messages containing JavaScript Object Notation (JSON) to <a href="https://www.tradingview.com/support/solutions/43000529348-about-webhooks/">webhooks</a>. Pine Script™ does not include any built-in functions to produce JSON, but programmers can create JSON messages in Pine by constructing “string” representations.</p>
<p>When constructing JSON representations, ensure the keys and values intended as strings in the JSON-formatted text use <em>double quotes</em>, not single quotes.</p>
<p>The following example shows three ways to construct JSON strings in Pine Script™:</p>
<ol>
<li>
<p><strong>Static JSON Strings</strong></p>
<p>Define separate alerts with predefined JSON-formatted strings. This method is the simplest.</p>
</li>
<li>
<p><strong>Placeholders</strong></p>
<p>Use <a href="/pine-script-docs/v5/concepts/alerts/#placeholders">placeholders</a> in the alert message, such as <code dir="auto">{{close}}</code> and <code dir="auto">{{volume}}</code>, to add <em>dynamic</em> values to the JSON. The alert instance replaces the placeholders with corresponding values when it fires. This method can create richer alerts, especially for <a href="/pine-script-docs/v5/concepts/strategies/">strategies</a>, which have <a href="https://www.tradingview.com/support/solutions/43000481368-strategy-alerts/">extra placeholders</a> for their calculated values. See <a href="/pine-script-docs/v5/faq/alerts/#example-strategy-alert">this section</a> above for an example.</p>
</li>
<li>
<p><strong>Dynamic strings</strong></p>
<p>Use the functions in the <code dir="auto">str.*()</code> namespace and “string” concatenation to create dynamic JSON-formatted text. This method is the most customizable and advanced. Our script below shows a simple, straightforward example of this approach. When using dynamic string formatting to construct JSON strings, ensure the resulting JSON is <em>valid</em> for all the combined values.</p>
</li>
</ol>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("JSON example", overlay = true)

// Define EMA cross conditions to trigger alerts, and plot the ema on the chart.
float ema = ta.ema(close, 21)
bool crossUp    = ta.crossover(close, ema)
bool crossDown  = ta.crossunder(close, ema)
plot(ta.ema(close, 21))

// ————— Method 1 - Separate alerts with static messages.
string alertMessage1a = '{"method": 1, "action": "buy", "direction": "long", "text": "Price crossed above EMA"}'
string alertMessage1b = '{"method": 1, "action": "sell", "direction": "short", "text": "Price crossed below EMA"}'
alertcondition(crossUp,     "Method 1 - Cross up",   alertMessage1a)
alertcondition(crossDown,   "Method 1 - Cross down", alertMessage1b)

// Rendered alert:
// {
//     "method": 1,
//     "action": "buy",
//     "direction": "long",
//     "text": "Price crossed above EMA"
// }

// ————— Method 2 - Using placeholders for dynamic values.
string alertMessage2 = '{"method": 2, "price": {{close}}, "volume": {{volume}}, "ema": {{plot_0}}}'
alertcondition(crossUp, "Method 2 - Cross Up", alertMessage2)

// Rendered alert:
// {
//     "method": 2,
//     "price": 2066.29,
//     "volume": 100.859,
//     "ema": 2066.286
// }

// ————— Method 3 - String concatenation using dynamic values.
string alertMessage3 =
 '{"method": 3, "price": ' + str.tostring(close) + ', "volume": ' + str.tostring(volume) + ', "ema": ' + str.tostring(ema) + '}'
if crossUp
    alert(alertMessage3, alert.freq_once_per_bar_close)

// Rendered alert:
// {
//     "method": 3,
//     "price": 2052.27,
//     "volume": 107.683,
//     "ema": 2052.168
// }</code></div>
<p>Before using the JSON-formatted string in alerts for real-world applications, such as sending messages to place orders, <em>test</em> and <em>validate</em> the JSON message to ensure it works as intended:</p>
<ul>
<li>Send alerts to an email address to see how the JSON message appears.</li>
<li>Copy the alert message from the email into an online JSON validation tool.</li>
<li>Use an API client application to check the server response to the request.</li>
</ul>
<p>Refer to <a href="https://en.wikipedia.org/wiki/JSON" rel="nofollow">this Wikipedia page</a> to learn more about JSON format. To learn more about how alerts send information using webhooks, see the Help Center article on <a href="https://www.tradingview.com/support/solutions/43000529348-about-webhooks/">webhooks</a>.</p>
<h2 class="md-heading" id="how-can-i-send-alerts-to-discord"><a href="#how-can-i-send-alerts-to-discord">How can I send alerts to Discord?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Sending alerts from a Pine script to a Discord chat room is possible using <a href="https://www.tradingview.com/support/solutions/43000529348-about-webhooks/">webhooks</a>.</p>
<p>The message for Discord communication requires <a href="https://en.wikipedia.org/wiki/JSON" rel="nofollow">JSON format</a>. The <em>minimum</em> requirement for a valid message is <code dir="auto">{"content": "Your message here"}</code>.</p>
<p>The script example below uses <a href="/pine-script-docs/v5/concepts/alerts/#placeholders">placeholders</a> to dynamically populate alert messages with script values, including the new high or low price, and the chart’s symbol and timeframe:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Discord demo", overlay = true)
// Calculate a Donchian channel using the TV ta library.
import TradingView/ta/7 as TVta
int lengthInput = input.int(10, "Channel length")
[highest, lowest, middle] = TVta.donchian(lengthInput)
// Create conditions checking for a new channel high or low.
bool isNewHi = high &gt; highest[1]
bool isNewLo = low  &lt;  lowest[1]
// Plot the Donchian channel and fill between the midpoint and the upper and lower halves.
hi  = plot(highest, "Channel high", color.new(color.fuchsia, 70))
mid = plot(middle,  "Channel mid.", color.new(color.gray,    70))
lo  = plot(lowest,  "Channel low",  color.new(color.lime,    70))
fill(mid, hi, color.new(color.fuchsia, 95))
fill(mid, lo, color.new(color.lime,    95))
// Plot shapes to mark new highs and lows to visually identify where alert trigger conditions occur.
plotshape(isNewHi, "isNewHi", shape.arrowup,   location.abovebar, color.new(color.lime,    70))
plotshape(isNewLo, "isNewLo", shape.arrowdown, location.belowbar, color.new(color.fuchsia, 70))
// Create two alert conditions, one for new highs, and one for new lows.
// Format the message for Discord in the following JSON format: {"content": "Your message here"}
alertcondition(isNewHi, "New High (Discord Alert Demo)", '{"content": "New high ({{high}}) on {{ticker}} on {{interval}} chart!"}')
alertcondition(isNewLo, "New Low  (Discord Alert Demo)", '{"content": "New low ({{low}}) on {{ticker}} on {{interval}} chart!"}')
// The following test alert condition fires immediately. Set this alert frequency to "Only Once".
alertcondition(true, "Test (Discord Alert Demo)", '{"content": "This is a test alert from TradingView to Discord."}')</code></div>
<p>To send these alert messages to Discord, follow these steps:</p>
<p><strong>1. Create a Discord webhook</strong></p>
<ul>
<li>Create a new webhook in a server using an account with webhook creation and management permissions. Refer to Discord’s <a href="https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks" rel="nofollow">Intro to Webhooks</a> article for instructions.</li>
<li>Copy the Webhook URL. This URL represents the address where the alert sends a POST request.</li>
</ul>
<p><strong>2. Set up an alert on TradingView</strong></p>
<ul>
<li>Add the above “Discord demo” script to a chart and open the “Create Alert” dialog box.</li>
<li>Choose one of the script’s alert conditions as the “Condition” in the dialog. If you select the “New High” or “New Low” alerts, choose the “Once Per Bar Close” option in the “Frequency” field to avoid triggering alerts for new highs or lows on an unconfirmed bar. When using the “Test” alert, choose “Only Once” as the “Frequency” option.</li>
<li>In the “Notifications” tab of the “Create Alert” dialog, select “Webhook URL” and paste the URL of the Discord webhook.</li>
</ul>
<p><strong>3. Test the integration</strong></p>
<ul>
<li>Check that alerts appear in the alert log on TradingView.</li>
<li>Use the “Test” alert to check whether the webhook works as expected. After the alert fires, check your Discord to see if it received the message.</li>
<li>If the alert message does not appear in Discord, check whether the pasted webhook URL is correct.</li>
<li>If the message does not display correctly in Discord, check the JSON format. The minimum required format is <code dir="auto">{"content": "Your message here"}</code>.</li>
</ul>
<p>Consult Discord’s <a href="https://discord.com/developers/docs/resources/webhook#webhook-resource" rel="nofollow">Webhook Resource</a> to learn about advanced JSON message configurations.</p>
<p>For more information about dynamic values in alert messages, refer to <a href="http://localhost:4321/pine-script-docs/faq/alerts/#how-can-i-include-values-that-change-in-my-alerts" rel="nofollow">How can I include values that change in my alerts?</a>.</p>
<p>To learn about using JSON format in script alerts, see <a href="http://localhost:4321/pine-script-docs/faq/alerts/#how-can-i-create-json-messages-in-my-alerts" rel="nofollow">How can I create JSON messages in my alerts?</a>.</p>
<h2 class="md-heading" id="how-can-i-send-alerts-to-telegram"><a href="#how-can-i-send-alerts-to-telegram">How can I send alerts to Telegram?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Sending TradingView alerts directly to Telegram is challenging due to protocol differences and formatting requirements. One solution is to use an intermediary service, which receives webhook alerts from TradingView, formats them as required by Telegram, and then forwards them to a Telegram bot.</p>
<ol>
<li>Choose a platform like Zapier, Integromat, or Pipedream. Alternatively, programmers can consider developing a custom server script using Node.js or Python.</li>
<li>In TradingView, set up alerts to send <a href="https://www.tradingview.com/support/solutions/43000529348-about-webhooks/">webhook requests</a> to the intermediary service’s provided URL.</li>
<li>Configure the intermediary service to reformat TradingView’s incoming requests for Telegram’s API and send the formatted message to a Telegram bot using the <code dir="auto">sendMessage</code> method.</li>
</ol>
<p>See the Telegram Bot API <a href="https://core.telegram.org/bots" rel="nofollow">documentation</a> for detailed technical information.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <span data-astro-cid-xgirumru=""></span> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/data-structures"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Data structures <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Data structures</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-data-structures"><a href="#data-structures">Data structures<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="what-data-structures-can-i-use-in-pine-script"><a href="#what-data-structures-can-i-use-in-pine-script">What data structures can I use in Pine Script™?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine data structures resemble those in other programming languages, with some important differences:</p>
<ul>
<li>
<p><strong>Tuple</strong>: An arbitrary—and temporary—grouping of values of one or more types.</p>
</li>
<li>
<p><strong>Array</strong>: An ordered sequence of values of a single type.</p>
</li>
<li>
<p><strong>Matrix</strong>: A two-dimensional ordered sequence of values of a single type.</p>
</li>
<li>
<p><strong>Object</strong>: An arbitrary—and persistent—collection of values of one or more types.</p>
</li>
<li>
<p><strong>Map</strong>: An <em>unordered</em> sequence of key-value pairs, where the keys are of a single type and the values are of a single type.</p>
</li>
</ul>
<p>The following sections describe each data structure in more detail.</p>
<h3 class="md-heading" id="tuples"><a href="#tuples">Tuples<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a> in Pine Script™ is a list of values that is returned by a <a href="/pine-script-docs/v5/language/user-defined-functions/">function</a>, <a href="/pine-script-docs/v5/language/methods/">method</a>, or local block. Unlike in other languages, tuples in Pine serve no other function.
Tuples do not have names and cannot be assigned to variables.
Apart from the fact that the values are requested and returned together, the values have no relation to each other, in contrast to the other data structures described here.</p>
<p>To define a tuple, enclose a comma-separated list of values in square brackets.</p>
<p>Using a tuple to request several values from the same symbol and timeframe using a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call is more efficient than making several calls. For instance, consider a script that contains separate <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> calls for the
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> prices:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float o = request.security(syminfo.tickerid, "D", open)
float h = request.security(syminfo.tickerid, "D", high)
float l = request.security(syminfo.tickerid, "D", low)
float c = request.security(syminfo.tickerid, "D", close)</code></div>
<p>Using a tuple can consolidate these calls into a single <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function call, reducing performance overhead:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">[o, h, l, c] = request.security(syminfo.tickerid, "D", [open, high, low, close])</code></div>
<p>See the <a href="/pine-script-docs/v5/language/type-system/#tuples">Tuples</a> section in the User Manual for more information.</p>
<h3 class="md-heading" id="arrays"><a href="#arrays">Arrays<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/language/arrays/">Arrays</a> store multiple values of the same <a href="/pine-script-docs/v5/language/type-system/">type</a> in a single variable. Each <em>element</em> in an array can be efficiently accessed by its <em>index</em>—an integer corresponding to its position within the array.</p>
<p>Arrays can contain an arbitrary number of elements. Scripts can loop through arrays, testing each element in turn for certain logical conditions. There are also many built-in functions to perform different operations on arrays. This flexibility makes arrays very versatile data structures.</p>
<p>Arrays can be created with either the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;type&gt;()</a>
or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.from">array.from()</a> function. In this simple example, we store the last five closing prices in an array and display it in a table:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array example")
// Declare an array with 5 `na` values on the first bar.
var array&lt;float&gt; pricesArray = array.new&lt;float&gt;(5)
// On each bar, add a new value to the end of the array and remove the first (oldest) element.
array.push(pricesArray, close)
array.shift(pricesArray)
// Display the array and its contents in a table.
var table displayTable = table.new(position.middle_right, 1, 1)
if barstate.islast
    table.cell(displayTable, 0, 0, str.tostring(pricesArray), text_color = chart.fg_color)</code></div>
<p>See the <a href="/pine-script-docs/v5/language/arrays/">Arrays</a> section in the User Manual for more information.</p>
<h3 class="md-heading" id="matrices"><a href="#matrices">Matrices<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A <a href="/pine-script-docs/v5/language/matrices/">matrix</a> is a two-dimensional array, made of rows and columns, like a spreadsheet. Matrices, like arrays, store values of the same built-in or user-defined <a href="/pine-script-docs/v5/language/type-system/#types">type</a>.</p>
<p>Matrices have many built-in functions available to organize and manipulate their data. Matrices are useful for modeling complex systems, solving mathematical problems, and improving algorithm performance.</p>
<p>This script demonstrates a simple example of matrix addition. It creates a 3x3 matrix, calculates its <a href="/pine-script-docs/v5/language/matrices/#transposing">transpose</a>, then calculates the
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.sum">matrix.sum()</a> of the two matrices. This example displays the original matrix, its
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.transpose">transpose</a>, and the resulting sum matrix in a table on the chart.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="476" loading="lazy" src="images/23d83fc8bba82cff74aa2a25c495a6ca.webp" width="740"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Matrix sum example")

//@variable An empty matrix of type "float".
m = matrix.new&lt;float&gt;()

// Add rows to the matrix containing data.
m.add_row(0, array.from(1, 2, 3))
m.add_row(1, array.from(0, 4, 2))
m.add_row(2, array.from(3, 1, 2))

var table displayTable = table.new(position.middle_right, 5, 2)
if barstate.islast
    matrix&lt;float&gt; t = m.transpose()
    table.cell(displayTable, 0, 0, "A",                            text_color = chart.fg_color)
    table.cell(displayTable, 0, 1, str.tostring(m),                text_color = chart.fg_color)
    table.cell(displayTable, 1, 1, "+",                            text_color = chart.fg_color)
    table.cell(displayTable, 2, 0, "Aᵀ",                           text_color = chart.fg_color)
    table.cell(displayTable, 2, 1, str.tostring(t),                text_color = chart.fg_color)
    table.cell(displayTable, 3, 1, "=",                            text_color = chart.fg_color)
    table.cell(displayTable, 4, 0, "A + Aᵀ",                       text_color = color.green)
    table.cell(displayTable, 4, 1, str.tostring(matrix.sum(m, t)), text_color = color.green)</code></div>
<p>See the <a href="/pine-script-docs/v5/language/matrices/">Matrices</a> section in the User Manual for more information.</p>
<h3 class="md-heading" id="objects"><a href="#objects">Objects<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Pine Script™ <a href="/pine-script-docs/v5/language/objects/">objects</a> are containers that group together multiple fields into one logical unit.</p>
<p>Objects are <em>instances</em> of <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> (UDTs). UDTs are similar to <em>structs</em> in traditional programming languages. They define the rules for what an object can contain. Scripts first create a UDT by using the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a> keyword and then create one or more objects of that type by using the UDT’s built-in <code dir="auto">new()</code> method.</p>
<p>UDTs are <em>composite</em> types; they contain an arbitrary number of fields that can be of any type. A UDT’s field type can even be another UDT, which means that objects can contain other objects.</p>
<p>Our example script creates a new <code dir="auto">pivot</code> object each time a new pivot is found, and draws a label using each of the object’s fields:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Object example", overlay = true)

// Create the pivot type with 3 fields: the x coordinate, the y coordinate, and a formatted time string.
type pivot
    int x
    float y
    string pivotTime
// Check for new pivots. `ta.pivotHigh` returns the price of the pivot.
float pivFound = ta.pivothigh(10, 10)
// When a pivot is found, create a new pivot object and generate a label using the values from its fields.
if not na(pivFound)
    pivot pivotObject = pivot.new(bar_index - 10, pivFound, str.format_time(time[10], "yyyy-MM-dd HH:mm"))
    label.new(pivotObject.x, pivotObject.y, pivotObject.pivotTime, textcolor = chart.fg_color)</code></div>
<p>See the User Manual page on <a href="/pine-script-docs/v5/language/objects/">Objects</a> to learn more about working with UDTs.</p>
<h3 class="md-heading" id="maps"><a href="#maps">Maps<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/language/maps/#maps">Maps</a> in Pine Script™ are similar to <em>dictionaries</em> in other programming languages, such as dictionaries in Python, objects in JavaScript, or HashMaps in Java.
Maps store elements as key-value pairs, where each key is unique. Scripts can access a particular value by looking up its associated key.</p>
<p>Maps are useful when accessing data directly without searching through each element, as you need to do with arrays. For example, maps can be more performant and simpler than arrays for associating specific attributes with symbols, or dates with events.</p>
<p>The following example illustrates the practical application of maps for managing earnings dates and values as key-value pairs, with dates serving as the keys:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1666" loading="lazy" src="images/1b5a33858f891bd679fe0733b354d32c.webp" width="2226"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Earnings map", overlay = true)
// Get the earnings value if present. We use `barmerge.gaps_on` to return `na` unless earnings occurred.
float earnings = request.earnings(syminfo.tickerid, earnings.actual, barmerge.gaps_on)
// Declare a map object for storing earnings dates and values.
var map&lt;string, float&gt; earningsMap = map.new&lt;string, float&gt;()
// If `request.security()` returned data, add an entry to the map with the date as the key and earnings as the value.
if not na(earnings)
    map.put(earningsMap, str.format_time(time, "yyyy-MM-dd"), earnings)
// On the last historical bar, loop through the map in the insertion order, writing the key-value pairs to the logs.
if barstate.islastconfirmedhistory
    string logText = "\n"
    for [key, value] in earningsMap
        logText += str.format("{0}: {1}\n", key, value)
    log.info(logText)</code></div>
<p>Here, we use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.earnings">request.earnings()</a> with the barmerge parameter set to <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.gaps_on">barmerge.gaps_on</a> to return the earnings value on bars where earnings data is available, and return <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> otherwise.
We add non-na values to the map, associating the dates that earnings occurred with the earnings numbers. Finally, on the last historical bar, the script <a href="/pine-script-docs/v5/language/maps/#looping-through-a-map">loops through the map</a>, logging each key-value pair to display the map’s contents.</p>
<p>To learn more about working with maps, refer to the <a href="/pine-script-docs/v5/language/maps/">Maps</a> section in the User Manual.</p>
<h2 class="md-heading" id="whats-the-difference-between-a-series-and-an-array"><a href="#whats-the-difference-between-a-series-and-an-array">What’s the difference between a series and an array?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In Pine Script™, <a href="/pine-script-docs/v5/language/type-system/#series">“series”</a> variables are calculated on each bar. Historical values cannot change. Series values can change during the realtime bar, but when the bar closes, the value for that bar becomes fixed and immutable.
These fixed values are automatically indexed for each bar. Scripts can access values from previous bars by using the <a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">[] history-referencing operator</a>) to go back one or more bars.</p>
<p>Where “series” variables are strictly time-indexed, and the historical values are created automatically, <a href="/pine-script-docs/v5/language/arrays/">arrays</a> are created, filled, and manipulated arbitrarily by a script’s logic. Programmers can change the size of arrays dynamically by using functions that <a href="/pine-script-docs/v5/language/arrays/#inserting-and-removing-array-elements">insert or remove elements</a>. Any element in an array can also be altered using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.set">array.set()</a> function.</p>
<p>The concept of <a href="/pine-script-docs/v5/language/time-series/">time series</a> is a fundamental aspect of Pine Script™. Its series-based <a href="/pine-script-docs/v5/language/execution-model/">execution model</a> processes scripts bar-by-bar. This built-in behavior mimics looping, allowing a series to track values, accumulate totals, or perform calculations across a sequence of data on each bar.</p>
<p>Simple calculations can thus be done efficiently using “series” variables. Using arrays for similar tasks requires manually creating a dataset, managing its size, and using loops to process the array’s contents, which can be far less efficient.</p>
<p>Arrays, of course, can do many things that series variables cannot. Scripts can use arrays to store a fixed set of values, store complex data such as User-Defined Types, manipulate objects for visual display, and more.
In general, use arrays to handle data that doesn’t fit the time series model, or for complex calculations. Arrays can also mimic series by creating custom datasets, as in the <a href="https://www.tradingview.com/script/Bn7QkdZR-getSeries/">getSeries</a> library.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>An array is itself a series. Historical values of an array can be <a href="https://www.tradingview.com/pine-script-docs/language/arrays/#history-referencing">accessed by using the history-referencing operator</a>.</p></div></aside>
<h2 class="md-heading" id="how-do-i-create-and-use-arrays-in-pine-script"><a href="#how-do-i-create-and-use-arrays-in-pine-script">How do I create and use arrays in Pine Script™?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ <a href="/pine-script-docs/v5/language/arrays/">arrays</a> are one-dimensional collections that can hold multiple values of a single type.</p>
<p><strong>Declaring arrays</strong></p>
<p>Declare an array by using one of the following functions:
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E">array.new&lt;type&gt;()</a>,
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dfrom">array.from()</a>,
or
<a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dcopy">array.copy()</a>.
Arrays can be declared with the <a href="/pine-script-docs/v5/language/variable-declarations/#var">var</a> keyword to have their values persist from bar to bar, or without it, so that the values initialize again on each bar.
For more on the differences between declaring arrays with or without <a href="/pine-script-docs/v5/language/variable-declarations/#var">var</a>, see <a href="/pine-script-docs/v5/faq/data-structures/#whats-the-difference-between-an-array-declared-with-or-without-var">this section</a> of this FAQ.</p>
<p><strong>Adding and removing elements</strong></p>
<p>Pine Script™ provides several functions for dynamically adjusting the size and contents of arrays.</p>
<p class="spacer-wrapper"><spacer/><strong>Adding elements</strong></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dunshift">array.unshift()</a>
inserts a new element at the beginning of an array (index 0) and increases the index values of any existing elements by one.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dinsert">array.insert()</a>
inserts a new element at the specified index and increases the index of existing elements at or after the insertion index by one.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dpush">array.push()</a>
adds a new element at the end of an array.</li>
</ul>
<p class="spacer-wrapper"><spacer/><strong>Removing elements</strong></p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dremove">array.remove()</a>
removes the element at the specified index and returns that element’s value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dshift">array.shift()</a>
removes the first element from an array and returns its value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dpop">array.pop()</a>
removes the last element of an array and returns its value.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array%7Bdot%7Dclear">array.clear()</a>
removes all elements from an array. Note that clearing an array won’t delete any objects that were referenced by its elements. If you want to delete objects contained by an array, loop through the array and delete the objects first, and then clear the array.</li>
</ul>
<p>The flexibility afforded by these functions supports various data management strategies, such as
<a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queues</a> or <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-stack">stacks</a>, which are useful for custom datasets or sliding window calculations.
Read more about implementing a stack or queue in <a href="/pine-script-docs/v5/faq/data-structures/#what-are-queues-and-stacks">this FAQ entry</a>.</p>
<p><strong>Calculations on arrays</strong></p>
<p>Because arrays are not <a href="/pine-script-docs/v5/language/time-series/">time series</a> data structures, performing operations across an array’s elements requires special functions designed for arrays.
Programmers can write custom functions to perform calculations on arrays. Additionally, built-in functions enable computations like finding the maximum, minimum, or average values within an array.
See the <a href="/pine-script-docs/v5/language/arrays/#calculations-on-arrays">Calculation on arrays</a> section of the User Manual for more information.</p>
<p><strong>Script example</strong></p>
<p>This script example demonstrates a practical application of arrays by tracking the opening prices of the last five sessions. The script declares a float array to hold the prices using the <a href="/pine-script-docs/v5/language/variable-declarations/#var">var</a> keyword, allowing it to retain its values from bar to bar.</p>
<p>At the start of each session, we update the array by adding the new opening price and removing the oldest one. This process, resembling a <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queue</a>, keeps the array’s size constant while maintaining a moving window of the session opens for the last five days.
Built-in array functions return the highest, lowest, and average opening price over the last five sessions. We plot these values to the chart.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1284" loading="lazy" src="images/c6df9a2620ed177e2a9b1b110ad4dba0.webp" width="2366"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array demo", overlay = true)
// Create an input to determine the number of session opens to track, with a default value of 5.
int numOpensInput = input.int(5, "Number of opens to track")
// Create an array to store open prices. Using `var` ensures the array retains its values from bar to bar.
// Initially, the array is filled with placeholder values (`na`), which are later updated with actual open prices.
var array&lt;float&gt; opensArray = array.new&lt;float&gt;(numOpensInput)
// On the first bar of each session, update the array: add the current open price and remove the oldest entry.
if session.isfirstbar_regular
    array.push(opensArray, open)
    array.shift(opensArray)
// Plot the highest, lowest, and average open prices from the tracked sessions
plot(array.max(opensArray), "Highest open in n sessions",       color.lime)
plot(array.min(opensArray), "Lowest open in n sessions",        color.fuchsia)
plot(array.avg(opensArray), "Avg. open of the last n sessions", color.gray)
// Change the background color on the first bar of each session to visually indicate session starts.
bgcolor(session.isfirstbar_regular ? color.new(color.gray, 80) : na)</code></div>
<p>For more information about arrays, see the <a href="/pine-script-docs/v5/language/arrays/#arrays">Arrays</a> page in the User Manual.</p>
<h2 class="md-heading" id="whats-the-difference-between-an-array-declared-with-or-without-var"><a href="#whats-the-difference-between-an-array-declared-with-or-without-var">What’s the difference between an array declared with or without `var`?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a> keyword, a script can declare an <a href="/pine-script-docs/v5/language/arrays/">array</a> variable in a script that is initialized only once, during the first iteration on the first chart bar.</p>
<p><strong>Persistent arrays</strong></p>
<p>When an array is declared with <a href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a>, it is initialized only once, at the first execution of the script. This allows the array to retain its contents and potentially grow in size across bars, making it ideal for cumulative data collection or tracking values over time.</p>
<p><strong>Non-persistent arrays</strong></p>
<p>Arrays declared without <a href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a> are reinitialized on every new bar, effectively resetting their content. This behavior suits scenarios where calculations are specific to the current bar, and historical data retention is unnecessary.</p>
<p><strong>Example script</strong></p>
<p>Here, we initialize two arrays. Array <code dir="auto">a</code> is declared without using the <a href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a> keyword, while array <code dir="auto">b</code>
is declared with <a href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a>, allowing us to observe and compare their behavior. Throughout the runtime, we incrementally add an element to
each array on each bar. We use a <a href="/pine-script-docs/v5/concepts/tables/">table</a> to present and compare both the sizes of these arrays and the number of chart bars, effectively illustrating the impact of
different declaration methods on array behavior:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Using `var` with arrays")
//@variable An array that initializes on every bar.
a = array.new&lt;float&gt;()
array.push(a, close)
//@variable An array that expands its size by 1 on each bar.
var b = array.new&lt;float&gt;(0)
array.push(b, close)
// Populate a table on the chart's last bar to display the sizes of the arrays and compare it to the number of chart bars.
if barstate.islast
    var table displayTable = table.new(position.middle_right, 2, 3)
    table.cell(displayTable, 0, 0, "Array A size:",             text_color = chart.fg_color, text_halign = text.align_right)
    table.cell(displayTable, 1, 0, str.tostring(a.size()),      text_color = chart.fg_color, text_halign = text.align_left)
    table.cell(displayTable, 0, 1, "Array B size:",             text_color = chart.fg_color, text_halign = text.align_right)
    table.cell(displayTable, 1, 1, str.tostring(b.size()),      text_color = chart.fg_color, text_halign = text.align_left)
    table.cell(displayTable, 0, 2, "Number of chart bars:",     text_color = chart.fg_color, text_halign = text.align_right)
    table.cell(displayTable, 1, 2, str.tostring(bar_index + 1), text_color = chart.fg_color, text_halign = text.align_left)</code></div>
<p><strong>Results</strong></p>
<ul>
<li><strong>Array A (Non-Persistent):</strong> This array is reset at the beginning of each new bar. As a result, despite adding elements on each bar, its size remains constant, reflecting only the most recent addition.</li>
<li><strong>Array B (Persistent):</strong> This array retains its elements and accumulates new entries across bars, mirroring the growing count of chart bars. This persistent nature of the array shows its ability to track or aggregate data over the script’s runtime.</li>
</ul>
<p>For further details, consult the sections concerning variable
<a href="/pine-script-docs/v5/language/variable-declarations/#declaration-modes">declaration modes</a> and their use in
<a href="/pine-script-docs/v5/language/arrays/#using-var-and-varip-keywords">array declarations</a> in the User Manual.</p>
<h2 class="md-heading" id="what-are-queues-and-stacks"><a href="#what-are-queues-and-stacks">What are queues and stacks?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts can use <a href="/pine-script-docs/v5/language/arrays/">arrays</a> to create <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queues</a> and <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-stack">stacks</a>.</p>
<p><strong>Stacks</strong></p>
<p class="spacer-wrapper"><spacer/> A stack uses the “last in, first out” (LIFO) principle, where the most recently added item is the first to be taken away.
Think of this like a stack of plates, where you can only place a new plate on top or remove the top plate. To use an array as a stack, add elements to the end of the array using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a> and remove elements from the end of the array using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.pop">array.pop()</a>.</p>
<p><strong>Queues</strong></p>
<p class="spacer-wrapper"><spacer/> A queue uses the “first in, first out” (FIFO) principle, where the first item to be added is the first to be removed. This kind of queue in code is like a queue in real life, such as in a coffee shop, where no matter how many people join the end of the queue, the first person still gets served first. To use an array as a queue, add elements to the end of the array using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.push">array.push()</a> and remove them from the beginning using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.shift">array.shift()</a>.</p>
<p>Stacks are particularly useful for accessing the most recent data, such as for tracking price levels. Queues are used for sequential data processing tasks, like event handling. Two example scripts follow, to illustrate these different usages.</p>
<p><strong>Example: Arrays as stacks</strong></p>
<p>This script uses arrays as stacks to manage pivot points. It draws <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> from the pivot points and extends the lines with each new bar until price intersects them.
When the script detects a pivot point, it adds (pushes) a new line to the stack. With each new bar, the script extends the end point of each line in the stack.
It then checks whether price has intersected the high or low pivot lines at the top of the stack. If so, the script removes (pops) the intersected line from the stack, meaning that it will no longer be extended with new bars.
Note that we do not need to iterate through the arrays to check all the lines, because price is always between only the high and low pivot lines at the end of each array.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1288" loading="lazy" src="images/a8913fdb42d943a57ae9e552b1bbde9f.webp" width="2366"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array as a stack", overlay = true)

// @function                Adds a new horizontal line to an array of lines at a specified pivot level.
// @param id                (array&lt;line&gt;) The array to which to add the new line.
// @param pivot             (float) The price level at which to draw the horizontal line.
// @param lineColor         (color) The color of the line.
// @returns                 (void) The function has no explicit return.
stackLine(array&lt;line&gt; id, float pivot, color lineColor) =&gt;
    if not na(pivot)
        array.push(id, line.new(bar_index - 10, pivot, bar_index, pivot, color = lineColor))

// @function                Extends the endpoint (`x2`) of each line in an array to the current `bar_index`.
// @param id                (array&lt;line&gt;) The array containing the line objects to update.
// @returns                 (void) The function has no explicit return.
extendLines(array&lt;line&gt; id) =&gt;
    for eachLine in id
        eachLine.set_x2(bar_index)

// @function                Removes line objects from an array if they are above or below the current bar's high or low.
// @param id                (array&lt;line&gt;) The array from which to remove line objects.
// @param isBull            (bool) If true, remove bullish pivot lines below the high price;
//                          if false, remove bearish pivot line above the low price.
// @returns                 (void) The function has no explicit return.
removeLines(array&lt;line&gt; id, bool isBull) =&gt;
    if array.size(id) &gt; 0
        float linePrice = line.get_price(array.last(id), bar_index)
        if isBull ? high &gt; linePrice : low &lt; linePrice
            array.pop(id)
    line(na)

// Find the pivot high and pivot low prices.
float pivotLo = ta.pivotlow(10,  10), float pivotHi = ta.pivothigh(10, 10)

// Initialize two arrays on the first bar to stack our lines in.
var array&lt;line&gt; pivotHiArray = array.new&lt;line&gt;()
var array&lt;line&gt; pivotLoArray = array.new&lt;line&gt;()

// If a pivot occurs, draw a line from the pivot to the current bar and add the line to the stack.
stackLine(pivotHiArray, pivotHi, color.orange)
stackLine(pivotLoArray, pivotLo, color.aqua)

// Extend all lines in each array to the current bar on each bar.
extendLines(pivotHiArray)
extendLines(pivotLoArray)

// Check the final element of each array to see if price exceeded the pivot lines.
// Pop the line off the stack if it was exceeded.
removeLines(pivotHiArray, true)
removeLines(pivotLoArray, false)</code></div>
<p><strong>Example: Arrays as queues</strong></p>
<p>This script uses arrays as queues to track pivot points for monitoring recent support and resistance levels. It dynamically updates <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> extending from the four most recent pivot highs and lows to the current bar with each new bar. When the script detects a new pivot high or low, it adds a line that represents this pivot to the respective queue.
To maintain the queue’s size at a constant four items, the script removes the oldest line in the queue whenever it adds a new line.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1142" loading="lazy" src="images/5dfcf61359fd92b1fd7e1283f4e01322.webp" width="2110"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array as a queue", overlay = true)

int PIVOT_LEGS = 10

// @function            Queues a new `value` at the end of the `id` array and removes
//                      the first element if the array size exceeds the specified `maxSize`.
// @param id            (&lt;any array type&gt;) The array in which to queue the element.
// @param maxSize       (int) The maximum allowed number of elements in the array.
//                      If the array exceeds this size, the first element is removed.
// @param value         (&lt;type of the array&gt;) The new element to add to the array.
// @returns             (&lt;type of the array&gt;) The removed element.
arrayQueue(id, int maxSize, value) =&gt;
    id.push(value)
    if id.size() &gt; maxSize
        id.shift()

// @function                Adds a new horizontal line to an array at a certain pivot level and removes the oldest line.
// @param id                (array&lt;line&gt;) The array to which to add the new line.
// @param pivot             (float) The price level at which to draw the horizontal line.
// @param numLines          (int) The number of lines to keep in the queue.
// @param lineColor         (color) The color of the line to draw.
// @returns                 (void) The function has no explicit return.
queueLine(array&lt;line&gt; id, float pivot, int numLines, color lineColor) =&gt;
    if not na(pivot)
        arrayQueue(id, numLines, line.new(bar_index - PIVOT_LEGS, pivot, bar_index, pivot, color = lineColor))

// @function                Extends the endpoint (`x2`) of each line in an array to the current `bar_index`.
// @param id                (array&lt;line&gt;) The array containing the line objects to update.
// @returns                 (void) The function has no explicit return.
extendLines(array&lt;line&gt; id) =&gt;
    for eachLine in id
        eachLine.set_x2(bar_index)

// Find the pivot high and pivot low price.
float pivotLo = ta.pivotlow(PIVOT_LEGS,  PIVOT_LEGS)
float pivotHi = ta.pivothigh(PIVOT_LEGS, PIVOT_LEGS)

// Initialize two arrays on the first bar to queue our lines in.
var array&lt;line&gt; pivotHiArray = array.new&lt;line&gt;()
var array&lt;line&gt; pivotLoArray = array.new&lt;line&gt;()

// If a pivot occurs, draw a line from the pivot to the current bar, add it to the queue, and remove the oldest line.
queueLine(pivotHiArray, pivotHi, 4, color.orange)
queueLine(pivotLoArray, pivotLo, 4, color.aqua)

// Extend all lines in each array to the current bar on each bar.
extendLines(pivotHiArray)
extendLines(pivotLoArray)</code></div>
<p>For more information on manipulating arrays, see the <a href="/pine-script-docs/v5/language/arrays/">Arrays</a> section in the User Manual.</p>
<h2 class="md-heading" id="how-can-i-perform-operations-on-all-elements-in-an-array"><a href="#how-can-i-perform-operations-on-all-elements-in-an-array">How can I perform operations on all elements in an array?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>In Pine Script™, there are no built-in functions to apply operations across the entire array at once. Instead, scripts need to iterate through the array, performing the operation on each element one at a time.</p>
<p>The easiest way to retrieve each element in an array is by using a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> structure. This type of loop retrieves each element in turn, without the need for specifying the number of iterations.</p>
<p>The simple form of the loop has the format <code dir="auto">for element in array</code>, where <code dir="auto">element</code> is a variable that is assigned the current array element being accessed.</p>
<p>If the script’s logic requires the position of the element in the array, use the two-argument form: <code dir="auto">for [index, element] in array</code>. This form returns both the current element and its index in a <a href="/pine-script-docs/v5/language/type-system/#tuples">tuple</a>.</p>
<p><strong>Example: retrieving array elements</strong></p>
<p>This first example script uses an array as a <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queue</a> to store <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> representing the latest four pivot highs and lows. The <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop performs two tasks:</p>
<ul>
<li>It adjusts the <code dir="auto">x2</code> endpoint of each line to the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.</li>
<li>It changes the colors of the lines to blue for support or orange for resistance, based on their position relative to the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
price.</li>
</ul>
<p>Note that neither of these operations requires knowing the index of the array element.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1288" loading="lazy" src="images/46eeb241becaf64c50abdda769746622.webp" width="2364"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example: `for...in` loop", overlay = true)

// @function            Queues a new `value` at the end of the `id` array and removes
//                      the first element if the array size exceeds the specified `maxSize`.
// @param id            (&lt;any array type&gt;) The array in which to queue the element.
// @param maxSize       (int) The maximum allowed number of elements in the array.
//                      If the array exceeds this size, the first element is removed.
// @param value         (&lt;type of the array&gt;) The new element to add to the array.
// @returns             (&lt;type of the array&gt;) The removed element.
arrayQueue(id, int maxSize, value) =&gt;
    id.push(value)
    if id.size() &gt; maxSize
        id.shift()

// @function                Adds a new horizontal line to an array at a certain pivot level and removes the oldest line.
// @param id                (array&lt;line&gt;) The array to which to add the new line.
// @param pivot             (float) The price level at which to draw the horizontal line.
// @param numLines          (int) The number of lines to keep in the queue.
// @param lineColor         (color) The color of the line to draw.
// @returns                 (void) The function has no explicit return.
queueLine(array&lt;line&gt; id, float pivot, int numLines, color lineColor) =&gt;
    if not na(pivot)
        arrayQueue(id, numLines, line.new(bar_index - 10, pivot, bar_index, pivot, color = lineColor))

// @function                Extends the endpoint (`x2`) of each line in an array to the current `bar_index`.
// @param id                (array&lt;line&gt;) The array containing the line objects to update.
// @returns                 (void) The function has no explicit return.
extendLines(array&lt;line&gt; id) =&gt;
    for eachLine in id
        eachLine.set_x2(bar_index)

// @function                Adjusts the color of each line in an array. If the `close` is above the line, the line is 
//                          set to `bullColor` (support), else, `bearColor` (resistance).
// @param id                (array&lt;line&gt;) The array containing the line objects.
// @param bullColor         (color) The color to apply to the line if `close` is equal to or higher than the line's price.
// @param bearColor         (color) The color to apply to the line if `close` is below the line's price.
// @returns                 (void) The function has no explicit return.
colorLines(array&lt;line&gt; id, color bullColor, color bearColor) =&gt;
    for eachLine in id
        if close &gt;= eachLine.get_price(bar_index)
            eachLine.set_color(bullColor)
        else
            eachLine.set_color(bearColor)

// Find the pivot high and pivot low prices.
float pivotLo = ta.pivotlow(10,  10)
float pivotHi = ta.pivothigh(10, 10)

// Initialize two arrays on the first bar to queue our lines in.
var array&lt;line&gt; pivotHiArray = array.new&lt;line&gt;(), var array&lt;line&gt; pivotLoArray = array.new&lt;line&gt;()

// If a pivot occurs, draw a line from the pivot to the current bar, add it to the queue, and remove the oldest line.
queueLine(pivotHiArray, pivotHi, 4, color.orange), queueLine(pivotLoArray, pivotLo, 4, color.aqua)

// Extend all lines in each array to the current bar on each bar.
extendLines(pivotHiArray), extendLines(pivotLoArray)

// Set the color of lines as support or resistance by checking if the closing price is above or below the lines.
colorLines(pivotHiArray, color.aqua, color.orange)
colorLines(pivotLoArray, color.aqua, color.orange)</code></div>
<p><strong>Example: retrieving array elements and indices</strong></p>
<p>In our second script, we use the two-argument variant of the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_for...in">for…in</a> loop to access elements and their indices in an array.
This method facilitates operations that depend on element indices, such as managing parallel arrays or incorporating index values into calculations.
The script pairs a boolean array with an array of positive and negative random integers. The boolean array flags whether each corresponding integer in the primary array is positive.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example: `for...in` loop with index")
// Create an array of random integers above and below 0.
var valuesArray = array.from(4, -8, 11, 78, -16, 34, 7, 99, 0, 55)
// Create an array to track the positive state of each integer.
var isPos = array.new_bool(10, false)

// Iterate over the valuesArray using a `for...in` loop and update each corresponding element in the bool array to true
// if the value is above 0, or false if it is below 0.
for [i, eachValue] in valuesArray
    if eachValue &gt; 0
        array.set(isPos, i, true)

// Print both arrays in a label on the last historical bar.
if barstate.islastconfirmedhistory
    label.new(bar_index +1, high, str.tostring(valuesArray) + "\n" + str.tostring(isPos), style = label.style_label_left, textcolor = chart.fg_color)</code></div>
<h2 class="md-heading" id="whats-the-most-efficient-way-to-search-an-array"><a href="#whats-the-most-efficient-way-to-search-an-array">What’s the most efficient way to search an array?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The obvious way to search for an element in an array is to use a <a href="/pine-script-docs/v5/language/loops/">loop</a> to check each element in turn.
However, there are more efficient ways to search, which can be useful in different situations.
Some of the following functions return only the index of a value. Programmers can then use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.get">array.get()</a> if the script needs the actual value.</p>
<h3 class="md-heading" id="checking-if-a-value-is-present-in-an-array"><a href="#checking-if-a-value-is-present-in-an-array">Checking if a value is present in an array<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If all the script needs to do is to check whether a certain value is present in an array or not, use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.includes">array.includes()</a> function.
If the element is found, the function returns <a href="https://www.tradingview.com/pine-script-reference/v5/#const_true">true</a>; otherwise, it returns <a href="https://www.tradingview.com/pine-script-reference/v5/#const_false">false</a>.
This method does not return the index of the element.</p>
<p>The following example script checks if the value <code dir="auto">3</code> is present in the <code dir="auto">values</code> array, and displays either “found” or “not found” in a <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">label</a>.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example: Find whether an array element is present")
array&lt;int&gt; values = array.from(1, 3, 5)
int searchValue = input(3, "Value to Search For")
bool valuePresent = array.includes(values, searchValue)
if barstate.islast
    label.new(bar_index, low, valuePresent ? "Search value found" : "Search value not found", textcolor = color.white)</code></div>
<h3 class="md-heading" id="finding-the-position-of-an-element"><a href="#finding-the-position-of-an-element">Finding the position of an element<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If the script requires the <em>position</em> of an element, programmers can use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a> function.
This function returns the index of the <em>first</em> occurrence of a value within an array. If the value is not found, the function returns <code dir="auto">-1</code>.
This method does not show whether there are multiple occurrences of the search value in the array. Depending on the script logic, this method might not be suitable if the array contains values that are not unique.</p>
<p>The following script searches for the first occurrence of <code dir="auto">101.2</code> in the <code dir="auto">prices</code> array and displays “found” and the value’s index in a label, or “not found” otherwise.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example: Find index of array element")
array&lt;float&gt; prices = array.from(100.5, 101.2, 102.8, 100.5)
float searchValue = input(101.2, "Value to Search For")
int indexFound = array.indexof(prices, searchValue)
if barstate.islast
    string lblString = switch
        indexFound &lt; 0 =&gt; "Search value: not found"
        =&gt;                "Search value: found\n       Index: " + str.tostring(indexFound)
    label.new(bar_index, high, lblString,
         textcolor        = color.white,
         textalign        = text.align_left,
         text_font_family = font.family_monospace
     )</code></div>
<h3 class="md-heading" id="binary-search"><a href="#binary-search">Binary search<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If the script requires the position of the element in a sorted array, the function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search">array.binary_search()</a> returns the index of a value more efficiently than <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.indexof">array.indexof()</a>. The performance improvement is significant for large arrays. If the value is not found, the function returns <code dir="auto">-1</code>.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The array must be of type “int” or “float” and must be <a href="/pine-script-docs/v5/language/arrays/#sorting">sorted</a> in ascending order for <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search">array.binary_search()</a> to work.</p></div></aside>
<p>This script uses a binary search to find the value <code dir="auto">100.5</code> within an array of prices. The script displays the original array, the sorted array, the target value (100.5), and the result of the search.
If the value is found, it displays “found”, along with the index of the value. If the value is not found, it displays “not found”.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Example: Binary search in sorted array")
array&lt;float&gt; sortedPrices = array.from(100.5, 102.3, 98.7, 99.2)
string originalArrayString = str.tostring(sortedPrices)
float searchValue = input(100.5)
// Ensure that the array is sorted (order is ascending by default); this step is crucial for binary search.
array.sort(sortedPrices)
string sortedArrayString = str.tostring(sortedPrices)
int searchValueIndex = array.binary_search(sortedPrices, searchValue)
bool valueFound = searchValueIndex &gt;= 0
if barstate.islast
    string lblTxt =
     str.format("Original array: {0}\n  Sorted Array: {1}\n  Search value: {2}\n   Value found: {3}\n      Position: {4}",
         originalArrayString,
         sortedArrayString,
         searchValue,
         valueFound,
         searchValueIndex
     )
    label.new(bar_index, high, lblTxt,
         textcolor        = color.white,
         textalign        = text.align_left,
         text_font_family = font.family_monospace
     )</code></div>
<p>If a script does not need the exact value, the functions <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search_leftmost">array.binary_search_leftmost()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.binary_search_rightmost">array.binary_search_rightmost()</a> provide an effective way to locate the nearest index to a given value in sorted arrays.
These functions return the index of the value, if it is present. If the value is not present, they return the index of the element that is closest to the search value on the left (smaller) or right (larger) side.</p>
<h2 class="md-heading" id="how-can-i-debug-arrays"><a href="#how-can-i-debug-arrays">How can I debug arrays?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To debug arrays, scripts need to display the contents of the array at certain points in the script.
Techniques that can display the contents of arrays include using plots, labels, tables, and Pine Logs.</p>
<p>For information about commonly encountered array-related errors, refer to the array <a href="/pine-script-docs/v5/language/arrays/#error-handling">Error Handling</a> section in the User Manual.</p>
<h3 class="md-heading" id="plotting"><a href="#plotting">Plotting<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> function to inspect the contents of an array can be helpful because this function can show numerical values on the script’s status line, the price
scale, and the Data Window. It is also easy to review historical values.</p>
<p>Limitations of this approach include:</p>
<ul>
<li>Arrays must be of type <a href="/pine-script-docs/v5/language/type-system/#float">“float”</a> or <a href="/pine-script-docs/v5/language/type-system/#int">“int”</a>.</li>
<li>The number of plots used for debugging counts towards the <a href="/pine-script-docs/v5/concepts/plots/#plot-count-limit">plot limit for a script</a>.</li>
<li>Plot calls must be in the global scope and scripts cannot call them conditionally. Therefore, if the size of the array varies across bars, using this technique can be impractical.</li>
</ul>
<p>Here we populate an array with the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> (OHLC) prices on each bar. The script retrieves all the elements of the array and plots them on the chart.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Plot array elements")
array&lt;float&gt; ohlc = array.from(open, high, low, close)
plot(ohlc.get(0), "Open",  color.red)
plot(ohlc.get(1), "High",  color.yellow)
plot(ohlc.get(2), "Low",   color.blue)
plot(ohlc.get(3), "Close", color.green)</code></div>
<h3 class="md-heading" id="using-labels"><a href="#using-labels">Using labels<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Using <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> to display array values on certain bars is particularly useful for non-continuous data points or to view all elements of an array simultaneously.
Scripts can create labels within any local scope, including <a href="/pine-script-docs/v5/language/user-defined-functions/">functions</a> and <a href="/pine-script-docs/v5/language/methods/#user-defined-methods">methods</a>. Scripts can also position drawings at any available chart location, irrespective of the current <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.
Unlike plots, labels can display the contents of a variety of array types, including boolean and string arrays.</p>
<p>Limitations of using labels include:</p>
<ul>
<li>Pine labels display only in the chart pane.</li>
<li>Scripts can display only up to a <a href="/pine-script-docs/v5/writing/limitations/#line-box-polyline-and-label-limits">maximum number of labels</a>.</li>
</ul>
<p>In the following example script, we monitor the close price at the last four moving average (MA) crosses in a queued array and use a label to display this array from a local scope whenever a cross occurs:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array elements in a label", overlay = true)

var array&lt;float&gt; crossPrices = array.new&lt;float&gt;(4)

float fastMa = ta.ema(close, 9)
float slowMa = ta.ema(close, 21)

if ta.cross(fastMa, slowMa)
    crossPrices.push(close)
    crossPrices.shift()
    label.new(bar_index, high, str.tostring(crossPrices), textcolor = color.white)

plot(fastMa, "Fast MA", color.aqua)
plot(slowMa, "Slow MA", color.orange)</code></div>
<p>For more information, see the <a href="/pine-script-docs/v5/writing/debugging/#using-labels">debugging with labels</a> section in the User Manual.</p>
<h3 class="md-heading" id="using-label-tooltips"><a href="#using-label-tooltips">Using label tooltips<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>If programmers want to be able to inspect the values in an array on every bar, displaying the contents of the array in a label is not convenient, because the labels overlap and become difficult to read.
In this case, displaying the array contents in a label tooltip can be visually clearer. This method has the same advantages and limitations as <a href="/pine-script-docs/v5/faq/data-structures/#using-labels">using labels</a> in the section above.</p>
<p>This example script plots a fast and a slow moving average (MA). It maintains one array of the most recent three values of the fast MA, and one array for the slow MA. The script prints empty labels on each bar.
The tooltip shows the values of the MA arrays and whether or not the MAs crossed this bar. The labels are displayed in a semi-transparent color, and the tooltip is visible only when the cursor hovers over the label.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array elements in a label tooltip", overlay = true)

// Create two arrays to hold the MA values.
var array&lt;float&gt; fastMaValues = array.new&lt;float&gt;(3)
var array&lt;float&gt; slowMaValues = array.new&lt;float&gt;(3)

// Calculate the MAs.
float fastMa = ta.ema(close, 9)
float slowMa = ta.ema(close, 21)

// Load the current MA values into the arrays.
fastMaValues.push(math.round(fastMa,2)), slowMaValues.push(math.round(slowMa,2))
// Remove the first element to keep the arrays at the same size.
fastMaValues.shift(),  slowMaValues.shift()
// Define the string to print in the label tooltip.
string labelString = str.format("Fast MA array: {0}\n  Slow MA array: {1}\n  Crossed this bar? {2}",
  str.tostring(fastMaValues),
  str.tostring(slowMaValues),
  ta.cross(fastMa, slowMa))
//Print the labels.
label.new(bar_index, high, text="", color=color.new(chart.fg_color,90), textcolor = chart.fg_color, tooltip=labelString)

plot(fastMa, "Fast MA", color.aqua)
plot(slowMa, "Slow MA", color.orange)</code></div>
<h3 class="md-heading" id="using-tables"><a href="#using-tables">Using tables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Using <a href="/pine-script-docs/v5/concepts/tables/">tables</a> for debugging offers a more organized and scalable alternative to labels. Tables can display multiple <a href="/pine-script-docs/v5/language/type-system/#series">“series”</a> strings in a clear format that remains unaffected by the chart’s scale or the index of the bars.</p>
<p>Limitations of using tables for debugging include that, unlike labels, the state of a table can only be viewed from the most recent script execution, making it hard to view historical data.
Additionally, tables are computationally more expensive than other debugging methods and can require more code.</p>
<p>In the following example script, we create and display two unrelated arrays, to show how flexible this approach can be. The first array captures the times of the last six bars where a Golden Cross occurred. The second array records the last eight bar indices where the Relative Strength Index (RSI) reached new all-time highs within the chart’s history. We use the <code dir="auto">whenSince()</code> function from the PineCoders’ <a href="https://www.tradingview.com/script/Bn7QkdZR-getSeries/">getSeries</a> library to create and update the arrays. This function treats the arrays as <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-queue">queues</a>, and limits their size.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debugging arrays with tables", overlay = true)

// Import the `getSeries` PineCoders library to build fixed-size arrays populated on specific conditions.
//      https://www.tradingview.com/v/Bn7QkdZR/
import PineCoders/getSeries/1 as PCgs

// Calculate MAs and create cross condition.
float ma50        = ta.sma(close,  50)
float ma200       = ta.sma(close,  200)
bool  goldenCross = ta.cross(ma50, ma200)

// Calculate the RSI and determine if it's hitting a new all-time high.
float myRsi       = ta.rsi(close,  20)
bool newRsiAth    = myRsi == ta.max(myRsi)

// Create two arrays using the imported `whenSince()` function.
array&lt;float&gt; goldenCrossesTimes = PCgs.whenSince(time_close, goldenCross, length = 6)
array&lt;float&gt; barIndicesOfHiRSIs = PCgs.whenSince(bar_index,  newRsiAth,   length = 8)

// Plot the MAs for cross reference.
plot(ma50,  "50 MA",  color.aqua)
plot(ma200, "200 MA", color.orange)

// On the last historical bar, display the date and time of the last crosses.
if barstate.islast
    // Declare our MA table to display the Golden Cross times. 
    var table maTable  = table.new(position.top_right, 2, 8, color.new(color.black, 100), color.gray, 1, color.gray, 1)
    // Create a title cell for the MA table and merge cells to form a banner two cells wide.
    table.cell(maTable , 0, 0, "Golden Cross Times", text_color = color.black, bgcolor = #FFD700)
    table.merge_cells(maTable , 0, 0, 1, 0)
    // Loop the array and write cells to the MA table containing the cross time for each element of the array. Number each element in the left row.
    // Format the UNIX time value to a formatted time string using `str.format_time()`.
    for [i, timeValue] in goldenCrossesTimes
        table.cell(maTable, 0, i + 1, str.tostring(i + 1), text_color = #FFD700)
        table.cell(maTable, 1, i + 1, str.format_time(int(timeValue), "yyyy.MM.dd 'at' HH:mm:ss z"), text_color = chart.fg_color)
    // Create a second table to display the indices of the last eight RSI all-time highs.
    var table rsiTable = table.new(position.bottom_right, 1, 1, color.new(color.black, 100), color.gray, 1, color.gray, 1)
    table.cell(rsiTable, 0, 0, "Bar indices of RSI ATHs\n" + str.tostring(barIndicesOfHiRSIs), text_color = chart.fg_color)</code></div>
<h3 class="md-heading" id="using-pine-logs"><a href="#using-pine-logs">Using Pine Logs<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p><a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> are messages that display in the Pine Logs pane, along with a timestamp when the logging function was called.
Scripts can create log messages at specific points during the execution of a script. Pine Logs can display any script values or variables at any part of your code, including <a href="/pine-script-docs/v5/writing/debugging/#local-drawings-and-logs">local scopes</a>, <a href="/pine-script-docs/v5/writing/debugging/#debugging-functions">functions</a>, and <a href="/pine-script-docs/v5/writing/debugging#debugging-loops">loops</a>.</p>
<p>By logging messages to the console whenever there is a modification to the array, programmers can track the logical flow of array operations in much more detail than by using other approaches.</p>
<p>The script below updates a previous example script from the section on <a href="/pine-script-docs/v5/faq/data-structures/#what-are-queues-and-stacks">queues and stacks</a> to add logging. It uses arrays as <a href="/pine-script-docs/v5/language/arrays/#using-an-array-as-a-stack">stacks</a> to track lines drawn from pivot points. When a pivot occurs, the script adds a new line to the stack and continues to extend the lines on each bar until an intersection with price occurs. If an intersection is found, the script removes (pops) the intersected line from the stack, meaning it will no longer be extended with new bars.</p>
<p>The <a href="/pine-script-docs/v5/writing/debugging/#creating-logs">console messages</a> are time stamped and offer detailed information about when elements are added to and removed from the arrays, the current size of the arrays, and the specific prices at which elements were added.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1288" loading="lazy" src="images/30855fa219ebae1b49ec71046a89bb94.webp" width="2364"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Array as a stack", overlay = true)

// @function                Adds a new horizontal line to an array of lines at a specified pivot level.
// @param id                (array&lt;line&gt;) The array to which to add the new line.
// @param pivot             (float) The price level at which to draw the horizontal line.
// @param lineColor         (color) The color of the line.
// @returns                 (void) The function has no explicit return.
stackLine(array&lt;line&gt; id, float pivot, color lineColor) =&gt;
    if not na(pivot)
        array.push(id, line.new(bar_index - 10, pivot, bar_index, pivot, color = lineColor))
        if barstate.isconfirmed
            log.info("\nNew line added at {0}\nArray size: {1}", pivot, id.size())

// @function                Extends the endpoint (`x2`) of each line in an array to the current `bar_index`.
// @param id                (array&lt;line&gt;) The array containing the line objects to update.
// @returns                 (void) The function has no explicit return.
extendLines(array&lt;line&gt; id) =&gt;
    for eachLine in id
        eachLine.set_x2(bar_index)

// @function                Removes line objects from an array if they are above or below the current bar's high or low.
// @param id                (array&lt;line&gt;) The array from which to remove line objects.
// @param isBull            (bool) If true, remove bullish pivot lines below the high price;
//                          if false, remove bearish pivot line above the low price.
// @returns                 (void) The function has no explicit return.
removeLines(array&lt;line&gt; id, bool isBull) =&gt;
    if array.size(id) &gt; 0
        float linePrice = line.get_price(array.last(id), bar_index)
        if isBull ? high &gt; linePrice : low &lt; linePrice
            array.pop(id)
            if barstate.isconfirmed
                log.warning(
                 "\nLine removed from {0} array.\nPrice breached {1}\nArray size: {2}", 
                 isBull ? "Highs" : "Lows", linePrice, id.size())

// Find the pivot high and pivot low prices.
float pivotLo = ta.pivotlow(10,  10), float pivotHi = ta.pivothigh(10, 10)

// Initialize two arrays on the first bar to stack our lines in.
var array&lt;line&gt; pivotHiArray = array.new&lt;line&gt;()
var array&lt;line&gt; pivotLoArray = array.new&lt;line&gt;()

// If a pivot occurs, draw a line from the pivot to the current bar and add the line to the stack.
stackLine(pivotHiArray, pivotHi, color.orange), stackLine(pivotLoArray, pivotLo, color.aqua)

// Extend all lines in each array to the current bar on each bar.
extendLines(pivotHiArray), extendLines(pivotLoArray)

// Check the final element of each array. If price exceeded the pivot lines, pop the line off the stack.
removeLines(pivotHiArray, true), removeLines(pivotLoArray, false)</code></div>
<h2 class="md-heading" id="can-i-use-matrices-or-multidimensional-arrays-in-pine-script"><a href="#can-i-use-matrices-or-multidimensional-arrays-in-pine-script">Can I use matrices or multidimensional arrays in Pine Script™?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Pine Script™ does not directly support multidimensional arrays; however, it provides <a href="/pine-script-docs/v5/language/matrices/">matrices</a> and <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> (UDTs).
Programmers can use these data structures to create and manipulate complex datasets.</p>
<p><strong>Matrices</strong></p>
<p class="spacer-wrapper"><spacer/>Pine Script <a href="/pine-script-docs/v5/language/matrices/">matrices</a> are like two-dimensional arrays. They organize data in a rectangular grid, facilitating operations like transformations, linear algebra, and other complex calculations. They are particularly useful for quantitative modeling, such as portfolio optimization, correlation matrix analysis, and more.
Just as in <a href="/pine-script-docs/v5/language/arrays/">arrays</a>, all elements in a matrix must be of the same <a href="/pine-script-docs/v5/language/type-system#types">type</a>, which can be a built-in or a <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined</a> type. Pine Script™ provides a range of functions for <a href="/pine-script-docs/v5/language/matrices/#manipulating-a-matrix">manipulating</a> and performing <a href="/pine-script-docs/v5/language/matrices/#matrix-calculations">calculations</a> on matrices, including addition, subtraction, multiplication, and more.</p>
<p><strong>Using UDTs for multidimensional structures</strong></p>
<p class="spacer-wrapper"><spacer/>Programmers can achieve similar functionality to multidimensional arrays through defining <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined types</a> (UDTs). For example, a script can define a UDT that includes an array as one of its fields. UDTs themselves can be contained in arrays. In this way, scripts can effectively have arrays of arrays.</p>
<p>For more information, see the sections on <a href="/pine-script-docs/v5/language/matrices/">Matrices</a>, <a href="/pine-script-docs/v5/language/maps/">Maps</a>, and <a href="/pine-script-docs/v5/language/objects/">Objects</a> in the User Manual.</p>
<h2 class="md-heading" id="how-can-i-debug-objects"><a href="#how-can-i-debug-objects">How can I debug objects?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To debug <a href="/pine-script-docs/v5/language/objects/">objects</a>, create custom functions that break down an object into its constituent fields and convert these fields into strings.
See the <a href="/pine-script-docs/v5/writing/debugging/">Debugging</a> section of the User Manual for information about methods to display debug information.
In particular, <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> can display extensive and detailed debug information. See the FAQ section about debugging arrays <a href="http://localhost:4321/pine-script-docs/faq/data-structures/#using-pine-logs" rel="nofollow">using Pine Logs</a> for an explanation of using logs for debugging.</p>
<p>In our example script, we create a <a href="/pine-script-docs/v5/language/type-system/#user-defined-types">user-defined type</a> (UDT) named <code dir="auto">openLine</code>, which includes fields such as <code dir="auto">price</code>, <code dir="auto">openTime</code>, and a line object called <code dir="auto">level</code>.
On the first bar of each session, the script initializes a new <code dir="auto">openLine</code> instance. This object tracks the session’s opening price and time, and it draws a line at the open price, extending from the session’s start to
its close. An array stores each <code dir="auto">openLine</code> object. A custom function <code dir="auto">debugOpenLine()</code> breaks an <code dir="auto">openLine</code> object into its individual fields, converts the fields to strings, and then logs a message that displays these strings in the console.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1288" loading="lazy" src="images/b9d5776130a8b3f31b5cf784a368d776.webp" width="2364"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Debugging objects", overlay = true)

// Define the user-defined type.
type openLine
    float price
    int   openTime
    line  level

// @function            Queues a new `arrayElement` at the end of the `id` array and removes
//                      the first element if the array size exceeds the specified `maxSize`.
// @param id            (&lt;any array type&gt;) The array in which the element is queued.
// @param maxSize       (int) The maximum allowed number of elements in the array.
//                      If the array exceeds this size, the first element is removed.
// @param arrayElement  (&lt;array type) The new element to add to the array.
// @returns             (&lt;array type&gt;) The removed element.
arrayQueue(id, int maxSize, value) =&gt;
    id.push(value)
    if id.size() &gt; maxSize
        id.shift()

// @function            Logs detailed information about an open line object for debugging purposes.
// @param ol            (openLine) The open line object to log.
// @returns             (void) Function has no explicit return.
debugOpenLine(openLine ol) =&gt;
    if barstate.isconfirmed
        log.info("\nprice: {0}\nopenTime: {1}\nlevel line coords:\nx1: {2}\ny1: {3}\nx2: {4}\ny2: {5}",
             ol.price, ol.openTime, str.format_time(ol.level.get_x1()), ol.level.get_y1(),
             str.format_time(ol.level.get_x2()), ol.level.get_y2())

// Create an empty `openLine` array.
var openLineArray = array.new&lt;openLine&gt;()

// On session start, create a new `openLine` object and add it to the array.
// Use the custom debug function to print the object's fields to the Pine Logs pane.
if session.isfirstbar_regular
    openLine ol = openLine.new(open, time)
    ol.level := line.new(time, open, time_close("D"), open, xloc.bar_time, color = color.aqua)
    arrayQueue(openLineArray, 4, ol)
    debugOpenLine(ol)</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/alerts"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Alerts  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/functions"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Functions <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Functions</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-functions"><a href="#functions">Functions<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="can-i-use-a-variable-length-in-functions"><a href="#can-i-use-a-variable-length-in-functions">Can I use a variable length in functions?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Many <a href="/pine-script-docs/v5/language/built-ins#built-in-functions">built-in</a> technical analysis (TA) functions have a <code dir="auto">length</code> parameter, such as <code dir="auto">ta.sma(source, length)</code>.
A majority of these functions can process “<a href="/pine-script-docs/v5/language/type-system/#series">series</a>” lengths, i.e., lengths that can change from bar to bar.
Some functions, however, only accept “<a href="/pine-script-docs/v5/language/type-system/#simple">simple</a>” integer lengths, which must be known on bar zero and not change during the execution of the script.</p>
<p>Check the Reference Manual entry for a function to see what type of values a function can process.</p>
<p><strong>Additional resources</strong></p>
<p class="spacer-wrapper"><spacer/>For more advanced versions of functions that support “series” lengths, or for extra technical analysis tools explore the <a href="https://www.tradingview.com/script/BICzyhq0-ta/">ta library</a> on the TradingView profile.
This library offers a range of extended TA-related capabilities and custom implementations.</p>
<p><strong>User-defined functions</strong></p>
<p class="spacer-wrapper"><spacer/>For built-in functions that do not accept “series” lengths and for which the functionality is not available in the <a href="https://www.tradingview.com/script/BICzyhq0-ta/">ta library</a>, consider creating a <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a>.</p>
<h2 class="md-heading" id="how-can-i-calculate-values-depending-on-variable-lengths-that-reset-on-a-condition"><a href="#how-can-i-calculate-values-depending-on-variable-lengths-that-reset-on-a-condition">How can I calculate values depending on variable lengths that reset on a condition?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To calculate certain values that are dependent on varying lengths, which also reset under specific conditions, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.barssince">ta.barssince()</a>
function can be useful.
This function counts the number of bars since the last occurrence of a specified condition, automatically resetting the count each time this condition is met.
There are, however, some considerations to take into account when using this function for this purpose.</p>
<p>Firstly, before the condition is met for the first time in a chart’s history, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.barssince">ta.barssince()</a> returns <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>. This value is not usable as a length for functions and can cause errors, especially during execution on a chart’s early bars.
For a more robust version, use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> to replace the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> return of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.barssince">ta.barssince()</a> with zero for early bars.</p>
<p>Secondly, when the condition is met, <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.barssince">ta.barssince()</a> returns zero for that bar, since zero bars have elapsed since the condition was last true.</p>
<p>Since lengths cannot be zero, it is necessary to add one to a returned value of zero, ensuring that the length is always at least one.</p>
<p>Here’s an example of how to use these principles for a practical purpose. The following example script calculates the highest and lowest price points since the start of a new day.
We use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.change">timeframe.change()</a> to detect the start of a new day, which is our condition.
The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.barssince">ta.barssince()</a> function calculates the number of bars that elapsed since this condition was last met.
The script passes this number, or “lookback”, to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.lowest">ta.lowest()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.highest">ta.highest()</a>
functions, which determine the highest and lowest points since the start of the new day:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1276" loading="lazy" src="images/82d029b77493954a7469c3495a13a1b2.webp" width="2356"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Highest/lowest since new day", "", true)

// Identify the start of a new day and calculate the number of bars since then.
bool newDay  = timeframe.change("D")
int lookback = nz(ta.barssince(newDay)) + 1

// Calculate the highest and lowest point since the new day began.
float lowestSinceNewDay  = ta.lowest(lookback)
float highestSinceNewDay = ta.highest(lookback)

// Plot the high/low level since the start of a new day.
plot(lowestSinceNewDay, "High today", color.orange)
plot(highestSinceNewDay, "Low today", color.aqua)
// Change the background color to indicate the start of a new day.
bgcolor(newDay ? color.new(color.gray, 80) : na)
// Display the varying lookback period in Data Window.
plot(lookback, "Lookback", display = display.data_window)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>When scripts pass variable lengths to built-in functions, an error can occur if the specified number of bars back is excessively large and increases dynamically and unpredictably.
The error message “<em>Pine cannot determine the referencing length of a series. Try using max_bars_back</em>” indicates this issue. For more information on resolving this problem, refer to the
<a href="https://www.tradingview.com/support/solutions/43000587849-i-see-pine-cannot-determine-the-referencing-length-of-a-series-try-using-max-bars-back-error/">Help Center</a> article and
<a href="/pine-script-docs/v5/error-messages/#pine-script-cannot-determine-the-referencing-length-of-a-series-try-using-max_bars_back-in-the-indicator-or-strategy-function">User Manual</a>
entry on the topic.</p></div></aside>
<h2 class="md-heading" id="how-can-i-round-a-number-to-x-increments"><a href="#how-can-i-round-a-number-to-x-increments">How can I round a number to x increments?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Rounding numbers to specific increments is useful for tasks like calculating levels for grid trading, dealing with fractional shares, or aligning trading parameters to specific pip values.</p>
<p>In this example, the <code dir="auto">roundToIncrement()</code> function accepts a value and an increment as parameters. It divides the value by the increment, rounds the result, then multiplies it by the increment to give the rounded value.
To demonstrate the function, the closing price is rounded to the nearest increment defined in the user menu:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Round to x increment demo", overlay = true)

float incrementInput = input.float(0.75, "Increment", step = 0.25)

// @function                Rounds a value to the nearest multiple of a specified increment.
// @param value             The value to round.
// @param increment         The increment to round the value to.
// @returns                 The rounded value.
roundToIncrement(value, increment) =&gt;
    math.round(value / increment) * increment

plot(series = roundToIncrement(close, incrementInput), color = chart.fg_color)</code></div>
<h2 class="md-heading" id="how-can-i-control-the-precision-of-values-my-script-displays"><a href="#how-can-i-control-the-precision-of-values-my-script-displays">How can I control the precision of values my script displays?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">precision</code> and <code dir="auto">format</code> arguments in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>
declaration statement control the number of decimals in the values that a script displays.</p>
<p>By default, scripts use the precision of the price scale. To display more decimal places, specify a <code dir="auto">precision</code> argument that exceeds the value of the current price scale.</p>
<h2 class="md-heading" id="how-can-i-control-the-precision-of-values-used-in-my-calculations"><a href="#how-can-i-control-the-precision-of-values-used-in-my-calculations">How can I control the precision of values used in my calculations?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <code dir="auto">math.round(number, precision)</code> variation of the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.round">math.round()</a> function rounds values according to a specified precision.
Alternatively, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.round_to_mintick">math.round_to_mintick()</a> function rounds values to the nearest tick precision of the chart’s symbol.</p>
<h2 class="md-heading" id="how-can-i-round-to-ticks"><a href="#how-can-i-round-to-ticks">How can I round to ticks?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To round values to the tick precision of a chart’s symbol, use the function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.round_to_mintick">math.round_to_mintick()</a>.
To convert the resulting number to a string, use <code dir="auto">str.tostring(myValue, format.mintick)</code> to first round the number to tick precision and then return its string representation, where <code dir="auto">myValue</code> is the number to convert into a rounded string.</p>
<h2 class="md-heading" id="how-can-i-abbreviate-large-values"><a href="#how-can-i-abbreviate-large-values">How can I abbreviate large values?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are different ways to abbreviate large numerical values, such as volume. For instance, the number 1,222,333.0 can be simplified to 1.222M.
Here are some methods to accomplish this:</p>
<p><strong>Apply a global setting</strong></p>
<p class="spacer-wrapper"><spacer/>Use the argument <code dir="auto">format = format.volume</code> within either the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> statements. Using this setting, displays all values in the script in their abbreviated forms.</p>
<p><strong>Abbreviate specific values</strong></p>
<p class="spacer-wrapper"><spacer/>To abbreviate only certain values for string display, use the <code dir="auto">str.tostring(value, format.volume)</code> function.</p>
<p><strong>Use a custom function</strong></p>
<p class="spacer-wrapper"><spacer/>To specify a custom precision or abbreviate values up to trillions, use a custom function. In the following example script, the <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> <code dir="auto">abbreviateValue()</code> divides the <code dir="auto">value</code> by a power of ten based on its magnitude, and adds an abbreviation letter (K, M, B, or T) to represent the magnitude of the original value.
The function also adds a subtle space between the value and the magnitude letter. The <code dir="auto">print()</code> function displays the value on the chart for visualization.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Value abbreviation example")

// @function            Converts a numeric value into a readable string representation featuring the appropriate order
//                          of magnitude abbreviation (K, M, B, T).
// @param value         (float) The value to format.
// @param precision         (string) The numerical precision of the result. ("" for none, ".00" for two digits, etc.)
// @returns                 (string) The formatted value as a string with the appropriate abbreviation suffix.
abbreviateValue(float value, string precision) =&gt;
    float digitsAmt = math.log10(math.abs(value))
    string formatPrecision = "#" + precision
    string result = switch
        digitsAmt &gt; 12 =&gt; str.tostring(value / 1e12, formatPrecision + "  T")
        digitsAmt &gt; 9  =&gt; str.tostring(value / 1e9,  formatPrecision + "  B")
        digitsAmt &gt; 6  =&gt; str.tostring(value / 1e6,  formatPrecision + "  M")
        digitsAmt &gt; 3  =&gt; str.tostring(value / 1e3,  formatPrecision + "  K")
        =&gt;                str.tostring(value, "#" +  formatPrecision)

print(formattedString) =&gt;
    var table t = table.new(position.middle_right, 1, 1)
    table.cell(t, 0, 0, formattedString, bgcolor = color.yellow)

print(abbreviateValue(volume, ".00"))</code></div>
<h2 class="md-heading" id="how-can-i-calculate-using-pips"><a href="#how-can-i-calculate-using-pips">How can I calculate using pips?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Use the custom function <code dir="auto">calcBaseUnit()</code> in the following example script to return the correct pip value for Forex symbols, or the base unit of change for non-forex symbols:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Pip calculation example")

// @function            Calculates the chart symbol's base unit of change in asset prices.
// @returns             (float) A ticks or pips value of base units of change.
calcBaseUnit() =&gt;
    bool isForexSymbol = syminfo.type         == "forex"
    bool isYenQuote    = syminfo.currency     == "JPY"
    bool isYenBase     = syminfo.basecurrency == "JPY"
    float result = isForexSymbol ? isYenQuote ? 0.01 : isYenBase ? 0.00001 : 0.0001 : syminfo.mintick

// Call the function and plot the result in a label
var label baseUnitLabel = na
if barstate.islast
    baseUnitLabel := label.new(x=bar_index + 1, y=open, text="Base Unit: " + str.tostring(calcBaseUnit(), "#.######"), 
      style=label.style_label_left, color=color.new(color.blue, 0), textcolor=color.white)
    label.delete(baseUnitLabel[1])</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This function might not address all potential scenarios, so confirm the results with your broker to ensure the function’s output matches the broker’s values.</p></div></aside>
<h2 class="md-heading" id="how-do-i-calculate-averages"><a href="#how-do-i-calculate-averages">How do I calculate averages?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The method of calculating averages depends on the type of values to average.</p>
<p><strong>Distinct variables</strong></p>
<p class="spacer-wrapper"><spacer/>To find the average of a small number of discrete variables, use the function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.avg">math.avg(number0, number1, …)</a>.
Simply pass each of the variables as an argument to this function.</p>
<p><strong>Bar prices</strong></p>
<p class="spacer-wrapper"><spacer/>To find the average price of a single bar, use the built-in variables <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hl2">hl2</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_hlc3">hlc3</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_ohlc4">ohlc4</a>.</p>
<p><strong>Series values</strong></p>
<p class="spacer-wrapper"><spacer/>To compute the average of the last <em>n</em> values in a series, use the function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.sma">ta.sma(series,n)</a>.</p>
<p><strong>Custom datasets</strong></p>
<p class="spacer-wrapper"><spacer/>To average a custom set of values, organize them into an <a href="/pine-script-docs/v5/language/arrays/">array</a> and use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">array.avg()</a>. For complex datasets, programmers can use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_matrix.avg">matrix.avg()</a> function to average the contents of a matrix. For a deeper understanding of averaging custom datasets, refer to  this <a href="https://www.tradingview.com/script/9l0ZpuQU-ConditionalAverages/">conditional averages</a> publication.</p>
<h2 class="md-heading" id="how-can-i-calculate-an-average-only-when-a-certain-condition-is-true"><a href="#how-can-i-calculate-an-average-only-when-a-certain-condition-is-true">How can I calculate an average only when a certain condition is true?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The usual methods of calculating averages, which were discussed in the <a href="/pine-script-docs/v5/faq/functions#how-do-i-calculate-averages">calculating averages section</a> above, apply across <em>all</em> data points in a range.
To calculate averages of only those values that occur under specific conditions, calculate <em>conditional averages</em> using custom functions.</p>
<p>The example script below imports a <a href="/pine-script-docs/v5/concepts/libraries/">library</a> called <a href="https://www.tradingview.com/script/9l0ZpuQU-ConditionalAverages/">ConditionalAverages</a> and uses two of its functions:</p>
<ul>
<li>The <code dir="auto">avgWhen()</code> function calculates the average volume of session opening bars across the entire dataset.</li>
<li>The <code dir="auto">avgWhenLast()</code> function averages the opening volumes for the last five session opening bars.</li>
</ul>
<p>The condition for these conditional averages is <em>session opening bars</em>, which we determine using the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_session.isfirstbar_regular">session.isfirstbar_regular</a> variable.</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1276" loading="lazy" src="images/a7f417d81b64839e9f062c43ac8a1a6e.webp" width="2356"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Average session opening volume")

import PineCoders/ConditionalAverages/1 as PCca

// Color aqua for the session's opening bar, otherwise distinct colors for up/down volume columns.
color volumeColor = switch
    session.isfirstbar_regular =&gt; color.aqua
    close &gt; open               =&gt; color.new(#D1D4DC, 65)
    =&gt;                            color.new(#787B86, 65)

// Plot the volume columns.
plot(volume, "volume", volumeColor, 4, plot.style_histogram)
// Average volume over *all* session opening bars in the dataset.
plot(PCca.avgWhen(src = volume, cond = session.isfirstbar_regular), "avg. When", #FF00FF)
// Average volume over the last five opening bars.
plot(PCca.avgWhenLast(src = volume, cond = session.isfirstbar_regular, cnt = 5), "avgWhenInLast()", #00FF00)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The <a href="https://www.tradingview.com/script/9l0ZpuQU-ConditionalAverages/">ConditionalAverages</a> and <a href="https://www.tradingview.com/script/Bn7QkdZR-getSeries/">getSeries</a> libraries by PineCoders offer additional functions for conditional averaging and the creation of custom datasets.</p></div></aside>
<h2 class="md-heading" id="how-can-i-generate-a-random-number"><a href="#how-can-i-generate-a-random-number">How can I generate a random number?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_math.random">math.random()</a> function to generate random numbers.
This example script creates a circle plot with random RGB color values and a random y value between 0 and 1:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Random demo", overlay = false)

// Generate a random price value (the default range is 0 to 1).
float y = math.random()
// Generate a color with red, green, and blue values as separate random values between 0 and 255.
color plotColor = color.rgb(math.random(0, 255), math.random(0, 255), math.random(0, 255))
plot(series = y, title = "Random number", color = plotColor, linewidth = 2, style = plot.style_circles)</code></div>
<h2 class="md-heading" id="how-can-i-evaluate-a-filter-i-am-planning-to-use"><a href="#how-can-i-evaluate-a-filter-i-am-planning-to-use">How can I evaluate a filter I am planning to use?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To evaluate a filter, insert your filter code into the <a href="https://www.tradingview.com/script/oTEP9DJF-Filter-Information-Box-PineCoders-FAQ/">Filter Information Box - PineCoders FAQ</a> script.
This script conducts an impulse response analysis and shows the filter’s characteristics in a label on the chart.</p>
<p>For further details and a guide on integrating your filter into the code, refer to the publication’s description.</p>
<h2 class="md-heading" id="what-does-nz-do"><a href="#what-does-nz-do">What does nz() do?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> function replaces any <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values with zero, or with a user-defined value if the <code dir="auto">replacement</code> argument is specified. This function helps to prevent <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> values from interfering with calculations.</p>
<p>The following example script shows an exaggerated failure as a result of a single <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value. The <code dir="auto">barRangeRaw</code> variable is <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> only once, on the first bar, because it references a bar that does not exist, using the history-referencing operator. The alternative variable <code dir="auto">barRangeWithNz</code> uses <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> to prevent an <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value from ever occurring.</p>
<p>The <code dir="auto">dependentCalculation</code> variable takes one of these values and uses it to calculate a crude average of the bar range.
If the input to this calculation is ever <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>, the series will be <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> forever after that.</p>
<p>Choose between the two values for bar range using the input setting, and the range either displays or not. In the latter case, the Data Window shows that the value of <code dir="auto">dependentCalculation</code> is <code dir="auto">ϴ</code>, meaning <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("`na` values on first bar demo")

bool useNzInput = input.bool(true, "Use `nz` to ensure value is never na")

// This variable is na on the first bar.
float barRangeRaw = close - close[1]
// This variable is never na.
float barRangeWithNz = close - nz(close[1], open)
// Choose the value to use based on the input
float barRange = useNzInput ? barRangeWithNz : barRangeRaw

// Perform a calculation that depends on the barRange
var float dependentCalculation = 0
dependentCalculation := ((dependentCalculation + barRange)/2)
// Plot the results
plot(dependentCalculation, title="Average Bar Range")</code></div>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> function is also useful to protect against any potential divide-by-zero errors. It guarantees a return value even when an equation unintentionally features a zero in the denominator. Consider the following code snippet that intentionally creates a divide-by-zero
scenario by setting the denominator to zero. Without the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_nz">nz()</a> function, this expression would return <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
instead of zero:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">float dbzTest = nz(close / (close - close))</code></div> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/data-structures"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Data structures  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/indicators"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Indicators <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Indicators</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-indicators"><a href="#indicators">Indicators<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="can-i-create-an-indicator-that-plots-like-the-built-in-volume-or-volume-profile-indicators"><a href="#can-i-create-an-indicator-that-plots-like-the-built-in-volume-or-volume-profile-indicators">Can I create an indicator that plots like the built-in Volume or Volume Profile indicators?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/scripts/volumestudies/?script_type=indicators&amp;solution=43000591617">Volume</a> and <a href="https://www.tradingview.com/scripts/volumestudies/?script_type=indicators&amp;solution=43000703076">Visible Range Volume Profile</a> indicators (along with some other built-in indicators) are written in Java. They display data on the main chart pane in a unique way:</p>
<ul>
<li>The bars are anchored to the bottom or right edge of the chart, not to an absolute x or y value.</li>
<li>The length of the bars is a relative percentage of the available space and is not an absolute price or number of bars.</li>
<li>The length of the bars adjusts automatically according to the data from the range of bars that are visible on the chart. The lengths of the bars are normalized so as never to appear too small or too large.</li>
<li>The width of the bars adjusts automatically to fit the visible space.</li>
</ul>
<p>It is difficult for Pine Script™ indicators to plot values in the same way.</p>
<p><strong>Limitations of `plot.style_columns`</strong></p>
<p class="spacer-wrapper"><spacer/><a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">Volume</a>, or another series, plotted as columns, is anchored to the bottom of the chart, and the width and length of the bars can adjust dynamically. However, the tops of the bars are defined by absolute price values. This means that it is not possible for the series to be plotted on the main chart without distorting the price scale. Also, plots must be defined during processing of the bar they are plotted on, and cannot be plotted retroactively.</p>
<p><strong>Limitations of drawings</strong></p>
<p class="spacer-wrapper"><spacer/>Drawing objects such as <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines-and-boxes">lines and boxes</a> are anchored to an absolute price scale, not to the edge of the chart. Drawing objects do not adjust their length automatically. Lines do not adjust their width automatically. Although boxes can be drawn exactly one bar wide, and so adjust their width automatically, they cannot be drawn so as to fit exactly in one bar; they always draw from the middle of one bar to the middle of another.</p>
<p>The following example script demonstrates some techniques for approximating the way that the built-in <a href="https://www.tradingview.com/scripts/volumestudies/?script_type=indicators&amp;solution=43000591617">Volume</a> indicator displays.</p>
<ul>
<li>We use the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> built-in variables, through the PineCoders’ <a href="https://www.tradingview.com/script/j7vCseM2-VisibleChart/">VisibleChart library</a>, to define the bars that are visible. Then we calculate the highest and lowest price, and the highest <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>, for that period.</li>
<li>We plot lines retroactively, after the visible window and all related values are known.</li>
<li>We anchor the lines below the lowest visible price, so that it looks as if they are anchored to the bottom edge of the chart.</li>
<li>We scale the length of all the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a> bars so that the longest bar in the set is approximately 30% of the screen height, similar to the built-in <a href="https://www.tradingview.com/scripts/volumestudies/?script_type=indicators&amp;solution=43000591617">Volume</a> indicator.</li>
<li>We adjust the width of the lines depending on how many bars are visible.</li>
</ul>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>The bottom margin of the chart must be set to zero in order for the lines to start from the bottom edge of the chart. To set the margin, right-click the chart background and click “Settings…” then “Canvas”, and set the “Bottom” margin in the “Margins” section. To preserve the same space at the bottom of the chart, the user can add a bottom margin in the script settings.</p></div></aside>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Dynamically scaled volume", overlay=true, max_lines_count=500)

// Import the PineCoders' VisibleChart library
import PineCoders/VisibleChart/4 as visibleChart

const float    RELATIVE_HEIGHT    = 0.3 // 30% matches the built-in volume indicator.
const string   BOTTOM_TTIP = "Copy the bottom margin % from your chart settings to here, and then set
  the bottom margin to *zero* on the chart settings."

int bottomInput = input.int(title = "Bottom Margin %", defval = 10, minval = 0, maxval = 100, tooltip = BOTTOM_TTIP)

// Get the highest volume, and highest and lowest price points, by calculating on each bar during the visible window.
var float hiVol   = na
var float hiPrice = na
var float loPrice = na
if visibleChart.barIsVisible()
    hiVol   := na(hiVol)   ? volume : math.max(hiVol,   volume)
    hiPrice := na(hiPrice) ? high   : math.max(hiPrice, high)
    loPrice := na(loPrice) ? low    : math.min(loPrice, low)

int bars = visibleChart.bars()
// Calculate the thickness for the lines based on how many bars are displayed.
int lineWidth = math.ceil(1000/bars)

// Draw the lines once, when the visible window ends.
if time == chart.right_visible_bar_time
    // Calculate the bottom y coordinate for all lines once.
    float priceDifference = hiPrice - loPrice
    float scale = (priceDifference / hiVol) * RELATIVE_HEIGHT
    float bottomY = loPrice - (bottomInput / 100) * priceDifference
    // Loop through the visible window using the historical operator.
    for i = bars - 1 to 0
        // Calculate the top y coordinate for each line.
        float topY = bottomY + (volume[i] * scale)
        // Draw the line.
        line.new(x1 = bar_index - i, y1 = bottomY, x2 = bar_index - i, y2 = topY, color = close[i] &gt;= open[i] ?
          color.new(color.green, 50) : color.new(color.red, 50), width = lineWidth)</code></div>
<p>This script has some other limitations:</p>
<ul>
<li>The lines do not begin from the bottom of the chart if other indicators display plots or drawings below that level.</li>
<li>In common with any script that uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.right_visible_bar_time">chart.right_visible_bar_time</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#var_chart.left_visible_bar_time">chart.left_visible_bar_time</a> built-in variables, the script must refresh each time the chart is moved or a new bar appears.</li>
<li>There is a maximum <a href="/pine-script-docs/v5/writing/limitations/#line-box-polyline-and-label-limits">limit</a> of 500 lines per script.</li>
<li>The width of the lines is calculated based on how many bars are visible. However, a Pine script has no way of knowing how much blank space there is to the right of the final bar. If the user scrolls to the right, the lines can appear too wide and overlap each other.</li>
</ul>
<h2 class="md-heading" id="can-i-use-a-pine-script-with-the-tradingview-screener"><a href="#can-i-use-a-pine-script-with-the-tradingview-screener">Can I use a Pine script with the TradingView screener?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The TradingView <a href="https://www.tradingview.com/screener/">screener</a> uses only its built-in filters, and cannot use a Pine script.
<a href="https://www.tradingview.com/scripts/search/screener/">Search for “screener”</a> in the Community Collection to find scripts that use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function to screen pre-set lists of symbols.</p>
<p>See also <a href="/pine-script-docs/v5/faq/alerts/#how-can-i-get-custom-alerts-on-many-symbols">this FAQ entry</a> for an example script that generates alerts on multiple
symbols.
Note that using several <code dir="auto">request.security()</code> calls can cause scripts compile and run more slowly than expected.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Scripts can make a maximum of 40 distinct <code dir="auto">request.*()</code> function calls. Therefore, scripts can retrive data from a maximum of 40 symbols.</p></div></aside>
<h2 class="md-heading" id="how-can-i-use-the-output-from-one-script-as-input-to-another"><a href="#how-can-i-use-the-output-from-one-script-as-input-to-another">How can I use the output from one script as input to another?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts with an input of type <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_input.source">input.source()</a> can take a plot from another script (up to a maximum of ten) as an input.
Select the script and plot to take as input in the script’s “Settings” tab. If the user removes the script from the chart and adds it again, they must select the correct inputs again.</p>
<p>The sources used as external inputs must originate from indicators; they cannot originate from strategies. However, plots originating from indicators <em>can</em> be used in strategies.</p>
<p>For further information, refer to <a href="https://www.tradingview.com/blog/en/more-external-inputs-for-scripts-38014/">this blog post</a> and the <a href="/pine-script-docs/v5/concepts/inputs/#source-input">Source input section</a> in the User Manual.</p>
<h2 class="md-heading" id="can-my-script-draw-on-the-main-chart-when-its-running-in-a-separate-pane"><a href="#can-my-script-draw-on-the-main-chart-when-its-running-in-a-separate-pane">Can my script draw on the main chart when it’s running in a separate pane?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts that have the <code dir="auto">overlay</code> parameter in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a> functions set to <code dir="auto">false</code> appear in a separate pane to the main chart.
Such scripts can affect the display of the main chart in only two ways:</p>
<ul>
<li>Changing bar colors, using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a> function.</li>
<li>Forcing plots to overlay, using <code dir="auto">force_overlay = true</code> in the plotting function. The <code dir="auto">force_overlay</code> parameter is available in most functions that draw on the chart.</li>
</ul>
<h2 class="md-heading" id="is-it-possible-to-export-indicator-data-to-a-file"><a href="#is-it-possible-to-export-indicator-data-to-a-file">Is it possible to export indicator data to a file?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The option “Export chart data…” in the dropdown menu at the top right corner of the chart exports a comma-separated values (CSV) file that includes time, OHLC data, and any plots generated by your script. This option can also export strategy data.</p>
<p>To include specific information in the CSV file, ensure that it is plotted by the script.
If this extra information is far from the symbol’s price and the existing indicator plots, and plotting it on the chart could distort the scale of the script, or if you prefer not to display
certain plots, consider using the <code dir="auto">display</code> parameter in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> function.</p>
<p>Here is an example plot that displays the close only in the Data Window. The plot title “No chart display” becomes the column header for this value in the CSV file.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">plot(close * 0.5, "No chart display", display = display.data_window)</code></div>
<p>Alternatively, the “Scale price chart only” in the chart settings maintains the script’s scale. To access these settings, right-click on the chart’s price scale.</p>
<p>To determine if a condition is true or false, use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a> function, which records a 1 (for true) or 0 (for false) in the CSV file.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/functions"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Functions  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/other-data-and-timeframes"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Other data and timeframes <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Other data and timeframes</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-other-data-and-timeframes"><a href="#other-data-and-timeframes">Other data and timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="what-kinds-of-data-can-i-get-from-a-higher-timeframe"><a href="#what-kinds-of-data-can-i-get-from-a-higher-timeframe">What kinds of data can I get from a higher timeframe?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Generally speaking, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function can get the same kinds of data from another timeframe that is available on the chart timeframe. Scripts can retrieve built-in variables like <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_bar_index">bar_index</a>.</p>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function can also evaluate built-in or user-defined functions in the requested <em>context</em> (timeframe and symbol). For example, the following example script retrieves the <a href="https://www.tradingview.com/support/solutions/43000501823-average-true-range-atr/">Average True Range</a> (ATR) value from the daily (<code dir="auto">1D</code>) timeframe by passing the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta.atr">ta.atr()</a> function as the <code dir="auto">expression</code> argument.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("HTF ATR")
float higherTfAtr = request.security(symbol = syminfo.tickerid, timeframe = "1D", expression = ta.atr(14))
plot(higherTfAtr)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>This script <a href="/pine-script-docs/v5/concepts/repainting/">repaints</a> elapsed realtime bars when the daily value is finalized. See the <a href="/pine-script-docs/v5/faq/other-data-and-timeframes/#how-to-avoid-repainting-when-using-the-requestsecurity-function">How to avoid repainting when using the `request.security()` function?</a> FAQ section to find out how to prevent repainting.</p></div></aside>
<h2 class="md-heading" id="which-security-function-should-i-use-for-lower-timeframes"><a href="#which-security-function-should-i-use-for-lower-timeframes">Which `security.*` function should I use for lower timeframes?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function is intended for accessing data at timeframes that are equal to or higher than the chart’s current timeframe.
It is <em>possible</em> to retrieve data from lower timeframes (LTF) using this function. However, the function returns the value from only <em>one</em> LTF bar within the chart’s current bar (the last bar, by default).</p>
<p>If the script supplies the <code dir="auto">expression</code> as a variable or simple calculation, directly or within a function, the data that <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> returns from a lower timeframe is generally of limited use (see the first script in <a href="/pine-script-docs/v5/faq/other-data-and-timeframes/#how-can-i-plot-a-moving-average-only-when-the-charts-timeframe-is-1d-or-higher">this section</a> for an example). It is possible, however, to construct a function that performs meaningful calculations on the LTF bars and then returns the result on the last bar. The following example script counts the number of LTF bars in a chart bar and returns this value on the last LTF bar. For simplicity, the timeframes are hardcoded to <code dir="auto">"1D"</code> and <code dir="auto">"1W"</code> and the script should therefore be run from a chart on the weekly timeframe.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Counting intrabars using `request.security()`")

// @function    Calculates the quantity of 1D bars in a week of trading.
// @returns     (int) The number of intrabars within the current weekly bar up to the current moment.
qtyIntrabars() =&gt;
    var int count = 0
    count := timeframe.change("W") ? 1 : count + 1

int qtyIntrabars = request.security(syminfo.tickerid, "1D", qtyIntrabars())

plot(qtyIntrabars, "qtyIntrabars", style=plot.style_histogram)</code></div>
<p>When using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function on a lower timeframe, all calculations that reference individual LTF bars must be done <em>within the requested context</em>, and only the <em>result</em> of the calculation is returned.
Using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> function for intrabar analysis is usually easier and more powerful, because it returns an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of data from <em>all</em> available intrabars within a chart bar. Returning the data for each bar allows scripts to perform calculations on specific bars or all bars in the main script context.</p>
<p>In the following version of our example script, we use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> to perform the same calculations. With this approach, we do not need to explicitly define the current chart’s timeframe, nor do we need a custom function.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Counting intrabars using `request.security_lower_tf()`")

// Count the number of elements in the array of close prices for each LTF bar in the current chart's bar.
int qtyIntrabars = array.size(request.security_lower_tf(syminfo.tickerid, "1D", close))

plot(qtyIntrabars, "qtyIntrabars", style=plot.style_histogram)</code></div>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>While easier to work with, this approach is more computationally expensive, because the script has to commit to memory an array of several values instead of a single value. If the logic of the script allows for it — as it does in our case, where both approaches return identical data — it’s often better to use the first approach in big scripts with a lot of intrabar computations, due to the performance benefits it brings.</p></div></aside>
<p>See the sections in the User Manual page “Other timeframes and Data” about
<a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lower-timeframes"><code dir="auto">request.security_lower_tf()</code></a> and
using <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity_lower_tf"><code dir="auto">request.security()</code> on lower timeframes</a>
to learn more about the differences between running these functions on a lower timeframe.</p>
<h2 class="md-heading" id="how-to-avoid-repainting-when-using-the-requestsecurity-function"><a href="#how-to-avoid-repainting-when-using-the-requestsecurity-function">How to avoid repainting when using the `request.security()` function?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p><a href="/pine-script-docs/v5/concepts/repainting/">Repainting</a> can be a problem when retrieving data from higher or lower timeframes using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.</p>
<p>Retrieving data from a different symbol on the chart’s timeframe does not risk repainting. Requesting data from the chart’s own symbol and timeframe does not result in repainting either, but it is usually unnecessary to use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> rather than simply referencing the chart’s own values (except when modifying the chart’s ticker using <code dir="auto">ticker.*()</code> functions). When using the chart’s timeframe, there is no need to offset the data, change the default <code dir="auto">lookahead</code> value, or use <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_on">barmerge.lookahead_on</a> in order to avoid repainting.</p>
<h3 class="md-heading" id="higher-timeframes"><a href="#higher-timeframes">Higher timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Values from a <em>higher timeframe</em> (HTF) often repaint because a <a href="/pine-script-docs/v5/language/execution-model/#calculation-based-on-historical-bars">historical bar</a> on the chart might include data from a <a href="/pine-script-docs/v5/language/execution-model/#calculation-based-on-realtime-bars">realtime bar</a> on the HTF. Realtime values can change throughout the bar; for example, the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> price reflects the <em>latest</em> price update in a realtime bar. When the HTF bar closes and its values become fixed, the relevant historical chart bars <em>change</em> to adjust to the fixed HTF values. This behavior is described in the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#historical-and-realtime-behavior">Historical and realtime behavior</a> section of the User Manual. Users expect historical bars not to change, which is one reason why repainting is such a concern.</p>
<p>To prevent repainting, use confirmed values that remain consistent across all bars. The most robust method is to offset all expressions by 1. For example, instead of <code dir="auto">close</code>, which is equivalent to <code dir="auto">close[0]</code>, use <code dir="auto">close[1]</code>. The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> call must also use <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_on">barmerge.lookahead_on</a>.
This method returns data that is up to one HTF bar “late”, and is thus not subject to change.</p>
<aside aria-label="Notice!" class="tv-informer not-content" style="--informer-header-color:#FF9800;--informer-back-color-light:#FFF3E0;--informer-back-color-dark:#33261A"><div class="tv-informer-icon"><svg height="18" viewbox="0 0 18 18" width="18"><path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z" fill="currentColor" fill-rule="evenodd"></path></svg></div><div class="tv-informer-content"><p><span class="tv-informer-header">Notice!</span>Failing to offset the <code dir="auto">expression</code> argument results in <em>lookahead bias</em>, where the script appears to have access to historical values before they would actually have occurred.
See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lookahead">lookahead</a> and <a href="/pine-script-docs/v5/concepts/repainting/#future-leak-with-requestsecurity">future leak</a> sections for more information.</p></div></aside>
<p>The following example script demonstrates the use of a single bar offset to the <code dir="auto">expression</code> argument and <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_on">barmerge.lookahead_on</a> in <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> to ensure that the data behaves the same on historical and realtime bars.
The script triggers a <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_runtime.error">runtime error</a> if the chart’s timeframe exceeds or matches the daily timeframe, to prevent the return of inaccurate values.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("HTF close" , overlay = true)
float dailyClose = request.security(syminfo.tickerid, "1D", close[1], lookahead = barmerge.lookahead_on)
plot(dailyClose)
if timeframe.in_seconds() &gt;= timeframe.in_seconds("1D")
    runtime.error("Chart timeframe must be less than 1D.")</code></div>
<p>See the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#avoiding-repainting">Avoiding repainting</a> section of the User Manual for more information.</p>
<h3 class="md-heading" id="lower-timeframes"><a href="#lower-timeframes">Lower timeframes<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Although the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function is intended to operate on timeframes greater than or equal to the chart timeframe, it <em>can</em> request data from a <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lower-timeframes">lower timeframe</a> (LTF), with limitations. When accessing data from a LTF, the function evaluates the given expression in the LTF context and returns the result from a <em>single</em> LTF bar per chart bar. The specific LTF bar returned depends on the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#lookahead">lookahead</a> parameter:</p>
<ul>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_on">barmerge.lookahead_on</a> returns the <em>first</em> intrabar of the period historically, but the <em>last</em> intrabar in realtime.</li>
<li><a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_off">barmerge.lookahead_off</a> always returns the last intrabar for both historical and realtime data.
To prevent <a href="/pine-script-docs/v5/concepts/repainting/">repainting</a> (in this case, inconsistent results between realtime and historical data) use <a href="https://www.tradingview.com/pine-script-reference/v5/#const_barmerge.lookahead_off">barmerge.lookahead_off</a> for lower timeframe data requests.</li>
</ul>
<p>In most cases, using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> function is more suitable for lower timeframes, as it returns an
<a href="/pine-script-docs/v5/language/arrays/">array</a> containing data from <em>all</em> available intrabars within a chart bar. See the section on <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity_lower_tf"><code dir="auto">request.security_lower_tf()</code></a> to learn more.</p>
<h2 class="md-heading" id="how-can-i-convert-the-charts-timeframe-into-a-numeric-format"><a href="#how-can-i-convert-the-charts-timeframe-into-a-numeric-format">How can I convert the chart’s timeframe into a numeric format?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a> function converts a timeframe specified in <a href="https://www.tradingview.com/pine-script-reference/v5/#var_timeframe.period">timeframe.period</a> format into an equivalent number of seconds. Having the timeframe in a numeric format means that scripts can calculate the number of time units within a specific timeframe, or perform operations that adjust the timeframe used in HTF calls in relation to the chart’s timeframe, as described in <a href="/pine-script-docs/v5/faq/other-data-and-timeframes/#how-do-i-define-a-higher-timeframe-that-is-a-multiple-of-the-chart-timeframe">this FAQ entry</a>.</p>
<p>In this script example, we use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a> function to determine the chart’s timeframe, measured in seconds. Since no specific
<code dir="auto">timeframe</code> argument is specified, the function defaults to using <code dir="auto">timeframe.period</code>, which returns the chart’s current timeframe. The script then converts the timeframe in seconds into various other units of time, including minutes, hours, and days, and displays the original string and converted numeric values in a <a href="/pine-script-docs/v5/concepts/tables/">table</a>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Timeframe to value")

tfInSec  = timeframe.in_seconds()
tfInMin  = tfInSec / 60
tfInHrs  = tfInMin / 60
tfInDays = tfInHrs / 24

if barstate.islastconfirmedhistory
    var table displayTable = table.new(position.top_right, 2, 5, na, color.gray, 1, color.gray, 1)
    table.cell(displayTable, 0, 0, "Original TF string",   text_color = chart.fg_color)
    table.cell(displayTable, 1, 0, "\"" + timeframe.period + "\"", text_color = chart.fg_color)
    table.cell(displayTable, 0, 1, "Timeframe in seconds", text_color = chart.fg_color)
    table.cell(displayTable, 1, 1, str.tostring(tfInSec),  text_color = chart.fg_color)
    table.cell(displayTable, 0, 2, "Timeframe in minutes", text_color = chart.fg_color)
    table.cell(displayTable, 1, 2, str.tostring(tfInMin),  text_color = chart.fg_color)
    table.cell(displayTable, 0, 3, "Timeframe in hours",   text_color = chart.fg_color)
    table.cell(displayTable, 1, 3, str.tostring(tfInHrs),  text_color = chart.fg_color)
    table.cell(displayTable, 0, 4, "Timeframe in days",    text_color = chart.fg_color)
    table.cell(displayTable, 1, 4, str.tostring(tfInDays), text_color = chart.fg_color)</code></div>
<h2 class="md-heading" id="how-can-i-convert-a-timeframe-in-float-minutes-into-a-string-usable-with-requestsecurity"><a href="#how-can-i-convert-a-timeframe-in-float-minutes-into-a-string-usable-with-requestsecurity">How can I convert a timeframe in “float” minutes into a string usable with `request.security()`?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The built-in function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a> function converts a number of seconds into a timeframe string that is compatible with <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>.</p>
<p>The example script below converts a user-defined number of minutes into a timeframe string using the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a> function.
The script then requests the close price from that timeframe using <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> and plots it.
Additionally, we display the resulting timeframe string in a <a href="/pine-script-docs/v5/concepts/tables/">table</a> on the chart’s top right corner:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Target TF in string from float minutes", "", true)
float tfInMinInput = input.float(1440, "Minutes in target timeframe (&lt;= 0.0167 [1 sec.])", minval = 0.0167)
// Convert target TF in minutes from input into string.
string targetTfString = timeframe.from_seconds(int(tfInMinInput * 60))
// Fetch target timeframe's close.
float targetTfClose = request.security(syminfo.tickerid, targetTfString, close)
// Plot target timeframe close.
plot(targetTfClose, "Target TF close")
// Display the target timeframe string in a table cell at the chart's top right.
if barstate.islastconfirmedhistory
    var table displayTable = table.new(position.top_right, 1, 1, color.new(color.yellow, 70), color.gray, 1, color.gray, 1)
    table.cell(displayTable, 0, 0, str.format("Target TF (string): {0}", targetTfString), text_color = chart.fg_color)</code></div>
<h2 class="md-heading" id="how-do-i-define-a-higher-timeframe-that-is-a-multiple-of-the-chart-timeframe"><a href="#how-do-i-define-a-higher-timeframe-that-is-a-multiple-of-the-chart-timeframe">How do I define a higher timeframe that is a multiple of the chart timeframe?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This example script uses the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.from_seconds">timeframe.from_seconds()</a> functions to calculate a higher timeframe that is a fixed multiple of the chart’s current timeframe. Using the input for the multiplier, the user can define the ratio between the chart’s
timeframe and the higher timeframe. The script then calculates the <a href="https://www.tradingview.com/support/solutions/43000502338-relative-strength-index-rsi/">Relative Strength Index</a> (RSI) for both the chart’s timeframe and the  higher timeframe, plotting both in a separate pane for comparison. We display the calculated higher timeframe string in a <a href="/pine-script-docs/v5/concepts/tables/">table</a> on the main chart pane by using <code dir="auto">force_overlay</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Multiple of current TF", overlay = false)

// Provide an input to specify the multiple to apply to the chart's timeframe.
float tfMult = input.float(4, minval = 1)

// Get multiple of current timeframe.
string targetTfString = timeframe.from_seconds(int(timeframe.in_seconds() * tfMult))
// Create RSI from the current timeframe.
float myRsi = ta.rsi(close, 14)
plot(myRsi, "Current TF RSI", color = color.silver)
// Non-repainting HTF RSI.
float myRsiHtf = request.security(syminfo.tickerid, targetTfString, myRsi[1], lookahead = barmerge.lookahead_on)
plot(myRsiHtf, "Non-repainting HTF RSI", color = color.green)

// Display the calculated timeframe at the top right of the main chart pane. 
if barstate.islastconfirmedhistory
    var table displayTable = table.new(position.top_right, 1, 1, color.new(color.yellow, 70), color.gray, 1, color.gray, 1, force_overlay = true)
    table.cell(displayTable, 0, 0, str.format("Target TF (string): {0}", targetTfString), text_color = chart.fg_color)</code></div>
<h2 class="md-heading" id="how-can-i-plot-a-moving-average-only-when-the-charts-timeframe-is-1d-or-higher"><a href="#how-can-i-plot-a-moving-average-only-when-the-charts-timeframe-is-1d-or-higher">How can I plot a moving average only when the chart’s timeframe is 1D or higher?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To plot a moving average on a chart only if it has a timeframe of daily (“1D”) or higher, scripts can use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_timeframe.in_seconds">timeframe.in_seconds()</a> function to convert the chart’s current timeframe into seconds. Since a day consists of 86400 seconds, any timeframe equal to or exceeding this value corresponds to a daily or longer duration.</p>
<p>The example script below calculates and plots a <a href="https://www.tradingview.com/support/solutions/43000696841-simple-moving-average/">Simple Moving Average</a> (SMA) of the closing prices over the last 200 bars.
The script uses a <a href="/pine-script-docs/v5/language/operators/#-ternary-operator">ternary operator</a> to return the moving average on timeframes of 1D or greater, or <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if the timeframe is shorter than one day. Because <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> calls cannot be in a local scope, scripts cannot conditionally call this function. Passing an <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value as the <code dir="auto">series</code> argument is an effective way to not plot anything. Note that plotting an <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> value <em>does</em> count towards the script’s <a href="/pine-script-docs/v5/writing/limitations/#plot-limits">plot limit</a>.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Timeframe-dependent MA", overlay = true)
bool tfIsDailyOrGreater = timeframe.in_seconds() &gt;= 86400
float ma = ta.sma(close, 200)
plot(tfIsDailyOrGreater ? ma : na, "MA", color.aqua)</code></div>
<h2 class="md-heading" id="what-happens-if-i-plot-a-moving-average-from-the-1h-timeframe-on-a-different-timeframe"><a href="#what-happens-if-i-plot-a-moving-average-from-the-1h-timeframe-on-a-different-timeframe">What happens if I plot a moving average from the 1H timeframe on a different timeframe?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function can access data from a different <em>context</em>, such as a different symbol or timeframe. There are different considerations when accessing data from a timeframe <em>higher</em> or <em>lower</em> than the chart timeframe.</p>
<p>First, let’s consider an example of plotting data from a <em>lower</em> timeframe. The following script plots a 21-period <a href="https://www.tradingview.com/support/solutions/43000592270-exponential-moving-average/">Exponential Moving Average</a> (EMA) derived from the 1-hour (1H) timeframe on any chart, irrespective of the timeframe of that chart:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("1hr EMA", overlay = true)
plot(request.security(syminfo.tickerid, "60", ta.ema(close, 21)), color = color.orange)</code></div>
<p>Assuming that we run this script on a chart with a daily timeframe, we encounter the following problems:</p>
<ul>
<li>For each daily bar, the chart can plot only 1 of the 24 MA values theoretically available. The plot misses out the intraday fluctuations and trends that a 1H moving average (MA) is typically used to identify.</li>
<li>The script above displays only the EMA value calculated for the <em>final</em> 1-hour bar of each day. In realtime, the plot displays the most recently known value.</li>
</ul>
<p>Unlike <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a>, the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a> function is intended for use on lower timeframes. It returns an <a href="/pine-script-docs/v5/language/arrays/">array</a> containing data from all available intrabars within a chart bar. See <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#requestsecurity_lower_tf">this section</a> of the User Manual to learn more.</p>
<p>We could rewrite the script to use <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf">request.security_lower_tf()</a>, but plotting a moving average from a lower timeframe is still not very practical.</p>
<p>A more logical approach is to plot MAs from a <em>higher</em> timeframe. This strategy shows broader market trends within the context of shorter-term price movements. For example, plotting a daily MA on a 1H chart provides insights into how intraday prices are trending relative to the longer-term daily average.</p>
<p>In the following example script, we plot the 21 EMA calculated at the 1H timeframe, but only when the chart’s timeframe is <em>equal to or lower than</em> 1H. We call the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> function <a href="/pine-script-docs/v5/faq/other-data-and-timeframes/#higher-timeframes">in the recommended way</a> to avoid repainting.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("HTF EMA", overlay = true)

// Input to specify the timeframe for `request.security() call.
string tfinput      = input.timeframe("60", "Timeframe for MA")

// @function            A wrapper for the `request.security()` function for non-repainting calls to HTFs.
// @param timeframe     Timeframe of the requested data. 
//                      To use the chart's timeframe, use an empty string or the `timeframe.period` variable.
// @param expression    An expression to calculate and returne from the request.security() call's context.
// @returns             The result of the calculated expression.
htfSecurity(string timeframe, expression) =&gt;
    result = request.security(syminfo.tickerid, timeframe, expression[1], lookahead = barmerge.lookahead_on)

// Calculate the moving average in the chart context.
float ma = ta.ema(close, 21)
// Calculate the moving average in the specified `tfInput` timeframe.
float htfMA = htfSecurity(tfinput, ma)

// Check whether the requested timeframe is greater or less than the chart's timeframe.
bool tfIsGreater = timeframe.in_seconds() &lt; timeframe.in_seconds(tfinput)
bool tfIsLess    = timeframe.in_seconds() &gt; timeframe.in_seconds(tfinput)

// Plot the HTF MA, the chart MA, or nothing, depending on the timeframe.
float maPlot = tfIsGreater ? htfMA : tfIsLess ? na : ma
plot(maPlot, "Requested MA", color.orange)

// Display a message in a table indicating that the requested timeframe is lower than the chart's timeframe, if applicable.
if barstate.islastconfirmedhistory and tfIsLess
    var table displayTable = table.new(position.bottom_right, 1, 1, color.new(color.yellow, 70))
    table.cell(displayTable, 0, 0, "Requested TF is lower than chart's TF\nNo MA displayed", text_color = color.red)</code></div>
<h2 class="md-heading" id="why-do-intraday-price-and-volume-values-differ-from-values-retrieved-with-requestsecurity-at-daily-timeframes-and-higher"><a href="#why-do-intraday-price-and-volume-values-differ-from-values-retrieved-with-requestsecurity-at-daily-timeframes-and-higher">Why do intraday price and volume values differ from values retrieved with `request.security()` at daily timeframes and higher?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Intraday <a href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>, and <a href="https://www.tradingview.com/pine-script-reference/v5/#var_volume">volume</a> (OHLCV) values can be different from those from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request.security()</a> at daily timeframes and higher for a number of reasons, including the following:</p>
<ul>
<li><strong>Different data feeds:</strong> Certain trades (like block trades and OTC trades, especially in stocks) are recorded only at the end of the trading day, so their volume affects the End-of-Day (EOD) feed but not the intraday feed.</li>
<li><strong>Price discrepancies:</strong> There can be slight differences in prices between EOD and intraday data. For example, an EOD high might not match any intraday highs due to variations in data feeds.</li>
<li><strong>Extended hours data:</strong> EOD data feeds do not include information from trading outside regular hours, unlike some intraday feeds. For instance, the bars of an hourly chart might straddle the open of a session, mixing data from pre-market and regular trading.</li>
</ul>
<p>For an extended list of factors with detailed explanations, refer to the <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/#data-feeds">Data feeds</a> section in the User Manual.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/indicators"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Indicators  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/programming"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Programming <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main><main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/faq">FAQ</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Programming</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="faq-programming"><a href="#programming">Programming<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="what-does-scope-mean"><a href="#what-does-scope-mean">What does “scope” mean?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The <em>scope</em> of a variable is the part of a script that defines the variable and in which it can be referenced. There are two main types of scope: <em>global</em> and <em>local</em>.</p>
<p class="spacer-wrapper"><spacer/> <strong>Global Scope:</strong> The global scope is all of the script that is not inside a <a href="https://www.tradingview.com/pine-script-docs/language/user-defined-functions/">function</a>, <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if statement</a>, or other <a href="/pine-script-docs/v5/language/conditional-structures/">conditional structure</a>. Code from anywhere in the script can access global variables. There is only one global scope.</p>
<p class="spacer-wrapper"><spacer/> <strong>Local Scope:</strong> Code that is inside a function or in any local block (one that is inset by four spaces) defines a local scope. Only code that is in the same local scope can access a local variable. There can be many local scopes.</p>
<p>The following example script gives an “Undeclared identifier” error when we try to access a local variable from the global scope.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scope demo")

// Global scope
int globalValue = close &gt; open ? 1 : -1

if barstate.isconfirmed
    // Local scope
    int localValue = close &gt; open ? 1 : -1

plot(localValue, "Local variable", chart.fg_color, 2)</code></div>
<p>To fix this error, we can declare the variable in the global scope, thus making it accessible from any scope in the script, and then conditionally modify it within a local block:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scope demo")

// Global scope
int globalValue = close &gt; open ? 1 : -1
int localValue  = na

if barstate.isconfirmed
    // Local scope
    localValue := close &gt; open ? 1 : -1

plot(localValue, "Local variable", chart.fg_color, 2)</code></div>
<p>Similarly, the following script gives an “Undeclared identifier” error when we try to access a variable defined in one local scope from another local scope. In this case, local scope 1 <em>contains</em> local scope 2, but the same problem would be present if they were on the same level. When a scope contains another one, the inner scope can access variables declared in the outer one, but not vice versa.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Scope demo")

bool isUpCandleWithLargerUpWick = false

if barstate.isconfirmed
    // Local scope 1
    bool upWickIsLarger = (high - math.max(open, close)) &gt; (math.min(open,close) - low)
    if close &gt; open
        // Local scope 2
        bool isUpCandle = true
    isUpCandleWithLargerUpWick := upWickIsLarger and isUpCandle ? true : false

plot(isUpCandleWithLargerUpWick, "Global variable depending on two local variables", chart.fg_color, 2)</code></div>
<p>For more information about scopes, see the <a href="https://www.tradingview.com/pine-script-docs/language/script-structure/#code">Code</a> section of the User Manual.</p>
<h2 class="md-heading" id="how-can-i-convert-a-script-to-a-newer-version-of-pine-script"><a href="#how-can-i-convert-a-script-to-a-newer-version-of-pine-script">How can I convert a script to a newer version of Pine Script™?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>See the <a href="/pine-script-docs/v5/migration-guides/">Migration Guides</a> section of the User Manual for instructions about upgrading the version of Pine that a script uses.</p>
<h2 class="md-heading" id="can-i-access-the-source-code-of-invite-only-or-closed-source-scripts"><a href="#can-i-access-the-source-code-of-invite-only-or-closed-source-scripts">Can I access the source code of “Invite-Only” or “closed-source” scripts?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>No; only <em>open</em> scripts have their source code visible. The source code of <em>protected</em> and <em>Invite-Only</em> scripts is hidden and can only be seen by the script author.</p>
<p>For a definition of the <em>access types</em> of published scripts: open, protected, and Invite-Only, see <a href="https://www.tradingview.com/support/solutions/43000482573-what-are-the-different-types-of-published-scripts/">this article</a> in the Help Center.</p>
<p>For an explanation on the <em>visibility</em> (public/private) that a script can have, see the <a href="/pine-script-docs/v5/writing/publishing/#visibility">Visibility</a> section of the Publishing scripts page in the User Manual.</p>
<h2 class="md-heading" id="is-pine-script-an-object-oriented-language"><a href="#is-pine-script-an-object-oriented-language">Is Pine Script™ an object-oriented language?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Although Pine Script™ is not strictly an object-oriented programming language, it incorporates some object-oriented features, notably <a href="/pine-script-docs/language/type-system/#user-defined-types">user-defined types</a> (UDTs).
Scripts can create <a href="/pine-script-docs/language/objects/">objects</a> as instances of a UDT. These objects have one or more fields, which can store values of various data types.</p>
<p>Here is a simple example of how to use the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_type">type</a> keyword to create an object:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Object demo")

// Define a new type named `pivot`.
type pivot
    int   x
    float y
    bool  isHigh

// Create a new `pivot` with specific values.
pivot newPivot = pivot.new(bar_index, close, true)

// Plot the `y` component of `newPivot`.
plot(newPivot.y)</code></div>
<p>In this example, we create an object <code dir="auto">newPivot</code>, which is an instance of the user-defined type <code dir="auto">pivot</code>. The script then plots the <code dir="auto">y</code> field of <code dir="auto">newPivot</code>.</p>
<h2 class="md-heading" id="how-can-i-access-the-source-code-of-built-in-indicators"><a href="#how-can-i-access-the-source-code-of-built-in-indicators">How can I access the source code of built-in indicators?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>There are two ways to access the source code of built-in indicators that are written in Pine:</p>
<p><strong>Create a new indicator</strong></p>
<p class="spacer-wrapper"><spacer/>In the Pine Script™ Editor, click the “<em>Open</em>” menu and choose the “<em>Built-in script</em>” option. Select the built-in indicator that you want to work with.</p>
<p><strong>Edit the code</strong></p>
<p class="spacer-wrapper"><spacer/> With the indicator displayed on the chart, click on the curly braces <code dir="auto">{}</code> next to the indicator name to open it in the Pine Editor.
To edit the code, click the option to create a working copy.</p>
<p>Some built-in indicators, such as the Volume Profile or chart pattern indicators, are not written in Pine and so the code for these indicators is not accessible.
These indicators are not included in the “<em>Built-in script</em>” menu, and curly braces are not displayed next to their names on the chart.</p>
<h2 class="md-heading" id="how-can-i-examine-the-value-of-a-string-in-my-script"><a href="#how-can-i-examine-the-value-of-a-string-in-my-script">How can I examine the value of a string in my script?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Scripts can print strings to Pine Logs on any or every bar, along with messages about the logic of the script at that point.
See the <a href="/pine-script-docs/v5/writing/debugging/#pine-logs">Pine Logs</a> section of the User Manual for information about logging.</p>
<p>Scripts can also display string in labels or label tooltips. The following example scripts displays a string in a label on the last bar of the chart using a custom function.</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("print()", "", true)

print(string txt) =&gt;
    // Create a persistent label
    var label myLabel = label.new(bar_index, na, txt, xloc.bar_index, yloc.price, color(na), label.style_label_left, chart.fg_color, size.large, text.align_left)
    // Update the label's x and y position, and the text it displays.
    label.set_xy(myLabel, bar_index, open)
    label.set_text(myLabel, txt)

if barstate.islast
    print("Timeframe = " + timeframe.period)</code></div>
<p>For more techniques, see the <a href="/pine-script-docs/writing/debugging/#strings">debugging strings</a> section of the User Manual.</p>
<h2 class="md-heading" id="how-can-i-visualize-my-scripts-conditions"><a href="#how-can-i-visualize-my-scripts-conditions">How can I visualize my script’s conditions?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>If a script contains complex logical conditions, it can be difficult to debug the output. Visualizing each condition separately can help to debug any problems.
See the <a href="/pine-script-docs/v5/writing/debugging/#compound-and-nested-conditions">Compound and nested conditions</a> section of the User Manual for an example.</p>
<h2 class="md-heading" id="how-can-i-make-the-console-appear-in-the-editor"><a href="#how-can-i-make-the-console-appear-in-the-editor">How can I make the console appear in the editor?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>To display the console in the editor, either press the keyboard shortcut Ctrl + ` (grave accent), or right-click within the editor and choose the “Toggle Console” option.</p>
<h2 class="md-heading" id="how-can-i-plot-numeric-values-so-that-they-dont-affect-the-indicators-scale"><a href="#how-can-i-plot-numeric-values-so-that-they-dont-affect-the-indicators-scale">How can I plot numeric values so that they don’t affect the indicator’s scale?<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Plotting numerical values on the main chart pane can distort the price scale if the values differ too much from the price.</p>
<p>One way around this is not to plot the values on the chart, but use the Data Window to inspect them. Add <code dir="auto">display = display.data_window</code> to the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a> call, and the values are visible in the Data Window for any single historical or realtime bar that the cursor hovers over.</p>
<p>Another option is to set the script to display in a separate pane by using <code dir="auto">overlay = false</code> in the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> declaration. The user needs to delete and re-add the script to the chart if this parameter is changed. Plot the numeric values to track in the separate pane, and draw the rest of the script visuals on the main chart pane by using the <code dir="auto">force_overlay</code> parameter.</p>
<p>Additionally, right-clicking on the scale on the chart brings out the dropdown menu. The “Scale Price Chart Only” option there makes it so the Auto mode of the chart scale only takes the chart itself into account, without adjusting for plots or other graphics of all indicators that overlay that chart.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq/other-data-and-timeframes"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> Other data and timeframes  </h4> </a> <span data-astro-cid-xgirumru=""></span> </div> </main><h1>Error Messages</h1>
<main class="content" data-astro-cid-ju3wuhkz="" data-toc-shown=""> <div class="content-width" data-astro-cid-xgirumru=""> <div class="breadcrumbs" data-astro-cid-wlavna2o="" data-pagefind-ignore=""> <a aria-label="Return back to the documentation home page." data-astro-cid-wlavna2o="" href="/pine-script-docs"> <span data-astro-cid-wlavna2o="">User Manual</span> </a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <a data-astro-cid-wlavna2o="" href="/pine-script-docs/v5/welcome">v5</a> <span class="divider" data-astro-cid-wlavna2o="">/</span> <span class="current-item" data-astro-cid-wlavna2o="">Error messages</span> </div> </div> <div data-astro-cid-xgirumru="" id="slot-container"> <h1 class="md-heading" id="error-messages-error-messages"><a href="#error-messages">Error messages<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h1>
<h2 class="md-heading" id="the-if-statement-is-too-long"><a href="#the-if-statement-is-too-long">The if statement is too long<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This error occurs when the indented code inside an <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if
statement</a>
is too large for the compiler. Because of how the compiler works, you
won’t receive a message telling you exactly how many lines of code you
are over the limit. The only solution now is to break up your <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if
statement</a>
into smaller parts (functions or smaller <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if
statements</a>).
The example below shows a reasonably lengthy <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if
statement</a>;
theoretically, this would throw <code dir="auto">line 4: if statement is too long</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My script")

var e = 0
if barstate.islast
    a = 1
    b = 2
    c = 3
    d = 4
    e := a + b + c + d

plot(e)</code></div>
<p>To fix this code, you could move these lines into their own function:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My script")

var e = 0
doSomeWork() =&gt;
    a = 1
    b = 2
    c = 3
    d = 4

    result = a + b + c + d

if barstate.islast
    e := doSomeWork()

plot(e)</code></div>
<h2 class="md-heading" id="script-requesting-too-many-securities"><a href="#script-requesting-too-many-securities">Script requesting too many securities<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The maximum number of securities in script is limited to 40. If you
declare a variable as a <code dir="auto">request.security</code> function call and then use
that variable as input for other variables and calculations, it will not
result in multiple <code dir="auto">request.security</code> calls. But if you will declare a
function that calls <code dir="auto">request.security</code> --- every call to this function
will count as a <code dir="auto">request.security</code> call.</p>
<p>It is not easy to say how many securities will be called looking at the
source code. Following example have exactly 3 calls to
<code dir="auto">request.security</code> after compilation:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Securities count")
a = request.security(syminfo.tickerid, '42', close)  // (1) first unique security call
b = request.security(syminfo.tickerid, '42', close)  // same call as above, will not produce new security call after optimizations

plot(a)
plot(a + 2)
plot(b)

sym(p) =&gt;  // no security call on this line
    request.security(syminfo.tickerid, p, close)
plot(sym('D'))  // (2) one indirect call to security
plot(sym('W'))  // (3) another indirect call to security

request.security(syminfo.tickerid, timeframe.period, open)  // result of this line is never used, and will be optimized out</code></div>
<h2 class="md-heading" id="script-could-not-be-translated-from-null"><a href="#script-could-not-be-translated-from-null">Script could not be translated from: null<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">study($)</code></div>
<p>Usually this error occurs in version 1 Pine scripts, and means that code
is incorrect. Pine Script™ of version 2 (and higher) is better at
explaining errors of this kind. So you can try to switch to version 2 by
adding a
<a href="/pine-script-docs/v5/language/script-structure/#version">special attribute</a> in the first line. You’ll get
<code dir="auto">line 2: no viable alternative at character '$'</code>:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @version=2
study($)</code></div>
<h2 class="md-heading" id="line-2-no-viable-alternative-at-character-"><a href="#line-2-no-viable-alternative-at-character-">line 2: no viable alternative at character ’$’<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This error message gives a hint on what is wrong. <code dir="auto">$</code> stands in place of
string with script title. For example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">// @version=2
study("title")</code></div>
<h2 class="md-heading" id="mismatched-input--expecting-"><a href="#mismatched-input--expecting-">Mismatched input &lt;…&gt; expecting &lt;???&gt;<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>Same as <code dir="auto">no viable alternative</code>, but it is known what should be at that
place. Example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
    plot(1)</code></div>
<p><code dir="auto">line 3: mismatched input 'plot' expecting 'end of line without line continuation'</code></p>
<p>To fix this you should start line with <code dir="auto">plot</code> on a new line without an
indent:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
plot(1)</code></div>
<h2 class="md-heading" id="loop-is-too-long--500-ms"><a href="#loop-is-too-long--500-ms">Loop is too long (&gt; 500 ms)<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>We limit the computation time of loop on every historical bar and
realtime tick to protect our servers from infinite or very long loops.
This limit also fail-fast indicators that will take too long to compute.
For example, if you’ll have 5000 bars, and indicator takes 500
milliseconds to compute on each of bars, it would have result in more
than 16 minutes of loading:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop is too long", max_bars_back = 101)
s = 0
for i = 1 to 1e3  // to make it longer
    for j = 0 to 100
        if timestamp(2017, 02, 23, 00, 00) &lt;= time[j] and time[j] &lt; timestamp(2017, 02, 23, 23, 59)
            s := s + 1
plot(s)</code></div>
<p>It might be possible to optimize algorithm to overcome this error. In
this case, algorithm may be optimized like this:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Loop is too long", max_bars_back = 101)
bar_back_at(t) =&gt;
    i = 0
    step = 51
    for j = 1 to 100
        if i &lt; 0
            i := 0
            break
        if step == 0
            break
        if time[i] &gt;= t
            i := i + step
            i
        else
            i := i - step
            i
        step := step / 2
        step
    i

s = 0
for i = 1 to 1e3  // to make it longer
    s := s - bar_back_at(timestamp(2017, 02, 23, 23, 59)) +
         bar_back_at(timestamp(2017, 02, 23, 00, 00))
    s
plot(s)</code></div>
<h2 class="md-heading" id="script-has-too-many-local-variables"><a href="#script-has-too-many-local-variables">Script has too many local variables<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>This error appears if the script is too large to be compiled. A
statement <code dir="auto">var=expression</code> creates a local variable for <code dir="auto">var</code>. Apart
from this, it is important to note, that auxiliary variables can be
implicitly created during the process of a script compilation. The limit
applies to variables created both explicitly and implicitly. The
limitation of 1000 variables is applied to each function individually.
In fact, the code placed in a <em>global</em> scope of a script also implicitly
wrapped up into the main function and the limit of 1000 variables
becomes applicable to it. There are few refactorings you can try to
avoid this issue:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">var1 = expr1
var2 = expr2
var3 = var1 + var2</code></div>
<p>can be converted into:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">var3 = expr1 + expr2</code></div>
<h2 class="md-heading" id="pine-script-cannot-determine-the-referencing-length-of-a-series-try-using-max_bars_back-in-the-indicator-or-strategy-function"><a href="#pine-script-cannot-determine-the-referencing-length-of-a-series-try-using-max_bars_back-in-the-indicator-or-strategy-function">Pine Script™ cannot determine the referencing length of a series. Try using max_bars_back in the indicator or strategy function<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The error appears in cases where Pine Script™ wrongly autodetects the
required maximum length of series used in a script. This happens when a
script’s flow of execution does not allow Pine Script™ to inspect the
use of series in branches of conditional statements (<code dir="auto">if</code>, <code dir="auto">iff</code> or
<code dir="auto">?</code>), and Pine Script™ cannot automatically detect how far back the
series is referenced. Here is an example of a script causing this
problem:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requires max_bars_back")
test = 0.0
if bar_index &gt; 1000
    test := ta.roc(close, 20)
plot(test)</code></div>
<p>In order to help Pine Script™ with detection, you should add the
<code dir="auto">max_bars_back</code> parameter to the script’s <code dir="auto">indicator</code> or <code dir="auto">strategy</code>
function:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Requires max_bars_back", max_bars_back = 20)
test = 0.0
if bar_index &gt; 1000
    test := ta.roc(close, 20)
plot(test)</code></div>
<p>You may also resolve the issue by taking the problematic expression out
of the conditional branch, in which case the <code dir="auto">max_bars_back</code> parameter
is not required:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
test = 0.0
roc20 = ta.roc(close, 20)
if bar_index &gt; 1000
    test := roc20
plot(test)</code></div>
<p>In cases where the problem is caused by a <strong>variable</strong> rather than a
built-in <strong>function</strong> (<code dir="auto">vwma</code> in our example), you may use the
<code dir="auto">max_bars_back</code> function to explicitly define the referencing length for
that variable only. This has the advantage of requiring less runtime
resources, but entails that you identify the problematic variable, e.g.,
variable <code dir="auto">s</code> in the following example:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
f(off) =&gt;
    t = 0.0
    s = close
    if bar_index &gt; 242
        t := s[off]
    t
plot(f(301))</code></div>
<p>This situation can be resolved using the <code dir="auto">max_bars_back</code> <strong>function</strong> to
define the referencing length of variable <code dir="auto">s</code> only, rather than for all
the script’s variables:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("My Script")
f(off) =&gt;
    t = 0.0
    s = close
    max_bars_back(s, 301)
    if bar_index &gt; 242
        t := s[off]
    t
plot(f(301))</code></div>
<p>When using drawings that refer to previous bars through <code dir="auto">bar_index[n]</code>
and <code dir="auto">xloc = xloc.bar_index</code>, the time series received from this bar will
be used to position the drawings on the time axis. Therefore, if it is
impossible to determine the correct size of the buffer, this error may
occur. To avoid this, you need to use <code dir="auto">max_bars_back(time, n)</code>. This
behavior is described in more detail in the section about
<a href="/pine-script-docs/v5/concepts/lines-and-boxes/#historical-buffer-and-max_bars_back">drawings</a>.</p>
<h2 class="md-heading" id="memory-limits-exceeded-the-study-allocates-x-times-more-than-allowed"><a href="#memory-limits-exceeded-the-study-allocates-x-times-more-than-allowed">Memory limits exceeded. The study allocates X times more than allowed<span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h2>
<p>The most common cause for this error is returning <a href="/pine-script-docs/v5/language/objects/#objects">objects</a> and <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> from <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">request.*()</a> functions. Other possible causes include unnecessary drawing updates, excess historical buffer capacity, or inefficient use of <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back</a>.</p>
<h3 class="md-heading" id="returning-collections-from-request-functions"><a href="#returning-collections-from-request-functions"><span><strong>Returning collections from <code dir="auto">request.*()</code> functions</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>A common source of the “<em>Memory limits exceeded</em>” error is returning <a href="/pine-script-docs/v5/language/objects/#objects">objects</a> or <a href="/pine-script-docs/v5/language/type-system/#collections">collections</a> from another chart symbol or timeframe using <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">request.*()</a> functions.</p>
<p>When requesting data from other contexts, the data for <em>each bar</em> is copied and stored in memory to allow the script to reference it later in the main context. This can use a lot of memory, depending on the data. Requesting large collections can easily lead to excessive memory consumption.</p>
<p>Let’s look at an example script where we <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">request</a> data to calculate the <a href="https://www.tradingview.com/support/solutions/43000589100-balance-of-power-bop/">balance of power (BOP)</a> for the symbol at a higher timeframe. Here, the <em>request expression</em> is a <a href="/pine-script-docs/v5/language/user-defined-functions/">custom function</a> that populates a <a href="/pine-script-docs/v5/language/arrays/#using-var-and-varip-keywords">persistent array</a> with our calculated BOP values, returning the <em>full array</em> to the main context on <em>each</em> bar. We intend to use these stored array values to calculate and plot the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_array.avg">average</a> BOP in the main context. However, returning every array instance consumes a lot of memory, and so this script can throw a memory error on charts with a sufficiently long history:</p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("BOP array in higher timeframe context", "Memory limit demo")

//@variable User-input length for calculating average of BOP values. 
int avgLength = input.int(5, "Average BOP Length", minval = 1)

//Returns a copy of the `dataArray` on every bar, which uses a lot of memory.
dataFunction() =&gt; 
    //@variable Persistent array containing the "balance of power" (BOP) values for all bars from the higher timeframe.
    var array&lt;float&gt; dataArray = array.new_float(0)

    //@variable The "balance of power" percentage calculated for the current bar.
    float bop = (close - open) / (high - low) * 100
    dataArray.push(bop)

    //Return the full collection.
    dataArray

// Request the full BOP array from the 1D timeframe.
array&lt;float&gt; reqData = request.security(syminfo.tickerid, "1D", dataFunction())

// Plot zero line.
hline(0, "Zero line", color.gray, hline.style_dotted)

// Latest BOP value and average BOP are calculated in the main context if `reqData` is not `na`.
//@variable The latest BOP value from the `reqData` array.
float latestValue = na
//@variable The average of the last `avgLength` BOP values.
float avgBOP = na

if not na(reqData)
    // Retrieve BOP value for the current main context bar.
    latestValue := reqData.last()

    // Calculate the average BOP for the most-recent values from the higher timeframe array.
    //@variable Size of the `reqData` array returned from the higher timeframe.
    int dataSize = reqData.size()
    //@variable A subset of the latest values from the `reqData` array. Its size is determined by the `avgLength` set.
    array&lt;float&gt; lastValues = dataSize &gt;= avgLength ? reqData.slice(dataSize - avgLength, dataSize): reqData
    avgBOP := lastValues.avg()

// Plot the BOP value and average line.
color plotColor = latestValue &gt;= 0 ? color.aqua : color.orange
plot(latestValue, "BOP", plotColor, style = plot.style_columns)
plot(avgBOP, "Avg", color.purple, linewidth = 3)</code></div>
<h3 class="md-heading" id="how-do-i-fix-this"><a href="#how-do-i-fix-this"><span><strong>How do I fix this?</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>Optimize requests and limit the data returned to the main context to ensure that only the <em>minimum necessary</em> data is stored in memory.</p>
<p>If possible, try to return <em>calculated results</em> directly rather than returning the collections themselves, or only return collections <em>conditionally</em>, when they are necessary in the main context.</p>
<p>Let’s consider a few common scenarios where scripts need specific data in the main context.</p>
<h4 class="md-heading" id="return-last-state-only"><a href="#return-last-state-only"><span><strong>Return last state only</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>If a script needs only the <em>last state</em> of a requested collection in the main context: use an <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">barstate.islast</a> condition to return a copy of the <em>last bar’s collection</em> only.</p>
<p>Here, we modified our script to display only the <em>latest</em> average BOP (a single value), rather than plotting an average line. The updated request function now returns the calculated BOP values directly for each bar, and returns the higher timeframe’s array only on the last bar:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1196" loading="lazy" src="images/792e6e96d08a0fbded17ffd2630f6621.webp" width="1702"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("BOP array on last bar", "Memory limit demo")

//@variable User-input length for calculating average of BOP values. 
int avgLength = input.int(5, "Average BOP Length", minval = 1)

// Returns the calculated `bop` each bar, and a copy of the `dataArray` on the last bar or `na` otherwise.
dataFunction() =&gt; 
    //@variable Persistent array containing the "balance of power" (BOP) values for all higher timeframe bars.
    var array&lt;float&gt; dataArray = array.new_float(0)

    //@variable The "balance of power" percentage calculated for the current higher timeframe bar.
    float bop = (close - open) / (high - low) * 100
    dataArray.push(bop)

    // Return the collection on the last bar only.
    if barstate.islast
        [bop, dataArray]
    else 
        [bop, na]

// Request calculated BOP value, and BOPs array if on last bar, from the higher timeframe.
[reqValue, reqData] = request.security(syminfo.tickerid, "1D", dataFunction())

// Plot zero line.
hline(0, "Zero line", color.gray, hline.style_dotted)

// Plot the BOP value for each main context bar.
color plotColor = reqValue &gt;= 0 ? color.aqua : color.orange
plot(reqValue, "BOP", plotColor, style = plot.style_columns)

// Calculate the average BOP for most-recent values from the higher timeframe array, and display result in a table cell.
if not na(reqData)
    //@variable Size of the `reqData` array returned from the higher timeframe.
    int dataSize = reqData.size()
    //@variable A subset of the latest values from the `reqData` array. Its size is determined by the `avgLength` set.
    array&lt;float&gt; lastValues = dataSize &gt;= avgLength ? reqData.slice(dataSize - avgLength, dataSize): reqData
    //@variable The average of the last `avgLength` BOP values.
    float avgBOP = lastValues.avg()

    // Display latest average value in a single-cell table.
    var table displayTable = table.new(position.bottom_right, 1, 1, color.purple)
    displayTable.cell(0, 0, "Avg of last " + str.tostring(avgLength) + " BOPs: " + str.tostring(avgBOP, "##.##") + "%", 
         text_color = color.white)</code></div>
<h4 class="md-heading" id="return-calculated-results"><a href="#return-calculated-results"><span><strong>Return calculated results</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>If a script needs the <em>result</em> of a calculation on a collection, but does not need the collection itself in the main context, use a <a href="/pine-script-docs/v5/language/user-defined-functions/">user-defined function</a> as the request expression. The function can calculate on the collection in the <em>requested</em> context and return only the result to the main context.</p>
<p>For example, we can calculate the average BOP directly within our request function. Therefore, only the calculated values are stored in memory, and the request expression returns a tuple (current BOP and average BOP) to plot the results in the main context:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1192" loading="lazy" src="images/b08dab77b766ec498bf2c3b93a7fdaca.webp" width="1694"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Return BOP results only", "Memory limit demo")

//@variable User-input length for calculating average of BOP values. 
int avgLength = input.int(5, "Average BOP Length", minval = 1)

// Returns the calculated `bop` and `avgBOP` values directly.
dataFunction() =&gt; 
    //@variable Persistent array containing the "balance of power" (BOP) values for all higher timeframe bars.
    var array&lt;float&gt; dataArray = array.new_float(0)

    //@variable The "balance of power" percentage calculated for the current higher timeframe bar.
    float bop = (close - open) / (high - low) * 100
    dataArray.push(bop)

    // Calculate the average BOP for the `avgLength` most-recent values.
    //@variable Size of the `dataArray`.
    int dataSize = dataArray.size()
    //@variable A subset of the latest values from the `dataArray`. Its size is determined by the `avgLength` set.
    array&lt;float&gt; lastValues = dataSize &gt;= avgLength ? dataArray.slice(dataSize - avgLength, dataSize): dataArray
    //@variable The average of the last `avgLength` BOP values.
    float avgBOP = lastValues.avg()

    //Return the calculated results.
    [bop, avgBOP]

// Request BOP and average BOP values from the higher timeframe.
[reqValue, reqAverage] = request.security(syminfo.tickerid, "1D", dataFunction())

// Plot zero line.
hline(0, "Zero line", color.gray, hline.style_dotted)

// Plot the BOP value and average line.
color plotColor = reqValue &gt;= 0 ? color.aqua : color.orange
plot(reqValue, "BOP", plotColor, style = plot.style_columns)
plot(reqAverage, "Avg", color.purple, linewidth = 3)</code></div>
<h4 class="md-heading" id="return-the-collection-on-some-bars"><a href="#return-the-collection-on-some-bars"><span><strong>Return the collection on some bars</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>If a script needs the <em>collection itself</em> in the main context, but <em>not for</em> <em>every bar</em>, use <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">conditional expressions</a> to return only the necessary collections to the main context, returning <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> otherwise. The logic in the main context can then address the <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> gaps in the series and perform its desired actions on the reduced collections.</p>
<p>For example, if we want to calculate the average BOP across each <em>month</em> instead of using a user-input length, we can return the array from the requested context only when there is a change to a new month, returning <a href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> otherwise. We then maintain the previous month’s values in the main context to keep a valid array for all intra-month bars:</p>
<p><div class="image-container"><img alt="image" decoding="async" height="1192" loading="lazy" src="images/3af97a6ecc04880f663f580e8a6718f6.webp" width="1694"/></div></p>
<div class="pine-colorizer">
<div class="pine-colorizer__header">
<a class="pine-colorizer__title" href="#">
<span>Pine Script™ v5</span>
</a>
<button class="pine-colorizer__copy-btn">
<span>Copy</span>
<div class="pine-colorizer__tooltip">Copy</div>
</button>
</div>
<code class="monaco-editor-tv-pine-light">//@version=5
indicator("Monthly BOP array", "Memory limit demo")

// Returns the calculated `bop`, and a copy of the `dataArray` on a month's first trading day only, or `na` otherwise.
dataFunction() =&gt; 
    //@variable Persistent array containing the "balance of power" (BOP) values for all higher timeframe bars.
    var array&lt;float&gt; dataArray = array.new_float(0)

    // When a new month starts, return monthly data array to calculate average BOP for completed month.
    //@variable Array is `na` except on first trading day of each month, when it contains completed month's BOP values. 
    array&lt;float&gt; returnArray = na
    //@variable Is `true` on the first bar of each month, `false` otherwise.
    bool isNewMonth = timeframe.change("1M")
    if isNewMonth
        returnArray := dataArray
    //Clear persistent array to start storing new month's data.
    if isNewMonth[1]
        dataArray.clear()

    //@variable The "balance of power" percentage calculated for the current higher timeframe bar.
    float bop = (close - open) / (high - low) * 100
    dataArray.push(bop)

    //Return the calculated result and the `returnArray`.
    [bop, returnArray]

// Request BOP data from the higher timeframe. (Returns calculated BOP and array of BOP values if new month starts)
[reqValue, reqData] = request.security(syminfo.tickerid, "1D", dataFunction())

// Calculate the average BOP for the most-recent completed month.
//@variable Persistent array that holds the BOP values for the most-recent completed month.
var array&lt;float&gt; completedMonthBOPs = array.new_float(0)
// If new month starts (i.e., `reqData` is not returned as `na`), then `completedMonthBOPs` is updated with new values.
// Otherwise, it persists the last valid values for the rest of the month to adjust for `na` gaps.
completedMonthBOPs := na(reqData) ? completedMonthBOPs : reqData
//@variable The average BOP for the most-recent completed month.
float avgBOP = completedMonthBOPs.avg()

// Plot the BOP value and average line.
color plotColor = reqValue &gt;= 0 ? color.aqua : color.orange
plot(reqValue, "BOP", plotColor, style = plot.style_columns)
plot(avgBOP, "Avg", color.purple, linewidth = 3)</code></div>
<h3 class="md-heading" id="other-possible-error-sources-and-their-fixes"><a href="#other-possible-error-sources-and-their-fixes"><span><strong>Other possible error sources and their fixes</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h3>
<p>There are a few other ways to optimize scripts to consume less memory.</p>
<h4 class="md-heading" id="minimize-request-calls"><a href="#minimize-request-calls"><span><strong>Minimize <code dir="auto">request.*()</code> calls</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <a href="/pine-script-docs/v5/concepts/other-timeframes-and-data/">request.*()</a> function calls can be computationally expensive, because they retrieve data from other contexts, which can often require significant resource usage. Excessive or inefficient requests can easily cause scripts to reach the memory limit.</p>
<p>This memory consumption is especially substantial for scripts requesting data from <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security_lower_tf"><em>lower timeframes</em></a>, where the request function returns an <a href="https://www.tradingview.com/pine-script-reference/v5/#type_array">array</a> of multiple lower timeframe bars for <em>each</em> main context bar. For example, requesting “1” data on a “1D” chart returns hundreds of “1” bars for each “1D” bar that executes the request. In the process, the script must allocate memory to store all the requested data arrays so that it can access them later in the main context, which quickly increases the memory consumption.</p>
<p>Programmers can reduce the number of requested expressions by:</p>
<ul>
<li>Removing unnecessary <code dir="auto">request.*()</code> function calls.</li>
<li>Changing the requested timeframe to a higher resolution.</li>
<li>Condensing multiple requests to the <em>same</em> context into a single <code dir="auto">request.*()</code> call.</li>
<li>Adjusting the <code dir="auto">request.*()</code> function’s <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_request.security">calc_bars_count</a> parameter to restrict the historical data points in the requested context.</li>
</ul>
<p>See <a href="/pine-script-docs/v5/writing/profiling-and-optimization/#minimizing-request-calls">this section</a> in the User Manual for more information on optimizing <code dir="auto">request.*()</code> calls.</p>
<h4 class="md-heading" id="refrain-from-using-max_bars_back-unless-necessary"><a href="#refrain-from-using-max_bars_back-unless-necessary"><span><strong>Refrain from using <code dir="auto">max_bars_back</code> unless necessary</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The <code dir="auto">max_bars_back</code> parameter of an <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator</a> or <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy</a> sets the size of the <em>history buffer</em> for all series variables in a script. The history buffer determines the number of historical references <em>stored in memory</em> for the script’s built-in and user-defined variables.</p>
<p>By default, the Pine Script™ runtime automatically allocates an appropriate buffer for each variable. Therefore, the <code dir="auto">max_bars_back</code> parameter and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">function</a> are only necessary when Pine <a href="https://www.tradingview.com/support/solutions/43000587849-i-see-pine-cannot-determine-the-referencing-length-of-a-series-try-using-max-bars-back-error/">cannot determine the referencing length of a series</a>.</p>
<p>If you encounter this referencing length error, ensure that you set the <code dir="auto">max_bars_back</code> value appropriately to your script’s needs. Setting a value that’s too large can lead to excessive memory consumption, as it stores unnecessary historical data that the script ultimately doesn’t use. Read up on how to optimize using <code dir="auto">max_bars_back</code> <a href="https://www.tradingview.com/chart/?solution=43000587849">in our Help Center</a>.</p>
<h4 class="md-heading" id="minimize-historical-buffer-calculations"><a href="#minimize-historical-buffer-calculations"><span><strong>Minimize historical buffer calculations</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The Pine Script™ runtime automatically creates historical buffers for all variables and function calls in a script. It determines the size of a buffer based on the <em>historical references</em> needed in the code (the references made using the <a href="/pine-script-docs/v5/language/operators/#--history-referencing-operator">[]</a> history-referencing operator).</p>
<p>As the script runs across the dataset, referencing distant points in bar history can cause the script to restart its execution on previous bars to adjust its historical buffer size (see this <a href="/pine-script-docs/v5/writing/profiling-and-optimization/#minimizing-historical-buffer-calculations">User Manual article</a> to learn more). Larger buffers in turn lead to an increase in memory consumption and can result in a runtime error. Ensure that scripts are referencing <em>necessary</em> historical values only, and avoid referencing very distant points in history when possible.</p>
<p>You can use the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a> function’s <code dir="auto">calc_bars_count</code> parameter or the <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_max_bars_back">max_bars_back()</a> function to <em>manually restrict</em> the historical data capacity on a script-wide or variable-specific scale. However, be aware that these methods can also cause memory consumption issues of their own if used improperly.</p>
<h4 class="md-heading" id="reduce-drawing-updates-for-tables"><a href="#reduce-drawing-updates-for-tables"><span><strong>Reduce drawing updates for tables</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/concepts/tables/">Tables</a> only display their <em>last state</em> on a chart. Any updates to a table on historical bars are redundant, because they are not visible. To use the least memory, draw the table <em>once</em>, and fill it on the last bar.</p>
<p>Use the <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_var">var</a> keyword to declare table objects once. Enclose all other setter function calls in a conditional <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">if</a> <a href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate.islast">barstate.islast</a> block for better performance. For more about tables, see this <a href="/pine-script-docs/v5/concepts/tables/">User Manual article</a>.</p>
<h4 class="md-heading" id="do-not-update-drawings-on-historical-bars"><a href="#do-not-update-drawings-on-historical-bars"><span><strong>Do not update drawings on historical bars</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>Similar to tables, any updates to drawing objects such as <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> that are made on historical bars are never seen by the user. The user only sees updates on <em>realtime</em> bars.</p>
<p>Eliminate updates to historical drawings during historical bars wherever possible. For more information, see <a href="/pine-script-docs/v5/writing/profiling-and-optimization/#reducing-drawing-updates">this User Manual section</a>.</p>
<h4 class="md-heading" id="minimize-total-drawings-stored-for-a-chart"><a href="#minimize-total-drawings-stored-for-a-chart"><span><strong>Minimize total drawings stored for a chart</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p><a href="/pine-script-docs/v5/language/type-system/#drawing-types">Drawing objects</a> such as <a href="/pine-script-docs/v5/concepts/lines-and-boxes/#lines">lines</a> and <a href="/pine-script-docs/v5/concepts/text-and-shapes/#labels">labels</a> can consume a lot of memory, especially if a script <em>recreates</em> drawings unnecessarily.</p>
<p>For example, if a script draws a line from point <code dir="auto">x1</code> to <code dir="auto">x2</code>, then needs to update the line’s endpoint (<code dir="auto">x2</code>), it’s more computationally expensive to delete the existing line and redraw a new line from <code dir="auto">x1</code> to <code dir="auto">x3</code>. Instead, using the <em>setter</em> function <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.set_x2">line.set_x2()</a> to update the existing line’s endpoint is more efficient.</p>
<p>Look for ways to optimize drawing objects in a script:</p>
<ul>
<li>
<p>Reduce the number of redrawn objects by initializing drawing object <em>identifiers</em> and using their setter functions to modify properties.</p>
</li>
<li>
<p>Remove unnecessary chart drawings using the <code dir="auto">delete()</code> functions (e.g., <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_line.delete">line.delete()</a> and <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_label.delete">label.delete()</a>).</p>
</li>
<li>
<p>Reduce an indicator’s maximum drawings limit using the <code dir="auto">max_lines_count</code> or <code dir="auto">max_labels_count</code> <a href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">parameters</a>.</p>
</li>
</ul>
<h4 class="md-heading" id="filter-dates-in-strategies"><a href="#filter-dates-in-strategies"><span><strong>Filter dates in strategies</strong></span><span aria-hidden="true" class="icon icon-link"><svg height="28" viewbox="0 0 28 28" width="28"><g clip-path="url(#a)" fill="currentColor"><path d="M14.908 5.558a5.326 5.326 0 1 1 7.533 7.533l-3.236 3.236-1.061-1.061 3.236-3.236a3.826 3.826 0 1 0-5.411-5.411l-3.236 3.236-1.06-1.06 3.235-3.237ZM5.56 14.907a5.326 5.326 0 0 0 7.532 7.533l3.236-3.236-1.061-1.061-3.236 3.236a3.826 3.826 0 1 1-5.411-5.411l3.236-3.236-1.061-1.06-3.236 3.235Z"></path><path d="m16.346 10.592-5.753 5.753 1.061 1.06 5.753-5.752-1.06-1.06Z"></path></g><defs><clippath id="a"><path d="M0 0h28v28H0z" fill="#fff"></path></clippath></defs></svg></span></a></h4>
<p>The total number of trades or orders in a <a href="/pine-script-docs/v5/concepts/strategies/">strategy</a> can impact the memory consumption of a script. For large datasets, reduce the number of unnecessary historical orders stored in memory by limiting the <em>starting point</em> of your strategy.</p>
<p>You can filter the strategy’s date by adding a <a href="https://www.tradingview.com/pine-script-reference/v5/#kw_if">conditional expression</a> that compares the bar time to a specified timestamp to only place entry/exit orders beyond a certain date.</p>
<p>See an example of date filtering in strategies <a href="https://www.pinecoders.com/faq_and_code/#how-do-i-implement-date-range-filtering-in-strategies" rel="nofollow">here</a>.</p> </div> <div class="pagination-buttons not-content" data-astro-cid-xgirumru=""> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/faq"> <p data-astro-cid-assl6cvf="">Previous</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf=""> <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow-back" height="28" viewbox="0 0 28 28" width="28"> <use xlink:href="#ai:local:theme/arrow-back"></use> </svg> FAQ  </h4> </a> <a class="pagination-card" data-astro-cid-assl6cvf="" data-pagefind-ignore="" href="/pine-script-docs/v5/release-notes"> <p data-astro-cid-assl6cvf="">Next</p> <h4 class="pagination-card-header" data-astro-cid-assl6cvf="">  Release notes <svg data-astro-cid-assl6cvf="" data-icon="theme/arrow" height="28" viewbox="0 0 28 28" width="28"> <symbol id="ai:local:theme/arrow"><path d="m11 8 6 6-6 6" fill="none" stroke="var(--arrow-fill-color, #131722)"></path></symbol><use xlink:href="#ai:local:theme/arrow"></use> </svg> </h4> </a> </div> </main>
        </div>
        <button id="back-to-top" title="Back to top">↑</button>
        <!-- Add copy button functionality -->
        
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.pine-colorizer__copy-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const codeBlock = this.closest('.pine-colorizer').querySelector('code');
                    const text = codeBlock.textContent;
                    
                    navigator.clipboard.writeText(text).then(() => {
                        const tooltip = this.querySelector('.pine-colorizer__tooltip');
                        tooltip.textContent = 'Copied!';
                        setTimeout(() => {
                            tooltip.textContent = 'Copy';
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                    });
                });
            });
        });
        </script>
        
        <script>
            // JavaScript for closing other dropdowns when one is opened
            document.addEventListener('DOMContentLoaded', () => {
                const detailsElements = document.querySelectorAll('details');
                detailsElements.forEach((detail) => {
                    detail.addEventListener('toggle', () => {
                        if (detail.open) {
                            detailsElements.forEach((d) => {
                                if (d !== detail) d.open = false;
                            });
                        }
                    });
                });

                // TOC collapse functionality
                const tocContainer = document.getElementById('toc-container');
                const collapseBtn = document.getElementById('toc-collapse-btn');
                let isAutoCollapsed = false;

                // Function to collapse/expand TOC
                function toggleTOC(collapse) {
                    if (collapse) {
                        tocContainer.classList.add('collapsed');
                        collapseBtn.classList.add('collapsed');
                    } else {
                        tocContainer.classList.remove('collapsed');
                        collapseBtn.classList.remove('collapsed');
                    }
                }

                // Manual toggle via button
                collapseBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const shouldCollapse = !tocContainer.classList.contains('collapsed');
                    toggleTOC(shouldCollapse);
                    isAutoCollapsed = false;
                });

                // Expand when clicking collapsed TOC
                tocContainer.addEventListener('click', () => {
                    if (tocContainer.classList.contains('collapsed')) {
                        toggleTOC(false);
                    }
                });

                // Auto-collapse on scroll
                let lastScrollPosition = 0;
                const scrollThreshold = 100;

                window.addEventListener('scroll', () => {
                    const currentScroll = window.pageYOffset;
                    
                    // Only auto-collapse if user hasn't manually interacted
                    if (!isAutoCollapsed && currentScroll > scrollThreshold && currentScroll > lastScrollPosition) {
                        toggleTOC(true);
                        isAutoCollapsed = true;
                    }
                    
                    lastScrollPosition = currentScroll;
                });

                // Prevent TOC collapse when using search
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('focus', () => {
                    isAutoCollapsed = false;
                    toggleTOC(false);
                });


                // Back to top button functionality
                const backToTopButton = document.getElementById('back-to-top');
                
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 300) {
                        backToTopButton.style.display = 'flex';
                    } else {
                        backToTopButton.style.display = 'none';
                    }
                });

                backToTopButton.addEventListener('click', () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            });
            
            // JavaScript for TOC search functionality
            function filterTOC() {
                const input = document.getElementById('searchInput');
                const filter = input.value.toLowerCase();
                const tocContainer = document.getElementById('toc-container');
                const links = tocContainer.querySelectorAll('a');
                const detailsElements = tocContainer.querySelectorAll('details');
                
                links.forEach(link => {
                    const text = link.textContent.toLowerCase();
                    const li = link.parentElement;
                    if (text.includes(filter)) {
                        li.style.display = '';
                        const parentDetails = link.closest('details');
                        if (parentDetails && !parentDetails.open) {
                            parentDetails.open = true;
                        }
                    } else {
                        li.style.display = 'none';
                    }
                });
            }
        </script>
    </body>
    </html>
    
